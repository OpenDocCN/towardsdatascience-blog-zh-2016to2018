<html>
<head>
<title>Run or Walk (Part 2): Collecting Device Motion Data the Right Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跑步或行走(第 2 部分):以正确的方式收集设备运动数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/run-or-walk-part-2-collecting-device-motion-data-the-right-way-58a277ff2087?source=collection_archive---------2-----------------------#2017-08-14">https://towardsdatascience.com/run-or-walk-part-2-collecting-device-motion-data-the-right-way-58a277ff2087?source=collection_archive---------2-----------------------#2017-08-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ea22c505a6a489b22aeccae25028e3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zclQAfpPUBcaxTzgXd8mNg.jpeg"/></div></div></figure><p id="fbae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">阅读上一部分:</em> <a class="ae kx" href="https://medium.com/towards-data-science/run-or-walk-detecting-user-activity-with-machine-learning-and-core-ml-part-1-9658c0dcdd90" rel="noopener"> <em class="kw">“跑还是走(第一部分):用机器学习和 Core ML 检测运动数据活动”</em> </a></p><p id="7e30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">出于开发一个机器学习模型来准确预测用户是走路还是跑步的动机，我需要数据。快速搜索包含此类活动的公开可用数据集没有得到任何结果。剩下的唯一选择就是自己收集数据。</p><p id="5e19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个参加过任何数据科学竞赛的人都知道，数据集总是需要经过某种程度的处理，才能馈入机器学习模型。你不能错过这个阶段，否则，你的模型将会遭受缺失、扭曲的数据、异常值和其他一些问题。有时，在完成一项比赛后，回头看看投入的时间，您会意识到将近一半的努力都花在了处理数据集上！原因？数据集是基于现实生活中的数据，而现实生活中的数据在连续性、同质性或统计分布方面并不理想。</p><h1 id="a1d9" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">DIY 数据</h1><p id="ba96" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">当你独自负责收集数据时，事情会变得更好。从一方面来说，这是获取数据的最昂贵的方式，但是从另一方面来说，你有一个很好的机会通过以你需要的方式收集数据来节省你未来的努力。仔细思考你试图解决的问题的基础有助于找到收集数据的适当方法。</p><p id="cf2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我从要点开始。如果我想知道这个人是在跑还是在走，我首先需要在人体上找到一个地方，根据传感器数据可以清楚地区分这些活动。简单地将 iPhone 放在口袋里并从那里收集数据并不是一个好的解决方案，因为每次设备可以放在不同的位置。这可能导致传感器的结果差异太大，即使是相同的活动。鉴于我收集数据的时间有限，我宁愿为了简单而牺牲数据的可变性。</p><p id="4066" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">收集人的活动数据的最佳选择是手腕。原因如下:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/f8406c5bfdee1878154fae586f655609.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*vfK_D1lsqwzgT0YR2guXsg.gif"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Walking: hand wrist directed to the ground, moves with low to medium velocity</figcaption></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/7ee4badaede31762151988acdcfb9726.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*P5J2RcaRz8JYEjT_Rt7yVA.gif"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Running: hand wrist directed mostly perpendicular to the ground, moves with medium to high velocity</figcaption></figure><p id="59b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑到大多数人有两个手腕，我的 2 级分类模型的数据应该以下列变化收集:</p><ul class=""><li id="cdac" class="mk ml iq ka b kb kc kf kg kj mm kn mn kr mo kv mp mq mr ms bi translated">走路，右手腕；</li><li id="b9dc" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated">走路，左手腕；</li><li id="96c1" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated">跑步，右手腕</li><li id="81be" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated">跑步，左手腕；</li></ul><p id="46af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的一个有效问题应该是“等等，当 Apple Watch 是一个更合适的选择时，为什么要在你的手腕上安装 iPhone？!"完全同意，但那时我还没有手机，并认为 iPhone 及其加速度计和陀螺仪将提供相同的传感器数据。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/ae4ff7718f9635981db6aca500b97aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*czpS4JukGuTUpk8MbmzLVg@2x.jpeg"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">iPhone was always positioned with Home button pointing to the fingers</figcaption></figure><h1 id="19b1" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">收藏什么？</h1><p id="5d1b" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">第一个似乎很容易回答的问题，可能会把你引向错误的方向。在你的 iPhone 中有加速度计、陀螺仪、磁力计、计步器甚至气压计并不意味着从所有这些设备中收集传感器数据是有意义的。</p><p id="5af0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里一个很好的起点是一个官方的 <a class="ae kx" href="https://developer.apple.com/documentation/coremotion/getting_raw_gyroscope_events" rel="noopener ugc nofollow" target="_blank">文档</a>，它揭示了每个传感器的能力和局限性。仔细阅读后，我意识到最有价值的数据来自两个传感器:加速度计和陀螺仪。记得吗，我想用尽可能少的数据？限制传感器的数量是这个方向的第一步。</p><p id="1832" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为什么是那两个？加速度计提供了设备沿 3 个轴的速度变化，这是关于一个人如何移动他的手的重要信息。陀螺仪提供设备绕空间轴旋转的速率，这可能对区分跑步和行走活动没有太多帮助，但可能仍然有所帮助。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/b0b3c9eb065458ef619ce9885a49e0bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVw3eNB2w2dmFY62_V2bDA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Sensor axes for accelerometer (left) and gyroscope (right)</figcaption></figure><h1 id="800e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">原始数据还是经过处理的数据？</h1><p id="c02f" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">苹果在为不同场合提供不同格式的运动数据方面做得非常好。如果需要加速度计数据仅限于仅由用户应用于设备<em class="kw">的加速度，在这种情况下，处理后的数据是一个有效的选项。它不包括不同形式的偏差，如重力引起的加速度。</em></p><p id="94ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一方面，原始加速度计数据由您决定如何处理。这种数据是在我未来的机器学习模型中使用的完美候选。未经处理意味着数据不会因 iOS 中处理算法的实施细节而产生任何形式的偏差。这使得数据有可能在其他平台上重用，并使得在训练模型时出现难以识别的问题的风险降低。</p><h1 id="7d24" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">传感器更新频率</h1><p id="dd9f" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">根据硬件的不同，苹果表示加速度计和陀螺仪的最大传感器更新频率令人印象深刻的“至少 100 Hz”。很明显:你需要的关于设备移动的信息越详细，这个值就应该越高。但是，当你获得足够详细的数据时，总会有一个阈值，即使获得更详细的测量也没有意义。</p><p id="47f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如何找到一个最佳的传感器更新频率？以最大可能频率收集等效活动数据，然后是该值的 70%，然后是 40%，最后是 10%。绘制您从这些值中的每一个接收到的信号，并找到一个保持信号的重要细节并且同时具有最低传感器更新频率的图。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/898c5de3b8cd1a2230c86dc8f73e3fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aagcCFjlJt6can7GBHgh3w.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Data collected at 50Hz</figcaption></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/89a8eca384cab5f8e6570569bef039b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4KGCj0rYuYadRzEUyU-2WA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">The same data downsampled to 30Hz. Important signal details are lost.</figcaption></figure><p id="32d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在尝试了几个值之后，我确定 50Hz 是我要记录的活动类型的最佳传感器更新频率。</p><h1 id="70cf" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">收集间隔</h1><p id="bf2f" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">最初，我试图在一个“不受控制”的环境中收集数据。我想我会步行穿过这个城市，无休止地记录步行活动的数据。跑步也是一样——我只是用我的常规慢跑来记录数据。</p><p id="7310" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，现实表明，在像城市这样的真实环境中连续记录活动是一个非常糟糕的想法，在那里你的运动经常被十字路口、交通灯和其他人打断。在 30 分钟的步行过程中获得的数据充满了来自干扰的噪音。我尝试应用一些技术来删除无关的数据样本，但是没有一个技术能让我确信我保留了原始数据的特征。</p><p id="6817" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解决方案是大幅缩短数据收集间隔。当我评估仅持续 10 秒钟的记录会话时，我发现其中只有 3–4%包含异常值。与连续记录会话后 45%的数据样本包含噪声相比，这是一个明显的改进，还有很长的路要走。</p><h1 id="c11e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">用于数据收集的应用程序</h1><p id="a4da" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我需要一个应用程序来收集数据，并在将数据上传到处理样本的环境之前临时存储数据。</p><p id="fef7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对应用程序可能的功能保持务实，我避免开发花哨的东西，专注于一个目标——以固定的时间间隔可靠地收集数据，并将其存储在应用程序中。</p><p id="4a34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于我希望多长时间收集一次数据样本(50Hz)和多长时间(10 秒间隔)的主要问题已经得到了回答。我必须实现一个应用程序来收集数据样本，并向它们提供元信息，如日期和时间戳、用户名和记录发生的手腕。录制的会话存储在*中的数据录制应用程序的容器中。csv 格式，然后从中提取并复制到我的电脑上。</p><p id="45d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我在固定的时间间隔内实现了触觉反馈，以便通知自己记录仍在发生，并且我不会浪费时间去某个地方而不实际收集数据。</p><p id="ad36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有两种记录模式:手动和连续。我在 95%的时间里使用第二个，它不需要我每 10 秒钟就开始新的录音，而是自动为我做这件事。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/79ea18407080f08d7efaba15f21f5449.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*-3nHpNDkKFMI3LpEoLTvew.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Simplest possible UI</figcaption></figure><p id="e83b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据点击的是“行走”还是“跑步”,收集的数据会相应地标记在结果*中。csv 文件。</p><h1 id="4934" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最终数据集</h1><p id="107d" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在总共收集了大约 5 个小时的行走和跑步数据后，我可以得到几乎相同数量的每一类数据，包括左/右手腕的变化。这产生了具有以下结构的 88588 个数据样本:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/2d75d0e527ac922af447b7b1cef9ae9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_UXiyry2RkQ4yhIi1G83A.png"/></div></div></figure><p id="07da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了证明我收集的数据集是健壮的，并且不会遭受典型的数据集问题，我<a class="ae kx" href="https://www.kaggle.com/vmalyi/run-or-walk" rel="noopener ugc nofollow" target="_blank">将它上传到 Kaggle </a>并让其他人查看和分析它。</p><p id="37f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我也做了<a class="ae kx" href="https://www.kaggle.com/vmalyi/run-or-walk-data-analysis-and-visualization" rel="noopener ugc nofollow" target="_blank">自己的分析</a>，以确保在这个数据集上训练机器学习模型时，我不会面临难以分析的问题。</p><p id="8e97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实上，Kaggle 团队展示了数据集，这让我相信记录这些数据所花费的时间是值得的。当然，最大的收获是，在我收集数据的几周内，我可以减轻一些体重。</p><p id="0c63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请关注我，了解我对这个数据集应用了哪些机器学习技术，以 99%以上的准确率预测用户活动。</p><p id="4ad1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">阅读下一部分:</em></p><ul class=""><li id="c762" class="mk ml iq ka b kb kc kf kg kj mm kn mn kr mo kv mp mq mr ms bi translated"><a class="ae kx" href="https://medium.com/towards-data-science/run-or-walk-part-3-99-accuracy-neural-network-classifier-for-detecting-motion-activity-675e16af4a7d" rel="noopener"> <em class="kw">跑或走(第三部分):&gt;用于检测运动活动性的 99%精度神经网络分类器</em> </a></li><li id="8871" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated"><a class="ae kx" rel="noopener" target="_blank" href="/run-or-walk-part-4-using-keras-neural-network-classifier-in-ios-with-core-ml-a29723ab3235"> <em class="kw">跑还是走(第四部分):在 iOS 中使用 Keras 神经网络分类器，核心 ML </em> </a></li></ul><p id="df60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">图像/视频演职员表:</em></p><ul class=""><li id="469b" class="mk ml iq ka b kb kc kf kg kj mm kn mn kr mo kv mp mq mr ms bi translated"><em class="kw">https://docs-assets . developer . apple . com/published/96e 9d 46 b 41/ab 00 c 9d 5-4f3d-475 b-8020-95066068 a18d . png</em></li><li id="4ae7" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated"><em class="kw">https://docs-assets . developer . apple . com/published/96 e9 d 46 b 41/C9 b 606 b 2-9a 52-487 e-8385-e 710 FFA 1 ce 5f . png</em></li><li id="085d" class="mk ml iq ka b kb mt kf mu kj mv kn mw kr mx kv mp mq mr ms bi translated"><em class="kw">Videezy.com</em></li></ul></div></div>    
</body>
</html>