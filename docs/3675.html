<html>
<head>
<title>Recreating data visualizations from the book “Knowledge is Beautiful”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从《知识是美丽的》一书中再现数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recreating-data-visualizations-from-the-book-knowledge-is-beautiful-e455e7126071?source=collection_archive---------9-----------------------#2018-06-06">https://towardsdatascience.com/recreating-data-visualizations-from-the-book-knowledge-is-beautiful-e455e7126071?source=collection_archive---------9-----------------------#2018-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个系列中，我将着手重现大卫·麦克肯多斯在 r。</p><p id="29b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你看完第一部分后，在这里看看这个系列的其他帖子:<a class="ae kl" rel="noopener" target="_blank" href="/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-ii-2f1d1da68e3a">第二部分</a>，<a class="ae kl" rel="noopener" target="_blank" href="/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iii-5fd393b4c548">第三部分</a>，<a class="ae kl" rel="noopener" target="_blank" href="/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iv-686938a84c9e">第四部分</a>。</p><p id="4f81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">David McCandless 是两本最畅销的信息图表书籍的作者，他在 TED 上做了一个关于数据可视化的演讲。我在 2015 年买了他的第二本书<a class="ae kl" href="https://informationisbeautiful.net/2014/knowledge-is-beautiful/" rel="noopener ugc nofollow" target="_blank">《知识是美丽的》</a>，里面有 196 张漂亮的信息图。</p><p id="55da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那时，我真的迷上了<strong class="jp ir">行尸走肉</strong>，他的书启发我制作了自己的信息图:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/d27b0c325e67d8880a2722b1f9f181f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0_zmGDPiWoT06b02SiqIQ.jpeg"/></div></div></figure><p id="6bf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我试图想到一些有趣的数据可视化项目，并决定从书中选择几个可以在<code class="fe ky kz la lb b">R</code>中尽可能接近地重新创建的项目。</p><p id="901e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于那些喜欢这类练习的人来说，这本书是一个极好的资源，因为<strong class="jp ir">书中的每一个可视化都与一个在线数据集配对，以便</strong> <a class="ae kl" href="http://www.informationisbeautiful.net/data/" rel="noopener ugc nofollow" target="_blank">根据你的兴趣进行探索！！！</a>。我从来不知道数据集有多丰富，直到我尝试重新创建我的第一个可视化，“最佳展示”。<a class="ae kl" href="https://moldach.github.io/dataRbeautiful/bit.ly/KIB_BestDogs" rel="noopener ugc nofollow" target="_blank">中的数据集为<strong class="jp ir">最好单独显示</strong>中的</a>，是一个有八张工作表的 excel 文件！</p><p id="ad51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">McCandles 说整本书花了他两年 15832 个小时，我对此毫不怀疑。如果你只关心可操作的结果，快速绘制一个 EDA 绘图对于一个会议来说是快速而简单的。然而，如果你出版的东西需要一些时间来创造一个惊人的视觉效果。</p><h1 id="25f4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">最佳表演</h1><p id="8371" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">最佳展示</strong>是狗狗轮廓的散点图，根据狗狗的类别进行颜色编码，相应地调整大小，并根据它们的智力指向左边或右边。</p><p id="cf29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们加载环境；我喜欢<code class="fe ky kz la lb b">needs()</code>包，它使得将&amp;加载包安装到<code class="fe ky kz la lb b">R</code>变得简单。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="91ee" class="mj ld iq lb b gy mk ml l mm mn">knitr::opts_chunk$set(echo = TRUE)<br/>if (!require("needs")) {<br/>  install.packages("needs", dependencies = TRUE)<br/>  library(needs)<br/>}</span></pre><p id="8e20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上所述，数据是一个包含八张工作表的 excel 文件。我们可以用<code class="fe ky kz la lb b">read_excel()</code>读入 Excel 文件，并用<code class="fe ky kz la lb b">sheet =</code>参数指定我们想要访问的工作表。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="3a6e" class="mj ld iq lb b gy mk ml l mm mn"># install&amp;Load readxl package<br/>needs(here,<br/>      readxl,<br/>      stringr,<br/>      dplyr,    # to use select()<br/>      magrittr) # to use %&lt;&gt;% operators<br/><br/>path = here()<br/><br/># Specify the worksheet by name<br/>dog_excel &lt;- read_excel("~/bestinshow.xlsx", sheet = "Best in show full sheet", range = cell_rows(3:91))<br/><br/># Pick the desired variables<br/>dog_excel %&lt;&gt;%<br/>  select(1,3,5:6, "intelligence category", "size category")<br/><br/># Rename the columns<br/>colnames(dog_excel) &lt;- c("breed", "category", "score", "popularity", "intelligence", "size")<br/><br/># Remove first row (non-descript column names)<br/>dog_excel &lt;- dog_excel[-1,]</span></pre><p id="91b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个 HTML 表格(支持过滤、分页和排序。这只适用于 RMarkdown，不适用于媒体，所以你需要检查一下<strong class="jp ir">github . io</strong>T18】https://moldach.github.io/dataRbeautiful/index.html</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="0f47" class="mj ld iq lb b gy mk ml l mm mn">needs(DT)<br/>datatable(dog_excel, options = list(pageLength = 5))</span></pre><p id="adc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看数据集中的<code class="fe ky kz la lb b">intelligence</code>等级。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="cf7d" class="mj ld iq lb b gy mk ml l mm mn"># What are the intelligence levels?<br/>unique(dog_excel$intelligence)<br/>## [1] "Brightest"     "Above average" "Excellent"     "Average"      <br/>## [5] "Fair"          "Lowest"</span></pre><p id="30ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">McCandless 将狗分为“笨”和“聪明”两类。但是这里我们看到在这个<em class="mo">干净的</em>数据集中有类别。因此，让我们将前三个因素指定为<code class="fe ky kz la lb b">clever</code>，将其他三个因素指定为<code class="fe ky kz la lb b">dumb</code></p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="1feb" class="mj ld iq lb b gy mk ml l mm mn">dog_excel$intelligence %&lt;&gt;% <br/>  str_replace(pattern = "Brightest", replace = "clever", .) %&gt;%   <br/>  str_replace(pattern = "Above average", replace = "clever", .) %&gt;% <br/>  str_replace(pattern = "Excellent", replace = "clever", .) %&gt;% <br/>  str_replace(pattern = "Average", replace = "dumb", .) %&gt;% <br/>  str_replace(pattern = "Fair", replace = "dumb", .) %&gt;% <br/>  str_replace(pattern = "Lowest", replace = "dumb", .)</span></pre><p id="2580" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原始可视化中有 87 只狗。我在 SuperColoring.com 的<a class="ae kl" href="http://www.supercoloring.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/></a>上找到了<a class="ae kl" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">知识共享 4.0 许可</strong> </a>下的 24 个剪影。这意味着我可以以任何媒体或格式自由复制和再分发，只要我给出网页的链接，并注明作者的姓名和许可证。我已经将该信息包含在一个<code class="fe ky kz la lb b">.csv.</code>中，我们将使用它来对 McCandless 的数据进行子集化(两个数据集都可以在<a class="ae kl" href="https://github.com/moldach/dataRbeautiful" rel="noopener ugc nofollow" target="_blank"> my Github repo </a>中找到)。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="7493" class="mj ld iq lb b gy mk ml l mm mn">needs(readr)<br/>dog_silhouettes &lt;- read_csv("~/dog_silhouettes.csv")<br/><br/>dog_df &lt;- dog_excel %&gt;% <br/>  inner_join(dog_silhouettes, by = "breed")<br/><br/># change popularity from string into numeric values<br/>dog_df$popularity &lt;- as.numeric(dog_df$popularity)</span></pre><p id="7882" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要使用<code class="fe ky kz la lb b">magick</code>包来使<code class="fe ky kz la lb b">.svg</code>轮廓周围的白色背景透明，将图像缩放到普通大小(按宽度)，并保存为<code class="fe ky kz la lb b">.png</code>的。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="1ef6" class="mj ld iq lb b gy mk ml l mm mn">needs(magick)<br/><br/>file.names &lt;- dir(path, pattern = ".svg")<br/><br/>for (file in file.names){<br/>  # read in the file<br/>  img &lt;- image_read_svg(file)<br/>  # scale all images to a common scale<br/>  img_scaled &lt;- image_scale(img, 700)<br/>  # make the background transparent<br/>  img_trans &lt;- image_transparent(img_scaled, 'white')<br/>  # get rid of .svg ending<br/>  file_name &lt;- str_replace(file, pattern = ".svg", replace = "")<br/>  # write out the file as a .png<br/>  image_write(img_trans, paste0(file_name, ".png"))<br/>}</span></pre><p id="9092" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些狗的侧影指向相反的方向。我们需要使用<code class="fe ky kz la lb b">magick</code>包装中的<code class="fe ky kz la lb b">image_flop()</code>,这样所有包装都面向同一个方向。稍后，我们可以通过智能对数据帧进行子集划分，这样<code class="fe ky kz la lb b">clever</code>和<code class="fe ky kz la lb b">dumb</code>狗就面向相反的方向。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="188b" class="mj ld iq lb b gy mk ml l mm mn">path = here()<br/><br/>flop.images &lt;- c("~/labrador-retriever-black-silhouette.png", "~/border-terrier-black-silhouette.png", "~/boxer-black-silhouette.png", "~/french-bulldog-black-silhouette.png", "~/german-shepherd-black-silhouette.png", "~/golden-retriever-black-silhouette.png", "~/greyhound-black-silhouette.png", "~/rottweiler-black-silhouette.png")<br/><br/>for(i in flop.images){<br/>  i &lt;- str_replace(i, pattern = "~/", replace = "")<br/>  img &lt;- image_read(i)<br/>  img_flop &lt;- image_flop(img)<br/>  image_write(img_flop, i)<br/>}</span></pre><p id="06d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是根据类别给狗上色。</p><p id="224a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们写一个函数，可以给它三个参数:1) <code class="fe ky kz la lb b">df</code>一个数据帧，2) <code class="fe ky kz la lb b">category</code>它是狗的类型，3) <code class="fe ky kz la lb b">color</code>每个<code class="fe ky kz la lb b">category</code>的特定颜色。</p><p id="c25f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是只选择那些属于感兴趣的<code class="fe ky kz la lb b">category</code>的狗。这可以通过<code class="fe ky kz la lb b">dplyr</code>封装中的<code class="fe ky kz la lb b">filter()</code>来完成。但是，如果你想使用<code class="fe ky kz la lb b">dplyr</code>功能，比如<code class="fe ky kz la lb b">filter()</code>，你需要<a class="ae kl" href="https://rpubs.com/hadley/dplyr-programming" rel="noopener ugc nofollow" target="_blank">按照这个网站上的说明</a>；用<code class="fe ky kz la lb b">enquo</code>设定。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="e764" class="mj ld iq lb b gy mk ml l mm mn">img_color &lt;- function(df, category, color){<br/>  # Make filter a quosure<br/>  category = enquo(category)<br/>  # subset df on category<br/>  new_df &lt;- df  %&gt;% <br/>    filter(category == !!category)<br/>  # get directory paths of images for the for loop <br/>  category_names &lt;- new_df$breed  %&gt;%<br/>    tolower() %&gt;% <br/>    str_replace_all(" ", "-") %&gt;% <br/>    paste0("-black-silhouette.png")<br/>  for(name in category_names){<br/>    img &lt;- image_read(name)<br/>    img_color &lt;- image_fill(img, color, "+250+250")<br/>    image_write(img_color, name)<br/>  }<br/>}</span></pre><p id="dffc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想在 R 内尽可能接近地复制图形，所以为了复制可视化的颜色，我扫描了这本书，保存了图像，然后使用这个<a class="ae kl" href="https://html-color-codes.info/colors-from-image/" rel="noopener ugc nofollow" target="_blank">工具来获取 html 颜色代码</a>。</p><p id="5136" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们使用上面创建的函数根据它们的<code class="fe ky kz la lb b">category</code>给狗的轮廓上色。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="e3e4" class="mj ld iq lb b gy mk ml l mm mn"># Herding color "#D59E7B"<br/>img_color(dog_df, "herding", "#D59E7B")<br/><br/># Hound color "#5E4D6C"<br/>img_color(dog_df, "hound", "#5E4D6C")<br/><br/># Non-sporting color "#6FA86C"<br/>img_color(dog_df, "non-sporting", "#6FA86C")<br/><br/># Sporting color "#B04946"<br/>img_color(dog_df, "sporting", "#B04946")<br/><br/># Terrier color "#A98B2D"<br/>img_color(dog_df, "terrier", "#A98B2D")<br/><br/># Toy color "#330000"<br/>img_color(dog_df, "toy", "#330000")<br/><br/># Working color "#415C55"<br/>img_color(dog_df, "working", "#415C55")</span></pre><p id="a818" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，终于到了可视化的时候了。</p><p id="bd4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常人们用<code class="fe ky kz la lb b">ggplot2</code>中的<code class="fe ky kz la lb b">geom_point()</code>绘制点，但在这种情况下，我想要每个品种的图像。我们可以使用<code class="fe ky kz la lb b">ggimage</code>包，稍微调整一下，我们就可以基于<code class="fe ky kz la lb b">intelligence</code>翻转图像。<code class="fe ky kz la lb b">ggimage</code>不像<code class="fe ky kz la lb b">ggplot2</code>那样支持颜色作为一种审美，这就是我之前手动分配颜色&amp;尺寸的原因。</p><p id="1979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于<code class="fe ky kz la lb b">popularity</code>分数范围从 1 到 140，1 是最受欢迎的<strong class="jp ir"/>，我们需要用<code class="fe ky kz la lb b">scale_y_reverse()</code>反转 y 轴。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="ae7e" class="mj ld iq lb b gy mk ml l mm mn">needs(ggplot2,<br/>      ggimage)<br/># add "~/" to get filenames of images for plotting<br/>dog_df$name &lt;- paste0("~/", dog_df$name)<br/><br/># create a ggplot/ggimage object<br/>p &lt;- ggplot(subset(dog_df, intelligence == "clever"), aes(x = score, y = popularity, image = name), alpha = 0.5) + geom_image(image_fun = image_flop) + geom_image(data=subset(dog_df, intelligence == "dumb")) +<br/>  labs(title = "Best in Show", subtitle = "The ultimate datadog", caption = "Source: bit.ly/KIB_BestDogs") +<br/>  labs(x = NULL, y = NULL) +<br/>  theme(panel.background = element_blank(),<br/>        legend.position = "top", <br/>        legend.box = "horizontal",<br/>        plot.title = element_text(size = 13,<br/>                                  # I'm not sure what font he chose so I'll pick something I think looks similar<br/>                                 family = "AvantGarde",<br/>                                 face = "bold", <br/>                                              lineheight = 1.2),<br/>        plot.subtitle = element_text(size = 10,<br/>                                     family = "AvantGarde"), <br/>        plot.caption = element_text(size = 5,<br/>                                    hjust = 0.99),  <br/>        axis.text = element_blank(), <br/>        axis.ticks = element_blank()) +<br/>  scale_y_reverse()</span></pre><p id="b3eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一步是在狗的品种下面添加文本注释。因为我用<code class="fe ky kz la lb b">intelligence</code>对<code class="fe ky kz la lb b">dog_df</code>进行了子集化，所以如果我试图用<code class="fe ky kz la lb b">geom_text()</code>进行注释，它只会注释部分数据。我们将需要函数 instea，因为 geome 不是从数据帧的变量映射而来，而是作为向量传入。</p><pre class="kn ko kp kq gt mf lb mg mh aw mi bi"><span id="a47a" class="mj ld iq lb b gy mk ml l mm mn"># Add annotations<br/>p + annotate("text", x=dog_df$score[1:24], y=((dog_df$popularity[1:24])+6), label = dog_df$breed[1:24], size = 2.0)</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mp"><img src="../Images/f0733dba9440f4c0269e4a2de7af10ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_PwBQlqnW_zS-Qo44ih7A.png"/></div></div></figure><p id="df4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可视化看起来与原始相似，并突出了所包含的大部分美学。人们总是可以在 Adobe Illustrator 或 Inkscape 中添加额外的细节，使其看起来更像最终的可视化效果</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/d61d8ce1b37667d6b2b31930d55f9287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5whaVgPbjPtr0AX4sKjfzQ.png"/></div></div></figure><p id="5d44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">敬请关注第二部分！</p></div></div>    
</body>
</html>