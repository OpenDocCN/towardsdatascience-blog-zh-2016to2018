<html>
<head>
<title>Web Scraping TripAdvisor, Text Mining and Sentiment Analysis for Hotel Reviews</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于酒店评论的网页抓取猫途鹰、文本挖掘和情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-tripadvisor-text-mining-and-sentiment-analysis-for-hotel-reviews-cc4e20aef333?source=collection_archive---------0-----------------------#2018-08-06">https://towardsdatascience.com/scraping-tripadvisor-text-mining-and-sentiment-analysis-for-hotel-reviews-cc4e20aef333?source=collection_archive---------0-----------------------#2018-08-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e16719724d15c7dcaef5d622a8e05d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4M_Cxv6wIrI1o16MDp3c3A.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Phone credit: pexels</figcaption></figure><div class=""/><div class=""><h2 id="1653" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">如何应用自然语言处理对酒店评论进行分类</h2></div><p id="d267" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">一项又一项研究表明，猫途鹰在旅行者的决策过程中变得极其重要。然而，理解猫途鹰泡沫评分与数以千计的猫途鹰评论文本之间的细微差别可能具有挑战性。为了更彻底地了解酒店客人的评论是否会影响酒店的加班表现，我从猫途鹰搜集了一家酒店的所有英文评论——<a class="ae lq" href="http://www.hiltonhawaiianvillage.com/" rel="noopener ugc nofollow" target="_blank">希尔顿夏威夷村</a>。我不会讨论网页抓取的细节，这个过程的 Python 代码可以在<a class="ae lq" href="https://github.com/susanli2016/NLP-with-Python/blob/master/Web%20scraping%20Hilton%20Hawaiian%20Village%20TripAdvisor%20Reviews.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。感谢<a class="ae lq" href="https://github.com/furas" rel="noopener ugc nofollow" target="_blank"> Furas </a>的提示。</p><h1 id="728c" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">加载库</h1><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="6510" class="ms ls jf mo b gy mt mu l mv mw">library(dplyr)<br/>library(readr)<br/>library(lubridate)<br/>library(ggplot2)<br/>library(tidytext)<br/>library(tidyverse)<br/>library(stringr)<br/>library(tidyr)<br/>library(scales)<br/>library(broom)<br/>library(purrr)<br/>library(widyr)<br/>library(igraph)<br/>library(ggraph)<br/>library(SnowballC)<br/>library(wordcloud)<br/>library(reshape2)<br/>theme_set(theme_minimal())</span></pre><h1 id="d993" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">数据</h1><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3a58" class="ms ls jf mo b gy mt mu l mv mw">df &lt;- read_csv("Hilton_Hawaiian_Village_Waikiki_Beach_Resort-Honolulu_Oahu_Hawaii__en.csv")<br/>df &lt;- df[complete.cases(df), ]<br/>df$review_date &lt;- as.Date(df$review_date, format = "%d-%B-%y")</span><span id="f72b" class="ms ls jf mo b gy mx mu l mv mw">dim(df); min(df$review_date); max(df$review_date)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d1aa1297177f4726a4780bad14eba43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*Ni-P2Y5oX9rTUMDXDG7uAA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="505d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">希尔顿夏威夷村在猫途鹰上有 13，701 条英文评论，评论日期从 2002 年 3 月 21 日到 2018 年 8 月 2 日。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="aa9f" class="ms ls jf mo b gy mt mu l mv mw">df %&gt;%<br/>  count(Week = round_date(review_date, "week")) %&gt;%<br/>  ggplot(aes(Week, n)) +<br/>  geom_line() + <br/>  ggtitle('The Number of Reviews Per Week')</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/5ba795738d21f65fcaf27d4c1ac1fe76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0U7SevZj_Il32mtHk-9-Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><p id="51bd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">2014 年底收到的每周评论数量最多。该酒店在那一周收到了 70 多条评论。</p><h1 id="f952" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">评论文本的文本挖掘</h1><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a100" class="ms ls jf mo b gy mt mu l mv mw">df &lt;- tibble::rowid_to_column(df, "ID")<br/>df &lt;- df %&gt;%<br/>  mutate(review_date = as.POSIXct(review_date, origin = "1970-01-01"),month = round_date(review_date, "month"))</span><span id="85cb" class="ms ls jf mo b gy mx mu l mv mw">review_words &lt;- df %&gt;%<br/>  distinct(review_body, .keep_all = TRUE) %&gt;%<br/>  unnest_tokens(word, review_body, drop = FALSE) %&gt;%<br/>  distinct(ID, word, .keep_all = TRUE) %&gt;%<br/>  anti_join(stop_words, by = "word") %&gt;%<br/>  filter(str_detect(word, "[^\\d]")) %&gt;%<br/>  group_by(word) %&gt;%<br/>  mutate(word_total = n()) %&gt;%<br/>  ungroup()</span><span id="aff4" class="ms ls jf mo b gy mx mu l mv mw">word_counts &lt;- review_words %&gt;%<br/>  count(word, sort = TRUE)</span><span id="371f" class="ms ls jf mo b gy mx mu l mv mw">word_counts %&gt;%<br/>  head(25) %&gt;%<br/>  mutate(word = reorder(word, n)) %&gt;%<br/>  ggplot(aes(word, n)) +<br/>  geom_col(fill = "lightblue") +<br/>  scale_y_continuous(labels = comma_format()) +<br/>  coord_flip() +<br/>  labs(title = "Most common words in review text 2002 to date",<br/>       subtitle = "Among 13,701 reviews; stop words removed",<br/>       y = "# of uses")</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/dbb327182e4061e6022b6016bae02326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DwRwbKoeqDWJPRuMSMi2Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><p id="3d0b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们肯定可以做得更好一点，把“留下来”和“留下来”，把“游泳池”和“游泳池”结合起来。所谓的词干化，词干化是将屈折词(或有时是派生词)简化为词干、词根或词根格式的过程。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="616c" class="ms ls jf mo b gy mt mu l mv mw">word_counts %&gt;%<br/>  head(25) %&gt;%<br/>  mutate(word = wordStem(word)) %&gt;% <br/>  mutate(word = reorder(word, n)) %&gt;%<br/>  ggplot(aes(word, n)) +<br/>  geom_col(fill = "lightblue") +<br/>  scale_y_continuous(labels = comma_format()) +<br/>  coord_flip() +<br/>  labs(title = "Most common words in review text 2002 to date",<br/>       subtitle = "Among 13,701 reviews; stop words removed and stemmed",<br/>       y = "# of uses")</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/b7f757097bc7c956c70b7b9b800b2a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DEtkJu_f0dntnUUYk6gv7Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><h2 id="9b0a" class="ms ls jf bd lt nc nd dn lx ne nf dp mb ld ng nh md lh ni nj mf ll nk nl mh nm bi translated">二元模型</h2><p id="9e5b" class="pw-post-body-paragraph ku kv jf kw b kx nn kg kz la no kj lc ld np lf lg lh nq lj lk ll nr ln lo lp ij bi translated">我们经常想了解一篇复习中单词之间的关系。评论文章中有哪些常见的单词序列？给定一个单词序列，接下来最有可能是哪个单词？哪些词之间的关系最强？因此，许多有趣的文本分析都是基于这些关系。当我们检查两个连续单词对时，这被称为“二元模型”。</p><p id="e96c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">那么，希尔顿夏威夷村对猫途鹰最常见的评论是什么呢？</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5c10" class="ms ls jf mo b gy mt mu l mv mw">review_bigrams &lt;- df %&gt;%<br/>  unnest_tokens(bigram, review_body, token = "ngrams", n = 2)</span><span id="67f8" class="ms ls jf mo b gy mx mu l mv mw">bigrams_separated &lt;- review_bigrams %&gt;%<br/>  separate(bigram, c("word1", "word2"), sep = " ")</span><span id="ee7b" class="ms ls jf mo b gy mx mu l mv mw">bigrams_filtered &lt;- bigrams_separated %&gt;%<br/>  filter(!word1 %in% stop_words$word) %&gt;%<br/>  filter(!word2 %in% stop_words$word)</span><span id="8e1f" class="ms ls jf mo b gy mx mu l mv mw">bigram_counts &lt;- bigrams_filtered %&gt;% <br/>  count(word1, word2, sort = TRUE)</span><span id="5882" class="ms ls jf mo b gy mx mu l mv mw">bigrams_united &lt;- bigrams_filtered %&gt;%<br/>  unite(bigram, word1, word2, sep = " ")</span><span id="0941" class="ms ls jf mo b gy mx mu l mv mw">bigrams_united %&gt;%<br/>  count(bigram, sort = TRUE)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c512378bdfcc9f92299be9e6efe771ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*ppUy68nOMKUM6X1_K1coYg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><p id="2100" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最常见的重名是“彩虹塔”，其次是“夏威夷村”。</p><p id="2522" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们可以想象单词网络中的二元模型:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d19e" class="ms ls jf mo b gy mt mu l mv mw">review_subject &lt;- df %&gt;% <br/>  unnest_tokens(word, review_body) %&gt;% <br/>  anti_join(stop_words)</span><span id="f493" class="ms ls jf mo b gy mx mu l mv mw">my_stopwords &lt;- data_frame(word = c(as.character(1:10)))<br/>review_subject &lt;- review_subject %&gt;% <br/>  anti_join(my_stopwords)</span><span id="be15" class="ms ls jf mo b gy mx mu l mv mw">title_word_pairs &lt;- review_subject %&gt;% <br/>  pairwise_count(word, ID, sort = TRUE, upper = FALSE)</span><span id="5b2f" class="ms ls jf mo b gy mx mu l mv mw">set.seed(1234)<br/>title_word_pairs %&gt;%<br/>  filter(n &gt;= 1000) %&gt;%<br/>  graph_from_data_frame() %&gt;%<br/>  ggraph(layout = "fr") +<br/>  geom_edge_link(aes(edge_alpha = n, edge_width = n), edge_colour = "cyan4") +<br/>  geom_node_point(size = 5) +<br/>  geom_node_text(aes(label = name), repel = TRUE, <br/>                 point.padding = unit(0.2, "lines")) +<br/>  ggtitle('Word network in TripAdvisor reviews')<br/>  theme_void()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/981cbdcccad0b972aac31d9c2ca486c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhbgwPJGVlPQQTWTrnPX6A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><p id="0840" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以上可视化了猫途鹰评论中常见的二元词，显示了那些至少出现了 1000 次并且没有一个词是停用词的词。</p><p id="d7b8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">网络图显示了顶部几个单词(“夏威夷”、“村庄”、“海洋”和“景色”)之间的强连接。然而，我们在网络中看不到清晰的聚类结构。</p><h2 id="fe69" class="ms ls jf bd lt nc nd dn lx ne nf dp mb ld ng nh md lh ni nj mf ll nk nl mh nm bi translated">三元模型</h2><p id="a5d7" class="pw-post-body-paragraph ku kv jf kw b kx nn kg kz la no kj lc ld np lf lg lh nq lj lk ll nr ln lo lp ij bi translated">二元模型有时是不够的，让我们看看希尔顿夏威夷村的猫途鹰评论中最常见的三元模型是什么？</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d8ef" class="ms ls jf mo b gy mt mu l mv mw">review_trigrams &lt;- df %&gt;%<br/>  unnest_tokens(trigram, review_body, token = "ngrams", n = 3)<br/><br/>trigrams_separated &lt;- review_trigrams %&gt;%<br/>  separate(trigram, c("word1", "word2", "word3"), sep = " ")<br/><br/>trigrams_filtered &lt;- trigrams_separated %&gt;%<br/>  filter(!word1 %in% stop_words$word) %&gt;%<br/>  filter(!word2 %in% stop_words$word) %&gt;%<br/>  filter(!word3 %in% stop_words$word)<br/><br/>trigram_counts &lt;- trigrams_filtered %&gt;% <br/>  count(word1, word2, word3, sort = TRUE)<br/><br/>trigrams_united &lt;- trigrams_filtered %&gt;%<br/>  unite(trigram, word1, word2, word3, sep = " ")<br/><br/>trigrams_united %&gt;%<br/>  count(trigram, sort = TRUE)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1b876a848b7e50c809f977146a0a139d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*GEmCN6NBlCsMTf0OL9ghXQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><p id="0999" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最常见的三元组是“希尔顿夏威夷村”，其次是“钻石头塔”，等等。</p><h2 id="8e6f" class="ms ls jf bd lt nc nd dn lx ne nf dp mb ld ng nh md lh ni nj mf ll nk nl mh nm bi translated">评论中的关键词趋势</h2><p id="74ed" class="pw-post-body-paragraph ku kv jf kw b kx nn kg kz la no kj lc ld np lf lg lh nq lj lk ll nr ln lo lp ij bi translated">随着时间的推移，哪些词和话题变得越来越频繁或越来越不频繁？这些可以让我们了解酒店生态系统的变化，如服务、翻新、问题解决，并让我们预测哪些主题将继续增长。</p><p id="3e24" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们想问这样的问题:随着时间的推移，哪些词在猫途鹰评论中出现的频率越来越高？</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="e899" class="ms ls jf mo b gy mt mu l mv mw">reviews_per_month &lt;- df %&gt;%<br/>  group_by(month) %&gt;%<br/>  summarize(month_total = n())</span><span id="32ec" class="ms ls jf mo b gy mx mu l mv mw">word_month_counts &lt;- review_words %&gt;%<br/>  filter(word_total &gt;= 1000) %&gt;%<br/>  count(word, month) %&gt;%<br/>  complete(word, month, fill = list(n = 0)) %&gt;%<br/>  inner_join(reviews_per_month, by = "month") %&gt;%<br/>  mutate(percent = n / month_total) %&gt;%<br/>  mutate(year = year(month) + yday(month) / 365)</span><span id="95aa" class="ms ls jf mo b gy mx mu l mv mw">mod &lt;- ~ glm(cbind(n, month_total - n) ~ year, ., family = "binomial")</span><span id="c4a3" class="ms ls jf mo b gy mx mu l mv mw">slopes &lt;- word_month_counts %&gt;%<br/>  nest(-word) %&gt;%<br/>  mutate(model = map(data, mod)) %&gt;%<br/>  unnest(map(model, tidy)) %&gt;%<br/>  filter(term == "year") %&gt;%<br/>  arrange(desc(estimate))</span><span id="0f49" class="ms ls jf mo b gy mx mu l mv mw">slopes %&gt;%<br/>  head(9) %&gt;%<br/>  inner_join(word_month_counts, by = "word") %&gt;%<br/>  mutate(word = reorder(word, -estimate)) %&gt;%<br/>  ggplot(aes(month, n / month_total, color = word)) +<br/>  geom_line(show.legend = FALSE) +<br/>  scale_y_continuous(labels = percent_format()) +<br/>  facet_wrap(~ word, scales = "free_y") +<br/>  expand_limits(y = 0) +<br/>  labs(x = "Year",<br/>       y = "Percentage of reviews containing this word",<br/>       title = "9 fastest growing words in TripAdvisor reviews",<br/>       subtitle = "Judged by growth rate over 15 years")</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/901056a440a2cf7310fb3671436f566d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFOCFKxqugRKug3Zb1JIgw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><p id="78fe" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在 2010 年之前，我们可以看到一个围绕“星期五焰火”和“泻湖”的讨论高峰。像“度假费用”和“忙碌”这样词在 2005 年之前增长最快。</p><p id="47cb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">哪些词在评论中出现的频率越来越低？</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d7bc" class="ms ls jf mo b gy mt mu l mv mw">slopes %&gt;%<br/>  tail(9) %&gt;%<br/>  inner_join(word_month_counts, by = "word") %&gt;%<br/>  mutate(word = reorder(word, estimate)) %&gt;%<br/>  ggplot(aes(month, n / month_total, color = word)) +<br/>  geom_line(show.legend = FALSE) +<br/>  scale_y_continuous(labels = percent_format()) +<br/>  facet_wrap(~ word, scales = "free_y") +<br/>  expand_limits(y = 0) +<br/>  labs(x = "Year",<br/>       y = "Percentage of reviews containing this term",<br/>       title = "9 fastest shrinking words in TripAdvisor reviews",<br/>       subtitle = "Judged by growth rate over 4 years")</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nv"><img src="../Images/be2bbef2d3e5a270bdae03c8a78b0c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RmHUMBJD_VfgOlDM2hsgCA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><p id="dcd3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这显示了几个自 2010 年以来兴趣逐渐消失的话题，包括“hhv”(我相信是希尔顿夏威夷村的简称)、“早餐”、“升级版”、“价格”和“免费”。</p><p id="6ae9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们比较几个精选的单词。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7e79" class="ms ls jf mo b gy mt mu l mv mw">word_month_counts %&gt;%<br/>  filter(word %in% c("service", "food")) %&gt;%<br/>  ggplot(aes(month, n / month_total, color = word)) +<br/>  geom_line(size = 1, alpha = .8) +<br/>  scale_y_continuous(labels = percent_format()) +<br/>  expand_limits(y = 0) +<br/>  labs(x = "Year",<br/>       y = "Percentage of reviews containing this term", title = "service vs food in terms of reviewers interest")</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nw"><img src="../Images/258d4b8929abc725efc335853b547b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*239lwkv-7ykw0KkyLU1wLQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><p id="b510" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">服务和食物都是 2010 年之前的热门话题。关于服务和食物的对话在 2003 年左右的数据开始时达到高峰，在 2005 年后一直处于下降趋势，偶尔出现高峰。</p><h1 id="5915" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">情感分析</h1><p id="edba" class="pw-post-body-paragraph ku kv jf kw b kx nn kg kz la no kj lc ld np lf lg lh nq lj lk ll nr ln lo lp ij bi translated">情感分析广泛应用于客户意见材料，如评论和调查回复、在线和社交媒体，应用范围从营销到客户服务再到临床医学。</p><p id="4efd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在我们的案例中，我们旨在确定评论者(即酒店客人)对其过去的经历或对酒店的情绪反应的态度。态度可能是一种判断或评价。</p><p id="27e7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">评论中最常见的正面和负面词汇。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ad48" class="ms ls jf mo b gy mt mu l mv mw">reviews &lt;- df %&gt;% <br/>  filter(!is.na(review_body)) %&gt;% <br/>  select(ID, review_body) %&gt;% <br/>  group_by(row_number()) %&gt;% <br/>  ungroup()<br/>tidy_reviews &lt;- reviews %&gt;%<br/>  unnest_tokens(word, review_body)<br/>tidy_reviews &lt;- tidy_reviews %&gt;%<br/>  anti_join(stop_words)<br/><br/>bing_word_counts &lt;- tidy_reviews %&gt;%<br/>  inner_join(get_sentiments("bing")) %&gt;%<br/>  count(word, sentiment, sort = TRUE) %&gt;%<br/>  ungroup()<br/><br/>bing_word_counts %&gt;%<br/>  group_by(sentiment) %&gt;%<br/>  top_n(10) %&gt;%<br/>  ungroup() %&gt;%<br/>  mutate(word = reorder(word, n)) %&gt;%<br/>  ggplot(aes(word, n, fill = sentiment)) +<br/>  geom_col(show.legend = FALSE) +<br/>  facet_wrap(~sentiment, scales = "free") +<br/>  labs(y = "Contribution to sentiment", x = NULL) +<br/>  coord_flip() + <br/>  ggtitle('Words that contribute to positive and negative sentiment in the reviews')</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nx"><img src="../Images/1d588633043a1c951cde37f5339a1b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1QPwfZ8k3tlFpmieJpOlA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><p id="5282" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们试试另一个情感库，看看结果是否相同。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="0693" class="ms ls jf mo b gy mt mu l mv mw">contributions &lt;- tidy_reviews %&gt;%<br/>  inner_join(get_sentiments("afinn"), by = "word") %&gt;%<br/>  group_by(word) %&gt;%<br/>  summarize(occurences = n(),<br/>            contribution = sum(score))<br/>contributions %&gt;%<br/>  top_n(25, abs(contribution)) %&gt;%<br/>  mutate(word = reorder(word, contribution)) %&gt;%<br/>  ggplot(aes(word, contribution, fill = contribution &gt; 0)) +<br/>  ggtitle('Words with the greatest contributions to positive/negative <br/>          sentiment in reviews') +<br/>  geom_col(show.legend = FALSE) +<br/>  coord_flip()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/6b93aa92e7e74f6cae3d986ca680f3fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QgIg8Lxx6ZGlCdkbKIp75Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 12</figcaption></figure><p id="9ddf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有趣的是，“钻石”(如钻石头)被归类为积极情绪。</p><p id="0857" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这里有一个潜在的问题，例如，“干净”，取决于上下文，如果前面有“不是”这个词，就有一种消极的情绪。事实上，在大多数情况下，unigrams 都有否定的问题。这就把我们带到了下一个话题:</p><h1 id="9fdb" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">在情感分析中使用二元模型提供上下文</h1><p id="1b3b" class="pw-post-body-paragraph ku kv jf kw b kx nn kg kz la no kj lc ld np lf lg lh nq lj lk ll nr ln lo lp ij bi translated">我们想知道单词前面有多少个像“不是”这样的单词。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="afab" class="ms ls jf mo b gy mt mu l mv mw">bigrams_separated %&gt;%<br/>  filter(word1 == "not") %&gt;%<br/>  count(word1, word2, sort = TRUE)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ny"><img src="../Images/c94327cbbd8429fbf9ed207608f88603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LlkhF5JR-sfpehqfuY-jsg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 13</figcaption></figure><p id="842c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在数据中有 850 次单词“a”在单词“not”之前，在日期中有 698 次单词“the”在单词“not”之前。但是，这些信息没有意义。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="004b" class="ms ls jf mo b gy mt mu l mv mw">AFINN &lt;- get_sentiments("afinn")<br/>not_words &lt;- bigrams_separated %&gt;%<br/>  filter(word1 == "not") %&gt;%<br/>  inner_join(AFINN, by = c(word2 = "word")) %&gt;%<br/>  count(word2, score, sort = TRUE) %&gt;%<br/>  ungroup()<br/><br/>not_words</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/a77474c2bf8645a4995b096aea48d88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*xAyc09ppLy1aBw4x_LVYEA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 14</figcaption></figure><p id="0770" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这告诉我们，在数据中，跟在“not”后面的最常见的情感关联词是“worth”，跟在“not”后面的第二个常见的情感关联词是“recommend”，它通常具有 2 的(正)分数。</p><p id="fa8b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">那么，在我们的数据中，哪些词在错误的方向上贡献最大？</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ef56" class="ms ls jf mo b gy mt mu l mv mw">not_words %&gt;%<br/>  mutate(contribution = n * score) %&gt;%<br/>  arrange(desc(abs(contribution))) %&gt;%<br/>  head(20) %&gt;%<br/>  mutate(word2 = reorder(word2, contribution)) %&gt;%<br/>  ggplot(aes(word2, n * score, fill = n * score &gt; 0)) +<br/>  geom_col(show.legend = FALSE) +<br/>  xlab("Words preceded by \"not\"") +<br/>  ylab("Sentiment score * number of occurrences") +<br/>  ggtitle('The 20 words preceded by "not" that had the greatest contribution to <br/>          sentiment scores, positive or negative direction') +<br/>  coord_flip()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/7b340505d7a154c97405eed48f0c2300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCuSTfGbo04AmKbVMUjZ6Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 15</figcaption></figure><p id="0546" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">“不值得”、“不太好”、“不好”、“不推荐”和“不喜欢”这几个词是错误识别的主要原因，这使得文本看起来比实际情况积极得多。</p><p id="2e8b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">除了“不”之外，还有其他否定后项的词，如“没有”、“从来没有”、“没有”。我们去看看。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3d27" class="ms ls jf mo b gy mt mu l mv mw">negation_words &lt;- c("not", "no", "never", "without")<br/><br/>negated_words &lt;- bigrams_separated %&gt;%<br/>  filter(word1 %in% negation_words) %&gt;%<br/>  inner_join(AFINN, by = c(word2 = "word")) %&gt;%<br/>  count(word1, word2, score, sort = TRUE) %&gt;%<br/>  ungroup()<br/><br/>negated_words %&gt;%<br/>  mutate(contribution = n * score,<br/>         word2 = reorder(paste(word2, word1, sep = "__"), contribution)) %&gt;%<br/>  group_by(word1) %&gt;%<br/>  top_n(12, abs(contribution)) %&gt;%<br/>  ggplot(aes(word2, contribution, fill = n * score &gt; 0)) +<br/>  geom_col(show.legend = FALSE) +<br/>  facet_wrap(~ word1, scales = "free") +<br/>  scale_x_discrete(labels = function(x) gsub("__.+$", "", x)) +<br/>  xlab("Words preceded by negation term") +<br/>  ylab("Sentiment score * # of occurrences") +<br/>  ggtitle('The most common positive or negative words to follow negations <br/>          such as "no", "not", "never" and "without"') +<br/>  coord_flip()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oa"><img src="../Images/0e0e81ed589189bd4bbaa248695dd366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z41Rr9D4dulrn9d5oVEOOQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 16</figcaption></figure><p id="a380" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">看起来，将一个词误认为积极的最大来源是“不值得/很棒/很好/推荐”，而被错误分类的消极情绪的最大来源是“不坏”和“没问题”。</p><p id="de65" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最后，让我们找出最正面和最负面的评论。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d220" class="ms ls jf mo b gy mt mu l mv mw">sentiment_messages &lt;- tidy_reviews %&gt;%<br/>  inner_join(get_sentiments("afinn"), by = "word") %&gt;%<br/>  group_by(ID) %&gt;%<br/>  summarize(sentiment = mean(score),<br/>            words = n()) %&gt;%<br/>  ungroup() %&gt;%<br/>  filter(words &gt;= 5)</span><span id="8c3f" class="ms ls jf mo b gy mx mu l mv mw">sentiment_messages %&gt;%<br/>  arrange(desc(sentiment))</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/07093fd5cd68419307d68ce4d164ac91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*JAiwhC62FzvtJ-zMg0iyCg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 17</figcaption></figure><p id="a88c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最正面评论的 ID 是 2363:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="dcf7" class="ms ls jf mo b gy mt mu l mv mw">df[ which(df$ID==2363), ]$review_body[1]</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/39d894e85a87dd71e8c2ad8a6423bdb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rs3TwfJqmDliNU2Dr2wm5Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 18</figcaption></figure><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="771c" class="ms ls jf mo b gy mt mu l mv mw">sentiment_messages %&gt;%<br/>  arrange(sentiment)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi od"><img src="../Images/3f78cb6a6e9ed55bbc065440276041ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*WqCfJ0oRh7xMYqE31Knmjg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 19</figcaption></figure><p id="ec7f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最负面评论的 ID 是 3748:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="cea1" class="ms ls jf mo b gy mt mu l mv mw">df[ which(df$ID==3748), ]$review_body[1]</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/0890ed46a86791ef282f7984d1c29a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9BBapxSi-ykiXR-9nha7Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 20</figcaption></figure><p id="31cc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">很有趣！源代码可以在<a class="ae lq" href="https://github.com/susanli2016/Data-Analysis-with-R/blob/master/Text%20Mining%20Hilton%20Hawaiian%20Village%20TripAdvisor%20Reviews.Rmd" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。祝你一周愉快！</p><p id="6535" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">参考:<a class="ae lq" href="https://www.tidytextmining.com/" rel="noopener ugc nofollow" target="_blank">文本挖掘用 R </a></p></div></div>    
</body>
</html>