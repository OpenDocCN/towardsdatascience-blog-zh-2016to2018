<html>
<head>
<title>How to build and deploy a lyrics generation model — framework agnostic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建和部署歌词生成模型——与框架无关</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-and-deploy-a-lyrics-generation-model-framework-agnostic-589f3026fd53?source=collection_archive---------7-----------------------#2018-09-09">https://towardsdatascience.com/how-to-build-and-deploy-a-lyrics-generation-model-framework-agnostic-589f3026fd53?source=collection_archive---------7-----------------------#2018-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/991c155b454a48e75e8c0cd4e25c2f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VW4AQhY1_ZF00x2pLK-ytA.jpeg"/></div></div></figure><p id="e76d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你会发现大量关于如何建立机器学习模型的文章。你会发现关于如何明智地消费它的文章比较少。而且你会发现几乎没有关于如何从零开始服务它的文章。</p><p id="7ccf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将详细说明我们到上面可以看到的产品的步骤:<a class="ae kw" href="https://www.raplyrics.eu/?utm_source=medium.com&amp;utm_medium=article&amp;utm_campaign=article1-medium" rel="noopener ugc nofollow" target="_blank">rap lytics . eu</a>T3】所有代码都是开源的，可以在 GitHub 上获得。<br/> - <a class="ae kw" href="https://github.com/fpaupier/RapLyrics-Scraper" rel="noopener ugc nofollow" target="_blank">填词-刮刀</a> <br/> - <a class="ae kw" href="https://github.com/cyrilou242/RapLyrics-Back" rel="noopener ugc nofollow" target="_blank">填词-背面</a> <br/> - <a class="ae kw" href="https://github.com/fpaupier/RapLyrics-Front" rel="noopener ugc nofollow" target="_blank">填词-正面</a></p><p id="585f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更新</strong>:在<a class="ae kw" rel="noopener" target="_blank" href="/tips-for-cost-effective-machine-learning-project-6dbc715e7c59?source=friends_link&amp;sk=355e73b806aeec8951f2fc61087144fd">这篇</a>帖子中，我们提出了一种更具成本效益、更直接的方式来为你的机器学习项目服务。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="943d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">什么？</strong></h1><p id="f5cc" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">和我的一个好朋友一起，我们真的很喜欢听说唱音乐。说唱音乐是强大的，因为它有能力只用几个词就创造出野蛮的笑点。<br/>由于仍然很难用 RNN 生成长文本，我们认为说唱音乐是一个很好的候选。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/86a894b2969780d1e1b867418a856a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NoPDSkIA2hFADDbhvMjF-w.gif"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">The final product</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="a57d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">怎么会？</h1><p id="1bc7" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated"><em class="mq">大局</em></p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/e117951aa17bc454efd441775789a012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMU_jxnP_w9-geNDZ3Q9vA.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Project’s architecture</figcaption></figure><p id="375d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不会在帖子中过多描述实现，因为我们试图在代码库中做到详尽，见<code class="fe ms mt mu mv b">READMEs</code>。我将坚持对我们具有挑战性的转折点。</p><p id="5388" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本的系统管理员知识和 unix 熟练程度会有所帮助。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="2675" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak"> 1-数据提取和处理</strong></h1><p id="4776" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">GitHub 库:<a class="ae kw" href="https://github.com/fpaupier/RapLyrics-Scraper" rel="noopener ugc nofollow" target="_blank"> RapLyrics-Scraper </a></p><p id="e1b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="mq"> —刮削</em> </strong></p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/6fcbdadd86a7af94dee045a061255142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7BfpgxDOoziyFetcHWl2A.png"/></div></div></figure><p id="8838" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们需要一个数据集来训练我们的神经网络。</p><p id="6920" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">足够幸运的是，<a class="ae kw" href="https://genius.com" rel="noopener ugc nofollow" target="_blank">Genius.com</a>有大量的在线歌词，甚至还有一个不错的<a class="ae kw" href="https://docs.genius.com" rel="noopener ugc nofollow" target="_blank"> API </a>。</p><p id="c79d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它可能不是为废弃歌词而设计的，但通过一些变通方法，我们设法在它上面建立了一个歌词刮刀。</p><p id="39a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您需要技术细节，请查看源代码或在评论中寻求帮助。<br/>经过多次拍摄，我们意识到专注于高质量的自然语言处理数据集非常重要。我们决定关注 40 位美国艺术家的 60 首最受欢迎的歌曲。</p><p id="0147" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">✔:报废了。</p><p id="5938" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq"> — </em> <strong class="ka ir"> <em class="mq">预处理</em> </strong></p><p id="7993" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">抓取部分为我们提供了一个<code class="fe ms mt mu mv b">.txt</code>数据集。我们现在必须清理它— <em class="mq">即</em>删除非抒情内容:<em class="mq">、</em>、演职员表、错别字和同一单词的各种拼写。想想<code class="fe ms mt mu mv b">gettin'</code>、<code class="fe ms mt mu mv b">getting</code>之类的东西。</p><p id="d393" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们遵循的方法:<br/> 1。识别模式以消除<br/> 2。手工正则表达式捕捉那些模式— <em class="mq">正则表达式测试资源:</em><a class="ae kw" href="https://pythex.org" rel="noopener ugc nofollow" target="_blank"><em class="mq">pythex.org</em></a><br/>3 .使用文本编辑器直接在数据集上执行这些正则表达式</p><p id="8fdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想自动清理正则表达式，要知道这是有风险的。您必须彻底考虑执行正则表达式的顺序。</p><p id="794c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq"> — </em> <strong class="ka ir"> <em class="mq">扩充数据集</em> </strong> <em class="mq">【可选】</em></p><p id="6795" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只选择了歌词真正有意义的艺术家，我们选择了他们最受欢迎的歌曲。这并不构成一个庞大的语料库。因此，我们决定执行一个数据扩充步骤，以便<em class="mq">实际上</em>增加我们数据集的大小。</p><blockquote class="mx my mz"><p id="9cc2" class="jy jz mq ka b kb kc kd ke kf kg kh ki na kk kl km nb ko kp kq nc ks kt ku kv ij bi translated">📖数据扩充意味着增加数据点的数量。在我们的上下文中，它意味着增加句子的数量。</p></blockquote><p id="8532" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们复制了我们的数据集，打乱了所有的诗句，然后把它粘贴到原始数据集的末尾。</p><blockquote class="mx my mz"><p id="0429" class="jy jz mq ka b kb kc kd ke kf kg kh ki na kk kl km nb ko kp kq nc ks kt ku kv ij bi translated">你可以在这里找到一个关于如何打乱段落<a class="ae kw" href="https://gist.github.com/fpaupier/08475906e6bf97035a012a051dbb7b71" rel="noopener ugc nofollow" target="_blank">的片段。</a></p></blockquote><p id="6f27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用这个技巧<em class="mq"> </em>，我们将数据集的大小加倍。这将对神经网络的训练产生积极的影响。实际上，由于洗牌，每个新批次都是不同的，所以网络权重用不同的输入来更新。</p><p id="73e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">✔:数据扩充到此结束。</p><h1 id="4823" class="le lf iq bd lg lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb bi translated"><strong class="ak"> 2-建立歌词生成模型</strong></h1><ul class=""><li id="54e3" class="ni nj iq ka b kb mc kf md kj nk kn nl kr nm kv nn no np nq bi translated">GitHub 资源库:<a class="ae kw" href="https://github.com/cyrilou242/RapLyrics-Back" rel="noopener ugc nofollow" target="_blank"> RapLyrics-Back </a></li></ul><p id="c43e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq"> — </em> <strong class="ka ir"> <em class="mq">标注文本创成式模型</em> </strong></p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/2f5486b1167c22f3b04a729e3c3da3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*L8A3qZnP1O9F0_aNHCM_aA.jpeg"/></div></figure><p id="ad4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">许多神经网络实现可在线获得。我们选择了一个并对其进行了微调以满足我们的需求:<a class="ae kw" href="https://github.com/minimaxir/textgenrnn" rel="noopener ugc nofollow" target="_blank"> textgenrnn </a> — <em class="mq">一个使用神经网络生成文本的 python 项目</em>。</p><p id="4faa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在我们的代码库中找到模型超参数和训练设置的基本描述<code class="fe ms mt mu mv b">READMEs</code></p><p id="fe07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文的目的不是深入研究神经网络设计。实现就不细说了。您可以查看源代码或在评论中 ping 我们。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="1213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq"> — </em> <strong class="ka ir"> <em class="mq">训练文本生成模型</em> </strong></p><p id="7e53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据您的数据集和配置，您可以考虑使用云计算来加速训练。我们使用 AWS——亚马逊网络服务。</p><p id="b508" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在本地培训您的模型，您可以跳过这一部分。否则，考虑到下面的部分会变得有点技术性。</p><p id="300d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我会更详细地介绍我们的训练设置，因为这需要我们花时间去适应。</p><p id="7e94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们启动了 aws ec2 spot 实例来降低成本。我们需要至少 3gb 的内存和 8gb 的默认固态硬盘足够了。训练不是 GPU 加速的(一个改进点)。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/b7715c4c58efef272116e79fec14eb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qsDOmvaNsZCfn638SNPOlg.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">83% savings on a spot instance comparing to a classic ec2 instance</figcaption></figure><p id="617a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ec2 spot 实例与传统 ec2 实例有何不同？</p><blockquote class="mx my mz"><p id="207f" class="jy jz mq ka b kb kc kd ke kf kg kh ki na kk kl km nb ko kp kq nc ks kt ku kv ij bi translated">您出价购买一个具有特定规格的 ec2 实例，只要您的出价高于平均市场价格，您就拥有了一个行为类似经典 ec2 的实例。</p><p id="2598" class="jy jz mq ka b kb kc kd ke kf kg kh ki na kk kl km nb ko kp kq nc ks kt ku kv ij bi translated">如果你的出价低于市场价格，你的实例在一个短时间通知后被终止。关于<a class="ae kw" href="https://aws.amazon.com/fr/ec2/spot/" rel="noopener ugc nofollow" target="_blank">聚光灯实例</a>的更多信息。</p></blockquote><p id="657c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们提出了一个现场请求，很快就完成了，然后我们克隆了我们的 repo 并安装了一个包含所有项目需求的 python3 虚拟环境。</p><p id="081f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq">注意:如果您想要保存您的模型检查点，您需要使您的实例能够在 s3 存储桶上写入(如图所示👇)</em></p><p id="e2db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq"> texgenrnn </em>在每个时期保存一个模型检查点。</p><ul class=""><li id="4154" class="ni nj iq ka b kb kc kf kg kj nt kn nu kr nv kv nn no np nq bi translated">为了应对实例终止的风险并在安全的地方保存我们的检查点，我们使用<code class="fe ms mt mu mv b">aws cli</code>在 aws s3 桶中复制检查点。<code class="fe ms mt mu mv b">cd</code>到您的检查点文件，并将它们复制到您的 s3 存储桶。</li></ul><pre class="mi mj mk ml gt nw mv nx ny aw nz bi"><span id="3108" class="oa lf iq mv b gy ob oc l od oe"># run `pip install awscli` beforehand<br/>aws s3 cp my-checkpoint-file.ckpt s3:<em class="mq">//my-s3-bucket/model-saves/</em></span></pre><p id="1a91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:要做到这一点，您需要向实例授予对 ec2 的写权限。为此，向您的 ec2 实例添加一个角色，使用 s3 完全访问和 ec2 完全访问策略，如下图所示。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/9e11c7fe7fb6fdb43accbe399830b93e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GwSCOC3o0pPw6kGDCZo4ag.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Attach those 2 policies to the IAM role attached to your ec2 instance.</figcaption></figure><p id="d936" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">政策处理中有许多偷偷摸摸的细节，不要犹豫，在评论中问我们。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="e14f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq">——</em>——<strong class="ka ir">——<em class="mq">测试文本生成</em>——</strong></p><p id="b97b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦你训练好了你的模型，你就可以使用 Jupyter 笔记本<code class="fe ms mt mu mv b"><a class="ae kw" href="https://github.com/cyrilou242/RapLyrics-Back/blob/master/exploration/sample_explorator.ipynb" rel="noopener ugc nofollow" target="_blank">RapLyrics-Back/exploration/sample_explorator.ipynb</a></code>来生成你的第一首人工智能歌词。</p><h1 id="b9cc" class="le lf iq bd lg lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb bi translated"><strong class="ak"> <em class="og"> 3。服务于文本生成模型</em> </strong></h1><p id="4d2f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">为了给用户提供更好的歌词，我们使用了一个<a class="ae kw" href="https://github.com/cyrilou242/RapLyrics-Back/blob/master/sampler.py" rel="noopener ugc nofollow" target="_blank">自定义生成函数</a>。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/38cab77b0dec0452a6162c9d7f908a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*Y2Dk5BHOt-JcXKjGNNG-wQ.jpeg"/></div></figure><p id="a6e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用<a class="ae kw" href="http://gunicorn.org" rel="noopener ugc nofollow" target="_blank"> gunicorn </a>在<a class="ae kw" href="http://flask.pocoo.org/docs/1.0/" rel="noopener ugc nofollow" target="_blank">烧瓶</a>上提供应用程序。这个想法是不要在每次 API 调用时重新加载模型——这会导致很长的响应时间。<br/>我们只在应用程序初始化时恢复一次会话，它在 API 调用之间持续存在。</p><p id="6288" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">API 调用及其响应的演示。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/65b2492200ab043ca6bd376cfcff4707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*iR6Bxb24Et8N_ul_KXtPWQ.gif"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">curl on back-end</figcaption></figure><p id="dca7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您还没有实现该模型，请随时调用我们的 API:</p><pre class="mi mj mk ml gt nw mv nx ny aw nz bi"><span id="cb65" class="oa lf iq mv b gy ob oc l od oe">curl '<a class="ae kw" href="https://raplyrics.eu/apiUS'" rel="noopener ugc nofollow" target="_blank">https://raplyrics.eu/apiUS'</a> -X POST -H "Content-Type: application/x-www-form-urlencoded" -d "input=struggle"</span></pre><p id="4bb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参见<a class="ae kw" href="https://github.com/cyrilou242/RapLyrics-Back/blob/master/server.py" rel="noopener ugc nofollow" target="_blank">上<code class="fe ms mt mu mv b">api/serve_us.py</code>中的<code class="fe ms mt mu mv b">get_model_api_us</code>函数，了解我们如何建立一个持久的张量流会话</a>。只需从 shell 中运行<code class="fe ms mt mu mv b">gunicorn app:app</code>来启动应用程序。模型默认在<code class="fe ms mt mu mv b">127.0.0.1:8000</code>端上。</p><p id="18ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你现在可以在将被用作网络服务器的机器上克隆<a class="ae kw" href="https://github.com/cyrilou242/RapLyrics-Back" rel="noopener ugc nofollow" target="_blank"> RapLyrics-Back </a>。</p><h1 id="647c" class="le lf iq bd lg lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb bi translated">4-插入前端</h1><p id="1405" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">GitHub 资源库:<a class="ae kw" href="https://github.com/fpaupier/RapLyrics-Front" rel="noopener ugc nofollow" target="_blank"> RapLyrics-Front </a></p><p id="445a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文描述了 apache web 服务器的必要步骤。如果没有它<code class="fe ms mt mu mv b">sudo apt-get install apache</code>。</p><p id="f5ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将所有要提供的文件从<a class="ae kw" href="https://github.com/fpaupier/RapLyrics-Front" rel="noopener ugc nofollow" target="_blank"> RapLyrics-Front </a>移动到<code class="fe ms mt mu mv b">/var/www/html/</code> <br/>记住在<code class="fe ms mt mu mv b">index.html <br/></code>中更新你的端点的<code class="fe ms mt mu mv b">"url"</code>设置就这样，你就大功告成了(差不多)。现在，您可以通过网络浏览器访问您的服务器<code class="fe ms mt mu mv b">ip</code>来访问网站。</p><p id="c331" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq"> — </em> <strong class="ka ir"> <em class="mq">生产设置</em> </strong> <em class="mq">【可选】</em></p><p id="1cd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想让前端和后端在同一台机器上使用 https 连接，下面是几个步骤。</p><p id="bde2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1.让我们加密我们的网站🔒→按照<a class="ae kw" href="https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank">如何用加密来保护 Apache 的步骤进行</a>(数字海洋有非常棒的教程)</p><p id="ea10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.当用户提交输入时，apache 服务的<code class="fe ms mt mu mv b">index.html</code>调用<code class="fe ms mt mu mv b">raplyrics.eu/apiUS</code>。事实上，阿帕奇上没有<code class="fe ms mt mu mv b">/apiUS</code>航线。我们需要将这个调用重定向到运行在同一台机器上的<code class="fe ms mt mu mv b">gunicorn</code>服务器。这就是所谓的<em class="mq">反向代理。</em></p><p id="1814" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来处理这两个步骤。<br/>由于代码与 apache 配置相关，因此不受版本控制。</p><ul class=""><li id="bc50" class="ni nj iq ka b kb kc kf kg kj nt kn nu kr nv kv nn no np nq bi translated">去<code class="fe ms mt mu mv b">/etc/apache2/sites-available</code></li></ul><p id="2c6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到一个<code class="fe ms mt mu mv b">000-default.conf</code>和一个<code class="fe ms mt mu mv b">000-default-le-ssl.conf</code>文件。它们是模板文件，处理 apache 如何服务于 http 和 https ( <code class="fe ms mt mu mv b">le-ssl</code>)网站的配置。</p><p id="f7f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们为我们的网站复制了一份。(用您的域名替换<code class="fe ms mt mu mv b">raplyrics.eu</code>👇)</p><p id="af06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b">sudo cp 000-default.conf raplyrics.eu.conf</code> <br/> <code class="fe ms mt mu mv b">sudo cp 000-default-le-ssl.conf raplyrics.eu-le-ssl.conf</code></p><p id="dd8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 1。将流量从</strong> <code class="fe ms mt mu mv b"><strong class="ka ir">http</strong></code> <strong class="ka ir">重定向到</strong> <code class="fe ms mt mu mv b"><strong class="ka ir">https</strong></code></p><p id="197f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">编辑<code class="fe ms mt mu mv b">raplyrics.eu.conf</code>以包括以下重写条件:</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Rewrite rules to redirect traffic from http to https. Remember to replace raplyrics.eu by your site name.</figcaption></figure><p id="1fc3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。反向代理 API 调用</strong></p><p id="9d23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">编辑<code class="fe ms mt mu mv b">raplyrics.eu-le-ssl.conf</code>以包含代理反向指令。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Reverse proxy to redirect the API call to the gunicorn app</figcaption></figure><p id="15a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们处理从<code class="fe ms mt mu mv b">raplyrics.eu/apiUS</code>到<code class="fe ms mt mu mv b">127.0.0.1:8000</code>的本地 gunicorn 服务器的代理传递</p><p id="1a89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们告诉 apache 更新网站配置:</p><p id="234f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b">sudo a2ensite raplyrics.eu.conf</code> <br/> <code class="fe ms mt mu mv b">sudo a2ensite raplyrics.eu-le-ssl.conf</code></p><p id="44f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，<code class="fe ms mt mu mv b">sudo systemctl restart apache2</code>要把变化考虑进去。</p><p id="714d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就这样，你在制作中。🚀<br/>你可以在<a class="ae kw" href="https://www.raplyrics.eu/?utm_source=medium.com&amp;utm_medium=article&amp;utm_campaign=article1-medium" rel="noopener ugc nofollow" target="_blank"> raplyrics.eu </a>上查看我们的</p><h1 id="3f78" class="le lf iq bd lg lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb bi translated">参考📚</h1><p id="b2ce" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">关于在 heroku 上提供 python 应用的有趣博客文章(Heroku dynos 无法处理我们的应用——没有足够的 ram)很好地描述了步骤。</p><p id="563b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://httpd.apache.org/docs/2.4/howto/reverse_proxy.html" rel="noopener ugc nofollow" target="_blank">Apache 2 上的反向代理</a></p><p id="cc5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数字海洋在 apache 上的反向代理，数字海洋再次做了一个非常值得赞赏的文档工作，非常详细。</p><p id="4ff0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">非常有趣，所以在<a class="ae kw" href="https://stackoverflow.com/questions/38671818/how-to-deploy-with-gitlab-ci-to-ec2-using-aws-codedeploy-codepipeline-s3" rel="noopener ugc nofollow" target="_blank">上发布如何用 GitLab 和 AWS 构建 CI / CD 管道</a></p><p id="9a78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://skymind.ai/wiki/lstm" rel="noopener ugc nofollow" target="_blank">神经网络参数微调的启示</a></p><p id="0978" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有趣的<a class="ae kw" href="https://stats.stackexchange.com/questions/153531/what-is-batch-size-in-neural-network?newreg=e96dc96f976b43e0a6a21955daa54498" rel="noopener ugc nofollow" target="_blank">关于微调批量训练参数</a>的交叉验证帖子。</p><p id="d49c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://arxiv.org/pdf/1409.2329v4.pdf" rel="noopener ugc nofollow" target="_blank">谷歌大脑论文提出了一组文本生成 LSTM 的超级参数</a>(尤其是 4。我们用例的实验和 4.1 语言建模。)</p></div></div>    
</body>
</html>