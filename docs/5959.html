<html>
<head>
<title>Implementing Spatial Batch / Instance / Layer Normalization in Tensorflow [ Manual back Prop in TF ]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Tensorflow 中实现空间批量/实例/图层归一化[TF 中的手动反推]</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implementing-spatial-batch-instance-layer-normalization-in-tensorflow-manual-back-prop-in-tf-77faa8d2c362?source=collection_archive---------5-----------------------#2018-11-18">https://towardsdatascience.com/implementing-spatial-batch-instance-layer-normalization-in-tensorflow-manual-back-prop-in-tf-77faa8d2c362?source=collection_archive---------5-----------------------#2018-11-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c45656233bf76f07db8edc9bdb4b012b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIUXW8EnUFospRlk_cjxjw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/photos/yaHOyZjxQVA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Daniel van den Berg</a> on <a class="ae kc" href="https://unsplash.com/search/photos/normalization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9700" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章是对实现不同规范化层的简单回顾。</p><blockquote class="lb lc ld"><p id="5c5f" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kf ir">请注意，这篇帖子是给未来的自己看的，回顾这篇帖子里呈现的材料。</strong></p></blockquote></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="f86b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">简介</strong></p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/9013975876e6dc402f22ae8f492fee68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a91GBoHuyu_Sey6bRLg0Zg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Image from this <a class="ae kc" href="https://arxiv.org/pdf/1803.08494.pdf" rel="noopener ugc nofollow" target="_blank">website</a></figcaption></figure><p id="7da8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天我想写一篇关于实现不同类型的标准化层的短文。如上所述，批次/层/实例甚至组规范化方法都是相互关联的。唯一的区别是他们取均值和方差(一阶和二阶矩)的维度。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="c054" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">算出导数</strong></p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/ed7a0d9104fdccd83c7f5d43bdf3ea38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3xUZ1zVhMlz_96BC2I7pw.jpeg"/></div></div></figure><p id="3ece" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计算每个归一化方案的导数也很容易。唯一的区别是，1)我们求导的维数，2)求导时需要除以的数。</p><p id="43f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的 DIM 变量显示了每个归一化方案之间的差异。假设我们有代表(B，H，W，C)的 4D 张量，它代表图像的批次、高度、宽度和通道。</p><p id="aabc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">批次定额</strong> →对通道(1，1，1，c)取均值和方差<br/> <strong class="kf ir">层定额</strong> →对批次(b，1，1，1) <br/> <strong class="kf ir">实例定额</strong> →对批次/通道(b，1，1，c)取均值和方差</p><p id="315d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">**更新**我重新阅读了最初的批量定额论文，作者没有包括 sigma 项。我也更新了代码。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="70c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">批量归一化</strong></p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/9e9af498822c36cce6429f5a82e3ad19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAvsJyq7GJeDN_DCrrChMA.png"/></div></div></figure><p id="9449" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用我们能够从顶部驱动的派生，实现批量规范化层是非常容易的。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/f64dfa2bf07a73bfa67fb460b5657f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEdnDCY3poEhw7RyP0Ad3A.png"/></div></div></figure><p id="4fd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以确认，在该层之后，平均值为零(非常接近零)，并且对于我们已经归一化的维度，标准偏差被设置为 1。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="a864" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">图层归一化</strong></p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/2fe616f089e57dd38446d7ad970f5028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LsBPigHkVrTVi8sMfJXF-A.png"/></div></div></figure><p id="bda6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">类似的故事层标准化，这一次我们将执行标准化方面的批量维度。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/b3cb222232b12900d4203646d794b1c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kLZj8BXjnefGHYW-LsxXQ.png"/></div></div></figure></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="e18f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">实例规范化</strong></p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/f3dc5ba8c4ddc5de67cad51b08f6b64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SsHJbrRnWcnFFmcXEeLbCA.png"/></div></div></figure><p id="0c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后对于实例标准化，我们需要对批量维度和渠道维度进行标准化。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/72867897dbd36d0f809571cb3c05aa94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ezw01R5We4AO73VEE-qPw.png"/></div></div></figure></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="098b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">这篇短文的代码</strong></p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/558e0aa407835502e5dcd31eab2d7b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9TYLrE8Ca8lsrZPUrEZleA.png"/></div></div></figure><p id="a9b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要获取这篇博文<a class="ae kc" href="https://colab.research.google.com/drive/1Ijc1PywRUkvihoX_hXIjfHG4f_f6ERWW" rel="noopener ugc nofollow" target="_blank">的代码，请点击这里。</a></p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="7a54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">最后的话</strong></p><p id="d534" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实现这种标准化层总是好的做法，对于想要更多数学细节的人，请看这篇<a class="ae kc" href="http://cthorey.github.io./backpropagation/" rel="noopener ugc nofollow" target="_blank">博文。</a></p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="0c1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">参考</strong></p><ol class=""><li id="56c4" class="mc md iq kf b kg kh kk kl ko me ks mf kw mg la mh mi mj mk bi translated">(2018).Arxiv.org。检索于 2018 年 11 月 18 日，来自<a class="ae kc" href="https://arxiv.org/pdf/1803.08494.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1803.08494.pdf</a></li><li id="c1d8" class="mc md iq kf b kg ml kk mm ko mn ks mo kw mp la mh mi mj mk bi translated">空间 Batchnorm Backprop 实施说明 Sam Kirkiles 博客 Medium。(2018).中等。2018 年 11 月 18 日检索，来自<a class="ae kc" href="https://medium.com/samkirkiles/spatial-batchnorm-backprop-implementation-notes-8ccde1ac62a2" rel="noopener">https://medium . com/samkirkiles/spatial-batch norm-back prop-implementation-notes-8 ccde 1 AC 62 a 2</a></li><li id="cfdf" class="mc md iq kf b kg ml kk mm ko mn ks mo kw mp la mh mi mj mk bi translated">推导批次标准化的后向传递的梯度。(2018).kevinzakka . github . io . 2018 年 11 月 18 日检索，来自<a class="ae kc" href="https://kevinzakka.github.io/2016/09/14/batch_normalization/" rel="noopener ugc nofollow" target="_blank">https://kevinzakka . github . io/2016/09/14/batch _ normalization/</a></li><li id="8227" class="mc md iq kf b kg ml kk mm ko mn ks mo kw mp la mh mi mj mk bi translated">thorey，C. (2016 年)。流过批量归一化的渐变是什么样子的？。Cthorey.github.io..检索于 2018 年 11 月 18 日，来自<a class="ae kc" href="http://cthorey.github.io./backpropagation/" rel="noopener ugc nofollow" target="_blank">http://cthorey . github . io ./back propagation/</a></li></ol></div></div>    
</body>
</html>