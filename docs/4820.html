<html>
<head>
<title>Self-driving (very small) cars — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无人驾驶(非常小)汽车——第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/self-driving-very-small-cars-part-i-398cca26f930?source=collection_archive---------4-----------------------#2018-09-09">https://towardsdatascience.com/self-driving-very-small-cars-part-i-398cca26f930?source=collection_archive---------4-----------------------#2018-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="89ed" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在野外用 Python，蓝牙汽车和多米尼克·托雷托做人工智能。</h2></div><h2 id="f7a7" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">人工智能与物理世界相遇(在预算之内)</h2><blockquote class="lb"><p id="2dd4" class="lc ld iq bd le lf lg lh li lj lk ll dk translated">“我是那种欣赏好身材的男孩，不管身材如何。”——多米尼克·托雷托</p></blockquote><p id="07ff" class="pw-post-body-paragraph lm ln iq lo b lp lq jr lr ls lt ju lu ko lv lw lx ks ly lz ma kw mb mc md ll ij bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> A </span>自动驾驶汽车初创公司现在在<a class="ae mn" href="https://www.crunchbase.com/lists/autonomous-vehicles-2017/8c8f3beb-a676-4be5-968e-5402558c07fc/organization.companies" rel="noopener ugc nofollow" target="_blank">非常火</a>:即使不考虑通常的嫌疑人(<a class="ae mn" href="https://www.uber.com/info/atg/car/" rel="noopener ugc nofollow" target="_blank"/>、<a class="ae mn" href="https://waymo.com/" rel="noopener ugc nofollow" target="_blank"> Waymo </a>、<a class="ae mn" href="https://getcruise.com/" rel="noopener ugc nofollow" target="_blank"> Cruise </a>等)。)，有一大堆不太知名、资金相对较少的初创公司正在攻击这个领域(甚至还有一个<a class="ae mn" href="https://www.udacity.com/course/self-driving-car-engineer-nanodegree--nd013" rel="noopener ugc nofollow" target="_blank"> Udacity 课程</a>！).这里的关键词是<em class="mo">相对</em>:你如何做并不重要，与你的标准 SaaS 公司相比，这只是一个很高的价格(因为像<a class="ae mn" href="https://news.voyage.auto/an-introduction-to-lidar-the-key-self-driving-car-sensor-a7e405590cff" rel="noopener ugc nofollow" target="_blank">激光雷达</a>这样的酷工具<em class="mo">非常</em>昂贵+收集训练/测试数据是一件痛苦的事情)。</p><p id="07e8" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">为什么这些人要享受所有的乐趣？在我们破烂不堪的车库里，我们就不能做点什么来开始玩耍吗？事实证明，行业中一个常见的举动是使用模拟器，从<em class="mo">特设的</em>物理引擎到<a class="ae mn" href="https://www.technologyreview.com/s/602317/self-driving-cars-can-learn-a-lot-by-playing-grand-theft-auto/" rel="noopener ugc nofollow" target="_blank">现成的视频游戏</a>(你也可以在你的浏览器中尝试<a class="ae mn" href="https://www.metacar-project.com/" rel="noopener ugc nofollow" target="_blank">！).然而，我们在周末的黑客活动中尝试了一些别的东西:我们没有用现实世界来换取对现实世界的模拟，而是选择缩小问题的规模，用一个<em class="mo">玩具宇宙</em>来工作。</a></p><p id="c65c" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">以前已经强调过<em class="mo">玩具</em>的教育(甚至研究)价值:如果你年纪足够大，还记得人工智能时代的美好时光，你可能会想起一只昂贵的<a class="ae mn" href="https://en.wikipedia.org/wiki/AIBO" rel="noopener ugc nofollow" target="_blank">索尼狗</a>是<a class="ae mn" href="https://www.youtube.com/watch?v=lhYdQbSq5Mo" rel="noopener ugc nofollow" target="_blank">机器人世界杯球队</a>之类的天堂(有趣的事实:我写的第一个程序运行在一只白蓝相间的艾博上，它现在在好机器狗的天堂里自由自在地游荡)。具体来说，在谈到移动玩具时，荣誉奖当然要归功于<a class="ae mn" href="https://www.amazon.com/Vehicles-Experiments-Psychology-Valentino-Braitenberg/dp/0262521121" rel="noopener ugc nofollow" target="_blank">车辆</a>，这是由<a class="ae mn" href="https://en.wikipedia.org/wiki/Valentino_Braitenberg" rel="noopener ugc nofollow" target="_blank">瓦伦蒂诺·布莱滕贝格</a>撰写的一本聪明的书，在书中，简单的车辆展现出越来越复杂的“合成心理学”特征。</p><p id="6ee6" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">在这篇由两部分组成的文章中，我们将建立一个基于 Python 的开发环境来发送/接收赛车上的蓝牙小汽车的信息。由于我们缺钱，但不缺款式，我们将从著名的 Anki Overdrive 赛车套装的<a class="ae mn" href="https://www.anki.com/en-us/fast-and-furious" rel="noopener ugc nofollow" target="_blank">速度与激情</a>版开始。</p><blockquote class="mu mv mw"><p id="9d6f" class="lm ln mo lo b lp mp jr lr ls mq ju lu mx mr lw lx my ms lz ma mz mt mc md ll ij bi translated">如果你像我们一样生活，一次一个 Git commit，跟随我们一起踏上从零到无人驾驶(非常小)汽车的疯狂旅程。</p></blockquote><p id="3869" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">写这篇文章时，还没有好莱坞名人受到伤害。</p><p id="86d6" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><em class="mo">免责声明:这是一个有趣的周末项目，绝不是经过深思熟虑的研究声明或生产就绪代码；事实证明，在选定的环境中，有许多真实的汽车无法再现(稍后将详细介绍)。也就是说，我们开始学习蓝牙的东西，更有趣的是，如何在不同的约束下构建人工智能和学习问题，而不是我们习惯的 API 开发的稀薄世界。</em></p><p id="607a" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><em class="mo">请注意，这个帖子的所有代码都免费</em> <a class="ae mn" href="https://github.com/jacopotagliabue/anki-drive-python-sdk" rel="noopener ugc nofollow" target="_blank"> <em class="mo">在 Github </em> </a> <em class="mo">上提供。</em></p><h2 id="a6da" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">设置</h2><blockquote class="lb"><p id="23fb" class="lc ld iq bd le lf lg lh li lj lk ll dk translated">"你刚刚赢得了与魔鬼共舞的机会，孩子。"—卢克·霍布斯</p></blockquote><p id="3423" class="pw-post-body-paragraph lm ln iq lo b lp lq jr lr ls lt ju lu ko lv lw lx ks ly lz ma kw mb mc md ll ij bi translated">为了开始与卢克和多姆一起玩，我们只需要一条装有蓝牙汽车的赛道和一台可以与它们对话的计算机，这样我们就可以教它如何自动驾驶:</p><ul class=""><li id="f0f8" class="na nb iq lo b lp mp ls mq ko nc ks nd kw ne ll nf ng nh ni bi translated">正如预期的那样，我们选择了<a class="ae mn" href="https://www.anki.com/en-us/overdrive" rel="noopener ugc nofollow" target="_blank"> Anki Overdrive </a>作为我们的小尺度物理宇宙。Overdrive 被宣传为“<a class="ae mn" href="https://www.youtube.com/watch?v=qnfgcyxVYmQ" rel="noopener ugc nofollow" target="_blank">智能战斗赛车系统</a>”，它基本上是你的旧<a class="ae mn" href="https://upload.wikimedia.org/wikipedia/commons/0/02/Pista_polistil.png" rel="noopener ugc nofollow" target="_blank">polis til</a>/<a class="ae mn" href="https://www.youtube.com/watch?v=ZTDg6gaxx2s" rel="noopener ugc nofollow" target="_blank">scale xtric</a>赛道的蓝牙版本。让 Overdrive 对书呆子友好的是，包含与汽车交互的蓝牙协议的<a class="ae mn" href="https://github.com/anki/drive-sdk" rel="noopener ugc nofollow" target="_blank"> Drive SDK </a>是开源的(然而，弄清楚汽车通信的具体细节花了我们一段时间:见下文)；</li><li id="dbc3" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">就“具有蓝牙功能的计算机”而言，我们选择 Python+node 来通过<a class="ae mn" href="https://www.npmjs.com/package/noble" rel="noopener ugc nofollow" target="_blank"> noble </a>实现跨平台兼容性，因此几乎任何东西都应该只需很小的修改，甚至不需要修改。具体来说，我们使用我们的<a class="ae mn" href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/" rel="noopener ugc nofollow" target="_blank"> Rasp Pi 3B+ </a>在 Linux 上编译和运行原始 C 库，并在大多数实验中使用我们的 2017 MacBook Pro。</li></ul><p id="764e" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">没有一个车库项目可以说是完整的，如果没有一张低分辨率的粒状照片——所以这是我们的(<a class="ae mn" href="https://drive.google.com/file/d/1KOnZiX9q1YuZdqtM2eaoDkS5V9Li6RtK/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">这里</a>是原件):</p><figure class="np nq nr ns gt nt gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi no"><img src="../Images/955c304f8748da76dcbcadc06e9ab9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7qNILMKTLNk62K-Xkz76A.jpeg"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">The difference between man and boy is apparently the price of their toys.</figcaption></figure></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><h2 id="49c3" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">愤怒但不要太快:去试驾</h2><figure class="np nq nr ns gt nt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="3426" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">首先，让我们测试一下设置:在深入研究 Anki Drive 协议之前，我们检查一下我们是否可以使用现成的库从我们的蓝牙汽车中读取/向我们的蓝牙汽车发送消息。我们将运行两个测试:为您自己的设置选择一个您最喜欢的。</p><p id="fc29" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><strong class="lo ir"> Anki 官方 C 工具上的一个树莓派</strong></p><ul class=""><li id="1dff" class="na nb iq lo b lp mp ls mq ko nc ks nd kw ne ll nf ng nh ni bi translated">按照此处的说明<a class="ae mn" href="https://github.com/anki/drive-sdk/wiki/Getting-Started-on-Ubuntu" rel="noopener ugc nofollow" target="_blank">编译并安装示例 Anki 应用程序(不要忘记首先安装所有依赖项)；</a></li><li id="cc81" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">启动<code class="fe on oo op oq b">vehicle-scan</code> app 扫描车辆(记下 id！);</li><li id="a61d" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">使用上面获取的 id 启动<code class="fe on oo op oq b">vehicle-tool</code>连接到车辆；</li><li id="54f1" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">测试一堆命令(<a class="ae mn" href="https://drive.google.com/file/d/1-gy4HG1KNWZrA22Or-abW3M0hzCiaEfb/view" rel="noopener ugc nofollow" target="_blank">截屏</a> +笨拙的<a class="ae mn" href="https://drive.google.com/file/d/1pJgGoeoHjgerM7wI2h-JWtPym-pXAt4y/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">我</a>开车通过码头的视频)。</li></ul><p id="f6ec" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><strong class="lo ir">2017 款 Mac Book Pro 上的 Chrome 68+web app+ </strong> <a class="ae mn" href="https://googlechrome.github.io/samples/web-bluetooth/device-info.html?allDevices=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lo ir">蓝牙 API </strong> </a> <strong class="lo ir"/></p><ul class=""><li id="697e" class="na nb iq lo b lp mp ls mq ko nc ks nd kw ne ll nf ng nh ni bi translated">将您的浏览器指向这个精彩的演示<a class="ae mn" href="https://webbluetoothcg.github.io/demos/bluetooth-racing-cars/" rel="noopener ugc nofollow" target="_blank">这里</a>；</li><li id="615b" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">连接并测试一堆命令(笨拙的<a class="ae mn" href="https://drive.google.com/file/d/1KqsnO5pmfAUtyTtCWI1OVg_QwIQBMwMs/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">我用浏览器</a>开车的视频)。</li></ul><p id="3063" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">任务开始！</p><h2 id="7c05" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">使用 Python 实现实时汽车通信</h2><blockquote class="lb"><p id="fce9" class="lc ld iq bd le lf lg lh li lj lk ll dk translated">“我们做我们最擅长的事情。我们随机应变，好吗？”—布莱恩·奥康纳</p></blockquote><p id="3827" class="pw-post-body-paragraph lm ln iq lo b lp lq jr lr ls lt ju lu ko lv lw lx ks ly lz ma kw mb mc md ll ij bi translated">既然我们知道一切正常，现在是 Python 时间了！我们只能找到一个<a class="ae mn" href="https://github.com/xerodotc/overdrive-python" rel="noopener ugc nofollow" target="_blank">非官方的 Python 包装器</a>用于驱动 SDK:代码实际上看起来很惊人，我们在 Raspberry 上测试成功<code class="fe on oo op oq b">example.py</code>；但是依赖于<a class="ae mn" href="https://github.com/IanHarvey/bluepy" rel="noopener ugc nofollow" target="_blank"> bluepy </a>，所以只是在 Linux 上运行。</p><p id="4449" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">我们最终开发的 hack-y 解决方案是来自上面的 Python 包装器(的简化版本)、一个不错的 Java <a class="ae mn" href="https://github.com/adessoAG/anki-drive-java" rel="noopener ugc nofollow" target="_blank">包装器</a>和这个<a class="ae mn" href="https://github.com/IBM-Cloud/node-mqtt-for-anki-overdrive" rel="noopener ugc nofollow" target="_blank">节点项目</a>的想法的混合:</p><figure class="np nq nr ns gt nt gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi or"><img src="../Images/816168f2791740f573ff6fba39fbebfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gazL6QCUMDZ0rV8ghPUeSQ.jpeg"/></div></div></figure><p id="4ee7" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">特别是，所有的“决定”都将在 Python 层做出，正如预期的那样，但 Python 不会直接与汽车通信，因为一个小节点网关(用<a class="ae mn" href="https://www.npmjs.com/package/noble" rel="noopener ugc nofollow" target="_blank"> noble </a>构建)将从蓝牙传感器提供所需的跨平台抽象；在内部，Python 和 node 将利用套接字连接的速度来读/写信息。</p><p id="14f5" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">如果你想了解更多关于包装器本身的信息，回购协议是有点自我说明的，结尾的<em class="mo">附录</em>会给你一个很好的高层次概述。如果您只是想开始驾驶，您需要:</p><ul class=""><li id="0712" class="na nb iq lo b lp mp ls mq ko nc ks nd kw ne ll nf ng nh ni bi translated">记下目标车辆的蓝牙设备 id</li><li id="1b28" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">克隆<a class="ae mn" href="https://github.com/jacopotagliabue/anki-drive-python-sdk" rel="noopener ugc nofollow" target="_blank">回购</a></li><li id="daee" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">cd 放入节点文件夹，用<code class="fe on oo op oq b">npm install</code>下载依赖项</li><li id="f2dc" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">cd 放入 python 文件夹，并下载您最喜欢的 Python env <code class="fe on oo op oq b">pip install -r requirements.txt</code>的依赖项(如果有的话)</li><li id="b232" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">启动节点网关<code class="fe on oo op oq b">node node_server.js PORT UUID</code></li><li id="cfdd" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">从你最喜欢的 Python env，运行<code class="fe on oo op oq b">python constant_speed_example.py —-car=UUID</code>并看到车辆移动！</li></ul><p id="40d7" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><em class="mo">(这是我</em> <a class="ae mn" href="https://drive.google.com/file/d/1h1tjzRUQm2BZqDkZn6zhacXShGYioxgU/view" rel="noopener ugc nofollow" target="_blank"> <em class="mo">在一分钟内完成所有这些步骤</em> </a> <em class="mo">，为了方便起见，重用了一个 Python virtualenv)</em></p><p id="ed75" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">我们已经准备好开始我们的第一个四分之一英里！</p><figure class="np nq nr ns gt nt"><div class="bz fp l di"><div class="os om l"/></div></figure><h2 id="a54f" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">我们的第一个四分之一英里</h2><blockquote class="lb"><p id="3895" class="lc ld iq bd le lf lg lh li lj lk ll dk translated">“要么骑要么死，记得吗？”—多米尼克·托雷托</p></blockquote><p id="8bf2" class="pw-post-body-paragraph lm ln iq lo b lp lq jr lr ls lt ju lu ko lv lw lx ks ly lz ma kw mb mc md ll ij bi translated">我们要做的第一件事就是绕着我们的椭圆形轨道匀速跑，比如说，400 毫米/秒(我知道，那是<em class="mo">太慢了</em>)。</p><figure class="np nq nr ns gt nt gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi ot"><img src="../Images/73df25b00e490f804c8cd5c0a1cef355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HUJOdHsPiG9Ih7-rGvcBg.jpeg"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Oval track with piece identifiers (IDs from our kit).</figcaption></figure><p id="7d00" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">(可以用回购中的<code class="fe on oo op oq b">constant_speed_example.py</code>来做同样的事情；轨迹图像取自<a class="ae mn" href="https://github.com/tiker/AnkiNodeDrive/tree/master/images" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="b3f3" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">我们的 Python 应用程序将开始实时打印汽车位置通知，例如:</p><pre class="np nq nr ns gt ou oq ov ow aw ox bi"><span id="9e7a" class="kf kg iq oq b gy oy oz l pa pb">{'location': 17, 'piece': 36, 'offset': 67.5, 'speed': 390, 'self_speed': 400, 'clockwise': 7, 'notification_time': datetime.datetime(2018, 8, 25, 21, 9, 33, 359248), 'is_clockwise': False}</span><span id="fecc" class="kf kg iq oq b gy pc oz l pa pb">{'location': 23, 'piece': 57, 'offset': 67.5, 'speed': 422, 'self_speed': 400, 'clockwise': 71, 'notification_time': datetime.datetime(2018, 8, 25, 21, 9, 32, 229689), 'is_clockwise': True}</span><span id="c46b" class="kf kg iq oq b gy pc oz l pa pb">...</span></pre><p id="e9c1" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><code class="fe on oo op oq b">piece</code>和<code class="fe on oo op oq b">speed</code>都很琐碎(<code class="fe on oo op oq b">speed</code>是车辆记录的速度，<code class="fe on oo op oq b">self_speed</code>是我们命令设定的“理论”速度)，<code class="fe on oo op oq b">offset</code>标识“车道”(见此处的一个直观解释<a class="ae mn" href="https://raw.githubusercontent.com/IBM-Bluemix/node-mqtt-for-anki-overdrive/master/screenshots/offset.jpg" rel="noopener ugc nofollow" target="_blank">，位置是一个增量整数(见此处</a>的一个很好的直观解释<a class="ae mn" href="https://raw.githubusercontent.com/IBM-Bluemix/node-mqtt-for-anki-overdrive/master/screenshots/tracks.jpg" rel="noopener ugc nofollow" target="_blank"><strong class="lo ir">)。</strong></a></p><blockquote class="mu mv mw"><p id="4b64" class="lm ln mo lo b lp mp jr lr ls mq ju lu mx mr lw lx my ms lz ma mz mt mc md ll ij bi translated">我们现在可以走快了吗？我们当然可以，但是在踩油门之前，我们需要解决一个基本问题:我们如何测量跑完一圈需要的时间？当我们梦想改进我们的机器辅助驾驶策略时，我们<strong class="lo ir">需要</strong>一种方法来衡量我们一圈接一圈的速度。</p></blockquote><p id="d2b0" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">即使位置更新没有<em class="mo">那么频繁</em>(因为我们每秒收到 3/4 次通知)，我们也将简单地以 33 分段(起跑线)上两次连续通过之间的时间作为圈速<strong class="lo ir">。</strong>这是在我们的椭圆形跑道上以 400 毫米/秒的速度运行<code class="fe on oo op oq b">lap_time_example.py</code>的输出:</p><pre class="np nq nr ns gt ou oq ov ow aw ox bi"><span id="3cf3" class="kf kg iq oq b gy oy oz l pa pb">time lap in seconds was 9.046201<br/>...<br/>time lap in seconds was 9.029405<br/>...<br/>time lap in seconds was 9.045055<br/>...<br/>time lap in seconds was 9.044495<br/>...</span></pre><p id="4a05" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">虽然有一些差异，但看起来没那么糟糕(SD 0.007)！作为进一步的测试，这是在 800 毫米/秒下的相同程序:</p><pre class="np nq nr ns gt ou oq ov ow aw ox bi"><span id="8be4" class="kf kg iq oq b gy oy oz l pa pb">time lap in seconds was 4.497926<br/>...<br/>time lap in seconds was 4.502276<br/>...<br/>time lap in seconds was 4.497534<br/>...</span></pre><p id="4615" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">还是合理的！作为第一近似值，这就足够了。</p><p id="5d45" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">正如我们刚刚看到的(惊喜惊喜！)，通过提高车辆速度，我们获得了更好的性能(在 800 毫米/秒时，时间几乎正好是 400 毫米/秒时的 1/2)。为什么我们不越走越快呢？嗯，这不是<em class="mo">那么</em>微不足道，因为我们的宇宙很小，但仍然是物理现实的。为了理解我的意思，如果我们以 1000 毫米/秒的速度初始化汽车，会发生这样的情况:</p><figure class="np nq nr ns gt nt"><div class="bz fp l di"><div class="pd om l"/></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Oooops</figcaption></figure><p id="2d90" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">即使是多米尼克·托雷托也不可能转过那个弯(嗯，<a class="ae mn" href="https://www.youtube.com/watch?v=NGeFA2fWzX8&amp;feature=youtu.be" rel="noopener ugc nofollow" target="_blank">也许<strong class="lo ir">他</strong>可能有</a>)！</p><p id="f91d" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">让我们从专业飞行员手册(或者实际上只是常识)中获取一些技巧:我们将写下稍微复杂一点的驾驶政策(参见<code class="fe on oo op oq b">custom_policy_example.py</code>)，如下所示:</p><ul class=""><li id="ed0e" class="na nb iq lo b lp mp ls mq ko nc ks nd kw ne ll nf ng nh ni bi translated">在每个直线段开始时，我们将速度增加到 1000 毫米/秒；</li><li id="b753" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">就在掉头之前，我们将刹车并将速度降低到 800 毫米/秒。</li></ul><figure class="np nq nr ns gt nt gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi ot"><img src="../Images/73adea8edd5f40e6d3f8fa6ac12f58ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xYrXFbVuLHzKtxmpsLdrhQ.jpeg"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Pretty basic, but we need to start somewhere, don’t we?</figcaption></figure><p id="5da1" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">结果在数量上(更快的单圈时间)和质量上都更好:车辆行为现在更加真实:</p><figure class="np nq nr ns gt nt"><div class="bz fp l di"><div class="pd om l"/></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">We’re drifting baby!</figcaption></figure><p id="4430" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">当然，许多其他改进会立即浮现在脑海中，例如以更智能的方式使用车道。</p><blockquote class="mu mv mw"><p id="f2a0" class="lm ln mo lo b lp mp jr lr ls mq ju lu mx mr lw lx my ms lz ma mz mt mc md ll ij bi translated">由于可能的优化是无止境的，如果计算机能解决这个问题，那该多好？ <strong class="lo ir">是的，它会</strong>(也就是说，最终，玩具车如此有趣的全部科学借口)。</p></blockquote><p id="8385" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">在我们的玩具世界里，确实有很多有趣的数据问题可以尝试和提问:</p><ul class=""><li id="b919" class="na nb iq lo b lp mp ls mq ko nc ks nd kw ne ll nf ng nh ni bi translated">给定赛道配置，车辆如何学习最佳“驾驶策略”？这实际上是两个挑战合二为一:学习一项政策并将其推广——如果在一个领域学到的东西可以立即用于另一个看不见的领域，那不是很酷吗？</li><li id="6e32" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">当我们将<em class="mo">其他车辆</em>引入组合时，会有什么变化？例如，我们可以让他们相互竞争，或者我们可以使用第二个工具来学习合作行为(例如避免碰撞)。</li><li id="9865" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">除了赛道配置之外，我们能否以其他变量作为学习过程的条件？例如，我们可以想象通过一个以不同方式实现它们的<em class="mo">汽车</em>接口，从当前库中抽象出转向和制动命令。会有什么变化？</li><li id="b43b" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">使用当前的传感器，车辆能有多智能？正如我们已经看到的位置，传感器是非常基本的，不允许细粒度的控制:我们可以做些什么来更智能地利用我们所拥有的(例如，插值位置？)我们可以轻松添加哪些东西，让我们有更多的玩法(例如带物体识别功能的网络摄像头)？</li><li id="8967" class="na nb iq lo b lp nj ls nk ko nl ks nm kw nn ll nf ng nh ni bi translated">…当然还有更多我们没有想到的！</li></ul><p id="76f5" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">重要的是，我们现在有一个基本的，但功能性的设置来运行实验，并从我们的小型汽车中收集数据。在<em class="mo">第二部</em>中，我们将开始将所有这些工程材料投入使用，并帮助我们为无人驾驶汽车设计越来越智能的行为(剧透:我们将从使用 Mac 键盘手动驾驶<a class="ae mn" href="https://drive.google.com/file/d/1pPGWealQBgCosGAlSewOLw09nUzpqLpE/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">开始)。</a></p><figure class="np nq nr ns gt nt"><div class="bz fp l di"><div class="pe om l"/></div></figure></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><h2 id="cad6" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">附录:回购结构</h2><p id="9d1d" class="pw-post-body-paragraph lm ln iq lo b lp pf jr lr ls pg ju lu ko ph lw lx ks pi lz ma kw pj mc md ll ij bi translated">本教程使用的代码是开源的，拥有 Apache 许可证<a class="ae mn" href="https://www.apache.org/licenses/LICENSE-2.0" rel="noopener ugc nofollow" target="_blank">。请注意，当前的<code class="fe on oo op oq b">master</code>是作为<em class="mo"> alpha </em>发布的，因为它只包含了最基本的东西:没有单元测试，没有花哨的东西，几乎没有对错误的保护，等等..随着实验的进展，我们希望对代码库进行一些改进:非常欢迎反馈和贡献！</a></p><p id="57a6" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">项目结构非常简单，两个主要文件夹包含 node 和 Python 代码:</p><pre class="np nq nr ns gt ou oq ov ow aw ox bi"><span id="811d" class="kf kg iq oq b gy oy oz l pa pb">node_app<br/>    node_socket-app<br/>       node_server.js<br/>    package-lock.json<br/>python_app<br/>    py_overdrive_sdk<br/>        py_overdrive.py<br/>    track_images/<br/>    create_track_image.py<br/>    constant_speed_example.py<br/>    track_discovery_example.py<br/>    custom_policy_example.py<br/>    requirements.txt<br/>.gitignore</span></pre><p id="ebe9" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><code class="fe on oo op oq b">node_server.js</code>是一个服务器扫描和与蓝牙设备聊天的简单节点实现(受<a class="ae mn" href="https://github.com/adessoAG/anki-drive-java/blob/master/src/main/nodejs/server.js" rel="noopener ugc nofollow" target="_blank">这个包装器</a>的启发)。当服务器启动时，<em class="mo"> noble </em>等待蓝牙设备可用，并开始使用 Anki 特征 UUIDs 进行扫描。剩下的代码只是服务器监听来自 Python 的事件并执行蓝牙相关的逻辑:“元命令”带有语法<strong class="lo ir"> COMMAND|PARAM </strong>(例如<strong class="lo ir">CONNECT | ba 0 d6a 19–1bf 6–4681–93da-e 9c 28 F2 b 6743</strong>)，而 car 命令是十六进制字符串，直接发送给车辆(例如<strong class="lo ir"> 03900101 </strong>启用 SDK 模式)。仅供参考，这也是我在 node 中编写的第一个应用程序(所以如果它不工作，那就是我的借口！).</p><p id="76de" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated"><code class="fe on oo op oq b">py_overdrive.py</code>包含<code class="fe on oo op oq b">Overdrive</code>类，该类封装了车辆相关逻辑和来自/去往节点网关的通信。我们利用 Python 线程和队列来处理并发进程，以非阻塞的方式写入、读取和处理位置事件。在初始化时，如果一个函数被提供给构造器，系统将采取定制的动作(“驱动策略”)来响应位置事件(简单的用例见<code class="fe on oo op oq b">custom_policy_example.py</code>)。<code class="fe on oo op oq b">track_discovery_example.py</code>和配套的脚本<code class="fe on oo op oq b">create_track_image.py</code>将让你开始绘制轨道的不同部分，并打印出布局(附注:代码只是一个快速而肮脏的存根，它做出了许多简化的假设)。</p><p id="759b" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">如果你愿意帮忙，repo <code class="fe on oo op oq b">README</code>包含了一个正在进行的改进和实验清单。随时寻求评论、反馈和想法。</p></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><h2 id="514a" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">再见，太空牛仔</h2><figure class="np nq nr ns gt nt gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/59acfbe6cfd588c697bf40f35bc48ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:132/format:webp/1*ZAf6t0J2P2b3RtzoSAlK_A.png"/></div></figure><p id="36f1" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">请继续关注，因为我们将很快带着<em class="mo">第二部分回来。</em>如果您有问题、反馈或评论，请将您的故事分享到<a class="ae mn" href="mailto:jacopo.tagliabue@tooso.ai" rel="noopener ugc nofollow" target="_blank">jacopo . taglia bue @ tooso . ai</a>。</p><p id="218f" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">别忘了在<a class="ae mn" href="https://www.linkedin.com/company/tooso" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>、<a class="ae mn" href="https://twitter.com/tooso_ai" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae mn" href="https://www.instagram.com/tooso_ai/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上获取<a class="ae mn" href="http://tooso.ai/" rel="noopener ugc nofollow" target="_blank"> Tooso </a>的最新消息。</p><h2 id="c5d0" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">感谢</h2><p id="c823" class="pw-post-body-paragraph lm ln iq lo b lp pf jr lr ls pg ju lu ko ph lw lx ks pi lz ma kw pj mc md ll ij bi translated">这将是一个<em class="mo">月</em>的项目，而不是一个周末的项目，没有互联网和互联网上的出色的人分享他们的代码和想法(具体的学分见回购内的链接):就复制+粘贴而言，这个项目确实是首屈一指的。</p><p id="bb16" class="pw-post-body-paragraph lm ln iq lo b lp mp jr lr ls mq ju lu ko mr lw lx ks ms lz ma kw mt mc md ll ij bi translated">当然，如果没有 Anki 让机器人民主化的愿景，这一切都不可能实现。我们第一次发现<a class="ae mn" href="https://www.crunchbase.com/organization/anki" rel="noopener ugc nofollow" target="_blank"> Anki </a>是通过 Cozmo，一个<a class="ae mn" href="https://www.youtube.com/watch?v=xVLFyTTdTPk" rel="noopener ugc nofollow" target="_blank">瓦力般可爱的小机器人</a>和一个奇妙的<a class="ae mn" href="https://www.anki.com/en-us/cozmo/SDK" rel="noopener ugc nofollow" target="_blank"> Python SDK </a> (Cozmo 的可能性使它成为各种周末项目的令人难以置信的游乐场)。虽然我们当然与 Anki <em class="mo"> blah blah 法律事务没有任何关系，但我懒得复制+粘贴 blah blah blah</em>，我们非常喜欢他们的产品。</p></div></div>    
</body>
</html>