<html>
<head>
<title>Convert your XGBoost model into if-else format</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 XGBoost 模型转换成 if-else 格式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/xgboost-deployment-made-easy-6e11f4b3f817?source=collection_archive---------2-----------------------#2018-07-18">https://towardsdatascience.com/xgboost-deployment-made-easy-6e11f4b3f817?source=collection_archive---------2-----------------------#2018-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/6e6e60b6edfe49386b8897b7c13c123b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*757TbEdgVRHMUXrpy_0awg.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">New river, WV, photo by myself</figcaption></figure><div class=""/><p id="47da" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本文中，我将向读者展示如何使用正则表达式的一些技巧将 XGBoost 模型转换成. py 文件。py 文件是“numpy”包。因此，在您训练了 XGB 模型之后，您可以在另一个不需要 XGBoost 包的环境中部署该模型。</p><p id="e639" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当您计划在 AWS lambda 中部署 XGBoost 模型时，这个技巧可以帮助您满足包大小的限制。如果你打算用其他方法(AWS sage maker/Docker+Flask+Nginx……)部署模型，那么这篇文章可能真的帮不了你。</p><p id="ca9c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">本教程分为几个部分:<strong class="ke jg">下载数据并训练模型→将模型转换为. py 文件→使用。py 文件来预测测试数据。</strong></p><h1 id="0a60" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">步骤 0。下载 jupyter 笔记本</h1><p id="265b" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">这本<a class="ae md" href="https://github.com/Shiutang-Li/xgboost_deployment/blob/master/deploy_xgboost.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>包含了下面所有的代码。把它放在你的目标文件夹里。</p><h1 id="a851" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第一步。下载数据并训练模型</h1><p id="3956" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">让我们使用众所周知的<a class="ae md" href="https://www.kaggle.com/c/titanic/data" rel="noopener ugc nofollow" target="_blank">泰坦尼克号数据集</a>来建立一个玩具模型。从链接下载 train.csv 和 test.csv。创建一个子文件夹“/data”并将。csv 在那里。</p><p id="e742" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因为 XGBoost 只接受数字输入，所以让我们跳过分类变量编码，随机选择几个数字列进行建模。</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="3296" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个 XGBoost 模型产生 3 个决策树，每个决策树的最大高度= 3。因为 gamma(分裂次数的惩罚常数)被设置为一个较大的值，所以它可以防止对某些树节点进行分裂。</p><p id="23a4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">决策树看起来像:</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mk"><img src="../Images/9319bf146947aa18dccfb3dc4d65a235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FonZoS_zCnIwc-LbdDa5rw.jpeg"/></div></div></figure><p id="48b8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每个记录的预测得分由“基础得分+所有树的最终叶值”给出。</p><h1 id="ba75" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第二步。将模型转换为. py 文件</h1><p id="91b1" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">在<a class="ae md" href="https://xgboost.readthedocs.io/en/latest/python/python_api.html" rel="noopener ugc nofollow" target="_blank"> XGBoost Python API </a>中，您可以找到允许您将模型作为字符串或. txt 文件转储的函数，或者保存模型以备后用。但是没有 API 将模型作为 Python 函数转储。这里有一个技巧:我们首先将模型作为一个字符串转储，然后使用正则表达式解析这个长字符串并将其转换成一个. py 文件。</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ml"><img src="../Images/18450fd9d15b6d8aef95c38030d9d363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1GTc6EPvoBnN6vf4zzohA.jpeg"/></div></div></figure><p id="245c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">完成这项工作的代码片段:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="c411" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用模型训练中使用的基本分数和训练的模型，我们能够将其转换为. py 模型，该模型只需要“numpy”包(用于缺失值处理)。</p><pre class="me mf mg mh gt mm mn mo mp aw mq bi"><span id="4fa3" class="mr lb jf mn b gy ms mt l mu mv">model_to_py(params['base_score'], model, 'xgb_model.py')</span></pre><p id="fcd7" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">生成的“xgb_model.py”的一部分如下所示:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="4e5b" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第三步。使用。py 文件来预测测试数据。</h1><p id="c280" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我们现在可以导入刚刚创建的 xgb_model.py，执行预测非常简单。</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/7b9d52b008d5c000573aec015fde72bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhouE0Vxe9LYMjhLylJPPA.jpeg"/></div></div></figure><p id="f060" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们将其与 XGBoost 模型产生的预测进行比较。</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/7f26e15a6318861647cbf185936fc13b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_4oVLt_cDART58o6IViqg.jpeg"/></div></div></figure><p id="a6e5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">结果匹配。</p><p id="72c5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">一些警告</strong>:</p><ol class=""><li id="6d3d" class="my mz jf ke b kf kg kj kk kn na kr nb kv nc kz nd ne nf ng bi translated">这些代码在 python 3.5.2 + xgboost 0.6 下运行良好。不保证为其他版本生成正确的结果。</li><li id="44d0" class="my mz jf ke b kf nh kj ni kn nj kr nk kv nl kz nd ne nf ng bi translated">我没有在我的代码中做任何错误处理。</li><li id="862e" class="my mz jf ke b kf nh kj ni kn nj kr nk kv nl kz nd ne nf ng bi translated">的。py 是为给 python 字典打分而设计的，但是您可以做一些小的修改来适应您的用例。</li><li id="3df2" class="my mz jf ke b kf nh kj ni kn nj kr nk kv nl kz nd ne nf ng bi translated">在生成。py 文件，确保没有。目标文件夹中同名的 py 文件。</li></ol></div></div>    
</body>
</html>