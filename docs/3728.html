<html>
<head>
<title>Getting Started With Hive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hive 入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-hive-ad8a93862f1a?source=collection_archive---------5-----------------------#2018-06-12">https://towardsdatascience.com/getting-started-with-hive-ad8a93862f1a?source=collection_archive---------5-----------------------#2018-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dc1dc58cea0e401f5a11db14a58b4bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bhzbdaCfoJ_MyTk_Avf_fA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">[Image [0] (Image courtesy: <a class="ae kc" href="https://wall.alphacoders.com/big.php?i=380565" rel="noopener ugc nofollow" target="_blank">https://wall.alphacoders.com/big.php?i=380565</a>)]</figcaption></figure><p id="47b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇博文的目的是帮助你开始使用 Cloudera Manager 使用 Hive。<strong class="kf ir"> Apache Hive </strong>是一个<a class="ae kc" href="https://en.wikipedia.org/wiki/Data_warehouse" rel="noopener ugc nofollow" target="_blank">数据仓库</a>软件项目，构建在<a class="ae kc" href="https://en.wikipedia.org/wiki/Apache_Hadoop" rel="noopener ugc nofollow" target="_blank"> Apache Hadoop </a>之上，用于提供数据汇总、查询和分析。Hive 给出了一个类似于<a class="ae kc" href="https://en.wikipedia.org/wiki/SQL" rel="noopener ugc nofollow" target="_blank"> SQL </a>的接口来查询存储在与 Hadoop 集成的各种数据库和文件系统中的数据。</p><p id="f361" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你对 R 编程感兴趣，可以看看我的其他文章——<a class="ae kc" rel="noopener" target="_blank" href="/exploratory-analysis-of-fifa-18-dataset-using-r-ba09aa4a2d3c">利用 R </a>和<a class="ae kc" rel="noopener" target="_blank" href="/exploratory-analysis-of-pokemons-using-r-8600229346fb">gg plot ' Em All | Pokemon on R</a>对 FIFA 18 数据集的探索性分析。</p><p id="53cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将首先从莎士比亚开始，通过实现一个简单的字数统计程序来理解工作流程。然后，我们将移动到 MovieLens 数据，并使用 HQL 执行查询。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="261f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动您的 Cloudera 虚拟机。去你的<code class="fe li lj lk ll b">ip:7180.</code></p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/1d7ee0787777779d1e67364ba96c39e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tV1VGoqAvCT71xMiZ3YX9w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Cloudera Manager Console [Image [1]]</figcaption></figure><p id="0886" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用 Hdfs、Hive 和 Yarn。因此，请确保它们正在运行。</p><p id="ab3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们必须创建一个目录来存储我们将在其上运行 wordcount 程序的输入文件。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="5fc0" class="lv lw iq ll b gy lx ly l lz ma"># to view the contents of the root directory on HDFS<br/>hdfs dfs -ls /</span><span id="79bb" class="lv lw iq ll b gy mb ly l lz ma"># create a new directory named 'input' in the HDFS<br/>hdfs dfs -mkdir /input</span></pre><p id="a439" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将看到权限被拒绝，因为 hdfs 用户拥有超级用户(root)权限。我们将在本文后面看到如何对此进行排序。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi gj"><img src="../Images/ba17ed24afae41ce488fdc03233c9c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jLzs-FUkc7un2GJiE61hmA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Permission denied [Image [2]]</figcaption></figure><p id="43c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，下载要进行字数统计的文本文件。我们将使用莎士比亚的作品。下载并解压文件。里面有五个文件。我们今天将使用喜剧文件。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/695fee857ee59c8228ebeb7154824cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*votnmxvA3E6rgRwxNuc8oA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Shakespeare [Image [3]]</figcaption></figure><p id="50fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在本地文件系统中有喜剧文件。我们需要将它转移到<code class="fe li lj lk ll b">/input</code>文件夹中的 hdfs 中。在此之前，我们需要给我们的根用户添加一个文件到<code class="fe li lj lk ll b">/input</code>文件夹的权限。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="0fbd" class="lv lw iq ll b gy lx ly l lz ma"># Give the su permission to root-user<br/>hdfs dfs -chown root:root /input     <br/> <br/>hdfs dfs -ls /</span></pre><p id="a338" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">root 用户现在对<code class="fe li lj lk ll b"> /input</code>文件夹拥有超级用户权限。</p><p id="9fdd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到根用户的状态。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="c2d4" class="lv lw iq ll b gy lx ly l lz ma">exit</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/1cbcd734063806fef723150fb5fe04e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0GQAiuWw0RHtyS4EyTtPg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Chown [Image [4]]</figcaption></figure><p id="9f13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编写一个 SQL 文件来执行字数统计。另存为<code class="fe li lj lk ll b">wordcount.sql</code>。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="d5b8" class="lv lw iq ll b gy lx ly l lz ma">DROP DATABASE IF EXISTS documents CASCADE;</span><span id="d2af" class="lv lw iq ll b gy mb ly l lz ma">CREATE DATABASE documents;</span><span id="4875" class="lv lw iq ll b gy mb ly l lz ma">USE documents;</span><span id="b3ab" class="lv lw iq ll b gy mb ly l lz ma">CREATE TABLE docs(words string);</span><span id="c956" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA LOCAL INPATH '/root/shakespeare' INTO TABLE docs;</span><span id="c4e0" class="lv lw iq ll b gy mb ly l lz ma">CREATE TABLE word_count AS<br/>SELECT word, count(*) AS count FROM<br/>(SELECT explode(split(words, '\\W+')) AS word FROM docs) w<br/>GROUP BY word;</span><span id="f26b" class="lv lw iq ll b gy mb ly l lz ma">SELECT * FROM word_count limit 100;</span></pre><p id="c714" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要对<code class="fe li lj lk ll b">/shakespeare</code>目录的读写权限来运行<code class="fe li lj lk ll b">wordcount.sql</code>程序。成为 hdfs 用户并输入以下命令。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="5b18" class="lv lw iq ll b gy lx ly l lz ma">su - hdfs     # Change user to hdfs from root</span><span id="6201" class="lv lw iq ll b gy mb ly l lz ma">hdfs dfs -chmod -R 777 /shakespeare</span><span id="37ea" class="lv lw iq ll b gy mb ly l lz ma">exit</span></pre><p id="458f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，作为 root 用户，运行以下命令:</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="b421" class="lv lw iq ll b gy lx ly l lz ma">hive -f wordcount.sql</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/86ad8fc3fe0ad0959c28e2da8ce20d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHuPnD0KHKyquQ_d2iT2Kw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Execute Word Count program [Image [5]]</figcaption></figure><p id="380b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您应该会看到如下所示的输出。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/430948ec0dc522129dc7390797668682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUYB-j2rta_Fm-QV_YpVAQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Output [Image [6]]</figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="9c18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将尝试在<a class="ae kc" href="https://grouplens.org/datasets/movielens/1m/" rel="noopener ugc nofollow" target="_blank"> MovieLens </a>数据集上运行 Hive 查询。</p><p id="615f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下载文件。当您看到前几行时，您会注意到该文件由<code class="fe li lj lk ll b">::</code>分隔。将分隔符改为<code class="fe li lj lk ll b">,</code> (csv)。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="1d3e" class="lv lw iq ll b gy lx ly l lz ma">sed -i 's/::/,/g' ml-1m/movies.dat<br/>sed -i 's/::/,/g' ml-1m/users.dat<br/>sed -i 's/::/,/g' ml-1m/ratings.dat</span><span id="df8f" class="lv lw iq ll b gy mb ly l lz ma"># Rename the files from .dat to .csv. Although, it doesn't really # matter. You can leave the files as .dat. I have OCD.</span><span id="1a19" class="lv lw iq ll b gy mb ly l lz ma">mv ml-1m/movies.dat /ml-1m/movies.csv<br/>mv ml-1m/ratings.dat /ml-1m/ratings.csv<br/>mv ml-1m/users.dat /ml-1m/users.csv</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/a18daec36e7ec236f1d03d4edc14da8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JClPe4ac8bJ3RYFaIi1Txg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">MovieLens data [Image [7]]</figcaption></figure><p id="6f3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 hdfs 中创建一个名为<code class="fe li lj lk ll b">movielens</code>的文件夹，并将文件移入其中。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/f32d1b0cf2fee8d7bd776bc5d2f925cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*amTFsDOsdoM2n9iiwFjuSQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">File in hdfs [Image [8]]</figcaption></figure><p id="8ce8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为 hdfs 用户，创建以下文件<code class="fe li lj lk ll b">movies.sql</code>、<code class="fe li lj lk ll b">ratings.sql</code>和<code class="fe li lj lk ll b">users.sql</code>。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="0e0c" class="lv lw iq ll b gy lx ly l lz ma">su - hdfs<br/>nano movies.sql<br/>nano ratings.sql<br/>nano users.sql</span></pre><p id="8955" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要查看<code class="fe li lj lk ll b">movies.csv</code>文件中的数据，在<code class="fe li lj lk ll b">movies.sql</code>文件中复制以下代码并运行命令<code class="fe li lj lk ll b">hive -f movies.sql</code>。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="2177" class="lv lw iq ll b gy lx ly l lz ma">DROP DATABASE IF EXISTS movielens CASCADE;</span><span id="92fa" class="lv lw iq ll b gy mb ly l lz ma">CREATE DATABASE movielens;</span><span id="ed48" class="lv lw iq ll b gy mb ly l lz ma">USE movielens;</span><span id="968e" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE movies (MovieID INT, <br/>Title varchar(60), <br/>Genres varchar(60))</span><span id="18aa" class="lv lw iq ll b gy mb ly l lz ma">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' <br/>LINES TERMINATED BY "\n"<br/>STORED AS TEXTFILE<br/>LOCATION '/movielens/ml-1m/mvs.txt';</span><span id="8135" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/movies.csv' INTO TABLE movies;</span><span id="0d2b" class="lv lw iq ll b gy mb ly l lz ma">SELECT * FROM movies LIMIT 10;</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/4d015bfed6ddf67ca543fd3f68034e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ip17ExcQKXlfuL5qSbXL0Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">First 10 entries in the movies.csv [Image [9]]</figcaption></figure><p id="7f55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要查看<code class="fe li lj lk ll b">ratings.csv</code>文件中的数据，在<code class="fe li lj lk ll b">ratings.sql</code>文件中复制以下代码并运行命令<code class="fe li lj lk ll b">hive -f ratings.sql</code>。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="fde7" class="lv lw iq ll b gy lx ly l lz ma">DROP DATABASE IF EXISTS movielens CASCADE;</span><span id="1432" class="lv lw iq ll b gy mb ly l lz ma">CREATE DATABASE movielens;</span><span id="d908" class="lv lw iq ll b gy mb ly l lz ma">USE movielens;</span><span id="cba2" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE ratings (UserID INT, <br/>MovieID INT, <br/>Rating INT, <br/>Timestamp STRING)</span><span id="9f1d" class="lv lw iq ll b gy mb ly l lz ma">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' <br/>LINES TERMINATED BY "\n"<br/>STORED AS TEXTFILE<br/>LOCATION '/movielens/ml-1m/rts.txt';</span><span id="3246" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/ratings.csv' INTO TABLE ratings;</span><span id="8079" class="lv lw iq ll b gy mb ly l lz ma">SELECT * FROM ratings LIMIT 10;</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/3d751e1b729b040c97de3a3eab8adac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iV1XyN0VlYQw90kgXTUzDw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">First 10 entries in ratings.csv [Image [10]]</figcaption></figure><p id="01fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要查看<code class="fe li lj lk ll b">users.csv</code>文件中的数据，在<code class="fe li lj lk ll b">users.sql</code>文件中复制以下代码并运行命令<code class="fe li lj lk ll b">hive -f users.sql</code>。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="bd73" class="lv lw iq ll b gy lx ly l lz ma">DROP DATABASE IF EXISTS movielens CASCADE;</span><span id="f9d6" class="lv lw iq ll b gy mb ly l lz ma">CREATE DATABASE movielens;</span><span id="d0e0" class="lv lw iq ll b gy mb ly l lz ma">USE movielens;</span><span id="91b8" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE users (UserID INT, <br/>Gender STRING, <br/>Age INT,<br/>Occupation INT, <br/>ZIP INT)</span><span id="c49e" class="lv lw iq ll b gy mb ly l lz ma">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' <br/>LINES TERMINATED BY "\n"<br/>STORED AS TEXTFILE<br/>LOCATION '/movielens/ml-1m/usr.txt';</span><span id="5a74" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/users.csv' INTO TABLE users;</span><span id="6974" class="lv lw iq ll b gy mb ly l lz ma">SELECT * FROM users LIMIT 10;</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/90d08c46e139804e6db8f225df69bab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NYK5sOEuVDPC1oUYs3j-KA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">First 10 entries in users.csv [Image [11]]</figcaption></figure><p id="062d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">十大热门电影。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="a79a" class="lv lw iq ll b gy lx ly l lz ma">DROP DATABASE IF EXISTS movielens CASCADE;</span><span id="6a88" class="lv lw iq ll b gy mb ly l lz ma">CREATE DATABASE movielens;</span><span id="4d09" class="lv lw iq ll b gy mb ly l lz ma">USE movielens;</span><span id="a146" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE movies (MovieID INT, <br/>                              Title varchar(60), <br/>                              Genres varchar(60))</span><span id="0d69" class="lv lw iq ll b gy mb ly l lz ma">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' <br/>LINES TERMINATED BY "\n";</span><span id="d223" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE ratings (UserID INT, <br/>                               MovieID INT, <br/>                               Rating INT, <br/>                               Timestamp STRING)<br/> <br/>ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' <br/>LINES TERMINATED BY "\n";</span><span id="013a" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/movies.csv' <br/>OVERWRITE INTO TABLE movies;</span><span id="afac" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/ratings.csv' <br/>OVERWRITE INTO TABLE ratings;</span><span id="f015" class="lv lw iq ll b gy mb ly l lz ma">SELECT movies.MovieID,movies.Title,COUNT(DISTINCT ratings.UserID) as views<br/>FROM movies JOIN ratings ON (movies.MovieID = ratings.MovieID)<br/>GROUP BY movies.MovieID, movies.Title<br/>ORDER BY views DESC<br/>LIMIT 10;</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/6bb1772bcaa1a1af829823d7b716f468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1N9i4YrHlNku8sLvQCkcg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Top 10 viewed movies [Image [12]]</figcaption></figure><p id="89fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">收视率最高的 20 部电影至少有 40 次观看。</p><pre class="ln lo lp lq gt lr ll ls lt aw lu bi"><span id="9d1f" class="lv lw iq ll b gy lx ly l lz ma">DROP DATABASE IF EXISTS movielens CASCADE;</span><span id="e66d" class="lv lw iq ll b gy mb ly l lz ma">CREATE DATABASE movielens;</span><span id="de4e" class="lv lw iq ll b gy mb ly l lz ma">USE movielens;</span><span id="d77d" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE movies (MovieID INT, <br/>                              Title varchar(60), <br/>                              Genres varchar(60))</span><span id="8624" class="lv lw iq ll b gy mb ly l lz ma">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' <br/>LINES TERMINATED BY "\n";</span><span id="1324" class="lv lw iq ll b gy mb ly l lz ma">CREATE EXTERNAL TABLE ratings (UserID INT, <br/>                               MovieID INT, <br/>                               Rating INT, <br/>                               Timestamp STRING)</span><span id="436b" class="lv lw iq ll b gy mb ly l lz ma">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' LINES TERMINATED BY "\n";</span><span id="19bc" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/movies.csv' OVERWRITE INTO TABLE movies;</span><span id="6f97" class="lv lw iq ll b gy mb ly l lz ma">LOAD DATA INPATH '/movielens/ml-1m/ratings.csv' OVERWRITE INTO TABLE ratings;</span><span id="8a5b" class="lv lw iq ll b gy mb ly l lz ma">SELECT movies.MovieID,movies.Title,AVG(ratings.Rating) as rtg,COUNT(DISTINCT ratings.UserID) as views</span><span id="3f8a" class="lv lw iq ll b gy mb ly l lz ma">FROM movies JOIN ratings ON (movies.MovieID = ratings.MovieID)<br/>GROUP BY movies.MovieID,movies.Title<br/>HAVING views &gt;= 40<br/>ORDER BY rtg DESC<br/>LIMIT 20;</span></pre><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/e1d77e6fed53acbad2351115f6eae917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSPlAZmR2gfG9SBl4i4dUA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Top 20 rated movies. [Image [13]]</figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="dde0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读。希望您发现它对开始使用 Hive 很有用。欢迎提出建议和建设性的批评。:)你可以在<a class="ae kc" href="https://www.linkedin.com/in/akshajverma7/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae kc" href="https://twitter.com/theairbend3r" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上找到我。</p><p id="d9ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击这里查看我的其他博客<a class="ae kc" href="https://medium.com/@theairbend3r" rel="noopener"/>。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><a href="https://www.buymeacoffee.com/theairbend3r"><div class="gh gi mj"><img src="../Images/041a0c7464198414e6ce355f9235099e.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*SGCT6C60o4t58wRqeU2viQ.png"/></div></a></figure></div></div>    
</body>
</html>