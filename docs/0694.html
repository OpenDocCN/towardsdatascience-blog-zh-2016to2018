<html>
<head>
<title>Part 2: Using YouTube’s Python API for Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第 2 部分:将 YouTube 的 Python API 用于数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tutorial-using-youtubes-python-api-for-data-science-part-2-8905f72b5b1a?source=collection_archive---------3-----------------------#2017-06-09">https://towardsdatascience.com/tutorial-using-youtubes-python-api-for-data-science-part-2-8905f72b5b1a?source=collection_archive---------3-----------------------#2017-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9bef" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">执行基于位置的视频查询</h2></div><p id="a3b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lb" href="https://medium.com/towards-data-science/tutorial-using-youtubes-annoying-data-api-in-python-part-1-9618beb0e7ea" rel="noopener">第 1 部分</a>中，我们为 Python 设置了 YouTube API，并学习了如何对视频进行简单的关键字查询。现在，我们想更进一步。</p><p id="1fc6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关键字查询对于探索性分析来说是很棒的，但是它们太宽泛了，不能对我们正在研究的主题做出任何有意义的结论。相反，让我们尝试一项新技术:<strong class="kh ir">地理查询</strong>。</p><h2 id="ee48" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">地理查询</h2><p id="f882" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">当在数据分析或数据科学中使用任何类型的社交媒体时，我们不仅关注“是什么”——识别有趣现象的存在——还关注“在哪里”——发现我们数据行为的地理差异。</p><p id="2717" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们在教程的第 1 部分中看到，显然有一个现象需要研究:人们确实录制并上传了关于坐立不安者的 YouTube 视频(可悲的是)。</p><p id="1b01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果有一些我们没有考虑到的地理差异呢？如果美国东海岸的人比西海岸的人更热衷于坐立不安旋转者的粉丝会怎么样？</p><p id="7970" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 YouTube API 的 location-radius 查询参数，我们可以很容易地研究这个研究问题。这是一个<em class="ma">附加的</em>查询，将返回与我们指定的参数相匹配的视频的纬度和经度。</p><p id="0f17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在我们开始之前，指出位置半径参数的一个主要缺点是很重要的:不是所有的 YouTube 视频都有位置信息。事实上，我敢说大多数人都不知道——这是一个可选功能，用户可以选择激活它。</p><p id="0a9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记住这一点，让我们开始吧！</p><p id="06f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 1)克隆 GitHub 库</strong></p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="5218" class="lc ld iq mg b gy mk ml l mm mn">git clone <a class="ae lb" href="https://github.com/spnichol/youtube_tutorial.git" rel="noopener ugc nofollow" target="_blank">https://github.com/spnichol/youtube_tutorial.git</a><br/>cd mapping_tutorial</span></pre><p id="1007" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您已经完成了本教程的前一部分，您可以跳过这一步，只需将新代码添加到现有文件中。</p><p id="c870" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2)修改</strong> <code class="fe mo mp mq mg b"><strong class="kh ir">youtube_search</strong></code> <strong class="kh ir">功能</strong></p><p id="57f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了执行基于位置的搜索，我们需要向位于<strong class="kh ir"> youtube_videos.py </strong>文件中的<code class="fe mo mp mq mg b">youtube_search</code>函数添加一些额外的参数。这些参数是<strong class="kh ir">位置</strong>和<strong class="kh ir">位置-半径</strong>。</p><p id="be4e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">位置</strong>参数是我们半径中心的纬度和经度，作为字符串传递。例如，如果我们想要搜索位于纽约市 25 公里范围内的 spinners 的视频，那么<strong class="kh ir">位置</strong>参数的值将是“40.730610，-73.935242”。</p><p id="276b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">位置-半径</strong>参数，正如你可能已经猜到的，是半径的大小，以英里或公里为单位(最大为 1000 公里)。在上面的例子中，传递给这个参数的值应该是“25km”。</p><p id="2534" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们将这些作为可选参数添加到<code class="fe mo mp mq mg b">youtube_search</code>函数中。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="764d" class="lc ld iq mg b gy mk ml l mm mn">def youtube_search(q, max_results=50, order="relevance", token=None, location=None, location_radius=None):</span></pre><p id="1512" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以将参数添加到包含在 YouTube Python 库中的<code class="fe mo mp mq mg b">youtube.search().list()</code>方法中。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="9c85" class="lc ld iq mg b gy mk ml l mm mn">def youtube_search(q, max_results=50, order="relevance", token=None, location=None, location_radius=None):<br/>  search_response = youtube.search().list(<br/>    q=q,<br/>    type="video",<br/>    pageToken=token,<br/>    order = order,<br/>    part="id,snippet",<br/>    maxResults=max_results,<br/>   <strong class="mg ir"> location=location,<br/>    locationRadius=location_radius</strong><br/><br/>  ).execute()</span></pre><p id="efb5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，将这些参数添加到函数中实际上不会给我们提供位置信息。它只保证<code class="fe mo mp mq mg b">youtube_search</code>函数返回的视频落在我们指定的半径范围内。烦人…我知道。</p><p id="8f76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 3)创建</strong> <code class="fe mo mp mq mg b"><strong class="kh ir">geo_query</strong></code> <strong class="kh ir">功能</strong></p><p id="4c7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了得到好东西，我们需要使用<em class="ma">另一个</em>T4，但是这次我们将为<code class="fe mo mp mq mg b">part</code>参数传递<strong class="kh ir">记录详细信息</strong>和<strong class="kh ir">统计信息</strong>。我们还需要运行我们的<code class="fe mo mp mq mg b">build</code>函数，让 API 知道我们是谁。</p><p id="63c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简单起见，让我们用一个叫做<code class="fe mo mp mq mg b">geo_query</code>的独立函数来做这件事。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="0e36" class="lc ld iq mg b gy mk ml l mm mn">def geo_query(video_id):<br/>    youtube = build(YOUTUBE_API_SERVICE_NAME, YOUTUBE_API_VERSION, developerKey=DEVELOPER_KEY)<br/><br/>    video_response = youtube.videos().list(<br/>        id=video_id,<br/>        part='snippet, recordingDetails, statistics'<br/><br/>    ).execute()<br/><br/>    return video_response</span></pre><p id="4572" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要运行这个函数，我们向它传递一个视频 ID，它应该返回视频的纬度和经度，以及关于文件的其他有用的详细信息。让我们试一试。</p><p id="d8eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 4)测试我们的</strong> <code class="fe mo mp mq mg b"><strong class="kh ir">geo_query</strong></code> <strong class="kh ir">功能</strong></p><p id="d727" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">继续创建一个新的 Python 文件，我们将在其中编写本教程的其余代码。</p><p id="da7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从导入我们的库开始，设置工作目录并测试我们对<code class="fe mo mp mq mg b">youtube_search</code>函数所做的修改。</p><p id="534f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们执行我在上面使用的纽约市示例查询。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="aa47" class="lc ld iq mg b gy mk ml l mm mn">import sys<br/>sys.path.append('/home/you/youtube_tutorial/')<br/>from youtube_videos import youtube_search<br/>import pandas as pd<br/>import json<br/><br/>test = youtube_search("spinners", location="40.730610, -73.935242", location_radius="50km")</span></pre><p id="fcab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的输出应该与之前的教程没有任何不同——一个带有<strong class="kh ir"> nextPageToken </strong>的元组和我们查询的 JSON 结果。</p><figure class="mb mc md me gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mr"><img src="../Images/c93c6afb0f5b95e18fee7d69f7c8e438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVmKz6awvbPd8Houmqz6lQ.png"/></div></div></figure><p id="3ec8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以真正测试我们的<code class="fe mo mp mq mg b">geo_query</code>函数了。从上面的 JSON 结果中随机选择一个<strong class="kh ir"> videoId </strong>，并将其用作函数的参数。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="c8df" class="lc ld iq mg b gy mk ml l mm mn">geo_test = geo_query('r2GYzQvfARo')</span></pre><p id="c0ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出应该是这样的:</p><figure class="mb mc md me gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/9d66ae8a10995b7f56c07e4651235aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssqaK83_c_DQSOzz68ICtg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Seriously?</figcaption></figure><p id="298f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">酷毙了。如你所见，我们的结果包含了大量的信息，包括纬度和经度。</p><p id="80e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从初始查询开始遍历<strong class="kh ir"> videoIds </strong>，并将它们的纬度和经度存储在一个 dictionary 对象中。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="6db7" class="lc ld iq mg b gy mk ml l mm mn">location_dict = {"youID":[], "lat":[], "lon":[]}<br/>for video in test[1]:<br/>    location_dict['youID'].append((video['id']['videoId']))<br/>    geo = geo_query(video['id']['videoId'])<br/>    location_dict['lat'].append(geo['items'][0]['recordingDetails']['location']['latitude'])<br/>    location_dict['lon'].append(geo['items'][0]['recordingDetails']['location']['longitude'])</span></pre><h2 id="dc3c" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">结论</h2><p id="a5cf" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">现在，您可以开始在未来的数据挖掘项目中整合位置半径功能了。</p><p id="b411" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想了解一个项目可能会是什么样子，看看下面的地图。互动 D3 版本可在<a class="ae lb" href="http://www.spndev.com/youtube_tutorial_part2.html" rel="noopener ugc nofollow" target="_blank">我的网站</a>上获得。我通过对美国 200 个最大的城市进行半径为 25 公里的“旋转”地理查询来收集这张地图的数据</p><p id="5e76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个城市的总数反映了该半径范围内上传的独特视频的数量。我对这些数字如此之小感到有点惊讶…但话说回来，我在现实生活中从未见过坐立不安的人。</p><p id="60b0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读！</p><figure class="mb mc md me gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ne"><img src="../Images/5471d5321f9aa1f1f2cd118006c7a3be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Z_DqRsVM4DKUvNwTYAmOQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Check out the interactive D3 version on <a class="ae lb" href="http://www.spndev.com/youtube_tutorial_part2.html" rel="noopener ugc nofollow" target="_blank">my site</a>.</figcaption></figure></div></div>    
</body>
</html>