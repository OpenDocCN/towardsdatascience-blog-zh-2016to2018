<html>
<head>
<title>The optimal subgroup puzzle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最优子群难题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-optimal-subgroup-puzzle-f3bfd7c3ff0c?source=collection_archive---------6-----------------------#2018-05-12">https://towardsdatascience.com/the-optimal-subgroup-puzzle-f3bfd7c3ff0c?source=collection_archive---------6-----------------------#2018-05-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5ee8707ff0f83ce15023581bb8402a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cg306UgDI9MjsG4c."/></div></div></figure><h1 id="4d61" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">利用机器学习算法的能力来解决不寻常的问题</h1><p id="8271" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如今，随着越来越多的计算机科学家/统计学家/数学家等，许多职业发生了转变。正在进入数据科学的世界。作为一名初级数据科学家，我在他们旅程的开始遇到了很多人，就像我一样。我最近想到，我遇到的许多低年级学生都有一种特定的思维模式，认为如果一个问题不能通过一个已知的模型来解决，那么它很可能是一个主要的问题，他们应该把它留给专业人员。就我个人而言，我认为即使我们作为初级数据科学家所拥有的工具也是极其强大的，我想用我所面临的一个有趣的问题来证明这一点。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="86de" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">我第一次遇到最优子群问题是在广告技术行业工作的时候。我是一名初级数据科学家，我的团队(实际上当时只有我一个人)的职责之一是<strong class="ky ir">分段</strong>过程。简单地说，给定一组描述一个人的特征，我们必须确定这个人是否喜欢鞋子、马、运动等等。但是，尽管我们实现了很高的准确性，并且在某些情况下<strong class="ky ir">我们甚至将特征直接映射到片段</strong>，业务人员对我们的结果并不满意:</p><p id="e629" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated"><em class="mg">“我们不能把一些细分市场卖给广告商，它们没有市场吸引力”。</em></p><p id="c85d" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">他们进一步解释说，虽然他们完全信任我们的细分系统，但他们不能出售<em class="mg">体育迷</em>细分市场，例如，如果其中包含 70%的女性。<em class="mg">“如果细分市场的统计数据对广告商没有意义，他们就不会购买”</em>。</p><p id="c9e0" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">那么我们如何处理这个问题呢？让我们继续以<em class="mg">体育迷</em>为例:我们有许多个人的自我报告数据，所以我们对自己的标签非常有信心。问题是，我们的数据分布与人口分布不同，这意味着我们的男女比例(或任何其他比例)可能与现实世界不同。例如，根据我们的数据和维基百科，让我们看看美国的<em class="mg">年龄</em>分布:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/782bd2117adf7cfef63700861b6fdae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W37PVtADTRz6LzaMTxKUIQ.png"/></div></div></figure><p id="97d1" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">很明显，我们的数据分布不同。此外，我们还在这张图上看到了坏数据的影响，因为我们知道的 55 岁以上的人比维基百科多大约 1500 万是极不可能的。无论如何，问题就在那里，它不仅与年龄有关，还与性别、收入和其他许多特征有关。因此，为了继续使用我们的细分模型，<strong class="ky ir">和</strong>满足业务需求，我们需要解决最优子组问题:</p><blockquote class="mm"><p id="d5c4" class="mn mo iq bd mp mq mr ms mt mu mv lt dk translated"><strong class="ak"> <em class="mw">给定一组数据点 G，其在特征集 F 上具有分布 P，找出最大的子组 G’，其在 F 上具有想要的分布 P’</em></strong></p></blockquote><p id="f018" class="pw-post-body-paragraph kw kx iq ky b kz mx lb lc ld my lf lg lh mz lj lk ll na ln lo lp nb lr ls lt ij bi translated">请记住，<em class="mg"> G' </em>的大小直接影响<em class="mg"> P' </em>。有可能某个<em class="mg"> G' </em>会和<em class="mg"> P' </em>完全匹配，但是如果这个同一个<em class="mg"> G' </em>包含五个人，那么我们就真的卖不掉这个组了，不是吗？</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="5d96" class="jy jz iq bd ka kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv bi translated">那么我们如何解决这个问题呢？</h1><p id="8df7" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们面临的问题没有直接的“scikit-learn-implemented”解决方案。<strong class="ky ir">但是，使用我们的数据科学工具箱中的基本但令人惊叹的工具，可以打造出一个优雅的解决方案。</strong>让我们想想最优解:如果我们有一只知道最优解的小鸟，那么它可以告诉我们每个人是否被包括在<em class="mg">G’</em>中。所以也许，我们可以把这个问题转化成一个更简单的二进制分类问题。由于最终我们想要优化<em class="mg">G’</em>，选择逻辑回归似乎是很自然的，它使用梯度下降来找到最小化误差的解决方案。</p><p id="3254" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">问题是<strong class="ky ir">我们的数据没有标注</strong>，所以我们必须定义一个符合我们需求的损失函数。我们这样定义损失函数:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ef3db8ac1d155f09e8f1656da98fd24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*eW4vA6RwYKimXdIr3kCglg.png"/></div></figure><p id="eda9" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">为什么我们不把这两种误差加起来呢？这是因为从商业角度来看，我们更喜欢比细分市场规模更高的比率准确性。对于上面的公式，如果片段大小误差很小，损失函数仍然取决于特征比率误差。另一方面，如果特征比率误差很小，损失函数将不会受到片段大小误差的太大影响。</p><p id="e83a" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">现在让我们使用 MSE 估计量来定义单个误差:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/867919242243a31b05f349fe849bb562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNMYwsVdADrGnbfefvjbEQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">The definition for segment-size-error</figcaption></figure><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/07d738fbee1af5b6899abea3e7ff96cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRsjDQjnlySLMcFaSXAjOQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">The definition for feature-ratios-error</figcaption></figure><p id="893f" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">我们将像一般回归模型一样进行:首先，我们将使用一组权重来计算谁在<em class="mg">G’</em>中。然后，我们将使用误差导数来更新同一组权重。但是在我们继续之前，让我们考虑一下我们想要处理的数据的结构。正确的功能将有助于加快计算速度，并扩展矢量化的使用，您将在接下来看到这一点。</p><p id="0222" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">我们处理了我们的输入数据，<em class="mg"> X </em>，<em class="mg"> </em>，以便在其他特征中，它还将包括<em class="mg"> F </em>中所有特征的二进制形式，这些特征是我们试图优化分布的特征。例如，特征<em class="mg">年龄</em>被分成我们关心分布的桶:即<em class="mg">年龄 _18_24 </em>、<em class="mg">年龄 _25_30 </em>等……(一热编码)。再比如:特征<em class="mg">性别</em>被转化为二元特征<em class="mg">是 _ 男</em>。</p><p id="d1c5" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">为什么我们需要这些二进制特性？因为它们让我们可以很容易地计算出想要的比率，而且很快。假设我们有标签向量<em class="mg"> y </em>，那么计算每个特征比率就简化为这种矢量化形式:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/47e4e1b15562996b327299be495fc4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*1oIPshnHbTT6jgQb0QYnGQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">X at feature represents the feature column in X</figcaption></figure><p id="a141" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">我们如何得到标签向量，<em class="mg"> y </em>？类似于逻辑回归模型:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/e24491fcd0b6c9c3cff9493a3348cd73.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*iKTzBxUjCFJIKUGqTfQruQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">For person i, y is the logistic function applied to f(w)</figcaption></figure><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/31fe3dc3fd05c0491ce0d6192a68dd83.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*LNd0O5kOISKZbdsDzA5cMg.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">f(w) gives each person a “score” based on his/her features</figcaption></figure><p id="85a8" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">最后，我们准备好找到我们的重量！</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="c025" class="jy jz iq bd ka kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv bi translated">计算误差导数</h1><p id="c25b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们对权重向量<em class="mg"> E_total </em> w.r.t，<strong class="ky ir">T3】wT5】求导:</strong></p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/3e098f9021a4143fc9251b85f8643baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*0O9qThHvyh-OJ09di7xPpQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">E = Error, t = total, f = feature-ratios, s = segment-size</figcaption></figure><p id="a881" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">段大小误差导数真的很简单，这里就不描述了。我仍然想展示特征比误差导数，因为它可以使用我们的二元特征很好地矢量化。根据商法则，特定特征<em class="mg"/><em class="mg"/>对所有数据点<em class="mg"> i </em>的特征比率误差的导数等于:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/0469629614690ef4408060e3bc0d12f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*Zj6lCK0L8JUThgeVRLNhjA.png"/></div></figure><p id="4e1d" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">如果我们定义:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c5310e925cd33361010a2287e4b4c047.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*UKrJDGRBgTEgCLmMSDD2gg.png"/></div></figure><p id="c99f" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">我们得到导数(w.r.t 特性<em class="mg"> a </em>)等于:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/bb0f27a020457579e52feebdf6317bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*T8402C_5GiiG0i99tIUDoQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">The feature-ratio error derivative for specific feature a. The sums are over all data points.</figcaption></figure><p id="2726" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">这真的很酷，但事实上，这可以进一步矢量化，如果我们用<em class="mg"> X </em>替换特征<em class="mg"> a </em>处的<em class="mg"> X </em>以及我们关心的所有特征<em class="mg"> F </em> 。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="1f67" class="jy jz iq bd ka kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv bi translated">结果</h1><p id="2e59" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">所以当我们开始这个项目的时候，我们没有定义一个片段大小的错误。这导致该部分的人数下降了近一半，但比率看起来很大:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/9ce76ef0e01690fffe0b93cff0daf7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*e1c0KlK_BeGCBzLYLpjnyw.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">The first run of the algorithm, no segment-size error was defined.</figcaption></figure><p id="e353" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">根据这些结果，我们将片段大小误差添加到特征比率误差，并得到这些数字:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7aeb028364f429bb0898a7884ed5bc23.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*06tUeYoaANN7pDbXL7j41w.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Too many people, feature-ratios accuracy dropped sharply</figcaption></figure><p id="6482" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">这显然太咄咄逼人了。最后，我们想出了上面给出的公式，并得到了这些结果，在质量和数量之间找到了一个平衡点:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1aa8cf407eaff5c6360ae84ca9eee2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*g1h97id29Bw5-jL5h1CQJQ.png"/></div></figure><p id="cab1" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">所有结果中值得注意的一点是，该算法是如何与年轻人和老年人进行斗争的。我们的数据分布高度偏向老年人，这在结果中可以清楚地看到。但是，嘿，商业人士对我们从扭曲的数据中得到的比率很满意，我们在 <strong class="ky ir">不到一分钟就在 20 万人身上<strong class="ky ir">收敛了！</strong></strong></p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="ed89" class="pw-post-body-paragraph kw kx iq ky b kz mb lb lc ld mc lf lg lh md lj lk ll me ln lo lp mf lr ls lt ij bi translated">总而言之，我看到初级数据科学家坚持已知和已实现的东西。这显然不坏，但是不要害怕使用你所拥有的工具来解决不重要的问题，它可能会起作用！</p></div></div>    
</body>
</html>