<html>
<head>
<title>How to create interactive map plots with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Plotly 创建交互式地图绘图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-interactive-map-plots-with-plotly-7b57e889239a?source=collection_archive---------5-----------------------#2018-10-17">https://towardsdatascience.com/how-to-create-interactive-map-plots-with-plotly-7b57e889239a?source=collection_archive---------5-----------------------#2018-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/21533cbd6d86a14ce82c26b83c68c3c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TqOdD69beJCKxxTi"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">“brown wooden map board” by <a class="ae kc" href="https://unsplash.com/@iambrettzeck?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brett Zeck</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e688" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">毫无疑问，我最喜欢处理数据的一部分是创建可视化。图像是传达信息的最佳工具:它们是即时的，事实上大脑处理它们的速度比文字快几千倍。图像也是普遍的，它们会在我们的脑海中停留更久。最后，我们是懒惰的动物，因此我们更注重视觉效果，而不是文字。有多少次你遇见一个新的人，然后你努力记住他们的名字，而他们的脸却清晰地浮现在你的脑海里？</p><p id="b3e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我在学术界做研究员时，我意识到我是多么喜欢创造视觉效果:尽管我喜欢进行实验和数值模拟，但我真的很期待项目的那一刻，那时我将能够处理我所有的发现，并创建那些漂亮而强大的图表。是的，我还必须写论文来描述所有的过程，工作流程和研究背后的理论推理，但是能够用很少的图像来交流几个月的工作真是不可思议！所有这些介绍都是为了让你相信图像是重要的，如果你还不这么认为的话。尤其是对于一名数据科学家来说，他需要不时高效地向非技术受众传达信息。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="71c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在过去的一周左右的时间里，我一直在处理我的关于美国风暴事件的顶点项目，同时处理包含地理空间信息的约 11，000 个观测数据。我的第一个想法是将所有这些数据绘制在地图上，这样我就可以一眼看出哪些区域最容易受到此类事件的影响。由于我使用的是 Python，Geopandas 将是最直接的选择，但是，我想要更具交互性的库。如果我想改变地图的样式怎么办？或者，如果我只想看到雷暴或冰雹呢？我做了一点研究，发现 plotly 正是我所需要的。我找不到任何好的教程来指导我完成这个过程，所以我在网上看了一些例子，试图通过大量的试验和错误来推断性地理解这是如何工作的。这就是我决定写这篇文章的原因，同时我正在为同一个项目训练一批神经网络，当所有这些纪元来来回回时，我有空闲时间。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><blockquote class="li lj lk"><p id="f30f" class="kd ke ll kf b kg kh ki kj kk kl km kn lm kp kq kr ln kt ku kv lo kx ky kz la ij bi translated">注意:要做我将要描述的事情，你需要一个与<a class="ae kc" href="https://plot.ly/#/" rel="noopener ugc nofollow" target="_blank"> plotly </a>以及<a class="ae kc" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank"> mapbox </a>的账户。特别是因为你需要一个访问令牌，可以在这里<a class="ae kc" href="https://www.mapbox.com/account/access-tokens" rel="noopener ugc nofollow" target="_blank">创建</a>，还需要一个用户名和 API 密匙，可以在这里<a class="ae kc" href="https://plot.ly/settings/api#/" rel="noopener ugc nofollow" target="_blank">生成</a>。这一切都是免费的。我还建议您非常精通 Python 字典，因为正如您将注意到的，它们是创建这样的地图图的基础。</p></blockquote><p id="5f8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我从国家气候数据中心收集了从 2000 年至今美国风暴事件的数据。像往常一样，我不得不做大量的清理工作，处理丢失的数据，设计一些功能。在这个<a class="ae kc" href="https://github.com/emmagrimaldi/Capstone_Predicting_Storm_Damages/blob/master/all_storms.csv" rel="noopener ugc nofollow" target="_blank">链接</a>你可以找到。csv 文件用于此目的，并为我的顶点项目一般。这些数据包含了这种现象的纬度和经度信息，这对于我们在地图上绘图是非常重要的。它还显示了是否是雷暴、冰雹、山洪爆发等总共七个不同的类别。风暴事件的强度、所处的状态以及发生的时间</p><p id="498a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在实际绘制之前，我们需要导入和分配一些东西。这里我们需要来自 Mapbox 的访问令牌，以及来自 Plotly 的用户名和 api 密钥。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e5f3" class="ly lz iq lu b gy ma mb l mc md">import plotly.plotly as py<br/>import plotly.graph_objs as go<br/>import plotly<br/>import pandas as pd</span><span id="02ae" class="ly lz iq lu b gy me mb l mc md"># setting user, api key and access token<br/>plotly.tools.set_credentials_file(username='your_username_here', api_key='your_api_key_here')<br/>mapbox_access_token = 'your_access_token_here'</span></pre><p id="60ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了生成我们的图，我们将需要两样东西:<em class="ll">数据</em>和<em class="ll">布局</em>。我们的变量<em class="ll">数据</em>将是七个字典的列表(每个事件类型一个)，其中每个字典包含纬度和经度值，以及风暴类型的名称和绘图的标记特征。变量<em class="ll">布局</em>是一个字典，包含了与数据没有直接联系的图像相关的所有内容:下拉菜单、注释、我们想要如何格式化它们以及我们想要将它们放置在哪里。</p><h1 id="c49c" class="mf lz iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">数据</h1><p id="169b" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">在读取数据帧并将其分配给一个<code class="fe nh ni nj lu b">df</code>变量后，我创建了一个包含七种不同风暴类别名称的列表，并将其命名为<code class="fe nh ni nj lu b">event_types</code>。我遍历了这个列表，并使用它来过滤数据帧，为每种事件类型创建一个字典，并将其附加到<em class="ll">数据</em>列表。这样我就有了我的字典清单，<em class="ll">数据</em>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">creating the <em class="nm">data</em> variable.</figcaption></figure><p id="8724" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将标记的不透明度值指定为 0.5 的原因是，最有可能的是，有些区域的点数比其他区域多。赋予这些点某种透明度，将允许我们在地图上看到相同颜色的不同色调，对应于不同地区相同现象的不同频率。</p><p id="355e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经完成了<em class="ll">数据</em>，现在轮到<em class="ll">布局</em>，这无疑需要更多的工作。</p><h1 id="0bd4" class="mf lz iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">布局</h1><p id="9d98" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">我们来设置一下地图的基本设置。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Initializing the map layout.</figcaption></figure><p id="6415" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以开始在地图上添加一些东西来定制它，并按照我们喜欢的方式进行交互。</p><h2 id="1770" class="ly lz iq bd mg nn no dn mk np nq dp mo ko nr ns ms ks nt nu mw kw nv nw na nx bi translated">布局['批注']</h2><p id="5713" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">假设我想放一个上面有白色文本的黑框，指定我的点仅代表从 2000 年至今造成超过 50k 美元经济损失的风暴事件。像这样的一些静态提示，将落在<em class="ll">布局</em>字典的<em class="ll">注释</em>键下:对应于<em class="ll">注释</em>的值将需要是一个字典列表，在这个特定的例子中，一个只包含一个字典的列表，因为我想在我的地图上只放置一个注释。文字上看似繁琐，但做起来绝对比解释容易。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Annotation on the map.</figcaption></figure><p id="111a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在是下拉菜单的时候了，它需要被分配给<em class="ll">布局</em>字典的<em class="ll">更新菜单</em>键。</p><h2 id="a12e" class="ly lz iq bd mg nn no dn mk np nq dp mo ko nr ns ms ks nt nu mw kw nv nw na nx bi translated">布局['updatemenus']</h2><p id="4a24" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">我想添加两个下拉菜单:一个选择要可视化的风暴事件的类型，以防我们只想查看类型而不是所有类型，而另一个下拉菜单将允许我们更改背景上的地图类型，默认情况下是暗的。可用地图的名称和样式可以在 Mapbox 上找到。</p><p id="e21f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每一个下拉菜单都是通过一个字典重新定义的，所有这些字典都将包含在一个列表中，我们将分配给<code class="fe nh ni nj lu b">layout['updatemenus']</code>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Adding drop-down menus to the map.</figcaption></figure><h2 id="418e" class="ly lz iq bd mg nn no dn mk np nq dp mo ko nr ns ms ks nt nu mw kw nv nw na nx bi translated">布局['标题']</h2><p id="cb2b" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">如果需要，您可以轻松地为您的地块指定标题。我这样做只是通过做<code class="fe nh ni nj lu b">layout['title'] = 'Storm Events'</code>。</p><h1 id="a721" class="mf lz iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">生成剧情！</h1><p id="0ccc" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">一旦我们将<em class="ll">数据</em>和<em class="ll">布局</em>整理好，我们就可以通过运行以下命令来生成图表:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c686" class="ly lz iq lu b gy ma mb l mc md">figure = dict(data = data, layout = layout)<br/>py.iplot(figure, filename = 'put_your_name_here')</span></pre><p id="ad33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧啊！</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ny nl l"/></div></figure><p id="adb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以放大、缩小，从顶部菜单中选择您想要可视化的内容，并从底部菜单中更改地图类型。相当酷！我期待着像这样的其他一些情节，现在我学会了如何去做。希望您发现这也很有用！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/e617ba7ebe3f3cc33ed5ad510738322e.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*-3XTARCS1twqTj73tB78wg.png"/></div></figure><p id="c737" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请随意查看:</p><p id="f01f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://github.com/emmagrimaldi/Capstone_Predicting_Storm_Damages/blob/master/Capstone_interactive_plot.ipynb" rel="noopener ugc nofollow" target="_blank">这个代码的 Github 库</a></p><p id="b6ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://medium.com/@emmagrimaldi" rel="noopener">我的其他中帖。</a></p><p id="e83a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的 LinkedIn 个人资料。</p><p id="4fe9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">感谢您的阅读！</strong></p></div></div>    
</body>
</html>