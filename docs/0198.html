<html>
<head>
<title>Twitter Sentiment Analysis on Car Brands</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">汽车品牌的推特情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/twitter-sentiment-analysis-on-car-brands-c13d449eb9fc?source=collection_archive---------2-----------------------#2017-03-27">https://towardsdatascience.com/twitter-sentiment-analysis-on-car-brands-c13d449eb9fc?source=collection_archive---------2-----------------------#2017-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="18ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Twitter 数据是一个丰富的来源，可以用来获取任何可以想象的话题的信息。这些数据可用于不同的用例，例如寻找与特定关键字相关的趋势、测量品牌情感以及收集关于新产品和服务的反馈。</p><p id="3d2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将从 twitter 中提取各种汽车品牌的数据。然后，我们将应用情感分析来了解在最近一段时间内，人们对不同汽车品牌的正面/负面看法。情感分析是确定一条内容是正面的、负面的还是中性的过程。这也被称为意见挖掘，得出一个发言者的意见或态度。这项技术的一个常见用例是发现人们对某个特定话题的感受。在我们的例子中，我们使用最近推文中的文字来发现人们对不同汽车品牌的感受。</p><p id="6685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现这篇<a class="ae kl" href="http://adilmoujahid.com/posts/2014/07/twitter-analytics/" rel="noopener ugc nofollow" target="_blank">文章</a>和这段<a class="ae kl" href="https://pythonprogramming.net/twitter-api-streaming-tweets-python-tutorial/?completed=/mysql-live-database-example-streaming-data/" rel="noopener ugc nofollow" target="_blank">视频</a>有助于弄清楚如何从 twitter api 中提取、过滤和处理数据。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="7a9a" class="kv kw iq kr b gy kx ky l kz la">#Import the necessary methods from tweepy library<br/>from tweepy import Stream<br/>from tweepy import OAuthHandler<br/>from tweepy.streaming import StreamListener<br/>import time</span><span id="e8ac" class="kv kw iq kr b gy lb ky l kz la">#Variables that contain the user credentials to access Twitter API<br/>#(Note: replace with your own values from <a class="ae kl" href="https://apps.twitter.com/" rel="noopener ugc nofollow" target="_blank">https://apps.twitter.com/</a>)<br/>consumer_key="consumer key"<br/>consumer_secret="consumer secret"<br/>author_token="author token"<br/>author_secret="author secret"</span><span id="d034" class="kv kw iq kr b gy lb ky l kz la">class listener(StreamListener):</span><span id="063f" class="kv kw iq kr b gy lb ky l kz la">#This is a basic listener that just prints received tweets<br/>def on_data(self, data):<br/>   try:<br/>     #writing data to file<br/>     saveFile = open('tweetDBcars.csv','a')<br/>     saveFile.write(data)<br/>     saveFile.close()<br/>     return(True)<br/>   except BaseException, e:<br/>     print 'failed ondata,',str(e)<br/>     time.sleep(5)</span><span id="fabd" class="kv kw iq kr b gy lb ky l kz la">def on_error(self, status):<br/>        print status</span><span id="37c8" class="kv kw iq kr b gy lb ky l kz la">auth = OAuthHandler(consumer_key, consumer_secret)<br/>auth.set_access_token(author_token, author_secret)</span><span id="b42f" class="kv kw iq kr b gy lb ky l kz la">twitterStream = Stream(auth, listener())</span><span id="ac58" class="kv kw iq kr b gy lb ky l kz la"># getting tweets that have any of these words<br/>twitterStream.filter(track=['car' <br/> 'chevy','ford','toyota',<br/>    'acura','kia','audi',<br/>    'chrystler','dodge','ferrari'<br/>    'fiat','buick','cadillac','chevrolet',<br/>    'bmw','honda','jeep','lexus','mazda',<br/>    'mini','nissan','tesla''volvo','saab','porshe'])</span></pre><p id="7f43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我让这个脚本运行了 6 天，累积了大约 115，000 条推文。Twitter api 在类似于 python 字典的 json 数据结构中为我们提供了关于每条 tweet 的大量数据。我们对 tweet 本身的内容感兴趣，可以通过键[“text”]访问它。</p><p id="9c5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在处理大型数据集时，在 try/except 子句中捕获 tweet = json.loads(line)语句非常重要。尽管从 Twitter api 返回的数据通常是干净的，但可能会有错误，如果遇到一行坏数据，您希望避免破坏脚本。try/except 子句允许脚本跳过一行坏数据，继续处理剩余的 tweets。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="d4fc" class="kv kw iq kr b gy kx ky l kz la">tweets_data_path = 'twitDBcars.csv'</span><span id="8c71" class="kv kw iq kr b gy lb ky l kz la">tweets_data = []<br/>tweets_file = open(tweets_data_path, "r")<br/>for line in tweets_file:<br/>    try:<br/>        tweet = json.loads(line)<br/>        tweets_data.append(tweet)<br/>    except:<br/>        continue</span></pre><p id="2933" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们用微博创建一个熊猫数据框架</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="9842" class="kv kw iq kr b gy kx ky l kz la">tweets = pd.DataFrame()</span><span id="762c" class="kv kw iq kr b gy lb ky l kz la">index = 0<br/>for num, line in enumerate(tweets_data):<br/>  try:<br/>     print num,line['text']<br/>     tweets.loc[index,'text'] = line['text']<br/>     index = index + 1 <br/> except:<br/>     print num, "line not parsed"<br/>     continue</span></pre><p id="0038" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了提取关于特定品牌的推文，我们将每条推文中的单词与我们感兴趣的每个品牌的名称进行比较。如果我们找到了我们正在寻找的品牌，我们会在数据框中的新列“品牌名称”中对其进行跟踪。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="d195" class="kv kw iq kr b gy kx ky l kz la">def brand_in_tweet(brand, tweet):<br/>    brand = brand.lower()<br/>    tweet = tweet.lower()<br/>    match = re.search(brand, tweet)<br/>    if match:<br/>        print 'Match Found'<br/>        return brand<br/>    else:<br/>        print 'Match not found'<br/>        return 'none'</span></pre><p id="f181" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是评估每条推文的情绪。有几种方法可以进行情感分析。</p><p id="c320" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从业者最常描述的有两种方法:</p><ul class=""><li id="0d80" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">一种方法是收集一堆推文，让人们给它们贴上积极或消极的标签。然后使用已标记的数据集来训练算法，如朴素贝叶斯或随机森林。然后，训练好的模型可以用于新的数据，以估计情绪。</li><li id="ae67" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">第二种方法是使用词典，我们将推文中的单词与词典中的单词(或 n-grams)进行比较，以对每个单词的积极/消极情绪进行评分。然后，我们将每条推文的单词分数相加，得出推文的情感分数。</li></ul><p id="a35f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本帖中，我们将通过使用 TextBlob 包来使用第二种方法。我们使用 TextBlob 的极性方法来查找每条推文的情感得分，并将其记录在 dataframe 中的新列“sentscore”中。(关于 TextBlob 如何计算情感得分的更多详细信息，请点击查看<a class="ae kl" href="http://textblob.readthedocs.io/en/latest/advanced_usage.html#sentiment-analyzers" rel="noopener ugc nofollow" target="_blank">。)</a></p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="fc33" class="kv kw iq kr b gy kx ky l kz la">from textblob import TextBlob</span><span id="4824" class="kv kw iq kr b gy lb ky l kz la">for index, row in tweets.iterrows():<br/>    temp = TextBlob(row['text'])<br/>    tweets.loc[index,'sentscore'] = temp.sentiment.polarity</span></pre><p id="c048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢使用 ggplot 进行数据可视化，因为它强大而灵活，所以我将把数据帧写入一个 csv 文件，该文件可以导入到 r。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="4083" class="kv kw iq kr b gy kx ky l kz la"><br/>for column in tweets.columns:<br/>    for idx in tweets[column].index:<br/>        x = tweets.get_value(idx,column)<br/>        try:<br/>            x = unicode(x.encode('utf-8','ignore'),errors ='ignore')          <br/>            if type(x) == unicode:<br/>                unicode(str(x),errors='ignore')<br/>            else: <br/>                df.set_value(idx,column,x)<br/>        except Exception:<br/>            print 'encoding error: {0} {1}'.format(idx,column)<br/>            tweets.set_value(idx,column,'')<br/>            continue<br/>tweets.to_csv('tweets_export.csv')</span></pre><p id="c777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们读取 R 中的数据，并直观地检查这些数据</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="7ae5" class="kv kw iq kr b gy kx ky l kz la">df_tweets = read.csv("tweets_export.csv")</span><span id="79e5" class="kv kw iq kr b gy lb ky l kz la">#let us look at the mean of sentiment scores for all brands<br/>data_brand = df_tweets %&gt;%<br/>   group_by(brand) %&gt;%<br/>   summarise(mean_sentiment_score = mean(sentscore))</span><span id="6b6b" class="kv kw iq kr b gy lb ky l kz la">ggplot(data=data_brand, aes(x=brand, y=mean_sentiment_score))+<br/>  geom_bar(stat = "identity", aes(fill = brand))</span></pre><figure class="km kn ko kp gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lq"><img src="../Images/e5d382df969271116cab1548740fe876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*awPo2zKEEBdWYQSC5esGbg.jpeg"/></div></div></figure><p id="7589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们注意到雷克萨斯的正面喜好度最高，丰田的负面喜好度最高。假设我们代理的客户是一家汽车经销商，他们想决定增加对哪些品牌的投资，这种从经销商身边的人那里收集的信息可能非常有用。</p><p id="7b44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们更仔细地研究 3 个品牌:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="cae5" class="kv kw iq kr b gy kx ky l kz la">#We subset the data for the brands ford, mini and kia to drill down into the variance of their sentiment over time</span><span id="e18b" class="kv kw iq kr b gy lb ky l kz la">data_week &lt;- df_tweets[df_tweets$brand %in% c("ford","mini","kia"),]</span><span id="5e01" class="kv kw iq kr b gy lb ky l kz la">ggplot(aes(x = day, y = sentscore), data = data_week) + <br/>  geom_smooth(aes(colour = brand))</span></pre><figure class="km kn ko kp gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ly"><img src="../Images/7d5fd0f12329bc87bdd3292cb1e1e72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Itmm16am980SbXkxhtgUMA.jpeg"/></div></div></figure><p id="ba63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着时间的推移，起亚的正面喜好度有所上升，而福特的正面喜好度有所下降。假设我们是一家咨询公司，福特是我们的客户之一，我们需要进一步挖掘细节，以了解为什么积极情绪正在减少。</p><p id="9af5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是非常初步的分析。为了实现情感分析的高准确度，需要考虑几个因素，例如语言、领域、人口、年龄、俚语、词汇分析等。脸书和 AOL 面临的一些挑战和采取的方法分别在<a class="ae kl" href="https://www.youtube.com/watch?v=y3ZTKFZ-1QQ" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae kl" href="https://vimeo.com/24005684" rel="noopener ugc nofollow" target="_blank">这里</a>讨论。我希望在不久的将来进一步研究这一分析。</p><p id="19f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同一主题的其他重要资源:</p><ol class=""><li id="6bd2" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lz li lj lk bi translated"><a class="ae kl" href="https://blogs.ischool.berkeley.edu/i290-abdt-s12/" rel="noopener ugc nofollow" target="_blank">用 twitter 分析大数据</a> —来自伯克利分校的视频和幻灯片——由来自 twitter 的员工演示的讲座。</li><li id="f99b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lz li lj lk bi translated"><a class="ae kl" href="http://districtdatalabs.silvrback.com/modern-methods-for-sentiment-analysis" rel="noopener ugc nofollow" target="_blank">分析推文中表情符号的情感</a></li><li id="3fa2" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lz li lj lk bi translated"><a class="ae kl" href="https://www.ravikiranj.net/posts/2012/code/how-build-twitter-sentiment-analyzer/" rel="noopener ugc nofollow" target="_blank">如何构建 twitter 情感分析器</a></li><li id="677f" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lz li lj lk bi translated"><a class="ae kl" href="https://marcobonzanini.com/2015/03/02/mining-twitter-data-with-python-part-1/" rel="noopener ugc nofollow" target="_blank">用 python 挖掘 twitter 数据</a>(图书)</li><li id="a1d8" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lz li lj lk bi translated">twitter 用户对薄荷烟的看法:内容和情感分析(研究论文)</li></ol><p id="652e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的其他项目很少在<a class="ae kl" href="https://deepthimo.github.io/" rel="noopener ugc nofollow" target="_blank">这里</a></p></div></div>    
</body>
</html>