<html>
<head>
<title>How to deploy a Machine Learning model on AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS Lambda上部署机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-a-machine-learning-model-on-aws-lambda-24c36dcaed20?source=collection_archive---------0-----------------------#2017-07-19">https://towardsdatascience.com/how-to-deploy-a-machine-learning-model-on-aws-lambda-24c36dcaed20?source=collection_archive---------0-----------------------#2017-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d7930344e8dd5c427ecfe11b931965ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6K5vmzalJUxn44v3cm6wBw.jpeg"/></div></div></figure><p id="0a88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我将带您在AWS Lambda上部署一个机器学习模型。我们的模型也可以通过使用Amazon API Gateway的API进行访问。最终，我们将得到一个真正无服务器系统的完美配方。让我们直入主题吧。</p><h2 id="259b" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">将你的模型上传到亚马逊S3 </strong></h2><p id="4847" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">第一步是将你的模型上传到亚马逊S3。如果你不熟悉亚马逊S3，请访问此链接开始:<a class="ae lu" href="http://docs.aws.amazon.com/AmazonS3/latest/UG/UploadingObjectsintoAmazonS3.html" rel="noopener ugc nofollow" target="_blank">http://docs . AWS . Amazon . com/amazons 3/latest/UG/uploadingobjectsintoamazons 3 . html</a></p><h2 id="9dee" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">创建虚拟环境</strong></h2><p id="1228" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">当部署到AWS Lambda时，您需要上传一个包含代码和依赖项的虚拟环境。在项目文件夹中，编写以下几行。为了避免冲突，你应该<strong class="ka ir">而不是</strong>将你的虚拟环境命名为你的项目文件夹。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="9ab5" class="kw kx iq ma b gy me mf l mg mh">pip install virtualenv<br/>virtualenv your_virtual_environment_name</span></pre><p id="d492" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要启动您的虚拟环境:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="dc08" class="kw kx iq ma b gy me mf l mg mh">source your_virtual_environment_name/bin/activate</span></pre><h2 id="7fab" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">创建烧瓶API </strong></h2><p id="125a" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我们需要一个基本的<a class="ae lu" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>应用程序来处理我们的请求。该应用程序将从亚马逊S3加载我们的模型，并返回预测。首先创建一个名为predictions.py的文件，然后添加下面的代码。确保在进入下一步之前修改<em class="mi"> BUCKET_NAME </em>和<em class="mi"> MODEL_FILE_NAME </em>。</p><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h2 id="f15c" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">从亚马逊S3加载我们的模型</h2><p id="b3ff" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">使用<a class="ae lu" href="https://github.com/boto/boto" rel="noopener ugc nofollow" target="_blank"> Boto </a>库，我们加载之前保存在亚马逊S3上的模型，并保存到磁盘以备后用。</p><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h2 id="d6be" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">创建预测</h2><p id="102d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">最后但并非最不重要的是，我们准备得到一些预测。predict方法接收发送给API的数据作为参数。您将需要添加一些代码来处理数据，以匹配您的模型。</p><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="14c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最终文件应该是这样的</p><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h2 id="627e" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">测试API</h2><ul class=""><li id="6644" class="ml mm iq ka b kb lp kf lq kj mn kn mo kr mp kv mq mr ms mt bi translated">要运行您的应用程序，您必须创建一个环境变量来告诉<a class="ae lu" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>要执行哪些文件:</li></ul><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="1524" class="kw kx iq ma b gy me mf l mg mh">export FLASK_APP=predictions.py</span></pre><p id="c03a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在将代码部署到AWS之前，您应该确保代码在本地工作。</p><p id="f432" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装<a class="ae lu" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank">烧瓶</a>，然后运行第二个命令来启动你的应用程序:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="b84c" class="kw kx iq ma b gy me mf l mg mh">pip install Flask<br/>flask run</span></pre><p id="9798" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开终端，测试你的预测:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="44ad" class="kw kx iq ma b gy me mf l mg mh">curl -d '{"payload": "Insert the data needed for your model to make predictions"}' http://127.0.0.1:5000/</span></pre><p id="ae05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当一切正常时，你可以进入下一步。</p><h2 id="c02a" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">部署到AWS Lambda</h2><p id="f1fa" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我们将使用一个名为<a class="ae lu" href="https://github.com/Miserlou/Zappa" rel="noopener ugc nofollow" target="_blank"> <em class="mi"> Zappa </em> </a>的库，而不是手动创建和配置AWS Lambda和API网关。</p><blockquote class="mu mv mw"><p id="343a" class="jy jz mi ka b kb kc kd ke kf kg kh ki mx kk kl km my ko kp kq mz ks kt ku kv ij bi translated">Zappa使在AWS Lambda + API Gateway上构建和部署所有Python WSGI应用程序变得非常容易。</p></blockquote><p id="fca3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">重要提示:在部署之前，确保配置您的AWS凭证。更多信息请访问:</strong><a class="ae lu" href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" rel="noopener ugc nofollow" target="_blank">http://docs . AWS . Amazon . com/CLI/latest/user guide/CLI-chap-getting-started . html</a></p><p id="d226" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的虚拟环境中，安装所需的软件包:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="08d7" class="kw kx iq ma b gy me mf l mg mh">pip install zappa sklearn boto numpy scipy</span></pre><p id="5ef7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，初始化<a class="ae lu" href="https://github.com/Miserlou/Zappa" rel="noopener ugc nofollow" target="_blank"> Zappa </a>。当被问及<em class="mi"> app函数名</em>时，写下<em class="mi"> predictions.app. </em>(或者，你的<a class="ae lu" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a> app +的名字。app)</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="aa29" class="kw kx iq ma b gy me mf l mg mh">zappa init</span></pre><p id="7cb1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS Lambda要求您的环境最大大小为50mb，但我们的打包环境大约为100mb。幸运的是，Lambda可以从亚马逊S3加载代码，而不会有太大的性能损失(只有几毫秒)。</p><p id="8f14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要激活此功能，您必须在zappa_settings.json中添加一个新行</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="9535" class="kw kx iq ma b gy me mf l mg mh">"slim_handler": true</span></pre><p id="bc25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在可以开始部署了。在初始化Zappa时，使用带有您选择的环境名称的deploy命令。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="b05a" class="kw kx iq ma b gy me mf l mg mh">zappa deploy your-environment-name</span></pre><p id="aee0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成后，您将在最后一条消息中看到您的API URL。它将看起来像“https://abcdefg . execute-API . us-east-1 . Amazon AWS . com/your-env-name”</p><p id="b392" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用cURL测试您的部署:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="3cf7" class="kw kx iq ma b gy me mf l mg mh">curl -d '{"payload": "Insert the data needed for your model to make predictions"}' https://your-api-url.com/your-env</span></pre><p id="3dec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！您已经在无服务器基础设施上部署了您的模型。</p><p id="aca2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢这篇文章，请一定留下你的关注。我也有一些关于机器学习的很棒的文章即将发表，敬请关注！</p><p id="4ecb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你也可以在推特上联系到我。</p></div></div>    
</body>
</html>