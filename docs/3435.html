<html>
<head>
<title>Creating Interactive Animation for Parameter Optimisation using Plot.ly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Plot.ly 创建参数优化的交互式动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-interactive-animation-for-parameter-optimisation-using-plot-ly-8136b2997db?source=collection_archive---------6-----------------------#2018-05-11">https://towardsdatascience.com/creating-interactive-animation-for-parameter-optimisation-using-plot-ly-8136b2997db?source=collection_archive---------6-----------------------#2018-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/15efec1afa405bd62963292a698a8b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*-85xkbQcznsNaz_XnbHoiA.gif"/></div></figure><h1 id="f52f" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">介绍</h1><p id="d107" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这篇文章演示了如何在一个变化的参数上创建一个交互式的动画结果图。</p><p id="e7a4" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">为此，我们复制了此处示例中提供的显示一段时间内各国人均 GDP 的示例，如下所示(<a class="ae lv" href="https://plot.ly/python/animations/" rel="noopener ugc nofollow" target="_blank">https://plot.ly/python/animations/</a>)。</p><p id="c558" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">实现这一点的先决条件是 Python 和 plot . ly(【https://plot.ly/python/getting-started/】T2)</p><p id="1d50" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">这绝不是最干净或最漂亮的方法，我只是简单地将我的数据放入示例中，除了更改一些轴标签之外，没有对示例中的代码进行任何重大更改。我已经创建了可视化的想法，参数优化，它并不总是为了出版，而是分析的探索阶段，所以必须尽可能快速和容易地创建。</p><p id="3a05" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">如果你想在你的报告中使用视觉效果，我建议稍微编辑一下格式，但在其他方面，创建方法也可以类似地使用。</p><p id="65d4" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">如有疑问，欢迎在下方随意评论。</p><h1 id="98a4" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Gapminder 示例</h1><p id="60a3" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将再次应用以下技术来创建交互式图表。首先，我们需要观察正在使用的数据。在此示例中，使用以下内容创建了散点图:</p><ul class=""><li id="4689" class="lw lx iq ku b kv lq kz lr ld ly lh lz ll ma lp mb mc md me bi translated">x 轴上的预期寿命</li><li id="83b6" class="lw lx iq ku b kv mf kz mg ld mh lh mi ll mj lp mb mc md me bi translated">y 轴上的人均 GDP</li><li id="550a" class="lw lx iq ku b kv mf kz mg ld mh lh mi ll mj lp mb mc md me bi translated">国家的大小与人口有关</li><li id="0334" class="lw lx iq ku b kv mf kz mg ld mh lh mi ll mj lp mb mc md me bi translated">按洲着色</li><li id="f117" class="lw lx iq ku b kv mf kz mg ld mh lh mi ll mj lp mb mc md me bi translated">跨年度跟踪(动画和滑块)</li></ul><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mk"><img src="../Images/4cfd133e56114fc164a036bd52a2672b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tV8fFeXrVpVJPJttrEdseQ.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Plot.ly Gapminder AnimationExample</figcaption></figure><h1 id="353b" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">应用我们的数据</h1><p id="fa1d" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为此，我将我的结果导出到一个特定格式的数据表中。如下所示，有三列，Alpha、Epsilon 和 V。Alpha 是我正在更改的参数，Epsilon 是模型运行的第 n 次，V 是我的输出。</p><p id="80e4" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">因此，当我的参数在 1 和 0 之间减小时，我的表由每次运行的输出构成。下图显示了前几行。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/51e71376eebe535ec1fce540035438cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*nVFe6F4nOK1HRq2cSAdo-g.png"/></div></figure><p id="581f" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">现在，我们将把已有的数据“混合”到 plot.ly 示例中。因为我们的数据有些简单，所以我们首先否定示例中使用的一些特征。理论上，你可以整理代码来删除它们，但是这需要更多的时间，而且这种方法更简单。</p><p id="fd17" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">因此，我们在数据中添加了两列，每行都有一个虚拟值‘Test1’和‘Test2’。然后，我们添加第三列来对应所使用的人口特征。如前所述，该值对应于点的大小，我选择了一个提供适当大小的点的值，但如果需要，您可以编辑它。</p><p id="4bc3" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">然后，我重命名所有的列，使其完全符合示例中的命名约定。</p><p id="9f26" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">在[21]中:</p><pre class="ml mm mn mo gt my mz na nb aw nc bi"><span id="dd7e" class="nd jv iq mz b gy ne nf l ng nh">ourData['continent'] = 'Test'<br/>ourData['country'] = 'Test2'<br/>ourData['pop'] = 7000000.0</span><span id="f232" class="nd jv iq mz b gy ni nf l ng nh">ourData.columns = ['year', 'lifeExp', 'gdpPercap', 'continent', 'country', 'pop']</span><span id="1649" class="nd jv iq mz b gy ni nf l ng nh">ourData.head()</span></pre><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nj"><img src="../Images/542713b0d58954183a5bf7d6c7b740de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtEPpw-hwbtW8Gl0VjAohw.png"/></div></div></figure><p id="4e8a" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">下一步有点棘手，在示例中，他们使用以下代码手动输入每年的数据:</p><pre class="ml mm mn mo gt my mz na nb aw nc bi"><span id="1b09" class="nd jv iq mz b gy ne nf l ng nh">years = ['1952', '1962', '1967', '1972', '1977', '1982', '1987', '1992', '1997', '2002', '2007']</span></pre><p id="fac3" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">因此，我不必每次都手动输入，只需找到每个唯一的 Alpha 值，按降序进行舍入和排序，然后生成一个唯一 Alpha 值的数组。然后，我将变量名改为‘Years ’,以与后面的代码相对应。</p><p id="6d5d" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">在[24]中:</p><pre class="ml mm mn mo gt my mz na nb aw nc bi"><span id="9286" class="nd jv iq mz b gy ne nf l ng nh">alpha = list(set(ourData['year']))<br/>alpha = np.round(alpha,1)<br/>alpha = np.sort(alpha)[::-1]<br/>years = np.round([(alpha) for alpha in alpha],1)<br/>years</span></pre><p id="09fb" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">Out[24]:</p><pre class="ml mm mn mo gt my mz na nb aw nc bi"><span id="5a44" class="nd jv iq mz b gy ne nf l ng nh">array([ 1. ,  0.9,  0.8,  0.7,  0.6,  0.5,  0.4,  0.3,  0.2,  0.1])</span></pre><p id="bb15" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">最后，我们将我们的数据重命名为与示例代码相对应的数据，并运行整个过程，以生成我们的参数优化动画和交互图。</p><p id="3bc0" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">在布局部分，我添加了一个主标题，并重新措辞了一些轴标签，以符合我的要求，但在其他方面没有改变。</p><p id="c0b1" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">在[27]中:</p><pre class="ml mm mn mo gt my mz na nb aw nc bi"><span id="1874" class="nd jv iq mz b gy ne nf l ng nh">dataset = ourData</span><span id="161b" class="nd jv iq mz b gy ni nf l ng nh">continents = []<br/>for continent in dataset['continent']:<br/>    if continent not in continents:<br/>        continents.append(continent)<br/># make figure<br/>figure = {<br/>    'data': [],<br/>    'layout': {},<br/>    'frames': []<br/>}</span><span id="9a08" class="nd jv iq mz b gy ni nf l ng nh"># fill in most of layout<br/>figure['layout']['title'] = "Parameter Optimisation using Interactive Animation &lt;br&gt; PhilipOsborneData.com"<br/>figure['layout']['xaxis'] = {'range': [1, 100], 'title': 'Epsilon'}<br/>figure['layout']['yaxis'] = {'range': [1,50],'title': 'Sum of V', 'type': 'linear'}<br/>figure['layout']['hovermode'] = 'closest'<br/>figure['layout']['sliders'] = {<br/>    'args': [<br/>        'transition', {<br/>            'duration': 400,<br/>            'easing': 'cubic-in-out'<br/>        }<br/>    ],<br/>    'initialValue': '1952',<br/>    'plotlycommand': 'animate',<br/>    'values': years,<br/>    'visible': True<br/>}<br/>figure['layout']['updatemenus'] = [<br/>    {<br/>        'buttons': [<br/>            {<br/>                'args': [None, {'frame': {'duration': 500, 'redraw': False},<br/>                         'fromcurrent': True, 'transition': {'duration': 300, 'easing': 'quadratic-in-out'}}],<br/>                'label': 'Play',<br/>                'method': 'animate'<br/>            },<br/>            {<br/>                'args': [[None], {'frame': {'duration': 0, 'redraw': False}, 'mode': 'immediate',<br/>                'transition': {'duration': 0}}],<br/>                'label': 'Pause',<br/>                'method': 'animate'<br/>            }<br/>        ],<br/>        'direction': 'left',<br/>        'pad': {'r': 10, 't': 87},<br/>        'showactive': False,<br/>        'type': 'buttons',<br/>        'x': 0.1,<br/>        'xanchor': 'right',<br/>        'y': 0,<br/>        'yanchor': 'top'<br/>    }<br/>]</span><span id="3a81" class="nd jv iq mz b gy ni nf l ng nh">sliders_dict = {<br/>    'active': 0,<br/>    'yanchor': 'top',<br/>    'xanchor': 'left',<br/>    'currentvalue': {<br/>        'font': {'size': 20},<br/>        'prefix': 'Alpha: ',<br/>        'visible': True,<br/>        'xanchor': 'right'<br/>    },<br/>    'transition': {'duration': 300, 'easing': 'cubic-in-out'},<br/>    'pad': {'b': 10, 't': 50},<br/>    'len': 0.9,<br/>    'x': 0.1,<br/>    'y': 0,<br/>    'steps': []<br/>}</span><span id="b0a7" class="nd jv iq mz b gy ni nf l ng nh"># make data<br/>year = 1.0<br/>for continent in continents:<br/>    dataset_by_year = dataset[np.round(dataset['year'],1) == np.round(year,1)]<br/>    dataset_by_year_and_cont = dataset_by_year[dataset_by_year['continent'] == continent]</span><span id="8ce1" class="nd jv iq mz b gy ni nf l ng nh">    data_dict = {<br/>        'x': list(dataset_by_year_and_cont['lifeExp']),<br/>        'y': list(dataset_by_year_and_cont['gdpPercap']),<br/>        'mode': 'markers',<br/>        'text': list(dataset_by_year_and_cont['country']),<br/>        'marker': {<br/>            'sizemode': 'area',<br/>            'sizeref': 200000,<br/>            'size': list(dataset_by_year_and_cont['pop'])<br/>        },<br/>        'name': continent<br/>    }<br/>    figure['data'].append(data_dict)</span><span id="6552" class="nd jv iq mz b gy ni nf l ng nh"># make frames<br/>for year in years:<br/>    frame = {'data': [], 'name': str(year)}<br/>    for continent in continents:<br/>        dataset_by_year = dataset[np.round(dataset['year'],1) == np.round(year,1)]<br/>        dataset_by_year_and_cont = dataset_by_year[dataset_by_year['continent'] == continent]</span><span id="37f5" class="nd jv iq mz b gy ni nf l ng nh">        data_dict = {<br/>            'x': list(dataset_by_year_and_cont['lifeExp']),<br/>            'y': list(dataset_by_year_and_cont['gdpPercap']),<br/>            'mode': 'markers',<br/>            'text': list(dataset_by_year_and_cont['country']),<br/>            'marker': {<br/>                'sizemode': 'area',<br/>                'sizeref': 200000,<br/>                'size': list(dataset_by_year_and_cont['pop'])<br/>            },<br/>            'name': continent<br/>        }<br/>        frame['data'].append(data_dict)</span><span id="933c" class="nd jv iq mz b gy ni nf l ng nh">    figure['frames'].append(frame)<br/>    slider_step = {'args': [<br/>        [year],<br/>        {'frame': {'duration': 300, 'redraw': False},<br/>         'mode': 'immediate',<br/>       'transition': {'duration': 300}}<br/>     ],<br/>     'label': year,<br/>     'method': 'animate'}<br/>    sliders_dict['steps'].append(slider_step)<br/></span><span id="eb4c" class="nd jv iq mz b gy ni nf l ng nh">figure['layout']['sliders'] = [sliders_dict]</span><span id="eb12" class="nd jv iq mz b gy ni nf l ng nh">iplot(figure)</span></pre><p id="a407" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">输出显示在本文开头的动画中。</p><p id="fe67" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">谢谢</p><p id="036e" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">哲学（philosophy 的缩写）</p></div></div>    
</body>
</html>