<html>
<head>
<title>Recreating (more) data visualizations from the book “Knowledge is Beautiful”: Part IV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从《知识是美丽的》一书中再现(更多)数据可视化:第四部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iv-686938a84c9e?source=collection_archive---------6-----------------------#2018-07-16">https://towardsdatascience.com/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iv-686938a84c9e?source=collection_archive---------6-----------------------#2018-07-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e41c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎来到本系列的最后一部分，在这里我用 R 语言重新创建了 David McCandless 所著的《知识是美丽的》一书中的数据可视化。</p><p id="b888" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此处可找到该系列第<a class="ae km" rel="noopener" target="_blank" href="/recreating-data-visualizations-from-the-book-knowledge-is-beautiful-e455e7126071">部分 I </a>、<a class="ae km" href="https://medium.com/@MattOldach_65321/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-ii-2f1d1da68e3a" rel="noopener"> II </a>、<a class="ae km" rel="noopener" target="_blank" href="/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iii-5fd393b4c548"> III </a>的链接。</p><h1 id="0d52" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">飞机坠毁</h1><p id="4d0c" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">这个<strong class="jp ir"> </strong> <a class="ae km" href="https://docs.google.com/spreadsheets/d/1RT25s5oCsHJrahZkL6KWxAa2ZM9kD2aRakN9Cil_vHQ/edit#gid=11" rel="noopener ugc nofollow" target="_blank">数据集</a>将用于几个可视化。</p><p id="d1e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个可视化是一个堆积条形图，显示了从 1993 年到 2017 年 1 月的每架飞机失事的原因(<em class="kl">为非军事、医疗或私人包机航班</em>)。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="84dc" class="lz ko iq lv b gy ma mb l mc md">library(dplyr)<br/>library(ggplot2)<br/>library(tidyr)<br/>library(extrafont)</span><span id="2c3a" class="lz ko iq lv b gy me mb l mc md">df &lt;- read.csv("worst_plane.csv")</span><span id="130c" class="lz ko iq lv b gy me mb l mc md"># Drop the year plane model entered service<br/>mini_df &lt;- df %&gt;% <br/>  select(-year_service) %&gt;% <br/># Gather the wide dataframe into a tidy format<br/>  gather(key = cause, value = proportion, -plane)<br/># Order by cause<br/>mini_df$cause &lt;- factor(mini_df$cause, levels = c("human_error","weather", "mechanical", "unknown", "criminal"), ordered = TRUE)</span><span id="2472" class="lz ko iq lv b gy me mb l mc md"># Create vector of plane names according to year they entered service<br/>names &lt;- unique(mini_df$plane)<br/>names &lt;- as.vector(names)<br/># sort by factor<br/>mini_df$plane &lt;- factor(mini_df$plane, levels = names)</span><span id="e3aa" class="lz ko iq lv b gy me mb l mc md">ggplot(mini_df, aes(x=plane, y=proportion, fill=cause)) +<br/>  geom_bar(stat = "identity") +<br/>  coord_flip() +<br/>  # Reverse the order of a categorical axis<br/>  scale_x_discrete(limits = rev(levels(mini_df$plane))) +<br/>  # Select manual colors that McCandless used<br/>  scale_fill_manual(values = c("#8E5A7E", "#A3BEC7", "#E1BD81", "#E9E4E0", "#74756F"), labels = c("Human Error", "Weather", "Mechanical", "Unknown", "Criminal")) +<br/>  labs(title = "Worst Planes", caption = "Source: bit.ly/KIB_PlaneCrashes") +<br/>  scale_y_reverse() +<br/>  theme(legend.position = "right",<br/>      panel.background = element_blank(),<br/>        plot.title = element_text(size = 13, <br/>                                  family = "Georgia", <br/>                                  face = "bold", lineheight = 1.2),<br/>      plot.caption = element_text(size = 5,<br/>                                    hjust = 0.99, family = "Georgia"),<br/>      axis.text = element_text(family = "Georgia"), <br/>      # Get rid of the x axis text/title <br/>      axis.text.x=element_blank(),<br/>      axis.title.x=element_blank(),<br/>      # and y axis title<br/>      axis.title.y=element_blank(),<br/>      # and legend title<br/>      legend.title = element_blank(),<br/>      legend.text = element_text(family = "Georgia"),<br/>      axis.ticks = element_blank())</span></pre><figure class="lq lr ls lt gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mf"><img src="../Images/1749dcbce825e5407ed6354640ef9577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KPsPC1uJkhlk_QMLbmaLzQ.jpeg"/></div></div></figure><p id="6336" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个可视化是一个冲积图，我们可以使用<code class="fe mn mo mp lv b">ggalluvial</code>包。我应该提到的是，McCandless 最初的可视化要比现在产生的更加花哨，但是显示了相同的基本信息。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="55e3" class="lz ko iq lv b gy ma mb l mc md">library(alluvial)<br/>library(ggalluvial)</span><span id="1d76" class="lz ko iq lv b gy me mb l mc md">crash &lt;- read.csv("crashes_alluvial.csv")</span><span id="7044" class="lz ko iq lv b gy me mb l mc md"># stratum = cause, alluvium = freq</span><span id="d78a" class="lz ko iq lv b gy me mb l mc md">ggplot(crash, aes(weight = freq,<br/>                  axis1 = phase,<br/>                  axis2 = cause,<br/>                  axis3 = total_crashes)) +<br/>  geom_alluvium(aes(fill = cause),<br/>                width = 0, knot.pos = 0, reverse = FALSE) +<br/>  guides(fill = FALSE) +<br/>  geom_stratum(width = 1/8, reverse = FALSE) +<br/>  geom_text(stat = "stratum", label.strata = TRUE, reverse = FALSE, size = 2.5) +<br/>  scale_x_continuous(breaks = 1:3, labels = c("phase", "causes", "total crashes")) +<br/>  coord_flip() +<br/>  labs(title = "Crash Cause", caption = "Source: bit.ly/KIB_PlaneCrashes") +<br/>  theme(panel.background = element_blank(),<br/>        plot.title = element_text(size = 13, <br/>                                  family = "Georgia", <br/>                                  face = "bold",<br/>                                  lineheight = 1.2,<br/>                                  vjust = -3,<br/>                                  hjust = 0.05), <br/>        plot.caption = element_text(size = 5,<br/>                                    hjust = 0.99, family = "Georgia"),  <br/>        axis.text = element_text(family = "Georgia"),<br/>      axis.text.x = element_blank(),<br/>      axis.ticks.x = element_blank(),<br/>      axis.ticks.y = element_blank())</span></pre><figure class="lq lr ls lt gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mq"><img src="../Images/717b935c5a7d37aafc6725eeadcd83e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZNrVJ0dWFgt_Maw2fr84MA.png"/></div></div></figure><p id="84c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我看来，产生桑基图的一个更干净的方法是用包<code class="fe mn mo mp lv b">flipPlot</code> <a class="ae km" href="https://www.r-bloggers.com/how-to-create-sankey-diagrams-from-tables-data-frames-using-r/" rel="noopener ugc nofollow" target="_blank">包</a>。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="8645" class="lz ko iq lv b gy ma mb l mc md">devtools::install_github(Displayr/flipPlots)<br/>library(flipPlots)</span><span id="7928" class="lz ko iq lv b gy me mb l mc md"># reorder the df<br/>crash$total_crashes &lt;- rep("YES", 25)</span><span id="bf8d" class="lz ko iq lv b gy me mb l mc md"># plot<br/>SankeyDiagram(crash[, -4], link.color = "Source", label.show.varname = FALSE, weights = crash$freq)</span></pre><figure class="lq lr ls lt gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mr"><img src="../Images/5698a36b93c10be4586dc20f95484069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O_sXWaHy2-i-n3yG5jbAuA.jpeg"/></div></div></figure><p id="c1d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可能只是旋转图像和标签，并将“是”改为“总崩溃数(427)”</p><h1 id="3a21" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">性别差距</h1><p id="a22f" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">该图描绘了英国不同行业中男性和女性的工资差距，以及同一类别中每个职位的平均工资。我们可以使用<code class="fe mn mo mp lv b">group_by() </code>和<code class="fe mn mo mp lv b">summarize_at()</code>为每个类别创建一个新变量，然后使用<code class="fe mn mo mp lv b">facet_wrap()</code>。由于位置仅属于一个类别，您需要设置<code class="fe mn mo mp lv b">scales = "free_x"</code>用于遗漏观察。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="e272" class="lz ko iq lv b gy ma mb l mc md">gendergap &lt;- read.csv("gendergap.csv")</span><span id="e7c1" class="lz ko iq lv b gy me mb l mc md"># gather the dataset<br/>tidy_gap &lt;- gendergap %&gt;% <br/>  gather(key = sex, value = salary, -title, -category)</span><span id="7af0" class="lz ko iq lv b gy me mb l mc md">category_means &lt;- tidy_gap %&gt;% <br/>  group_by(category) %&gt;%<br/>  summarize_at(vars(salary), mean)</span><span id="22f6" class="lz ko iq lv b gy me mb l mc md">tidy_gap %&gt;% ggplot(aes(x = title, y = salary, color = sex)) +<br/>  facet_grid(. ~ category, scales = "free_x", space = "free") +<br/>  geom_line(color = "white") +<br/>  geom_point() +<br/>  scale_color_manual(values = c("#F49171", "#81C19C")) +<br/>  geom_hline(data = category_means, aes(yintercept = salary), color = "white", alpha = 0.6, size = 1) +<br/>  theme(legend.position = "none",<br/>      panel.background = element_rect(color = "#242B47", fill = "#242B47"),<br/>      plot.background = element_rect(color = "#242B47", fill = "#242B47"),<br/>      axis.line = element_line(color = "grey48", size = 0.05, linetype = "dotted"),<br/>      axis.text = element_text(family = "Georgia", color = "white"),<br/>      axis.text.x = element_text(angle = 90),<br/>      # Get rid of the y- and x-axis titles<br/>      axis.title.y=element_blank(),<br/>      axis.title.x=element_blank(),<br/>      panel.grid.major.y = element_line(color = "grey48", size = 0.05),<br/>      panel.grid.minor.y = element_blank(),<br/>      panel.grid.major.x = element_blank(),<br/>      strip.background = element_rect(color = "#242B47", fill = "#242B47"),<br/>      strip.text = element_text(color = "white", family = "Georgia"))<br/></span></pre><figure class="lq lr ls lt gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ms"><img src="../Images/d1048e7d7ef24c4ff120e0fc384a3a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lA1b-cn7LRzgPIOaPEG5vQ.png"/></div></div></figure><p id="dbe8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不确定如何处理的一件事是 x 轴上每个变量之间的间距。由于每个刻面有不同数量的变量，如果能指定他们想要沿 x 轴等间距作为<code class="fe mn mo mp lv b">facet_wrap()</code>中的一个选项就更好了；然而，我认为这是不可能的(如果你知道一个变通办法，请留下评论！).</p><p id="127b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">##编辑 2018 年 9 月 5 日</p><p id="000c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">多亏了 StackOverflow 的非常有帮助的<a class="ae km" href="https://stackoverflow.com/questions/51052566/dealing-with-variable-axis-scales-in-facet-wrap?noredirect=1#comment91218664_51052566" rel="noopener ugc nofollow" target="_blank">社区的帮助，我知道我需要的是<code class="fe mn mo mp lv b">facet_grid()</code>而不是<code class="fe mn mo mp lv b">facet_wrap()</code>。如果任何人知道如何手动调整 x 轴上每个类别之间的距离(例如<em class="kl">或</em>最小化间距)，将获得加分。</a></p><p id="b17f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我的全部，做这个系列很有趣，我希望你喜欢！</p></div></div>    
</body>
</html>