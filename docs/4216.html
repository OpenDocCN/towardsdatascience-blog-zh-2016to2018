<html>
<head>
<title>3 steps to update parameters of Faster R-CNN/SSD models in TensorFlow Object Detection API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 TensorFlow 对象检测 API 中更新更快的 R-CNN/SSD 模型参数的 3 个步骤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-steps-to-update-parameters-of-faster-r-cnn-ssd-models-in-tensorflow-object-detection-api-7eddb11273ed?source=collection_archive---------1-----------------------#2018-07-30">https://towardsdatascience.com/3-steps-to-update-parameters-of-faster-r-cnn-ssd-models-in-tensorflow-object-detection-api-7eddb11273ed?source=collection_archive---------1-----------------------#2018-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ef79649fa2e29605c43c7d0871526325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*DeEwIMTx-aWxLBxb5uVrXg.jpeg"/></div></div></figure><p id="3010" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我写过一篇关于配置 TensorFlow 对象检测 API 的文章。请参考这个故事<a class="ae kw" href="https://becominghuman.ai/tensorflow-object-detection-api-tutorial-training-and-evaluating-custom-object-detector-ed2594afcf73" rel="noopener ugc nofollow" target="_blank">这里</a>来配置 API。那个故事是这篇文章的先决条件。</p><p id="1bd6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个故事中，我将讨论如何改变预训练模型的配置。这篇文章的目的是你可以根据你的应用程序配置<a class="ae kw" href="https://github.com/tensorflow/models" rel="noopener ugc nofollow" target="_blank"> TensorFlow/models </a>，API 将不再是一个黑盒！</p><p id="b87b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">文章概述:</p><ul class=""><li id="854e" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">了解协议缓冲区和<code class="fe lg lh li lj b">proto</code>文件。</li><li id="96f2" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lc ld le lf bi translated">利用<code class="fe lg lh li lj b">proto</code>文件的知识，我们如何理解模型的<a class="ae kw" href="https://github.com/tensorflow/models/tree/master/research/object_detection/samples/configs" rel="noopener ugc nofollow" target="_blank">配置文件</a></li><li id="424d" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lc ld le lf bi translated">更新模型参数需要遵循的 3 个步骤</li><li id="2065" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lc ld le lf bi translated">杂项示例:</li></ul><ol class=""><li id="28c3" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lp ld le lf bi translated">更改权重初始值设定项</li><li id="acc1" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lp ld le lf bi translated">更改权重优化器</li><li id="74b7" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lp ld le lf bi translated">评估预训练模型。</li></ol><h2 id="1a82" class="lq lr iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">协议缓冲区</h2><p id="ec78" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">为了修改这个模型，我们需要了解它的内部机制。<a class="ae kw" href="https://github.com/tensorflow/models/" rel="noopener ugc nofollow" target="_blank"> TensorFlow 对象检测 API </a>使用<a class="ae kw" href="https://developers.google.com/protocol-buffers/" rel="noopener ugc nofollow" target="_blank">协议缓冲区</a>，这是一种独立于语言、独立于平台且可扩展的机制，用于序列化结构化数据。它就像规模较小的 XML，但是更快更简单。API 使用协议缓冲语言的<em class="mo"> proto2 </em>版本。我将尝试解释更新预配置模型所需的这种语言。有关协议缓冲语言的更多详细信息，请参考本<a class="ae kw" href="https://developers.google.com/protocol-buffers/docs/proto" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae kw" href="https://developers.google.com/protocol-buffers/docs/pythontutorial" rel="noopener ugc nofollow" target="_blank"> Python 教程</a>。</p><p id="3e34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">协议缓冲区的工作可以用以下 3 个步骤来解释:</p><ul class=""><li id="b43e" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">在<code class="fe lg lh li lj b">.proto</code>文件中定义消息格式。这个文件就像所有消息的蓝图，它显示了消息接受的所有参数，参数的数据类型应该是什么，参数是必需的还是可选的，参数的标签号是什么，参数的默认值是什么等等。API 的 protos 文件可以在<a class="ae kw" href="https://github.com/tensorflow/models/tree/master/research/object_detection/protos" rel="noopener ugc nofollow" target="_blank">这里</a>找到。为了便于理解，我使用的是<a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/protos/grid_anchor_generator.proto" rel="noopener ugc nofollow" target="_blank">grid _ anchor _ generator . proto</a>文件。</li></ul><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="10c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从第 30-33 行可以清楚地看到，参数<code class="fe lg lh li lj b">scales</code>和<code class="fe lg lh li lj b">aspect_ratios</code>对于消息<code class="fe lg lh li lj b">GridAnchorGenerator</code>是强制的，而其余的参数是可选的，如果没有通过，将采用默认值。</p><ul class=""><li id="65f7" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">定义消息格式后，我们需要编译协议缓冲区。这个编译器将从<code class="fe lg lh li lj b">.proto</code>文件生成类文件。在安装 API 的过程中，我们运行了以下命令，该命令将编译协议缓冲区:</li></ul><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="9e99" class="lq lr iq lj b gy mz na l nb nc"># From tensorflow/models/research/<br/>protoc object_detection/protos/*.proto --python_out=.</span></pre><ul class=""><li id="e4ae" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">在定义并编译好协议缓冲区之后，我们需要使用 Python 协议缓冲区 API 来写入和读取消息。在我们的例子中，我们可以将配置文件视为协议缓冲 API，它可以写入和读取消息，而忽略 TensorFlow API 的内部机制。换句话说，我们可以通过适当地更改配置文件来更新预训练模型的参数。</li></ul></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="6c9a" class="lq lr iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">了解配置文件</h2><p id="e28e" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">很明显，配置文件可以帮助我们根据需要改变模型的参数。下一个问题是我们如何改变模型的参数？本节和下一节将回答这个问题，在这里<code class="fe lg lh li lj b">proto</code>文件的知识将会派上用场。出于演示的目的，我使用了<a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/samples/configs/faster_rcnn_resnet50_pets.config" rel="noopener ugc nofollow" target="_blank">fast _ rcnn _ resnet 50 _ pets . config</a>文件。</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2c2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第 7–10 行暗示<code class="fe lg lh li lj b">num_classes</code>是<code class="fe lg lh li lj b">faster_rcnn</code>消息的参数之一，而后者又是消息<code class="fe lg lh li lj b">model</code>的参数。同样，<code class="fe lg lh li lj b">optimizer</code>是父<code class="fe lg lh li lj b">train_config</code>消息的子消息，而<code class="fe lg lh li lj b">batch_size</code>是<code class="fe lg lh li lj b">train_config</code>消息的另一个参数。我们可以通过检查相应的<a class="ae kw" href="https://github.com/tensorflow/models/tree/master/research/object_detection/protos" rel="noopener ugc nofollow" target="_blank"> protos </a>文件来验证这一点。</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Snippet of <a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/protos/faster_rcnn.proto" rel="noopener ugc nofollow" target="_blank">faster_rcnn.proto</a></figcaption></figure><p id="4c49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从第 20 行和第 26 行可以清楚地看出<code class="fe lg lh li lj b">num_classes</code>是消息<code class="fe lg lh li lj b">faster_rcnn</code>的<code class="fe lg lh li lj b">optional</code>参数之一。我希望到目前为止的讨论有助于理解配置文件的组织。现在，是正确更新模型的一个参数的时候了。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><blockquote class="no np nq"><p id="abf7" class="jy jz mo ka b kb kc kd ke kf kg kh ki nr kk kl km ns ko kp kq nt ks kt ku kv ij bi translated">步骤 1:决定要更新的参数</p></blockquote><p id="11e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设我们需要更新<a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/samples/configs/faster_rcnn_resnet50_pets.config" rel="noopener ugc nofollow" target="_blank">faster _ rcnn _ resnet 50 _ pets . config</a>文件第 10 行提到的<code class="fe lg lh li lj b">image_resizer</code>参数。</p><blockquote class="no np nq"><p id="f34c" class="jy jz mo ka b kb kc kd ke kf kg kh ki nr kk kl km ns ko kp kq nt ks kt ku kv ij bi translated">步骤 2:在存储库中搜索给定的参数</p></blockquote><p id="4eae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目标是定位参数的<code class="fe lg lh li lj b">proto</code>文件。为此，我们需要在存储库中进行搜索。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/6cf073de5d1b4764039cdb12be264716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*usr5KDQ7qXKKWjxYWZ1NBQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Search in the repository</figcaption></figure><p id="9fb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要搜索以下代码:</p><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="a334" class="lq lr iq lj b gy mz na l nb nc">parameter_name path:research/object_detection/protos</span><span id="6a18" class="lq lr iq lj b gy nv na l nb nc">#in our case parameter_name="image_resizer" thus,<br/>image_resizer path:research/object_detection/protos</span></pre><p id="108b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里<code class="fe lg lh li lj b">path:research/object_detection/protos</code>限定了搜索域。更多关于如何在 GitHub 上搜索的信息可以在<a class="ae kw" href="https://help.github.com/articles/searching-code/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。搜索<code class="fe lg lh li lj b">image_resizer path:research/object_detection/protos</code>的输出如下所示:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/0b3857aaad847c8845942ae842b6cce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayYWVEZg5onKivcFv2u1jw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Search result of <code class="fe lg lh li lj b">image_resizer path:research/object_detection/proros</code></figcaption></figure><p id="8956" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从输出中可以清楚地看到，要更新<code class="fe lg lh li lj b">image_resizer</code>参数，我们需要分析<code class="fe lg lh li lj b">image_resizer.proto</code>文件。</p><blockquote class="no np nq"><p id="ef04" class="jy jz mo ka b kb kc kd ke kf kg kh ki nr kk kl km ns ko kp kq nt ks kt ku kv ij bi translated">第三步:分析<code class="fe lg lh li lj b">proto</code>文件</p></blockquote><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk"><a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/protos/image_resizer.proto" rel="noopener ugc nofollow" target="_blank">image_resizer.proto</a> file.</figcaption></figure><p id="919e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从第 8-10 行可以清楚地看出，我们可以使用<code class="fe lg lh li lj b">keep_aspect_ratio_resizer</code>或<code class="fe lg lh li lj b">fixed_shape_resizer</code>来调整图像的大小。在分析第 23-44 行时，我们可以看到消息<code class="fe lg lh li lj b">keep_aspect_ratio_resizer</code>有参数:<code class="fe lg lh li lj b">min_dimension</code>、<code class="fe lg lh li lj b">max_dimension</code>、<code class="fe lg lh li lj b">resize_method</code>、<code class="fe lg lh li lj b">pad_to_max_dimension</code>、<code class="fe lg lh li lj b">convert_to_grayscale</code>和<code class="fe lg lh li lj b">per_channel_pad_value</code>。而且，<code class="fe lg lh li lj b">fixed_shape_resizer</code>有参数:<code class="fe lg lh li lj b">height</code>、<code class="fe lg lh li lj b">width</code>、<code class="fe lg lh li lj b">resize_method</code>、<code class="fe lg lh li lj b">convert_to_grayscale</code>。所有参数的数据类型都在<code class="fe lg lh li lj b">proto</code>文件中提及。因此，要更改<code class="fe lg lh li lj b">image_resizer</code>类型，我们可以在配置文件中更改以下几行。</p><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="1682" class="lq lr iq lj b gy mz na l nb nc">#before<br/>image_resizer {<br/>keep_aspect_ratio_resizer {<br/>min_dimension: 600 <br/>max_dimension: 1024<br/>    }<br/>}</span><span id="f354" class="lq lr iq lj b gy nv na l nb nc">#after<br/>image_resizer {<br/>fixed_shape_resizer {<br/>height: 600<br/>width: 500<br/>resize_method: AREA<br/>  }<br/>}</span></pre><p id="030b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的代码使用 AREA resize 方法将图像的大小调整为 500 * 600。TensorFlow 中可用的各种调整大小的方法可以在这里找到<a class="ae kw" href="https://www.tensorflow.org/api_docs/python/tf/image/ResizeMethod" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><blockquote class="no np nq"><p id="79c6" class="jy jz mo ka b kb kc kd ke kf kg kh ki nr kk kl km ns ko kp kq nt ks kt ku kv ij bi translated">杂项示例</p></blockquote><p id="a3ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用上一节中讨论的步骤来更新/添加任何参数。我将在这里演示一些常用的示例，但是上面讨论的步骤可能有助于更新/添加模型的任何参数。</p><h2 id="e765" class="lq lr iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">改变重量初始化器</h2><ul class=""><li id="2633" class="kx ky iq ka b kb mj kf mk kj nx kn ny kr nz kv lc ld le lf bi translated">决定更改<a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/samples/configs/faster_rcnn_resnet50_pets.config" rel="noopener ugc nofollow" target="_blank">文件 faster _ rcnn _ resnet 50 _ pets . config</a>第 35 行的参数<code class="fe lg lh li lj b">initializer</code>。</li><li id="3818" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lc ld le lf bi translated">在存储库中搜索<code class="fe lg lh li lj b">initializer path:research/object_detection/protos</code>。从搜索结果来看，很明显我们需要分析<code class="fe lg lh li lj b">hyperparams.proto</code>文件。</li></ul><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/526b1e656b4ab4ecdb021bb7f35fb86c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCgr1NLTOyaK2HUS4Bu4_A.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Search result of <code class="fe lg lh li lj b">initializer path:research/object_detection/proros</code></figcaption></figure><ul class=""><li id="444f" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><a class="ae kw" href="https://github.com/tensorflow/models/blob/b9ca525f88cd942882ca541ec5ac9d27bb87a24f/research/object_detection/protos/hyperparams.proto" rel="noopener ugc nofollow" target="_blank"> hyperparams.proto </a>文件中的第 68–74 行解释了<code class="fe lg lh li lj b">initializer</code>配置。</li></ul><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="8e24" class="lq lr iq lj b gy mz na l nb nc">message Initializer {<br/>  oneof initializer_oneof {<br/>    TruncatedNormalInitializer truncated_normal_initializer = 1;<br/>    VarianceScalingInitializer variance_scaling_initializer = 2;<br/>    RandomNormalInitializer random_normal_initializer = 3;<br/>  }<br/>}</span></pre><p id="3279" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用<code class="fe lg lh li lj b">random_normal_intializer</code>代替<code class="fe lg lh li lj b">truncated_normal_initializer</code>，因为我们需要分析<a class="ae kw" href="https://github.com/tensorflow/models/blob/b9ca525f88cd942882ca541ec5ac9d27bb87a24f/research/object_detection/protos/hyperparams.proto" rel="noopener ugc nofollow" target="_blank"> hyperparams.proto </a>文件中的第 99–102 行。</p><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="6b25" class="lq lr iq lj b gy mz na l nb nc">message RandomNormalInitializer {<br/>  optional float mean = 1 [default = 0.0];<br/>  optional float stddev = 2 [default = 1.0];<br/>}</span></pre><p id="42bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很明显<code class="fe lg lh li lj b">random_normal_intializer</code>有两个参数<code class="fe lg lh li lj b">mean</code>和<code class="fe lg lh li lj b">stddev</code>。我们可以更改配置文件中的以下行来使用<code class="fe lg lh li lj b">random_normal_intializer</code>。</p><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="4e75" class="lq lr iq lj b gy mz na l nb nc">#before<br/>initializer {<br/>    truncated_normal_initializer {<br/>        stddev: 0.01<br/>       }<br/>}</span><span id="bf80" class="lq lr iq lj b gy nv na l nb nc">#after<br/>initializer {<br/>    random_normal_intializer{<br/>       mean: 1 <br/>       stddev: 0.5<br/>       }<br/>}</span></pre></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="7bd5" class="lq lr iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">更改权重优化器</h2><ul class=""><li id="13dc" class="kx ky iq ka b kb mj kf mk kj nx kn ny kr nz kv lc ld le lf bi translated">决定更改<a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/samples/configs/faster_rcnn_resnet50_pets.config" rel="noopener ugc nofollow" target="_blank">fast _ rcnn _ resnet 50 _ pets . config</a>文件第 87 行父消息<code class="fe lg lh li lj b">optimizer</code>的参数<code class="fe lg lh li lj b">momentum_optimizer</code>。</li><li id="27e7" class="kx ky iq ka b kb lk kf ll kj lm kn ln kr lo kv lc ld le lf bi translated">在存储库中搜索<code class="fe lg lh li lj b">optimizer path:research/object_detection/protos</code>。从搜索结果来看，很明显我们需要分析<code class="fe lg lh li lj b">optimizer.proto</code>文件。</li></ul><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/8daad9296f1d9149e0bd0ccf6a6e9662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DI3-DOCW1qcyhvqN59cAOw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Search result of optimizer<code class="fe lg lh li lj b"> path:research/object_detection/proros</code></figcaption></figure><ul class=""><li id="d5a4" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><a class="ae kw" href="https://github.com/tensorflow/models/blob/7025590841588e82f371ef0fef7dd77a8a71efb8/research/object_detection/protos/optimizer.proto" rel="noopener ugc nofollow" target="_blank"> optimizer.proto </a>文件中的第 9–14 行，expain <code class="fe lg lh li lj b">optimizer</code>配置。</li></ul><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="6d9d" class="lq lr iq lj b gy mz na l nb nc">message Optimizer {<br/>  oneof optimizer {<br/>    RMSPropOptimizer rms_prop_optimizer = 1;<br/>    MomentumOptimizer momentum_optimizer = 2;<br/>    AdamOptimizer adam_optimizer = 3;<br/>  }</span></pre><p id="caf0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很明显，我们可以使用已经被证明是很好的优化器的<code class="fe lg lh li lj b">adam_optimizer</code>来代替<code class="fe lg lh li lj b">momentum_optimizer</code>。为此，我们需要对 f<a class="ae kw" href="https://github.com/tensorflow/models/blob/master/research/object_detection/samples/configs/faster_rcnn_resnet50_pets.config" rel="noopener ugc nofollow" target="_blank">aster _ rcnn _ resnet 50 _ pets . config</a>文件进行以下更改。</p><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="f5e8" class="lq lr iq lj b gy mz na l nb nc">#before<br/>optimizer {  <br/>  momentum_optimizer: {<br/>      learning_rate: {<br/>           manual_step_learning_rate {<br/>          initial_learning_rate: 0.0003<br/>          schedule {<br/>            step: 900000<br/>            learning_rate: .00003<br/>          }<br/>          schedule {<br/>            step: 1200000<br/>            learning_rate: .000003<br/>          }<br/>        }<br/>      }<br/>      momentum_optimizer_value: 0.9<br/>    }</span><span id="e144" class="lq lr iq lj b gy nv na l nb nc">#after<br/>optimizer {<br/>  adam_optimizer: {<br/>      learning_rate: {<br/>       manual_step_learning_rate {<br/>          initial_learning_rate: 0.0003<br/>          schedule {<br/>            step: 900000<br/>            learning_rate: .00003<br/>          }<br/>          schedule {<br/>            step: 1200000<br/>            learning_rate: .000003<br/>          }<br/>        }<br/>      }<br/>    }</span></pre></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="7635" class="lq lr iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">评估预训练模型</h2><p id="b331" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">Eval 等待 300 秒检查训练模型是否更新！如果你的 GPU 很好，你可以同时训练和评估这两者！一般情况下，资源会被耗尽。为了克服这一点，我们可以首先训练模型，将其保存在目录中，然后评估模型。为了以后进行评估，我们需要在配置文件中进行以下更改:</p><pre class="mp mq mr ms gt mv lj mw mx aw my bi"><span id="b0ac" class="lq lr iq lj b gy mz na l nb nc">#Before<br/>eval_config: {<br/>  num_examples: 2000<br/>  # Note: The below line limits the evaluation process to 10 evaluations.<br/>  # Remove the below line to evaluate indefinitely.<br/>  max_evals: 10<br/>}</span><span id="82ea" class="lq lr iq lj b gy nv na l nb nc">#after<br/>eval_config: {<br/>num_examples: 10<br/>num_visualizations: 10<br/>eval_interval_secs: 0<br/>}</span></pre><p id="156f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">num_visualizations</code>应该等于待评估的数量！可视化的数量越多，评估所需的时间就越长。如果你的 GPU 有足够的能力同时训练和评估，你可以保留<code class="fe lg lh li lj b">eval_interval_secs: 300</code>。此参数用于决定运行评估的频率。我按照上面讨论的 3 个步骤得出了这个结论。</p><p id="4549" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简单地说，协议缓冲区的知识帮助我们理解了模型的参数是以消息的形式传递的，要更新参数我们可以参考<code class="fe lg lh li lj b">.proto</code>文件。讨论了找到正确的<code class="fe lg lh li lj b">.proto</code>文件以更新参数的 3 个简单步骤。最近在<a class="ae kw" href="https://neptune.ai/" rel="noopener ugc nofollow" target="_blank"> neptune.ai </a>上偶然看到<a class="ae kw" href="https://neptune.ai/blog/how-to-train-your-own-object-detector-using-tensorflow-object-detection-api" rel="noopener ugc nofollow" target="_blank">这篇文章</a>，对进一步参考有用。</p><p id="8ec3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请在评论中提及您想要在配置文件中更新/添加的任何参数。</p><p id="63ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这篇文章有所帮助。</p><p id="342c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">索达</p></div></div>    
</body>
</html>