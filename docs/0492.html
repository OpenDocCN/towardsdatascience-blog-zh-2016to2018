<html>
<head>
<title>Lessons Learned: Digital Ocean for Python 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">经验教训:Python 3 的数字海洋</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/lessons-learned-digital-ocean-for-python-3-e2442db4246f?source=collection_archive---------2-----------------------#2017-05-10">https://towardsdatascience.com/lessons-learned-digital-ocean-for-python-3-e2442db4246f?source=collection_archive---------2-----------------------#2017-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b564" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是正在进行的系列文章的一部分。我花很多时间尝试新技术。更多的时候，是因为一个类似于:“你应该试试【在此插入技术】，超级简单！”。</p><p id="b240" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明这种情况很少发生，所以每次我花几个小时试图让一些东西工作时，我都会发布我的解决方案，以及我在这个过程中学到的任何技巧和诀窍。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="89ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ks" href="https://www.digitalocean.com/" rel="noopener ugc nofollow" target="_blank"> Digital Ocean </a>是一家基于云的服务器提供商，拥有非常合理的计划，允许您将计算从您的计算机转移到云中，从而节省您的时间并保持您的计算机新鲜！</p><p id="5c51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最初按照<a class="kt ku ep" href="https://medium.com/u/bc17bd299bf1?source=post_page-----e2442db4246f--------------------------------" rel="noopener" target="_blank">孙铁麟·梅斯特</a>的教程进行设置，但很快意识到我想做得更多(尽管我强烈推荐该系列的其余部分，从命令行的<a class="ae ks" href="https://data36.com/learn-data-analytics-bash-scratch/" rel="noopener ugc nofollow" target="_blank">数据科学)。这被证明是有点棘手，所以这里是我的演练。</a></p><h1 id="34fa" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">1.注册</h1><p id="3925" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">前往<a class="ae ks" href="https://m.do.co/c/701d1d25ae74" rel="noopener ugc nofollow" target="_blank">数字海洋</a>并创建一个账户，使用 Paypal 或信用卡(如果你使用上面的链接，你将获得一些免费积分，我也会。如果你不想这样做，只需<a class="ae ks" href="https://www.digitalocean.com/" rel="noopener ugc nofollow" target="_blank">点击这里</a>)。</p><p id="120f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你是学生，你还可以从<a class="ae ks" href="https://education.github.com/pack/offers" rel="noopener ugc nofollow" target="_blank"> Github 学生包</a>中获得 50 美元的积分(我也强烈推荐)。当我注册时，Digital Ocean 最初不接受我的代码，但我提交了一张支持票，他们在几个小时内就把它记入了帐户。</p><h1 id="cc9d" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">2.你的第一滴</h1><p id="de05" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">Droplets 是专门为您保留的服务器空间。你只有在有液滴的时候才会带电(不管它是开着还是关着)，但创造和破坏它们很容易，所以不用担心在你不积极使用它的时候会带电。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/f29b0b686d837e6f4f5cd5abd5bf82ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*PjJmIYaBZHqkRzn_V0x2-g.png"/></div></figure><p id="f833" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“DO”面板的右上角(如果您还没有 Droplet，则在中间)，找到“创建 Droplet”按钮。</p><p id="d6d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击它会将您带到设置页面。第一个选项是图像:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/62df4b75260abe5e154748c8a8c72214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5HuXMeV1IFo_xBg1vs5XlA.png"/></div></div></figure><p id="b258" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将没有快照选项(稍后会详细介绍)，但是默认选项(Ubuntu)是我们想要的，所以您在这里不需要做任何事情。</p><p id="cd2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个选择是定价计划:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ml"><img src="../Images/c55154d4875b34974518d14607a1fa24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xmj5-JTbazo5D8hgV5Nvgg.png"/></div></div></figure><p id="de3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里你可以看到你得到了什么，以及它的价格。水滴存在的时间是按小时收费的，所以除非你结束后不删除它，否则你的费用会比每月报价低很多。</p><p id="ae75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你选择哪一个取决于几件事:</p><ul class=""><li id="410b" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">你要载入内存的文件有多大？(例如熊猫数据帧)。价格下面第一行是水滴有多少内存/多少 CPU。</li><li id="b32a" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">你的流程可以分布式吗？(想想<code class="fe na nb nc nd b">sklearn njobs= -1</code>)。如果可以的话，多个 CPU 会加快处理速度。同样，如果您有大量数据，将数据分成两半并同时运行作业将节省时间，但这仅适用于具有 1 个以上 CPU 的 droplets。</li><li id="51cd" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">你要上传的数据文件有多大？这是第二行，可用的存储量。</li><li id="54a8" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">最后一行表示允许的数据传输量(上传+下载)。除非你在做非常疯狂的事情，否则 1TB 足够了。</li></ul><p id="f19e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我建议开始时选择 5 美元/月。如果你碰壁了，升级很容易。</p><p id="25a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三步是添加块存储。最初你不需要这个。</p><p id="e7f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第四是选择数据中心:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ne"><img src="../Images/e13c761f3cb2814751e394c801941eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ER2JeaciX77wW8PMVb8tAw.png"/></div></div></figure><p id="8ee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在爱尔兰，所以选择了伦敦。选择离你最近的。</p><p id="eb21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一步是启用监控(稍后会详细介绍)并给你的 droplet 起一个真正有用的名字！</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi nf"><img src="../Images/d5bdb42ddc2242b2000e71ab2fb39f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQJTpuUFEngcoh3z1T2rew.png"/></div></div></figure><p id="b16d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后点击创建水滴，大约一分钟后，你就一切就绪了！</p><h1 id="1a59" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">3.初始设置和快照</h1><p id="69d4" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">当你完成后，你会收到一封电子邮件从数字海洋与 IP 地址，用户名和密码。复制 IP 地址，启动命令行并输入:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="3c90" class="nk kw iq nd b gy nl nm l nn no">ssh root@[IP Address]</span></pre><p id="55c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这挂起并且没有任何反应，您可以尝试:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="3a6c" class="nk kw iq nd b gy nl nm l nn no">ping [IP Address]</span></pre><p id="4f2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看你是否有联系。如果没有，你可能被外部防火墙(你的工作单位或大学)阻挡了。这发生在我身上，你无能为力:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi np"><img src="../Images/9dd7176d5bb57d6c55201a044332e605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyHVDv89dziBoV4o0LDpGQ.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Hit CTRL-C to stop it after 10 or so packets</figcaption></figure><p id="1a91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你确实收到了<code class="fe na nb nc nd b">ssh root@[IP Address]</code>的回复，会有一堆短信问你是否要继续。写下<code class="fe na nb nc nd b">yes</code>并按回车键。</p><p id="b854" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后会要求您输入密码。从邮件中复制并粘贴，然后按回车键。然后，您需要更改 root 密码。这样做很安全，因为你不会经常登录 root，但如果其他人这样做，他们完全可以破坏你的 droplet。</p><p id="1abb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，您想要创建一个用户:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="6e13" class="nk kw iq nd b gy nl nm l nn no">adduser [username]</span></pre><p id="2800" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中[用户名]是您想要的任何东西。</p><p id="7bcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你必须为这个用户创建一个密码，它会要求你提供一些个人信息。如果你愿意，输入这个，或者跳过它(按回车键)，都没关系。</p><p id="5aab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，给你的新帐户权限在服务器上做事情</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="9878" class="nk kw iq nd b gy nl nm l nn no">usermod -aG sudo [username]<br/>gpasswd -a [username] sudo</span></pre><p id="8ee4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使您能够在不登录 root 用户的情况下进行更改。</p><p id="7668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，更改时区:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="d862" class="nk kw iq nd b gy nl nm l nn no">sudo dpkg-reconfigure tzdata</span></pre><p id="8a93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并选择您当前所在的城市。</p><p id="cd22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不错！我们都在 root 上设置好了。现在，我们可以退出并检查您的用户帐户。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="a810" class="nk kw iq nd b gy nl nm l nn no">exit</span><span id="4a0f" class="nk kw iq nd b gy nu nm l nn no">ssh [username]@[IP Address]</span></pre><p id="2322" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录后，第一步是配置 bash 配置文件，让您的生活更轻松。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="1072" class="nk kw iq nd b gy nl nm l nn no">nano .profile</span></pre><p id="ac0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你以前没有用过 Nano，它是一个简单的文本编辑器。使用箭头键移动，<code class="fe na nb nc nd b">Ctrl+k</code>剪切一行，<code class="fe na nb nc nd b">Ctrl+u</code>粘贴一行，<code class="fe na nb nc nd b">Ctrl+o</code>保存，<code class="fe na nb nc nd b">Ctrl-x</code>退出。</p><p id="a0ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在这里添加别名(快捷方式)以使生活更轻松。我使用 Python 3 和 Pip 3，所以我通常通过设置来避免混淆:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="d6fc" class="nk kw iq nd b gy nl nm l nn no">alias python="python3"<br/>alias pip="pip3"</span></pre><p id="08d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我想更改或检查我的 bash 配置文件时，我也讨厌键入<code class="fe na nb nc nd b">nano ~/.profile</code>，所以我也使用别名:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="1ffb" class="nk kw iq nd b gy nl nm l nn no">alias obp="nano ~/.profile"<br/>alias sbp="source ~/.profile"</span></pre><p id="6fd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以在此添加任何其他别名。用<code class="fe na nb nc nd b">Ctrl+o</code>保存，用<code class="fe na nb nc nd b">Ctrl-x</code>退出。</p><p id="74d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要实现这些更改，您需要获取概要文件:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="f8f0" class="nk kw iq nd b gy nl nm l nn no">source .profile</span></pre><p id="c365" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(顺便说一句，在找到新的别名快捷方式之前，不能使用它们，所以简单地输入<code class="fe na nb nc nd b">sbp</code>还不行，但是在你找到它之后就可以了)。</p><p id="764c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe na nb nc nd b">apt-get</code>有点像命令行的 Pip，应该在我们继续之前更新。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="9231" class="nk kw iq nd b gy nl nm l nn no">sudo apt-get update</span></pre><p id="9e30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Python 3 已经安装了，但是 Pip 还没有，所以让我们继续获取并更新它:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="0874" class="nk kw iq nd b gy nl nm l nn no">sudo apt-get install python3-pip<br/>pip install -upgrade pip</span></pre><p id="0c14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你可以<code class="fe na nb nc nd b">pip install</code>你所有的常规 Python 包了！你马上就可以。出于某种原因，Matplotlib 和其他一些软件包在 Ubuntu 上有问题，但是您可以通过运行以下命令来解决这些问题:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="290c" class="nk kw iq nd b gy nl nm l nn no">sudo apt-get install libfreetype6-dev libxft-dev<br/>sudo apt-get install python-setuptools</span></pre><p id="5961" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，现在你可以用<code class="fe na nb nc nd b">pip3 install</code>发疯了。如果您有一个用于所有安装的<code class="fe na nb nc nd b">requirements.txt</code>文件，现在就可以运行它。</p><p id="bd8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，<a class="ae ks" href="https://geoff.greer.fm/ag/" rel="noopener ugc nofollow" target="_blank"> AG </a>是非标准的命令行搜索工具，所以如果你愿意，你也可以安装它:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="2516" class="nk kw iq nd b gy nl nm l nn no">sudo apt install silversearcher-ag</span></pre><p id="b61c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，你都准备好了！现在，这是一个相当大的工作量，每次都必须这样做是很糟糕的。这就是数字海洋快照的用武之地！</p><p id="a798" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一种将你当前的 droplet“另存为”的方法，这样当你下次创建一个新的 droplet 时，你就可以加载那个图像，然后你就可以从你离开的地方开始了！完美。</p><p id="bbea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe na nb nc nd b">sudo poweroff</code>关闭你的 droplet，进入你的数字海洋 droplet 页面上的快照菜单项:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5c1b0d7b53190107a761cc399f07d16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*Ar-0WyAEDj0XkJOUMuofeA.png"/></div></figure><p id="cb40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快照不是免费的，它们每月每 Gb 0.05 美元。我在安装 Pandas、Numpy、Matplotlib 和其他一些软件包时拍摄的快照是 1.85Gb，所以每年大约是 1.11 美元。考虑到每次设置一个水滴会节省你 10 分钟，还不错！</p><p id="c801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于您的 droplet 已经关闭，请点击“拍摄实时快照”按钮，数字海洋将完成剩下的工作。</p><p id="5b2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个旁注，你似乎不能从一个更便宜的液滴定价方案中读出一个快照。只是一些需要记住的事情。</p><p id="eee1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想升级你的定价方案，请点击“调整大小”菜单项。同样，你不能在这里降级，如果你想，你需要从头开始创建一个 droplet，并重复上述步骤。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/b021f4293f0e9238ea78c089882f68cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:452/format:webp/1*-sN_9bYB6MgANDW7HvtmSw.png"/></div></figure><p id="e76b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要重新打开 droplet，请前往数字海洋，在 droplet 页面的右上角有一个开/关开关。重新打开它，你就可以上传数据了。</p><h1 id="aae6" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">4.通过 SFTP 上传数据</h1><p id="cfa7" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">现在，如果你的个人电脑上有数据，想把它上传到云端，你需要通过 SFTP(安全文件传输协议)来实现。这是相当容易的，虽然它没有闪电快。</p><p id="677c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，建立一个 SFTP 连接:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="3800" class="nk kw iq nd b gy nl nm l nn no">sftp [username]@[IP Address]</span></pre><p id="3104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以使用普通的命令行功能，如<code class="fe na nb nc nd b">cd</code>、<code class="fe na nb nc nd b">ls</code>和<code class="fe na nb nc nd b">pwd</code>，在服务器上的文件系统中移动。然而，由于某种原因，自动完成(tab)在 SFTP 上不起作用。出于这个原因，我建议把你所有的文件和代码上传到主目录，然后用<code class="fe na nb nc nd b">ssh</code>重新登录，用<code class="fe na nb nc nd b">mv</code>和自动完成功能移动内容。相信我，这简单多了。</p><p id="ecdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那是在服务器端，但是在你的个人电脑上移动呢？同样的命令也可以工作，但是你需要在它们前面加上一个额外的<code class="fe na nb nc nd b">l</code>，即<code class="fe na nb nc nd b">lcd</code>、<code class="fe na nb nc nd b">lls</code>和<code class="fe na nb nc nd b">lpwd</code>。找到本地保存文件的目录，然后使用以下命令将它们上传到服务器:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="2dcc" class="nk kw iq nd b gy nl nm l nn no">put [localFile]</span></pre><p id="8661" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者对于整个目录:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="af35" class="nk kw iq nd b gy nl nm l nn no">put -r [localDirectory]</span></pre><p id="c9ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这并不算快，对于我的 1.5Gb 数据文件，每个文件大约需要 20 分钟。很烦人，但是你能做的不多。您可以并行上传，但这意味着打开一个新的命令行标签，并再次登录 SFTP，再加上两个连接都慢了一半，所以总时间是一样的:(</p><p id="0a82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过运行以下命令来查看您使用了多少存储空间:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="8ba5" class="nk kw iq nd b gy nl nm l nn no">df -h</span></pre><p id="1215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为将来的参考，从服务器下载文件非常简单:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="0dff" class="nk kw iq nd b gy nl nm l nn no">get [remoteFile]</span></pre><p id="0dae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="304c" class="nk kw iq nd b gy nl nm l nn no">get -r [remoteDirectory]</span></pre><p id="7b61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，一旦你的数据文件上传到服务器上，你也可以上传你的 python 脚本了。如果您的本地目录配置与远程目录配置不同，请确保更改代码中的任何文件位置。</p><p id="0cd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从服务器上删除文件也和本地略有不同，因为<code class="fe na nb nc nd b">rm -rf directory</code>不起作用。你需要<code class="fe na nb nc nd b">rm filename</code>删除一个文件，或者清空一个目录然后<code class="fe na nb nc nd b">rmdir directory</code>删除一个文件夹。</p><p id="e4f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这足以让你开始，但如果你对更高级的选项感兴趣，这里有一个很好的教程<a class="ae ks" href="https://www.digitalocean.com/community/tutorials/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="d212" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我强烈建议在数据的小子集上本地测试你的所有代码(我使用 PyCharm，它很棒，也有免费的学生许可证。)通过远程连接进行故障排除可能很烦人。</p><h1 id="6ea4" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">5.运行计算</h1><p id="8b12" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">现在，你已经准备好运行一些计算了。使用<code class="fe na nb nc nd b">ssh</code>重新登录，整理所有文件，使用<code class="fe na nb nc nd b">python filename.py</code>运行任何代码，就像在本地计算机上一样。</p><p id="2e3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果当你尝试运行一些代码时得到一个<code class="fe na nb nc nd b">Killed</code>响应，这意味着你没有足够的内存来完成这项工作。你有两个选择。关闭并升级您的定价方案，或者创建一个交换文件(更多信息见下文)。</p><p id="8ca0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打印错误日志将为您提供关于错误的更多信息:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="7ee0" class="nk kw iq nd b gy nl nm l nn no">sudo cat /var/log/kern.log</span></pre><p id="e935" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在数字海洋仪表板上监控作业进度，该仪表板显示了一些漂亮的使用图表:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi nx"><img src="../Images/b4f183ce43d09d8887acdc8d2ff4e91f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9RerFXLXfI9Iwt6x1y6sA.png"/></div></div></figure><p id="3d54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您甚至可以设置警报，以便在指标低于某个级别(如 CPU)时收到电子邮件，这可以用来让您知道工作何时完成！单击图形页面顶部的“创建警报策略”进行类似设置。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/489d3e86d34841df79164b211d78338d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*F8YV_1pi4BG2LUQCM7F-0A.png"/></div></figure><p id="724a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你完成了你的处理，你可以使用 SFTP 从云中<code class="fe na nb nc nd b">get</code>你的文件，然后销毁 droplet，这样你就不会继续被收费了！</p><p id="4e99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在给你一个警告:<strong class="jp ir">写入文件</strong>时要小心。</p><p id="c4c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我浪费了很多时间运行一个<code class="fe na nb nc nd b">pandas apply</code>函数，然后用<code class="fe na nb nc nd b">df.to_csv('filename')</code>保存结果。如果服务器有任何问题(很可能会有，下面会有更多)，在写入文件之前，您将会丢失所有内容。</p><p id="cc95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的解决方法是遍历整个数据框并逐行打印结果:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="d925" class="nk kw iq nd b gy nl nm l nn no"><em class="nz">for </em>row <em class="nz">in </em>range(len(df.index)):<br/>    col_value = df.ix[row,:].values[2]<br/>    ind = df.index[row]<br/>    with open("./data_file.csv", "a") as file:<br/>        file.write(ind + ',' + function(col_value) + '\n')</span></pre><p id="e07c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这实际上是将我的数据写入了<code class="fe na nb nc nd b">csv</code>，然后我就可以根据索引值合并数据帧来排列数据。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="5891" class="nk kw iq nd b gy nl nm l nn no">result = pd.concat([df, new_data], axis=1, join_axes=[df.index])</span></pre><p id="acea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有<code class="fe na nb nc nd b">apply</code>漂亮，但是有时当处理这种规模的数据时，最好牺牲一些性能来确保您确实得到了您想要的数据！</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="dcdc" class="kv kw iq bd kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln lo oe lq lr ls bi translated">6.提高性能</h1><p id="3c37" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">DO 最大的好处之一是，您的 droplet 中可以有多达 20 个 CPU，它们可以并行运行处理。这比在一个 CPU 上处理所有数据要快得多。</p><p id="e81d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该知道您的计划有多少个 CPU，但是如果不知道，您可以使用下面的代码来检查:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="0e0f" class="nk kw iq nd b gy nl nm l nn no">cat /proc/cpuinfo | grep processor | wc -l</span></pre><p id="0cc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有 2 个，所以这意味着我可以同时运行两个进程。在我看来，这不会减慢任何一个过程，所以如果你把任务分成两半，你可以有效地工作两倍的速度。最好的方法是将所有的数据分成两半，然后对每个数据运行相同的脚本。在 Python 中，在用 pandas 导入您的数据后，我会添加以下代码。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="0de3" class="nk kw iq nd b gy nl nm l nn no">import sys</span><span id="7525" class="nk kw iq nd b gy nu nm l nn no">number_of_cores = 2<br/>length_of_df = len(df.index)<br/>stream = sys.argv[1]</span><span id="b05b" class="nk kw iq nd b gy nu nm l nn no">if stream == 1:<br/>    start = 0<br/>    end = length_of_df // number_of_cores<br/>else:<br/>    start = length_of_df // number_of_cores<br/>    end = -1</span><span id="6d37" class="nk kw iq nd b gy nu nm l nn no">data_to_process = df.iloc[start:end,:]</span><span id="76a0" class="nk kw iq nd b gy nu nm l nn no">output_filename = "output_data_" + str(sys.argv[1]) + ".csv</span></pre><p id="3f4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以从命令行运行</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="c29c" class="nk kw iq nd b gy nl nm l nn no">python script.py 1</span></pre><p id="d836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将处理前半部分的数据</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="9558" class="nk kw iq nd b gy nl nm l nn no">python script.py 2</span></pre><p id="d0d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将处理第二个。使用以下命令在最后合并两个数据文件</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="ce58" class="nk kw iq nd b gy nl nm l nn no">cat output_data_2.csv &gt;&gt; output_data_1.csv</span></pre></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="af4e" class="kv kw iq bd kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln lo oe lq lr ls bi translated">7.解决纷争</h1><p id="52fc" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">我最头疼的是让我的脚本运行完成。出于某种原因(我从来没有弄清楚)，服务器会停止运行我的处理，然后我不得不手动重启它。我的使用图表如下所示:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi of"><img src="../Images/ae59d7d34029d6a97ba933838087802f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*M-Nbkb5qTIM17AL1EEWhpw.png"/></div></figure><p id="4f9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">真的不理想，尤其是我的大学防火墙阻止了我的连接，所以我不得不等到我回家重启东西。</p><p id="37e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的解决方案的第一部分是找出 for 循环的重新开始点，这样我就不用重新计算了。我使用了<code class="fe na nb nc nd b">subprocess</code>模块，这样我就可以在 python 脚本中运行命令行函数:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="bbdd" class="nk kw iq nd b gy nl nm l nn no">import subprocess</span><span id="ec3f" class="nk kw iq nd b gy nu nm l nn no">stream = int(sys.argv[1])</span><span id="8865" class="nk kw iq nd b gy nu nm l nn no">if stream == 1:<br/>    stop = 3387532<br/>    data = "./data.csv"</span><span id="247b" class="nk kw iq nd b gy nu nm l nn no">    a = subprocess.Popen(['wc', '-l', data], stdout=subprocess.PIPE)<br/>    wc = int(a.communicate()[0].rstrip().decode().split(' ')[0])</span><span id="5824" class="nk kw iq nd b gy nu nm l nn no">    start = 0 + wc</span></pre><p id="19a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的文件中的总行数是 6，775，065，我有 2 个 CPU，所以像上面一样，我将停止索引设置为文件大小的一半。<code class="fe na nb nc nd b">subprocess.Popen</code>返回命令行函数的结果，在本例中是<code class="fe na nb nc nd b">wc -l ./data.csv</code>，或者检查输出数据中的行数。<code class="fe na nb nc nd b">stout=subprocess.PIPE</code>使输出更容易处理。下一行检索输出数据的实际行数，然后<code class="fe na nb nc nd b">start</code>被相应地设置为。</p><p id="a0ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着每当系统崩溃时，我可以简单地运行:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="fd76" class="nk kw iq nd b gy nl nm l nn no">python script.py 1; <br/>python script.py 2;</span></pre><p id="cddc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在不同的终端屏幕上，我的两半数据会在适当的地方重新启动。一个好结果！</p><p id="4d4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，这并没有阻止我的服务器崩溃，也没有在崩溃后自动重启处理。一些研究让我想到了 crontabs，它允许在特定的时间段评估函数。您可以通过以下方式查看当前的 crontabs:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="7d39" class="nk kw iq nd b gy nl nm l nn no">crontab -l</span></pre><p id="f656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里不应该有任何东西，所以您可以使用以下命令创建一个:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="e09d" class="nk kw iq nd b gy nl nm l nn no">crontab -e</span></pre><p id="16a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次，你会被要求选择一个文本编辑器，Nano 是最简单的，但是这可以在以后通过运行<code class="fe na nb nc nd b">'select-editor'</code>来改变</p><p id="e003" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不会讲太多细节，但是文件的最后一行看起来是这样的:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="8030" class="nk kw iq nd b gy nl nm l nn no"># m h  dom mon dow   command</span></pre><p id="c1b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这代表分钟、小时、月、日和命令。这允许您将命令设置为在特定的时间间隔运行。几个例子:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="32e7" class="nk kw iq nd b gy nl nm l nn no">*/10 * * * * eval "python3 script.py"</span></pre><p id="0cb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每 10 分钟运行一次脚本。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="323c" class="nk kw iq nd b gy nl nm l nn no">10 * * * * eval "python3 script.py"</span></pre><p id="b902" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每小时在整点后 10 分钟运行脚本。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="c2d7" class="nk kw iq nd b gy nl nm l nn no">10 5 * * 3 eval "python3 script.py"</span></pre><p id="aab3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每周三 5 点 10 分运行脚本。</p><p id="b597" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你明白了。对我来说，我想每 10 分钟检查一次我的服务器是否崩溃，如果是，重启它。所以我的 crontabs 是:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="b6a9" class="nk kw iq nd b gy nl nm l nn no">*/10 * * * * eval "python3 sys_test_1.py"<br/>*/10 * * * * eval "python3 sys_test_2.py"</span></pre><p id="af02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(我必须有两个，因为从同一个文件在不同的 CPU 上运行 python 脚本很困难，这样更容易)。如果你感兴趣，这里有更多关于 crontabs <a class="ae ks" href="https://www.digitalocean.com/community/tutorials/how-to-schedule-routine-tasks-with-cron-and-anacron-on-a-vps" rel="noopener ugc nofollow" target="_blank">的详细解释</a>。</p><p id="0c4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我的文件<code class="fe na nb nc nd b">sys_test_1.py</code>看起来像这样:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="e66f" class="nk kw iq nd b gy nl nm l nn no">data = "./data.csv"</span><span id="e426" class="nk kw iq nd b gy nu nm l nn no">a = subprocess.Popen(['wc', '-l', data], stdout=subprocess.PIPE)<br/>wc_1 = int(a.communicate()[0].rstrip().decode().split(' ')[0])</span><span id="d8fb" class="nk kw iq nd b gy nu nm l nn no">if wc_1 &gt; 3387530:<br/>    exit()<br/>else:<br/>    time.sleep(15)</span><span id="3912" class="nk kw iq nd b gy nu nm l nn no">    b = subprocess.Popen(['wc', '-l', data], stdout=subprocess.PIPE)<br/>    wc_2 = int(b.communicate()[0].rstrip().decode().split(' ')[0])</span><span id="94df" class="nk kw iq nd b gy nu nm l nn no">    if wc_1 == wc_2:<br/>        subprocess.call(["python3", "run_comp.py", "1"])</span></pre><p id="62ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我检查文件中的行数，如果超过了某个阈值(即接近所需计算的末尾)，就退出。否则，等待 15 秒并再次检查文件长度。如果它们相同，这意味着没有正在进行的计算，所以它从命令行调用计算脚本。</p><p id="ff36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我特别调用了<code class="fe na nb nc nd b">'python3'</code>，尽管我在 bash 配置文件中设置了一个别名<code class="fe na nb nc nd b">alias python="python3"</code>。用子进程调用 python 脚本似乎会忽略别名，所以要记住这一点。</p><p id="cc03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，每 10 分钟运行一次，我就有办法检查是否有问题，如果有问题，就自动重新开始处理。自从我修复了这个问题，我的服务器就一直不停地运行，任何崩溃都会被快速捕获，处理会重新开始。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi og"><img src="../Images/8eec112bf2beadfe33b04386ea30a529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PrCxDPraXLqw9qf46cBIbQ.png"/></div></div></figure><p id="06ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完美！</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="bece" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你知道了！您现在知道如何在云服务器上创建、设置、上传数据和运行脚本了！大数据，你来了！</p><p id="2629" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面有更多关于交换文件的解释，但那是可选的阅读…</p><p id="8914" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请点击❤按钮让你的粉丝知道，或者让我知道你的想法。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="9192" class="kv kw iq bd kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln lo oe lq lr ls bi translated">交换文件</h1><p id="44c1" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">交换文件是一种给你的 droplet 额外的内存的方法，通过对硬盘进行分区。这样，当系统内存不足时，它可以将一些数据保存到光盘上，以便以后检索。这将让你用更便宜的方案做更多的事情，但是速度会慢很多。请记住，升级您的计划可能会更好。</p><p id="75fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建交换文件，请运行</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="ab56" class="nk kw iq nd b gy nl nm l nn no">sudo fallocate -l 4G /swapfile</span></pre><p id="9872" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中 4G 代表文件的大小，即 4 gb。这是您想要的内存大小。太大了，你就没有空间存放其他文件，太小了，你还是会耗尽内存。4 gb 应该没问题。</p><p id="82ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您需要授予对该目录的写权限，创建交换文件，并激活它:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="8f9d" class="nk kw iq nd b gy nl nm l nn no">sudo chmod 600 /swapfile<br/>sudo mkswap /swapfile<br/>sudo swapon /swapfile</span></pre><p id="f76f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开 fstab 文件:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="c286" class="nk kw iq nd b gy nl nm l nn no">sudo nano /etc/fstab</span></pre><p id="0808" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并添加到文件底部:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="92e8" class="nk kw iq nd b gy nl nm l nn no">/swapfile none swap sw 0 0</span></pre><p id="ee89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个名为 swappiness(很棒的名字)的参数设置了内存交换到磁盘的数量和频率。值越高，交换的频率越高。我们不希望它交换那么多，所以我们希望将默认值(60%)更改为 10%。</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="cf37" class="nk kw iq nd b gy nl nm l nn no">sudo sysctl vm.swappiness=10</span></pre><p id="7040" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要将此设置为默认值，请打开:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="ce4f" class="nk kw iq nd b gy nl nm l nn no">sudo nano /etc/sysctl.conf</span></pre><p id="396b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并添加到文件底部:</p><pre class="lz ma mb mc gt ng nd nh ni aw nj bi"><span id="37e6" class="nk kw iq nd b gy nl nm l nn no">vm.swappiness=10</span></pre></div></div>    
</body>
</html>