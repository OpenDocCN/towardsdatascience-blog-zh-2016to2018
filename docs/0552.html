<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://towardsdatascience.com/structure-and-automated-workflow-for-a-machine-learning-project-2fa30d661c1e?source=collection_archive---------0-----------------------#2017-05-20">https://towardsdatascience.com/structure-and-automated-workflow-for-a-machine-learning-project-2fa30d661c1e?source=collection_archive---------0-----------------------#2017-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/695074f701cd08b136ab68199572eb1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHMDskUaYxpheuhKOgT-Ow.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">How am I supposed to run this from the beginning?</figcaption></figure><p id="9c4a" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi kc translated"><span class="l kd ke kf bm kg kh ki kj kk di"> Y </span>你对机器学习项目有了一个全新的想法。首先，你下载数据集。然后执行某种预处理——可能需要多个步骤，因为任务很复杂。你创建了一堆模型，其中一些表现更好，而另一些表现更差。哦，妈的，我改写了我最好的模型。没问题——我会再训练它一次。等等。参数是什么？哦，明白了。我基本上完成了——只是生成一些好的情节，仅此而已。也许我应该重构一下？不，一切都很好，而且——我可能会打破一些东西，因为它很脆弱。</p><p id="dd9b" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">几个月后，你想回到它，也许稍微修改一下，以处理新的数据。小菜一碟。Git 克隆我的 coolproject 然后…你的大脑一片空白。我应该执行什么？按什么顺序？什么玩意儿<em class="kl">系统找不到指定的路径</em>？数据以前是从哪里来的？妈的，我不能重现以前的结果:c 为什么？</p><blockquote class="km kn ko"><p id="bf30" class="jd je kl jg b jh ji jj jk jl jm jn jo kp jq jr js kq ju jv jw kr jy jz ka kb ij bi translated">混乱是唯一正确的答案</p></blockquote><figure class="kt ku kv kw gt is gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/29487a296d2b630e8f12edb0f73fcc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/0*aX9Mzk21rX05Zyf_.png"/></div></figure><p id="6b81" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">长得差不多？我打赌你经历过类似的场景，尤其是如果你在机器学习方面没有太多经验的话。如果您没有在最终将被部署的模型中工作，那么您可能会“被迫”以正确的方式做事。另一方面，你不想花太多时间来构建你的项目。在这里，我将向您介绍简单的方法。</p><h1 id="2088" class="kx ky jf bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><p id="053f" class="pw-post-body-paragraph jd je jf jg b jh lv jj jk jl lw jn jo jp lx jr js jt ly jv jw jx lz jz ka kb ij bi translated">但是在我们开始之前，我对你做了一些假设；)</p><ul class=""><li id="84ce" class="ma mb jf jg b jh ji jl jm jp mc jt md jx me kb mf mg mh mi bi translated">你对机器学习相当熟悉(非常基础的水平就够了)</li><li id="35a6" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">你对 Python 相当熟悉(我用的是 Python 3)</li><li id="6d36" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">你想学点东西；)</li><li id="c38c" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">您安装了 Anaconda</li><li id="0833" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">你用 Windows 或者 Linux。我没有在 MacOs 上测试所有东西，但是我相信它应该可以工作。如果你在 Windows 上安装<code class="fe mo mp mq mr b">make</code>有问题，请在评论中告诉我。</li></ul><p id="dd99" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">好的，那么介绍的方法有什么好处呢？</p><ul class=""><li id="958e" class="ma mb jf jg b jh ji jl jm jp mc jt md jx me kb mf mg mh mi bi translated">您将能够通过一个命令执行从抓取数据到生成报告的整个过程</li><li id="7c8e" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">你将能够复制你的作品</li><li id="da47" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">一年后当你回到项目时，你会感谢你自己</li><li id="80b4" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated">其他人能够理解你的代码(也是潜在的雇主)</li></ul><p id="d350" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">我将把所有内容作为一个完整的小项目来展示。</p><h1 id="c2d7" class="kx ky jf bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">新存储库</h1><p id="9ae8" class="pw-post-body-paragraph jd je jf jg b jh lv jj jk jl lw jn jo jp lx jr js jt ly jv jw jx lz jz ka kb ij bi translated">开始时，从 GitHub 克隆新的回购协议后，我们有以下结构:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="f233" class="mw ky jf mr b gy mx my l mz na">LICENSE  README.md</span></pre><p id="3852" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">让我们从创造可复制的环境开始。创建名为<code class="fe mo mp mq mr b">environment.yml</code>的文件，我们可以从以下内容开始:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="df17" class="mw ky jf mr b gy mx my l mz na">dependencies:<br/> - python=3.5<br/> - numpy<br/> - scipy<br/> - scikit-learn<br/> - jupyter<br/> - requests</span></pre><p id="2425" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">随着项目的发展，我们将不断更新这个文件。但是现在让我们创建一个实际的 env:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="e319" class="mw ky jf mr b gy mx my l mz na">conda env create -f environment.yml -n chaos</span></pre><p id="f2be" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">妈的，我忘了包括 jupyter 包。别担心。用 jupyter 更新<code class="fe mo mp mq mr b">environment.yml</code>然后运行</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="76c1" class="mw ky jf mr b gy mx my l mz na">conda env update -f environment.yml -n chaos</span></pre><p id="8936" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">让我们看看它是否有效</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="5278" class="mw ky jf mr b gy mx my l mz na">activate chaos<br/>jupyter notebook</span></pre><p id="4d94" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">看起来很好。</p><h1 id="bf43" class="kx ky jf bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">下载数据</h1><p id="4c6f" class="pw-post-body-paragraph jd je jf jg b jh lv jj jk jl lw jn jo jp lx jr js jt ly jv jw jx lz jz ka kb ij bi translated">第一步是下载数据。但是我们不会通过从下载目录复制来完成。相反:我们可以在<code class="fe mo mp mq mr b">src/data/download.py</code>中创建 python 脚本</p><blockquote class="km kn ko"><p id="0f57" class="jd je kl jg b jh ji jj jk jl jm jn jo kp jq jr js kq ju jv jw kr jy jz ka kb ij bi translated">当然，创建脚本而不仅仅是 wget 是一件非常复杂的事情，但是我这样做的目的是提供一个有教育意义的例子；)你可以想象抓取数据更复杂，需要脚本。</p></blockquote><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="1eee" class="mw ky jf mr b gy mx my l mz na">import requests</span><span id="339c" class="mw ky jf mr b gy nb my l mz na">url <strong class="mr nc">=</strong> 'https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data'<br/>filename <strong class="mr nc">=</strong> 'data/raw/iris.csv'</span><span id="0f86" class="mw ky jf mr b gy nb my l mz na"><strong class="mr nc">with</strong> open(filename, 'wb') <strong class="mr nc">as</strong> ofile:<br/>   response <strong class="mr nc">=</strong> requests<strong class="mr nc">.</strong>get(url)<br/>   file<strong class="mr nc">.</strong>write(response<strong class="mr nc">.</strong>content)</span></pre><p id="7231" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">并尝试运行它</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="da1b" class="mw ky jf mr b gy mx my l mz na"><strong class="mr nc">(</strong>chaos<strong class="mr nc">)</strong> λ python src/data/download.py<br/>Traceback <strong class="mr nc">(</strong>most recent call last<strong class="mr nc">)</strong>:<br/>  File "src/data/download.py", line 6, <strong class="mr nc">in</strong> &lt;module&gt;<br/>    with open<strong class="mr nc">(</strong>filename, 'wb'<strong class="mr nc">)</strong> as ofile:<br/>FileNotFoundError: <strong class="mr nc">[</strong>Errno 2] No such file or directory: 'data/raw/iris.csv'</span></pre><p id="a491" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">它不起作用。因为目录<code class="fe mo mp mq mr b">data/raw</code>不在那里。在我们创建它之前，请稍等片刻。这里是停下来思考一会儿的好地方。首先:我们的代码对于不存在的目录应该是健壮的。接下来，我们不应该手动创建任何目录。如果你的同事在保存结果的过程中被迫每小时手动创建一个目录，他会不高兴的。同样，当我们引用一个目录时总是调用<code class="fe mo mp mq mr b">mkdir(exist_ok=True) </code>可能不是一个好主意。</p><p id="5bf6" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">此外，下载数据是我们工作流程的第一步，应该是可重复的。</p><p id="4ef6" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">所以让我们开始解决这个问题。开始时，为数据创建目录结构。他们有三个人:</p><ul class=""><li id="9556" class="ma mb jf jg b jh ji jl jm jp mc jt md jx me kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">data/raw</code>——这里所有的原始数据都存在。这个目录应该被认为是只读的——让我们得到的东西保持原样。</li><li id="c53c" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">data/processed</code> -经过整体预处理、合并、清洗、特征工程等后的数据。</li><li id="c799" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">data/interim</code>——介于原始和加工之间的中间格式。不是生的，也没有准备好。</li><li id="e068" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">data/external</code> -我们认为是外部的任何数据。例如字典、同义词。</li></ul><figure class="kt ku kv kw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/ba0f878db35c7ceecebb4052a2602c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*no6lYIk9qqcb0kSw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Flow for the data</figcaption></figure><p id="6b46" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">我们说过，我们需要一种方法来强制实施此目录的现有内容，这种方法很简单:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="0bdb" class="mw ky jf mr b gy mx my l mz na">mkdir -p data/raw data/interim data/external data/processed<br/>touch data/external/.gitkeep data/raw/.gitkeep data/interim/.gitkeep data/processed/.gitkeep</span></pre><p id="44b2" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">Git 不存储空目录。通过创建一个空的<code class="fe mo mp mq mr b">.gitkeep</code>文件，我们可以加强目录持久性。默认情况下，数据不应该存储在 git 存储库中——因此我们需要调整<code class="fe mo mp mq mr b">.gitignore</code>:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="e095" class="mw ky jf mr b gy mx my l mz na"># exclude data from source control by default<br/>/data/</span></pre><p id="2769" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">但是这使得 git 看不到数据目录。所以它不会在克隆时创建它们。为此，我们必须强制添加<code class="fe mo mp mq mr b">.gitkeep</code></p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="7040" class="mw ky jf mr b gy mx my l mz na">git add -f data/external/.gitkeep data/processed/.gitkeep data/interim/.gitkeep data/raw/.gitkeep<br/>git add .gitignore<br/>git status</span></pre><p id="fc49" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">我们应该看到类似这样的内容:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="d3d5" class="mw ky jf mr b gy mx my l mz na">c:\code\overcome-the-chaos <strong class="mr nc">(</strong>master<strong class="mr nc">)</strong><br/><strong class="mr nc">(</strong>chaos<strong class="mr nc">)</strong> λ git status<br/>On branch master<br/>Your branch is up-to-date with 'origin/master'.<br/>Changes to be committed:<br/>  <strong class="mr nc">(</strong>use "git reset HEAD &lt;file&gt;..." to unstage<strong class="mr nc">)</strong></span><span id="a1de" class="mw ky jf mr b gy nb my l mz na">        modified:   .gitignore<br/>        new file:   data/external/.gitkeep<br/>        new file:   data/interim/.gitkeep<br/>        new file:   data/processed/.gitkeep<br/>        new file:   data/raw/.gitkeep</span><span id="a92c" class="mw ky jf mr b gy nb my l mz na">Untracked files:<br/>  <strong class="mr nc">(</strong>use "git add &lt;file&gt;..." to include <strong class="mr nc">in </strong>what will be committed<strong class="mr nc">)</strong></span><span id="0472" class="mw ky jf mr b gy nb my l mz na">        environment.yml<br/>        src/</span></pre><p id="3916" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">如果是这样，我们可以</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="dc80" class="mw ky jf mr b gy mx my l mz na">git commit -m "Empty data directories"</span></pre><p id="b7a2" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">从现在开始，我不会明确地承诺使用 git 您可以随时这样做。</p><h1 id="1c69" class="kx ky jf bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">工作流程</h1><p id="a69a" class="pw-post-body-paragraph jd je jf jg b jh lv jj jk jl lw jn jo jp lx jr js jt ly jv jw jx lz jz ka kb ij bi translated">好了，我们解决了目录问题。让我们继续工作流。下载是非常第一步，应该写得正确。但这意味着什么呢？参数应该可以通过命令行参数传递。为此，我们将使用点击库。添加到<code class="fe mo mp mq mr b">environment.yml</code></p><p id="6c70" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated"><code class="fe mo mp mq mr b">- click</code></p><p id="2771" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">并更新 env。</p><p id="08a0" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">脚本可能是这样的:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="4355" class="mw ky jf mr b gy mx my l mz na">import requests<br/>import click</span><span id="afe1" class="mw ky jf mr b gy nb my l mz na">@click.command()<br/>@click.argument('url')<br/>@click.argument('filename', type<strong class="mr nc">=</strong>click<strong class="mr nc">.</strong>Path())<br/><strong class="mr nc">def</strong> <strong class="mr nc">download_file</strong>(url, filename):<br/>   <strong class="mr nc">print</strong>('Downloading from {} to {}'<strong class="mr nc">.</strong>format(url, filename))<br/>   response <strong class="mr nc">=</strong> requests<strong class="mr nc">.</strong>get(url)<br/>   <strong class="mr nc">with</strong> open(filename,  'wb') <strong class="mr nc">as</strong> ofile:<br/>       ofile<strong class="mr nc">.</strong>write(response<strong class="mr nc">.</strong>content)</span><span id="668e" class="mw ky jf mr b gy nb my l mz na"><strong class="mr nc">if</strong> __name__ <strong class="mr nc">==</strong> '__main__':<br/>   download_file()</span></pre><p id="3ef8" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">哇，到目前为止，我们绝对没有把事情简单化。</p><p id="03e4" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">解释一下:我们用两个参数定义命令，点击<em class="kl">按钮</em>将为我们处理这个问题。如果我们键入:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="efb8" class="mw ky jf mr b gy mx my l mz na">python src<strong class="mr nc">/</strong>data<strong class="mr nc">/</strong>download<strong class="mr nc">.</strong>py <strong class="mr nc">--</strong>help</span></pre><p id="1dc7" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">我们将会看到:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="12ed" class="mw ky jf mr b gy mx my l mz na">Usage: download<strong class="mr nc">.</strong>py [OPTIONS] URL FILENAME</span><span id="d281" class="mw ky jf mr b gy nb my l mz na">Options:<br/>  <strong class="mr nc">--</strong>help  Show this message <strong class="mr nc">and</strong> exit<strong class="mr nc">.</strong></span></pre><p id="b543" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">看起来不错。对于实际下载，我们必须调用:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="3c4b" class="mw ky jf mr b gy mx my l mz na">python src/data/download.py "https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data" data/raw/iris.csv</span></pre><h1 id="8409" class="kx ky jf bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">制造</h1><p id="5f52" class="pw-post-body-paragraph jd je jf jg b jh lv jj jk jl lw jn jo jp lx jr js jt ly jv jw jx lz jz ka kb ij bi translated">现在我们已经准备好自动化工作流了。我们将使用… <strong class="jg nc"> GNU Make </strong>。不。我没开玩笑。这个工具非常适合我们的需要。此外，编写 Makefiles 并没有您想象的那么可怕。有趣的事实:在实践中，这是一个在 Linux、Mac 和 Windows 之间非常容易移植的解决方案。</p><p id="a0fc" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">我们的第一个工作流程将由三个步骤组成。</p><ul class=""><li id="957e" class="ma mb jf jg b jh ji jl jm jp mc jt md jx me kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">clean</code> -将删除所有生成的输出</li><li id="9d57" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">all</code> -将从开始到结束运行整个管道</li><li id="ff97" class="ma mb jf jg b jh mj jl mk jp ml jt mm jx mn kb mf mg mh mi bi translated"><code class="fe mo mp mq mr b">download</code> -将下载数据</li></ul><p id="e4fa" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">所有都依赖于下载，所以我们有一个依赖关系图</p><figure class="kt ku kv kw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/c12b4cdbf4619720726cf2b7d0d666f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5loU1aNWoQTTX3_3.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Dependency graph for simple workflow. Arrow means “all depends on download”</figcaption></figure><p id="a728" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">当然，这个图以后会长大的。make 的好处是，它可以自己处理大部分的复杂性。</p><p id="9ee3" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">创建<code class="fe mo mp mq mr b">Makefile </code>并添加第一个目标</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="1d9f" class="mw ky jf mr b gy mx my l mz na">clean<strong class="mr nc">:</strong><br/> rm -f data/raw/*.csv</span></pre><p id="ae53" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">这很明显——删除所有下载的数据。让我们检查一下</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="9fb5" class="mw ky jf mr b gy mx my l mz na">make clean<br/>rm -f data/raw/*.csv</span></pre><p id="e02d" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">而<code class="fe mo mp mq mr b">iris.csv</code>不见了</p><blockquote class="km kn ko"><p id="cd68" class="jd je kl jg b jh ji jj jk jl jm jn jo kp jq jr js kq ju jv jw kr jy jz ka kb ij bi translated">如果您有如下错误:</p><p id="1222" class="jd je kl jg b jh ji jj jk jl jm jn jo kp jq jr js kq ju jv jw kr jy jz ka kb ij bi translated">makefile:2:* * * *缺少分隔符。停下来。</p><p id="a478" class="jd je kl jg b jh ji jj jk jl jm jn jo kp jq jr js kq ju jv jw kr jy jz ka kb ij bi translated">确保您的编辑器没有用多个空格替换制表符。</p></blockquote><p id="f4d3" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">下一个目标是下载</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="bf5d" class="mw ky jf mr b gy mx my l mz na">data/raw/iris.csv<strong class="mr nc">:</strong><br/>  python src/data/download.py "https<strong class="mr nc">://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data" $@</strong></span></pre><p id="f3a9" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">冒号之前是目标名称—通常是将要创建的文件(我很快会回到这个话题)。冒号后—任务的相关性。正如我们所见，下载是我们工作流程的第一步，因此没有任何先决条件。只有一个命令可以“构建”iris . CSV——调用下载脚本。这个疯狂的<code class="fe mo mp mq mr b">$@</code>意味着“规则中的第一个目标”。我们只有一个目标(data/raw/iris.csv ),因此它将被插入此处。我们可以进行一次试驾:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="edac" class="mw ky jf mr b gy mx my l mz na">make data/raw/iris.csv <br/>python src/data/download.py "https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data" data/raw/iris.csv<br/>Downloading from https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data to data/raw/iris.csv</span></pre><p id="2dc3" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">事实上，文件已经被下载了:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="0500" class="mw ky jf mr b gy mx my l mz na">tree data<br/>data<br/>├── external<br/>├── interim<br/>├── processed<br/>└── raw<br/>    └── iris.csv</span></pre><p id="98d0" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">让我们试着再执行一次:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="f4c4" class="mw ky jf mr b gy mx my l mz na">make data/raw/iris.csv<br/>make: 'data/raw/iris.csv' is up to date.</span></pre><p id="e384" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">Make 知道目标已经存在，不需要重建它。</p><p id="4b97" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">只剩一件了——<code class="fe mo mp mq mr b">all</code>。我们将其定义如下:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="c05f" class="mw ky jf mr b gy mx my l mz na">all: data/raw/iris.csv</span></pre><p id="4c3e" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">这意味着:“为了构建所有你需要有数据/raw/iris.csv”</p><p id="64c0" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">让我们来看看它的实际应用:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="bb59" class="mw ky jf mr b gy mx my l mz na">make clean<br/>make all<br/>python src/data/download.py "https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data" data/raw/iris.csv<br/>Downloading from https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data to data/raw/iris.csv<br/>tree data<br/>data<br/>├── external<br/>├── interim<br/>├── processed<br/>└── raw<br/>    └── iris.csv</span></pre><p id="eaf3" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">有效:)</p><h2 id="a995" class="mw ky jf bd kz ne nf dn ld ng nh dp lh jp ni nj ll jt nk nl lp jx nm nn lt no bi translated">关于 Makefile 的更多信息</h2><p id="e514" class="pw-post-body-paragraph jd je jf jg b jh lv jj jk jl lw jn jo jp lx jr js jt ly jv jw jx lz jz ka kb ij bi translated">还有三件事要补充。当你键入 make 时，它将执行第一个目标。因此，将所有第一目标放入文件中是合理的。其次，你可以使用变量——比如存储 URL</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="811b" class="mw ky jf mr b gy mx my l mz na">IRIS_URL <strong class="mr nc">=</strong> "https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data"</span><span id="abe9" class="mw ky jf mr b gy nb my l mz na">data/raw/iris.csv<strong class="mr nc">:</strong><br/>  python src/data/download.py $(IRIS_URL) $@</span></pre><p id="3b55" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">最后，不创建文件的目标应该标记为<code class="fe mo mp mq mr b">.PHONY</code></p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="ae08" class="mw ky jf mr b gy mx my l mz na">.PHONY<strong class="mr nc">:</strong> <strong class="mr nc">all clean</strong></span></pre><p id="824b" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">如果你想知道为什么，试着用<code class="fe mo mp mq mr b">all</code>或<code class="fe mo mp mq mr b">clean</code>创建文件；)</p><p id="8a7c" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">下面是最终的 Makefile:</p><pre class="kt ku kv kw gt ms mr mt mu aw mv bi"><span id="bb49" class="mw ky jf mr b gy mx my l mz na">.PHONY<strong class="mr nc">:</strong> <strong class="mr nc">all clean</strong></span><span id="4a30" class="mw ky jf mr b gy nb my l mz na">IRIS_URL <strong class="mr nc">=</strong> "https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data"</span><span id="461a" class="mw ky jf mr b gy nb my l mz na">all<strong class="mr nc">:</strong> <strong class="mr nc">data/raw/iris.csv</strong></span><span id="664f" class="mw ky jf mr b gy nb my l mz na">clean<strong class="mr nc">:</strong><br/>  rm -f data/raw/*.csv</span><span id="1adf" class="mw ky jf mr b gy nb my l mz na">data/raw/iris.csv<strong class="mr nc">:</strong><br/>  python src/data/download.py $(IRIS_URL) $@</span></pre><p id="4853" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">这是第一部分的结尾。接下来，我将向您展示如何进一步构建机器学习项目，以及如何扩展整个管道。</p><p id="c497" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">如果你想知道一些具体的事情，请留下你的评论。</p><p id="490a" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">敬请关注。</p><p id="716b" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">代码库在这里:<a class="ae np" href="https://github.com/artofai/overcome-the-chaos" rel="noopener ugc nofollow" target="_blank">https://github.com/artofai/overcome-the-chaos</a></p><p id="e61c" class="pw-post-body-paragraph jd je jf jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb ij bi translated">链接到第二部分:<a class="ae np" href="https://medium.com/@mbednarski/structure-and-automated-workflow-for-a-machine-learning-project-part-2-b5b420625102" rel="noopener">https://medium . com/@ mbdenarski/structure-and-automated-workflow-for-a-machine-learning-project-part-2-b5b 420625102</a></p></div></div>    
</body>
</html>