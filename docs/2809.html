<html>
<head>
<title>Build, Develop and Deploy a Machine Learning Model to predict cars price using Gradient Boosting.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立、开发和部署一个机器学习模型，使用梯度推进来预测汽车价格。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-develop-and-deploy-a-machine-learning-model-to-predict-cars-price-using-gradient-boosting-2d4d78fddf09?source=collection_archive---------1-----------------------#2018-03-09">https://towardsdatascience.com/build-develop-and-deploy-a-machine-learning-model-to-predict-cars-price-using-gradient-boosting-2d4d78fddf09?source=collection_archive---------1-----------------------#2018-03-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="cd70" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="8320" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这篇博文中，我将介绍一个数据科学过程，通过以下步骤来构建和部署一个可以预测汽车价格的机器学习模型:</p><ol class=""><li id="1ce4" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll lt lu lv lw bi translated">设定研究目标</li><li id="2c0b" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll lt lu lv lw bi translated">检索数据</li><li id="1357" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll lt lu lv lw bi translated">数据预处理和清理</li><li id="7c65" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll lt lu lv lw bi translated">数据探索和可视化</li><li id="c5ff" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll lt lu lv lw bi translated">数据建模</li><li id="0f24" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll lt lu lv lw bi translated">模型部署</li></ol><h1 id="3414" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">设定研究目标</h1><p id="5163" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这项工作的目的是通过构建和部署一个机器学习模型来熟悉如上所述的数据科学过程，该模型可以根据汽车的特征来预测汽车价格，方法是尝试4个回归模型，并选择具有最高R分数和最低均方根误差的模型。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/50b63723e8fd71927c0d5b207b51f7c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/1*PV-NOumJzilc5R2bGyEbRQ.gif"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Demo of the Web App</figcaption></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="2a49" class="jq jr it bd js jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn bi translated">检索数据</h1><p id="e286" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">检索数据是设定研究目标后的重要步骤，为此，我使用了专门从事这类任务的著名python库<code class="fe na nb nc nd b">“BeautifulSoup”</code>。该任务的过程非常简单，首先我们循环遍历广告页面，通过增加基本URL中名为<code class="fe na nb nc nd b">o</code>的页码参数来收集广告URL，如下所示:</p><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="976e" class="ni jr it nd b gy nj nk l nl nm">basic_url = "<a class="ae nn" href="https://www.avito.ma/fr/maroc/voitures-" rel="noopener ugc nofollow" target="_blank">https://www.avito.ma/fr/maroc/voitures-</a>à_vendre&amp;o="</span></pre><p id="7153" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">一旦URL被收集，我将它们设置在一个名为“ads_urls.csv”的<code class="fe na nb nc nd b">csv</code>文件中，如下所示:</p><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="2899" class="ni jr it nd b gy nj nk l nl nm"><a class="ae nn" href="https://www.avito.ma/fr/temara/voitures/peugeot_508_26753561.htm" rel="noopener ugc nofollow" target="_blank">https://www.avito.ma/fr/temara/voitures/peugeot_508_26753561.htm</a><br/><a class="ae nn" href="https://www.avito.ma/fr/safi/voitures/renualt_kasket_26753552.htm" rel="noopener ugc nofollow" target="_blank">https://www.avito.ma/fr/safi/voitures/renualt_kasket_26753552.htm</a><br/><a class="ae nn" href="https://www.avito.ma/fr/oued_fes/voitures/Citroen_C3_Diesel_26753551.htm" rel="noopener ugc nofollow" target="_blank">https://www.avito.ma/fr/oued_fes/voitures/Citroen_C3_Diesel_26753551.htm</a><br/>.<br/>...</span></pre><p id="c58c" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">上面这些链接中的每个链接都包含广告中发布的汽车的相关数据，例如:“车型年”、“里程”、“燃料类型”、“价格”…，看起来就像这样:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/09ec441981f92e778d7f1148100c36ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*MT0MyWqNDz1ZGuuh2LVl4A.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Car features published on the Ad page</figcaption></figure><p id="4127" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">然后，我读取这个包含要在广告页面上抓取的URL列表的文件，并提取必要的数据，所以这里有一个关于它如何工作的简短代码快照。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Extracting ad data procedure</figcaption></figure><p id="486f" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">最后我得到以下数据模式:</p><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="56f8" class="ni jr it nd b gy nj nk l nl nm">price, year_model, mileage, fuel_type, mark, model, fiscal_power, sector, type, city<br/>135 000 DH,Année-Modèle:2013,Kilométrage:160 000–169 999,Type de carburant:Diesel,Marque:Peugeot,Modèle:508,Puissance fiscale:-,-,”Type:Voitures, Offre”, Temara<br/>60 000 DH,Année-Modèle:2009,Kilométrage:130 000 - 139 999,Type de carburant:Essence,Marque:Ford,Modèle:Fiesta,Puissance fiscale:7 CV,Secteur:saies,"Type:Voitures, Offre", Fès<br/>.<br/>...</span></pre><p id="a2c0" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">下一步是每个数据科学流程中最耗时的步骤，即数据预处理和清理。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="02a9" class="jq jr it bd js jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn bi translated">数据预处理和清理</h1><h2 id="fbed" class="ni jr it bd js nu nv dn jw nw nx dp ka kz ny nz ke ld oa ob ki lh oc od km oe bi translated">数据清理</h2><p id="7414" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">数据预处理的原因是将我们的原始数据转换成有用的数据，并减少数据大小，以便于分析，在这种情况下，我们需要:</p><ul class=""><li id="fc28" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll of lu lv lw bi translated"><code class="fe na nb nc nd b">price</code>:去掉<code class="fe na nb nc nd b">price</code>中的“DH”(迪拉姆货币)字符和空格，然后转换成整数。</li><li id="b544" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated"><code class="fe na nb nc nd b">year_model</code>:从<code class="fe na nb nc nd b">year_model</code>列中删除不需要的字符串，如:“Anne-modèle:”或“ou plus ancien”，然后将其转换为整数。</li><li id="2455" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated"><code class="fe na nb nc nd b">mileage</code>:对于这个字段来说，事情完全不同，我们有一个里程范围，例如在每次观察中，我们的里程在160000 - 169999公里之间，所以在删除“公里”和“-”字符后，我必须呈现这个列，以便只保留一个值而不是一个范围，我们可以使用最小值或最大值，对我来说，我选择使用平均值，以便我们保持在该范围的中间。</li><li id="4a1b" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated"><code class="fe na nb nc nd b">fuel_type</code>:从<code class="fe na nb nc nd b">fuel_type </code>栏中移除不需要的字符串，如“de型增碳剂:”。</li><li id="2dda" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated"><code class="fe na nb nc nd b">mark</code>:从<code class="fe na nb nc nd b">mark</code>栏中移除“品牌:”字符串。</li><li id="3ad4" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated"><code class="fe na nb nc nd b">fiscal_power</code>:对于这个字段，我必须处理两种情况:删除不需要的字符串，如“Puissance fiscale: CV ”,并处理缺失值，因此处理缺失值的技巧之一是用所有<code class="fe na nb nc nd b">fiscal_power</code>列的平均值填充它们。</li></ul><h2 id="8cca" class="ni jr it bd js nu nv dn jw nw nx dp ka kz ny nz ke ld oa ob ki lh oc od km oe bi translated">删除不需要的列</h2><p id="4113" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于数据探索和分析，我们不需要一些列，如“sector”和“type ”,所以我们最终将它们从数据框中删除。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="1461" class="jq jr it bd js jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn bi translated">数据探索和可视化</h1><p id="8c78" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在数据提取和数据预处理步骤之后，我现在应该可视化我的数据集，这样我就可以更深入地了解幕后发生了什么，以及我的数据是如何分布的。</p><p id="c23b" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">在接下来的部分中，我将运行一个问答会话，以回答许多基于直方图和图的问题。</p><p id="c8ac" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">问:价格在年度模型中是如何分布的？</strong></p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi og"><img src="../Images/cb2ece727bbb906ae843e080856e95dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PMD4A4_2vCIx4yG91F_s4Q.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Price distribution over the year of released model</figcaption></figure><p id="aa20" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">答:</strong>从上面的图中我们可以看出，汽车价格逐年上涨，更明确地说，我们可以说，最近发布的汽车越多，价格上涨越多，而另一方面，最老的汽车仍然价格低廉，这是完全符合逻辑的，因为每当汽车从发布之日起变得有点旧，价格就开始下降。</p><p id="6b0d" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">问:价格如何在财权上分配？</strong></p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ol"><img src="../Images/0bd92b557878eae13cb3982e59da7e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-hGdI-ckzLF1yAZNIkOTg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Price distribution over fiscal power</figcaption></figure><p id="2f19" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">答:</strong>从上面的图中我们可以清楚地注意到，在[2800 DH，800000 DH]和[3 CV，13 CV]范围内存在着巨大的积分集中度，这可以解释为:首先，中型财政动力汽车在市场上占据着巨大的主导地位，价格是正确的；其次，财政动力越大，价格也越高。</p><h2 id="fdc1" class="ni jr it bd js nu nv dn jw nw nx dp ka kz ny nz ke ld oa ob ki lh oc od km oe bi translated">问:燃料类型的价格如何按年分配？</h2><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi om"><img src="../Images/6c6a1680436b96bbdaa1ac0cba45dae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6q1FzndJWFmdHnHOLce1Q.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Simple linear regression between price and year model grouped by fuel type</figcaption></figure><p id="eb8d" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">答:</strong>虽然疲软，但似乎在<code class="fe na nb nc nd b">year_model</code>和<code class="fe na nb nc nd b">price</code>之间存在正相关关系。让我们看看价格和其他数据点之间的实际相关性。我们将通过查看热图关联矩阵来确认。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi on"><img src="../Images/11c665c66b64890e8cd2b29ef6972693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*M-IYtFSBg7AS-w217qBs-Q.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Correlation matrix with Heatmap visualization</figcaption></figure><p id="b160" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">正如我们所看到的，在<code class="fe na nb nc nd b">price</code>和<code class="fe na nb nc nd b"> year_model</code>特性之间有很强的相关性，相关性分数为0.47，这验证了<code class="fe na nb nc nd b">price</code>和<code class="fe na nb nc nd b">year_model</code>列之间的强关系。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="faa2" class="jq jr it bd js jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn bi translated">数据建模</h1><p id="3bd7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，我们来到了整个过程中的主要任务，即数据建模，为此，我将使用4个专门用于回归问题的机器学习模型，最后我将制作一个基准表来比较每个模型<code class="fe na nb nc nd b">r2_score</code>，并选择最佳模型。使用的模型有:K近邻回归、多元线性回归、决策树回归和梯度推进回归。</p><p id="8e97" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">数据转换</strong></p><p id="a088" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">我有意让这一部分一直进行到数据建模，而不是为了一些可视化的目的对数据进行预处理。</p><p id="a396" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">目前，我仍然有两个分类特征，它们是<code class="fe na nb nc nd b">fuel_type</code>和<code class="fe na nb nc nd b">mark</code>，这一部分的目的是预处理这些特征，以便将它们数字化，使它们适合我们的模型。在文献中，有两种著名的分类变量转换方法，第一种是<strong class="kq iu">标签编码</strong>，第二种是<strong class="kq iu"> one hot编码</strong>，对于这个用例，我们将使用one hot position，我选择这种数据标签的原因是因为我以后不需要任何类型的数据标准化，这样做的好处是不会对值进行不正确的加权，但也有向数据集添加更多列的缺点。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Features engineering and Data Transformation</figcaption></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oo"><img src="../Images/3220a177e5523ea2f765ad33f006b1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oSaavpwH3zdf8RWaPsgFWg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Result of one hot encoding on the data frame</figcaption></figure><p id="8ba0" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">如上图所示，使用one hot编码将分类特征转换为数字特征后，我们得到了一个宽数据框。</p><p id="60ca" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">数据拆分</strong></p><p id="085d" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">通常我们将数据分成三部分:训练、验证和测试集，但为了简单起见，我们将只使用20%的测试规模进行训练和测试，其余的用于训练。</p><p id="4802" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">梯度推进回归</strong></p><p id="2bf8" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">Boosting是另一种用于创建强大预测器集合的集成技术，而梯度Boosting是一种用于生成由回归变量集合组成的回归模型的技术。</p><p id="90c9" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">集合是预测者的集合，其预测通常通过某种加权平均或投票进行组合，以提供从集合本身获得指导的总体预测。因此，boosting是一种集成技术，在这种技术中，学习者按顺序学习，早期的学习者将简单的模型拟合到数据中，然后分析数据中的错误，这些错误识别出困难或难以拟合的问题或数据的特定实例，因此，后来的模型主要关注那些试图使它们正确的例子。</p><p id="f31f" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">最后，所有模型贡献权重，集合被组合成一些整体预测器，因此boosting是一种将弱学习器序列转换成非常复杂的预测器的方法，它是一种增加特定模型复杂性的方法。最初的学习器往往非常简单，然后随着学习器的增加，加权组合会变得越来越复杂。</p><p id="74dc" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">渐变增强背后的数学原理</strong></p><p id="7800" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">这个算法是梯度推进的一个例子，它被称为梯度推进，因为它与梯度下降过程有关。</p><ul class=""><li id="f01d" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll of lu lv lw bi translated">首先，我们为每个数据点做一组预测<code class="fe na nb nc nd b">ŷ(i)</code>。</li><li id="7f6a" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">我们可以计算出我们预测的误差，姑且称之为<code class="fe na nb nc nd b">J(y, ŷ)</code>，j只是把ŷ的精度和y联系起来</li><li id="ce8f" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">对于均方差MSE : <code class="fe na nb nc nd b">J(y, ŷ) = <strong class="kq iu">Σ </strong>( y(i)<strong class="kq iu"> -</strong>ŷ(i) <strong class="kq iu">)²</strong></code> <strong class="kq iu">。</strong></li><li id="2014" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">所以现在我们可以试着考虑调整我们的预测<code class="fe na nb nc nd b">ŷ</code>来试着减少上面的误差:<code class="fe na nb nc nd b">ŷ(i)= ŷ(i) + α *∇J(y, ŷ)</code>，用:<code class="fe na nb nc nd b">∇J(y, ŷ) = y(i)- ŷ(i)</code></li><li id="66db" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">每个学习者都在估计损失函数的梯度。</li><li id="1b60" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">梯度下降:采取一系列步骤降低<code class="fe na nb nc nd b">J</code>。</li><li id="7c0e" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">预测值之和，按步长α加权。</li></ul><p id="21a2" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">梯度推进回归器—代码快照</strong></p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Snapshot from the used code in the GBR model</figcaption></figure><p id="a5c9" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">解释残差与预测值</strong></p><p id="d5cf" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">建立GBR模型后，主要建议绘制误差分布图，以验证以下假设:</p><ul class=""><li id="e8b4" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll of lu lv lw bi translated">正态分布</li><li id="f6dc" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">同方差(每个X处的方差相同)</li><li id="d0c7" class="lm ln it kq b kr lx kv ly kz lz ld ma lh mb ll of lu lv lw bi translated">自主的</li></ul><p id="a1ac" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">这在我们的案例中已经得到了验证，您可以在<a class="ae nn" href="https://github.com/PaacMaan/cars-price-predictor/blob/master/cars_price_predictor.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>上查看更多细节，但是我们需要观察残差图，以确保它不遵循非线性或异方差分布。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi op"><img src="../Images/c0ed2dd4cebbf04b1a4a854e269dbba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dwMOG0jhLjKk6SJKr1MFtQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Residual VS Predicted values</figcaption></figure><p id="3370" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">正如我们从上面的图中看到的，残差在0线周围大致形成一个“水平带”，这表明误差项的方差相等，此外，没有一个残差从残差的基本随机模式中“脱颖而出”,这涉及到没有异常值。</p><p id="42fe" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu">车型基准测试</strong></p><p id="2b9f" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">因此，在尝试了许多回归模型来拟合我们的数据集之后，是时候绘制一个基准表来总结我们得到的所有结果了。</p><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="366d" class="ni jr it nd b gy nj nk l nl nm">╔═══════════════════╦════════════════════╦═══════════════╗<br/>║   Model           ║     R^2 score      ║     RMSE      ║<br/>╠═══════════════════╬════════════════════╬═══════════════╣<br/>║ KNN               ║ 0.56               ║ 37709.67      ║<br/>║ Linear Regression ║ 0.62               ║ 34865.07      ║<br/>║ <strong class="nd iu">Gradient Boosting</strong> ║ 0.<strong class="nd iu">80</strong>               ║ <strong class="nd iu">25176.16</strong>      ║<br/>║ Decision Tree     ║ 0.63               ║ 34551.17      ║<br/>╚═══════════════════╩════════════════════╩═══════════════╝</span></pre><p id="1fde" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">看起来梯度推进模型以最低的RMSE值和最高的R值赢得了这场战斗，正如它所预期的那样。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="a5c2" class="jq jr it bd js jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn bi translated">Heroku模型部署</h1><ol class=""><li id="402a" class="lm ln it kq b kr ks kv kw kz oq ld or lh os ll lt lu lv lw bi translated"><strong class="kq iu">创建Flask web应用程序</strong></li></ol><p id="ec94" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">Flask是Python的一个“微”框架。之所以称之为微框架，是因为他们希望保持核心简单但可扩展。虽然一开始会有些困惑，但使用Jinja2模板在Flask上建立一个网站还是相对容易的。</p><p id="2c9a" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">flask应用程序由两个主要组件组成:python应用程序(<code class="fe na nb nc nd b">app.py</code>)和HTML模板，对于<code class="fe na nb nc nd b">app.py</code>它看起来是这样的:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Web App Controller</figcaption></figure><p id="1ee1" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">因此，一旦构建了<code class="fe na nb nc nd b">app.py</code>，我们就可以从终端运行它，如果一切顺利，我们将得到在“/”路径上运行的<code class="fe na nb nc nd b">index.html</code>页面，如:<code class="fe na nb nc nd b">http://localhost:8080/</code>，然后我们可以用正确的值填充给定的表单，并得到一个甜蜜的警告弹出窗口。</p><p id="43bd" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated"><strong class="kq iu"> 2。将应用程序部署到Heroku </strong></p><p id="c85b" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">对于这一部分，我将需要一个Heroku 帐户(免费)和HerokuCLI，我也可以使用GitHub来完成这项任务，但让事情变得简单。</p><ul class=""><li id="498c" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll of lu lv lw bi translated">设置Procfile:Procfile是一种机制，用于声明Heroku平台上应用程序的dynos运行哪些命令。创建一个名为“Procfile”的文件，并将以下内容放入其中:</li></ul><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="3b25" class="ni jr it nd b gy nj nk l nl nm">web: gunicorn app:app --log-file -</span></pre><ul class=""><li id="c8d1" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll of lu lv lw bi translated">通过在您的终端中运行以下命令，在Flask应用程序的根目录下创建python需求文件:</li></ul><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="ef47" class="ni jr it nd b gy nj nk l nl nm">$ <!-- -->pipreqs ./</span></pre><p id="208a" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">如果您在python虚拟环境中工作，这将是高效的:</p><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="64d6" class="ni jr it nd b gy nj nk l nl nm">$ pip3 freeze &gt; requirements.txt</span></pre><ul class=""><li id="f987" class="lm ln it kq b kr lo kv lp kz lq ld lr lh ls ll of lu lv lw bi translated">登录您的帐户，在Heroku网站上创建一个新的应用程序。</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/e45a199626c0de2c2b2e96170db5c731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*NAwFASBGE5PT1wLCy8t72A.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Form to create a new app with Heroku</figcaption></figure><p id="2dc2" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">创建好应用程序后，我们将被重定向到一个页面，该页面显示了成功部署的说明。在成功连接到HerokuCLI后，我需要将目录更改为我们的flask应用程序，并运行以下命令:</p><pre class="md me mf mg gt ne nd nf ng aw nh bi"><span id="3e2f" class="ni jr it nd b gy nj nk l nl nm">$ <!-- -->heroku git:clone -a cars-price-prediction<br/>$ <!-- -->git add .<br/>$ git commit -am "make it better"<br/>$ git push heroku master</span></pre><p id="8aaa" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">该应用程序现在应该在my-app-name.herokuapp.com现场直播！点击查看应用程序<a class="ae nn" href="https://cars-price-prediction.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">的工作版本。</a></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="f408" class="jq jr it bd js jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn bi translated">结论</h1><p id="d38d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这篇博客文章中，我试图通过构建一个可以根据汽车特征预测汽车价格的模型来介绍数据科学的过程，从数据收集开始，到数据建模和内置模型之间的比较，最后以模型部署为web应用程序结束。</p><h1 id="8d6e" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">有用的链接</h1><p id="8dd9" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">完整笔记本:<a class="ae nn" href="https://github.com/PaacMaan/cars-price-predictor/blob/master/cars_price_predictor.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/PaacMaan/cars-price-predictor/blob/master/cars _ price _ predictor . ipynb</a></p><p id="a157" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">GitHub资源库:</p><div class="ou ov gp gr ow ox"><a href="https://github.com/PaacMaan/cars-price-predictor" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">PaacMaan/汽车价格预测工具</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">这个项目一步一步的展示了如何建立一个模型来预测汽车的价格</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">github.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl mi ox"/></div></div></a></div><p id="98b0" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">网页申请链接:<a class="ae nn" href="https://cars-price-prediction.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://cars-price-prediction.herokuapp.com</a></p><p id="d669" class="pw-post-body-paragraph ko kp it kq b kr lo kt ku kv lp kx ky kz no lb lc ld np lf lg lh nq lj lk ll im bi translated">与❤.共享</p></div></div>    
</body>
</html>