<html>
<head>
<title>Computer Vision on a Budget</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预算上的计算机视觉</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/computer-vision-on-a-budget-3748372414c3?source=collection_archive---------19-----------------------#2018-05-08">https://towardsdatascience.com/computer-vision-on-a-budget-3748372414c3?source=collection_archive---------19-----------------------#2018-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4f1f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用不到 20 行代码实现一个动态分类器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/217ffae0bcead9dfa198a1accb201266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9p3RVCQT-fOF4Sn2nem_w.jpeg"/></div></div></figure><p id="88e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在试图向我弟弟解释计算机视觉的复杂性时，他问我实现实时图像分类器的最简单的<em class="lq"> </em>方法(不是他的原话)。</p><p id="2c59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我想了一会儿，想出了一个他<em class="lq">几乎</em>能够理解的解决方案。它利用了 openCV 库，并且需要与预先存在的模型结合使用。<em class="lq">然而，它可以在不到 20 行的 Python 代码中执行(加载依赖项不算在内)。</em></p><h2 id="d95f" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">属国</h2><ul class=""><li id="0845" class="mk ml it kw b kx mm la mn ld mo lh mp ll mq lp mr ms mt mu bi translated">开源计算机视觉库 openCV</li><li id="f3bc" class="mk ml it kw b kx mv la mw ld mx lh my ll mz lp mr ms mt mu bi translated">如果你不想从头开始训练你的模型，你可以从 Keras/Caffe 下载预先训练好的模型权重</li></ul><h2 id="90e0" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">准备工作</h2><p id="56a1" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">首先，加载所需的库和分类器。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="908f" class="lr ls it ne b gy ni nj l nk nl">import cv2<br/>import numpy as np<br/>from keras.applications import imagenet_utils, VGG19</span><span id="a28a" class="lr ls it ne b gy nm nj l nk nl">model = VGG19(weights='imagenet') # load the model weights</span></pre><p id="db35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个练习中，我将使用 VGG19，它是通过 ImageNet 训练的模型之一。VGG19 可以使用 Keras 库加载。</p><p id="08a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要 imagenet_utils 来预处理图像并解码 VGG19 给出的分类。</p><h2 id="7ea5" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">我们开始吧</h2><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="5356" class="lr ls it ne b gy ni nj l nk nl">cam = cv2.VideoCapture(0) # Open webcam</span></pre><p id="3daa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这种实时分类器的想法是将网络摄像头捕捉的图像分成帧，并将每一帧视为要分类的图像。为此，我们需要创建一个无限循环来连续捕获帧。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="4ccc" class="lr ls it ne b gy ni nj l nk nl">while True:<br/>    <br/>    ret, frame = cam.read()<br/>    k = cv2.waitKey(1) </span><span id="3ec1" class="lr ls it ne b gy nm nj l nk nl">    if k%256 == 27: # if esp key is pressed<br/>        break</span></pre><p id="8d33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个循环捕获后续帧(frame)以及前一帧是否存在(ret)。我们还包括一个退出条件，特别是当按下退出键时。其他等待键映射可以参考<a class="ae nn" href="http://www.asciitable.com/" rel="noopener ugc nofollow" target="_blank"> Ascii 表</a>。</p><p id="b6ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们要抓取帧，并像对待任何常规图像一样对其进行分类。这些都在我们的循环中。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="0639" class="lr ls it ne b gy ni nj l nk nl">   frame_pred = cv2.resize(frame, (224, 224))<br/>   frame_pred = cv2.cvtColor(frame_pred,                                                  cv2.COLOR_BGR2RGB).astype(np.float32)<br/>   frame_pred = frame_pred.reshape((1, ) + frame_pred.shape)<br/>   frame_pred = imagenet_utils.preprocess_input(frame_pred)</span><span id="a6f1" class="lr ls it ne b gy nm nj l nk nl">   predictions = model.predict(frame_pred)<br/>   (imageID, label, score) = imagenet_utils.decode_predictions(predictions)[0][0]</span></pre><p id="7f84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里发生了很多事情。让我们一行一行地来:</p><ul class=""><li id="07c8" class="mk ml it kw b kx ky la lb ld no lh np ll nq lp mr ms mt mu bi translated">图像大小调整为(224，224)，这是 VGG19 的默认输入大小</li><li id="b274" class="mk ml it kw b kx mv la mw ld mx lh my ll mz lp mr ms mt mu bi translated">图像被转换为 RGB 格式。OpenCV 使用 BGR 格式，而 Keras(以及几乎所有其他格式)使用 RGB 格式</li><li id="bfb6" class="mk ml it kw b kx mv la mw ld mx lh my ll mz lp mr ms mt mu bi translated">图像被重新整形以适应模型输入要求</li><li id="95cc" class="mk ml it kw b kx mv la mw ld mx lh my ll mz lp mr ms mt mu bi translated">输入被预处理成模型要求的格式</li><li id="fa15" class="mk ml it kw b kx mv la mw ld mx lh my ll mz lp mr ms mt mu bi translated">我们检索预测</li><li id="4f6f" class="mk ml it kw b kx mv la mw ld mx lh my ll mz lp mr ms mt mu bi translated">我们解码预测以获得类别、标签和分数(属于该类别的概率)</li></ul><p id="3998" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要将预测叠加在网络摄像机画面上:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="776d" class="lr ls it ne b gy ni nj l nk nl">   cv2.putText(frame, "%s with Probability %.2f" % (label, score), (25, 25), cv2.FONT_HERSHEY_DUPLEX, 0.9, (0, 0, 250), 2)</span><span id="7dcd" class="lr ls it ne b gy nm nj l nk nl">   cv2.imshow('Computer Vision on a Budget', frame)</span></pre><p id="6603" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这又是在循环内部运行。最后一行返回带有所需标签文本的原始网络摄像头捕捉(不是针对模型增强的捕捉)。</p><p id="a705" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，你想关闭你的摄像头。这一步在循环之外，只有按下 escape 键才会执行。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="be61" class="lr ls it ne b gy ni nj l nk nl">cam.release()<br/>cv2.destroyAllWindows()</span></pre><p id="8a77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完整的 20 行代码，点击<a class="ae nn" href="https://github.com/happilyeverafter95/Computer-Vision-on-a-Budget" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="dbf4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它所做的一些分类。回想起来，红色并不适合这个标签。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/f0dc6cd5253602b3e7abaf229ac98b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*KyG-edDtNE3Q1Wbnjttc2w.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7f967b9148e81454663954bf3f880184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*kQ-HlPrQXFzjf6sozGJEgA.png"/></div></figure><p id="c786" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个粗略的解决方案，使用一种过于简单的方法来解决一个非常复杂的问题。分类器不区分也不识别帧中的单个对象。根据所用的型号，它也可能非常慢。</p><p id="4932" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从好的方面来看，实现起来非常简单，我想我哥哥也学到了一些东西。</p><h1 id="4b9e" class="oa ls it bd lt ob oc od lw oe of og lz jz oh ka mc kc oi kd mf kf oj kg mi ok bi translated">感谢您的阅读！</h1><p id="3246" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">如果你喜欢这篇文章，可以看看我关于数据科学、数学和编程的其他文章。<a class="ae nn" href="https://medium.com/@mandygu" rel="noopener">通过 Medium </a>关注我的最新动态。😃</p><p id="c4c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一个业余爱好项目，我还在 www.dscrashcourse.com<a class="ae nn" href="http://www.dscrashcourse.com/" rel="noopener ugc nofollow" target="_blank">建立了一套全面的<strong class="kw iu">免费</strong>数据科学课程和练习题。</a></p><p id="fb9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想支持我的写作，下次你报名参加 Coursera 课程时，可以考虑使用我的<a class="ae nn" href="https://click.linksynergy.com/fs-bin/click?id=J2RDo*Rlzkk&amp;offerid=759505.198&amp;type=3&amp;subid=0" rel="noopener ugc nofollow" target="_blank">会员链接</a>。完全公开—我从每一次注册中获得佣金，但不会对您产生额外费用。</p><p id="99bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">再次感谢您的阅读！📕</p></div></div>    
</body>
</html>