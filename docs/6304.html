<html>
<head>
<title>Keras Hyperparameter Tuning in Google Colab using Hyperas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Hyperas 在 Google Colab 中调整 Keras 超参数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/keras-hyperparameter-tuning-in-google-colab-using-hyperas-624fa4bbf673?source=collection_archive---------11-----------------------#2018-12-06">https://towardsdatascience.com/keras-hyperparameter-tuning-in-google-colab-using-hyperas-624fa4bbf673?source=collection_archive---------11-----------------------#2018-12-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f06b4a5f59c9973cf3614ba960d685bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K-0v6zWiCXt2_FHB"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Tuning Hyperparameters for your neural network can be tricky (Photo by <a class="ae jd" href="https://unsplash.com/@aroberts1228?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anthony Roberts</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a>)</figcaption></figure><div class=""/><p id="551e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">超参数调整是创建深度学习网络时计算量最大的任务之一。幸运的是，你可以使用 Google Colab 来大大加快这个过程。在这篇文章中，我将向您展示如何使用 Hyperas 调整现有 keras 模型的超参数，并在 Google Colab 笔记本中运行一切。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="242c" class="li lj jg bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">创建新笔记本并启用 GPU 运行时</h2><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/801d0f91c671021bd5051227b510b9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*enXh4J9hOc8ggaM0j-757A.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Dialog to change the runtime to GPU</figcaption></figure><p id="f8f7" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，您需要创建一个新笔记本。打开你的<a class="ae jd" href="https://colab.research.google.com" rel="noopener ugc nofollow" target="_blank"> Colab 控制台</a>并选择<strong class="kf jh">新的 Python 3 笔记本。</strong>在笔记本中，从菜单中选择<strong class="kf jh">运行时</strong>，然后<strong class="kf jh">改变运行时类型。</strong>选择硬件加速器:GPU，点击保存。这将大大加快你在笔记本上做的每一个计算。</p><h2 id="7fc2" class="li lj jg bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">安装软件包</h2><p id="05d9" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">您可以使用<em class="ml"> pip </em>来安装新的软件包。在这种情况下，我们需要<a class="ae jd" href="https://github.com/maxpumperla/hyperas" rel="noopener ugc nofollow" target="_blank"> hyperas </a>和<a class="ae jd" href="https://github.com/hyperopt/hyperopt" rel="noopener ugc nofollow" target="_blank">hyperpt</a>。将以下内容复制并粘贴到笔记本的第一个单元格中:</p><pre class="mc md me mf gt mm mn mo mp aw mq bi"><span id="f6c7" class="li lj jg mn b gy mr ms l mt mu">!pip install hyperas<br/>!pip install hyperopt</span></pre><p id="ec31" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您运行单元时，您将看到 pip 正在下载和安装依赖项。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="3aff" class="mv lj jg bd lk mw mx my ln mz na nb lq nc nd ne lt nf ng nh lw ni nj nk lz nl bi translated"><strong class="ak">获取数据并创建模型</strong></h1><p id="530b" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在这篇文章中，我将使用来自<a class="ae jd" href="https://github.com/maxpumperla/hyperas" rel="noopener ugc nofollow" target="_blank"> hyperas github 页面</a>的例子。你可以在这里找到成品的 Colab 笔记本<a class="ae jd" href="https://colab.research.google.com/drive/184Tas98M-pPQanCfTbOHRBRUeE9dtdM9#scrollTo=rdo3mScvBHF4" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="ad6b" class="li lj jg bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated"><strong class="ak">数据功能</strong></h2><p id="372f" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">你需要一个数据函数来加载你的数据。它需要返回你的 X_train，Y_train，X_test 和 Y_test 值。以下是一个数据函数的示例:</p><figure class="mc md me mf gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><blockquote class="no np nq"><p id="ed43" class="kd ke ml kf b kg kh ki kj kk kl km kn nr kp kq kr ns kt ku kv nt kx ky kz la ij bi translated"><strong class="kf jh">注意:</strong>你的数据函数需要完全按照这个顺序返回值:X_train，Y_train，X_test，Y_test。如果你使用 scikit learns<a class="ae jd" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html" rel="noopener ugc nofollow" target="_blank">train _ test _ split</a>要小心，因为这会以不同的顺序返回值</p></blockquote><h2 id="30ad" class="li lj jg bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated"><strong class="ak">模型功能</strong></h2><p id="d944" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">模型函数是定义模型的地方。您可以使用所有可用的 keras 函数和层。要添加用于调优的超参数，可以使用<strong class="kf jh"> {{uniform()}} </strong>和<strong class="kf jh"> {{choice()}} </strong>关键字。</p><p id="0479" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您想为您的<em class="ml"> batch_size </em>尝试不同的值。您可以简单地编写<em class="ml"> batch_size={{choice([32，64，128])}} </em>并且在每次试验期间，将选择并试验其中一个值。关于如何定义要调整的参数的更深入的解释可以在<a class="ae jd" href="https://github.com/maxpumperla/hyperas" rel="noopener ugc nofollow" target="_blank"> Hyperas Github 页面</a>上找到，或者你可以看看例子:</p><figure class="mc md me mf gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><blockquote class="no np nq"><p id="30f5" class="kd ke ml kf b kg kh ki kj kk kl km kn nr kp kq kr ns kt ku kv nt kx ky kz la ij bi translated"><strong class="kf jh">注意:</strong>你的模型函数必须返回一个带有丢失键和状态键的 python 字典</p></blockquote><h1 id="bd8f" class="mv lj jg bd lk mw nu my ln mz nv nb lq nc nw ne lt nf nx nh lw ni ny nk lz nl bi translated">Colab 的问题</h1><p id="a44b" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">如果您现在尝试运行此示例，试验将会失败，因为 Hyperas 将无法找到您的笔记本。你需要复制你的笔记本并再次上传到你的 google drive 文件夹。幸运的是，你可以在你的笔记本里这样做，正如这个<a class="ae jd" href="https://stackoverflow.com/questions/49920031/get-the-path-of-the-notebook-on-google-colab" rel="noopener ugc nofollow" target="_blank"> stackoverflow 回答</a>中所描述的。</p><figure class="mc md me mf gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><blockquote class="no np nq"><p id="7e17" class="kd ke ml kf b kg kh ki kj kk kl km kn nr kp kq kr ns kt ku kv nt kx ky kz la ij bi translated"><strong class="kf jh">注意:</strong>在第 16 行和第 18 行，您需要将<em class="jg"> HyperasMediumExample </em>改为您自己的笔记本的名称</p></blockquote><p id="c914" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行此单元后，系统会提示您在浏览器中打开一个网站，并将代码复制粘贴回笔记本:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/6f233732e224212c7290c58588d4ad0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*DwQlmlARWsN_lP8fSaFLAg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">The Output after you run the cell above</figcaption></figure><p id="4fbc" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击链接，用你的谷歌账户登录，将代码复制粘贴回笔记本。如果你打开左侧边栏的<strong class="kf jh">文件</strong>标签，你应该会看到一个名为&lt; YourNotebook &gt;的文件。ipynb</p><h2 id="908c" class="li lj jg bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">开始试验</h2><p id="5014" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">现在你可以开始试验了。请注意，您必须将参数<em class="ml"> notebook_name </em>设置为您笔记本的名称。否则试验将会失败:</p><figure class="mc md me mf gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="18f0" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行此单元后，扫描开始，您可以在单元的输出中看到结果。</p><h1 id="78c7" class="mv lj jg bd lk mw nu my ln mz nv nb lq nc nw ne lt nf nx nh lw ni ny nk lz nl bi translated"><strong class="ak">故障排除</strong></h1><p id="c33a" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">如果您在执行此操作时遇到任何问题，我建议您执行以下操作:</p><ol class=""><li id="7a01" class="oa ob jg kf b kg kh kk kl ko oc ks od kw oe la of og oh oi bi translated">在左侧栏中，打开<strong class="kf jh">文件。</strong>会有一个名为&lt; YourNotebook &gt; .ipynb 的文件，删除那个文件</li><li id="4edb" class="oa ob jg kf b kg oj kk ok ko ol ks om kw on la of og oh oi bi translated">在菜单中选择<strong class="kf jh">运行时</strong>，然后选择<strong class="kf jh">重启运行时</strong>。</li><li id="df5a" class="oa ob jg kf b kg oj kk ok ko ol ks om kw on la of og oh oi bi translated">重新加载页面</li></ol><p id="0bbf" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的运行时再次连接后，您可以通过从上到下运行每个单元来重新开始</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="c30c" class="mv lj jg bd lk mw mx my ln mz na nb lq nc nd ne lt nf ng nh lw ni nj nk lz nl bi translated">结论</h1><p id="6b11" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">只需稍作调整，您就可以使用 Google colab 来调整 keras 网络的超参数。同样，完整的例子可以在这里找到<a class="ae jd" href="https://colab.research.google.com/drive/184Tas98M-pPQanCfTbOHRBRUeE9dtdM9#scrollTo=rdo3mScvBHF4" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>