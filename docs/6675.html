<html>
<head>
<title>Handling NetCDF Files using XArray for Absolute Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绝对初学者使用 XArray 处理 NetCDF 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/handling-netcdf-files-using-xarray-for-absolute-beginners-111a8ab4463f?source=collection_archive---------2-----------------------#2018-12-26">https://towardsdatascience.com/handling-netcdf-files-using-xarray-for-absolute-beginners-111a8ab4463f?source=collection_archive---------2-----------------------#2018-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="456a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索 Python 中与气候相关的数据操作工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b60604307c68510c7a65a65c0774ef9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wtmtzR9l-V2FPIl7"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@albertorestifo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alberto Restifo</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a1d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> N </span> etCDF 是一种独立于机器的、面向数组的、多维的、自描述的、可移植的数据格式，被各种科学团体所使用。它的文件扩展名是<em class="me">。nc </em>或<em class="me">。cdf </em>(虽然据信两者之间有细微差别)。不像<em class="me">里的文件。csv </em>或<em class="me">。xlsx </em>，NetCDF 格式无法使用电子表格软件直接访问和查看。</p><blockquote class="mf mg mh"><p id="953c" class="kz la me lb b lc ld ju le lf lg jx lh mi lj lk ll mj ln lo lp mk lr ls lt lu im bi translated">即使你可以，你也不会用一堆元数据来处理一个四维数据。</p></blockquote><p id="5965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将以美国<a class="ae ky" href="https://www.arm.gov/" rel="noopener ugc nofollow" target="_blank"> <em class="me">大气辐射测量气候研究机构</em> </a> (ARM)和欧洲<a class="ae ky" href="https://www.ecmwf.int/" rel="noopener ugc nofollow" target="_blank"> <em class="me">欧洲中期天气预报中心</em> </a> (ECMWF)的气候数据为例。</p><h2 id="a2f8" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">目录</h2><ul class=""><li id="ad35" class="ne nf it lb b lc ng lf nh li ni lm nj lq nk lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/111a8ab4463f#dce7" rel="noopener">先决条件</a></li><li id="e389" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/111a8ab4463f#4715" rel="noopener">替代品</a></li><li id="4047" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/111a8ab4463f#f232" rel="noopener">数据预览</a></li><li id="9c03" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/111a8ab4463f#70a2" rel="noopener">术语</a></li><li id="7088" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/111a8ab4463f#14ea" rel="noopener">使用 XArray 编码</a></li><li id="87c4" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/111a8ab4463f#00c2" rel="noopener">备注</a></li></ul><p id="280e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="me">原载于我的博客</em><a class="ae ky" href="https://edenau.github.io" rel="noopener ugc nofollow" target="_blank"><em class="me">edenau . github . io</em></a><em class="me">。</em></p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="dce7" class="ob mm it bd mn oc od oe mq of og oh mt jz oi ka mw kc oj kd mz kf ok kg nc ol bi translated">先决条件</h1><p id="cd24" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">我们将使用 Python 中的<code class="fe op oq or os b"><a class="ae ky" href="http://xarray.pydata.org/en/stable/" rel="noopener ugc nofollow" target="_blank">xarray</a></code>库进行数据处理。长话短说，它建立在<code class="fe op oq or os b">numpy</code>(和<code class="fe op oq or os b">dask</code>)库的基础上，并利用了<code class="fe op oq or os b">pandas</code>的能力，但是你可能不需要了解它。正如您可能知道的，包依赖是 Python 中的一个难点。这就是为什么安装所有东西最方便的方法是使用以下命令:</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="1f65" class="ml mm it os b gy ox oy l oz pa">$ conda install xarray dask netCDF4 bottleneck</span></pre><p id="b71a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议有经验的 Python 程序员查看相关的<a class="ae ky" href="http://xarray.pydata.org/en/stable/installing.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多细节。如果你是初学者，不用担心。我列出了你需要检查的依赖项:</p><ul class=""><li id="c253" class="ne nf it lb b lc ld lf lg li pb lm pc lq pd lu nl nm nn no bi translated"><strong class="lb iu">Python<em class="me">2.7/3.5+</em>必需</strong></li><li id="db63" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="me"> numpy </em> 1.12+ </strong>必填</li><li id="1613" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="me">熊猫</em> 0.19.2+ </strong>必填</li><li id="5626" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="me"/></strong><em class="me"/>为插补特征</li><li id="0e9f" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="me">瓶颈</em> </strong>加速跳 NaN</li><li id="7d12" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="me">netCDF 4-python</em></strong><em class="me"/>用于基本的 netCDF 读/写等操作</li><li id="3d75" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"><em class="me">dask-array</em>0.16+</strong>与<em class="me"> dask </em>进行并行计算</li></ul><p id="9a54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要可视化您的数据集，您可能需要这些:</p><ul class=""><li id="e03e" class="ne nf it lb b lc ld lf lg li pb lm pc lq pd lu nl nm nn no bi translated"><strong class="lb iu"><em class="me">matplotlib</em></strong>1.5+用于绘图</li><li id="8469" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="me"> cartopy </em> </strong>为地图</li><li id="008d" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><strong class="lb iu"> <em class="me"> seaborn </em> </strong>更好的调色板</li></ul><p id="e0c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于绝对的初学者，您可以通过以下方式检查您的默认 Python 版本</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="87de" class="ml mm it os b gy ox oy l oz pa">$ python --version<br/>Python 2.7.5</span></pre><p id="4618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以通过以下方式检查 Python3 是否已安装</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="b8f3" class="ml mm it os b gy ox oy l oz pa">$ python3 --version<br/>Python 3.4.9</span></pre><p id="f6a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检查软件包的版本，使用<code class="fe op oq or os b">pip freeze</code>或<code class="fe op oq or os b">conda list</code>。如果你通过<code class="fe op oq or os b">conda</code>安装<code class="fe op oq or os b">xarray</code>的话，事情应该没问题。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="4715" class="ob mm it bd mn oc od oe mq of og oh mt jz oi ka mw kc oj kd mz kf ok kg nc ol bi translated">可供选择的事物</h1><p id="8945" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated"><code class="fe op oq or os b"><a class="ae ky" href="https://scitools.org.uk/iris/docs/latest/" rel="noopener ugc nofollow" target="_blank">iris</a></code>是<code class="fe op oq or os b">xarray</code>的替代品，但需要做一些工作才能让它在 Windows 上工作，在 Mac OS 上效果不好。Iris 也是一个英文单词，所以谷歌‘iris’会给你很多不相关的结果。使用<code class="fe op oq or os b">iris</code>对我来说是一种痛苦。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="f232" class="ob mm it bd mn oc od oe mq of og oh mt jz oi ka mw kc oj kd mz kf ok kg nc ol bi translated">数据预览</h1><p id="2291" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">“预览”和“了解”您的数据、其元数据和数据结构总是一个好主意。假设您已经安装了<code class="fe op oq or os b">netCDF4-python</code>，您只需要两个命令<code class="fe op oq or os b">ncdump</code>和<code class="fe op oq or os b">ncview</code>。前者给出了 netCDF 数据集的文本表示(基本上是元数据和数据本身)，而后者是一个非常强大的图形界面，用于即时数据可视化。</p><h2 id="108e" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">ncdump</h2><p id="1fd6" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">转到数据集的目录并尝试</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="615c" class="ml mm it os b gy ox oy l oz pa">$ ncdump -h twparmbeatmC1.c1.20050101.000000.cdf</span></pre><p id="3c03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于此时我们不需要查看每个数据条目的值，<code class="fe op oq or os b">-h</code>确保只显示标题(元数据)。你会得到</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="bc34" class="ml mm it os b gy ox oy l oz pa">netcdf twparmbeatmC1.c1.20050101.000000 {<br/>dimensions:<br/> time = UNLIMITED ; // (8760 currently)<br/> range = 2 ;<br/> p = 37 ;<br/> z = 512 ;<br/>variables:<br/> double base_time ;<br/>  base_time:long_name = "Base time in Epoch" ;<br/>  base_time:units = "seconds since 1970-1-1 0:00:00 0:00" ;<br/>  base_time:string = "2005-01-01 00.00, GMT" ;<br/>  base_time:ancillary_variables = "time_offset" ;<br/> float prec_sfc(time) ;<br/>  prec_sfc:long_name = "Precipitation Rate" ;<br/>  prec_sfc:standard_name = "lwe_precipitation_rate" ;<br/>  prec_sfc:units = "mm/hour" ;<br/>  prec_sfc:missing_value = -9999.f ;<br/>  prec_sfc:_FillValue = -9999.f ;<br/>  prec_sfc:source = "twpsmet60sC1.b1" ;<br/> float T_p(time, p) ;<br/>  T_p:long_name = "Dry Bulb Temperature, from sounding in p coordinate" ;<br/>  T_p:standard_name = "air_temperature" ;<br/>  T_p:units = "K" ;<br/>  T_p:missing_value = -9999.f ;<br/>  T_p:_FillValue = -9999.f ;<br/>  T_p:source = "twpsondewnpnC1.b1:tdry" ;</span><span id="19d5" class="ml mm it os b gy pe oy l oz pa">// global attributes:<br/><strong class="os iu"><em class="me">&lt; OTHER METADATA &gt;</em></strong><br/>}</span></pre><p id="cd2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到维度、变量和其他不言自明的元数据。全局属性(上面没有打印)告诉我们如何收集和预处理数据。在本例中，它们是 ARM 在巴布亚新几内亚马努斯 147.4E 2.1S 处获取的测量数据。</p><p id="67c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们查看变量列表:1-dim <code class="fe op oq or os b">prec_sfc</code>和 2-dim <code class="fe op oq or os b">T_p</code>时，我们意识到它们具有不同的维度(！).降水率在每次都是标量测量，而温度在每次都是柱形(这次是在不同气压水平而不是海拔高度水平测量)。在气候科学中，四维数据是很常见的——纬度、经度、海拔/气压水平、时间。</p><h2 id="8b0a" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">ncview</h2><p id="b37b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">试试下面的命令，它会给你一个图形界面，列出数据集中的所有变量，非常简单。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="53d8" class="ml mm it os b gy ox oy l oz pa">$ ncview twparmbeatmC1.c1.20050101.000000.cdf</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/6eba2c600e3d08b2097cafc9d16c4e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRKvSM71G8BAKPp3zqbbNw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">The graphical interface in Linux using <strong class="bd pg"><em class="ph">ncview</em></strong></figcaption></figure></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="70a2" class="ob mm it bd mn oc od oe mq of og oh mt jz oi ka mw kc oj kd mz kf ok kg nc ol bi translated">术语</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/9714608e105a071dc66402881ff1eefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIyi7fqvyjIwEw49XkMFig.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Data structures of <strong class="bd pg">xarray</strong></figcaption></figure><h2 id="94e1" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">数据阵列</h2><p id="7a6f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated"><code class="fe op oq or os b">xarray.DataArray</code>是一个带标签的多维数组<strong class="lb iu">的实现，用于单个变量</strong>，如降雨量、温度等..它具有以下关键属性:</p><ul class=""><li id="b190" class="ne nf it lb b lc ld lf lg li pb lm pc lq pd lu nl nm nn no bi translated"><code class="fe op oq or os b">values</code>:保存数组值的<code class="fe op oq or os b">numpy.ndarray</code></li><li id="8c6d" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe op oq or os b">dims</code>:各轴的尺寸名称(如<code class="fe op oq or os b">('lat', 'lon', 'z', 'time')</code>)</li><li id="a1dc" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe op oq or os b">coords</code>:一个类似 dict 的数组(坐标)容器，用于标记每个点(例如，一维数字数组、<em class="me">日期时间</em>对象或字符串)</li><li id="c45e" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe op oq or os b">attrs</code>:保存任意元数据(属性)的<code class="fe op oq or os b">OrderedDict</code></li></ul><h2 id="4a1a" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">资料组</h2><p id="71cf" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated"><code class="fe op oq or os b">xarray.DataSet</code>是 DataArrays 的集合。每个 NetCDF 文件都包含一个数据集。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="14ea" class="ob mm it bd mn oc od oe mq of og oh mt jz oi ka mw kc oj kd mz kf ok kg nc ol bi translated">使用 XArray 编码</h1><h2 id="5f04" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">数据导入</h2><p id="d638" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">在你阅读数据之前，你不能摆弄它。使用<code class="fe op oq or os b">open_dataset</code>或<code class="fe op oq or os b">open_mfdataset</code>读取单个或多个 NetCDF 文件，并将其存储在名为<code class="fe op oq or os b">DS</code>的数据集中。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="0cc2" class="ml mm it os b gy ox oy l oz pa">import xarray as xr</span><span id="ad78" class="ml mm it os b gy pe oy l oz pa"># single file<br/>dataDIR = '../data/ARM/twparmbeatmC1.c1.20050101.000000.cdf'<br/>DS = xr.open_dataset(dataDIR)</span><span id="fd79" class="ml mm it os b gy pe oy l oz pa"># OR multiple files<br/>mfdataDIR = '../data/ARM/twparmbeatmC1.c1.*.000000.cdf'<br/>DS = xr.open_mfdataset(mfdataDIR)</span></pre><h2 id="3ac7" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">数据检查</h2><p id="63fa" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">还记得数据数组的 4 个关键属性吗？您可以使用<code class="fe op oq or os b">DS.values</code>、<code class="fe op oq or os b">DS.var</code>、<code class="fe op oq or os b">DS.dims</code>、<code class="fe op oq or os b">DS.coords</code>和<code class="fe op oq or os b">DS.attrs</code>进行数据检查。这在交互式 Python 中将变得非常方便。它们的功能非常明显，留给读者作为练习。).</p><h2 id="2c55" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">数据阵列提取</h2><p id="6b0d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">从数据集<code class="fe op oq or os b">DS</code>中提取数据数组非常简单，因为<code class="fe op oq or os b">DS.&lt;var_name&gt;</code>就足够了。您可以考虑用<code class="fe op oq or os b">dropna()</code>删除 NaN 条目，并用<code class="fe op oq or os b">sel()</code>选择数据。<code class="fe op oq or os b">sel()</code>中的<code class="fe op oq or os b">method</code>参数允许我们通过使用<code class="fe op oq or os b">'pad'</code>、<code class="fe op oq or os b">'backfill'</code>或<code class="fe op oq or os b">'nearest'</code>方法来启用最近邻(不精确)查找。要指定范围，使用<code class="fe op oq or os b">slice()</code>。</p><p id="d786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过<code class="fe op oq or os b">da.values</code>将<code class="fe op oq or os b">xr.DataArray</code>转换为<code class="fe op oq or os b">numpy.ndarray</code>。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="966b" class="ml mm it os b gy ox oy l oz pa"># Extract Dry Bulb Temperature in z-coordinate (T_z)<br/># Select the altitude nearest to 500m above surface<br/># Drop NaN, convert to Celcius<br/>da = DS.T_z.sel(z=500,method='nearest').dropna(dim='time') - 273.15  # or .ffill(dim='time')</span><span id="af39" class="ml mm it os b gy pe oy l oz pa"># Select data in 2000s<br/>da = da.sel(time=slice('2000-01-01', '2009-12-31'))<br/>da_numpy = da.values</span></pre><p id="17de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照惯例，DataSet 用大写字母<code class="fe op oq or os b">DS</code>命名，DataArray 用小写字母<code class="fe op oq or os b">da</code>命名。</p><h2 id="e797" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">日期时间操作</h2><p id="3f6e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">假设 DataArray <code class="fe op oq or os b">da</code>有一个<em class="me"> DateTime </em>格式的维度<code class="fe op oq or os b">time</code>，我们可以通过<code class="fe op oq or os b">da.time.dt.&lt;year/month/day/...&gt;</code>提取出<em class="me">年</em> / <em class="me">月</em> / <em class="me">日</em> / <em class="me">日</em> / <em class="me">日</em>。注意，输出仍然在 DataArray 中。</p><p id="14ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下示例进一步尝试计算每个月任何变量的平均值/总和。我们先用<code class="fe op oq or os b">assign_coords()</code>定义一个新的坐标系。为什么？尝试观察<em class="me">年</em>和<em class="me">月</em>在<em class="me">日期时间</em>中的表现。如果我们需要系统知道 2000 年 1 月和 2001 年 1 月之间的差异，我们需要<em class="me">年</em>和<em class="me">月</em>来定义一个新坐标，我们称之为<code class="fe op oq or os b">year_month</code>。</p><p id="35d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以根据新定义的坐标系，通过<code class="fe op oq or os b">groupby('year_month')</code>对数据进行分组，然后进行<code class="fe op oq or os b">mean()</code>或<code class="fe op oq or os b">sum()</code>操作。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="0ebc" class="ml mm it os b gy ox oy l oz pa"># Contract the DataArray by taking mean for each Year-Month<br/>def mean_in_year_month(da):<br/>    # Index of Year-Month starts at Jan 1991<br/>    month_cnt_1991 = (da.time.dt.year.to_index() - 1991) * 12 + da.time.dt.month.to_index()<br/>    # Assign newly defined Year-Month to coordinates, then group by it, then take the mean<br/>    return da.assign_coords(year_month = month_cnt_1991).groupby('year_month').mean()</span><span id="9214" class="ml mm it os b gy pe oy l oz pa">da_1 = mean_in_year_month(da1)</span></pre><h2 id="39ce" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">数据数组合并</h2><p id="ae46" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">我们可以使用<code class="fe op oq or os b">xr.merge()</code>合并多个数据数组。如果试图合并两个同名但不同值的变量，将引发<code class="fe op oq or os b">xr.MergeError</code>。这确保了<code class="fe op oq or os b">xr.merge()</code>是非破坏性的。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="9007" class="ml mm it os b gy ox oy l oz pa">DS_new = xr.merge([da_1,da_2,da_3]).dropna(dim='year_month')</span></pre><h2 id="d515" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">测绘</h2><p id="6157" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">您可以简单地将数据数组作为<code class="fe op oq or os b">matplotlib.pyplot</code>方法的参数。对于绝对的初学者，尝试使用<code class="fe op oq or os b">plt.plot()</code>或<code class="fe op oq or os b">plt.scatter()</code>绘制线图或散点图。记住通过<code class="fe op oq or os b">plt.show()</code>显示数字，或者通过<code class="fe op oq or os b">plt.savefig()</code>保存数字。</p><p id="60dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你需要地图，<code class="fe op oq or os b">cartopy</code>库可以轻松生成一张。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="1ac1" class="ml mm it os b gy ox oy l oz pa">import cartopy.crs as ccrs<br/>import matplotlib.pyplot as plt</span><span id="a098" class="ml mm it os b gy pe oy l oz pa">da = DS.t_sfc</span><span id="6368" class="ml mm it os b gy pe oy l oz pa"># Draw coastlines of the Earth<br/>ax = plt.axes(projection=ccrs.PlateCarree())<br/>ax.coastlines() <br/>da.plot()<br/>plt.show()</span></pre><p id="1aac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过几行额外的代码，您可以生成如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/e96cccf2b07bb6d694d320e418fc973a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAl_93kITYcV0aSqBWAVPg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Plots generated by <strong class="bd pg">cartopy</strong></figcaption></figure><h2 id="1dc0" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">数据导出</h2><p id="45b2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">如前所述，您可以将 DataArray 转换为<code class="fe op oq or os b">numpy.ndarray</code>，或者将 DataSet 或 DataArray 转换为<code class="fe op oq or os b">pandas.DataFrame</code>，如下图所示。</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="1556" class="ml mm it os b gy ox oy l oz pa">df = DS.to_dataframe()</span></pre><p id="e606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还可以通过以下方式将 DataArray 或 DataSet 导出到 NetCDF 文件</p><pre class="kj kk kl km gt ot os ou ov aw ow bi"><span id="c0ea" class="ml mm it os b gy ox oy l oz pa">dataDIR = '../data/new.nc'<br/>DS.to_netcdf(dataDIR)</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="00c2" class="ob mm it bd mn oc od oe mq of og oh mt jz oi ka mw kc oj kd mz kf ok kg nc ol bi translated">评论</h1><p id="3b73" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">如果您对 Python 或编程感兴趣，以下文章可能会有所帮助:</p><div class="pk pl gp gr pm pn"><a rel="noopener follow" target="_blank" href="/5-python-features-i-wish-i-had-known-earlier-bc16e4a13bf4"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">我希望我能早点知道的 5 个 Python 特性</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">超越 lambda、map 和 filter 的 Python 技巧</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">towardsdatascience.com</p></div></div><div class="pw l"><div class="px l py pz qa pw qb ks pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a rel="noopener follow" target="_blank" href="/visualizing-bike-mobility-in-london-using-interactive-maps-for-absolute-beginners-3b9f55ccb59"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">使用交互式地图和动画可视化伦敦的自行车移动性</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">探索 Python 中的数据可视化工具</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">towardsdatascience.com</p></div></div><div class="pw l"><div class="qc l py pz qa pw qb ks pn"/></div></div></a></div><p id="ee2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程是为教学目的而写的，只包括<code class="fe op oq or os b">xarray</code>的基础知识。希望这有所帮助！</p><p id="6703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="me">原载于我的博客</em><a class="ae ky" href="https://edenau.github.io" rel="noopener ugc nofollow" target="_blank"><em class="me">edenau . github . io</em></a><em class="me">。</em></p><h2 id="679c" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">参考</h2><ul class=""><li id="2cf6" class="ne nf it lb b lc ng lf nh li ni lm nj lq nk lu nl nm nn no bi translated"><a class="ae ky" href="https://www.unidata.ucar.edu/software/netcdf/netcdf-4/newdocs/netcdf/ncdump.html" rel="noopener ugc nofollow" target="_blank">https://www . unidata . ucar . edu/software/netcdf/netcdf-4/new docs/netcdf/NC dump . html</a></li><li id="6d53" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="http://xarray.pydata.org/en/stable/" rel="noopener ugc nofollow" target="_blank">http://xarray.pydata.org/en/stable/</a></li><li id="6bf4" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://scitools.org.uk/cartopy/docs/v0.15/matplotlib/intro.html" rel="noopener ugc nofollow" target="_blank">https://scitools . org . uk/cartopy/docs/v 0.15/matplotlib/intro . html</a></li><li id="c1d3" class="ne nf it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="http://earthpy.org/cartopy_backgroung.html" rel="noopener ugc nofollow" target="_blank">http://earthpy.org/cartopy_backgroung.html</a></li></ul></div></div>    
</body>
</html>