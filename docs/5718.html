<html>
<head>
<title>Kaggle Titanic: Machine Learning model (top 7%)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kaggle 泰坦尼克号:机器学习模型(前 7%)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/kaggle-titanic-machine-learning-model-top-7-fa4523b7c40?source=collection_archive---------5-----------------------#2018-11-05">https://towardsdatascience.com/kaggle-titanic-machine-learning-model-top-7-fa4523b7c40?source=collection_archive---------5-----------------------#2018-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/cbf89e5f235b8b514daa33f75bdcff5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*dwkupPHPMHWLvSIgrbMqNA.jpeg"/></div></figure><p id="c6da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这场 K <a class="ae ks" href="https://www.kaggle.com/c/titanic" rel="noopener ugc nofollow" target="_blank"> aggle 竞赛</a>的目的是根据给定的特征预测给定乘客的生死。这个机器学习模型是使用 scikit-learn 和 fastai 库构建的(感谢<a class="ae ks" href="https://www.linkedin.com/authwall?trk=gf&amp;trkInfo=AQH1NsDUgQbJAwAAAWbiRqbIwGLhcSbGKZ7zOi_usSDEtKTqOv4iVuPDGE3g5jP79Eg3F9l5aIlaLaKsUjjhCllbKY2z1XAvTFQ9UMKh9LR9PJcCiaVsqANQ3ttHlLm60UCyUMU=&amp;originalReferer=https://www.google.co.in/&amp;sessionRedirect=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fhowardjeremy" rel="noopener ugc nofollow" target="_blank">杰里米·霍华德</a>和<a class="ae ks" href="https://www.linkedin.com/in/rachel-thomas-942a7923" rel="noopener ugc nofollow" target="_blank">瑞秋·托马斯</a>)。对该模型使用集成技术(RandomForestClassifer 算法)。我尝试了其他算法，如逻辑回归，梯度推进分类器与不同的超参数。但是我用这个 RandomFortestClassifer 得到了更好的结果(前 7%)。</p><p id="e4f9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完整代码的 Github 链接是<a class="ae ks" href="https://github.com/Msanjayds/Kaggle_Titanic-Survival-Challenge/blob/master/Titanic_Final_to_git.ipynb" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><p id="04ae" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面是测试数据集中提供的功能。</p><ul class=""><li id="15e3" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">乘客身份证:发给船上每个乘客的身份证</li><li id="3ee5" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">乘客舱:乘客舱。它有三个可能的值:1、2、3(一等、二等和三等)</li><li id="69d9" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">乘客的姓名</li><li id="d033" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">性</li><li id="8304" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">年龄</li><li id="251e" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">SibSp:与乘客同行的兄弟姐妹和配偶的数量</li><li id="7bdd" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">Parch:与乘客同行的父母和子女人数</li><li id="e381" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">机票号码</li><li id="4eba" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">票价</li><li id="1d94" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">机舱号</li><li id="6ec3" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">登船。这描述了泰坦尼克号上三个可能的区域。三个可能的值 S，C，Q</li></ul><p id="1585" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">探索性数据分析</strong>:以下是我在数据分析过程中的发现，以及我处理这些发现的方法。</p><p id="7490" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从下表中我们可以看到，在测试数据集中的 891 个观察值中，只有 714 个记录填充了年龄，即大约 177 个值缺失。我们需要用一些值来估算，我们稍后会看到。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/c13fee6a7720f42ef6a7cd2558de415d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*XLV0y2k3me1lrM8bMU-twQ.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Numerical feature statistics — we can see the number of missing/non-missing</figcaption></figure><p id="1491" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面的图表显示，男性乘客死亡人数多于女性(性别歧视:-))</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/41850768a1386e74bad89c9efc4e71e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*LAg50T5tb_3GrZs7oKqkJA.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Visualization of Survival based on the Gender</figcaption></figure><p id="f0c9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还可以看到 20 到 40 岁的男性比年长的男性存活的更多，如绿色直方图所示。另一方面，女性比男性活得更久，在所有年龄组都相对较好。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/e76b1c6efe04faed17fb69136a666a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*YlW1vO4Dujv_edIU4fQY8w.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Correlation of Age with the Survival</figcaption></figure><p id="974e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们绘制幸存/死亡乘客的票价时，我们可以看到票价较便宜的乘客更有可能死亡。也就是说，拥有昂贵车票(可能是更重要的社会地位)的乘客似乎被优先营救。x 轴:票价，Y 轴:乘客人数。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/9c661c0a235fb058f875078cdb779418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*RMF3qVEasE7z3eJ6RlwJAw.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Ticket Fare vs Survival rate</figcaption></figure><p id="26fe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面是一张图，显示了年龄和费用与存活率的关系。x 轴=年龄，Y 轴=车票 _ 票价，绿点=存活，红点=死亡</p><p id="398f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">x=0 和 x=10 之间的小绿点:幸存的孩子</p><p id="ba30" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">x=10 &amp; x=45 之间的小红点:死亡的成年人(来自下层阶级)</p><p id="6898" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">x=20 &amp; x=45 之间的大绿点:票价较高的成年人幸存下来。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/f0d59a8181082e9ba5ea2d5336adc828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*4kC2L5pLssrhXxfw5TFrjA.png"/></div></figure><blockquote class="lu lv lw"><p id="b752" class="ju jv lx jw b jx jy jz ka kb kc kd ke ly kg kh ki lz kk kl km ma ko kp kq kr ij bi translated"><strong class="jw ir">现在是特征工程:</strong></p></blockquote><p id="8108" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将训练和测试数据结合起来，对两者都进行了转换。完成后，我分离测试和训练数据，用测试数据训练模型，用验证集(训练数据的小子集)验证模型，评估和调整参数。最后在完整的训练数据上训练模型。然后在测试数据上做预测，提交给 Kaggle。</p><p id="1d13" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">处理家庭:</strong>根据家庭的大小创建了一些新的特性(家庭大小，单个，小家庭，大家庭)。这是基于一个假设，即大家庭通常被组织在一起并得到支持，因此他们比那些独自旅行的人更有可能获救。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/2fb23f7bc2c4ea1894dc379b2a154d0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*zbRD4pMC8TYJpBgw4Fi4Tg.png"/></div></figure><p id="2dc7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">Process abowed</strong>:用训练集中最频繁的一个“S”填充缺失的装载，并使用 get_dummies 方法对电子标记列进行一键编码。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/94cb049162b85317726c389920eb29d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*SpFYOrpIZ5fYe7_vJbHwLg.png"/></div></figure><p id="def0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> Process Cabin: </strong>用 U(表示未知)替换缺失的 cabinet，取 cabinet 的第一个字母，用 get_dummies 方法进行虚拟编码。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/8fba6070c6f8d622cc6e19c1489509b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*X4rw5ri2ickPU8wZpymftA.png"/></div></figure><p id="0299" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">从名称</strong>中提取乘客标题:通过解析名称并将标题映射到定义的类别，创建了一个新功能“标题”。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/11e1ef632d940100b6408be01a44dccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*zIfAlcB2eNeQeMYmkl7BxA.png"/></div></figure><p id="9d54" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">流程年龄</strong>:正如我们之前看到的，年龄变量有 177 个缺失值，这在 891 个值中是一个巨大的数字。仅仅用平均/中间年龄来代替可能不是最佳解决方案，因为年龄可能因乘客的群体和类别而不同。头衔也有助于计算年龄。首先，我取了按性别、乘客、阶级和头衔分组的平均年龄。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/53a6bb6050acaa28eb8484a6ee0c85e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*sL0TGTctxDXpVTmBARJ9dw.png"/></div></figure><p id="2694" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，对于所有缺少年龄的记录，基于它们的性别、标题和类别，我们指定年龄。如果完全没有“头衔”,只根据性别和阶级来指定年龄。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/ee7ec0f0ca926bdddd2cbe3f30e6074b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*6-iYC0SAhvw_m94WkLUX_g.png"/></div></figure><p id="d895" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">流程名称</strong>:删除 Name 列，在 Title 列做一个虚拟变量编码。标题列值编码后，数据将如下所示。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/a6dc2168ac2141fb00e150c285d1f456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*f8UAG-JbjkmgYN-op7vLbQ.png"/></div></figure><p id="152b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">构建和训练模型:</strong>正如我前面提到的，我将训练集分成训练和验证集(60 个用于验证)，并使用了 RandomForestClassifier。最初，我将树的数量(n_estimators)设置为 20，最终设置为 180，并将分割节点所需的最小样本数设置为 3(min_samples_leaf)。并且还使用 max_features 作为 0.5(在寻找最佳分割时随机考虑 50%的特征)。利用这些参数，该模型在测试数据上获得了<strong class="jw ir"> 0.933 </strong>的分数。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/5bd083562cfe6e24d441115fbd2b6690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5pGXnNvylNrOflia6pj4A.png"/></div></div></figure><p id="d844" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">模型评估</strong>:在验证集上达到 86.67 左右，下面是混淆矩阵和分类报告。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/7ff0807239037de6af4ea53d7ace8493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*TfA_pp8xqrzDVWpLWFRnIw.png"/></div></figure><p id="7745" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">特性重要性检查</strong>:基于树的评估器可以用来计算特性的重要性，之后我们可以丢弃不相关的特性。以下是最重要的十大特性列表。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/9de0ad38df6a2b4e96db5e13eddb7818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*R7s4o3h7naKt2d3LcYdHvg.png"/></div></figure><p id="43a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从上表中我们可以看出，头衔、性别、票价、乘客身份、年龄、阶级和家庭规模是更重要的特征。不确定乘客 Id 如何影响预测。下面是相同的图形表示。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mo"><img src="../Images/d979a8784747892cddd801a5758f45b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*DMdrLIrBhmBZhaT0FHC6wg.png"/></div></div></figure><p id="f08e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，为了最后一次对整个训练数据再次训练模型，我只包括了重要性超过 0.01 的特征。训练后我可以看到分数略有提高，这次是<strong class="jw ir"> 0.938 </strong>。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi gj"><img src="../Images/be327a48324aa8c1e9092731105dba4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4pA8ImgjQ4VKH52A0FDejg.png"/></div></div></figure><p id="9af7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后我在测试数据上运行模型，提取预测并提交给 Kaggle。它获得了<strong class="jw ir"> 0.8133 </strong>的分数，位于<strong class="jw ir">前 7%。</strong></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mp"><img src="../Images/b1256b995df12da8c8e65de5cbd08abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fL2uHs1aIC0AB5RcwHY-lw.png"/></div></div></figure><p id="a1ca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当然，这种模式有很大的改进和修正余地。非常感谢您的阅读，如果您有任何意见、想法和建议，请告诉我。</p></div></div>    
</body>
</html>