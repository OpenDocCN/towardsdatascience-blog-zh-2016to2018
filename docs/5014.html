<html>
<head>
<title>Creating a dataset using an API with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过 Python 使用 API 创建数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-dataset-using-an-api-with-python-dcc1607616d?source=collection_archive---------0-----------------------#2018-09-22">https://towardsdatascience.com/creating-a-dataset-using-an-api-with-python-dcc1607616d?source=collection_archive---------0-----------------------#2018-09-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3934ea1b6cdcc57da06fac5080cf5fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h_s-X3HSyf20wJw-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">“person using laptop” by <a class="ae kc" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="573d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当我们开始一个机器学习项目时，我们首先需要的是一个数据集。虽然您可以在网上找到许多包含各种信息的数据集，但有时您希望自己提取数据并开始自己的调查。这时，网站提供的 API 就可以派上用场了。</p><blockquote class="lb lc ld"><p id="6f8a" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">应用程序接口(API)是允许两个软件程序相互通信的代码。API 为开发人员定义了编写从操作系统(OS)或其他应用程序请求服务的程序的正确方式。— <a class="ae kc" href="https://searchmicroservices.techtarget.com/definition/application-program-interface-API" rel="noopener ugc nofollow" target="_blank">技术目标</a></p></blockquote><p id="2231" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">API 实际上是一个非常简单的工具，允许任何人从给定的网站访问信息。您可能需要使用某些头，但是有些 API 只需要 URL。在这篇特别的文章中，我将使用由<a class="ae kc" href="http://wind-bow.glitch.me/" rel="noopener ugc nofollow" target="_blank">自由代码营 Twitch API 直通</a>提供的 Twitch API。这个 API 路由不需要任何客户端 id 来运行，因此访问 Twitch 数据非常简单。整个项目在<a class="ae kc" href="https://github.com/kb22/Create-dataset-using-API" rel="noopener ugc nofollow" target="_blank"> Create-dataset-using-API 存储库</a>中作为一个笔记本提供。</p><h1 id="6a9c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">导入库</h1><p id="d89c" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">作为访问 API 内容和将数据放入. CSV 文件的一部分，我们必须导入一些 Python 库。</p><ol class=""><li id="e8f8" class="ml mm iq kf b kg kh kk kl ko mn ks mo kw mp la mq mr ms mt bi translated"><strong class="kf ir">请求</strong>库通过使用<code class="fe mu mv mw mx b">get()</code>方法帮助我们从 API 获取内容。<code class="fe mu mv mw mx b">json()</code>方法将 API 响应转换为 JSON 格式，以便于处理。</li><li id="1d02" class="ml mm iq kf b kg my kk mz ko na ks nb kw nc la mq mr ms mt bi translated">需要 json 库，这样我们就可以使用从 API 获得的 JSON 内容。在这种情况下，我们为每个频道的信息(如名称、id、视图和其他信息)获取一个字典。</li><li id="9fd8" class="ml mm iq kf b kg my kk mz ko na ks nb kw nc la mq mr ms mt bi translated"><strong class="kf ir"> pandas </strong>库帮助创建一个数据帧，我们可以用正确的格式导出一个. CSV 文件，带有适当的标题和索引。</li></ol><h1 id="9197" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">了解 API</h1><p id="dfb8" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们首先需要了解从 API 中可以访问哪些信息。为此，我们使用 channel <em class="le"> Free Code Camp </em>的例子来进行 API 调用，并检查我们获得的信息。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">This prints the response of the API</figcaption></figure><p id="a1c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了访问 API 响应，我们使用函数调用<code class="fe mu mv mw mx b">requests.get(url).json()</code>,它不仅从 API 获得对<code class="fe mu mv mw mx b">url</code>的响应，还获得它的 JSON 格式。然后，我们使用<code class="fe mu mv mw mx b">dump()</code>方法将数据转储到<code class="fe mu mv mw mx b">content</code>中，这样我们就可以在一个更直观的视图中查看它。代码的输出如下所示:</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Response for API</figcaption></figure><p id="b39c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们仔细观察输出，可以看到我们收到了大量信息。我们得到的 id，链接到各种其他部分，追随者，姓名，语言，状态，网址，意见和更多。现在，我们可以遍历一个频道列表，获取每个频道的信息，并将其编译成一个数据集。我将使用列表中的一些属性，包括<em class="le"> _id </em>、<em class="le">显示 _ 名称</em>、<em class="le">状态</em>、<em class="le">关注者</em>和<em class="le">视图</em>。</p><h1 id="3e34" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">创建数据集</h1><p id="1d24" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">现在，我们已经知道了 API 响应的内容，让我们从一起编译数据和创建数据集开始。对于这个博客，我们将考虑我在网上收集的频道列表。</p><p id="5b07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将首先从定义数组中的通道列表开始。然后，对于每个通道，我们将使用 API 获取其信息，并使用<code class="fe mu mv mw mx b">append()</code>方法将每个通道的信息存储在另一个数组<code class="fe mu mv mw mx b">channels_list</code>中，直到我们将所有信息收集到一个地方。请求响应是 JSON 格式的，所以要访问任何键值对，我们只需在<code class="fe mu mv mw mx b">JSONContent</code>变量后面的方括号中写下键值名。现在，我们使用 pandas 库，使用 pandas 库中提供的方法<code class="fe mu mv mw mx b">DataFrame()</code>将这个数组转换成 pandas 数据帧。dataframe 是一种类似于表格的表格形式的数据表示，其中数据以行和列的形式表示。该数据帧允许使用各种方法快速处理数据。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Create dataframe using Pandas</figcaption></figure><p id="6e9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pandas <code class="fe mu mv mw mx b">sample()</code>方法显示随机选择的数据帧行。在这个方法中，我们传递我们希望显示的行数。这里，让我们显示 5 行。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/974c885db7ec51ee2b22b260f6b30dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPl3lFVPGD_7wB4a3xSOnQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">dataset.sample(5)</figcaption></figure><p id="4770" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仔细观察，我们发现数据集有两个小问题。让我们逐一解决它们。</p><ol class=""><li id="ff2d" class="ml mm iq kf b kg kh kk kl ko mn ks mo kw mp la mq mr ms mt bi translated"><strong class="kf ir">标题:</strong>目前，标题是数字，并不反映每列所代表的数据。对于这个数据集来说，这似乎不太重要，因为它只有几列。然而，当您要探索具有数百个列的数据集时，这一步将变得非常重要。这里，我们使用 pandas 提供的<code class="fe mu mv mw mx b">columns()</code>方法定义列。在这种情况下，我们明确定义了标题，但在某些情况下，您可以直接将关键字作为标题。</li><li id="cfea" class="ml mm iq kf b kg my kk mz ko na ks nb kw nc la mq mr ms mt bi translated"><strong class="kf ir">无/空/空白值:</strong>某些行将会有缺失值。在这种情况下，我们有两种选择。我们可以删除任何值为空的整行，也可以在空白处输入一些精心选择的值。这里，<code class="fe mu mv mw mx b">status</code>列在某些情况下会有<code class="fe mu mv mw mx b">None</code>。我们将通过使用方法<code class="fe mu mv mw mx b">dropna(axis = 0, how = 'any', inplace = True)</code>删除这些行，该方法删除数据集中包含空值的行。然后，我们使用方法<code class="fe mu mv mw mx b">RangeIndex(len(dataset.index))</code>将数字的索引从 0 更改为数据集的长度。</li></ol><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Add column headings and update index</figcaption></figure><h1 id="6bd2" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">导出数据集</h1><p id="1de7" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们的数据集现在准备好了，可以导出到外部文件。我们使用<code class="fe mu mv mw mx b">to_csv()</code>方法。我们定义两个参数。第一个参数指的是文件的名称。第二个参数是一个布尔值，表示导出文件中的第一列是否有索引。我们现在有了一个包含我们创建的数据集的. CSV 文件。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/9c6192c37a1db6d9285f164f798a4427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WcK59Tb0Nio_t6SFUSnv-g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Dataset.csv</figcaption></figure><p id="5056" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们讨论了一种使用 Twitch API 和 Python 创建我们自己的数据集的方法。您可以遵循类似的方法通过任何其他 API 访问信息。使用<a class="ae kc" href="https://developer.github.com/v3/" rel="noopener ugc nofollow" target="_blank"> GitHub API </a>试试看。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="70cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请随意分享你的想法，如果你有任何问题，请打电话给我。</p></div></div>    
</body>
</html>