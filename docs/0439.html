<html>
<head>
<title>How to build an FAQ Chatbot with API.AI using Node.js — and PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 API 构建 FAQ 聊天机器人？使用 Node.js 和 PHP 的人工智能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-an-faq-chatbot-with-api-ai-using-node-js-a802aff53e6a?source=collection_archive---------1-----------------------#2017-05-04">https://towardsdatascience.com/how-to-build-an-faq-chatbot-with-api-ai-using-node-js-a802aff53e6a?source=collection_archive---------1-----------------------#2017-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/68b05c2fd6733a40436cdfb17116cb1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*SA35tU2AVnz9k_SjDmu11A.jpeg"/></div></figure><p id="c8a8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<a class="ae ks" href="https://universalchat.org" rel="noopener ugc nofollow" target="_blank">通用聊天</a>中，我们实现了一个聊天机器人，任何人都可以毫不费力地训练它。逻辑很简单；只要给它你的问题和答案，机器人就会回复任何提出类似问题的顾客。</p><p id="5cda" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本文中，我将向您展示我们是如何做到这一点的，这样您也可以这样做。</p><h1 id="6eb4" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">框架的选择</h1><p id="20ab" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">首先，我测试了许多不同的机器学习框架——Wit。AI，微软认知服务，我瞄了一眼 Luis……对我来说，原来是 API。AI 是正确的选择。它是完全免费的，有很好的响应率，它有一个很好的开发用户界面，并且很容易设置、开始使用和扩展。</p><p id="7911" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我不打算进行 Api.ai 开发，因为那里的文档已经很棒了。Node.js SDK 只有一个缺点；涉及开发人员令牌的方法都没有实现。所以，我创造了<a class="ae ks" href="https://github.com/davidniki02/apiai-nodejs-client" rel="noopener ugc nofollow" target="_blank">我自己的叉子</a>来解决这个问题。随意克隆和使用它。</p><h2 id="2007" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">独特的问题和解决方案</h2><p id="bd02" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">当您构建一个将被许多用户使用的服务时，您希望确保信息不会重叠。例如，一个用户可能会提出一个问题，比如“哪个 ML 框架是最好的？”并将答案设置为“Api.ai ”,而另一个用户可能会将“Wit.ai”作为答案。机器人应该理解哪个用户正在被询问，并返回相应的答案。</p><p id="203e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了解决这个问题，我们使用了上下文变量——通过定义上下文，我们可以在一个单独的线程上为每个用户和她的客户端分离答案。</p><h1 id="7383" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">让用户创建他们自己的常见问题</h1><p id="eb2f" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">Api.ai 非常聪明——将它变成一个对话代理只是添加新的意图并定义机器人的响应。您还可以通过从 Api.ai 库中导入现成的模板来丰富体验，这会让您在自己的领域中占得先机。</p><p id="bf5b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要创建新的意图，你需要我之前提到的<a class="ae ks" href="https://github.com/davidniki02/apiai-nodejs-client" rel="noopener ugc nofollow" target="_blank"> github fork </a>。</p><p id="833a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我们开始之前还有一个问题。聊天机器人不会一直准确无误。当这种情况发生时，我们需要一种后退的方法。</p><p id="f0ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<a class="ae ks" href="https://universalchat.org" rel="noopener ugc nofollow" target="_blank">通用聊天中，</a>我们用两种方式来处理这个问题:</p><ol class=""><li id="0d2a" class="mi mj iq jw b jx jy kb kc kf mk kj ml kn mm kr mn mo mp mq bi translated">对于每个回答，我们允许访问者升级到一个实时操作员。当访问者这样做时，我们也会记录他们提出的问题，以便以后可以将正确答案添加到数据库中</li><li id="7995" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">有时 Api.ai 找不到答案，在这种情况下，它会返回“input.unknown”结果。这是另一个需要注意和创造问题的地方</li></ol><p id="7702" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以，现在我们有了所有的原料；</p><ul class=""><li id="8db7" class="mi mj iq jw b jx jy kb kc kf mk kj ml kn mm kr mw mo mp mq bi translated">Api.ai 作为机器学习框架</li><li id="e07e" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mw mo mp mq bi translated">可以正确创建新意图的 Node.js 分支</li><li id="ff06" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mw mo mp mq bi translated">如何构建它的路线图</li></ul><p id="7cc9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们开始吧。我不会详细讨论你在网上其他地方可以找到的问题，但是我会向你展示我们上面讨论的两个主要问题:使用上下文调用和创建意图。</p><h2 id="43c5" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">在上下文中调用</h2><p id="b333" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们将创建这个方法来查询 Api.ai:</p><blockquote class="mx my mz"><p id="c466" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">函数 ask(text，options){<br/>let apiaiRequest = apiai . text request(text，options)；</p><p id="b393" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">apiaiRequest.on('response '，(response)= &gt; { console . log(response)；})</p><p id="ef33" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">apiaiRequest.on('error '，(error)= &gt; { console . log(error)；});</p><p id="f330" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">apiairequest . end()；<br/> }</p></blockquote><p id="91f0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，您可以这样查询它:</p><blockquote class="mx my mz"><p id="391d" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">询问('某个问题'，{ <br/> sessionId:'某个会话的某个唯一 Id '，<br/>上下文:[{名称:'用户 1' }] <br/> }</p></blockquote><p id="19e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">仅此而已。用更有用的代码替换 console.log 代码。在 github 中，我展示了如何使用 promises 来重写上述内容，以获得更干净的替代方案。</p><h2 id="ff5b" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">创造新的意图</h2><p id="94a4" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">要创建新的意图，请使用 POST 方法。同样，所有这些都是有据可查的，所以我们只讨论新的内容:</p><blockquote class="mx my mz"><p id="7cc7" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">函数 create intent(options){<br/>return new Promise((resolve，reject)=&gt;{<br/>let request = app . intentpostrequest(options)；</p><p id="069a" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">request.on('response '，(response)= &gt; { return resolve(response)；});</p><p id="4a05" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">request.on('error '，(error)= &gt; { return reject(error)；});</p><p id="ad2c" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">request . end()；<br/> }) <br/> }</p></blockquote><p id="6f84" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，像这样调用它:</p><blockquote class="mx my mz"><p id="a831" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">var opts = {"name": " <the new="" question="">"，<br/> "auto": true，<br/> "templates": [" &lt;新问题&gt; " ]，<br/> "contexts": [' &lt;上下文&gt; ' ]，<br/>" user says ":[<br/>{ " data ":[{ " text ":&lt;新问题&gt; "} ]，" isTemplate": false，" count": 0 }]，<br/></the></p><p id="248e" class="ju jv na jw b jx jy jz ka kb kc kd ke nb kg kh ki nc kk kl km nd ko kp kq kr ij bi translated">创建意图(opts)</p></blockquote><p id="a49f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">需要注意的重要事项:</p><ul class=""><li id="7821" class="mi mj iq jw b jx jy kb kc kf mk kj ml kn mm kr mw mo mp mq bi translated">不要忘记<strong class="jw ir">auto:true</strong>——否则你将无法从机器学习的魔力中获益</li><li id="e7c1" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mw mo mp mq bi translated">你可能已经注意到我用了几次“新问题”——没关系，它很有效</li><li id="9171" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mw mo mp mq bi translated">您还注意到，我们在这里包含了上下文—保证问题和答案被保存起来，并分别提供给每个客户</li></ul><h2 id="9268" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">奖金；用 PHP SDK 创建意图</h2><p id="e9e2" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">如果你已经建立了一个网站来管理这些东西，你可以使用 PHP SDK。同样，最初的那个也不支持创建意图，所以我们在<a class="ae ks" href="https://github.com/davidniki02/api-ai-php" rel="noopener ugc nofollow" target="_blank">这个分支</a>中添加了它。Readme.md 中有一个不言自明的例子，所以我不会在这里打扰你。</p><h1 id="6489" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="8e86" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">现代机器学习框架使得建立对话代理变得非常容易——你刚刚在不到 4 分钟的时间里见证了一个对话代理。只是一定要引入适当的回退，以便在遇到更难的查询时拯救机器人的皮肤。</p></div></div>    
</body>
</html>