<html>
<head>
<title>“MOVIE RECOMMENDATION SYSTEM “</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">“电影推荐系统”</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fast-ai-season-1-episode-5-1-movie-recommendation-using-fastai-a53ed8e41269?source=collection_archive---------7-----------------------#2018-10-24">https://towardsdatascience.com/fast-ai-season-1-episode-5-1-movie-recommendation-using-fastai-a53ed8e41269?source=collection_archive---------7-----------------------#2018-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/9bfb913032e9309ba3d0225faee3e995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*REaMCplkacMjqWVRj4klTw.jpeg"/></div></figure><p id="4127" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">欢迎来到第五集<a class="ae ks" href="http://www.fast.ai/" rel="noopener ugc nofollow" target="_blank"> Fastdotai </a>，在这里我们将处理<strong class="jw ir">电影推荐系统</strong>。在我们开始之前，我想感谢<a class="ae ks" href="https://twitter.com/jeremyphoward" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">【杰瑞米·霍华德】</strong> </a>和<a class="ae ks" href="https://twitter.com/math_rachel" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">雷切尔·托马斯</strong> </a>为民主化人工智能所做的努力。</p><p id="ea00" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了充分利用这个博客系列，请按照以下顺序随意探索这个系列的第一部分</p><ol class=""><li id="4bf2" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-1-e9cc80d81a9d">狗 Vs 猫图像分类</a></li><li id="6116" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-2-dog-breed-classification-5555c0337d60">犬种图像分类</a></li><li id="dd9e" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-3-a-case-of-multi-label-classification-a4a90672a889">多标签图像分类</a></li><li id="8f79" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-4-1-time-series-analysis-a23217418bf1">使用神经网络的时间序列分析</a></li><li id="73b6" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://geneashis.medium.com/nlp-sentiment-analysis-on-imdb-movie-dataset-fb0c4d346d23" rel="noopener">IMDB 电影数据集上的自然语言处理情感分析</a></li><li id="0324" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-1-movie-recommendation-using-fastai-a53ed8e41269">电影推荐系统的基础</a></li><li id="9900" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-2-collaborative-filtering-from-scratch-1877640f514a">从零开始协同过滤</a></li><li id="4e99" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-3-collaborative-filtering-using-neural-network-48e49d7f9b36">使用神经网络的协同过滤</a></li><li id="b695" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://geneashis.medium.com/fast-ai-season-1-episode-6-1-write-philosophy-like-nietzsche-using-rnn-8fe70cfb923c" rel="noopener">像尼采一样写哲学</a></li><li id="8c5f" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://geneashis.medium.com/fast-ai-season-1-episode-7-1-performance-of-different-neural-networks-on-cifar-10-dataset-c6559595b529" rel="noopener">不同神经网络在 Cifar-10 数据集上的性能</a></li><li id="9dba" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://medium.com/hackernoon/single-object-detection-e65a537a1c31" rel="noopener">检测图像中最大物体的 ML 模型 Part-1 </a></li><li id="94d1" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://medium.com/hackernoon/single-object-detection-part-2-2deafc911ce7" rel="noopener"> ML 模型检测图像中最大的物体 Part-2 </a></li></ol><p id="978a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">拿一份爆米花，我们开始吧。</p><figure class="lh li lj lk gt jr"><div class="bz fp l di"><div class="ll lm l"/></div></figure><p id="c5fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，让我们导入所有需要的包。</p><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="cc78" class="ls lt iq lo b gy lu lv l lw lx">%reload_ext autoreload<br/>%autoreload 2<br/>%matplotlib inline</span><span id="b5ae" class="ls lt iq lo b gy ly lv l lw lx">from fastai.learner import *<br/>from fastai.column_data import *</span></pre><p id="93d5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">设置路径的位置</p><ul class=""><li id="4a6f" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">输入数据被存储。</li><li id="b7fd" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">将存储临时文件。(可选-在 kaggle 内核中使用)</li><li id="9bb3" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">模型重量将被存储。(可选-在 kaggle 内核中使用)</li></ul><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="bcc2" class="ls lt iq lo b gy lu lv l lw lx">path='../input/'<br/>tmp_path='/kaggle/working/tmp/'<br/>models_path='/kaggle/working/models/'</span></pre><ul class=""><li id="5c4b" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">数据的读取。</li></ul><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="3233" class="ls lt iq lo b gy lu lv l lw lx">ratings = pd.read_csv(path+'ratings.csv')<br/>ratings.head()<br/># This contains the userid , the movie that the userid watched , the time that movie has been watched , the ratings that has provided by the user .</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ma"><img src="../Images/4e0fa89868273e0a19138e8384c77750.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*-zd8HFQHTWbOEXtGanvk0Q.png"/></div></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="34ba" class="ls lt iq lo b gy lu lv l lw lx">movies = pd.read_csv(path+'movies.csv')<br/>movies.head()<br/># This table is just for information purpose and not intended for         # modelling purpose</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/ba816f35341110482f3c34d6a5adc4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*wquV6nC2fwUgVMjBmT7g4A.png"/></div></figure><p id="91e9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">创建热门电影和用户 ID 的交叉表:- </strong></p><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="b2f9" class="ls lt iq lo b gy lu lv l lw lx">g=ratings.groupby('userId')['rating'].count()<br/>topUsers=g.sort_values(ascending=False)[:15]<br/># Users who have given most number of ratings to the movies are          # considered as top Users.</span><span id="4aee" class="ls lt iq lo b gy ly lv l lw lx">g=ratings.groupby('movieId')['rating'].count()<br/>topMovies=g.sort_values(ascending=False)[:15]<br/># Movies that have got most number of ratings are topMovies .</span><span id="14f7" class="ls lt iq lo b gy ly lv l lw lx">top_r = ratings.join(topUsers, rsuffix='_r', how='inner', on='userId')<br/>top_r = top_r.join(topMovies, rsuffix='_r', how='inner', on='movieId')<br/>pd.crosstab(top_r.userId, top_r.movieId, top_r.rating, aggfunc=np.sum)</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mg"><img src="../Images/f9f24a8391fb2dd0efdbfddd54f3451d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0ULaKN6JpmwuKosOcg_Iw.png"/></div></div></figure><p id="2e04" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，我们将通过三种方式来处理电影推荐。</p><ol class=""><li id="75e0" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><strong class="jw ir">矩阵分解。</strong></li><li id="48a6" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><strong class="jw ir">从无到有的协同过滤。</strong></li><li id="f344" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><strong class="jw ir">神经网络方法。</strong></li></ol><p id="d2e3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，我们将深入研究矩阵分解方法:-</p><ol class=""><li id="231d" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><strong class="jw ir">矩阵分解:- </strong></li></ol><figure class="lh li lj lk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mh"><img src="../Images/27241c3e7dfd89fadef67b062b60129d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iu75kkn3uQ9tOv4sO2UYoA.png"/></div></div></figure><p id="a79e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">左侧方框中的表格显示了实际评级。这是我们的实际数据。</p><p id="fd80" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我详细讨论一下右表是如何组成的，左表和右表是什么关系。</p><ul class=""><li id="ea29" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated"><strong class="jw ir">制作预测收视率表(右表)</strong></li></ul><figure class="lh li lj lk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mi"><img src="../Images/4528b50029f1b5c78cbfb32f8d226474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEG-g83itrM3myBgUtMKSQ.png"/></div></div></figure><ul class=""><li id="ef63" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">右边的表以用户 id (users)为行，以电影 id (movies)为列。电影 id 和用户 id 用嵌入矩阵来描述。还记得我们在上一篇博文中讨论的嵌入矩阵吗？正如我们所知，嵌入矩阵是由嵌入向量组成的，在开始时，它们只是随机数。在上图中用紫色表示。</li><li id="e305" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">例如，用户 Id 14 由四个随机数表示。类似地，电影 Id 27 由 4 个随机数表示。这些数字乘积的总和产生了预测的等级。每个嵌入向量在开始时被随机初始化。换句话说，每个预测的评级是两个嵌入向量的矩阵乘积。</li><li id="a62e" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">我们的目标函数是最小化预测评级和实际评级之间的 RMSE。如果我们看到下面的公式</li></ul><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/2568018461e8a7a8a8341c837336e403.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*TCAhHCv-Ib5F1yBOuN8FtQ.png"/></div></figure><ul class=""><li id="f674" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated"><strong class="jw ir"> SUMXMY2 函数</strong>计算数组中相应项之间的差的平方和，并返回结果的总和。为了分解公式，它取预测值和实际值之间的 MSE(均方误差),然后求和，得出一个数字。然后将该数字除以评级数量的计数。然后我们取这个数的平方根。在上图中，这个数字用蓝色表示。这就是我们要最小化的目标函数。</li></ul><p id="8089" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="mk">？？？有什么问题吗？？？</em> </strong></p><figure class="lh li lj lk gt jr"><div class="bz fp l di"><div class="ml lm l"/></div></figure><p id="d605" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">这些嵌入向量是什么意思？</strong></p><ul class=""><li id="bf51" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">最初这些都是随机的，但是经过训练后，就开始有意义了。几个时期后，检查这些额定值。这些值会不断自我更新。因此，在几个时期之后，这些预测的额定值将接近实际额定值。据此，这些嵌入向量会自我调整。例如对于电影 Id 27(指环王):-由如下所示的 4 个数字组成的嵌入向量</li></ul><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/31be723174c32433a8d306272a1c142a.png" data-original-src="https://miro.medium.com/v2/resize:fit:96/format:webp/1*lLp55whLIYiT1tpI0SU79Q.png"/></div></figure><ul class=""><li id="81d3" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">假设每个单元格表示(%科幻，%基于 CGI，%对话驱动，%现代，%喜剧)。它表示电影的类型。</li></ul><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8440f149eb1dcedc8cc1732e2596db44.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*c9Coucyq8o9P0SSVrnLkXA.png"/></div></figure><ul class=""><li id="4ed4" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">类似地，在用户 Id 嵌入向量的情况下，每个数字表示用户 Id 14 有多喜欢科幻电影、现代 CGI 电影、对话驱动电影等等。</li><li id="2e05" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">我们将在后面讨论偏见。</li></ul><p id="c9e0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">注意:-这里我们没有任何非线性激活函数或任何类型的隐藏层。因此，它会被认为是浅薄学习的一个例子。</strong></p><p id="b2bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> Qs:-协同过滤与概率矩阵分解有何相同之处？</strong></p><p id="f0cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里我们得到的预测结果是两个不同向量的叉积。问题是，我们没有关于每个用户或电影的适当信息，所以我们假设这是理解系统的合理方式，并使用 SGD 来找到将工作的优化数字。</p><p id="61df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> Qs:-如何决定这些嵌入向量的长度？</strong></p><p id="7bc6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们应该选择一个嵌入维数，它足以代表手头问题的真正复杂性。同时，它不应该太大，否则会有太多的参数，运行时间太长，或者即使进行正则化也会产生过度拟合的结果。</p><p id="5c93" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> Qs:-负数在嵌入向量中表示什么？</strong></p><p id="75e3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">电影 id 为负数表示特定电影不属于该特定类型。在用户 ID 为负数的情况下，表示特定用户不喜欢该特定类型的电影。</p><p id="c281" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">问:-当我们有一部新电影或新用户时会发生什么？</strong></p><p id="638c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们使用网飞作为新用户，它总是问我们喜欢什么电影。并且它重新训练它的模型以便给出好的推荐。</p><ul class=""><li id="901d" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated"><strong class="jw ir">协同过滤的时间到了:- </strong></li></ul><p id="f8ac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">协同过滤推荐系统</strong>方法是用户和项目的概念。假设有一个用户 Id -14 喜欢电影 Id- 24，那么协同过滤方法说，哪个其他用户喜欢那个电影- 24，那个用户 ID-14 也喜欢。然后，它浏览与用户 Id-14 有相同偏好的其他用户的电影列表，并将这些电影推荐给用户 Id-14。</p><p id="ec56" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以它有两个部分:-</p><ol class=""><li id="ef89" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">用户 Id 和电影 Id</li><li id="9097" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">评级值(因变量)</li></ol><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="4303" class="ls lt iq lo b gy lu lv l lw lx">val_idxs = get_cv_idxs(len(ratings))<br/>wd=2e-4  # L2 Regularization , helps in preventing overfitting<br/>n_factors = 50 # Embedding dimensionalities</span><span id="d95a" class="ls lt iq lo b gy ly lv l lw lx">cf = CollabFilterDataset.from_csv(path, 'ratings.csv', 'userId', 'movieId', 'rating')<br/># 1. path - where the file is stored.<br/># 2. 'ratings.csv' - The excel file which contains the data to be read.<br/># 3. 'userId' - What should be the rows .<br/># 4. 'movieId' - What should be the columns .<br/># 5. 'rating' - Values for predictions.</span><span id="171d" class="ls lt iq lo b gy ly lv l lw lx"><br/>learn = cf.get_learner(n_factors, val_idxs, 64, opt_fn=optim.Adam, tmp_name=tmp_path, models_name=models_path)</span><span id="3a72" class="ls lt iq lo b gy ly lv l lw lx"># Finally, we train our model<br/>learn.fit(1e-2, 2, wds=wd, cycle_len=1, cycle_mult=2)</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/a3067e6aafcb9d6332bbfdc1aba82637.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*s7mhAp62NX74-W5q34-J4Q.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="3a11" class="ls lt iq lo b gy lu lv l lw lx">math.sqrt(0.766)<br/># 0.8752142594816426<br/># Let's compare to some benchmarks. Here's <a class="ae ks" href="https://www.librec.net/release/v1.3/example.html" rel="noopener ugc nofollow" target="_blank">some benchmarks</a> on the same   # dataset for the popular Librec system for collaborative filtering. They # show best results based on <a class="ae ks" href="http://www.statisticshowto.com/rmse/" rel="noopener ugc nofollow" target="_blank">RMSE</a> of 0.91. We'll need to take the square # root of our loss, since we use plain MSE.</span><span id="9bef" class="ls lt iq lo b gy ly lv l lw lx">preds = learn.predict()</span></pre><p id="2145" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">我们来分析一下结果:</strong></p><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="e317" class="ls lt iq lo b gy lu lv l lw lx">movie_names = movies.set_index('movieId')['title'].to_dict()<br/># Contains movieid and their title in form of dictionaries</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/170194dcf63575b4ec042e72c8386bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*tsjGC1VqHFHVwD71JHgYaw.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="d4d4" class="ls lt iq lo b gy lu lv l lw lx">g=ratings.groupby('movieId')['rating'].count()<br/># Which  movie got how many ratings</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/2a5cfe192c5af237ced88154937fc7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*un4dVHICQXHoIFbWoNbs8A.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="09d5" class="ls lt iq lo b gy lu lv l lw lx">topMovies=g.sort_values(ascending=False).index.values[:3000]<br/># Take the movieid of 3000 movies which has got most number of ratings.</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/1a674ef8a912f876b33c35fc0c49860a.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*sWwI3TejwXHPTVZTXNHEwQ.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="42df" class="ls lt iq lo b gy lu lv l lw lx">topMovieIdx = np.array([cf.item2idx[o] for o in topMovies])<br/># Replace the movieid with contigious ids.<br/># Check out our model below. It has 50 embedding vectors for each of movies and users . And a bias for each movie and each user.</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/0faa130f59a3cb4cbd1841a19411a8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*dTBDv_9GQxMZN04F1BfKMA.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="f5bc" class="ls lt iq lo b gy lu lv l lw lx"># First,  we'll look at the movie bias term. Here, our input is the movie # id (a  single id), and the output is the movie bias (a single float).</span><span id="f574" class="ls lt iq lo b gy ly lv l lw lx"><br/>movie_bias = to_np(m.ib(V(topMovieIdx)))</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/7deb16291c9ed3d892fd1d2c9c084f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*Bm9mEFGVI8gzWOPTg5nyJg.png"/></div></figure><ul class=""><li id="fc71" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr lz kz la lb bi translated">代码<code class="fe mu mv mw lo b">to_np(m.ib(V(topMovieIdx)))</code>将在遍历嵌入层中的每个 MovieIds 并返回其偏差后给出一个变量。</li><li id="22a9" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated"><code class="fe mu mv mw lo b">m.ib</code>指项目/电影的嵌入层，即偏置层。我们知道有 9066 部电影和与之相关的偏见。<code class="fe mu mv mw lo b">m.ib</code>将返回该图层的值。</li><li id="8005" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">模型/层需要变量来跟踪梯度，因此有了<code class="fe mu mv mw lo b">V(…)</code>。</li><li id="b909" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">使用<code class="fe mu mv mw lo b">to_np()</code>将张量转换成数值。</li><li id="ddf5" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr lz kz la lb bi translated">为了推理的目的，将模型从 GPU 移动到 CPU，使用<code class="fe mu mv mw lo b">m.cpu()</code>。并使用<code class="fe mu mv mw lo b">m.cuda()</code>将其移动到 GPU。</li></ul><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="4d7b" class="ls lt iq lo b gy lu lv l lw lx">movie_ratings = [(b[0], movie_names[i]) for i,b in zip(topMovies,movie_bias)]<br/># A list comprehension where movie_bias is stored in b and topMovies in  # movie_names. Check out the below output which returns a list of tuples # having movies and its bias .</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e25188ce41591f1147dadfcfb5f3ba06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*45tuIt4tAFuKKq566WH2wg.png"/></div></figure><p id="3a73" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">根据电影的倾向性对电影进行排序(即使用 lambda 函数对每个元组的第 0 个元素进行排序)。在检查中我们发现，偏见表明电影的质量。好电影有正面偏见，烂片有负面偏见。这就是如何解释偏见术语。</p><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="2f6a" class="ls lt iq lo b gy lu lv l lw lx">sorted(movie_ratings, key=lambda o: o[0], reverse=True)[:15]<br/># Sort the movies by its bias (i.e the 0th element of each tuple by using # lambda function). Reverse=True means in descending order of Bias       # values.</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/9017108e8090e39ba6a78a1f3394fedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*A9_eF3j0lg3fXWsLZpwFKQ.png"/></div></figure><p id="4b76" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">让我们来解释嵌入向量:- </strong></p><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="d1a0" class="ls lt iq lo b gy lu lv l lw lx">movie_emb = to_np(m.i(V(topMovieIdx)))<br/># m.i(...) for item embeddings.</span><span id="fc09" class="ls lt iq lo b gy ly lv l lw lx">movie_emb.shape</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/387e8882e80299d78980a9c17f4b7a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*LpohVr5LdCc7-FRKggy_Og.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="b0e0" class="ls lt iq lo b gy lu lv l lw lx"># Because it's hard to interpret 50 embeddings, we use <a class="ae ks" href="https://plot.ly/ipython-notebooks/principal-component-analysis/" rel="noopener ugc nofollow" target="_blank">PCA</a> to simplify    # them down to just 3 vectors.</span><span id="0ad7" class="ls lt iq lo b gy ly lv l lw lx">from sklearn.decomposition import PCA<br/>pca = PCA(n_components=3)<br/>movie_pca = pca.fit(movie_emb.T).components_<br/>movie_pca.shape</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/b9f4074f7210f5e3fc66987a7fb31886.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*mhpOXSoiPuCNijBysLqZOw.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="4f40" class="ls lt iq lo b gy lu lv l lw lx">fac0 = movie_pca[0]<br/>movie_comp = [(f, movie_names[i]) for f,i in zip(fac0, topMovies)]<br/># Here's the 1st component. It seems to be 'easy watching' vs 'serious'.</span><span id="5427" class="ls lt iq lo b gy ly lv l lw lx"># Its upto us to decide what does these Embeddings mean . Check the output below</span><span id="8a38" class="ls lt iq lo b gy ly lv l lw lx">sorted(movie_comp, key=itemgetter(0), reverse=True)[:10]</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/2f9a3e49208c1891464daf07e5778d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*P3nz8BiM8bZNNQpgFlPJyw.png"/></div></figure><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/9709a80addbd281844e6b1735feefe3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*tO4Bc7wO1rWijs2rh6EJPA.png"/></div></figure><pre class="lh li lj lk gt ln lo lp lq aw lr bi"><span id="356a" class="ls lt iq lo b gy lu lv l lw lx"># Lets interpret the 2nd component<br/>fac1 = movie_pca[1]<br/>movie_comp = [(f, movie_names[i]) for f,i in zip(fac1, topMovies)]<br/>#  It seems to be 'CGI' vs 'dialog driven'.<br/>sorted(movie_comp, key=itemgetter(0), reverse=True)[:10]</span></pre><figure class="lh li lj lk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nd"><img src="../Images/0a78fef2ef5baff89ab957c5d1979b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2CcTvLnOb2Rjey6PGO4Yw.png"/></div></div></figure><p id="fc82" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就是我们如何分析一个电影推荐系统。评价标准是最小化 RMSE。早先的误差基准是<strong class="jw ir"> 0.91 </strong>。使用 fastai，我们得到<strong class="jw ir"> 0.87。</strong></p><p id="4367" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，这种模式表现良好。</p><p id="defb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在下一部分，我们将从头开始讨论<a class="ae ks" href="https://medium.com/p/1877640f514a/edit" rel="noopener">协同过滤</a>。</p><p id="63a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mk">如果你喜欢，那么</em><strong class="jw ir"><em class="mk">ABC</em></strong><em class="mk">(</em><strong class="jw ir"><em class="mk">永远被击节</em> </strong> <em class="mk">。</em> <strong class="jw ir"> <em class="mk">👏 👏👏👏👏</em>😃😃😃😃😃😃😃😃😃<em class="mk">👏 👏👏👏👏👏</em> </strong> <em class="mk"> ) </em></p><figure class="lh li lj lk gt jr"><div class="bz fp l di"><div class="ll lm l"/></div></figure><p id="d488" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您有任何问题，请随时联系<a class="ae ks" href="http://forums.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai 论坛</a>或 Twitter:<a class="ae ks" href="https://twitter.com/ashiskumarpanda" rel="noopener ugc nofollow" target="_blank">@ ashiskumarpanda</a></p><p id="4325" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">注:随着我继续学习其他课程，这篇博文将会更新和改进。更多有趣的东西，可以随时查看我的<a class="ae ks" href="https://github.com/CaptainAshis" rel="noopener ugc nofollow" target="_blank"><em class="mk">Github</em></a><em class="mk">账号。</em></p><p id="026d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了充分利用这个博客系列，请按照以下顺序随意探索这个系列的第一部分</p><ol class=""><li id="ad6f" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-1-e9cc80d81a9d">狗 Vs 猫图像分类</a></li><li id="8cee" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-2-dog-breed-classification-5555c0337d60">犬种图像分类</a></li><li id="c548" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-3-a-case-of-multi-label-classification-a4a90672a889">多标签图像分类</a></li><li id="f10d" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-4-1-time-series-analysis-a23217418bf1">使用神经网络的时间序列分析</a></li><li id="9135" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://geneashis.medium.com/nlp-sentiment-analysis-on-imdb-movie-dataset-fb0c4d346d23" rel="noopener">对 IMDB 电影数据集的 NLP 情感分析</a></li><li id="7bfc" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-1-movie-recommendation-using-fastai-a53ed8e41269">电影推荐系统的基础</a></li><li id="8001" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-2-collaborative-filtering-from-scratch-1877640f514a">从无到有的协同过滤</a></li><li id="e550" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-3-collaborative-filtering-using-neural-network-48e49d7f9b36">使用神经网络的协同过滤</a></li><li id="09ab" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://geneashis.medium.com/fast-ai-season-1-episode-6-1-write-philosophy-like-nietzsche-using-rnn-8fe70cfb923c" rel="noopener">像尼采一样写哲学</a></li><li id="3c11" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://geneashis.medium.com/fast-ai-season-1-episode-7-1-performance-of-different-neural-networks-on-cifar-10-dataset-c6559595b529" rel="noopener">不同神经网络在 Cifar-10 数据集上的性能</a></li><li id="2cdf" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://medium.com/hackernoon/single-object-detection-e65a537a1c31" rel="noopener">检测图像中最大物体的 ML 模型 Part-1 </a></li><li id="7274" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://medium.com/hackernoon/single-object-detection-part-2-2deafc911ce7" rel="noopener">检测图像中最大物体的 ML 模型 Part-2 </a></li></ol><p id="f762" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑 1:-TFW·杰瑞米·霍华德同意你的帖子。💖💖 🙌🙌🙌 💖💖。</p><figure class="lh li lj lk gt jr"><div class="bz fp l di"><div class="ne lm l"/></div></figure></div></div>    
</body>
</html>