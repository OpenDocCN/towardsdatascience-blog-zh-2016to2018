<html>
<head>
<title>Burning GPU while training DL model? These commands can cool it down.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一边训练 DL 模型一边烧 GPU？这些命令可以冷却它。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/burning-gpu-while-training-dl-model-these-commands-can-cool-it-down-9c658b31c171?source=collection_archive---------3-----------------------#2017-07-20">https://towardsdatascience.com/burning-gpu-while-training-dl-model-these-commands-can-cool-it-down-9c658b31c171?source=collection_archive---------3-----------------------#2017-07-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/3509db1ead7f0781fd2dae752a293ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*nyLFAbTKtjv0YwOp7-KbcA.png"/></div></figure><p id="e6de" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们经常用 Geforce GPU 做个人研究的深度学习模型训练，但是满载运行时 GPU 温度会高达 84°C！那不仅仅是在烧 GPU，更是在烧我们的心！</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/9a7268a8ca14cba23ca567908949b257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*SWIspKUeseYSb-CgMowddA.png"/></div></figure><p id="69d9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">受一个来自<a class="ae kx" href="https://zhuanlan.zhihu.com/p/27682206?utm_medium=social&amp;utm_source=wechat_session" rel="noopener ugc nofollow" target="_blank"><em class="ky"/></a><em class="ky">(中文版 Quora) </em>的朋友的启发，他修改了 gpu 风扇速度来冷却 gpu，那是因为默认的 nvidia gpu 设置将 GPU 风扇速度限制在 70%或更低，我们必须手动改变 GPU 风扇速度来冷却它。</p><p id="f0d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> PS:本教程应用了 GTX GPU 的 Ubuntu OS，请注意。</strong></p><p id="1960" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi">中文版本：</p><p id="e4c6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi">I also write this article in Chinese, here is Chinese version: <a class="ae kx" href="http://www.jianshu.com/p/ab956df5e40c" rel="noopener ugc nofollow" target="_blank">深度学习训练时 GPU 温度过高？几个命令，为你的 GPU 迅速降温。</a></p><h1 id="16bf" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">如果您连接了显示器。</h1><p id="6e2f" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">步骤 1:修改/etc/X11/xorg.conf 文件:</p><pre class="kt ku kv kw gt mc md me mf aw mg bi"><span id="c616" class="mh la iq md b gy mi mj l mk ml">sudo nano /etc/X11/xorg.conf</span></pre><p id="0c47" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">步骤 2:将以下命令放入“设备部分”术语中:</p><pre class="kt ku kv kw gt mc md me mf aw mg bi"><span id="861e" class="mh la iq md b gy mi mj l mk ml">Section "Device"<br/>     Identifier      "Device0"<br/>     Driver          "nvidia"<br/>     VendorName      "NVIDIA"<br/>     Option          "Coolbits" "4"<br/>EndSection</span></pre><p id="f7aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第三步:重启你的机器。</p><p id="f34f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">步骤 4:输入以下命令:</p><pre class="kt ku kv kw gt mc md me mf aw mg bi"><span id="232f" class="mh la iq md b gy mi mj l mk ml">nvidia-settings -a “[gpu:0]/GPUFanControlState=1” -a “[fan:0]/GPUTargetFanSpeed=100”</span></pre><blockquote class="mm mn mo"><p id="52cb" class="ju jv ky jw b jx jy jz ka kb kc kd ke mp kg kh ki mq kk kl km mr ko kp kq kr ij bi translated">“gpuFanControlState=1”表示可以手动改变风扇转速，“[fan:0]”表示要设置哪个 GPU 风扇，“GPUTargetFanSpeed=100”表示将转速设置为 100%，但那样会很吵，可以选择 80%。</p></blockquote><h1 id="3815" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">如果没有连接显示器。</h1><p id="f4a5" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">我们经常使用 ssh 连接机器，所以机器不会连接显示器。但是上面的方法只有在你有显示器的时候才有效，所以我们必须做些什么来欺骗你的操作系统，让它认为你有显示器。</p><p id="0a14" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">解决方案参考这篇文章:<a class="ae kx" href="https://devtalk.nvidia.com/default/topic/831440/linux/fan-speed-without-x-headless-powermizer-drops-card-to-p8/" rel="noopener ugc nofollow" target="_blank">风扇转速无 X(无头):powermizer 掉卡到 p8 </a>，作者提供了一个改变风扇转速的脚本。下面是完整的步骤:</p><p id="6a74" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第一步:将这个<a class="ae kx" href="https://github.com/boris-dimitrov/set_gpu_fans_public" rel="noopener ugc nofollow" target="_blank"> repo </a>克隆到这个目录:/opt</p><pre class="kt ku kv kw gt mc md me mf aw mg bi"><span id="5b16" class="mh la iq md b gy mi mj l mk ml">cd /opt<br/>git clone https://github.com/boris-dimitrov/set_gpu_fans_public</span></pre><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/15b512250a4b94d7511d0fb41bf669b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYEErwi71g0ztlnZuTdIVA.png"/></div></div></figure><p id="6db7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个回购包括这些文件，关键脚本是“cool_gpu”。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/a6f7576554d9d790faff3de842ebb613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*WO0Tm2E0E7hwKqSlQENAeQ.png"/></div></figure><p id="e0d5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第二步:把文档的名字从“set_gpu_fans_public”改成“set-gpu-fans”，那是作者的小错别字。</p><p id="2b77" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe my mz na md b">sudo mv set_gpu_fans_public set-gpu-fans</code></p><p id="9ae3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">步骤 3 : cd 到 set-gpu-fans 目录，并输入以下命令:</p><pre class="kt ku kv kw gt mc md me mf aw mg bi"><span id="b6aa" class="mh la iq md b gy mi mj l mk ml">cd /opt/set-gpu-fans<br/>sudo tcsh<br/>./cool_gpu &gt;&amp; controller.log &amp;<br/>tail -f controller.log</span></pre><p id="6280" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它将启动冷却脚本，您可以看到以下过程:</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nb"><img src="../Images/c3613aedf93dd95af3e5aab4ac2d1981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FatkqZt2ZpwGA62qryCcXw.png"/></div></div></figure><p id="9a10" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">测试时间</strong>:</p><p id="65e1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我们测试它是否可以冷却 gpu 之前，我们检查当前的温度。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nc"><img src="../Images/045a9a6c442c0e732f40bb350f2c26dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OfQ3uAYZHbPCaN6kNhsuA.png"/></div></div></figure><p id="ae54" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在大概是 37°C，好的，我们来运行一个模型，看看效果如何。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nd"><img src="../Images/9e09df5bf9e34c7f2506b526c857a407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_1zt3Jx9S_t35HcugLcKA.png"/></div></div></figure><p id="42ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">温度越来越高，当它变得稳定时，你可以看到最终温度:</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ne"><img src="../Images/2a05a7d6e15fd031599be12281a1863c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZkoWujwsCMXTF1Xpe0ARg.png"/></div></div></figure><p id="ab25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">哇，我们做到了！我们将 gpu 从 84°C 冷却到 67°C！那真的太牛逼了！</p><p id="e226" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有一件事你应该知道，目前的 GPU 功率状态是 P2，这意味着它运行在高性能，最高的是 P0，最低的是 P12。这个冷却脚本工作得非常好，而且没有降低性能。</p><h1 id="9a4c" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">立正！冷却脚本的原始版本会降低 GPU 性能！</h1><p id="e46d" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">我们上面使用的脚本是原始脚本的改进版本，原始脚本在这里:<a class="ae kx" href="https://devtalk.nvidia.com/default/topic/789888/set-fan-speed-without-an-x-server-solved-/?offset=" rel="noopener ugc nofollow" target="_blank">设置风扇速度，不需要 X 服务器</a>。</p><p id="e45a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">许多人使用原始脚本会导致性能下降的问题，它会将电源状态从 P2 下降到 P8，甚至 P12，所以我强烈建议不要使用原始的。但我们还是要对原剧本作者付出一定的尊重，没有他的作品我们无法改变粉丝速度。</p><p id="8802" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你觉得这篇文章能帮到你，请点击心脏，分享给你的朋友！感谢阅读。</p></div></div>    
</body>
</html>