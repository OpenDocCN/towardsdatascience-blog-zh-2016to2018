<html>
<head>
<title>Predictive Modeling with Iowa State Liquor Sales Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">爱荷华州白酒销售数据的预测模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predictive-modeling-with-iowa-state-liquor-sales-data-e45342081b83?source=collection_archive---------2-----------------------#2017-04-02">https://towardsdatascience.com/predictive-modeling-with-iowa-state-liquor-sales-data-e45342081b83?source=collection_archive---------2-----------------------#2017-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="33fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好朋友们，</p><p id="e333" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我的任务是利用爱荷华州的大量酒类销售数据建立一个预测模型。</p><p id="6907" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一个简短的背景，爱荷华州是一个酒精饮料控制州，这意味着该州在全州范围内保持着对酒类批发的垄断。实际上，私人零售商必须从州政府那里购买酒，然后才能卖给个人消费者。你可以在<a class="ae kl" href="https://en.wikipedia.org/wiki/Iowa_Alcoholic_Beverages_Division" rel="noopener ugc nofollow" target="_blank">爱荷华酒精饮料部门</a>的维基页面上了解更多。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/64eb46a8f75594cc0ef48ea4089853e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e3XouWJprVxIDzxzLgWPpw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">The majestic Iowa flag</figcaption></figure><p id="33ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于这个项目的目的，我利用了爱荷华州白酒销售数据的子集，这些数据可以在爱荷华州的<a class="ae kl" href="https://data.iowa.gov/Economy/Iowa-Liquor-Sales/m3tr-qhgy" rel="noopener ugc nofollow" target="_blank">州托管的开放数据门户</a>上找到。虽然门户网站包含2012年以来的酒类销售，但我使用的数据集包含了2015年全年和2016年第一季度(1-3月)的单个酒类销售。该项目的目标是使用2015年的销售数据建立一个模型，该模型可以根据Q1 2016年的数据预测2016年的总销售额。我使用Python中的Pandas库分析了数据。</p><p id="4b63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，该数据集包含超过270万行数据。每项观察包含的信息包括:</p><ul class=""><li id="b900" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">购买日期(年/月/日)</li><li id="6d9c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">进行购买的供应商的详细信息(例如，指定的商店编号、县和城市详细信息)；</li><li id="8eba" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">购买的酒的类型和品牌(例如，杰克丹尼尔的田纳西威士忌)；</li><li id="da52" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">瓶子尺寸(例如750毫升)和购买的瓶子数量；</li><li id="6e15" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">总销售额，包括国家和每瓶零售成本；和</li><li id="4c1e" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">出售的酒的总体积，单位为升和加仑</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lq"><img src="../Images/5fa7f5c707c20f8aaa67531a8cee8967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ahOKzGYPWsgvRQleuALY2w.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">A snapshot of select columns in the original dataset. There are many additional data columns not pictured here.</figcaption></figure><h1 id="abff" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">初始数据清理和探索性分析</h1><p id="b7d6" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">最初的数据清理和探索性分析包括以下步骤。</p><p id="6af3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">常规数据清理:</p><ul class=""><li id="9cb5" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">提高列名的清晰度，根据需要转换数据类型。</li><li id="9931" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">删除重复行</li><li id="9673" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">用真空值替换字符串“nan”值</li><li id="9415" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">对于成对的列(category_ID和category_name)，如果一个列值没有相邻的对，我就填充它，如果可以的话，否则就把它改为null</li></ul><p id="b6a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保正确的计算:</p><ul class=""><li id="7884" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">确保瓶子尺寸(例如750毫升)x售出的瓶子=售出的体积升数</li><li id="d386" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">确保瓶子的零售价值x售出的瓶子=销售额</li><li id="f3d4" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">我没有发现数学上的问题，但是检查一下还是很好的</li></ul><h1 id="4928" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">准备模型构建</h1><p id="9127" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我知道，如果我能把大部分数据分成更简单的类别，分析会容易得多。因此，我创建了几个新的专栏，从长远来看，这会让我的生活变得更加轻松。</p><p id="a667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，我创建了一个列，将日期条目折叠到它们发生的季度和年份:</p><p id="6318" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(我将我的数据帧命名为爱荷华酒精的i_a)</p><pre class="kn ko kp kq gt mu mv mw mx aw my bi"><span id="c249" class="mz ls iq mv b gy na nb l nc nd">#Generating column for quarter-year<br/>i_a[“Quarter_Year”] = “-”</span><span id="d4bc" class="mz ls iq mv b gy ne nb l nc nd">i_a.ix[(i_a.Date &gt; ‘2014–12–31’) &amp; (i_a.Date &lt; ‘2015–04–01’), “Quarter_Year”] = “Q1_2015”<br/>i_a.ix[(i_a.Date &gt; ‘2015–03–31’) &amp; (i_a.Date &lt; ‘2015–07–01’), “Quarter_Year”] = “Q2_2015”<br/>i_a.ix[(i_a.Date &gt; ‘2015–06–30’) &amp; (i_a.Date &lt; ‘2015–10–01’), “Quarter_Year”] = “Q3_2015”<br/>i_a.ix[(i_a.Date &gt; ‘2015–09–30’) &amp; (i_a.Date &lt; ‘2016–01–01’), “Quarter_Year”] = “Q4_2015”<br/>i_a.ix[(i_a.Date &gt; ‘2015–12–31’) &amp; (i_a.Date &lt; ‘2016–04–01’), “Quarter_Year”] = “Q1_2016”</span></pre><p id="33f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还创建了单独的列来计算每笔交易的总零售成本和州的总成本，以了解该州从其酒类销售中获得了多少利润。</p><p id="7885" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当检查某些类别和2015年总销售额之间的关联时，我可以看到与其他不太受欢迎的选项相比，某些项目占总销售额的很大一部分。</p><p id="ee0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，有30多种不同的瓶子尺寸(体积/毫升)。然而，绝大多数售出的瓶子要么是750毫升、1000毫升，要么是1750毫升。为了使进一步的分析和模型构建更容易，我创建了一个列来指示所购买的酒的瓶子大小是750毫升、1000毫升、1750毫升还是其他。</p><pre class="kn ko kp kq gt mu mv mw mx aw my bi"><span id="45be" class="mz ls iq mv b gy na nb l nc nd">i_a[“Consolidated_Bottle_ml”] = “”</span><span id="43fd" class="mz ls iq mv b gy ne nb l nc nd">#After examining data, it made sense to consolidate bottle sizes into 750ml, 1000ml, 1750ml, and all others<br/>i_a.ix[i_a.Bottle_Volume_ml == 750, “Consolidated_Bottle_ml”] = “750ml”<br/>i_a.ix[i_a.Bottle_Volume_ml == 1000, “Consolidated_Bottle_ml”] = “1000ml”<br/>i_a.ix[i_a.Bottle_Volume_ml == 1750, “Consolidated_Bottle_ml”] = “1750ml”<br/>i_a.ix[i_a.Consolidated_Bottle_ml == “”, “Consolidated_Bottle_ml”] = “Other_ml”</span></pre><p id="ff7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当绘制与这些类别相关的相对总销售额时，可以清楚地看到这些瓶子尺寸在所有其他产品中的主导地位:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/d0de93646ae4756dfd81cc2b1def7dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IIzLCZXKUbMk-4JS7PGfzw.png"/></div></div></figure><p id="4e32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，我注意到酒类的大趋势表明，许多购买的要么是各种威士忌，要么是伏特加。为了解析这些，我对类别字符串进行了文本搜索，以表明所购买的酒是某种威士忌、伏特加还是其他什么:</p><pre class="kn ko kp kq gt mu mv mw mx aw my bi"><span id="f329" class="mz ls iq mv b gy na nb l nc nd">#Creating “Is_” columns as booleans for each type in the list above<br/>#After further analysis, only whiskey and vodka seem to warrant their own categories, with everything else in “Other”</span><span id="de5a" class="mz ls iq mv b gy ne nb l nc nd">i_a[“Is_WHISK”] = i_a[‘Alcohol_Category_Name’].str.contains(“WHISK”)<br/>i_a[“Is_VODKA”] = i_a[‘Alcohol_Category_Name’].str.contains(“VODKA”)</span><span id="6338" class="mz ls iq mv b gy ne nb l nc nd">#Creating new column to identify consolidated alcohol type</span><span id="a3a1" class="mz ls iq mv b gy ne nb l nc nd">i_a[“Consolidated_Category”] = “”</span><span id="d0a0" class="mz ls iq mv b gy ne nb l nc nd">#Assigning values as either Whiskey, Vodka, or Non-Whiskey-Vodka, depending on true values in "Is_" columns. If the category is neither whiskey, nor vodka, or is null, assigning it to this other category.</span><span id="eb27" class="mz ls iq mv b gy ne nb l nc nd">i_a.ix[i_a.Is_WHISK == True, “Consolidated_Category”] = “WHISKEY”<br/>i_a.ix[i_a.Is_VODKA == True, “Consolidated_Category”] = “VODKA”<br/><br/>i_a.ix[((i_a.Is_WHISK == False) &amp; (i_a.Is_VODKA == False)) | (i_a.Alcohol_Category_Name.isnull()), “Consolidated_Category”] = “NON-WHISKEY-VODKA”</span></pre><p id="1c7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，你会注意到与所有其他烈性酒相比，威士忌和伏特加这两种酒是多么突出:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/8dfc328b5058c839347db8cf5a169ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Odw2idlIWf6ohO8Ht_Gnng.png"/></div></div></figure><p id="e769" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我可以看到大部分销售收入的分组，我觉得我有足够的信息来开始构建一个模型</p><h1 id="3b95" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">转换数据集</h1><p id="88fb" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">为了构建我的模型，我知道我需要仅使用一个季度的销售数据来预测全年的销售。</p><p id="fc40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，我想转换我的数据集，按商店编号对数据进行分组，然后构建一个模型，根据一个季度的数据预测每个商店的年总销售额。</p><p id="414c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道我希望将预测变量的数量保持在最小，所以我希望选择那些看起来能解释总销售额中最大差异的变量。</p><p id="0263" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">具体来说，我想根据与四个变量相关的Q1 2015年销售额来预测年总销售额:750毫升瓶、1000毫升瓶、1750毫升瓶，以及非威士忌/非伏特加酒的购买量。</p><p id="a34f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在pandas中实现这一点，我使用groupby语句创建了一系列独立的数据帧，然后将这些不同的数据帧连接在一起，以创建我的最终建模集。</p><p id="50e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用多个变量分组，用“.unstack()"函数有助于将每个感兴趣的变量存储为自己的列，而不是分层嵌套结果。在开始这个过程之前，我还创建了一个单独的日期框架，仅包含2015年的数据(i_a_2015)。</p><p id="1223" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(有几个额外的变量我没有包括在我的最终模型中，它们最初是为了好奇而添加的。)</p><pre class="kn ko kp kq gt mu mv mw mx aw my bi"><span id="bf77" class="mz ls iq mv b gy na nb l nc nd">#Use the data from 2015 to make a linear model using as many variables as you find useful to predict the yearly sales of all stores.</span><span id="97d5" class="mz ls iq mv b gy ne nb l nc nd">#We don’t want to use ALL of the data from the variables of interest — we only want about 1/4 of it (as we’ll only have a quarter’s worth of data from 2016 when generating predictions for all of 2016.)</span><span id="f08d" class="mz ls iq mv b gy ne nb l nc nd">#create dataframe grouped by store for 2015 that will be used for building regression model</span><span id="840a" class="mz ls iq mv b gy ne nb l nc nd">#We DO still keep ALL of the sales data from 2015 as the target variable, as we want to predict the final 2016 totals<br/>#for all stores</span><span id="8aac" class="mz ls iq mv b gy ne nb l nc nd">store_sales_2015 = pd.DataFrame(i_a_2015.groupby(“Store_Number”).Sale_Dollars.sum())</span><span id="63d4" class="mz ls iq mv b gy ne nb l nc nd">store_sales_2015.rename(columns={‘Sale_Dollars’:’Sale_Dollars_Total_2015'}, inplace=True) </span><span id="f954" class="mz ls iq mv b gy ne nb l nc nd">#Drawing out bottles_sold; keeping Q1 data and dropping Q2:Q4</span><span id="9859" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_bottle_sold = pd.DataFrame(i_a_2015.groupby([“Store_Number”, “Quarter_Year”]).Bottles_Sold.sum().unstack())</span><span id="8934" class="mz ls iq mv b gy ne nb l nc nd">#alter Q1_2015 column name for easier interpretability</span><span id="3f6d" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_bottle_sold.rename(columns={‘Q1_2015’:’Bottles_Sold_Q1_2015'}, inplace=True)</span><span id="a02d" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_bottle_sold.drop([‘Q2_2015’, “Q3_2015”, “Q4_2015”], axis=1, inplace=True)</span><span id="4fb6" class="mz ls iq mv b gy ne nb l nc nd">#Finding the “mode” of the stores’ counties, which will be the only item associated with each store</span><span id="fa75" class="mz ls iq mv b gy ne nb l nc nd">add_store_county = pd.DataFrame(i_a_2015.groupby(“Store_Number”).County.agg(lambda x:x.value_counts().index[0]))</span><span id="b1f9" class="mz ls iq mv b gy ne nb l nc nd">#Creating df of only Q1_2015 to make extracting of bottle sizes and other multi-variable columns easier</span><span id="77ad" class="mz ls iq mv b gy ne nb l nc nd">i_a_Q1_2015 = i_a[i_a[“Quarter_Year”] == “Q1_2015”]</span><span id="275c" class="mz ls iq mv b gy ne nb l nc nd">#Drawing out bottles_sizes sales volume for 750ml, 1000ml, 1750ml, and other_ml for Q1_2015;</span><span id="192c" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_bottle_sizes = pd.DataFrame(i_a_Q1_2015.groupby([“Store_Number”, “Consolidated_Bottle_ml”]).Sale_Dollars.sum().unstack())</span><span id="1bd2" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_bottle_sizes.rename(columns={‘1000ml’:’1000ml_Sales_Q1_2015', ‘1750ml’:’1750ml_Sales_Q1_2015',’750ml’:’750ml_Sales_Q1_2015',’Other_ml’:’Other_ml_Sales_Q1_2015'}, inplace=True)</span><span id="fcab" class="mz ls iq mv b gy ne nb l nc nd">#Drawing out consolidated_category sales volume for whiskey, vodka, and others for Q1_2015;</span><span id="69aa" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_consolidated_category = pd.DataFrame(i_a_Q1_2015.groupby([“Store_Number”, “Consolidated_Category”]).Sale_Dollars.sum().unstack())</span><span id="b955" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_consolidated_category.rename(columns={‘NON-WHISKEY-VODKA’:’NON-WHISKEY-VODKA_Sales_Q1_2015', ‘VODKA’:’VODKA_Sales_Q1_2015',’WHISKEY’:’WHISKEY_Sales_Q1_2015'}, inplace=True) #saves changes</span><span id="16ac" class="mz ls iq mv b gy ne nb l nc nd">#drawing out total Q1 sales from initial i_a_2015 df, dropping Q2, Q3, and Q4</span><span id="b2ed" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_total_sales = pd.DataFrame(i_a_2015.groupby([“Store_Number”, “Quarter_Year”]).Sale_Dollars.sum().unstack())</span><span id="e8cc" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_total_sales.rename(columns={‘Q1_2015’:’Q1_2015_total_sales’}, inplace=True) #saves changes </span><span id="a8ac" class="mz ls iq mv b gy ne nb l nc nd">add_Q1_total_sales.drop([‘Q2_2015’, “Q3_2015”, “Q4_2015”], axis=1, inplace=True)</span><span id="0615" class="mz ls iq mv b gy ne nb l nc nd">#creating final dataframe for modeling by concatenating all other dfs</span><span id="7d8a" class="mz ls iq mv b gy ne nb l nc nd">model_df = pd.concat([store_sales_2015, add_Q1_bottle_sold, add_store_county, add_Q1_bottle_sizes, <br/> add_Q1_consolidated_category, add_Q1_total_sales], axis=1)</span><span id="c171" class="mz ls iq mv b gy ne nb l nc nd">#there are some NaN values where stores didn’t buy certain bottle sizes or liquor types — convert to zeros</span><span id="af57" class="mz ls iq mv b gy ne nb l nc nd">model_df.fillna(value=0, inplace=True)</span></pre><p id="8468" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成所有这些后，我们有了2015年总销售额的数据框架，并选择了可用于预测的Q1销售变量。让我们快速浏览一下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/c3e9fc30d719334a10aef72edacdb049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8sLwkQNuXI0kgWn1ENZ7fw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">A snapshot of our dataframe used for modeling. The Index column on the far left is each store’s assigned number. Not all columns are pictured here.</figcaption></figure><p id="b977" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查我感兴趣的变量的关联热图，我可以看到这些变量之间有中等强度的关联，这并不完全令人惊讶(特别是考虑到非威士忌/非伏特加酒将固有地与瓶子大小重叠)。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ni"><img src="../Images/175f817caa92b2144726804e0ac598d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZkaDWcAkTCPrqTSiLqHdPg.png"/></div></div></figure><h1 id="fb77" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">构建预测模型</h1><p id="45e2" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">为了训练和测试我的模型，我对2015年的模型集进行了70:30的训练测试分割。这意味着我可以使用建模数据框架中70%的数据来拟合我的模型，然后用拟合模型时没有使用的剩余30%的数据来测试我的模型的准确性。</p><p id="dea0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的代码中:</p><p id="075e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">X =仅使用上述热图中列出的变量的存储数据对数据框架进行建模</p><p id="2ea3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">y =仅包含2015年商店总销售额的数据框架</p><pre class="kn ko kp kq gt mu mv mw mx aw my bi"><span id="4772" class="mz ls iq mv b gy na nb l nc nd">from sklearn import linear_model<br/>from sklearn.model_selection import train_test_split</span><span id="853e" class="mz ls iq mv b gy ne nb l nc nd">#Conducting 70:30 train-test split for purposes of building and testing model. Set random state = 1 for reproducibility.</span><span id="cfd5" class="mz ls iq mv b gy ne nb l nc nd">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=1)</span><span id="6207" class="mz ls iq mv b gy ne nb l nc nd">#instantiate linear model for ease of coding below</span><span id="988c" class="mz ls iq mv b gy ne nb l nc nd">lm = linear_model.LinearRegression() </span><span id="0abd" class="mz ls iq mv b gy ne nb l nc nd">#generate fit of model base on training set<br/>#fit method expects two arguments of x’s and y’s</span><span id="23c2" class="mz ls iq mv b gy ne nb l nc nd">model = lm.fit(X_train, y_train) </span><span id="446f" class="mz ls iq mv b gy ne nb l nc nd">#generate predicted values of y_test from X_test based off of training set</span><span id="0e19" class="mz ls iq mv b gy ne nb l nc nd">predictions = lm.predict(X_test)</span><span id="5e57" class="mz ls iq mv b gy ne nb l nc nd">#plotting predicted ys against y values in test set </span><span id="052d" class="mz ls iq mv b gy ne nb l nc nd">plt.scatter(y_test, predictions) <br/>plt.xlabel(“True 2015 Total Sales”)<br/>plt.ylabel(“Predicted 2015 Total Sales”)</span></pre><p id="1643" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">得到的模型的R =.956，这意味着该模型解释了商场2015年年度销售额中约95.6%的差异，这是根据我选择的变量中的Q1销售数据得出的。这是预测值与实际值的对比图:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nj"><img src="../Images/2c437c39d4b2ca3397a80a795a58f8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXdF9QsrF9iCPLZcv6PwXA.png"/></div></div></figure><p id="645c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用交叉验证和正则化方法进一步检查了这个模型，但是这篇博文已经够长了，而且他们没有给已经不存在的模型增加太多东西。</p><h1 id="1576" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">对2016年进行预测</h1><p id="6ab2" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">最后一步，是为我现有的2016年Q1再现一个类似的建模数据框架(按商店分类的信息)，然后为每个商店的2016年总销售额生成预测。我使用了与上面巨大代码块非常相似的代码来生成2016预测集。</p><p id="1a32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">生成预测后，我将预测(LM_Predictions)附加到每个商店的行中，如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nk"><img src="../Images/03bdfa825505740e9082cae325e16516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDa8sT0DCiErUfIPBcn1iQ.png"/></div></div></figure><h1 id="2feb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated"><strong class="ak">最终结果</strong></h1><p id="ba22" class="pw-post-body-paragraph jn jo iq jp b jq mp js jt ju mq jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我建立的线性模型预测2016年白酒总销售额为2.92亿美元，比2015年(2.84亿美元)增长3%。</p><p id="fe58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中，该州2015年的利润占总销售额的33%(9500万美元)，该州2016年的预计利润为9800万美元。很酷，东西！</p></div></div>    
</body>
</html>