<html>
<head>
<title>Tutorial: Asynchronous Speech Recognition in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:Python中的异步语音识别</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tutorial-asynchronous-speech-recognition-in-python-b1215d501c64?source=collection_archive---------0-----------------------#2017-05-25">https://towardsdatascience.com/tutorial-asynchronous-speech-recognition-in-python-b1215d501c64?source=collection_archive---------0-----------------------#2017-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f6e0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个(相当)简单的技术，用于使用Google有点儿有点儿令人困惑的语音识别API</h2></div><p id="3e29" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们面对它:它很难与谷歌的机器学习模型竞争。该公司拥有如此多的数据，以至于在准确性和质量方面彻底击败了竞争对手。不幸的是，谷歌在为其API提供易于理解和最新的文档方面做得不够好，这使得初级和中级程序员很难入门。</p><p id="58a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我最近在尝试使用其语音识别API转录大约1，200条新闻广播时遇到了这个问题。因为Google最近改变了它的云API，所以我在网上找到的很多例子都不是很有帮助。甚至当我更新了<a class="ae lc" href="https://cloud.google.com/sdk/docs/" rel="noopener ugc nofollow" target="_blank">云SDK </a>的时候，我仍然在尝试运行他们的样本代码时遇到了问题。</p><p id="f88c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种替代方法是使用<a class="ae lc" href="https://pypi.python.org/pypi/SpeechRecognition/" rel="noopener ugc nofollow" target="_blank"> SpeechRecognition库</a>，但是据我所知，它只适用于同步请求，同步请求的持续时间被限制在一分钟以内。也许一个更好的程序员可以在使用谷歌的Python API的同时找到解决方案，但是你被我卡住了。:)</p><p id="0335" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要完成本教程，您需要以下工具:</p><ul class=""><li id="59bb" class="ld le iq kh b ki kj kl km ko lf ks lg kw lh la li lj lk ll bi translated"><strong class="kh ir"> Python 2.7 </strong></li><li id="a30c" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated"><strong class="kh ir">一个谷歌账户</strong></li><li id="c4d5" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated"><a class="ae lc" href="http://sox.sourceforge.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> Sox </strong> </a></li><li id="dbaf" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated"><strong class="kh ir">一个wav文件</strong>(此处下载<a class="ae lc" href="https://drive.google.com/open?id=0Bxb087czT-HMNHBuMHRDSHZhRG8" rel="noopener ugc nofollow" target="_blank"/></li></ul><h2 id="593e" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">激活云服务</h2><p id="ef54" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">前往<a class="ae lc" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云主页</a>并注册免费试用。只要注册，你就可以获得300美元的免费积分。</p><p id="cca8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 1)创建一个“项目”来存储你的凭证和账单信息</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mp"><img src="../Images/80cc472302ed50ddb4f21fffaf624545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLKPh_FYlYbGA3Vv7RIT1Q.png"/></div></div></figure><p id="e5cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2)启用谷歌语音API，按照提示激活计费。不要担心，在您升级到付费帐户之前，不会向您收费。</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nb"><img src="../Images/edb6618c75fce7538480868b666f15ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKqoaYlpNVJikWfOd4Zm0w.png"/></div></div></figure><p id="fe00" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3)创建一个API密匙并保存起来以备后用。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nc"><img src="../Images/5781a5f470761a2277619730751b7869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7U5FJwPF0tm5ZqUb7H9xQA.png"/></div></div></figure><p id="e71b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 4)创建一个云存储“桶”。这是我们将要存放我们想要转录的文件的地方。不幸的是，为了使用异步服务，你不得不在谷歌存储器上托管文件。</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nd"><img src="../Images/99d3e2ceafa294d9f3b67d4c5ee4cd4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBMzXeFEQSzjncnSIT0DcQ.png"/></div></div></figure><h2 id="a6c2" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">安装Sox</h2><p id="b880" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">下一步是在我们的机器上安装Sox。Sox是一个非常容易使用的命令行工具，用于操作音频文件。</p><p id="2c05" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您使用的是<strong class="kh ir"> Mac </strong>，您可以通过在终端中运行以下命令来使用Homebrew安装Sox及其依赖项:</p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="10e4" class="lr ls iq nf b gy nj nk l nl nm">brew install sox</span></pre><p id="8b25" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你使用的是<strong class="kh ir"> Ubuntu </strong>，你可以从终端运行以下命令:</p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="4c92" class="lr ls iq nf b gy nj nk l nl nm">sudo apt-get install libasound2-plugins libasound2-python libsox-fmt-all<br/>sudo apt-get install sox</span></pre><h2 id="78df" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">将音频转换为单声道</h2><p id="84b7" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">现在我们已经安装了Sox，我们可以开始设置Python脚本了。因为Google的语音识别API只接受单通道音频，我们可能需要使用Sox来转换我们的文件。您可以通过查看计算机上的文件属性来进行检查:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/7f86ff397cde59748a58465c4edde7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*smdvh7i6SjT2HqtVtDHBOg.png"/></div></figure><p id="cafa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您的文件已经是单声道的，您可以跳过这一步。如果没有，我们可以使用Sox很容易地将其从Python转换过来。</p><ul class=""><li id="083f" class="ld le iq kh b ki kj kl km ko lf ks lg kw lh la li lj lk ll bi translated"><strong class="kh ir"> 1)导入子进程库以访问我们的可执行程序</strong></li></ul><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="b2e2" class="lr ls iq nf b gy nj nk l nl nm">import subprocess</span></pre><ul class=""><li id="6298" class="ld le iq kh b ki kj kl km ko lf ks lg kw lh la li lj lk ll bi translated"><strong class="kh ir"> 2)编写并运行Sox命令来编写一个只有一个通道的新文件。</strong></li></ul><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="33bb" class="lr ls iq nf b gy nj nk l nl nm">filename = "test/test.wav"<br/>newfilename = "test/newtest.wav"<br/>command = ['sox', filename, '-c', '1', newfilename] <br/>subprocess.Popen(command)</span></pre><ul class=""><li id="1e3e" class="ld le iq kh b ki kj kl km ko lf ks lg kw lh la li lj lk ll bi translated"><strong class="kh ir"> 3)验证我们新转换的文件是否正确。</strong></li></ul><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9e05660ff7b4f139319ab6be29d33284.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*7-GJCAX5gdQ76Trn3jHVFQ.png"/></div></figure><h2 id="6695" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">上传转换后的文件</h2><p id="159d" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">随着我们的音频转换为单声道，我们需要做的就是将新的音频上传到谷歌存储，然后我们就可以开始我们的Python脚本了。虽然这可能是您希望使用Google Storage API模块以编程方式完成的事情，但这超出了本教程的范围。</p><p id="6ebb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，我们将只使用我们之前使用的基于web的GUI。您需要选中“公开共享”选项，如图所示。请记住，这将对整个世界开放，直到您将其从Google Storage中删除或更改权限。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi np"><img src="../Images/47b8911f5997c338e0275ccce01e15e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k24hMbsZ8AxgaPuSdFPZTQ.png"/></div></div></figure><p id="da87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 1)导入请求库，用于向Google的API和json库发出请求，以解析响应。</strong></p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="4a72" class="lr ls iq nf b gy nj nk l nl nm">import requests<br/>import json</span></pre><p id="2c47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2)定义我们在发出请求时将使用的URL。您需要用您之前制作的API密钥来填充空白。</strong></p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="cd3b" class="lr ls iq nf b gy nj nk l nl nm">url = "https://speech.googleapis.com/v1/speech:longrunningrecognize?key=YOURAPIKEYHERE"</span></pre><p id="0309" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3)为我们的JSON请求创建参数。这些只是我们可以指定的几个可能的参数。你可以在这里  <strong class="kh ir">查看其他</strong> <a class="ae lc" href="https://cloud.google.com/speech/docs/async-recognize#speech-async-recognize-gcs-protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">。</strong></a></p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="0fee" class="lr ls iq nf b gy nj nk l nl nm">payload = {<br/>    "config": {<br/>      "encoding": "LINEAR16",<br/>      "sample_rate_hertz": 48000,<br/>      "language_code": "en-US"</span><span id="1fbd" class="lr ls iq nf b gy nq nk l nl nm">    },<br/>    "audio": {<br/>        "uri": "gs://BUCKETNAMEHERE/FILENAMEHERE.wav"</span><span id="d05c" class="lr ls iq nf b gy nq nk l nl nm">    }<br/>}</span></pre><p id="f33c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发送请求并保存响应。</p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="be2e" class="lr ls iq nf b gy nj nk l nl nm">r = requests.post(url, data=json.dumps(payload))</span></pre><p id="2695" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">响应应该包括一个数字标记，我们将使用它来访问我们的转录结果。输出将类似于这样:</strong></p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="29c3" class="lr ls iq nf b gy nj nk l nl nm">Out[1]: {u'name': u'5284939751989548804'}</span></pre><p id="9417" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以这样保存令牌:</p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="8856" class="lr ls iq nf b gy nj nk l nl nm">json_resp = r.json()<br/>token_resp = json_resp['name']</span></pre><p id="4cd6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检索结果(你需要等待几秒钟)。</p><pre class="mq mr ms mt gt ne nf ng nh aw ni bi"><span id="772f" class="lr ls iq nf b gy nj nk l nl nm">url = "https://speech.googleapis.com/v1/operations/" + str(token_resp) + "?key=YOURAPIKEYHERE"<br/>content_response = requests.get(url)<br/>content_json = content_response.json()</span></pre><p id="794c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">输出应该是这样的:</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nr"><img src="../Images/c04f1d49028695ef3d19e1828101e7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fb8iyeM_CPf48gn-x8RVuA.png"/></div></div></figure><h2 id="764c" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">瞧啊。</h2><p id="b177" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">您已经准备好为自己的项目构建语音识别管道。如果您有任何问题(或更可能的建议)，请不要犹豫，发表评论。</p></div></div>    
</body>
</html>