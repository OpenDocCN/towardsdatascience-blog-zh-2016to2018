<html>
<head>
<title>Python Plotting API: Expose your scientific python plots through a flask API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 绘图 API:通过 flask API 展示您的科学 python 绘图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-plotting-api-expose-your-scientific-python-plots-through-a-flask-api-31ec7555c4a8?source=collection_archive---------6-----------------------#2018-12-24">https://towardsdatascience.com/python-plotting-api-expose-your-scientific-python-plots-through-a-flask-api-31ec7555c4a8?source=collection_archive---------6-----------------------#2018-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b833" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我作为数据科学家的日常工作中，我经常需要将相对复杂的情节集成到后台应用程序中。这些图主要用于说明算法决策，并为运营部门提供数据直觉。</p><p id="47f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一种可能的方法是构建一个返回数据的 API，并让应用程序的前端使用或多或少复杂的 javascript 图表库来呈现数据。现在，每当我想改变一些东西时，我都需要改变前端和后端。</p><p id="73cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我寻找一种快速、简单和可维护的解决方案，使绘图在任何 web 前端应用程序中都可用。我还寻找一种解决方案，允许我在一个地方改变我的图，而当例如一些新的功能请求进来时，总是需要改变前端。</p><p id="68b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想到的只是用<a class="ae ko" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>、<a class="ae ko" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> seaborn </a>等在 python 中构建情节，然后通过<a class="ae ko" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> flask </a>将它们暴露在网络上。听起来容易吗？这很容易！我会一步一步地教你。也许对你和我一样有帮助。</p><p id="10f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我们需要什么组件:</strong></p><ul class=""><li id="2daa" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated"><strong class="js iu">数据集</strong>:我们将使用来自<a class="ae ko" href="https://scikit-learn.org/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>的<a class="ae ko" href="https://scikit-learn.org/stable/datasets/index.html#breast-cancer-dataset" rel="noopener ugc nofollow" target="_blank">乳腺癌数据集</a></li><li id="4bcd" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated"><strong class="js iu">图</strong>:让我们从 seaborn 的<a class="ae ko" href="https://seaborn.pydata.org/examples/many_pairwise_correlations.html" rel="noopener ugc nofollow" target="_blank">简单相关图</a>开始</li><li id="a67a" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated"><strong class="js iu">一个 API </strong>:这里我们将使用<a class="ae ko" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank">烧瓶</a>创建一个简单的 API</li></ul><p id="9e95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，让我们首先加载数据并绘制图表:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Plotting a plot and return it as BytesIO</figcaption></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lo"><img src="../Images/43d440986b15261eedf4cd2381d4c0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WdxtDZCOTjQCve0TWSp3qQ.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">A correlation matrix plot</figcaption></figure><p id="b3da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将导致情节左。如你所见，这里的技巧是将绘图保存到 BytesIO 对象中。我们现在可以通过 flask API 公开这个 BytesIO 对象，这样就完成了！</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">A simple endpoint to return the plot</figcaption></figure><p id="edb2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的代码片段中，我们创建了一个非常简单的端点，当客户端通过给定的路径请求时，它应该返回一个绘图图像。因此，如果您的服务器运行在 localhost 上，图像将在<a class="ae ko" href="http://localhost:5000/plots/breast_cancer_data/correlation_matrix" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/plots/breast _ cancer _ data/correlation _ matrix</a>下提供。</p><p id="d907" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了 flask，你可以使用<em class="lv"> send_file </em>函数来帮助你发送一个文件到请求的客户端。在我们的例子中，这个文件是存储在 io 中的生成图。BytesIO 对象。我们只要把它传递给函数，就有了一个工作端点。你现在可以启动 flask 应用程序，你会看到:它的工作！</p><p id="24d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了让我们的最终用户访问这个情节，我们现在将在一个 HTML 网站上集成图像。您可以只使用图像标签，它将开箱即用:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="a394" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您学习了如何通过 API 来展示您的科学计划。这样，您就可以帮助其他人在日常工作中更好地理解数据，而无需启动自己的 jupyter 笔记本服务器。</p><p id="d1e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您需要更复杂的需要参数化的图，例如给定的时间范围，您可以使用查询参数，并将它们从 flask 传递到您的绘图函数。</p><p id="76b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了说明这一点，我整理了一个更简洁的 gitlab 存储库，为您提供了更多的示例，此外还展示了一种将 dockerized flask 应用程序部署到 Heroku 的方法:</p><p id="4428" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">https://gitlab.com/dice89/python-plotting-api<a class="ae ko" href="https://gitlab.com/dice89/python-plotting-api" rel="noopener ugc nofollow" target="_blank"/></p><p id="1ce8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在以下位置找到部署的应用程序:</p><p id="f7b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">【https://python-sci-plotting.herokuapp.com/ T4】</p><p id="3d3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望这篇博客教了你一个很好的小技巧，对你有所帮助！</p></div></div>    
</body>
</html>