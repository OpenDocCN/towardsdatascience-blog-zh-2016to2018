<html>
<head>
<title>Using Docker to Set Up a Deep Learning Environment on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Docker 在 AWS 上建立深度学习环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-docker-to-set-up-a-deep-learning-environment-on-aws-6af37a78c551?source=collection_archive---------2-----------------------#2017-05-19">https://towardsdatascience.com/using-docker-to-set-up-a-deep-learning-environment-on-aws-6af37a78c551?source=collection_archive---------2-----------------------#2017-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/936749f0f31cb87596e3603fd6fc66d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*EAq6Vh8BHlpA7bM3RF9KGQ.png"/></div></figure><p id="9781" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<a class="ae ks" href="https://medium.com/towards-data-science/how-to-set-up-a-deep-learning-environment-on-aws-with-keras-theano-b0f39e3d861c" rel="noopener">我之前的文章</a>中，我一步一步地解释了如何在 AWS 上建立深度学习环境。重要的一步是安装<a class="ae ks" href="https://developer.nvidia.com/cuda-toolkit" rel="noopener ugc nofollow" target="_blank"> CUDA 工具包</a>和<a class="ae ks" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank"> cuDNN </a>。然而，这一步非常耗时。在本文中，我将使用 docker，特别是 nvidia-docker 来简化安装过程，从而加快安装过程。</p><p id="6c93" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将使用与上次相同的<a class="ae ks" href="https://aws.amazon.com/ec2/instance-types/" rel="noopener ugc nofollow" target="_blank">亚马逊的 EC2 GPU 实例</a>:</p><ul class=""><li id="d634" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">图片:ami-b 03 ffedf(Ubuntu Server 16.04 LTS(HVM)，SSD 卷类型)</li><li id="8343" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">区域:欧盟中部-1(欧盟法兰克福)</li><li id="6b3d" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">实例类型:g2.2xlarge</li><li id="3759" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">存储:30 GB(建议至少 20gb 以上)</li></ul><h1 id="d21d" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">1.创建新的 EC2 GPU 实例</h1><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mf"><img src="../Images/34a922833bdd790a735992deddf4617d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3hLaHOpIW7B-ATSfnTh7w.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Select the Ubuntu Server 16.04 LTS AMI.</figcaption></figure><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ms"><img src="../Images/24a59f8b68be3f55b426da8d916b4bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56_-Ipv4yYvPB9lXH13r2w.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Take the g2.2xlarge GPU Instance. Alternatively, you could also take the g2.8xlarge if you need more computing power.</figcaption></figure><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mt"><img src="../Images/c4b9a01e5d25e0781c4f7173b41fc8f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WfHFDJkv89GRAEgAmrb97w.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Change the standard storage size to 30 GB.</figcaption></figure><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mu"><img src="../Images/6e6d1fae49209066067df6c33c8d7546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Wthy5Ik4oRG2F_2GCWQNg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Launch the cluster and assign an EC2 key pair.</figcaption></figure><h1 id="cc4b" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">2.更新 NVIDIA 驱动程序并安装 docker+nvidia-docker</h1><h2 id="9450" class="mv li iq bd lj mw mx dn ln my mz dp lr kf na nb lv kj nc nd lz kn ne nf md ng bi translated">NVIDIA 驱动程序</h2><p id="1744" class="pw-post-body-paragraph ju jv iq jw b jx nh jz ka kb ni kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">更新图形驱动程序:</p><pre class="mg mh mi mj gt nm nn no np aw nq bi"><span id="f43b" class="mv li iq nn b gy nr ns l nt nu">$ sudo add-apt-repository ppa:graphics-drivers/ppa <!-- -->-y<br/>$ sudo apt-get update<br/>$ sudo apt-get install -y nvidia-375 nvidia-settings nvidia-modprobe</span></pre><h2 id="f8be" class="mv li iq bd lj mw mx dn ln my mz dp lr kf na nb lv kj nc nd lz kn ne nf md ng bi translated">码头工人</h2><p id="1c48" class="pw-post-body-paragraph ju jv iq jw b jx nh jz ka kb ni kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">安装<a class="ae ks" href="https://www.docker.com/community-edition" rel="noopener ugc nofollow" target="_blank"> Docker 社区版</a>(查看<a class="ae ks" href="https://docs.docker.com/engine/installation/linux/ubuntu/#install-using-the-repository" rel="noopener ugc nofollow" target="_blank">官方指南</a>了解更多关于安装的信息):</p><pre class="mg mh mi mj gt nm nn no np aw nq bi"><span id="3b2a" class="mv li iq nn b gy nr ns l nt nu">$ <!-- -->curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br/># <!-- -->Verify that the key fingerprint is <!-- -->9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88<br/>$ <!-- -->sudo apt-key fingerprint 0EBFCD88<br/>$ <!-- -->sudo add-apt-repository \<br/>   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \<br/>   $(lsb_release -cs) \<br/>   stable"<br/>$ sudo apt-get update<br/>$ <!-- -->sudo apt-get install -y docker-ce</span></pre><h2 id="267c" class="mv li iq bd lj mw mx dn ln my mz dp lr kf na nb lv kj nc nd lz kn ne nf md ng bi translated">英伟达-Docker</h2><p id="6594" class="pw-post-body-paragraph ju jv iq jw b jx nh jz ka kb ni kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">安装 nvidia-docker 及其插件:</p><pre class="mg mh mi mj gt nm nn no np aw nq bi"><span id="bc86" class="mv li iq nn b gy nr ns l nt nu">$ wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1-1_amd64.deb<br/>$ sudo dpkg -i /tmp/nvidia-docker_1.0.1-1_amd64.deb &amp;&amp; rm /tmp/nvidia-docker_1.0.1-1_amd64.deb</span></pre><h1 id="9108" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">3.测试您的环境:</h1><p id="1daf" class="pw-post-body-paragraph ju jv iq jw b jx nh jz ka kb ni kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">现在，我们可以使用 nvidia-docker 来测试一切是否按预期工作:</p><pre class="mg mh mi mj gt nm nn no np aw nq bi"><span id="da9c" class="mv li iq nn b gy nr ns l nt nu">$ sudo nvidia-docker run --rm nvidia/cuda nvidia-smi</span></pre><p id="1b2d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="nv">注意:如果您第一次运行该命令，它将首先提取图像。此外，如果您不想作为</em> <code class="fe nw nx ny nn b"><em class="nv">sudo</em></code> <em class="nv">运行，那么您需要将 EC2 用户添加到 docker 组</em> <code class="fe nw nx ny nn b"><em class="nv">sudo usermod -a -G docker ubuntu</em></code> <em class="nv">(更多详细信息，请参见</em> <a class="ae ks" href="http://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-basics.html" rel="noopener ugc nofollow" target="_blank"> <em class="nv"> AWS 指南</em> </a> <em class="nv">)。</em></p><p id="475c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是您应该看到的输出:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/3858f5ea2a1f46e3e7997375b56e4dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*odr7lkFGqjiqNwbGcGOMmg.png"/></div></figure><p id="6adb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你现在可以使用<a class="ae ks" href="https://hub.docker.com/r/tensorflow/tensorflow/" rel="noopener ugc nofollow" target="_blank">官方 TensorFlow docker 映像</a>或<a class="ae ks" href="https://hub.docker.com/r/kaixhin/theano/" rel="noopener ugc nofollow" target="_blank"> Theano 映像</a>来启动你的深度学习环境，或者你可以编写自己的<a class="ae ks" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">docker 文件</a>并将其推送到<a class="ae ks" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> docker hub </a>。</p><h2 id="ced7" class="mv li iq bd lj mw mx dn ln my mz dp lr kf na nb lv kj nc nd lz kn ne nf md ng bi translated">张量流示例:</h2><p id="b404" class="pw-post-body-paragraph ju jv iq jw b jx nh jz ka kb ni kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">在 shell 中启动最新的 TensorFlow 容器(对于其他选项，如作为 Jupyter 笔记本运行 TensorFlow 程序，请查看<a class="ae ks" href="https://www.tensorflow.org/install/install_linux#installing_with_docker" rel="noopener ugc nofollow" target="_blank">官方 TensorFlow 指南</a>):</p><pre class="mg mh mi mj gt nm nn no np aw nq bi"><span id="594f" class="mv li iq nn b gy nr ns l nt nu">$ sudo <!-- -->nvidia-docker run -it tensorflow/tensorflow:latest-gpu bash</span></pre><p id="22ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在 python 中运行一个简单的示例，检查 TensorFlow 在 GPU 支持下能否正常工作:</p><pre class="mg mh mi mj gt nm nn no np aw nq bi"><span id="2977" class="mv li iq nn b gy nr ns l nt nu">import tensorflow as tf</span><span id="0db0" class="mv li iq nn b gy oa ns l nt nu">a = tf.constant(5, tf.float32)<br/>b = tf.constant(5, tf.float32)</span><span id="6012" class="mv li iq nn b gy oa ns l nt nu">with tf.Session() as sess:<br/>    sess.run(tf.add(a, b)) # output is 10</span></pre><p id="5a81" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是您应该预期的输出:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mf"><img src="../Images/23d6ba53602d00592c19deae949efa9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMEN1YxQndRysmcPd-uRMg.png"/></div></div></figure><h1 id="cd9b" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="3d6b" class="pw-post-body-paragraph ju jv iq jw b jx nh jz ka kb ni kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">在这篇博文中，我用 docker 在 AWS 上搭建了一个深度学习环境。这大大加快了安装过程。这对于家里没有自己的 GPU 的人来说特别有用；)</p><p id="7024" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在推特上关注我:<a class="ae ks" href="https://twitter.com/datitran" rel="noopener ugc nofollow" target="_blank"> @datitran </a></p></div></div>    
</body>
</html>