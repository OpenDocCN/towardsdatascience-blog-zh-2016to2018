<html>
<head>
<title>Building a dashboard for interactive cohort analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为交互式群组分析构建仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-dashboard-for-interactive-cohort-analysis-6a9d904bcbda?source=collection_archive---------2-----------------------#2017-11-16">https://towardsdatascience.com/building-a-dashboard-for-interactive-cohort-analysis-6a9d904bcbda?source=collection_archive---------2-----------------------#2017-11-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ecef" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们如何留住不同的用户群？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5a41b849087a385bc1b15f55bf043150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQk6hMhZPCjQmkhiY4IZjw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: Pixabay</figcaption></figure><h1 id="a2a9" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="c930" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">群组是指具有共同定义特征的一组受试者。我们可以观察一个群体在不同时间的表现，并与其他群体进行比较。群组用于医学、心理学、计量经济学、生态学和许多其他领域，以在时间上的间隔进行交叉分析(比较受试者之间的差异)。(<a class="ae mj" href="https://en.wikipedia.org/wiki/Cohort_study" rel="noopener ugc nofollow" target="_blank">来源</a>)</p><p id="8b47" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在这篇文章中，我们将重点观察用户在使用Jupyter笔记本的产品中的行为。</p><p id="d6a6" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">产品业务中保留的重要性从<a class="ae mj" href="https://medium.com/towards-data-science/generating-product-usage-data-from-scratch-with-pandas-319487590c6d" rel="noopener">延续到之前的</a>，在那里我们模拟了产品使用数据，可以总结为三个数字:</p><ul class=""><li id="4489" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated"><strong class="lp ir"> 95% =重新吸引用户与获得新用户的成本差异</strong> ( <a class="ae mj" href="https://amplitude.com/mobile-analytics" rel="noopener ugc nofollow" target="_blank">来源</a>)</li><li id="b4fc" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated"><strong class="lp ir"> 5% =可将收入提高至95%的留存额增加量</strong> ( <a class="ae mj" href="https://amplitude.com/mobile-analytics" rel="noopener ugc nofollow" target="_blank">来源</a>)</li><li id="7fd2" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated"><strong class="lp ir"> 77% =前三天每日活跃用户流失的平均百分比</strong> ( <a class="ae mj" href="http://andrewchen.co/new-data-shows-why-losing-80-of-your-mobile-users-is-normal-and-that-the-best-apps-do-much-better/" rel="noopener ugc nofollow" target="_blank">来源</a>)</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/d1e2000c3a0e530de6bec12a64355a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFtR1Ky64NftNWjLYBj_6w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Trying to grow a product without being able to retain users</figcaption></figure><p id="d415" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">检查留存率的关键问题是如何快速、方便地调查不同用户群在产品上平均花费了多少时间。为了做到这一点，可视化需要是交互式的，我们可以通过构建一个仪表板来实现。</p><p id="8025" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们从上一篇文章中模拟的数据集开始(略有改动)，该数据集由10.000个用户组成，具有三个分类变量:国家(值为NL、FR和AU)、平台(值为iOS和Android)和user_registered(值为True和False)。小的调整和解释包含在笔记本中。</p><p id="32a7" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这篇文章中的所有代码都可以在GitHub上的笔记本中找到。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="6fde" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><strong class="lp ir">代码</strong></p><p id="a21b" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们从导入所有必需的依赖项开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="93a0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">接下来，我们打开包含所有产品使用数据的CSV:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/5584ed6a2604ffcc23d5cd9ba84ce696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ji60YG-I0nBYnlk0ER9wBw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Preview of all_user_data_df</figcaption></figure><p id="802f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们列出了所有三个变量的值，稍后我们将根据这些值对用户进行细分:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="5699" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">细分用户</h1><p id="d087" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">下一步是细分用户。我们选择想要分割的特性的值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6d3b" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这方面的一个例子是对iOS平台上未注册的荷兰用户进行细分:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/09c6aee43c658f6fcbeed15d51d5f4d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jynUC4P0iqaar2TMgNVj6A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Segmentation example</figcaption></figure><h1 id="5ab1" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">构建群组</h1><h2 id="e1de" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">第一步</h2><p id="f04e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">之后，我们在分割的数据帧上建立群组。第一步是创建一个函数，为每个用户定义一个群组(当用户开始使用产品时):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="e02a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然后，我们对分段数据帧使用函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/5fb909f857d84e986beb0f6ebad8008e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkvIGcS5S32uy1GdzBGhIQ.png"/></div></div></figure><h2 id="3a8e" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">第二步:</h2><p id="7c0a" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们将所有事件和用户分组:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="eb9a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们将该函数应用于现有数据框:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/6266866a7d8ceddd57d3e5fa0be8da7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*9rzZQUmdKOC1V8Zwrjw7zg.png"/></div></figure><h2 id="d577" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">第三步:</h2><p id="b0e0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们基于usage_period为每个群组定义群组周期:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0ee5" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">Cohort_period 0对应的是使用产品第一个月的用户数和事件数。群组周期1 <br/>对应于使用产品的第二个月的相同数据，以此类推。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ba4a5aee74b8880e92a434dc0918f423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*K5Z-txSy1yR7fRpuBGoSPQ.png"/></div></figure><h2 id="a7fa" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">第四步:</h2><p id="b222" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们重新索引数据帧，并设置群组组和群组周期作为索引。我们还计算了每个群组第一个月的用户数量。这两者对于<br/>在下一步计算保留都是必要的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="1934" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们将其应用于群组数据帧:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b2e0be7e99ffe4e601b369caf3534c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*1cugvwdYeF3q6a5CLmuR1A.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Number of users in each cohort</figcaption></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/d424ea3d662231fa6c4dcc333050f99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*WC1jB_epPH-c-a13zbpJSQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Sum of all events with unique users in each cohort period for the cohort group 2016–02</figcaption></figure><h2 id="b371" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">第五步:</h2><p id="fe33" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">然后我们计算每个群体的保持率。我们在cohort_group(索引为0的第一列)上拆分，将索引中的唯一值透视到各个列中。然后，我们将每个群组中开始使用该产品的用户数量除以每个相应月份中继续使用该产品的用户数量(1 =第二个月，2 =第三个月，…)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="248e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">值~ 0.2658对应于2016–02年群组中在第二个月使用该产品的用户数除以在第一个月使用该产品的用户数。它回答了这样一个问题:在2016年至2002年期间，有多少用户在使用产品的第二个月继续使用该产品？(26.6%)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="41b6" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">值~ 0.2658对应于2016–02年群组中在第二个月使用该产品的用户数除以在第一个月使用该产品的用户数。它回答了这样一个问题:在2016年至2002年期间，有多少用户在使用产品的第二个月继续使用该产品？(26.6%)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/5fb6aa94d2dad1e78b45a8b98d13a15d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zEOvXcMQq4P-N2qf_wVI8g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Cohort reindex and group size</figcaption></figure><p id="09c4" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们将上述5个群组步骤中的所有函数合并为一个函数，稍后用于交互式可视化。<br/>它的输入是细分数据，输出是每个群组的用户留存率:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="78ae" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">静态可视化</h1><p id="e438" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">然后，我们使用所有群组函数构建的user_retention数据框架用于可视化不同的用户群组如何随着时间的推移保留在产品中。</p><h2 id="5851" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">保留曲线</h2><p id="68fe" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">首先，我们可视化保留曲线。每条线对应不同的组群。每条曲线上方的空间越小，保留的用户百分比就越高。或者相反，曲线越快下降到低值，我们在吸引用户继续使用产品方面就越不成功。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8323" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们使用蓝色色图，用更深的蓝色来显示后面的群组。我们看不出不同人群的记忆有任何明显差异。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/98893823dfd7a08321bd92513aa075e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9ooEMD5hMQIwA132JVJ6g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Visualization — retention curves</figcaption></figure><h2 id="5c2d" class="np kw iq bd kx nq nr dn lb ns nt dp lf lw nu nv lh ma nw nx lj me ny nz ll oa bi translated">热图</h2><p id="fd96" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">接下来，我们用热图来直观显示保留情况。这一次我们使用了二进制颜色图，其中较深的颜色对应于特定群组在特定群组期间保留的较高百分比的用户<br/>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="9f75" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们可以再次看到，保持率不会随着时间的推移而发生很大变化。25%的用户在使用后的第二个月内缓慢但持续地流失(这也可以在上面的user_retention数据框中看到)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/41a36e20f659680fe79c5053e3433a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRsMLPC4ovGobuaTeAAdkw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Visualization — heatmap</figcaption></figure><h1 id="1cf4" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">交互式可视化</h1><p id="2a00" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">最后一步包括组合所有已构建的功能，并以这样一种方式进行组合，即我们可以根据指定的变量值同时对用户进行细分，构建群组，并通过曲线和热图直观显示保留情况。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0774" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">通过使用interact函数，我们可以选择要分段的变量值。这提供了一个交互式的重新计算和可视化，因此我们可以比较我们的用户的不同部分的保留。</p><p id="6fdd" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们可以在下面的例子中观察到，与Android用户相比，iOS用户的保留率更低，这是通过上述调整(包含在笔记本中)模拟的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/fa9408d951b7808bde8ff8b9e302ea8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tR5fSelxnQ5Q4q_hWHeXvQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Dashboard for interactive cohort analysis</figcaption></figure><h1 id="c3f6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">已用资源</h1><p id="4d3f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">部分队列分析主要基于格雷戈·瑞达的帖子。如果您想更深入地了解数据建模部分，推荐阅读本书。</p></div></div>    
</body>
</html>