<html>
<head>
<title>How to deploy a MongoDB Replica Set using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Docker 部署 MongoDB 副本集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-a-mongodb-replica-set-using-docker-6d0b9ac00e49?source=collection_archive---------0-----------------------#2017-01-15">https://towardsdatascience.com/how-to-deploy-a-mongodb-replica-set-using-docker-6d0b9ac00e49?source=collection_archive---------0-----------------------#2017-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0780a1170885b26d7ac53bf993d7ba48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*8X_CcO9QW_HspoTFvIVfHA.png"/></div></figure><h1 id="fc1d" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">文章已更新</h1><p id="cfcc" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我写了一篇关于如何使用 DevOps 时尚风格部署 mongodb 集群的新文章，在这篇文章中，我使用了 Terraform、Ansible、Packer 和更多很酷的技术，我强烈建议您阅读它。</p><div class="lq lr gp gr ls lt"><a href="https://medium.com/@cramirez92/deploy-a-mongodb-replica-set-in-a-devops-fashion-style-infrastructre-as-code-f631d7a0ad80" rel="noopener follow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd ir gy z fp ly fr fs lz fu fw ip bi translated">以 DevOps 方式部署 MongoDB 副本集(作为代码的基础架构)</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">介绍</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">medium.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh js lt"/></div></div></a></div></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="01ee" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">本文将介绍如何使用 docker 设置带身份验证的 MongoDB 副本集。</p><p id="ce8e" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">本文中我们将使用的是:</p><ul class=""><li id="f4a4" class="mu mv iq ku b kv mp kz mq ld mw lh mx ll my lp mz na nb nc bi translated">MongoDB 3.4.1</li><li id="c3d0" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated">Mac docker 1 . 12 . 6</li></ul><h1 id="d1e4" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">副本集的体系结构</h1><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/9ddd91c084e80f60469727a66b89bf5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*V2X99_tnwj6kltZiZEYv7Q.png"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk">MongoDB Replica Set</figcaption></figure><h1 id="81a5" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">用 docker 构建我们的副本集</h1><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nr"><img src="../Images/e752849c03efad35c1255de98208e6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*W3hJmVyfUFvolUowVDlBkA.png"/></div></div><figcaption class="nn no gj gh gi np nq bd b be z dk">Servers Distribution using Docker</figcaption></figure><p id="afb7" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">在上图中，我们看到了用 docker 设置的复制结果。</p><h2 id="ffb6" class="nw jv iq bd jw nx ny dn ka nz oa dp ke ld ob oc ki lh od oe km ll of og kq oh bi translated">#先决条件</h2><ul class=""><li id="2b46" class="mu mv iq ku b kv kw kz la ld oi lh oj ll ok lp mz na nb nc bi translated"><strong class="ku ir">码头工人</strong>的基础知识</li><li id="a020" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated"><strong class="ku ir">对接机</strong>和<strong class="ku ir">对接机</strong>安装完毕</li><li id="bdb7" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated"><strong class="ku ir"> mongoDB </strong>中的基础知识</li><li id="165f" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated"><strong class="ku ir"> bash 脚本的基础知识</strong></li></ul><p id="259d" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">如果你在 Mac 或 Windows 上，考虑使用虚拟机。我将在 MacOS Sierra 上使用 VirtualBox 来运行我们的 mongoDB 实例。</p><h1 id="2490" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">#步骤 1 —创建我们的 3 台对接机</h1><p id="9c16" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">要创建 docker 机器，我们需要在终端中发出下一条命令:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="0c54" class="nw jv iq om b gy oq or l os ot">$ docker-machine create -d virtualbox manager1</span></pre><p id="7024" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">这个命令将创建一个名为<strong class="ku ir"> manager1 </strong>的机器，使用<strong class="ku ir"> virtualbox </strong>作为我们的虚拟化提供者。</p><p id="5330" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在让我们创建两个左<code class="fe ou ov ow om b">docker-machine</code></p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="3c0e" class="nw jv iq om b gy oq or l os ot">$ docker-machine create -d virtualbox worker1</span><span id="44e5" class="nw jv iq om b gy ox or l os ot">$ docker-machine create -d virtualbox worker2</span></pre><p id="9e83" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">要验证我们的机器是否已创建，让我们运行以下命令:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="55bd" class="nw jv iq om b gy oq or l os ot">$ docker-machine ls</span><span id="df69" class="nw jv iq om b gy ox or l os ot">// the result will be<br/>NAME    ACTIVE   DRIVER     STATE     URL    <br/>manager1   -   virtualbox   Running  tcp://192.168.99.100:2376           <br/>worker1    -   virtualbox   Running  tcp://192.168.99.101:2376<br/>worker2    -   virtualbox   Running  tcp://192.168.99.102:2376</span></pre><h1 id="71c4" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">#步骤 MongoDB 主节点的配置</h1><p id="ca38" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在我们有了三台机器，让我们将它放在第一台机器<strong class="ku ir">上，开始 mongodb 配置，让我们运行下一个命令:</strong></p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="63c4" class="nw jv iq om b gy oq or l os ot">$ eval `docker-machine env manager1`</span></pre><p id="25df" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">在创建我们的 mongoDB 容器之前，有一个非常重要的主题已经在<strong class="ku ir"> docker 容器</strong>中围绕<strong class="ku ir">数据库持久性</strong>讨论了很久，为了实现这个挑战，我们将要做的是创建一个<strong class="ku ir"> docker 卷</strong>。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="5e9d" class="nw jv iq om b gy oq or l os ot">$ docker volume create --name mongo_storage</span></pre><p id="5d75" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在让我们附加我们创建的卷来启动我们的第一个 mongo 容器并设置配置。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="c2f1" class="nw jv iq om b gy oq or l os ot">$ docker run --name mongoNode1 \<br/>-v mongo_storage:/data \<br/>-d mongo \<br/>--smallfiles</span></pre><p id="66cc" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">接下来我们需要创建<strong class="ku ir">密钥文件。</strong></p><blockquote class="oy oz pa"><p id="8652" class="ks kt pb ku b kv mp kx ky kz mq lb lc pc mr lf lg pd ms lj lk pe mt ln lo lp ij bi translated">密钥文件的内容作为副本集成员的共享密码。对于副本集的所有成员，密钥文件的内容必须相同。</p></blockquote><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="4ca2" class="nw jv iq om b gy oq or l os ot">$ openssl rand -base64 741 &gt; mongo-keyfile<br/>$ chmod 600 mongo-keyfile</span></pre><p id="4e8f" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">接下来，让我们创建文件夹，用于保存<strong class="ku ir"> mongo_storage </strong>卷中的数据、密钥文件和配置:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="40f9" class="nw jv iq om b gy oq or l os ot">$ docker exec mongoNode1 bash -c 'mkdir /data/keyfile /data/admin'</span></pre><p id="3b00" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">下一步是创建一些管理员用户，让我们创建一个<strong class="ku ir"> admin.js </strong>和一个<strong class="ku ir"> replica.js </strong>文件，如下所示:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="f463" class="nw jv iq om b gy oq or l os ot">// admin.js</span><span id="ffd8" class="nw jv iq om b gy ox or l os ot">admin = db.getSiblingDB("admin")</span><span id="4002" class="nw jv iq om b gy ox or l os ot">// creation of the admin user<br/>admin.createUser(<br/>  {<br/>    user: "cristian",<br/>    pwd: "cristianPassword2017",<br/>    roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]<br/>  }<br/>)</span><span id="8393" class="nw jv iq om b gy ox or l os ot">// let's authenticate to create the other user<br/>db.getSiblingDB("admin").auth("cristian", "cristianPassword2017" )</span><span id="220f" class="nw jv iq om b gy ox or l os ot">// creation of the replica set admin user<br/>db.getSiblingDB("admin").createUser(<br/>  {<br/>    "user" : "replicaAdmin",<br/>    "pwd" : "replicaAdminPassword2017",<br/>    roles: [ { "role" : "clusterAdmin", "db" : "admin" } ]<br/>  }<br/>)</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><pre class="ol om on oo aw op bi"><span id="498c" class="nw jv iq om b gy pg ph pi pj pk or l os ot">//replica.js</span><span id="518d" class="nw jv iq om b gy ox or l os ot">rs.initiate({<br/> _id: 'rs1',<br/> members: [{<br/>  _id: 0, host: 'manager1:27017'<br/> }]<br/>})</span></pre><h2 id="4e0b" class="nw jv iq bd jw nx ny dn ka nz oa dp ke ld ob oc ki lh od oe km ll of og kq oh bi translated"><strong class="ak">重要</strong></h2><blockquote class="oy oz pa"><p id="4067" class="ks kt pb ku b kv mp kx ky kz mq lb lc pc mr lf lg pd ms lj lk pe mt ln lo lp ij bi translated">密码应该是随机的、长的和复杂的，以确保系统安全并防止或延迟恶意访问。参见<a class="ae pf" href="https://docs.mongodb.com/manual/reference/built-in-roles/#database-user-roles" rel="noopener ugc nofollow" target="_blank">数据库用户角色</a>了解内置角色以及与数据库管理操作相关的完整列表。</p></blockquote><p id="14fb" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">我们所做的直到知道:</p><ul class=""><li id="bac2" class="mu mv iq ku b kv mp kz mq ld mw lh mx ll my lp mz na nb nc bi translated">创建了<strong class="ku ir"> mongo_storage </strong>，docker 卷。</li><li id="1d8e" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated">创建了<strong class="ku ir"> mongo-keyfile </strong>，openssl 密钥生成。</li><li id="f2f7" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated">创建了<strong class="ku ir"> admin.js 文件</strong>，管理 mongoDB 的用户。</li><li id="32fd" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated">创建了<strong class="ku ir"> replica.js 文件</strong>，以初始化副本集。</li></ul><p id="8df9" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">好了，让我们继续将文件传递到容器中。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="0f3c" class="nw jv iq om b gy oq or l os ot">$ docker cp admin.js mongoNode1:/data/admin/</span><span id="4ec2" class="nw jv iq om b gy ox or l os ot">$ docker cp replica.js mongoNode1:/data/admin/</span><span id="87f3" class="nw jv iq om b gy ox or l os ot">$ docker cp mongo-keyfile mongoNode1:/data/keyfile/</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><pre class="ol om on oo aw op bi"><span id="d8f0" class="nw jv iq om b gy pg ph pi pj pk or l os ot">// change folder owner to the user container</span><span id="e652" class="nw jv iq om b gy ox or l os ot">$ docker exec mongoNode1 bash -c 'chown -R mongodb:mongodb /data'</span></pre><p id="18be" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">我们所做的是将需要的文件传递给容器，然后<strong class="ku ir">将</strong><strong class="ku ir"/><strong class="ku ir">/数据文件夹所有者</strong> <strong class="ku ir">更改为容器用户</strong>，因为容器用户是需要访问该文件夹和文件的用户。</p><p id="8aa9" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在一切都已经设置好了，我们准备用副本集配置重新启动 mongod 实例。</p><p id="59cd" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">在我们开始验证 mongo 容器之前，让我们创建一个<code class="fe ou ov ow om b">env</code>文件来设置我们的用户和密码。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="82da" class="nw jv iq om b gy oq or l os ot">MONGO_USER_ADMIN=cristian<br/>MONGO_PASS_ADMIN=cristianPassword2017</span><span id="c11d" class="nw jv iq om b gy ox or l os ot">MONGO_REPLICA_ADMIN=replicaAdmin<br/>MONGO_PASS_REPLICA=replicaAdminPassword2017</span></pre><p id="17ad" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在我们需要移除容器并开始一个新的。为什么？，因为我们需要提供副本集和身份验证参数，为此我们需要运行以下命令:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="4b61" class="nw jv iq om b gy oq or l os ot">// first let's remove our container</span><span id="9a50" class="nw jv iq om b gy ox or l os ot">$ docker rm -f mongoNode1</span><span id="c8ce" class="nw jv iq om b gy ox or l os ot">// now lets start our container with authentication </span><span id="b523" class="nw jv iq om b gy ox or l os ot">$ docker run --name mongoNode1 --hostname mongoNode1 \<br/>-v mongo_storage:/data \<br/>--env-file env \<br/>--add-host manager1:192.168.99.100 \<br/>--add-host worker1:192.168.99.101 \<br/>--add-host worker2:192.168.99.102 \<br/>-p 27017:27017 \<br/>-d mongo --smallfiles \<br/>--keyFile /data/keyfile/mongo-keyfile \<br/>--replSet 'rs1' \<br/>--storageEngine wiredTiger \<br/>--port 27017</span></pre><p id="116c" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">这是怎么回事…🤔这似乎是对旗帜的滥用。</p><p id="8dc4" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">让我分两部分向你解释:</p><p id="718c" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated"><strong class="ku ir">码头标志:</strong></p><ol class=""><li id="e7da" class="mu mv iq ku b kv mp kz mq ld mw lh mx ll my lp pl na nb nc bi translated"><code class="fe ou ov ow om b">--env-file</code>读取一个 env 文件并在容器中设置<code class="fe ou ov ow om b">environment</code>变量。</li><li id="5698" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp pl na nb nc bi translated"><code class="fe ou ov ow om b">--add-host</code>标志将条目添加到 docker 容器的<code class="fe ou ov ow om b">/etc/hosts</code>文件中，这样我们就可以使用主机名而不是 IP 地址。这里，我们正在映射我们之前创建的 3 台 docker-machine。</li></ol><p id="1c20" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">要更深入地理解<em class="pb"> docker 运行命令</em>、<a class="ae pf" href="https://docs.docker.com/engine/reference/run/" rel="noopener ugc nofollow" target="_blank">请阅读 docker 的文档</a>。</p><p id="685f" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated"><strong class="ku ir">蒙哥旗帜:</strong></p><p id="725b" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">为了设置 mongo 副本集，我们需要各种 mongo 标志</p><ol class=""><li id="00c8" class="mu mv iq ku b kv mp kz mq ld mw lh mx ll my lp pl na nb nc bi translated"><code class="fe ou ov ow om b">--keyFile</code>这个标志是用来告诉 mongo】在哪里</li><li id="5cf9" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp pl na nb nc bi translated"><code class="fe ou ov ow om b">--replSet</code>该标志用于设置副本集的名称。</li><li id="aea1" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp pl na nb nc bi translated"><code class="fe ou ov ow om b">--storageEngine</code>该标志用于设置 mongoDB 的引擎，不是必需的，因为<strong class="ku ir"> mongoDB 3.4.1 </strong>的默认引擎是<strong class="ku ir"> wiredTiger。</strong></li></ol><p id="db05" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">为了更深入地了解 mongo 副本集，<a class="ae pf" href="https://docs.mongodb.com/manual/tutorial/deploy-replica-set/" rel="noopener ugc nofollow" target="_blank">阅读 MongoDB 文档</a>，我也推荐<a class="ae pf" href="https://university.mongodb.com/?next=/courses/MongoDB/M101JS/2016_March/courseware/Week_2_CRUD/5695578bd8ca393adc3abe54" rel="noopener ugc nofollow" target="_blank">mongou 大学的课程</a>来学习关于这个主题的更多内容。</p><p id="e127" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">mongoNode1 容器的最后一步是启动副本集，我们将通过运行以下命令来完成这一步:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="446a" class="nw jv iq om b gy oq or l os ot">$ docker exec mongoNode1 bash -c 'mongo &lt; /data/admin/replica.js'</span></pre><p id="294f" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">您应该会看到类似这样的内容:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="18fe" class="nw jv iq om b gy oq or l os ot">MongoDB shell version v3.4.1<br/>connecting to: mongodb://127.0.0.1:27017<br/>MongoDB server version: 3.4.1<br/>{ "ok" : 1 }<br/>bye</span></pre><p id="43dd" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在，让我们使用以下命令创建管理员用户:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="d64d" class="nw jv iq om b gy oq or l os ot">$ docker exec mongoNode1 bash -c 'mongo &lt; /data/admin/admin.js'</span></pre><p id="251e" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">您应该会看到类似这样的内容:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="d8d9" class="nw jv iq om b gy oq or l os ot">MongoDB shell version v3.4.1<br/>connecting to: mongodb://127.0.0.1:27017<br/>MongoDB server version: 3.4.1<br/>admin<br/>Successfully added user: {<br/> "user" : "cristian",<br/> ...<br/>Successfully added user: {<br/> "user" : "replicaAdmin",<br/>...<br/>bye</span></pre><p id="f209" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在，要进入复制副本，请运行以下命令:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="c60e" class="nw jv iq om b gy oq or l os ot">$ docker exec -it mongoNode1 bash -c 'mongo -u $MONGO_REPLICA_ADMIN -p $MONGO_PASS_REPLICA --eval "rs.status()" --authenticationDatabase "admin"'</span></pre><p id="4870" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">你应该准备好看到这样的东西:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="946d" class="nw jv iq om b gy oq or l os ot">MongoDB shell version v3.4.1<br/>connecting to: mongodb://127.0.0.1:27017<br/>MongoDB server version: 3.4.1<br/>{<br/> "set" : "rs1",<br/> ...<br/> "members" : [<br/>  {<br/>   "_id" : 0,<br/>   "name" : "manager1:27017",<br/>   ...<br/> "ok" : 1<br/>}</span></pre><h1 id="198a" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">#步骤 3——再添加 2 个 mongo 节点容器</h1><p id="aaed" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在一切都准备好了，让我们再启动两个节点，并将它们加入副本集。</p><p id="533f" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">要添加第一个节点，让我们切换到<strong class="ku ir"> worker1 </strong> docker 机器，如果您使用的是本地计算机，请运行以下命令:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="34fd" class="nw jv iq om b gy oq or l os ot">eval `docker-machine env worker1`</span></pre><p id="2f6f" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">如果你没有在本地运行，只要把你的终端指向下一个服务器。</p><p id="8d89" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在，因为我们要重复我们为<strong class="ku ir"> mongoNode1 </strong>所做的几乎所有步骤，所以让我们编写一个脚本来运行我们所有的命令。</p><p id="cc46" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">让我们创建一个名为<strong class="ku ir"> create-replica-set.sh </strong>的文件，看看如何组成<strong class="ku ir"> main </strong>函数:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="cde6" class="nw jv iq om b gy oq or l os ot">function main {<br/>  init_mongo_primary<br/>  init_mongo_secondaries<br/>  add_replicas manager1 mongoNode1<br/>  check_status manager1 mongoNode1<br/>}</span><span id="fffa" class="nw jv iq om b gy ox or l os ot">main</span></pre><p id="7bc3" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在让我向您展示这个函数是如何组成:</p><p id="4270" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated"><strong class="ku ir">初始化 MONGO 主函数</strong></p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="1af4" class="nw jv iq om b gy oq or l os ot">function init_mongo_primary {<br/>  # <a class="ae pf" href="http://twitter.com/params" rel="noopener ugc nofollow" target="_blank">@params</a> name-of-keyfile<br/>  createKeyFile mongo-keyfile<br/>  <br/>  # <a class="ae pf" href="http://twitter.com/params" rel="noopener ugc nofollow" target="_blank">@params</a> server container volume<br/>  createMongoDBNode manager1 mongoNode1 mongo_storage<br/>  <br/>  # <a class="ae pf" href="http://twitter.com/params" rel="noopener ugc nofollow" target="_blank">@params</a> container<br/>  init_replica_set mongoNode1<br/>}</span></pre><p id="a6a0" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">这个函数内部也有函数调用，没有新的功能，我们之前已经看到了所有的功能，让我来描述一下它的功能:</p><ol class=""><li id="c6d8" class="mu mv iq ku b kv mp kz mq ld mw lh mx ll my lp pl na nb nc bi translated">为<strong class="ku ir">副本集验证创建<strong class="ku ir">密钥文件</strong>。</strong></li><li id="9d82" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp pl na nb nc bi translated">创建一个 mongodb 容器，并接收 2 个参数:a)将要定位的服务器，b)容器的名称，docker 卷的名称，所有这些功能我们以前都见过。</li><li id="f096" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp pl na nb nc bi translated">最后，它将以与我们之前完全相同的步骤启动复制副本。</li></ol><p id="0a11" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated"><strong class="ku ir">初始化 MONGO 辅助功能</strong></p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="f74a" class="nw jv iq om b gy oq or l os ot">function init_mongo_secondaries {<br/>  # <a class="ae pf" href="http://twitter.com/Params" rel="noopener ugc nofollow" target="_blank">@Params</a> server container volume<br/>  createMongoDBNode worker1 mongoNode1 mongo_storage<br/>  createMongoDBNode worker2 mongoNode2 mongo_storage<br/>}</span></pre><p id="04de" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">这个函数的作用是<strong class="ku ir">为副本集</strong>创建另外两个 mongo 容器，并执行与 mongoNode1 相同的步骤，但这里我们不包括副本集实例化和管理员用户创建，因为这些都不是必需的，因为副本集将与副本集的所有节点共享数据库配置，稍后它们将被添加到主数据库。</p><h2 id="2838" class="nw jv iq bd jw nx ny dn ka nz oa dp ke ld ob oc ki lh od oe km ll of og kq oh bi translated"><strong class="ak">添加副本功能</strong></h2><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="4036" class="nw jv iq om b gy oq or l os ot"># <a class="ae pf" href="http://twitter.com/params" rel="noopener ugc nofollow" target="_blank">@params</a> server container<br/>function add_replicas {<br/>  echo '·· adding replicas &gt;&gt;&gt;&gt; '$1' ··'</span><span id="62fe" class="nw jv iq om b gy ox or l os ot">  switchToServer $1<br/>  <br/>  for server in worker1 worker2<br/>   do<br/>    rs="rs.add('$server:27017')"<br/>    add='mongo --eval "'$rs'" -u $MONGO_REPLICA_ADMIN <br/>         -p $MONGO_PASS_REPLICA --authenticationDatabase="admin"'<br/>    sleep 2<br/>    wait_for_databases $server<br/>    docker exec -i $2 bash -c "$add"<br/>  done<br/>}</span></pre><p id="f5be" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">在这里，我们正在做的是，最后将另外 2 个 mongo 容器添加到<strong class="ku ir">副本集配置上的<strong class="ku ir">主数据库</strong>中，</strong>首先，我们循环通过剩余的机器来添加容器，在循环中，我们准备配置，然后我们检查容器是否准备好，我们通过调用函数<code class="fe ou ov ow om b">wait_for_databases</code>来完成，我们将机器作为参数传递给 check，然后我们在主数据库中执行配置，我们应该看到这样的消息:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="339b" class="nw jv iq om b gy oq or l os ot">MongoDB shell version v3.4.1<br/>connecting to: mongodb://127.0.0.1:27017<br/>MongoDB server version: 3.4.1<br/>{ "ok" : 1 }</span></pre><p id="1902" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">这意味着 mongo 容器被成功地添加到了副本中。</p><p id="22b2" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">最后，我们用 main 中的最后一个函数检查副本集的状态:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="e4ab" class="nw jv iq om b gy oq or l os ot"># <a class="ae pf" href="http://twitter.com/params" rel="noopener ugc nofollow" target="_blank">@params</a> server container<br/>function check_status {<br/>  switchToServer $1<br/>  cmd='mongo -u $MONGO_REPLICA_ADMIN -p $MONGO_PASS_REPLICA <br/>        --eval "rs.status()" --authenticationDatabase "admin"'<br/>  docker exec -i $2 bash -c "$cmd"<br/>}</span></pre><p id="68e1" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">既然我们已经看到了我们的自动化脚本的功能，并且我们知道将要这样做，那么是时候执行自动化 bash 脚本了，如下所示:</p><blockquote class="oy oz pa"><p id="56a6" class="ks kt pb ku b kv mp kx ky kz mq lb lc pc mr lf lg pd ms lj lk pe mt ln lo lp ij bi translated">注意如果你已经完成了上面的所有步骤，你需要重置我们已经实现的所有东西，以避免任何冲突名称问题，重置配置在 github 存储库中有一个 reset.sh 文件</p></blockquote><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="ea2a" class="nw jv iq om b gy oq or l os ot"># and this how we can execute the script that will configure <br/># everything for us.</span><span id="61cb" class="nw jv iq om b gy ox or l os ot"><strong class="om ir">$ bash &lt; create-replica-set.sh</strong></span></pre><p id="d7e4" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">如果一切设置正确，我们应该会看到来自 mongodb 的如下消息:</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="f1bc" class="nw jv iq om b gy oq or l os ot">MongoDB shell version v3.4.1<br/>connecting to: mongodb://127.0.0.1:27017<br/>MongoDB server version: 3.4.1<br/>{<br/> "set" : "rs1",<br/> ...<br/> },<br/> "members" : [<br/>  {<br/>   "_id" : 0,<br/>   "name" : "manager1:27017",<br/>   "health" : 1,<br/>   "state" : 1,<br/>   "stateStr" : "PRIMARY",<br/>   ...<br/>  },<br/>  {<br/>   "_id" : 1,<br/>   "name" : "worker1:27017",<br/>   "health" : 1,<br/>   "state" : 2,<br/>   "stateStr" : "SECONDARY",<br/>   ...<br/>  },<br/>  {<br/>   "_id" : 2,<br/>   "name" : "worker2:27017",<br/>   "health" : 1,<br/>   "state" : 0,<br/>   "stateStr" : "STARTUP",<br/>   ...<br/>  }<br/> ],<br/> "ok" : 1<br/>}</span></pre><p id="0a64" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">正如您所看到的，每个容器现在都配置良好，需要注意的是，我们像以前一样使用 docker 中的<code class="fe ou ov ow om b">--add-host</code>标志，这将这些条目添加到 Docker 容器的/etc/hosts 文件中，因此我们可以使用主机名而不是 IP 地址。</p><p id="14c1" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">两个节点从 mongoNode1 完成同步可能需要一分钟时间。</p><p id="01f9" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">您可以通过查看日志来查看每个 mongo Docker 容器中发生了什么。您可以通过在任何 docker-machine 服务器上运行该命令来实现这一点。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="d5f8" class="nw jv iq om b gy oq or l os ot">$ docker logs -ft mongoContainerName</span></pre><p id="37d6" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在我们已经有了一个<strong class="ku ir"> MongoDB 副本集</strong>服务，让我们修改我们的用户，或者您可以创建另一个用户，并授予一些权限来对数据库进行 crud 操作，因此，仅出于说明的目的，这是一个不好的做法，让我为我们的 admin 用户添加一个超级角色。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="d4d9" class="nw jv iq om b gy oq or l os ot"># we are going to assign the root role to our admin user</span><span id="4f26" class="nw jv iq om b gy ox or l os ot"><strong class="om ir"># we enter to the container</strong><br/>$ docker exec -it mongoNode1 bash -c 'mongo -u $MONGO_USER_ADMIN -p $MONGO_PASS_ADMIN --authenticationDatabase "admin"'</span><span id="e6ca" class="nw jv iq om b gy ox or l os ot"><strong class="om ir"># Then we execute the following in the mongo shell</strong><br/># Mongo 3.4.1 shell<br/>&gt; use admin<br/>&gt; db.grantRolesToUser( "cristian", [ "root" , { role: "root", db: "admin" } ] )<br/>&gt;</span></pre><p id="1184" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在他有了一个可以做任何东西的超级用户，所以让我们创建一个数据库并插入一些数据。</p><pre class="nj nk nl nm gt ol om on oo aw op bi"><span id="6d0d" class="nw jv iq om b gy oq or l os ot">$ docker exec -it mongoNode1 bash -c 'mongo -u $MONGO_USER_ADMIN -p $MONGO_PASS_ADMIN --authenticationDatabase "admin"'</span><span id="0ae9" class="nw jv iq om b gy ox or l os ot"># Mongo 3.4.1 shell<br/>&gt; use movies<br/>&gt; db.movies.insertMany([{<br/>  id: '1',<br/>  title: 'Assasins Creed',<br/>  runtime: 115,<br/>  format: 'IMAX',<br/>  plot: 'Lorem ipsum dolor sit amet',<br/>  releaseYear: 2017,<br/>  releaseMonth: 1,<br/>  releaseDay: 6<br/>}, {<br/>  id: '2',<br/>  title: 'Aliados',<br/>  runtime: 124,<br/>  format: 'IMAX',<br/>  plot: 'Lorem ipsum dolor sit amet',<br/>  releaseYear: 2017,<br/>  releaseMonth: 1,<br/>  releaseDay: 13<br/>}, {<br/>  id: '3',<br/>  title: 'xXx: Reactivado',<br/>  runtime: 107,<br/>  format: 'IMAX',<br/>  plot: 'Lorem ipsum dolor sit amet',<br/>  releaseYear: 2017,<br/>  releaseMonth: 1,<br/>  releaseDay: 20<br/>}, {<br/>  id: '4',<br/>  title: 'Resident Evil: Capitulo Final',<br/>  runtime: 107,<br/>  format: 'IMAX',<br/>  plot: 'Lorem ipsum dolor sit amet',<br/>  releaseYear: 2017,<br/>  releaseMonth: 1,<br/>  releaseDay: 27<br/>}, {<br/>  id: '5',<br/>  title: 'Moana: Un Mar de Aventuras',<br/>  runtime: 114,<br/>  format: 'IMAX',<br/>  plot: 'Lorem ipsum dolor sit amet',<br/>  releaseYear: 2016,<br/>  releaseMonth: 12,<br/>  releaseDay: 2<br/>}])</span><span id="aa0a" class="nw jv iq om b gy ox or l os ot"># inserted 5 documents<br/>&gt; </span></pre><p id="3ceb" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">现在我们有了一个电影数据库，其中的电影集合包含 5 部电影:d。</p><h1 id="f0a3" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">#是时候回顾一下了</h1><p id="5680" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们所做的…</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nr"><img src="../Images/07f2cb7820f168937504afd3bf90ce6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*-AhztyUh836BrQi20RqeGQ.png"/></div></div></figure><p id="23c2" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">我们使用带有自动化脚本的<strong class="ku ir"> Docker、</strong>配置并启动带有<strong class="ku ir">认证的<strong class="ku ir"> MongoDB 副本集</strong>。</strong></p><p id="ea61" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">在安全性方面，我们创建了:</p><ul class=""><li id="6afe" class="mu mv iq ku b kv mp kz mq ld mw lh mx ll my lp mz na nb nc bi translated">2 类用户，即<strong class="ku ir">管理数据库</strong>和<strong class="ku ir">集群管理数据库。</strong></li><li id="b29e" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated">我们创建一个<strong class="ku ir">密钥文件</strong>，并在启用<strong class="ku ir">身份验证的情况下启动副本。</strong></li></ul><blockquote class="oy oz pa"><p id="0026" class="ks kt pb ku b kv mp kx ky kz mq lb lc pc mr lf lg pd ms lj lk pe mt ln lo lp ij bi translated">如果为数据库正确配置了访问控制，攻击者应该无法访问您的数据。查看我们的<a class="ae pf" href="https://docs.mongodb.com/manual/administration/security-checklist/" rel="noopener ugc nofollow" target="_blank">安全清单</a>以帮助发现潜在的弱点。— <a class="ae pf" href="https://www.mongodb.com/blog/post/how-to-avoid-a-malicious-attack-that-ransoms-your-data?utm_source=dbweekly&amp;utm_medium=email" rel="noopener ugc nofollow" target="_blank"> @MongoDB Docs </a></p></blockquote><p id="a14a" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">如果我们想给我们的架构增加更多的安全性，我们可以用我们的 docker-machines 创建一个<strong class="ku ir"> Swarm 集群、</strong>，docker swarm 可以很好地处理网络通信，我们还可以在我们的容器中创建非根用户，我们可以在 mongoDB 中启用加密数据，但是这个主题不在本文的讨论范围之内。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="eea0" class="ju jv iq bd jw jx pm jz ka kb pn kd ke kf po kh ki kj pp kl km kn pq kp kq kr bi translated">#结论</h1><p id="90a6" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在我们有了一个工作的<strong class="ku ir"> MongoDB 副本集</strong>。您可以随时向该副本集添加节点。您甚至可以停止一个 mongo 容器或主 mongoNode1，并观察另一个 mongoNode 作为新的主 mongoNode。由于<strong class="ku ir">数据写入 docker 卷</strong>中，重启这些节点不成问题。<strong class="ku ir">数据将继续存在</strong>并完好无损地重新加入副本集。</p><p id="d1bd" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">对我们来说，一个好处是我们看到了如何用 bash 文件来自动化整个过程。</p><p id="a58a" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">您面临的一个挑战是修改<strong class="ku ir"> bash 脚本</strong>并使其更加动态<strong class="ku ir"/>，因为该脚本非常依赖于本文规范，另一个挑战是向架构添加一个任意的 Mongo 节点。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="ff8f" class="ju jv iq bd jw jx pm jz ka kb pn kd ke kf po kh ki kj pp kl km kn pq kp kq kr bi translated">Github 知识库</h1><p id="ae48" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">要获得文章的完整脚本文件，您可以在下面的 repo 中查看。</p><div class="lq lr gp gr ls lt"><a href="https://github.com/Crizstian/mongo-replica-with-docker" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd ir gy z fp ly fr fs lz fu fw ip bi translated">GitHub-Crizstian/mongo-Replica-with-docker:如何使用 Docker 部署 MongoDB 副本集</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">如何使用 docker 部署一个 MongoDB 副本集</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">github.com</p></div></div><div class="mc l"><div class="pr l me mf mg mc mh js lt"/></div></div></a></div><h1 id="79b1" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">进一步阅读</h1><ul class=""><li id="7864" class="mu mv iq ku b kv kw kz la ld oi lh oj ll ok lp mz na nb nc bi translated"><a class="ae pf" href="https://docs.mongodb.com/manual/tutorial/deploy-replica-set-with-keyfile-access-control/#deploy-repl-set-with-auth" rel="noopener ugc nofollow" target="_blank">部署带有密钥文件访问控制的副本集</a> — MongoDB Docs。</li><li id="4341" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated">向副本集添加成员 — MongoDB Docs。</li><li id="3adf" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated"><a class="ae pf" href="https://hub.docker.com/_/mongo/" rel="noopener ugc nofollow" target="_blank">MongoDB Docker Hub</a>—Docker Docs。</li><li id="98fc" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated"><a class="ae pf" href="https://www.mongodb.com/blog/post/how-to-avoid-a-malicious-attack-that-ransoms-your-data?utm_source=dbweekly&amp;utm_medium=email" rel="noopener ugc nofollow" target="_blank">如何避免勒索您数据的恶意攻击</a></li><li id="17a5" class="mu mv iq ku b kv nd kz ne ld nf lh ng ll nh lp mz na nb nc bi translated"><a class="ae pf" href="https://www.opsdash.com/blog/howto-setup-mongodb-secure.html?utm_source=dbweekly&amp;utm_medium=email" rel="noopener ugc nofollow" target="_blank">如何在 ubuntu 16.04 上设置安全的 mongoDB 3.4 服务器</a></li></ul></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="f4b2" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">我希望你喜欢这篇文章，我目前仍在探索 MongoDB 世界，所以我愿意接受反馈或贡献，如果你喜欢它，推荐给朋友，分享或再次阅读。</p><p id="e9e8" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">你可以在推特@ crami rez _ 92【https://twitter.com/cramirez_92】T3<br/>关注我</p><p id="383f" class="pw-post-body-paragraph ks kt iq ku b kv mp kx ky kz mq lb lc ld mr lf lg lh ms lj lk ll mt ln lo lp ij bi translated">直到下次😁👨🏼‍🎨👨🏻‍💻</p></div></div>    
</body>
</html>