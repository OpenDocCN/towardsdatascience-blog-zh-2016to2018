<html>
<head>
<title>How I built a REST endpoint based Computer Vision task using Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用Flask构建一个基于REST端点的计算机视觉任务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-machine-learning-as-a-rails-developer-739cc57ea01c?source=collection_archive---------2-----------------------#2017-12-31">https://towardsdatascience.com/how-to-build-a-machine-learning-as-a-rails-developer-739cc57ea01c?source=collection_archive---------2-----------------------#2017-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/420ef2ffaf2df459cd43c96f0a94b97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsNYFOtRmDn_3Spv424g7Q.png"/></div></div></figure><div class=""/><p id="0308" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我熟悉计算机视觉和机器学习技术的过程的后续。作为一名web开发人员(理解为“rails开发人员”)，我发现这个不断发展的领域令人兴奋，但是不要每天都使用这些技术。这是探索这一领域的两年旅程的第三个月。如果你还没有阅读，你可以在这里看到<a class="ae kw" rel="noopener" target="_blank" href="/my-next-two-years-de448d3141a">第一部分:从webdev到计算机视觉和地理</a>和<a class="ae kw" rel="noopener" target="_blank" href="/two-months-exploring-deep-learning-and-computer-vision-3dcc84b2457f">第二部分:两个月探索深度学习和计算机视觉</a>。</p><h1 id="769f" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">总体思路</h1><p id="37c9" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Rails开发人员擅长毫不费力地快速构建web应用程序。在支架、清晰的模型-视图-控制器逻辑和大量的ruby gems之间，具有复杂逻辑的Rails应用程序可以在很短的时间内完成。例如，我会毫不犹豫地构建一些需要用户帐户、文件上传和各种数据源的东西。我甚至可以用优秀的文档使它高度可测试。在Devise、Carrierwave(或许多其他文件上传gem)、Sidekiq和所有其他可访问的gem之间，我将在15分钟内在Heroku上启动并运行。</p><p id="952e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，加上一个计算机视觉或机器学习任务，我就不知道该去哪里了。即使我在探索这个领域，除了单词联想或图像分析，我仍然很难找到机器学习概念(神经网络和深度学习)的实际应用。也就是说，有趣的想法(我还没有找到实际应用)是围绕趋势检测和生成对抗网络。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ma"><img src="../Images/ba485cba4cfe3c6add6a54122498ffa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*KXViXHpj53-MCihJmyLaLw.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Google search for “how to train a neural network”</figcaption></figure><p id="174f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一名软件工程师，我发现很难理解机器学习在我构建的应用程序中的实用价值。有很多关于模型(机器学习意义上，而不是web应用程序/数据库意义上)、神经网络架构和研究的文章，但我没有看到像我这样的web开发人员的实际应用。因此，我决定将我已经思考了一段时间的项目的一小部分构建出来。</p><p id="dafc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该项目旨在检测Instagram上的优秀涂鸦。最初的想法是使用机器学习来限定“好的涂鸦”看起来是什么样的，然后运行机器学习模型来检测和收集图像。从概念上来说，这个想法听起来很棒，但我不知道如何“训练一个机器学习模型”，我对从哪里开始没有什么感觉。</p><p id="53ea" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我开始构建项目的一个简单部分，因为我知道我需要在好的涂鸦上“训练”我的“模型”。我挑选了一些优秀涂鸦艺术家的Instagram账户，我知道我可以在那里找到高质量的图像。在抓取Instagram账户(由于Instagram的API限制，这比预期的时间长得多)并分析图片后，我意识到手头的一个大问题。所选的账户很棒，但有许多非涂鸦的图像，主要是人。为了得到“好的涂鸦”图像，我首先需要过滤出人的图像。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/6b3661b6c1e9f305efa677636a6ddd1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpHLJvL13BI8UtK7GjP0hw.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">The application I built to crawl Instagram created a frontend that displayed graffiti.</figcaption></figure><p id="2ab2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过查看这些图片，我发现每10张图片中有多达4张是一个人的或者里面有一个人。结果，在开始“训练”一个“好涂鸦”的“模型”之前，我只需要得到一组不包含任何人的图片。</p><p id="05db" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">(对非机器学习人员的补充说明:我在某些单词周围使用引号，因为你和我可能对这些单词的实际意思有相同的理解。)</p><p id="4ecd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与其有一个复杂的机器学习应用程序来完成一些复杂的神经网络-深度学习-人工智能-随机梯度下降-线性回归-贝叶斯机器学习魔法，我决定简化这个项目，建立一些检测照片中的人并标记他们的东西。我意识到，我之前读过的许多机器学习教程的例子都向我展示了如何做到这一点，所以问题是要让那些教程真正有用。</p><p id="406e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi">—</p><h1 id="dae1" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">应用程序(带有代码链接)</h1><p id="2a8f" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我将Ruby on Rails用于管理数据库和呈现内容的web应用程序。我使用Ruby通过Redis库Sidekiq完成了Instagram的大部分图片抓取。这使得运行延迟任务变得容易。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/f3663da1512897f728110960ffdda37d.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*m-Uxj0bxjty9XuBdZU0tew.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk"><a class="ae kw" href="https://www.pyimagesearch.com/2017/09/11/object-detection-with-deep-learning-and-opencv/" rel="noopener ugc nofollow" target="_blank">The PyImageSearch article used as reference is great and can be found at </a><a class="ae kw" href="https://www.pyimagesearch.com/2017/09/11/object-detection-with-deep-learning-and-opencv/" rel="noopener ugc nofollow" target="_blank">https://www.pyimagesearch.com/2017/09/11/object-detection-with-deep-learning-and-opencv/</a></figcaption></figure><p id="fcc5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于机器学习逻辑，我有一个使用OpenCV进行对象检测的代码示例，来自PyImageSearch.com教程的<a class="ae kw" href="https://www.pyimagesearch.com/2017/09/11/object-detection-with-deep-learning-and-opencv/" rel="noopener ugc nofollow" target="_blank">。该代码示例并不完整，因为它检测了定型图像模型中30个不同项目中的一个，其中一个是人，并在检测到的对象周围画了一个框。在我的例子中，我稍微修改了这个例子，并把它放在一个基于Flask的简单web应用程序中。</a></p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mm"><img src="../Images/aae9ab16bb22cc849040e6e155180a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xfGfqNyS2wXoW3cahkRQHQ.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk"><a class="ae kw" href="https://github.com/rememberlenny/Flask-Person-Detector/blob/master/server.py" rel="noopener ugc nofollow" target="_blank">Link to Github: The main magic of the app</a></figcaption></figure><p id="a741" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我制作了一个Flask应用程序，其端点接受带有图像URL的JSON blob。应用程序下载了图像URL，并通过在检测到的对象周围绘制一个边界框的代码示例对其进行处理。我只关心检测人的代码示例，所以我创建了一个基本条件，为检测人给出特定的响应，为其他所有事情给出一般的响应。</p><p id="83d7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个简单的端点就是机器学习的魔力。可悲的是，这也是我第一次看到复杂的机器学习“东西”如何与web应用程序的其余部分集成的实际可用的例子。</p><p id="7e99" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于那些感兴趣的人来说，这些代码如下。</p><div class="ip iq gp gr ir mn"><a href="https://github.com/rememberlenny/Flask-Person-Detector" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd jc gy z fp ms fr fs mt fu fw ja bi translated">记住lenny/Flask-Person探测器</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">基于Flask的web应用程序，使用OpenCV的深度神经网络提供了一个REST端点…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb ix mn"/></div></div></a></div><p id="8b1a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi">—</p><h1 id="7579" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">总结体会</h1><p id="9440" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我很惊讶我以前没有见过一个简单的基于Flask的深度神经网络的实现。我还觉得基于这种实现，当不涉及训练模型时，将机器学习应用到任何应用程序中就像拥有一个具有有用功能的库一样。我假设在未来，模型和利用模型的库的分离将会被简化，类似于一个库如何被“导入”或者使用捆绑器添加。我的猜测是这些工具中的一些是存在的，但是我还没有深入了解它们。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/f1aed34d44884012a9d4806cce42e07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mp24pQVK2pWSw6mqOYYmlg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk"><a class="ae kw" href="https://www.tensorflow.org/serving/" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/serving/</a></figcaption></figure><p id="b8f6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过回顾如何访问对象检测逻辑，我发现了一些似乎相关的服务，但最终并不是我所需要的。具体来说，有一个名为<a class="ae kw" href="https://www.tensorflow.org/serving/" rel="noopener ugc nofollow" target="_blank"> Tensorflow Serving </a>的工具，它似乎应该是Tensorflow的一个简单的web服务器，但还不够简单。这可能是我所需要的，但是拥有一个单独运行Tensorflow的服务器或web应用程序的想法很难实现。</p><h2 id="92f5" class="nd ky jb bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">基于Web服务的机器学习</h2><p id="fea3" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我在网上找到的很多机器学习的例子都是非常完备的例子。示例从问题开始，然后提供在本地运行示例的代码。通常，图像是由file path通过命令行界面提供的输入，而输出是python生成的窗口，显示经过处理的图像。作为一个web应用程序，这不是很有用，所以创建一个REST端点似乎是一个基本的下一步。</p><p id="b7b1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将机器学习逻辑构建到REST端点中并不难，但是需要考虑一些事情。在我的例子中，服务器运行在一台台式计算机上，有足够的CPU和内存来快速处理请求。情况可能并不总是这样，所以未来的端点可能需要使用Redis之类的东西异步运行任务。这里的HTTP请求很可能会挂起并超时，因此对于慢速查询，需要考虑一些基本的微服务逻辑。</p><h2 id="75f3" class="nd ky jb bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">二元期望和机器学习品牌</h2><p id="7bfd" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">最终应用程序的一个大问题是，处理后的涂鸦图像有时会被错误地标记为人。当这幅画包含看起来像一个人的特征时，例如一张脸或身体，物体分类器错误地标记了这幅画。相反，有时人的照片没有正确地将图像标记为包含人。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/7569fa5d913714164f9a74f02406a2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIXjxZfOkvjbOMCUcavVeg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">[GRAFFITI ONLY] List of images that were noted to not have people. Note the images with the backs of people.</figcaption></figure><p id="01eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Web应用程序需要二元结论来采取行动。图像分类器将提供关于检测到的物体是否存在的百分比等级。在较大的对象检测模型中，分类器将有一个以上的对象被推荐为可能被检测到。例如，照片中有90%的可能性是一个人，有76%的可能性是一架飞机，有43%的可能性是一只巨大的香蕉。当处理响应的应用程序只需要知道某些东西是否存在时，这不是很有用。</p><figure class="mb mc md me gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/5edc5ca697081e21ff98e215d6f7a879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LOL3byogLjTvUrMvFy0w2A.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">[PEOPLE ONLY] List of images that were classified as people. Note the last one is a giant mural with features of a face.</figcaption></figure><p id="9c69" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这带来了质量在任何基于机器学习的过程中的重要性。假设很少有对象分类器或基于图像的过程是100%正确的，那么API的质量是很难衡量的。当谈到这些对象分类器API的商业实现时，服务的品牌将在很大程度上受到少数请求的边缘情况的影响。因为机器学习本身是如此不透明，服务提供商的品牌在确定这些服务的可信度方面将更加重要。</p><p id="dbf1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">相反，由于机器学习任务的质量差异如此之大，一个品牌可能很难向用户展示其价值。当解决机器学习任务的二进制质量与美元金额挂钩时，例如每个API请求，免费做某事的能力将很有吸引力。从价格的角度来看，滚动自己的免费对象分类器会比使用第三方服务更好。在成为明显优于自托管实现的首选之前，品牌机器学习服务市场还有很长的路要走。</p><h2 id="36da" class="nd ky jb bd kz ne nf dn ld ng nh dp lh kj ni nj ll kn nk nl lp kr nm nn lt no bi translated">物体分类的特异性非常重要</h2><p id="beac" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">最后，当涉及到任何机器学习任务时，特异性是你的朋友。具体来说，当谈到涂鸦时，很难界定形式各异的东西。涂鸦本身是一个包含大量视觉作品的类别。甚至一个人可能很难界定什么是涂鸦，什么不是涂鸦。与检测人脸或水果相比，类别的特异性非常重要。</p><p id="2136" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">WordNet和ImageNet的卓越之处在于类别特异性的力量。通过用词和词与词之间的关系对世界进行分类，有一种方法可以证明图像的相似性和差异性。例如，鸽子是一种鸟，但不同于鹰。与此同时，它与飞机或蜜蜂完全不同。这些事物之间的关系允许对它们进行清楚的分类。涂鸦中不存在这种特异性，但需要这种特异性来适当地改进对象分类器。</p><h1 id="830b" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最终决赛</h1><p id="ea0d" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">总的来说，这个应用程序运行良好，非常有帮助。这消除了更多关于机器学习和图像识别服务如何工作的神秘。正如我上面提到的，这个过程也让我更加意识到这些服务的不足和这个领域尚未定义的地方。我绝对认为这是所有软件工程师都应该学会的。在可用的工具变得简单易用之前，我想复杂的生态系统将会有一个很好的导航期。类似于网络标准形成之前的浏览器战争，机器学习提供商之间将会有很多争夺市场份额的竞争。你已经可以在亚马逊、谷歌和苹果等大公司的服务之间看到这一点。在软硬件层面，这一点在Nvidia的CUDA和AMD的价格吸引力之间也非常明显。</p><p id="62c6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更多即将推出！</p></div></div>    
</body>
</html>