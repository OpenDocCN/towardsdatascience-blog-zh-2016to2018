<html>
<head>
<title>When will Stack Overflow reply: How to predict with BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">堆栈溢出何时回复:如何用 BigQuery 预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/when-will-stack-overflow-reply-how-to-predict-with-bigquery-553c24b546a3?source=collection_archive---------14-----------------------#2018-11-13">https://towardsdatascience.com/when-will-stack-overflow-reply-how-to-predict-with-bigquery-553c24b546a3?source=collection_archive---------14-----------------------#2018-11-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="io ip gp gr iq ir"><div class="bz fp l di"><div class="is it l"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Stack Overflow predictions: You can play with this interactive dashboard!</figcaption></figure><div class=""/><div class=""><h2 id="9e77" class="pw-subtitle-paragraph jx iz ja bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">当你最后发布一个关于栈溢出的问题时，一个漫长的等待就开始了。有人会回答你的问题吗？社区会否决你的问题，认为你的问题不好吗？有人会给你答案吗？他们回答了吗？我们能预测这些吗？就这么办吧。</h2></div><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi kp"><img src="../Images/bc8a3663477c7e742b68fb686ac38f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*txrrVVbOe16PhQ9Q3FN3iw.png"/></div></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Stack Overflow stats per month</figcaption></figure><p id="7f69" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我喜欢堆栈溢出。它回答了我的大多数编程问题，如果没有，我可以发布一个新的。正常情况下，一个月会有超过 120，000 名用户提出新问题，超过 75，000 名社区成员随时准备提供帮助。我知道，因为<a class="ae lw" href="https://stackoverflow.com/users/132438/felipe-hoffa?tab=topactivity" rel="noopener ugc nofollow" target="_blank">我两边都去过</a>。</p><p id="45f8" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">BigQuery 为<a class="ae lw" href="https://console.cloud.google.com/marketplace/browse?q=BigQuery%20Public%20Data" rel="noopener ugc nofollow" target="_blank">提供了许多公共数据集</a>，其中之一是 Stack Overflow 的季度更新副本。我们可以使用这些数据和最近发布的 BigQuery ML 特性来预测需要多长时间来回答您的堆栈溢出问题。</p><p id="2620" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">你刚刚发布了一个关于堆栈溢出的问题吗？在您等待的时候，让我们回顾一下这些预测是如何运行的。</p><h1 id="6e04" class="lx ly ja bd lz ma mb mc md me mf mg mh kg mi kh mj kj mk kk ml km mm kn mn mo bi translated">背后的科学</h1><p id="f3e7" class="pw-post-body-paragraph la lb ja lc b ld mp kb lf lg mq ke li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">第一步是测量用户在堆栈溢出的人给他们一个答案之前要等待多长时间。我们将从 BigQuery 中的<a class="ae lw" href="https://medium.com/google-cloud/google-bigquery-public-datasets-now-include-stack-overflow-q-a-5a8a7e371b52" rel="noopener">问题表中得到这个，并通过一个相关子查询得到答案:</a></p><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mu"><img src="../Images/9e431181150729f2ae683a9cfb47852a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kdw12q6vOsUN5c3DplNCpA.png"/></div></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Average time to get an answer on Stack Overflow, per tag. Keep reading, because we’ll debunk these numbers in a few.</figcaption></figure><p id="f22d" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">将答案与问题结合起来的基本查询，产生问题与其第一个答案之间的时间:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="3af2" class="na ly ja mw b gy nb nc l nd ne">WITH question_answers_join AS (<br/>  SELECT *<br/>    , GREATEST(1, TIMESTAMP_DIFF(answers.first, creation_date, minute)) minutes_2_answer<br/>  FROM (<br/>    SELECT id, creation_date, title<br/>      , (SELECT AS STRUCT MIN(creation_date) first, COUNT(*) c<br/>         FROM `bigquery-public-data.stackoverflow.posts_answers` <br/>         WHERE a.id=parent_id<br/>      ) answers<br/>      , SPLIT(tags, '|') tags<br/>    FROM `bigquery-public-data.stackoverflow.posts_questions` a<br/>    WHERE EXTRACT(year FROM creation_date) &gt; 2016<br/>  )<br/>)</span><span id="ac19" class="na ly ja mw b gy nf nc l nd ne">SELECT * <br/>FROM question_answers_join<br/>WHERE 'google-bigquery' IN UNNEST(tags)<br/>AND answers.c &gt; 0<br/>ORDER BY RAND()<br/>LIMIT 10</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/d76d9299ca4299ed0c80e4ebfb6c60ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*-54__KMNQp4veXaQTEDVAQ.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Some sample questions — when were they posted, how long it took to get an answer.</figcaption></figure><p id="d536" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这是一个好的开始，让我们来看看一些流行标签的平均价格:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="c39a" class="na ly ja mw b gy nb nc l nd ne">SELECT COUNT(*) questions, tag<br/>  , ROUND(<strong class="mw jb">AVG((minutes_2_answer)</strong>), 2) avg_minutes<br/>FROM question_answers_join, UNNEST(tags) tag<br/>WHERE tag IN ('javascript', 'python', 'rust', 'java', 'php', 'ruby', 'perl', 'ios', 'android', 'angularjs')<br/>AND answers.c &gt; 0<br/>GROUP BY tag<br/>ORDER BY avg_minutes</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5e97f38d46526212ecc84a889de1eb67.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*jBJeQUVjdfSDjaeezY8P7A.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Naive average time per tag to get an answer.</figcaption></figure><p id="2ef1" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">事实证明 Perl 拥有最令人惊奇的社区:它是回复最快的！其次是 Rust、Ruby、PHP。最慢的社区是 Android 和 iOS。在这之间你有…<strong class="lc jb">停在那里</strong></p><blockquote class="ni"><p id="1436" class="nj nk ja bd nl nm nn no np nq nr lv dk translated">警告:普通平均值在这里是不好的。相反，我们将计算<a class="ae lw" href="https://stackoverflow.com/a/51981354/132438" rel="noopener ugc nofollow" target="_blank">几何平均值</a>。</p></blockquote><p id="06f3" class="pw-post-body-paragraph la lb ja lc b ld ns kb lf lg nt ke li lj nu ll lm ln nv lp lq lr nw lt lu lv ij bi translated">我不会在这里详细解释为什么普通平均值不好——但是您应该注意的第一件事是，这些数字告诉我们，我们必须等待几天才能得到关于堆栈溢出的回复——这并不反映我们的正常体验。为了减少异常值的影响，我们可以要求使用<a class="ae lw" href="https://medium.com/@JLMC/understanding-three-simple-statistics-for-data-visualizations-2619dbb3677a" rel="noopener">几何平均值</a>和中位数来代替:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="8c9d" class="na ly ja mw b gy nb nc l nd ne">SELECT COUNT(*) questions, tag<br/>  , ROUND(EXP(AVG(LOG(minutes_2_answer))), 2) mean_geo_minutes<br/>  , APPROX_QUANTILES(minutes_2_answer, 100)[SAFE_OFFSET(50)] median<br/>FROM question_answers_join, UNNEST(tags) tag<br/>WHERE tag IN ('javascript', 'python', 'rust', 'java', 'php', 'ruby', 'perl', 'ios', 'android', 'angularjs')<br/>AND answers.c &gt; 0<br/>GROUP BY tag<br/>ORDER BY mean_geo_minutes</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/543ac56de72cec7e4ebfb515b6323f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*CUuYdYEmXPiFUG5rY9ekcA.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Geometric mean and median time to get an answer in Stack Overflow per tag</figcaption></figure><p id="750a" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这更有意义:你的 JavaScript 问题将在 35 分钟内得到回答，而 Rust、Android 和 iOS 问题将需要一个多小时才能出现。</p><p id="7c8a" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们也可以计算得到答案的几率:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="8d20" class="na ly ja mw b gy nb nc l nd ne">SELECT COUNT(*) questions, tag<br/>  , ROUND(EXP(AVG(LOG(minutes_2_answer))), 2) avg_minutes<br/>  , FORMAT('%.2f%%', 100*<strong class="mw jb">COUNT(minutes_2_answer)/COUNT(*)</strong>) chance_of_answer<br/>FROM question_answers_join, UNNEST(tags) tag<br/>WHERE tag IN ('javascript', 'python', 'rust', 'java', 'php', 'ruby', 'perl', 'ios', 'android', 'angularjs')<br/>GROUP BY tag<br/>ORDER BY avg_minutes</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/8412d63e98c42616e5b5ede19979da15.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*CFToIzuECaNk_E2c4o_cJw.png"/></div></figure><p id="2de9" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">Perl、Ruby 和 Rust 在这里看起来不错:从我们的选择中，这些是仅有的回复率高于 80%的标签。有趣的是，这些标签比其他标签得到的问题少得多。</p><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/78f9317422da701811de701a2dd700c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCTTpCWsqS4FhJk5EVq51g.png"/></div></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Time to answer vs chance of answer: iOS and Android are the slowest to reply, while they also have the lowest chance of replying. Perl has a high probability of getting a reply. Meanwhile Javascript, Python and PHP have more questions than Perl, and are quicker to reply. (<a class="ae lw" href="https://datastudio.google.com/c/u/0/reporting/1XNs9m9DoqGyZ4vPHeizKB-Fd8Ye7qLon/page/byEa/edit" rel="noopener ugc nofollow" target="_blank">DS source</a>)</figcaption></figure><p id="7e68" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在，我们可以探索很多其他的变量:是在周一还是周六需要更多的时间来得到答案？新栈溢出用户比资深用户得到更快的回复？用哪个词开始提问很重要吗？问题不用问号结尾有关系吗？更长的问题还是更短的问题？一天中的什么时候？让我们来回答所有这些问题:</p><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/45e00a6608d0545243ec1ba56115b68a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*aR3KQqM-5B57jkSVAHmndA.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk"><strong class="bd ob">First word: </strong>Most people ask ‘how’ questions. ‘Can’ take longer to answer than ‘why’s.</figcaption></figure><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/babd14d9dfa6d0238dfa67bbfa8e5f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*Jyk64pMrpxCoYiRyo1S4QQ.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk"><strong class="bd ob">Day of week (UTC)</strong>: More questions during the week, faster answers, but with a lower probability of answer.</figcaption></figure><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/cd8ce9990a3d1abeecff774eea7e9d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*dNE6JMgVbQHtxI1ZMn0JBw.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk"><strong class="bd ob">Hour of the day (UTC)</strong>. Faster answers — with lower chance of getting an answer: 14:00 UTC, which is 7am in California. The opposite at 00:00 UTC, 5pm California.</figcaption></figure><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/03033110dc1ccb70671d727b5d036624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*wwxviYLQ6pA7N2ECJDp1jg.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk"><strong class="bd ob">Account creation year</strong>: New users get quick replies. Veteran users ask questions that take longer to reply, but more of their questions are replied. Note there seems to be a linear relationship between account age and time to answer, but a non-linear one with probability of answer.</figcaption></figure><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi od"><img src="../Images/384a0872ad749f152247c0d54cf7a152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*4TEgA9yzBtyKekM5j8kb7g.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk"><strong class="bd ob">Length of question</strong>: Shorter questions are easier to answer, and with a higher chance.</figcaption></figure><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1d5c4e0e116f9fb4d5415b6034059fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*as3W8FV9skumM1AgeYDDpQ.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk"><strong class="bd ob">Did they use a ?</strong>: Questions that end with a question mark get quicker answers with a higher chance?</figcaption></figure><p id="c8f0" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我获取所有这些维度的基本查询:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="b276" class="na ly ja mw b gy nb nc l nd ne">WITH answers AS (<br/>  SELECT * <br/>    , REGEXP_EXTRACT(LOWER(title), '[a-z]+') first_word<br/>    , '?' = SUBSTR(title, LENGTH(title)) ends_question<br/>    , GREATEST(1, TIMESTAMP_DIFF(answers.first, creation_date, minute)) minutes_first_answer<br/>    , answers.c &gt; 0 was_answered<br/>  FROM (<br/>    SELECT creation_date, title<br/>      , CASE WHEN LENGTH(body)&lt;700 THEN 'short' WHEN LENGTH(body)&lt;1700 THEN 'medium' ELSE 'long' END question_length<br/>      , (SELECT AS STRUCT MIN(creation_date) first, COUNT(*) c<br/>         FROM `bigquery-public-data.stackoverflow.posts_answers` <br/>         WHERE a.id=parent_id<br/>      ) answers<br/>      ,(SELECT  AS STRUCT EXTRACT(year FROM creation_date) account_creation_year<br/>         FROM `bigquery-public-data.stackoverflow.users`  <br/>         WHERE a.owner_user_id=id <br/>      ) user<br/>      , SPLIT(tags, '|') tags<br/>    FROM `bigquery-public-data.stackoverflow.posts_questions` a<br/>    WHERE EXTRACT(year FROM creation_date) &gt; 2016<br/>  )<br/>)</span><span id="8f0b" class="na ly ja mw b gy nf nc l nd ne">SELECT tag, 60*EXP(AVG(LOG(minutes_first_answer ))) time_to_answer, COUNT(minutes_first_answer)/COUNT(*) chance_of_answer<br/>   , COUNT(*) questions<br/>-- first_word, ends_question, tag<br/>--   , FORMAT_TIMESTAMP('%H', creation_date) hour_utc<br/>--   , FORMAT_TIMESTAMP('%A', creation_date) weekday_utc<br/>--   , user.account_creation_year<br/>--   , question_length<br/>FROM answers, UNNEST(tags) tag<br/>WHERE tag IN ('javascript', 'python', 'rust', 'java', 'php', 'ruby', 'perl', 'ios', 'android', 'angularjs')<br/>--AND first_word IN UNNEST(['why','what','how','is','can', 'i'])<br/>GROUP BY 1</span></pre><h1 id="4ead" class="lx ly ja bd lz ma mb mc md me mf mg mh kg mi kh mj kj mk kk ml km mm kn mn mo bi translated">结合一切:回归！</h1><p id="ba2a" class="pw-post-body-paragraph la lb ja lc b ld mp kb lf lg mq ke li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">那么我们如何综合所有这些平均值呢？如果我在周四下午 3 点有一个简短的 SQL 问题，并且我自 2009 年以来一直是一个堆栈溢出用户，该怎么办？我的问题以“什么”开头，我会确保以提问的形式提问。我们能不能创建一个公式，囊括所有这些指标，即使以前没有人尝试过这种组合？</p><blockquote class="ni"><p id="ff28" class="nj nk ja bd nl nm nn no np nq nr lv dk translated">是啊！这就是为什么 BigQuery 现在支持线性和逻辑回归(期待更多)。跟我的朋友打个招呼，<a class="ae lw" href="https://cloud.google.com/bigquery/docs/bigqueryml-intro" rel="noopener ugc nofollow" target="_blank"> BigQuery ML </a>。</p></blockquote><p id="4e94" class="pw-post-body-paragraph la lb ja lc b ld ns kb lf lg nt ke li lj nu ll lm ln nv lp lq lr nw lt lu lv ij bi translated">要创建一个线性回归模型，将所有这些特征组合成一个预测，预测您需要等待多长时间才能得到答案，只需执行以下操作:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="b76c" class="na ly ja mw b gy nb nc l nd ne">CREATE MODEL `dataset.stacko_predicted_time`<br/>OPTIONS  (model_type='linear_reg' ) AS</span><span id="724e" class="na ly ja mw b gy nf nc l nd ne">SELECT first_word, ends_question, tag<br/>  , FORMAT_TIMESTAMP('%H', creation_date) hour_utc<br/>  , FORMAT_TIMESTAMP('%A', creation_date) weekday_utc<br/>  , user.account_creation_year<br/>  , question_length<br/>  , <strong class="mw jb">LOG(minutes_first_answer) label</strong><br/>FROM answers, UNNEST(tags) tag<br/>WHERE was_answered</span></pre><p id="e786" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">该查询涉及 3，784，571 个问题及其回复，超过 46，178 个不同的标签。您可能会注意到，我为他们的每个标签复制了问题(当他们有多个标签时)，这样总共有 11，297，337 行。这可能会给一些标签一个不公平的平衡，但我们可以稍后再讨论。训练这个模型花了多长时间？6 分钟，我最后一次尝试。</p><div class="kq kr ks kt gt ab cb"><figure class="of ir og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/e0f1341445847a64dc43c8ce33b83ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*9L-AtAAtE4oLUON0-JuEIQ.png"/></div></figure><figure class="of ir ol oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/cadc5d3d74bf7ee9b3bcd1e518f83210.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*QWe8S78r3scNsWFglOoNBQ.png"/></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk om di on oo">Different instances of training this model .</figcaption></figure></div><h2 id="af31" class="na ly ja bd lz op oq dn md or os dp mh lj ot ou mj ln ov ow ml lr ox oy mn oz bi translated">一些统计数据:</h2><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/4242e733353c5c83e8c5229c32cfa396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*nt9J3N8CvSyi6d2F5Vfymw.png"/></div></figure><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="2f60" class="na ly ja mw b gy nb nc l nd ne">SELECT processed_input, weight<br/>  , ARRAY(SELECT AS STRUCT * FROM UNNEST(category_weights) WHERE weight&lt;0.7 ORDER BY RAND() DESC LIMIT 2) category_weights<br/>FROM ML.WEIGHTS(MODEL `dataset.stacko_predicted_time`)</span><span id="a411" class="na ly ja mw b gy nf nc l nd ne">SELECT *<br/>FROM ML.EVALUATE(MODEL `dataset.stacko_predicted_time`)</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pb"><img src="../Images/d6c36bee8eb45c70558617f1bacfd452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQ0RsIHOyYyiOBIbTYQSjQ.png"/></div></div></figure><p id="6a50" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">要检查这些值的含义，请参见<a class="ae lw" href="https://developers.google.com/machine-learning/glossary/" rel="noopener ugc nofollow" target="_blank">机器学习词汇表</a>，或者参见<a class="pc pd ep" href="https://medium.com/u/7f2ab73b39f8?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">莎拉·罗宾逊</a>的<a class="ae lw" href="https://medium.com/@srobtweets/machine-learning-on-machines-building-a-model-to-evaluate-cpu-performance-d43528f6075a" rel="noopener">预测 CPU 性能</a>中对不同预测的类似值的分析。在试图赋予权重意义之前，请检查<a class="ae lw" href="https://hackernoon.com/why-feature-weights-in-a-machine-learning-model-are-meaningless-b0cd22a4c159" rel="noopener ugc nofollow" target="_blank">上的<a class="pc pd ep" href="https://medium.com/u/247b0630b5d6?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank"> Lak Lakshmanan </a>为什么机器学习模型中的特征权重是无意义的</a>。</p><p id="aae9" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">对于 6 分钟的实验来说，还不错。我们可以做很多改进，但现在让我们继续。</p><p id="8738" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">训练答案的概率同样简单，只是这次用了逻辑回归:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="fa87" class="na ly ja mw b gy nb nc l nd ne">CREATE MODEL `dataset.stacko_predicted_answered`<br/>OPTIONS  (<strong class="mw jb">model_type='logistic_reg'</strong>) AS</span><span id="74e2" class="na ly ja mw b gy nf nc l nd ne">SELECT first_word, ends_question, tag<br/>  , FORMAT_TIMESTAMP('%H', creation_date) hour_utc<br/>  , FORMAT_TIMESTAMP('%A', creation_date) weekday_utc<br/>  , user.account_creation_year<br/>  , question_length<br/>  , <strong class="mw jb">IF(was_answered, 1, 0) label</strong><br/>FROM answers, UNNEST(tags) tag</span></pre><p id="c108" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">哦，如果没有时态表<code class="fe pe pf pg mw b">answers</code>，上面的查询将无法工作，它具有我们建模的特性:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="0735" class="na ly ja mw b gy nb nc l nd ne">WITH answers AS (<br/>  SELECT * <br/>    , REGEXP_EXTRACT(LOWER(title), '[a-z]+') first_word<br/>    , '?' = SUBSTR(title, LENGTH(title)) ends_question<br/>    , GREATEST(1, TIMESTAMP_DIFF(answers.first, creation_date, minute)) minutes_first_answer<br/>    , answers.c &gt; 0 was_answered<br/>  FROM (<br/>    SELECT creation_date, title<br/>      , CASE WHEN LENGTH(body)&lt;700 THEN 'short' WHEN LENGTH(body)&lt;1700 THEN 'medium' ELSE 'long' END question_length<br/>      , (SELECT AS STRUCT MIN(creation_date) first, COUNT(*) c<br/>         FROM `bigquery-public-data.stackoverflow.posts_answers` <br/>         WHERE a.id=parent_id<br/>      ) answers<br/>      ,(SELECT  AS STRUCT EXTRACT(year FROM creation_date) account_creation_year<br/>         FROM `bigquery-public-data.stackoverflow.users`  <br/>         WHERE a.owner_user_id=id <br/>      ) user<br/>      , SPLIT(tags, '|') tags<br/>    FROM `bigquery-public-data.stackoverflow.posts_questions` a<br/>    WHERE EXTRACT(year FROM creation_date) &gt; 2016<br/>  )<br/>)</span></pre><h2 id="269b" class="na ly ja bd lz op oq dn md or os dp mh lj ot ou mj ln ov ow ml lr ox oy mn oz bi translated">预测</h2><p id="f2f0" class="pw-post-body-paragraph la lb ja lc b ld mp kb lf lg mq ke li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">一旦创建了模型，您就可以使用如下查询来预测任何类型的组合:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="0102" class="na ly ja mw b gy nb nc l nd ne">SELECT * FROM ML.PREDICT(<br/>  MODEL `fh-bigquery.bqml_models.stacko_201809_time` <br/>  , (<br/>    SELECT 'why' first_word<br/>      , true ends_question<br/>      , 'google-bigquery' tag<br/>      , '7' hour_utc<br/>      , 'Monday' weekday_utc<br/>      , 2013 account_creation_year <br/>      , 'short' question_length<br/>    )<br/>)</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ph"><img src="../Images/66fec683d222a8a3b87c120a73fda4f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5i4x7eFdv3OeDcw1z_cl8Q.png"/></div></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">Prediction results</figcaption></figure><p id="ff6a" class="pw-post-body-paragraph la lb ja lc b ld le kb lf lg lh ke li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">并在一个查询中组合所有 3 个模型:</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="1490" class="na ly ja mw b gy nb nc l nd ne">WITH features AS (<br/>  SELECT 'why' first_word, true ends_question<br/>    , 'google-bigquery' tag, '7' hour_utc<br/>    , 'Monday' weekday_utc, 2013 account_creation_year <br/>    , 'short' question_length<br/>)</span><span id="1cf4" class="na ly ja mw b gy nf nc l nd ne">SELECT predicted_label minutes, * EXCEPT(predicted_label)<br/>FROM ML.PREDICT(<br/>  MODEL `fh-bigquery.bqml_models.stacko_201809_time` <br/>  , (SELECT <br/>      (SELECT prob FROM UNNEST(predicted_label_probs) WHERE label=1 LIMIT 1) prob_down<br/>      , * EXCEPT(predicted_label, predicted_label_probs)<br/>    FROM ML.PREDICT(<br/>      MODEL `fh-bigquery.bqml_models.stacko_201809_downvoted` <br/>      , (SELECT <br/>          (SELECT prob FROM UNNEST(predicted_label_probs) WHERE label=1 LIMIT 1) prob_answer<br/>          , * EXCEPT(predicted_label, predicted_label_probs)<br/>        FROM ML.PREDICT(<br/>          MODEL `fh-bigquery.bqml_models.stacko_201809_answered`, TABLE features<br/>        )<br/>      )<br/>    )<br/>  )  <br/>)</span></pre><figure class="kq kr ks kt gt ir gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/f5cd4b57820e8052bc90fa9c0082dcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZipKcP4SkQsgogtXiPFqQ.png"/></div></div><figcaption class="iu iv gj gh gi iw ix bd b be z dk">1 query, 3 predictions</figcaption></figure><h1 id="d787" class="lx ly ja bd lz ma mb mc md me mf mg mh kg mi kh mj kj mk kk ml km mm kn mn mo bi translated">为结果服务</h1><p id="eded" class="pw-post-body-paragraph la lb ja lc b ld mp kb lf lg mq ke li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">你可能想知道“这个交互数据工作室仪表板怎么会这么快？”，或者“将 Data Studio 连接到 BigQuery 的成本是多少”？我们将不得不把这段对话留到以后的文章中，但现在先预览一下:</p><ul class=""><li id="8a86" class="pj pk ja lc b ld le lg lh lj pl ln pm lr pn lv po pp pq pr bi translated">为了<a class="ae lw" href="https://www.youtube.com/watch?v=KG8CpA3m1q4" rel="noopener ugc nofollow" target="_blank">将 Data Studio 连接到用于公共仪表板的 BigQuery，在中间使用一个层</a>。看我和<a class="pc pd ep" href="https://medium.com/u/be4fab220f85?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank"> Minhaz Kazi </a>关于这个话题的对话。</li><li id="231c" class="pj pk ja lc b ld ps lg pt lj pu ln pv lr pw lv po pp pq pr bi translated">我预先生成了所有 4000 万个结果组合——使用 BigQuery 很容易。</li><li id="e557" class="pj pk ja lc b ld ps lg pt lj pu ln pv lr pw lv po pp pq pr bi translated">这 4000 万个结果由云 SQL MySQL 数据库提供服务，该数据库拥有完美的索引，可以快速提供服务。加比会告诉你所有的事情。</li><li id="568a" class="pj pk ja lc b ld ps lg pt lj pu ln pv lr pw lv po pp pq pr bi translated">查看<a class="pc pd ep" href="https://medium.com/u/247b0630b5d6?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank"> Lak Lakshmanan </a>的帖子<a class="ae lw" rel="noopener" target="_blank" href="/how-to-do-online-prediction-with-bigquery-ml-db2248c0ae5">导出并在其他地方使用权重</a>。</li></ul><h1 id="0bb2" class="lx ly ja bd lz ma mb mc md me mf mg mh kg mi kh mj kj mk kk ml km mm kn mn mo bi translated">感谢</h1><p id="3334" class="pw-post-body-paragraph la lb ja lc b ld mp kb lf lg mq ke li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">感谢大家的牛逼点评:<a class="pc pd ep" href="https://medium.com/u/2fccb851bb5e?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">凯西·科济尔科夫</a>、<a class="pc pd ep" href="https://medium.com/u/247b0630b5d6?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">拉克什马南</a>、<a class="pc pd ep" href="https://medium.com/u/899fe8703e05?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">弗兰克·范·普弗伦</a>、<a class="pc pd ep" href="https://medium.com/u/7f2ab73b39f8?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">萨拉·罗宾逊</a>、<a class="pc pd ep" href="https://medium.com/u/ca0215d8d6a4?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">阿布舍克·卡什雅普</a>、<a class="pc pd ep" href="https://medium.com/u/ab8968742b93?source=post_page-----553c24b546a3--------------------------------" rel="noopener" target="_blank">史蒂夫·切里尼</a>。</p><h1 id="5477" class="lx ly ja bd lz ma mb mc md me mf mg mh kg mi kh mj kj mk kk ml km mm kn mn mo bi translated">后续步骤</h1><p id="7c23" class="pw-post-body-paragraph la lb ja lc b ld mp kb lf lg mq ke li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">想要更多的故事？查看我的<a class="ae lw" href="http://medium.com/@hoffa/" rel="noopener">媒体</a>，<a class="ae lw" href="http://twitter.com/felipehoffa" rel="noopener ugc nofollow" target="_blank">关注我的推特</a>，订阅<a class="ae lw" href="https://reddit.com/r/bigquery" rel="noopener ugc nofollow" target="_blank">reddit.com/r/bigquery</a>。试试 BigQuery 吧——每个月你都可以从免费的网站上获得一个完整的万亿字节的分析。</p><div class="io ip gp gr iq px"><a rel="noopener follow" target="_blank" href="/these-are-the-real-stack-overflow-trends-use-the-pageviews-c439903cd1a"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd jb gy z fp qc fr fs qd fu fw iz bi translated">这些是真正的堆栈溢出趋势:使用页面视图</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">直到今天，获得 Stack Overflow 的季度浏览量并不容易。了解如何获得这些…</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">towardsdatascience.com</p></div></div><div class="qg l"><div class="qh l qi qj qk qg ql ky px"/></div></div></a></div></div></div>    
</body>
</html>