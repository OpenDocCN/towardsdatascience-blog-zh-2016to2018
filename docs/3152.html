<html>
<head>
<title>Blockchain Explained in 7 Python Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 7 个 Python 函数解释区块链</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/blockchain-explained-in-7-python-functions-c49c84f34ba5?source=collection_archive---------3-----------------------#2018-04-14">https://towardsdatascience.com/blockchain-explained-in-7-python-functions-c49c84f34ba5?source=collection_archive---------3-----------------------#2018-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fbc0dc9bf11be1775c5e715e50452267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kYh4xY2jM-d64SNi-JM8Vw.jpeg"/></div></div></figure><p id="4026" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我认为对于很多人来说，区块链就是这种现象，很难让你理解。我开始看视频和阅读文章，但对我个人来说，直到我编写了自己的简单区块链，我才真正理解它是什么以及它的潜在应用。</p><p id="b4ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我认为区块链是一个公开的加密数据库。如果你是亚马逊，你想使用这项技术来跟踪你的库存水平，使用区块链有意义吗？可能不会，因为你的客户不想花费他们的资源来验证你的区块链，因为他们在他们的网站上说，“只剩一个了！”，反正。</p><p id="49b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我会让你考虑未来的应用。所以，事不宜迟，让我们设置我们的 7 个功能！</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="4ea7" class="lm ln iq li b gy lo lp l lq lr">def hash_function(k):<br/>    <em class="ls">"""Hashes our transaction."""<br/>    </em>if type(k) is not str:<br/>        k = json.dumps(k, sort_keys=True)<br/><br/>    return hashlib.sha256(k).hexdigest()</span></pre><p id="1f3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">区块链的核心是哈希函数。没有加密，区块链将很容易被操纵，交易将能够被欺骗性地插入。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="e703" class="lm ln iq li b gy lo lp l lq lr">def update_state(transaction, state):<br/>    state = state.copy()<br/><br/>    for key in transaction:<br/>        if key in state.keys():<br/>            state[key] += transaction[key]<br/>        else:<br/>            state[key] = transaction[key]<br/><br/>    return state</span></pre><p id="154e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">“国家”是谁拥有欲望的记录。例如，我有 10 枚硬币，我给了 1 枚给 Medium，那么状态将是下面字典的值。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="a4e5" class="lm ln iq li b gy lo lp l lq lr">{‘transaction’: {‘Tom’: 9, ‘Medium’: 1}}</span></pre><p id="f076" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">需要注意的重要一点是，透支是不能存在的。如果只有 10 枚硬币存在，那么我就不能给别人 11 枚硬币。下面的函数验证我们尝试进行的交易确实有效。此外，交易必须平衡。我不能给 5 个硬币，而让接受者收到 4 个硬币，因为这将允许硬币的破坏和创造。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="5ffc" class="lm ln iq li b gy lo lp l lq lr">def valid_transaction(transaction, state):<br/>    <em class="ls">"""A valid transaction must sum to 0."""<br/>    </em>if sum(transaction.values()) is not 0:<br/>        return False<br/><br/>    for key in transaction.keys():<br/>        if key in state.keys():<br/>            account_balance = state[key]<br/>        else:<br/>            account_balance = 0<br/><br/>        if account_balance + transaction[key] &lt; 0:<br/>            return False<br/><br/>    return True</span></pre><p id="5a90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以走了。读取来自前一个块的信息，并用于将其链接到新的块。这也是区块链思想的核心。看似有效的事务可以被尝试欺骗性地插入到区块链中，但是解密所有先前的块在计算上(几乎)是不可能的，这保持了区块链的完整性。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="90ca" class="lm ln iq li b gy lo lp l lq lr">def make_block(transactions, chain):<br/>    <em class="ls">"""Make a block to go into the chain."""<br/>    </em>parent_hash = chain[-1]['hash']<br/>    block_number = chain[-1]['contents']['block_number'] + 1<br/><br/>    block_contents = {<br/>        'block_number': block_number,<br/>        'parent_hash': parent_hash,<br/>        'transaction_count': block_number + 1,<br/>        'transaction': transactions<br/>    }<br/><br/>    return {'hash': hash_function(block_contents), 'contents': block_contents}</span></pre><p id="296a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个小的帮助函数，用于检查前一个块的哈希:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="589f" class="lm ln iq li b gy lo lp l lq lr">def check_block_hash(block):<br/>    expected_hash = hash_function(block['contents'])<br/><br/>    if block['hash'] is not expected_hash:<br/>        raise<br/><br/>    return</span></pre><p id="6158" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我们把所有的东西都组装在一起，就到了创建积木的时候了。我们现在将更新区块链。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="0e01" class="lm ln iq li b gy lo lp l lq lr">def check_block_validity(block, parent, state):<br/>    parent_number = parent['contents']['block_number']<br/>    parent_hash = parent['hash']<br/>    block_number = block['contents']['block_number']<br/><br/>    for transaction in block['contents']['transaction']:<br/>        if valid_transaction(transaction, state):<br/>            state = update_state(transaction, state)<br/>        else:<br/>            raise<br/><br/>    check_block_hash(block)  # Check hash integrity<br/><br/>    if block_number is not parent_number + 1:<br/>        raise<br/><br/>    if block['contents']['parent_hash'] is not parent_hash:<br/>        raise<br/><br/>    return state</span></pre><p id="c17a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们结束之前，必须验证链条:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="b1d4" class="lm ln iq li b gy lo lp l lq lr">def check_chain(chain):<br/>    <em class="ls">"""Check the chain is valid."""<br/>    </em>if type(chain) is str:<br/>        try:<br/>            chain = json.loads(chain)<br/>            assert (type(chain) == list)<br/>        except ValueError:<br/>            # String passed in was not valid JSON<br/>            return False<br/>    elif type(chain) is not list:<br/>        return False<br/><br/>    state = {}<br/><br/>    for transaction in chain[0]['contents']['transaction']:<br/>        state = update_state(transaction, state)<br/><br/>    check_block_hash(chain[0])<br/>    parent = chain[0]<br/><br/>    for block in chain[1:]:<br/>        state = check_block_validity(block, parent, state)<br/>        parent = block<br/><br/>    return state</span></pre><p id="446b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，需要一个事务函数，它将上述所有内容联系在一起:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="d6cc" class="lm ln iq li b gy lo lp l lq lr">def add_transaction_to_chain(transaction, state, chain):<br/>    if valid_transaction(transaction, state):<br/>        state = update_state(transaction, state)<br/>    else:<br/>        raise Exception('Invalid transaction.')<br/><br/>    my_block = make_block(state, chain)<br/>    chain.append(my_block)<br/><br/>    for transaction in chain:<br/>        check_chain(transaction)<br/><br/>    return state, chain</span></pre><p id="d152" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了 7 个函数。我们如何与之互动？嗯，首先我们需要从一个<em class="ls"> Genesis 模块开始我们的链。</em>这就是我们新硬币(或股票库存等)的诞生。为了这篇文章的目的，我会说我，汤姆，将从 10 个硬币开始。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="5c6a" class="lm ln iq li b gy lo lp l lq lr">genesis_block = {<br/>    'hash': hash_function({<br/>        'block_number': 0,<br/>        'parent_hash': None,<br/>        'transaction_count': 1,<br/>        'transaction': [{'Tom': 10}]<br/>    }),<br/>    'contents': {<br/>        'block_number': 0,<br/>        'parent_hash': None,<br/>        'transaction_count': 1,<br/>        'transaction': [{'Tom': 10}]<br/>    },<br/>}<br/><br/>block_chain = [genesis_block]<br/>chain_state = {'Tom': 10}</span></pre><p id="2ae0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，看看当我给 Medium 一些硬币时会发生什么:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="20b7" class="lm ln iq li b gy lo lp l lq lr">chain_state, block_chain = add_transaction_to_chain(transaction={'Tom': -1, 'Medium': 1}, state=chain_state, chain=block_chain)</span></pre><p id="205e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">状态会更新以显示谁拥有什么:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="80dc" class="lm ln iq li b gy lo lp l lq lr">{'Medium': 1, 'Tom': 9}</span></pre><p id="d377" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">区块链看起来像这样:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="a1c2" class="lm ln iq li b gy lo lp l lq lr">[{'contents': {'block_number': 0,<br/>               'parent_hash': None,<br/>               'transaction': [{'Tom': 10}],<br/>               'transaction_count': 1},<br/>  'hash': '064d0b480b3b92761f31831d30ae9f01954efaa62371b4b44f11465ec22abe93'},<br/> {'contents': {'block_number': 1,<br/>               'parent_hash': '064d0b480b3b92761f31831d30ae9f01954efaa62371b4b44f11465ec22abe93',<br/>               'transaction': {'Medium': 1, 'Tom': 9},<br/>               'transaction_count': 2},<br/>  'hash': 'b4ae25f0cc0ee0b0caa66b9a3473e9a108652d53b1dc22a40962fef5c8c0f08c'}]</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="a32a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的第一个新事务已经被创建并插入到堆栈的顶部。现在，我希望我已经激起了您的好奇心，并对复制代码并使用它感兴趣。在我看来，这是学习新技术的最好方法——深入其中。</p><p id="8a7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">玩代码，做你自己的硬币。如果你试着给更多的硬币会发生什么？如果你继续创造新的受款人，州政府会怎么样？</p><p id="50c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你能想到区块链未来的应用吗？欢迎在评论中问我任何问题，我会尽力帮助你。</p></div></div>    
</body>
</html>