<html>
<head>
<title>How do we find daily good deals online, automatically?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何在网上自动找到每天的好交易？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-do-we-find-daily-good-deals-online-automatically-fe8cfc8f783a?source=collection_archive---------0-----------------------#2017-01-07">https://towardsdatascience.com/how-do-we-find-daily-good-deals-online-automatically-fe8cfc8f783a?source=collection_archive---------0-----------------------#2017-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/2473a528a0a007fce924cb9f757030d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVSQPzUI8Kcj35d_Fk1lZg.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="294d" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">使用 R 进行基本的 web 内容抓取，以自动化枯燥的任务</h2></div><blockquote class="kq kr ks"><p id="2370" class="kt ku kv kw b kx ky kc kz la lb kf lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">背景</p></blockquote><p id="1cd9" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">正如这里所定义的那样，“数据科学家比任何软件工程师都更擅长统计，比任何统计学家都更擅长软件工程。”因此，这篇博客文章重点关注 web 内容废弃的实践，这是数据科学家在结构化数据库之外获取信息的一项基本技能，当 API 不可用时。</p><p id="8148" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">当在网上寻找好的交易时，我们经常去一些电子商务网站查看我们想要的商品的价格。过了一段时间，这就变成了一项乏味的任务。受<a class="ae lt" href="https://hackernoon.com/the-programmers-guide-to-booking-a-plane-11e37d610045#.z50j983vh" rel="noopener ugc nofollow" target="_blank"> <em class="kv">程序员预订飞机指南</em> </a>的启发，Zeke 在 Node 中编写了一个脚本来自动完成寻找廉价机票的过程，我们想在好的 MacBook 交易中复制他的方法，使用 r</p><blockquote class="kq kr ks"><p id="00d9" class="kt ku kv kw b kx ky kc kz la lb kf lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">目标</p></blockquote><p id="5b41" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">目的是当 MacBook 价格跌至某个点以下时，可以收到自动电子邮件提醒。</p><blockquote class="kq kr ks"><p id="e752" class="kt ku kv kw b kx ky kc kz la lb kf lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">方法</p></blockquote><ol class=""><li id="0514" class="lu lv jb kw b kx ky la lb lq lw lr lx ls ly lp lz ma mb mc bi translated"><strong class="kw jc">从电子商务网站上删除产品信息</strong></li></ol><p id="72e0" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">我们需要首先加载网站的 html 结构，以便检索我们需要的信息。我们将使用的 R 包是<em class="kv"> rvest </em>。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e7cc" class="mm mn jb mi b gy mo mp l mq mr">library(rvest)<br/>library(XML)</span><span id="97e2" class="mm mn jb mi b gy ms mp l mq mr">#save html of URL<br/>url &lt;- "<a class="ae lt" href="http://www.rakuten.com.tw/category/4945/?p=1&amp;l-id=tw_pagen_1" rel="noopener ugc nofollow" target="_blank">http://www.rakuten.com.tw/category/4945/?p=1&amp;l-id=tw_pagen_1</a>"</span></pre><p id="be55" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">保存 URL html 后，我们需要通过检查页面源代码来找到我们需要的信息部分。我们将搜索价格以导航到产品相关信息，如下所示。</p><figure class="md me mf mg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/60c6b6af7e77c353209cd1c7b0223253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sff7wJgMYMqTyk0qJ_ap4g.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Screenshot of the page source</figcaption></figure><p id="af70" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">我们注意到产品相关信息在<br/><strong class="kw jc">&lt;div class = " b-content "&gt;</strong><br/>下，因此我们将只提取这一部分。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="82ee" class="mm mn jb mi b gy mo mp l mq mr">product &lt;- url %&gt;%<br/>  read_html() %&gt;%<br/>  html_nodes(".b-content")</span></pre><p id="8afc" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">一个优秀的 Chrome 插件叫做<strong class="kw jc"> SelectorGadget </strong>可以在这里下载<a class="ae lt" href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb?hl=en" rel="noopener ugc nofollow" target="_blank">。这个工具可以让我们直观地选择我们想要的具体内容。</a></p><p id="4218" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">当我们选择产品名称时，内容将以绿色突出显示，如下所示。该工具还猜测我们还需要其他产品名称，因此它会用黄色突出显示其他产品名称。对于我们不需要的任何内容，我们可以单击它，它将被删除(颜色将变为红色)。</p><figure class="md me mf mg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/61a40dce22390baafe46a5bebf8bb703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13P2YG4PHIvNPxxxNDIYww.png"/></div></div></figure><p id="3882" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">我们发现可以使用<strong class="kw jc">提取产品名称。产品名称</strong>，如页面底部所示。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7a6d" class="mm mn jb mi b gy mo mp l mq mr">name &lt;- product %&gt;%<br/>  html_nodes(".product-name") %&gt;%<br/>  html_text()</span></pre><p id="8864" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">接下来，我们将重复这个过程来查找价格并以数字格式保存它。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e910" class="mm mn jb mi b gy mo mp l mq mr">price &lt;- product %&gt;%<br/>  html_nodes(".b-underline .b-text-prime") %&gt;%<br/>  html_text() %&gt;%<br/>  gsub(",","",.) %&gt;%<br/>  as.numeric()</span></pre><p id="8114" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">完成后，我们可以将名称和价格保存在一个数据帧中。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2a2d" class="mm mn jb mi b gy mo mp l mq mr">all &lt;- data.frame(name, price,stringsAsFactors = FALSE)</span></pre><p id="3eb2" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">我们还需要删除多个页面来提取所有信息。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8cd1" class="mm mn jb mi b gy mo mp l mq mr">for (i in 1:10){<br/>starturl &lt;- "<a class="ae lt" href="http://www.rakuten.com.tw/category/4945/?p=" rel="noopener ugc nofollow" target="_blank">http://www.rakuten.com.tw/category/4945/?p=</a>"<br/>nexturl &lt;- "&amp;l-id=tw_pagen_"<br/>url &lt;- paste(starturl,i,nexturl,i,sep="")</span><span id="3e8c" class="mm mn jb mi b gy ms mp l mq mr">product &lt;- url %&gt;%<br/>  read_html() %&gt;%<br/>  html_nodes(".b-content")</span><span id="55f1" class="mm mn jb mi b gy ms mp l mq mr">name &lt;- product %&gt;%<br/>  html_nodes(".product-name") %&gt;%<br/>  html_text()</span><span id="e52c" class="mm mn jb mi b gy ms mp l mq mr">price &lt;- product %&gt;%<br/>  html_nodes(".b-underline .b-text-prime") %&gt;%<br/>  html_text() %&gt;%<br/>  gsub(",","",.) %&gt;%<br/>  as.numeric()</span><span id="75a2" class="mm mn jb mi b gy ms mp l mq mr">mydata &lt;- data.frame(name, price,stringsAsFactors = FALSE)<br/>all &lt;- rbind(all,mydata)<br/>}</span><span id="b9a8" class="mm mn jb mi b gy ms mp l mq mr">all&lt;-all[!duplicated(all),]</span></pre><p id="eee5" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">最终结果以 dataframe 格式存储在下面。</p><figure class="md me mf mg gt is gh gi paragraph-image"><div class="gh gi my"><img src="../Images/a25ad4148bfdebed39172700d81e17ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*CSA61earMGgZjM_u8CSBZA.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Screenshot of the scrapped prices on MacBooks</figcaption></figure><p id="e435" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated"><strong class="kw jc"> 2。创建发送电子邮件提醒的规则</strong></p><p id="2504" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">接下来，我们将设置接收电子邮件提醒的规则。假设我们只希望收到价格在新台币 25，000 元到新台币 30，000 元之间的产品的警报。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="6db8" class="mm mn jb mi b gy mo mp l mq mr">alert &lt;- all[all$price&gt;25000&amp;all$price&lt;=30000,]</span></pre><p id="a168" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">接下来，如果至少有一个警报，我们将使用<em class="kv"> mailR </em>包发送电子邮件，如下所示。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="93b1" class="mm mn jb mi b gy mo mp l mq mr">if (nrow(alert) &gt;=1){</span><span id="53f8" class="mm mn jb mi b gy ms mp l mq mr">write.table(alert,"alert.txt",fileEncoding = "UTF-8")</span><span id="d635" class="mm mn jb mi b gy ms mp l mq mr">send.mail(from = "<a class="ae lt" href="mailto:jchen6912@gmail.com" rel="noopener ugc nofollow" target="_blank">jchen6912@gmail.com</a>",<br/>          to = c("<a class="ae lt" href="mailto:jchen6912@gmail.com" rel="noopener ugc nofollow" target="_blank">jchen6912@gmail.com</a>"),<br/>          subject = "Mac Deal Alert",<br/>          body &lt;- "alert.txt",<br/>          smtp = list(host.name = "smtp.gmail.com", port = 465, user.name = "<a class="ae lt" href="mailto:jchen6912@gmail.com" rel="noopener ugc nofollow" target="_blank">jchen6912@gmail.com</a>", passwd = "xxxxxxxx", ssl = TRUE),<br/>          encoding = "utf-8",<br/>          authenticate = TRUE,<br/>          send = TRUE)<br/>}</span></pre><figure class="md me mf mg gt is gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/850f4c5fb417ef52be0da4c1eef10556.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*If07soGQ43YmQ_fGIGdJXA.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Screenshot of the automatic email alert received</figcaption></figure><p id="8ff4" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated"><strong class="kw jc"> 3。通过定期安排任务来自动化流程</strong></p><p id="91cf" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">这可以通过<em class="kv"> taskscheduleR </em>包来完成，但是目前只在 Windows 中可用。点击<a class="ae lt" href="https://github.com/bnosac/taskscheduleR" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多详情。我们可以安排 Rscript 以所需的频率运行，并相应地接收自动警报。</p><figure class="md me mf mg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/73211b87e5919789aa00b9d1c4776fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yTD4zDA4GY1BLLXrVi1ZWg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Screenshot of the UI in taskscheduleR</figcaption></figure><p id="7885" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi translated">这总结了关于如何为静态内容的网站删除内容的简短博客，然而，动态网站更复杂，可能需要额外的代码来模拟真实的浏览行为，如会员登录和表单提交。或者，类似的任务也可以用 Python 中的<em class="kv"> scrapy </em>和<em class="kv"> BeautifulSoup </em>来执行。</p><blockquote class="kq kr ks"><p id="dd0f" class="kt ku kv kw b kx ky kc kz la lb kf lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">r 代码</p></blockquote><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1dbf" class="mm mn jb mi b gy mo mp l mq mr">library(rvest)<br/>library(XML)<br/>library(taskscheduleR)<br/>library(mailR)</span><span id="7884" class="mm mn jb mi b gy ms mp l mq mr">setwd("~/Desktop/deals")</span><span id="aab7" class="mm mn jb mi b gy ms mp l mq mr">url &lt;- "<a class="ae lt" href="http://www.rakuten.com.tw/category/4945/?p=1&amp;l-id=tw_pagen_1" rel="noopener ugc nofollow" target="_blank">http://www.rakuten.com.tw/category/4945/?p=1&amp;l-id=tw_pagen_1</a>"<br/>product &lt;- url %&gt;%<br/>  read_html() %&gt;%<br/>  html_nodes(".b-content")</span><span id="5107" class="mm mn jb mi b gy ms mp l mq mr">name &lt;- product %&gt;%<br/>  html_nodes(".product-name") %&gt;%<br/>  html_text()</span><span id="c78b" class="mm mn jb mi b gy ms mp l mq mr">price &lt;- product %&gt;%<br/>  html_nodes(".b-underline .b-text-prime") %&gt;%<br/>  html_text() %&gt;%<br/>  gsub(",","",.) %&gt;%<br/>  as.numeric()</span><span id="4e31" class="mm mn jb mi b gy ms mp l mq mr">all &lt;- data.frame(name, price,stringsAsFactors = FALSE)</span><span id="eac7" class="mm mn jb mi b gy ms mp l mq mr">for (i in 1:10){<br/>starturl &lt;- "<a class="ae lt" href="http://www.rakuten.com.tw/category/4945/?p=" rel="noopener ugc nofollow" target="_blank">http://www.rakuten.com.tw/category/4945/?p=</a>"<br/>nexturl &lt;- "&amp;l-id=tw_pagen_"<br/>url &lt;- paste(starturl,i,nexturl,i,sep="")</span><span id="827e" class="mm mn jb mi b gy ms mp l mq mr">product &lt;- url %&gt;%<br/>  read_html() %&gt;%<br/>  html_nodes(".b-content")</span><span id="74c8" class="mm mn jb mi b gy ms mp l mq mr">name &lt;- product %&gt;%<br/>  html_nodes(".product-name") %&gt;%<br/>  html_text()</span><span id="c448" class="mm mn jb mi b gy ms mp l mq mr">price &lt;- product %&gt;%<br/>  html_nodes(".b-underline .b-text-prime") %&gt;%<br/>  html_text() %&gt;%<br/>  gsub(",","",.) %&gt;%<br/>  as.numeric()</span><span id="9897" class="mm mn jb mi b gy ms mp l mq mr">mydata &lt;- data.frame(name, price,stringsAsFactors = FALSE)<br/>all &lt;- rbind(all,mydata)<br/>}</span><span id="ae6f" class="mm mn jb mi b gy ms mp l mq mr">all&lt;-all[!duplicated(all),]</span><span id="dc2f" class="mm mn jb mi b gy ms mp l mq mr">alert &lt;- all[all$price&gt;25000&amp;all$price&lt;=30000,]</span><span id="f887" class="mm mn jb mi b gy ms mp l mq mr">if (nrow(alert) &gt;=1){</span><span id="8948" class="mm mn jb mi b gy ms mp l mq mr">write.table(alert,"alert.txt",fileEncoding = "UTF-8")</span><span id="87c4" class="mm mn jb mi b gy ms mp l mq mr">send.mail(from = "<a class="ae lt" href="mailto:jchen6912@gmail.com" rel="noopener ugc nofollow" target="_blank">jchen6912@gmail.com</a>",<br/>          to = c("<a class="ae lt" href="mailto:jchen6912@gmail.com" rel="noopener ugc nofollow" target="_blank">jchen6912@gmail.com</a>"),<br/>          subject = "Mac Deal Alert",<br/>          body &lt;- "alert.txt",<br/>          smtp = list(host.name = "smtp.gmail.com", port = 465, user.name = "<a class="ae lt" href="mailto:jchen6912@gmail.com" rel="noopener ugc nofollow" target="_blank">jchen6912@gmail.com</a>", passwd = "xxxxxxxx", ssl = TRUE),<br/>          encoding = "utf-8",<br/>          authenticate = TRUE,<br/>          send = TRUE)<br/>}</span></pre></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="2f5e" class="pw-post-body-paragraph kt ku jb kw b kx ky kc kz la lb kf lc lq le lf lg lr li lj lk ls lm ln lo lp ij bi ni translated"><span class="l nj nk nl bm nm nn no np nq di">问</span>有什么问题、意见或顾虑吗？<br/>jchen6912@gmail.com</p></div></div>    
</body>
</html>