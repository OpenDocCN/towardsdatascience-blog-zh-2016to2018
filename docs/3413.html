<html>
<head>
<title>World Models in TensorFlow — Episode 1.0 — OpenAi Gym Race Car</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow 中的世界模型—第 1.0 集— OpenAi 健身房赛车</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/world-models-in-tensorflow-episode-1-2b3c217ebc8f?source=collection_archive---------8-----------------------#2018-05-09">https://towardsdatascience.com/world-models-in-tensorflow-episode-1-2b3c217ebc8f?source=collection_archive---------8-----------------------#2018-05-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a351b71b0e7ee687f6aa9cd08236a7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5s81cBD3mhXNq6u6PLz05A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Creative Common License</figcaption></figure><div class=""/><blockquote class="kc kd ke"><p id="9891" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">代理人能了解他们自己的梦吗？</p></blockquote><p id="10ec" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">论文开头的这一句话立刻引起了我的注意。<br/>如果你还没有读过这篇文章，我肯定会推荐它，因为它令人兴奋，而且对理解本文的内容是必要的。</p><h2 id="5fb2" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">让我们实施它</h2><p id="5e99" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">每当我偶然发现一些有趣的事情时，我总是试图自己去实现它。</p><p id="f22a" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">据我所知，我是第二个分享本文实现的人。<br/>大卫·福斯特写了一篇非常好的<a class="ae lh" href="https://medium.com/applied-data-science/how-to-build-your-own-world-model-using-python-and-keras-64fb388ba459" rel="noopener">博文</a>，他在博文中一步步解释了他在 Keras 的实施。<br/>然而，最有趣的部分——<em class="kh">机器的梦想</em>😴<em class="kh"> </em> —缺失。</p><p id="6a0b" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">这一系列文章的目标是更深入地阅读 TensorFlow 中的代码，并在阅读过程中学习(与读者一起)。</p><p id="b14e" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">我不会重新解释这个想法和方法，因为它们已经在最初的<a class="ae lh" href="https://arxiv.org/abs/1803.10122" rel="noopener ugc nofollow" target="_blank">论文</a>和作者写的博客中很好地覆盖了。</p><div class="ip iq gp gr ir mg"><a href="https://worldmodels.github.io/" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd jg gy z fp ml fr fs mm fu fw je bi translated">世界模特</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">互动演示:点击屏幕以覆盖代理的决定。我们探索建立生成神经网络模型的…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">worldmodels.github.io</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu ix mg"/></div></div></a></div><h2 id="bcb0" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">OpenAi 健身赛车</h2><p id="0e81" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">这个任务的目标是训练一个代理在模拟的轨道上驾驶汽车。代理可以看到一个 96x96 的 RGB 像素网格，以及比赛完成后的最终奖励。</p><p id="f38a" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">代理可以通过决定转向角度[-1，1]→[左，右]，加速和刹车来控制汽车。</p><h2 id="354d" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">代理人如何看待世界🤖</h2><p id="2e38" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">首先要解决的是让代理人有可能以一种有意义的方式看到他们生活的世界。</p><p id="2eea" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">作者使用<a class="ae lh" href="https://arxiv.org/abs/1606.05908" rel="noopener ugc nofollow" target="_blank">变分自动编码器</a> - <em class="kh"> VAE </em> -将每一帧的信息压缩成大小为 32 的向量。<br/>(如果你还没看过，可以看看我的另一篇文章<a class="ae lh" rel="noopener" target="_blank" href="/generating-digits-and-sounds-with-artificial-neural-nets-ca1270d8445f">用人工神经网络生成数字和声音</a>使用 VAEs。)</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d67190231e6ebede403353efe154d356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/1*JrFVgEKbRqjaoML8ClWweA.gif"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Left: What the human sees — Right: What the agent sees (Image created by the author)</figcaption></figure><h2 id="4667" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">获取代码</h2><p id="5110" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">让我们从克隆我的回购代码开始:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="a396" class="li lj jf nb b gy nf ng l nh ni">git clone <a class="ae lh" href="https://github.com/dariocazzani/World-Models-TensorFlow" rel="noopener ugc nofollow" target="_blank">https://github.com/dariocazzani/World-Models-TensorFlow</a></span></pre><p id="1685" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">将所有依赖项(只需按照<a class="ae lh" href="https://github.com/dariocazzani/World-Models-TensorFlow/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件</a>和<em class="kh">光盘</em>安装到 VAE 文件夹中:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="f371" class="li lj jf nb b gy nf ng l nh ni">cd <a class="ae lh" href="https://github.com/dariocazzani/World-Models-TensorFlow/tree/master/stateless_agent" rel="noopener ugc nofollow" target="_blank">stateless_agent/</a></span></pre><h2 id="6226" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">VAE 的数据</h2><p id="c99a" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">首先要做的是生成数据来训练 VAE，这就是<a class="ae lh" href="https://github.com/dariocazzani/World-Models-TensorFlow/blob/master/01-VAE/generate-VAE-data.py" rel="noopener ugc nofollow" target="_blank"> <em class="kh">生成-VAE-data.py </em> </a> <em class="kh"> </em>脚本的作用。<br/>在运行它之前，让我们先看看几件事:</p><p id="6fa6" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">如果您有一台带有多个 CPU 的机器，这两行代码将加快整个过程。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4a4d" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">这里有一个小技巧来迫使环境将汽车定位在赛道上的任意点:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="39ee" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">现在运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="fc93" class="li lj jf nb b gy nf ng l nh ni">mkdir -p ../data<br/>python generate-VAE-data.py</span></pre><p id="d4ee" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">所有的数据将被放置在根文件夹下的文件夹<em class="kh"> data </em>中。</p><h2 id="5481" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">自动编码器</h2><p id="0670" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">作者提供了他们使用的 VAE 的详细描述，因此在 TensorFlow 中对其进行编码非常简单。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9c44" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">该脚本与 VAE 架构的定义一起提供了两个主要功能:</p><ol class=""><li id="b2bd" class="nl nm jf ki b kj kk kn ko le nn lf no lg np ld nq nr ns nt bi translated"><strong class="ki jg"> train_vae() </strong>会加载一个已保存的模型(如果存在)或者从头开始，训练直到损耗低于一个定义的值(我是凭经验挑的)。</li><li id="2aa3" class="nl nm jf ki b kj nu kn nv le nw lf nx lg ny ld nq nr ns nt bi translated"><strong class="ki jg">代理将使用 load_vae() </strong>将每一帧编码成一个嵌入向量。</li></ol><h2 id="1fa8" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">训练 VAE</h2><p id="602f" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">要开始训练变分自动编码器，只需运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="30be" class="li lj jf nb b gy nf ng l nh ni">python train_vae.py</span></pre><p id="adcc" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">并且在另一个终端中</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="1257" class="li lj jf nb b gy nf ng l nh ni">tensorboard --logdir logdir</span></pre><p id="00cd" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">在我装有 Nvidia Geforce Titan X 的机器上，只需要几分钟就可以完成。<br/>在 tensorboard URL 上打开浏览器，检查自动编码器是否正常工作。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nz"><img src="../Images/a8feb85835d486ea8c31db89caeea02c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hrgt4FcxKDEHtACQNzmAIw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Image created by the author</figcaption></figure><h2 id="fba7" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">现在有趣的部分来了:让我们学开车吧！</h2><p id="e2d5" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">为了驾驶汽车，代理需要输出 3 个值:</p><ul class=""><li id="2218" class="nl nm jf ki b kj kk kn ko le nn lf no lg np ld oa nr ns nt bi translated">转向角</li><li id="bcc2" class="nl nm jf ki b kj nu kn nv le nw lf nx lg ny ld oa nr ns nt bi translated">加速度值</li><li id="dd2a" class="nl nm jf ki b kj nu kn nv le nw lf nx lg ny ld oa nr ns nt bi translated">制动值</li></ul><p id="fb84" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">我假设刹车时加速是没有意义的，所以代理只需输出 2 个参数，这将减少 1/3 的学习参数。</p><p id="9d7b" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">因为动作仅依赖于当前观察，所以参数的数量为:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="31ab" class="li lj jf nb b gy nf ng l nh ni">Embedding_size * 2 + bias = 66</span></pre><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="dbb2" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">训练使用<a class="ae lh" href="https://github.com/CMA-ES/pycma" rel="noopener ugc nofollow" target="_blank"> CMA-ES </a>学习 66 个参数。作者说他们使用了 64 种药物，每种药物都在 16 次试验中进行了评估。因为我们还没有解决高级问题(RNN 的状态被输入到控制器中)，为了加速训练，我把数字保持得较低。</p><p id="2d71" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">当我完成完整的解决方案时，这些数字将会改变。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="fa06" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">每个代理运行在不同的进程中，他们得到的回报是 12 次尝试的平均值。作者之一大卫·哈在他的博客<a class="ae lh" href="http://blog.otoro.net/2017/11/12/evolving-stable-strategies/" rel="noopener ugc nofollow" target="_blank">进化稳定策略</a>中很好地解释了为什么需要多次试验。</p><p id="5688" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">最后，运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="6e43" class="li lj jf nb b gy nf ng l nh ni">python <a class="ae lh" href="https://github.com/dariocazzani/World-Models-TensorFlow/blob/master/01-VAE/train-agents.py" rel="noopener ugc nofollow" target="_blank">train-agents.py</a></span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/001ec9e84c553b2316d872f4c07036cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*233wgjH_M-Kt9ktidayBLA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Image created by the author</figcaption></figure><p id="2537" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">并且等待…</p><h2 id="0ef9" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">几个小时后…</h2><p id="b836" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">在我有 16 个 CPU 的机器上，我必须等待几个小时才能得到不错的结果。<br/>差不多 100 代之后，最好的代理平均能拿到~740 的奖励。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/9cd923ad42c6d6e9327d42e99fc32294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*nGnSe4I19z1evP8F31Mu2Q.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Image created by the author</figcaption></figure><h2 id="46de" class="li lj jf bd lk ll lm dn ln lo lp dp lq le lr ls lt lf lu lv lw lg lx ly lz ma bi translated">下一步是什么？</h2><p id="4990" class="pw-post-body-paragraph kf kg jf ki b kj mb kl km kn mc kp kq le md kt ku lf me kx ky lg mf lb lc ld ij bi translated">特工们的驾驶风格相当古怪。他们对之前发生的事情没有记忆，也没有能力预测采取某种行动后汽车会在哪里。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2b95b29c86bebff6b4bb3fda966fcb78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/1*CBgl4DV_lNS8lUeZF9zHzg.gif"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Image created by the author</figcaption></figure><p id="5be2" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">在下一篇文章中，我将介绍如何训练 RNN，让它学会每一帧的潜在空间如何随着时间的推移和不同的动作而演变。</p><p id="ffa1" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">敬请关注，请在下面留下评论或提问😊</p></div></div>    
</body>
</html>