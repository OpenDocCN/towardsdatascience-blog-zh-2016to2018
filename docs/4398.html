<html>
<head>
<title>Named Entity Recognition using the Enron Email Dataset in Python: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 中的 Enron 电子邮件数据集识别命名实体:第 2 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/named-entity-recognition-using-the-enron-email-dataset-in-python-part-2-fb7ce69bc473?source=collection_archive---------13-----------------------#2018-08-13">https://towardsdatascience.com/named-entity-recognition-using-the-enron-email-dataset-in-python-part-2-fb7ce69bc473?source=collection_archive---------13-----------------------#2018-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a9f4a1f0bd3145e104d8a8900ecc4295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8JHMzCDrb7ezt8bzw4CFjQ.png"/></div></div></figure><p id="24df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上一次，我们从安然电子邮件数据集中选出了前 20 个最多发邮件的人。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/63dee9cf00c7f24fcc9258d6be6129e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bNCnKwm44vCKGeDd1bwHUA.png"/></div></div></figure><p id="d280" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">他们是谁？在这份 20 人名单中，至少有两人(约翰·阿诺德和埃里克巴斯)曾经或已经成为对冲基金经理。对于一家破产公司的校友来说，这并不坏，因为有一篇关于这家公司的文章。我个人也曾和安然的前雇员一起工作过，我只和他们有过顶级的经历。</p><p id="d2de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">别管历史，让我们进入数据科学。</p><h1 id="2253" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">分散文本</h1><p id="dc9b" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">https://github.com/JasonKessler/scattertext<a class="ae lb" href="https://github.com/JasonKessler/scattertext" rel="noopener ugc nofollow" target="_blank"/></p><p id="5ba0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">分散文本最初是通过将一个类别与另一个类别进行比较(如共和党人与民主党人)，来找到“非常常见”的单词。相反，我在自己的案例中使用它来比较每个电子邮件发件人与所有其他发件人；一个对所有，而不是一个对一个。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/e0b047f7b2e90cdff91bb864d3d024d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dCg-ylp55ComwsFh"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">This is from the github readme, that gives just one example of the visualization power of this tool.</figcaption></figure><p id="b236" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，我选择不使用可视化工具，而只使用 Pythonic API，它公开了每个类别(在我们的例子中是电子邮件发件人)的 F 分数的计算。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/ae44643655b1d6923cb28bf93296ca4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*koyTIn9W2da6qqLuMLYOpQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">F-scores for each email sender, sorted by top F-scores from “other” category</figcaption></figure><p id="1b5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代码如下:</p><pre class="kx ky kz la gt ml mm mn mo aw mp bi"><span id="ff7a" class="mq ld iq mm b gy mr ms l mt mu">nlp = spacy.load('en')</span><span id="87ed" class="mq ld iq mm b gy mv ms l mt mu">corpus = st.CorpusFromPandas(df_parsed.sample(10000), <br/>                              category_col='FromCat', <br/>                              text_col='Body',<br/>                              nlp=nlp).build()</span><span id="3519" class="mq ld iq mm b gy mv ms l mt mu">scaled_f_scores_vs_background = corpus.get_scaled_f_scores_vs_background()</span><span id="2d6d" class="mq ld iq mm b gy mv ms l mt mu">term_freq_df = corpus.get_term_freq_df()</span><span id="3035" class="mq ld iq mm b gy mv ms l mt mu">for c in term_freq_df:<br/>    f = c[:c.find(' freq')]<br/>    term_freq_df[f+' fscore'] = corpus.get_scaled_f_scores(f)</span><span id="3523" class="mq ld iq mm b gy mv ms l mt mu">columns = pd.Series([x[:x.find(' ')] for x in term_freq_df.columns]).drop_duplicates()</span><span id="2010" class="mq ld iq mm b gy mv ms l mt mu">term_freq_df.columns = pd.MultiIndex.from_product([['freq','fscore'],columns])</span><span id="0588" class="mq ld iq mm b gy mv ms l mt mu">term_freq_df.loc[:,'fscore'].sort_values('other',ascending=False).iloc[:200].to_excel('fscores.xlsx')</span></pre><p id="3ed9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，你可以<em class="mw">种</em>开始看到人们之间的关系，通过他们的“不寻常的共同”的话，但它不是那么漂亮或有用。因此，我们将尝试通过从每封电子邮件中提取命名实体来总结电子邮件，然后使用网络图将顶级实体链接在一起。</p><h1 id="2a51" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">命名实体识别</h1><p id="f2a3" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">至少有三个流行的 python 库具有 NER 功能:1)s<a class="ae lb" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank">paCy</a>2)<a class="ae lb" href="http://polyglot.readthedocs.io/en/latest/NamedEntityRecognition.html" rel="noopener ugc nofollow" target="_blank">polyglot</a>和 3) <a class="ae lb" href="https://stanfordnlp.github.io/CoreNLP/tutorials.html" rel="noopener ugc nofollow" target="_blank"> Stanford 的 CoreNLP </a>。</p><p id="cd90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在这个项目中尝试使用 spaCy 和 polyglot，但最终选择了 polyglot，因为它的结果更直观。Polyglot 只将实体分为 I-LOC、I-ORG 和 I-PER，而 spaCy 有更多的类别，如数字、日期等。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="afc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该代码使用 dask 进行多重处理，在数据帧中添加了一个新的“实体”列。</p><p id="0ab3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们按照前 20 名电子邮件发件人(FromCat)进行分组，并找到他们最常见的实体。下面是一个输出示例:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/ed6c412c617024540c3d67936bcf4619.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*oKmVF3VLoGcCCUr9P1TUrQ.png"/></div></figure><h1 id="51c0" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">网络图可视化</h1><p id="ee40" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">好吧。我们真的很亲密。网络图需要节点和边。我们有一个流行实体表，按前 20 名电子邮件发件人分组。因此，在我们的例子中，节点(或者图上的气泡)将是<strong class="ka ir">和</strong>实体<em class="mw">以及</em>电子邮件发送者。为了区分它们，我们将发件人涂成黄色。边将是从每个发送者到他们各自实体的连接。比如上面的克里斯德国，像安然、加州、杰夫、德州等词。会和他联系在一起。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="61eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Nodes.json 示例</p><pre class="kx ky kz la gt ml mm mn mo aw mp bi"><span id="7b4e" class="mq ld iq mm b gy mr ms l mt mu">[{"id":0,"label":"<a class="ae lb" href="mailto:chris.germany@enron.com" rel="noopener ugc nofollow" target="_blank">chris.germany@enron.com</a>","group":"person"},{"id":1,"label":"<a class="ae lb" href="mailto:debra.perlingiere@enron.com" rel="noopener ugc nofollow" target="_blank">debra.perlingiere@enron.com</a>","group":"person"},{"id":2,"label":"<a class="ae lb" href="mailto:drew.fossum@enron.com" rel="noopener ugc nofollow" target="_blank">drew.fossum@enron.com</a>","group":"person"},{"id":3,"label":"<a class="ae lb" href="mailto:enron.announcements@enron.com" rel="noopener ugc nofollow" target="_blank">enron.announcements@enron.com</a>","group":"person"},{"id":4,"label":"<a class="ae lb" href="mailto:eric.bass@enron.com" rel="noopener ugc nofollow" target="_blank">eric.bass@enron.com</a>","group":"person"},{"id":5,"label":"<a class="ae lb" href="mailto:gerald.nemec@enron.com" rel="noopener ugc nofollow" target="_blank">gerald.nemec@enron.com</a>","group":"person"},...]</span></pre><p id="6bf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Edges.json 示例</p><pre class="kx ky kz la gt ml mm mn mo aw mp bi"><span id="c0ad" class="mq ld iq mm b gy mr ms l mt mu">[{"from":0,"to":21},{"from":1,"to":21},{"from":2,"to":21},{"from":4,"to":21},{"from":5,"to":21},{"from":6,"to":21},{"from":7,"to":21},{"from":8,"to":21},{"from":9,"to":21},{"from":10,"to":21},{"from":11,"to":21},{"from":13,"to":21},{"from":15,"to":21},{"from":16,"to":21},{"from":17,"to":21},{"from":18,"to":21},{"from":19,"to":21},{"from":20,"to":21},...]</span></pre><h1 id="abe0" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><a class="ae lb" href="http://visjs.org/network_examples.html" rel="noopener ugc nofollow" target="_blank"> Visjs </a></h1><p id="0a36" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">对于网络图可视化，我们使用了构建在 d3 之上的名为 Visjs 的 javascript 库。它实际上有一个 python 包装器，但是我无法在笔记本中找到或让它工作，所以我只是处理了样本 javascript 代码，并嵌入了来自 pandas 节点和边的数据帧的 json 输出。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="c602" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们打开静态 html 文件，将会出现如下所示的交互式可视化效果:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/47137ccf03814faf5ed815f5ce2c7863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UELlcHh2gtHgZwN9vkzKNA.png"/></div></div></figure><p id="6636" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于 Visjs 使用了 d3 物理学，最终发生的情况是最常见的单词(有许多联系的单词)聚集在中间，而“非常常见”的单词成为外围。</p><p id="7a83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，Pete Davis 似乎是一名加州电力调度人员，他在电子邮件中使用特定于其调度工作的术语。</p><p id="a5b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过浏览实体网络，你可以真正开始注意到谁在做什么。马特·伦哈特负责佛罗里达州的业务，而约翰·阿诺德和萨拉·沙克尔顿则谈论涉及巴西的潜在交易。几乎每个人都在谈论 FERC(联邦能源监管委员会)，它负责监管州际贸易。等等，等等…</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="218e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以利用安然电子邮件数据集做更多的事情，例如训练单词嵌入、对电子邮件进行分类、欺诈交易的异常检测等。然而，在这篇文章中，我想向你展示一个简单的实体网络图在总结一个大的文本语料库时是多么的有用。</p><p id="f3f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里找到这个项目的 Github 库:<a class="ae lb" href="https://github.com/raymondmyu/enron-email-dataset" rel="noopener ugc nofollow" target="_blank">https://github.com/raymondmyu/enron-email-dataset</a></p><p id="62e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想看更多请留下评论鼓掌！</p></div></div>    
</body>
</html>