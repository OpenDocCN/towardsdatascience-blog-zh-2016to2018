<html>
<head>
<title>[Learning Note] StarSpace For Multi-label Text Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[学习笔记]用于多标签文本分类的StarSpace</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/learning-note-starspace-for-multi-label-text-classification-81de0e8fca53?source=collection_archive---------1-----------------------#2018-01-22">https://towardsdatascience.com/learning-note-starspace-for-multi-label-text-classification-81de0e8fca53?source=collection_archive---------1-----------------------#2018-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/81331d3f6bf650eae9555d56c6619a88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9Q-W1-_o1p8UydOtKLDzA.jpeg"/></div></div></figure><p id="1dca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">StarSpace是一个雄心勃勃的模型，试图解决一系列与实体嵌入相关的问题。它由脸书人工智能研究所(FAIR)创建并开源。我还没有在论文中读到模型<a class="ae kw" href="https://arxiv.org/pdf/1709.03856.pdf" rel="noopener ugc nofollow" target="_blank">的细节，但是很容易假设它扩展了FAIR之前的文本嵌入库</a><a class="ae kw" href="https://github.com/facebookresearch/fastText" rel="noopener ugc nofollow" target="_blank"> fastText </a>。StarSpace旨在成为一个直接有效的强基线，也就是说，你为新数据集或新问题训练的第一个模型。</p><p id="bb6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将写下我是如何(试图)让StarSpace处理来自Kaggle的<a class="ae kw" href="https://www.kaggle.com/c/jigsaw-toxic-comment-classification-challenge" rel="noopener ugc nofollow" target="_blank">有毒评论分类挑战</a>的数据集的。该数据集表示多标签文本分类问题，即，可以将多个标签分配给单个评论。由于<a class="ae kw" href="https://github.com/facebookresearch/fastText/issues/72" rel="noopener ugc nofollow" target="_blank"> fastText不完全支持多标签分类</a>，我认为StarSpace可能是一个不错的选择。</p><h2 id="3d35" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">剧透/TL；博士；医生</h2><p id="c5bc" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我发现StarSpace在当前状态下存在两个主要问题，使其无法作为该数据集的基线:</p><ol class=""><li id="00c3" class="lv lw iq ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated">没有<code class="fe me mf mg mh b">predict</code>命令:目前只提供<code class="fe me mf mg mh b">test</code>，给出描述性的模型评估。额外的工作需要你自己完成，以获得每个评论的标签概率的清晰输出。</li><li id="8f9a" class="lv lw iq ka b kb mi kf mj kj mk kn ml kr mm kv ma mb mc md bi translated">评估度量是不可定制的:由于缺乏清晰的预测输出，我们依赖于来自<code class="fe me mf mg mh b">test</code>命令的模型评估。但是我看不出有什么方法可以让它显示我们关心的这个数据集的列级平均日志损失。</li></ol><p id="6a56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另外，StarSpace的文档也不是很全面。这也是为什么我会写这篇文章的原因。</p><h2 id="cb46" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">安装StarSpace</h2><p id="791a" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">Starspace是用C++写的，要自己搭建。在我的Linux Mint 18.3环境中，这非常简单。只需克隆Git repo并运行<code class="fe me mf mg mh b">make</code>:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="d54d" class="kx ky iq mh b gy mw mx l my mz">git clone https://github.com/facebookresearch/Starspace.git<br/>cd Starspace<br/>make</span></pre><p id="f1c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将编译好的可执行文件<code class="fe me mf mg mh b">starspace</code>复制到你的路径中的某个地方(我个人使用<code class="fe me mf mg mh b">~/bin/</code></p><p id="e850" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在其他环境中，你可能需要跳过额外的关卡来满足<a class="ae kw" href="https://github.com/facebookresearch/StarSpace#requirements" rel="noopener ugc nofollow" target="_blank">需求</a>。请查看链接以获取进一步的说明。</p><h2 id="8a5c" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">Python环境</h2><ul class=""><li id="3a2b" class="lv lw iq ka b kb lq kf lr kj na kn nb kr nc kv nd mb mc md bi translated">Python 3.6</li><li id="e8d5" class="lv lw iq ka b kb mi kf mj kj mk kn ml kr mm kv nd mb mc md bi translated">pandas 0.22.0，joblib 0.11，tqdm 4.19.5(使用了非常基础的API，所以确切的版本应该无关紧要。如果你遇到任何问题，请在这篇文章发表后检查是否有任何重大更新。)</li><li id="1304" class="lv lw iq ka b kb mi kf mj kj mk kn ml kr mm kv nd mb mc md bi translated">空间2.0.5</li><li id="3cf0" class="lv lw iq ka b kb mi kf mj kj mk kn ml kr mm kv nd mb mc md bi translated">sci kit-学习0.19.1</li></ul><h2 id="b029" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">准备数据集</h2><p id="7ed6" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">不言而喻，您需要首先将数据集下载到您的计算机上。我通常将数据集放在项目根目录下的<code class="fe me mf mg mh b">data</code>子文件夹中，并将从原始数据集派生的所有内容放在<code class="fe me mf mg mh b">cache</code>子文件夹中。我们将在下面使用相同的设置。</p><p id="1c14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是清理和<a class="ae kw" href="https://www.wikiwand.com/en/Lexical_analysis#Tokenization" rel="noopener ugc nofollow" target="_blank">标记</a>注释。在这里，我使用了来自<a class="ae kw" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank"> spacy，</a>的英文分词器，删除换行符和一些其他标点符号，并将注释精简到20，000个字符。(清洗方案通常依赖于数据集。对于这个数据集，肯定有比这篇文章中简单的方案更好的方案。例如，你可以过滤掉停用词。)</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ef92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在注释被标记化之后，我们将这些标记与它们相关联的标签结合起来，并以StarSpace可以识别的格式保存它们(这里我们使用fastText格式)。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e742" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用25%的训练数据集作为验证。结果分别保存到<code class="fe me mf mg mh b">cache/train.txt</code>和<code class="fe me mf mg mh b">cache/val.txt</code>。注意因为我还没有找到一种容易提取预测的方法，所以这里不处理测试数据集。</p><p id="0d47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">快速文本格式非常简单。在连续的标记之间放置一个空格，每行一个注释/实例，并在末尾放置标签。标签用数字编码，并为无毒的评论创建一个虚拟标签(StarSpace不接受空标签列表)。</p><p id="7109" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，这是训练数据集中的第一条注释:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="837c" class="kx ky iq mh b gy mw mx l my mz">22256635,"Nonsense?  kiss off, geek. what I said is true.  I'll have your account terminated.",1,0,0,0,0,0</span></pre><p id="c431" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">处理后，它变成:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="a85c" class="kx ky iq mh b gy mw mx l my mz">Nonsense ? kiss off , geek . what I said is true . I 'll have your account terminated . __label__0</span></pre><h2 id="d9c5" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">训练和评估模型</h2><p id="3161" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">要训练模型，请在命令行中运行以下命令:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="e2d8" class="kx ky iq mh b gy mw mx l my mz">starspace train -ngrams 2 -minCount 10 -thread 4 -trainFile cache/train.txt -model cache/starspace.model</span></pre><p id="1775" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该模型使用unigram和bigram，要求一个令牌至少出现10次才被考虑，并使用4个线程。更多参数可通过<code class="fe me mf mg mh b">starspace -h</code>找到。</p><p id="9376" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">StarSpace将模型保存到<code class="fe me mf mg mh b">cache/starspace.model</code>，将文字嵌入和标签嵌入向量保存到<code class="fe me mf mg mh b">cache/starspace.model.tsv</code>。您可以分析或可视化这些嵌入向量，以获得进一步的见解。</p><p id="17c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使用验证数据集评估模型，请运行以下命令:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="8e8a" class="kx ky iq mh b gy mw mx l my mz">starspace test -testFile cache/val.txt -model cache/starspace.model -predictionFile cache/starspace.pred</span></pre><p id="1310" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了命令行输出之外，它还将逐例评估写入<code class="fe me mf mg mh b">cache/starspace.pred</code>。一个例子:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="9c82" class="kx ky iq mh b gy mw mx l my mz">Example 68:<br/>LHS:<br/>IT 'S HER QUOTE . WHAT CAN'T YOU UNDERSTAND ? Here is the official press release Now , please , can we stop this nonsense ? <br/>RHS: <br/>__label__0 <br/>Predictions: <br/>(--) [0.542934] __label__6 <br/>(--) [0.055087] __label__4 <br/>(--) [0.0467122]        __label__2 <br/>(++) [-0.0127831]       __label__0 <br/>(--) [-0.23463] __label__1</span></pre><p id="5093" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一个例子:</p><pre class="mo mp mq mr gt ms mh mt mu aw mv bi"><span id="0a97" class="kx ky iq mh b gy mw mx l my mz">Example 116:<br/>LHS:<br/>STOP , you had better stop putting all that stupid junk on my IP page . read it . you 'll see what i 'll do if you do it again . <br/>RHS: <br/>__label__0 <br/>Predictions: <br/>(++) [0.529969] __label__0 <br/>(--) [0.416814] __label__2 <br/>(--) [0.388696] __label__4 <br/>(--) [0.34913]  __label__3 <br/>(--) [0.240833] __label__1</span></pre><p id="017a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，数据集中的大多数评论都是没有毒性的(<em class="mn"> __label__6 </em>)，所以我在这里真的是精挑细选了一些例子。</p><p id="3d26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">分配给每个标签的值的含义不清楚。我想答案可以在报纸上找到。</p><h2 id="9094" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">包扎</h2><p id="a2e0" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">不幸的是，StarSpace还没有准备好作为有毒评论数据集的基线。这篇文章尽我们所能记录了所需的步骤，以供将来参考。希望星际空间将继续发展，并真正为生产做好准备。我们会回来买更多的。</p></div></div>    
</body>
</html>