<html>
<head>
<title>YOLOv2 to detect your own objects using Darkflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">YOLOv2 使用 Darkflow 检测您自己的对象</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/yolov2-to-detect-your-own-objects-soccer-ball-using-darkflow-a4f98d5ce5bf?source=collection_archive---------3-----------------------#2018-07-26">https://towardsdatascience.com/yolov2-to-detect-your-own-objects-soccer-ball-using-darkflow-a4f98d5ce5bf?source=collection_archive---------3-----------------------#2018-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f13b28d79e8277903adaccc684bb0a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZySE-XAWgBT4j_L2tf_YWQ.jpeg"/></div></div></figure><p id="4397" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" rel="noopener" target="_blank" href="/yolov2-object-detection-using-darkflow-83db6aa5cf5f"> <strong class="ka ir"> <em class="kx">上一个故事</em> </strong> </a>前一个展示了关于<a class="ae kw" href="https://github.com/thtrieu/darkflow" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="kx">dark flow</em></strong></a><strong class="ka ir"><em class="kx"/></strong><em class="kx">其中</em> <strong class="ka ir"> <em class="kx"> </em> </strong>是 YOLOv2 对象检测模型的实现之一</p><p id="d540" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个故事介绍了在自定义数据集上进行对象检测的基本步骤。作为一个例子，我自己做了足球检测。简而言之，我将展示如何<strong class="ka ir"> 1 .准备数据集，2 .训练模型</strong>和<strong class="ka ir"> 3 .预测对象</strong>。</p><p id="173e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在 Github<strong class="ka ir"><em class="kx"/></strong>上写过一篇<a class="ae kw" href="https://github.com/deep-diver/Soccer-Ball-Detection-YOLOv2" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx"> Jupyter 的笔记本跟这个故事有关。如果您想亲自尝试，请访问<a class="ae kw" href="https://github.com/deep-diver/Soccer-Ball-Detection-YOLOv2" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">此处</strong> </a>获取完整的数据集和训练程序。</em></strong></a></p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="728e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">准备数据集</h1><p id="202f" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated"><strong class="ka ir">这一步</strong>要做的第一件事是<strong class="ka ir">搜索你感兴趣的媒体(图像或视频)文件</strong>。就我而言，我选择了足球，因为当我在这里时，2018 年俄罗斯世界杯正在进行。在 Youtube 上更容易找到精彩的视频剪辑，我可以制作很多截图(通过这个链接，你会找到一种从视频文件制作大量截图的方法)。如果你只是从网上收集图像文件，那也很好。<strong class="ka ir">只要记住</strong>所有来自互联网的<strong class="ka ir">你的图像文件</strong>或者截图<strong class="ka ir">必须属于一个相似的</strong>(或者<strong class="ka ir">相同的</strong>如果可能的话)<strong class="ka ir">发行版</strong>因为我们不打算构建通用 AI。</p><p id="b94f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">其次</strong>，是<strong class="ka ir">对采集到的图像数据集进行预处理</strong>的时候了。可以用图像和相关联的注释来训练 YOLO 模型。图像文件链接到注释文件，而注释文件包含多个注释信息。注释指示图像中对象的位置及其大小，如(x_top，y_top，x_bottom，y_bottom，width，height)。这些批注应该是自己手写的，可能需要很长时间。然而，幸运的是，有很好的工具来简化这项任务。我选择了<a class="ae kw" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">这个工具</strong> </a> <strong class="ka ir"> (labelImg) </strong>。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/680248a376ec3355a909d6f36ff42198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHkpGX3aPixmQQ5ofllCWg.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk"><strong class="bd mr">labelImg TOOL for bounding boxes</strong></figcaption></figure><p id="06f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从上面的截图可以看出，你可以很容易地在你感兴趣的对象周围绑定框。我只有足球的边界框，但是多个对象也可以。<strong class="ka ir">只要记住</strong>应该显示<strong class="ka ir"> PascalVOC 文本</strong>，因为它<strong class="ka ir">表示<strong class="ka ir"> YOLO 的</strong>注释样式现在被选中，</strong>即使你使用这样的工具，这个过程也要花费很长时间。</p><h2 id="c227" class="ms lg iq bd lh mt mu dn ll mv mw dp lp kj mx my lt kn mz na lx kr nb nc mb nd bi translated">如果你想要我的数据集…</h2><p id="1c3f" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated"><strong class="ka ir">我已经上传并分享了我的预处理图像数据集和相关注释。</strong>你可以在这里 下载<a class="ae kw" href="https://drive.google.com/drive/folders/1th1odcC5kjEnkZmwooETYlyLsz5AOTph?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">。如果您想亲自试验训练/预测任务，您可能需要它；如果您想添加更多数据集以提高模型的性能，您也可能需要它。</strong></a></p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="40e1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">预测对象</h1><p id="655b" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">在这一步中，<strong class="ka ir"> <em class="kx">在预测</em></strong><strong class="ka ir">之前，训练好的模型应该准备</strong>进行推论。为了获得一个训练有素的模型，以下是你应该做的。</p><ol class=""><li id="c551" class="ne nf iq ka b kb kc kf kg kj ng kn nh kr ni kv nj nk nl nm bi translated"><strong class="ka ir">在 COCO 或 VOC 数据集上找到预训练模型</strong></li><li id="bd87" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv nj nk nl nm bi translated"><strong class="ka ir">更改配置，使模型适合您自己的情况</strong></li><li id="ab72" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv nj nk nl nm bi translated"><strong class="ka ir">建立模型</strong></li><li id="a4af" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv nj nk nl nm bi translated"><strong class="ka ir">训练模型</strong></li></ol><p id="bbf8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">首先是</strong>，在我的例子中，我使用了<a class="ae kw" href="https://github.com/thtrieu/darkflow" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"/></a><strong class="ka ir"/>(yolov 2 的开源项目)<a class="ae kw" href="https://drive.google.com/drive/folders/0B1tW_VtY7onidEwyQ2FtQVplWEU" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">其预训练参数</strong> </a>。请访问我的 github 库，查看完整的使用说明。</p><p id="62b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第二个</strong>，应该有一个指定型号配置的文件。如果没有，您应该在代码本身中更改它。对于暗流，有一个文件(*。cfg)。<strong class="ka ir">最后，</strong>你应该改变最后一层的一些值。例如，在我的例子中，我只想检测一个足球。于是，我把<strong class="ka ir">“类”的值改成了 1</strong>(VOC 和 COCO 数据集的类数分别是 20 和 80)。由于最后一层中单元(类)的数量，<strong class="ka ir">一些相关联的参数数量</strong>也应该被适当地改变。根据 darkflow 的文档，我需要<strong class="ka ir">将【卷积】层</strong>(倒数第二层)中的过滤器更改为<strong class="ka ir"> num * (classes + 5)，即 30 </strong>。</p><p id="9f97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第三和第四</strong>步骤可能与各种实施方式不同。在 darkflow 中，下面的代码显示了如何构建模型。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2340" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它将打印出模型的架构，其中包含一些与预训练模型不同的相关更改。然后下面一行代码开始训练过程。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="ns nt l"/></div></figure><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/445353e2a1709af8fe7bae3e310f6ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqZBX7Su245FuZjEnjD0zw.png"/></div></div></figure><p id="b404" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我确实运行了 100 个纪元，每个纪元有 23 个步骤。这样 2300 的总步骤就完成了。供你参考，<strong class="ka ir">我用的是<em class="kx">英伟达 GTX 1080Ti </em> </strong>，用了<strong class="ka ir">大约一个小时</strong>完成训练过程。</p><p id="46e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每 250 步，darkflow 就会创建一个检查点文件。通过指定一个检查点文件，您可以从您离开的地方开始。此外，<strong class="ka ir">您可以使用检查点文件</strong>分发您的训练模型。下面的代码显示了如何加载它来预测流程。(-1 表示最新的检查点)</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="4f2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，您有了自己的模型来检测定制对象。如何用边界框显示图像或视频的详细描述在<a class="ae kw" rel="noopener" target="_blank" href="/yolov2-object-detection-using-darkflow-83db6aa5cf5f"> <strong class="ka ir"> <em class="kx">前面的故事</em> </strong> </a>中有解释。也请访问<a class="ae kw" href="https://github.com/deep-diver/Soccer-Ball-Detection-YOLOv2" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx"> github 库</em> </strong> </a>获取更详细的解释。</p><h1 id="4511" class="lf lg iq bd lh li nv lk ll lm nw lo lp lq nx ls lt lu ny lw lx ly nz ma mb mc bi translated">图像和视频预测结果</h1><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/63e8a5f71f45c7640474b1db2a987256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8jTuEPlS2p_w2FEvbH9cKw.png"/></div></div></figure><p id="e94c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我用网上的随机图片做了实验<strong class="ka ir">(上)</strong>。它就像我期待的那样工作。视频显示了视频文件<strong class="ka ir">(下图)</strong>上的预测结果。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="ob nt l"/></div></figure><h1 id="65cb" class="lf lg iq bd lh li nv lk ll lm nw lo lp lq nx ls lt lu ny lw lx ly nz ma mb mc bi translated">最后的想法</h1><ul class=""><li id="a9fb" class="ne nf iq ka b kb md kf me kj oc kn od kr oe kv of nk nl nm bi translated"><strong class="ka ir">我发现在足球比赛的宽视角下，球的检测相当困难，因为这个物体非常小(比你的指尖还小)。</strong></li><li id="f669" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv of nk nl nm bi translated">每个数据应该来自非常相似的分布。由于足球比赛的照片是从各种不同的角度拍摄的，有时很难预测。</li><li id="c84d" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv of nk nl nm bi translated"><strong class="ka ir">从不同的情况下收集尽可能多的数据。</strong></li><li id="c029" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv of nk nl nm bi translated"><strong class="ka ir">我发现数据集更好的包含了很多任意位置的物体。因为足球几乎出现在比赛的每个位置，所以看不见的位置很难预测。</strong></li><li id="2895" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv of nk nl nm bi translated"><strong class="ka ir">最后，足球有时会出现在球员之间或被球员部分隐藏，这也使得算法难以预测。数据集应该反映这种特殊情况。</strong></li></ul></div></div>    
</body>
</html>