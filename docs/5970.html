<html>
<head>
<title>Modeling and optimization of a weekly workforce with Python and Pyomo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Pyomo 对每周劳动力进行建模和优化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/modeling-and-optimization-of-a-weekly-workforce-with-python-and-pyomo-29484ba065bb?source=collection_archive---------5-----------------------#2018-11-19">https://towardsdatascience.com/modeling-and-optimization-of-a-weekly-workforce-with-python-and-pyomo-29484ba065bb?source=collection_archive---------5-----------------------#2018-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7c57afd548976f8b23da1adb0d8e408a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OAMnE5IN6EXSQEfRdN1qgw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Credit: <a class="ae kc" href="https://unsplash.com/@rawpixel?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@rawpixel</a></figcaption></figure><p id="0f44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 Python 和 Pyomo 逐步建模和优化劳动力设计和分配问题。</p><p id="8682" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本帖中，我们将对一个调度问题进行建模和求解，在这个问题中，工人必须被分配到不同的班次，以优化给定的标准，满足不同的工作条件约束。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="d996" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当开始一个新项目，计划开一家新商店，甚至准备大学的课程表时，负责任务的人有两种选择:手工求解或建模并作为优化问题求解。</p><p id="0a7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使有一个优秀的劳动力规划者，使用优化框架来处理这个问题也有很多好处:</p><ul class=""><li id="61c5" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">扩展:问题可能会变得和适当的环境一样大，这可能会超出一个人的能力。</li><li id="d6da" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">不平衡:在很多情况下，员工之间的不平衡是不可避免的。在这种情况下，决定将不是个人的。</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="f3c2" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">Pyomo 作为优化建模环境</h2><p id="b38b" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">为了解决这个问题，我们将使用 Pyomo，用他们自己的话说，这是一种“基于 Python 的开源优化建模语言，具有多种优化功能”。对于那些已经使用 Python 的人来说，用 Pyomo 建模和解决问题会很简单。</p><div class="mu mv gp gr mw mx"><a href="http://www.pyomo.org/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">主页</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">Pyomo 的主页，这是一种用于线性编程的基于 Python 的可扩展开源优化建模语言…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">www.pyomo.org</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jw mx"/></div></div></a></div><p id="a275" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Pyomo 允许在各种解决方案中进行选择，包括开源和商业解决方案。此外，用户可以选择在 Neos 服务器上解决问题，这是一个免费的基于互联网的解决方案，可以直接从 Pyomo 使用。这让我们不用在机器上下载和安装不同的解算器，也允许免费使用商业解算器。更多信息在<a class="ae kc" href="https://neos-server.org/neos/" rel="noopener ugc nofollow" target="_blank">https://neos-server.org/neos</a>。</p><p id="5220" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经在我的机器上安装了带有 conda 的 Pyomo，但也可以用 pip 来完成。可以在 http://www.pyomo.org/installation 的<a class="ae kc" href="http://www.pyomo.org/installation" rel="noopener ugc nofollow" target="_blank">阅读安装说明。</a></p><p id="9046" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将利用硬币或项目 Cbc，【https://projects.coin-or.org/Cbc】T4，来解决一个混合整数规划问题。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="f46b" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">问题描述</h2><p id="2a99" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">大学校园里新开了一家食品店，一周 7 天，一天 24 小时营业。每天有三次八小时轮班。早班为 6 时至 14 时，晚班为 14 时至 22 时，夜班为 22 时至次日 6 时。</p><p id="96ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">晚上只有一个工人，而白天有两个，除了星期天，每班只有一个。每个工人每周最多不超过 40 小时，并且在两班之间必须休息 12 小时。</p><p id="4398" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">至于每周的休息日，一个周日休息的员工也会喜欢在周六也休息。</p><p id="f8bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">原则上，有 10 名员工可用，这显然超出了规模。需要的工人越少，其他商店的资源就越多。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="3672" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">模型组成</h2><p id="07dd" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">为了使用 Pyomo 并解决这个问题，需要导入一些包。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="01d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一步是输入数据，这意味着提供模型，在这种情况下，我们正在考虑的日子，工人，班次…我们不能明确地定义它们，稍后通过使用<em class="ns"> AbstractModel() </em>输入数据，但对于这个帖子，继续使用<em class="ns"> ConcreteModel() </em>，因此所有数据必须在建模步骤中可用。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7b72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经添加了模型所需的所有数据。我们将能够在定义约束时调用这些元素，而不需要手动插入每个元素或考虑 if、else 子句。</p><p id="ad6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了构建模型，我们需要初始化模型并创建决策变量。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3b27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将模型初始化为对象后，将变量、约束和目标函数等元素作为属性添加。正如前面所解释的，我们创建了一个<em class="ns">混凝土模型()</em>，因为此时数据正在被提供。我们用<em class="ns"> Var() </em>变量添加到模型中，用列表索引。</p><ul class=""><li id="4ea8" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">works:由工人、天数和班次索引的二元变量。1 如果工人必须在那天轮班工作。</li><li id="3f19" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">需要:由工人索引的二进制变量。1 员工是否必须包括在员工队伍中。</li><li id="7265" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">no_pref:由 workers 索引的二进制变量。1 如果它在周日不工作，但在周六工作。</li></ul><p id="b42e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义完所有变量后，我们就可以添加目标函数了。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c18e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">目标是找到一个最大限度地减少工人数量的时间表，一旦实现了这个目标，也是最大限度地减少在星期天工作但在星期六不工作的工人数量。我们将工人数量部分乘以一个足够大的常数，这样只有在决定了最佳工人数量后，才考虑最小化周末偏好。</p><p id="d85d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要添加约束，首先创建一个调用<em class="ns"> ConstraintList() </em>的约束容器，然后用函数<em class="ns"> add </em>将我们想要的任何约束添加到容器中。约束的代码如下，每个约束的解释都是行内注释:</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3dab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，创建的模型可以求解了。一个模型可以用<em class="ns"> model.pprint() </em>来可视化。这个问题是由二进制变量组成的，所以一个混合整数规划求解器适合我们的要求，CBC 从 COIN-OR 将被选中，【https://projects.coin-or.org/Cbc】T2。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9de6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这需要在本地安装求解器(不要忘记将它添加到路径中，以便 Pyomo 识别它)。然而，在 neos-server 中运行它将我们从这一过程中解放出来。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="1c94" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">提取溶液</h2><p id="f8d6" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们这样做是为了得到一个问题的解决方案，所以这是下一步。问题的解决方案是稀疏的，从这个意义上说，我们只是想知道它们中哪些是非零的，为了可视化，我们必须处理给定的解决方案。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="48fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以检查所获得的解，并验证所有提出的约束条件是否得到满足。以 JSON 格式保存最佳时间表的字典，解决方案如下:</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0003" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最佳解决方案需要激活 7 个工人。然后，有 7 名工人，他们不满意的人数是 2 (W6，W9)，因为他们在星期天不工作，但在星期六必须工作。观察问题公式，由于周日有 3 个班次，周六有 5 个班次，人们不能期望少于 2 个周六工人在周日不工作。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="f0fe" class="lw lx iq bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">结论</h2><p id="9725" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">在这篇文章中，我们已经完成了以下目标:</p><ul class=""><li id="4e23" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">解释 Pyomo 作为 Python 中优化建模框架的基础知识。</li><li id="e9ab" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">学习如何建立一个特定问题的模型，在这个问题中，劳动力计划者必须在各种限制下优化每周时间表。</li></ul><p id="2598" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章旨在友好地介绍 Pyomo 的使用和优化问题的建模，因此，解决由于问题的规模或难以制定一个好的模型(是的，建模可以被认为是一门艺术)而导致的更困难的问题可能需要更深入地了解这些主题。</p><p id="f140" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读。玩得开心！</p><p id="c98a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最新代码可在<a class="ae kc" href="https://github.com/ccarballolozano/blog-post-codes/tree/master/Modeling-and-optimization-of-a-weekly-workforce-with-Python-and-Pyomo" rel="noopener ugc nofollow" target="_blank">https://github . com/ccarballozano/blog-post-codes/tree/master/Modeling-and-optimization-of-weekly-work force-with Python-and-py Omo</a>获得。</p></div></div>    
</body>
</html>