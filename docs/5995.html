<html>
<head>
<title>Mapping Geograph Data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 绘制地理数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mapping-geograph-data-in-python-610a963d2d7f?source=collection_archive---------1-----------------------#2018-11-20">https://towardsdatascience.com/mapping-geograph-data-in-python-610a963d2d7f?source=collection_archive---------1-----------------------#2018-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2379ea4453be0a7abd557551b1b14829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dRsmoJCEpH8y72UCWw3tw.png"/></div></div></figure><p id="116e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在数据科学领域工作时，一个很大的帮助是在地理地图上可视化您的数据，为此，有几个包可以处理它，例如<a class="ae kw" href="http://geopandas.org/index.html" rel="noopener ugc nofollow" target="_blank"> GeoPandas </a>。</p><blockquote class="kx ky kz"><p id="6cb8" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">你可以学习如何使用 GeoPandas，阅读我的文章:<a class="ae kw" rel="noopener" target="_blank" href="/how-safe-are-the-streets-of-santiago-e01ba483ce4b">圣地亚哥的街道有多安全</a>。</p></blockquote><p id="9555" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时安装 Geopandas 包可能很复杂，这取决于您工作的环境。或者，简单地说，你需要控制你的代码！因此，在这篇文章中，我们将探索如何使用“形状文件”和基本的 Python 库来构建我们自己的“地理地图功能”。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi le"><img src="../Images/3feb0beb1be475006661b93a5f8a395b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9kgCrseDkOjKgoPItWmbg.jpeg"/></div></div></figure><h2 id="5c98" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">1.形状文件</h2><p id="4735" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">shapefile 格式由 Esri 作为(主要)开放规范开发和管理，在空间上将几何描述为“点”、“折线”或“多边形”。在 OpenStreetMap 术语中，这些可以分别被认为是'<a class="ae kw" href="https://wiki.openstreetmap.org/wiki/Node" rel="noopener ugc nofollow" target="_blank">节点</a>'、<a class="ae kw" href="https://wiki.openstreetmap.org/wiki/Way" rel="noopener ugc nofollow" target="_blank">路</a>和'<a class="ae kw" href="https://wiki.openstreetmap.org/wiki/Way#Closed_way" rel="noopener ugc nofollow" target="_blank">闭路</a>'。每个几何体都有一组关联的属性。概括地说，这些有点像 OSM 的标签。</p><p id="75d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">shapefile 实际上是几个文件的组合，这些文件的格式表示地理数据的不同方面:</p><ul class=""><li id="fee6" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated">。shp —形状格式；特征几何本身。</li><li id="4b99" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">。shx —形状索引格式；要素几何的位置索引，允许快速向前和向后搜索。</li><li id="42f7" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">。dbf —属性格式；每个形状的列属性，dBase IV 格式。</li></ul><p id="9948" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有几个 shapefile 格式的可选文件。其中最重要的是。描述所用坐标系和投影信息的 prj 文件。虽然不是 Esri shapefile 标准的一部分。lyr 文件通常包含在内，因为它包含如何在<a class="ae kw" href="https://wiki.openstreetmap.org/wiki/ArcGIS" rel="noopener ugc nofollow" target="_blank"> ArcGIS </a>软件中显示数据(颜色、标签等)的规范。</p><blockquote class="kx ky kz"><p id="0d91" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated"><em class="iq">更多信息见</em> <a class="ae kw" href="http://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank"> <em class="iq">维基百科</em> </a></p></blockquote><h2 id="17c6" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">2.正在安装 Python 形状文件库(PyShp)</h2><p id="8da7" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">Python Shapefile 库(pyshp)为<br/> Esri Shapefile 格式提供读写支持。Shapefile 格式是由<a class="ae kw" href="http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf" rel="noopener ugc nofollow" target="_blank"> Esri </a>创建的一种流行的地理<br/>信息系统矢量数据格式。</p><p id="f78b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要安装<em class="la"> pyshp </em>，请在您的终端中执行以下指令:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="ffed" class="lj lk iq mw b gy na nb l nc nd">pip install pyshp</span></pre><h2 id="8527" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">3.导入和初始化主 Python 库</h2><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="b03c" class="lj lk iq mw b gy na nb l nc nd">import numpy as np<br/>import pandas as pd<br/>import shapefile as shp<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span></pre><p id="1266" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">初始化虚拟化设置</strong></p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="06b3" class="lj lk iq mw b gy na nb l nc nd">sns.set(style=”whitegrid”, palette=”pastel”, color_codes=True)<br/>sns.mpl.rc(“figure”, figsize=(10,6))</span></pre><p id="0757" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用的是 Jupyter 笔记本电脑:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="8cdc" class="lj lk iq mw b gy na nb l nc nd">%matplotlib inline</span></pre><h2 id="483e" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">4.打开矢量地图</h2><p id="c435" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">如 1 中所述。，矢量地图是一组由多个文件组成的文件，其中 name.shp 是主文件，用于保存地理要素。重要的是，所有其他文件如' name.shx '，' name.dbf '等。，必须在同一文件夹中。</p><p id="a4f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将使用与城市相关的地图(“Comunas”)，它们共同构成了圣地亚哥大都市地区。在<a class="ae kw" href="http://www.ine.cl/herramientas/galeria-de-mapas/censo" rel="noopener ugc nofollow" target="_blank"> INE(智利国家统计局)</a>，可以下载一组与地图相关的 shapefiles，这些文件是为最近一次 2017 年全国人口普查创建的:</p><ul class=""><li id="8960" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated">Comuna.cpg</li><li id="5d09" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.shp</li><li id="bfaa" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.dbf</li><li id="1693" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.shp.xml</li><li id="8d71" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.prj</li><li id="c5f9" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.shx</li><li id="348d" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.sbn</li><li id="8907" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">Comuna.sbx</li></ul><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="efa4" class="lj lk iq mw b gy na nb l nc nd">shp_path = “./Comunas_RM_Mapas_Vectoriales/Comuna.shp”<br/>sf = shp.Reader(shp_path)</span></pre><p id="e160" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们检查一下函数<em class="la"> shp 导入了多少不同的“形状”。读者:</em></p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="2647" class="lj lk iq mw b gy na nb l nc nd">len(sf.shapes())</span></pre><p id="f67d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果将是:52</p><p id="e9e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着在我们的形状文件中存在 52 个形状，一旦圣地亚哥大都会区有 52 个“comunas”，如下图所示(不要担心，在本文结束之前，您将学习如何直接从您的数据创建这样的地图):</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/1f154b927338312deeba5cfbc6150864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ywKxuFmp9HksFh0lWukxRg.png"/></div></div></figure><p id="2c61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们也探索其中一个形状(或“记录”):</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="b8f0" class="lj lk iq mw b gy na nb l nc nd">sf.records()[1]</span></pre><p id="1823" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果将是一个包含 6 个元素的数组:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="9fd0" class="lj lk iq mw b gy na nb l nc nd">Out:</span><span id="2a41" class="lj lk iq mw b gy nf nb l nc nd">['13',<br/> '131',<br/> '13115',<br/> 'REGIÓN METROPOLITANA DE SANTIAGO',<br/> 'SANTIAGO',<br/> 'LO BARNECHEA']</span></pre><p id="f112" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">元素[5]是“comuna”的名字，在这种情况下:“LO BARNECHEA”，一个位于安第斯山脉所在城市东部的“comuna”(也是我的家！；-)</p><p id="e71b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以直接得到它的名字:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="c11d" class="lj lk iq mw b gy na nb l nc nd">sf.records()[1][5]</span></pre><p id="8542" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">圣地亚哥大都会区最中心的“comuna”正是圣地亚哥的 Comuna(小迷糊？)，在那里你可以找到大都会歌剧院、拉莫内达总统府(73 年被猛烈轰炸)、巴勃罗·聂鲁达故居等。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/2f224da0f577a4b491ec1a184ffb888e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*dzyEfoDTRzf-CtQZJFvPDA.jpeg"/></div></figure><p id="281f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，让我们结束观光，看看圣地亚哥的 comuna 数据结构(id: 25):</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="756c" class="lj lk iq mw b gy na nb l nc nd">sf.records()[25]</span></pre><p id="a749" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Out[]:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="6b59" class="lj lk iq mw b gy na nb l nc nd">[‘13’,<br/> ‘131’,<br/> ‘13101’,<br/> ‘REGIÓN METROPOLITANA DE SANTIAGO’,<br/> ‘SANTIAGO’,<br/> ‘SANTIAGO’]</span></pre><p id="0b39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到一些数据发生了变化，最重要的是“comuna”的名称，也就是现在的“SANTIAGO”。</p><blockquote class="kx ky kz"><p id="00a2" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">请注意，您可以将本教程中描述内容应用于任何 shapfile。</p></blockquote><h2 id="7838" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">5.在 Pandas 数据帧上转换 shapefile 数据</h2><p id="2a71" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在最后一个例子中，我之前知道 Santiago 的 id 是“25”。但是如何找到这样的 id，从一个 comuna 的名字开始？让我们首先创建一个有用的函数，将我们的“shapefile”格式转换为更常见的熊猫数据帧格式:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="3ba9" class="lj lk iq mw b gy na nb l nc nd">def read_shapefile(sf):<br/>    """<br/>    Read a shapefile into a Pandas dataframe with a 'coords' <br/>    column holding the geometry information. This uses the pyshp<br/>    package<br/>    """<br/>    fields = [x[0] for x in sf.fields][1:]<br/>    records = sf.records()<br/>    shps = [s.points for s in sf.shapes()]</span><span id="3e27" class="lj lk iq mw b gy nf nb l nc nd">    df = pd.DataFrame(columns=fields, data=records)<br/>    df = df.assign(coords=shps)</span><span id="63ea" class="lj lk iq mw b gy nf nb l nc nd">    return df</span></pre><p id="ee36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，让我们转换数据帧上的 sf 数据，看看它是什么样子:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="7bc4" class="lj lk iq mw b gy na nb l nc nd">df = read_shapefile(sf)<br/>df.shape</span></pre><p id="0ca6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据帧具有(52，7)的形状。这意味着我们每行有 7 个不同的特征(列)。请记住，我们之前看到了其中的 6 个功能。好像现在多加了一个。让我们看一个例子:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="7efd" class="lj lk iq mw b gy na nb l nc nd">df.sample(5)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/162f7d8e5bf0b24b2e836c1c1cc9153c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bsiEf3NTQdKWDw3vOmwwqw.png"/></div></div></figure><p id="18a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一列是用于创建特定地图形状的每个点的坐标、纬度和经度。</p><p id="a728" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迷惑？让我们再深入挖掘一下。</p><p id="cb02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何定位圣地亚哥·科穆纳的身份？现在用熊猫很简单:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="0f96" class="lj lk iq mw b gy na nb l nc nd">df[df.NOM_COMUNA == ‘SANTIAGO’]</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/947311198fea6fa8ee8eed8369ab2c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4IfcBqAHTqiOZ1tDM_eJLQ.png"/></div></div></figure><p id="32f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以很容易地看到，25 正好是数据帧索引，也就是我们的 comuna 形状所在的位置。</p><p id="8cb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过简单的 Pandas 命令，您可以将索引(或 id)与 comuna 的名称相关联:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="f7da" class="lj lk iq mw b gy na nb l nc nd">df.NOM_COMUNA</span><span id="9437" class="lj lk iq mw b gy nf nb l nc nd">Out:</span><span id="9738" class="lj lk iq mw b gy nf nb l nc nd">0 LAS CONDES<br/>1 LO BARNECHEA<br/>2 VITACURA<br/>3 HUECHURABA<br/>4 PUDAHUEL</span><span id="ea92" class="lj lk iq mw b gy nf nb l nc nd">…</span><span id="b27f" class="lj lk iq mw b gy nf nb l nc nd">49 ALHUÉ<br/>50 LAMPA<br/>51 TILTIL</span></pre><h2 id="89f0" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">6.绘制特定形状</h2><p id="6e56" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">最后，我们将看到什么是真正的形状。为此，我们应该创建一个函数来绘制它。我们将使用 Python MatPlotLib 库:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="2e73" class="lj lk iq mw b gy na nb l nc nd">def plot_shape(id, s=None):<br/>    """ PLOTS A SINGLE SHAPE """<br/>    plt.figure()<br/>    ax = plt.axes()<br/>    ax.set_aspect('equal')<br/>    shape_ex = sf.shape(id)<br/>    x_lon = np.zeros((len(shape_ex.points),1))<br/>    y_lat = np.zeros((len(shape_ex.points),1))<br/>    for ip in range(len(shape_ex.points)):<br/>        x_lon[ip] = shape_ex.points[ip][0]<br/>        y_lat[ip] = shape_ex.points[ip][1]</span><span id="2e4c" class="lj lk iq mw b gy nf nb l nc nd">    plt.plot(x_lon,y_lat) <br/>    x0 = np.mean(x_lon)<br/>    y0 = np.mean(y_lat)<br/>    plt.text(x0, y0, s, fontsize=10)<br/>    # use bbox (bounding box) to set plot limits<br/>    plt.xlim(shape_ex.bbox[0],shape_ex.bbox[2])<br/>    return x0, y0</span></pre><p id="634f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的函数做两件事:a)根据 comuna 的坐标绘制形状(多边形), b)计算并返回特定形状的中点(x0，y0)。这个中点也被用来定义在哪里印刷 comuna 的名字。</p><p id="658c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，对于我们著名的圣地亚哥的 comuna:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="ad8b" class="lj lk iq mw b gy na nb l nc nd">comuna = 'SANTIAGO'<br/>com_id = df[df.NOM_COMUNA == comuna].index.get_values()[0]<br/>plot_shape(com_id, comuna)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/3c3b21e991f2f7225aecdefb9c5edfee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6xeP9WV5q3YhCmrhrPiNcA.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Santiago — Shape only</figcaption></figure><p id="a4e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我们必须知道形状 id(索引)才能绘制它，但是我们输入了 Comuna 的名称:SANTIAGO。使用 Pandas 很容易计算 id，正如您在前面代码的第二行所看到的。</p><h2 id="7a86" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">7.绘制完整的地图</h2><p id="7fc9" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">绘制单个形状基本上是为了解决这一小部分代码:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="738d" class="lj lk iq mw b gy na nb l nc nd">sf.shape(id)</span></pre><p id="0a8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们必须在同一张图上画出数据帧上的所有形状。为此，我们将使用以下函数:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="ffb2" class="lj lk iq mw b gy na nb l nc nd">def plot_map(sf, x_lim = None, y_lim = None, figsize = (11,9)):<br/>    '''<br/>    Plot map with lim coordinates<br/>    '''<br/>    plt.figure(figsize = figsize)<br/>    id=0<br/>    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        plt.plot(x, y, 'k')<br/>        <br/>        if (x_lim == None) &amp; (y_lim == None):<br/>            x0 = np.mean(x)<br/>            y0 = np.mean(y)<br/>            plt.text(x0, y0, id, fontsize=10)<br/>        id = id+1<br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span></pre><p id="ef1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，上面的函数在一个给定的“df”文件上绘制所有的形状，包括它中间的形状 id。或者将绘制缩放的地图(无 id)。您可以更改打印或不打印 id 的功能。</p><p id="2ba9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">绘制全图:</strong></p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="984e" class="lj lk iq mw b gy na nb l nc nd">plot_map(sf)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/7d4fc7a0a559dcbdfc09d6bf9514c578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*2yNBcpb1pu2iKML-swPSFA.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Full Map</figcaption></figure><p id="ab60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">绘制地图:</strong></p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="0638" class="lj lk iq mw b gy na nb l nc nd">y_lim = (-33.7,-33.3) # latitude <br/>x_lim = (-71, -70.25) # longitude</span><span id="902b" class="lj lk iq mw b gy nf nb l nc nd">plot_map(sf, x_lim, y_lim)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/7f9b81016bc2fcd593a24419ff3b05b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*6ih34RAyqQFauoT9IL1o6g.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Full Map with Zoom</figcaption></figure><h2 id="a98e" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">8.在完整的地图上绘制单个形状</h2><p id="0c3d" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们可以“合并”前面的两个功能，并在完整的地图中“绘制”一个单一的形状。为此，让我们编写一个新函数，其中形状 id 现在是一个输入参数:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="47c1" class="lj lk iq mw b gy na nb l nc nd">def plot_map2(id, sf, x_lim = None, y_lim = None, figsize=(11,9)):<br/>    '''<br/>    Plot map with lim coordinates<br/>    '''<br/>   <br/>    plt.figure(figsize = figsize)<br/>    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        plt.plot(x, y, 'k')<br/>        <br/>    shape_ex = sf.shape(id)<br/>    x_lon = np.zeros((len(shape_ex.points),1))<br/>    y_lat = np.zeros((len(shape_ex.points),1))<br/>    for ip in range(len(shape_ex.points)):<br/>        x_lon[ip] = shape_ex.points[ip][0]<br/>        y_lat[ip] = shape_ex.points[ip][1]<br/>    plt.plot(x_lon,y_lat, 'r', linewidth=3) <br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span></pre><p id="09eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">密谋圣地亚哥的《红色》中的 comuna:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="0e8d" class="lj lk iq mw b gy na nb l nc nd">plot_map2(25, sf, x_lim, y_lim)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/06d3c360a3c1e23e7d50fcc9b8aa52e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*GYyvFLDXym56fsIa-W_R3w.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Santiago</figcaption></figure><p id="90f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想用特定的颜色“填充”一个形状呢？简单！为此，我们可以使用 plt.fill。该功能可以重写:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="6aea" class="lj lk iq mw b gy na nb l nc nd">def plot_map_fill(id, sf, x_lim = None, <br/>                          y_lim = None, <br/>                          figsize = (11,9), <br/>                          color = 'r'):<br/>    '''<br/>    Plot map with lim coordinates<br/>    '''<br/>    <br/>    plt.figure(figsize = figsize)<br/>    fig, ax = plt.subplots(figsize = figsize)</span><span id="7e01" class="lj lk iq mw b gy nf nb l nc nd">    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        ax.plot(x, y, 'k')<br/>        <br/>    shape_ex = sf.shape(id)<br/>    x_lon = np.zeros((len(shape_ex.points),1))<br/>    y_lat = np.zeros((len(shape_ex.points),1))<br/>    for ip in range(len(shape_ex.points)):<br/>        x_lon[ip] = shape_ex.points[ip][0]<br/>        y_lat[ip] = shape_ex.points[ip][1]<br/>    ax.fill(x_lon,y_lat, color)<br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span></pre><p id="9464" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用绿色(' g ')绘制“Las Condes”(id = 0)的 comuna:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="b9d4" class="lj lk iq mw b gy na nb l nc nd">plot_map_fill(0, sf, x_lim, y_lim, color='g')</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/4c6277e6e46f7719f4a11704fb10146a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*dIuX5JQDrrjPnKrEK50o5w.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Las Condes</figcaption></figure><h2 id="05ef" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">9.在完整地图上绘制多个形状</h2><p id="ec7a" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们“艰难的地图之旅”的下一个自然步骤是创建一个选择了几个形状的地图。为此，我们将有一个 id 列表，并使用 For 循环用颜色填充每个 id，而不是用 id 作为输入参数。修改后的函数如下所示:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="7aa2" class="lj lk iq mw b gy na nb l nc nd">def plot_map_fill_multiples_ids(title, comuna, sf, <br/>                                               x_lim = None, <br/>                                               y_lim = None, <br/>                                               figsize = (11,9), <br/>                                               color = 'r'):<br/>    '''<br/>    Plot map with lim coordinates<br/>    '''<br/>    <br/>    plt.figure(figsize = figsize)<br/>    fig, ax = plt.subplots(figsize = figsize)<br/>    fig.suptitle(title, fontsize=16)</span><span id="7843" class="lj lk iq mw b gy nf nb l nc nd">    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        ax.plot(x, y, 'k')<br/>            <br/>    for id in comuna:<br/>        shape_ex = sf.shape(id)<br/>        x_lon = np.zeros((len(shape_ex.points),1))<br/>        y_lat = np.zeros((len(shape_ex.points),1))<br/>        for ip in range(len(shape_ex.points)):<br/>            x_lon[ip] = shape_ex.points[ip][0]<br/>            y_lat[ip] = shape_ex.points[ip][1]<br/>        ax.fill(x_lon,y_lat, color)<br/>             <br/>        x0 = np.mean(x_lon)<br/>        y0 = np.mean(y_lat)<br/>        plt.text(x0, y0, id, fontsize=10)<br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span></pre><p id="a0dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的函数中，“comuna”现在是一个 id 列表:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="ebc7" class="lj lk iq mw b gy na nb l nc nd">comuna_id = [0, 1, 2, 3, 4, 5, 6]<br/>plot_map_fill_multiples_ids("Multiple Shapes", <br/>                            comuna_id, sf, color = 'r')</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/3ad5a78397204cf28973c070e3b6af3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*l9mo06hOtifUASgSPiNsrA.png"/></div></figure><p id="deb1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">利用我们以前的 pandas 数据框架，让我们创建一个简单的函数，其中输入是 comuna 的名称，而不是它的 id:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="4543" class="lj lk iq mw b gy na nb l nc nd">def plot_comunas_2(sf, title, comunas, color):<br/>    '''<br/>    Plot map with selected comunes, using specific color<br/>    '''<br/>    <br/>    df = read_shapefile(sf)<br/>    comuna_id = []<br/>    for i in comunas:<br/>        comuna_id.append(df[df.NOM_COMUNA == i.upper()]<br/>                         .index.get_values()[0])<br/>    plot_map_fill_multiples_ids(title, comuna_id, sf, <br/>                                       x_lim = None, <br/>                                       y_lim = None, <br/>                                       figsize = (11,9), <br/>                                       color = color);</span></pre><p id="6fe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">绘制圣地亚哥大都市区南部城市:</strong></p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="109f" class="lj lk iq mw b gy na nb l nc nd">south = ['alhué', 'calera de tango', 'buin', 'isla de maipo', 'el bosque', 'paine', 'la granja', 'pedro aguirre cerda', 'lo espejo', 'puente alto', 'san joaquín', 'san miguel', 'pirque', 'san bernardo', 'san ramón', 'la cisterna', 'talagante', 'la pintana']</span><span id="7e7e" class="lj lk iq mw b gy nf nb l nc nd">plot_comunas_2(sf, 'South', south, 'c')</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/6068c9b8cc843f2f37dfc6d485022861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*0HRmArqLFdR00diBHK908A.png"/></div></figure><h2 id="ab0e" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">10.创建“热图”</h2><p id="e83b" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">一种非常有用的贴图类型是用颜色填充特定的形状，其“强度”与给定值成比例。这样，就有可能对特定地理区域的数据分布有一个总体的了解。例如，人口分布。</p><p id="21d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们将创建一个函数，一旦接收到一个数据列表，就会将它们拆分到“bin”上。每一颗豆子都会被赋予特定的颜色。就经验而言，通常 5 到 7 个箱对数据分布有很好的感觉。我们将使用 6 个箱子和与这些箱子相关的 4 个不同的调色板。您必须一次选择其中一个媒体夹。</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="9dcf" class="lj lk iq mw b gy na nb l nc nd">def calc_color(data, color=None):<br/>        if color   == 1: color_sq =  <br/>                        ['#dadaebFF','#bcbddcF0','#9e9ac8F0',<br/>                        '#807dbaF0','#6a51a3F0','#54278fF0']; <br/>                        colors = 'Purples';<br/>        elif color == 2: color_sq = <br/>                        ['#c7e9b4','#7fcdbb','#41b6c4',<br/>                        '#1d91c0','#225ea8','#253494']; <br/>                        colors = 'YlGnBu';<br/>        elif color == 3: color_sq = <br/>                        ['#f7f7f7','#d9d9d9','#bdbdbd',<br/>                        '#969696','#636363','#252525']; <br/>                        colors = 'Greys';<br/>        elif color == 9: color_sq = <br/>                        ['#ff0000','#ff0000','#ff0000',<br/>                        '#ff0000','#ff0000','#ff0000']<br/>        else:            color_sq = <br/>                        ['#ffffd4','#fee391','#fec44f',<br/>                        '#fe9929','#d95f0e','#993404']; <br/>                        colors = 'YlOrBr';<br/>        new_data, bins = pd.qcut(data, 6, retbins=True, </span><span id="7edb" class="lj lk iq mw b gy nf nb l nc nd">        labels=list(range(6)))<br/>        color_ton = []<br/>        for val in new_data:<br/>            color_ton.append(color_sq[val]) <br/>        if color != 9:<br/>            colors = sns.color_palette(colors, n_colors=6)<br/>            sns.palplot(colors, 0.6);<br/>            for i in range(6):<br/>                print ("\n"+str(i+1)+': '+str(int(bins[i]))+<br/>                       " =&gt; "+str(int(bins[i+1])-1), end =" ")<br/>            print("\n\n   1   2   3   4   5   6")    <br/>        return color_ton, bins;</span></pre><p id="e767" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">函数<em class="la"> plot_comunas() </em>和<em class="la">plot _ map _ fill _ multiples _ ids</em>都应该被修改以利用这种新的彩色方案:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="7240" class="lj lk iq mw b gy na nb l nc nd">def plot_comunas_data(sf, title, comunas, data=None, <br/>                      color=None, print_id=False):<br/>    '''<br/>    Plot map with selected comunes, using specific color<br/>    '''<br/>    <br/>    color_ton, bins = calc_color(data, color)<br/>    df = read_shapefile(sf)<br/>    comuna_id = []<br/>    for i in comunas:<br/>        i = conv_comuna(i).upper()<br/>        comuna_id.append(df[df.NOM_COMUNA == <br/>                            i.upper()].index.get_values()[0])<br/>    plot_map_fill_multiples_ids_tone(sf, title, comuna_id, <br/>                                     print_id, <br/>                                     color_ton, <br/>                                     bins, <br/>                                     x_lim = None, <br/>                                     y_lim = None, <br/>                                     figsize = (11,9));</span></pre><p id="97b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而且，</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="dbc1" class="lj lk iq mw b gy na nb l nc nd">def plot_map_fill_multiples_ids_tone(sf, title, comuna,  <br/>                                     print_id, color_ton, <br/>                                     bins, <br/>                                     x_lim = None, <br/>                                     y_lim = None, <br/>                                     figsize = (11,9)):<br/>    '''<br/>    Plot map with lim coordinates<br/>    '''<br/>        <br/>    plt.figure(figsize = figsize)<br/>    fig, ax = plt.subplots(figsize = figsize)<br/>    fig.suptitle(title, fontsize=16)</span><span id="e0bb" class="lj lk iq mw b gy nf nb l nc nd">for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        ax.plot(x, y, 'k')<br/>            <br/>    for id in comuna:<br/>        shape_ex = sf.shape(id)<br/>        x_lon = np.zeros((len(shape_ex.points),1))<br/>        y_lat = np.zeros((len(shape_ex.points),1))<br/>        for ip in range(len(shape_ex.points)):<br/>            x_lon[ip] = shape_ex.points[ip][0]<br/>            y_lat[ip] = shape_ex.points[ip][1]<br/>        ax.fill(x_lon,y_lat, color_ton[comuna.index(id)])<br/>        if print_id != False:<br/>            x0 = np.mean(x_lon)<br/>            y0 = np.mean(y_lat)<br/>            plt.text(x0, y0, id, fontsize=10)<br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)<br/>        </span></pre><p id="d58f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了测试我们的新函数，让我们以之前圣地亚哥南部地区的形状列表为例，为每个形状关联一个常规值。我们将使用“调色板# 1(‘紫色’):</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="fb9a" class="lj lk iq mw b gy na nb l nc nd">south = ['alhué', 'calera de tango', 'buin', 'isla de maipo', 'el bosque', 'paine', 'la granja', 'pedro aguirre cerda', 'lo espejo', 'puente alto', 'san joaquín', 'san miguel', 'pirque', 'san bernardo', 'san ramón', 'la cisterna', 'talagante', 'la pintana']</span><span id="1c81" class="lj lk iq mw b gy nf nb l nc nd">data = [100, 2000, 300, 400000, 500, 600, 100, 2000, 300, 400, 500, 600, 100, 2000, 300, 400, 500, 600]</span><span id="42f9" class="lj lk iq mw b gy nf nb l nc nd">print_id = True # The shape id will be printed<br/>color_pallete = 1 # 'Purples'</span><span id="073b" class="lj lk iq mw b gy nf nb l nc nd">plot_comunas_data(sf, 'South', south, data, color_pallete, print_id)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/d8d70596e2f42a499721b5689895ead5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imenMz-RRZW0vTaMHvbazQ.png"/></div></div></figure><p id="abc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">酷！不是吗？；-)</p><h2 id="e7f4" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">11.绘制真实数据</h2><p id="379f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">为了完成关于如何使用 Python 处理地图的概述，让我们从 2017 年智利人口普查中获取一些真实数据，并应用在第 10 部分开发的那些函数。</p><p id="b055" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">读取数据集:</strong></p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="ac14" class="lj lk iq mw b gy na nb l nc nd">census_17 = pd.read_excel('./data/CENSO_2017_COMUNAS_RM.xlsx')<br/>census_17.shape</span><span id="a4a1" class="lj lk iq mw b gy nf nb l nc nd">Out:<br/>(52,7)</span></pre><p id="87f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的数据集有 52 行，每一行都包含与圣地亚哥的每一个 comunas 相关的数据。</p><p id="a922" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">查看数据集:</strong></p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/e28f2ab131df406b24cf6969499d44a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPC76m7z2gTBABH1O_49eA.png"/></div></div></figure><p id="a351" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如,“人物”一栏与居住在该特定社区的人数有关。“TOTAL_VIV”是那个 comuna 上的住宅总数，以此类推。</p><p id="1372" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">绘图:</strong></p><p id="3ab7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们应用我们的地图功能来分析圣地亚哥大都市区的人口分布情况。</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="90a2" class="lj lk iq mw b gy na nb l nc nd">title = 'Population Distrubution on Santiago Metropolitan Region'<br/>data = census_17.PERSONAS<br/>names = census_17.NOM_COMUNA</span><span id="e721" class="lj lk iq mw b gy nf nb l nc nd">plot_comunas_data(sf, title, names, data, 4, True)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/72d4cbca290a202ecfdd41f3571faeb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8f-3GlsEg6w1g2UKf22cgg.png"/></div></div></figure><p id="5f0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了！我们可以看到人口大量分布在都市圈的中心区域！东面(地图右边)，人口稀少，这是合乎逻辑的，因为这是伟大的安第斯山脉！西边和南边是农业区。</p><p id="0925" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再来一个！让我们画出圣地亚哥大都会区移民占总人口的百分比:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="f562" class="lj lk iq mw b gy na nb l nc nd">title = 'Percentual of immigrants over total population'<br/>data = census_17.INM_PERC<br/>names = census_17.NOM_COMUNA</span><span id="b40a" class="lj lk iq mw b gy nf nb l nc nd">plot_comunas_data(sf, title, names, data, 2, True)</span></pre><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/97b83248bd06b0c53606aa42827b739d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7I0MBLREWtU629b1GhJwA.png"/></div></div></figure><h2 id="678e" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kj ls lt lu kn lv lw lx kr ly lz ma mb bi translated">12.结论</h2><p id="b7fc" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">您可以意识到，最终您可以使用本文开发的 3 个函数，只用一行代码创建一个地图:</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="e4e3" class="lj lk iq mw b gy na nb l nc nd">plot_comunas_data() .... that calls:</span><span id="c222" class="lj lk iq mw b gy nf nb l nc nd">plot_map_fill_multiples_ids_tone() ... that calls:</span><span id="0764" class="lj lk iq mw b gy nf nb l nc nd">calc_color()</span></pre><p id="3d54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文为 Santiago Matropolitan 地区开发的内容可以很容易地适用于互联网上的任何矢量地图！</p><p id="7330" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，你可以去<a class="ae kw" href="https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html" rel="noopener ugc nofollow" target="_blank">美国人口普查局</a>下载美国各州的地图边界形状文件。继圣地亚哥之后，</p><pre class="lf lg lh li gt mv mw mx my aw mz bi"><span id="cbe5" class="lj lk iq mw b gy na nb l nc nd">shp_path = "./cb_2017_us_state_5m/cb_2017_us_state_5m.shp"<br/>sf = shp.Reader(shp_path)</span><span id="5318" class="lj lk iq mw b gy nf nb l nc nd"># Continental US<br/>y_lim = (23, 50) # lat <br/>x_lim = (-128, -65) # long</span><span id="50ab" class="lj lk iq mw b gy nf nb l nc nd">state_id = [0, 10, 3, 5, 6, 7, 8, 30]<br/>plot_map_fill_multiples_ids("US - States", state_id, sf, x_lim, <br/>                             y_lim, color = 'r', figsize = (15,9))</span></pre><p id="039d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以绘制:</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/f9bdb04707dc7c80da8cac6203a8bf51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Q25xUY42DrUaOjrTYGM4Q.png"/></div></div></figure><p id="8dbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那都是乡亲们！</p><p id="3db3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望您对数据科学的奇妙世界有了更多的了解！</p><p id="a296" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jupyter 笔记本和本文使用的所有数据可以从我的<a class="ae kw" href="https://github.com/Mjrovai/Python4DS/tree/master/Vector_Mapping_Python" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载。</p><p id="7cd6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的下一篇文章再见！</p><p id="eacf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">来自世界南部的 Saludos！</p><p id="00d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">马塞洛</p></div></div>    
</body>
</html>