<html>
<head>
<title>Web Scraping HTML Tables with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 对 HTML 表格进行 Web 抓取</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-scraping-html-tables-with-python-c9baba21059?source=collection_archive---------0-----------------------#2018-07-25">https://towardsdatascience.com/web-scraping-html-tables-with-python-c9baba21059?source=collection_archive---------0-----------------------#2018-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6270ff10af4edabefceb8bfbf0e3131e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZFg--cg7QWJzChjb3-4sw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Pokemon Database Website</figcaption></figure><p id="e001" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我们将尝试抓取在线口袋妖怪数据库(<a class="ae la" href="http://pokemondb.net/pokedex/all" rel="noopener ugc nofollow" target="_blank">http://pokemondb.net/pokedex/all</a>)。</p><h1 id="7faf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查 HTML</h1><p id="47c0" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">在前进之前，我们需要了解我们希望抓取的网站的结构。这可以通过点击<strong class="ke ir"> <em class="me">来完成，右击我们想要刮的元素，然后点击“检查”</em> </strong> <em class="me">。</em>出于我们的目的，我们将检查表格的元素，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/74b9d2d4a26c80e7c222a108eceafc98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tqw5Qr-Pg1YMpN5QrJw8g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Inspecting cell of HTML Table</figcaption></figure><p id="7d2d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">根据 HTML 代码，数据存储在<strong class="ke ir"> &lt; tr &gt;之后..&lt; /tr &gt; </strong>。这是行信息。每一行都有一个对应的<strong class="ke ir"> &lt; td &gt;..&lt;/TD&gt;/T11】或单元格数据信息。</strong></p><h1 id="19fe" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导入库</h1><p id="97f9" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们需要<strong class="ke ir">请求</strong>来获取网站的 HTML 内容，需要<strong class="ke ir">lxml.html</strong>来解析相关字段。最后，我们将把数据存储在熊猫数据帧上。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="671c" class="mo lc iq mk b gy mp mq l mr ms"><strong class="mk ir">import</strong> <strong class="mk ir">requests</strong><br/><strong class="mk ir">import</strong> <strong class="mk ir">lxml.html</strong> <strong class="mk ir">as</strong> <strong class="mk ir">lh</strong><br/><strong class="mk ir">import</strong> <strong class="mk ir">pandas</strong> <strong class="mk ir">as</strong> <strong class="mk ir">pd</strong></span></pre><h1 id="f61b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">刮掉表格单元格</h1><p id="5c48" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">下面的代码允许我们获得 HTML 表的 Pokemon 统计数据。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="800a" class="mo lc iq mk b gy mp mq l mr ms">url='http://pokemondb.net/pokedex/all'</span><span id="6901" class="mo lc iq mk b gy mt mq l mr ms"><em class="me">#Create a handle, page, to handle the contents of the website</em><br/>page = requests.get(url)</span><span id="c6de" class="mo lc iq mk b gy mt mq l mr ms"><em class="me">#Store the contents of the website under doc</em><br/>doc = lh.fromstring(page.content)</span><span id="e011" class="mo lc iq mk b gy mt mq l mr ms"><em class="me">#Parse data that are stored between &lt;tr&gt;..&lt;/tr&gt; of HTML</em><br/>tr_elements = doc.xpath('//tr')</span></pre><p id="cecf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了进行健全性检查，请确保所有行都具有相同的宽度。如果没有，我们得到的可能不仅仅是桌子。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="7164" class="mo lc iq mk b gy mp mq l mr ms"><em class="me">#Check the length of the first 12 rows</em><br/>[len(T) <strong class="mk ir">for</strong> T <strong class="mk ir">in</strong> tr_elements[:12]]</span></pre><p id="77e8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输出:<strong class="ke ir">【10，10，10，10，10，10，10，10，10，10，10，10】</strong></p><p id="6121" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">看起来我们所有的行正好有 10 列。这意味着在 tr_elements 上收集的所有数据都来自这个表。</p><h1 id="1d8f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">解析表格标题</h1><p id="60da" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">接下来，让我们将第一行解析为标题。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="c400" class="mo lc iq mk b gy mp mq l mr ms">tr_elements = doc.xpath('//tr')</span><span id="7b0b" class="mo lc iq mk b gy mt mq l mr ms"><em class="me">#Create empty list</em><br/>col=[]<br/>i=0</span><span id="f1e2" class="mo lc iq mk b gy mt mq l mr ms"><em class="me">#For each row, store each first element (header) and an empty list</em><br/><strong class="mk ir">for</strong> t <strong class="mk ir">in</strong> tr_elements[0]:<br/>    i+=1<br/>    name=t.text_content()<br/>    <strong class="mk ir">print</strong> '<strong class="mk ir">%d</strong>:"<strong class="mk ir">%s</strong>"'%(i,name)<br/>    col.append((name,[]))</span></pre><p id="7765" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输出:<br/><strong class="ke ir">1:“#”<br/>2:“名”<br/> 3:“型”<br/> 4:“总”<br/>5:“HP”<br/>6:“攻”<br/> 7:“防”<br/>8:“Sp。Atk" <br/> 9:"Sp。Def" <br/> 10:"速度"</strong></p><h1 id="3f53" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建熊猫数据框架</h1><p id="c783" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">每个头都和一个空列表一起被附加到一个元组中。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="235b" class="mo lc iq mk b gy mp mq l mr ms"><em class="me">#Since out first row is the header, data is stored on the second row onwards</em><br/><strong class="mk ir">for</strong> j <strong class="mk ir">in</strong> range(1,len(tr_elements)):<br/>    <em class="me">#T is our j'th row</em><br/>    T=tr_elements[j]<br/>    <br/>    <em class="me">#If row is not of size 10, the //tr data is not from our table </em><br/>    <strong class="mk ir">if</strong> len(T)!=10:<br/>        <strong class="mk ir">break</strong><br/>    <br/>    <em class="me">#i is the index of our column</em><br/>    i=0<br/>    <br/>    <em class="me">#Iterate through each element of the row</em><br/>    <strong class="mk ir">for</strong> t <strong class="mk ir">in</strong> T.iterchildren():<br/>        data=t.text_content() <br/>        <em class="me">#Check if row is empty</em><br/>        <strong class="mk ir">if</strong> i&gt;0:<br/>        <em class="me">#Convert any numerical value to integers</em><br/>            <strong class="mk ir">try</strong>:<br/>                data=int(data)<br/>            <strong class="mk ir">except</strong>:<br/>                <strong class="mk ir">pass</strong><br/>        <em class="me">#Append the data to the empty list of the i'th column</em><br/>        col[i][1].append(data)<br/>        <em class="me">#Increment i for the next column</em><br/>        i+=1</span></pre><p id="ab31" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了确保万无一失，让我们检查一下每列的长度。理想情况下，它们应该都相同。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="7bac" class="mo lc iq mk b gy mp mq l mr ms">[len(C) <strong class="mk ir">for</strong> (title,C) <strong class="mk ir">in</strong> col]</span></pre><p id="f4ff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输出:<strong class="ke ir">【800，800，800，800，800，800，800，800，800，800】</strong></p><p id="c118" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">完美！这表明我们的 10 列中的每一列正好有 800 个值。</p><p id="70de" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，我们准备创建数据帧:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="1474" class="mo lc iq mk b gy mp mq l mr ms">Dict={title:column <strong class="mk ir">for</strong> (title,column) <strong class="mk ir">in</strong> col}<br/>df=pd.DataFrame(Dict)</span></pre><p id="638c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">查看数据框中的前 5 个单元格:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="d0a1" class="mo lc iq mk b gy mp mq l mr ms">df.head()</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/ed870489e402e73d50af05913f9dd6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qb8db_MhOLty-aVmV9ILCw.png"/></div></div></figure><p id="da9d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你有它！现在你有了一个包含所有需要信息的熊猫数据框架！</p><h1 id="7eff" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">附加说明</h1><p id="7270" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">本教程是 3 部分系列的子集:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="cf52" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该系列包括:</p><ul class=""><li id="029a" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nc nd ne nf bi translated">抓取口袋妖怪网站</li><li id="effb" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">数据分析</li><li id="edc8" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">构建 GUI Pokedex</li></ul></div></div>    
</body>
</html>