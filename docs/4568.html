<html>
<head>
<title>Analyzing Stocks Using R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R 分析股票</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyzing-stocks-using-r-550be7f5f20d?source=collection_archive---------4-----------------------#2018-08-23">https://towardsdatascience.com/analyzing-stocks-using-r-550be7f5f20d?source=collection_archive---------4-----------------------#2018-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="34e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对亚马逊(Amazon)股票的一般和技术分析，以及使用随机漫步和蒙特卡罗方法的价格模拟。用 plotly 和 ggplot 完成的可视化。</h2></div><p id="5b6c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">亚马逊(Amazon)的股票在过去一年上涨了 95.6%(918.93 美元)，这使得亚马逊成为许多投资者的理想选择。许多分析师还认为，亚马逊(Amazon)的价值将在未来几年继续增长。虽然购买股票听起来很诱人，但应该进行详细的深入分析，以避免基于投机购买股票。</p><p id="1010" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我落实了我在统计学和 R 技能方面的知识，从技术面分析它的表现，预测它未来的价格。我非常依赖量化金融中常用的软件包，如 quant mod 和 xts 来实现我的目标。</p><p id="09fc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是我使用的软件包的完整列表:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="9968" class="ln lo it lj b gy lp lq l lr ls">library(quantmod)<br/>library(xts)<br/>library(rvest)<br/>library(tidyverse)<br/>library(stringr)<br/>library(forcats)<br/>library(lubridate)<br/>library(plotly)<br/>library(dplyr)<br/>library(PerformanceAnalytics)</span></pre><p id="f890" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我从获得亚马逊股票从 2008 年 8 月 1 日到 2018 年 8 月 17 日的日志回报开始分析:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="1adf" class="ln lo it lj b gy lp lq l lr ls">getSymbols("AMZN",from="2008-08-01",to="2018-08-17")</span><span id="8e16" class="ln lo it lj b gy lt lq l lr ls">AMZN_log_returns&lt;-AMZN%&gt;%Ad()%&gt;%dailyReturn(type='log')</span></pre><p id="ab36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">日志返回在这个阶段没有意义，但它实际上是我分析的基础。我稍后会解释。</p><h1 id="6eac" class="lu lo it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">技术分析</h1><p id="b34f" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我首先对亚马逊的股票进行了技术分析:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="8d95" class="ln lo it lj b gy lp lq l lr ls">AMZN%&gt;%Ad()%&gt;%chartSeries()</span><span id="f978" class="ln lo it lj b gy lt lq l lr ls">AMZN%&gt;%chartSeries(TA='addBBands();addVo();addMACD()',subset='2018')</span></pre><p id="ebca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个图表系列图很简单，因为它显示了亚马逊的价格图表:</p><figure class="le lf lg lh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mq"><img src="../Images/e55b7944f33a6a79c22ddfa2b681b484.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gh-SmvyXukczDWxYRWXD_Q.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Price Chart</figcaption></figure><p id="6e7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个图表系列显示了仅在 2018 年的布林线图、布林线百分比变化、成交量和移动平均线收敛趋势:</p><figure class="le lf lg lh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mq"><img src="../Images/35b08cc70ce6ce802563049e37fd7b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adRjBqcR_VrtGeEtATxCHg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Technical Analysis</figcaption></figure><p id="f1b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">均线对于理解亚马逊(Amazon)的技术图表非常重要。它通过平均股票价格来平滑每日价格波动，并有效地识别潜在趋势。</p><p id="f65e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">布林线图表绘制了两个远离移动平均线的标准偏差，用于衡量股票的波动性。成交量图显示了其股票每天的交易情况。均线收敛背离给技术分析师买入/卖出信号。经验法则是:如果跌破该线，就该卖出了。如果它上升到线以上，它正在经历一个上升的势头。</p><p id="3901" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的图表通常用来决定是否买/卖股票。由于我不是一个认证的金融分析师，我决定做额外的研究来说服自己。</p><h1 id="6c99" class="lu lo it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">比较</h1><p id="8777" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我实现了公开比较的基本原则。我想看看亚马逊(Amazon)与其他热门科技股如脸书(Alibaba)、谷歌(Google)和苹果(Apple)相比表现如何。</p><p id="cbcf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我首先比较了每只股票的风险/回报率。我取了对数回报的平均值和对数回报的标准差。均值被认为是一致的回报率，而标准差是购买股票带来的风险。我用 plotly，一个交互式可视化工具，来说明我的发现。</p><figure class="le lf lg lh gt mr"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Risk vs Reward chart</figcaption></figure><p id="cd88" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谷歌(GOOGL)股票风险最低，回报也最低。脸书(Alibaba)和亚马逊(Amazon)的风险一样大，但后者的回报更高。如果你喜欢冒险，特斯拉(TSLA)是一个很好的投资，因为它有高风险和高回报。但如果你像我一样厌恶风险，苹果(AAPL)是最好的选择。</p><p id="ffce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个流行的投资原则是分散投资:不要把所有的鸡蛋放在一个篮子里。购买股票时，你应该尽量购买相关性小的股票，因为你想最大化总回报率。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="7b09" class="ln lo it lj b gy lp lq l lr ls">library(PerformanceAnalytics)</span><span id="7fb9" class="ln lo it lj b gy lt lq l lr ls">data&lt;-cbind(diff(log(Cl(AMZN))),diff(log(Cl(GOOGL))),diff(log(Cl(AAPL))),diff(log(Cl(FB))))</span><span id="bc6b" class="ln lo it lj b gy lt lq l lr ls">chart.Correlation(data)</span></pre><figure class="le lf lg lh gt mr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/a78cc432bf2f63806ffbb58013cd93e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*KLTJ0OvIUzlE9rwAuRQ8Gg.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Correlation Chart</figcaption></figure><p id="51c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">脸书(FB)和苹果(AAPL)的相关性最小，为 0.24，而亚马逊(Amazon)和谷歌(Google)的相关性最高，为 0.56。每只股票之间的相关性很高，因为它们都是科技股。最好购买不同行业的股票，以真正实现风险最小化和回报率最大化。</p><h1 id="efe4" class="lu lo it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">价格预测</h1><p id="1c73" class="pw-post-body-paragraph ki kj it kk b kl ml ju kn ko mm jx kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我接着预测了亚马逊(Amazon)股票的价格。我通过随机漫步理论和蒙特卡罗方法实现了这一点。</p><p id="9cf2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随机游走理论适合于股票的价格预测，因为它植根于这样一种信念，即过去的表现不是未来结果的指标，价格波动无法准确预测。</p><p id="de6e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我模拟了亚马逊(Amazon)股票 252*4 个交易日的价格(因为一年有大约 252 个交易日)。这是 4 年的交易价值！</p><p id="13ac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我使用我之前从对数收益中获得的数据生成价格，并使用指数增长率来预测股票每天将增长多少。增长率是随机生成的，取决于 mu 和 sigma 的输入值。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="14f6" class="ln lo it lj b gy lp lq l lr ls">mu&lt;-AMZN_mean_log # mean of log returns<br/>sig&lt;-AMZN_sd_log # sd of log returns </span><span id="c123" class="ln lo it lj b gy lt lq l lr ls">price&lt;-rep(NA,252*4)</span><span id="8bdf" class="ln lo it lj b gy lt lq l lr ls">#start simulating prices</span><span id="d12c" class="ln lo it lj b gy lt lq l lr ls">for(i in 2:length(testsim)){<br/>  price[i]&lt;-price[i-1]*exp(rnorm(1,mu,sig))<br/>}</span><span id="baf1" class="ln lo it lj b gy lt lq l lr ls">random_data&lt;-cbind(price,1:(252*4))<br/>colnames(random_data)&lt;-c("Price","Day")<br/>random_data&lt;-as.data.frame(random_data)</span><span id="38f8" class="ln lo it lj b gy lt lq l lr ls">random_data%&gt;%ggplot(aes(Day,Price))+geom_line()+labs(title="Amazon (AMZN) price simulation for 4 years")+theme_bw()</span></pre><figure class="le lf lg lh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nf"><img src="../Images/f3549fb0b359fce69d437e1a62b4fbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSQnPvV9WoYKKVggDYvfRQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Price Preidction with Random Walk</figcaption></figure><p id="d952" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上图显示了大约 1000 个交易日的模拟价格。如果你注意我的代码，我没有包含 set.seed()。模拟价格将会改变，并取决于我的种子。为了得出稳定的预测，价格模拟需要使用蒙特卡罗方法，在这种方法中，价格被重复模拟以确保准确性。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="11bd" class="ln lo it lj b gy lp lq l lr ls">N&lt;-500<br/>mc_matrix&lt;-matrix(nrow=252*4,ncol=N)<br/>mc_matrix[1,1]&lt;-as.numeric(AMZN$AMZN.Adjusted[length(AMZN$AMZN.Adjusted),])</span><span id="a9a6" class="ln lo it lj b gy lt lq l lr ls">for(j in 1:ncol(mc_matrix)){<br/>  mc_matrix[1,j]&lt;-as.numeric(AMZN$AMZN.Adjusted[length(AMZN$AMZN.Adjusted),])<br/>for(i in 2:nrow(mc_matrix)){<br/>  mc_matrix[i,j]&lt;-mc_matrix[i-1,j]*exp(rnorm(1,mu,sig))<br/>}<br/>}</span><span id="6e28" class="ln lo it lj b gy lt lq l lr ls">name&lt;-str_c("Sim ",seq(1,500))<br/>name&lt;-c("Day",name)</span><span id="09f7" class="ln lo it lj b gy lt lq l lr ls">final_mat&lt;-cbind(1:(252*4),mc_matrix)<br/>final_mat&lt;-as.tibble(final_mat)<br/>colnames(final_mat)&lt;-name</span><span id="d9e7" class="ln lo it lj b gy lt lq l lr ls">dim(final_mat) #1008 501</span><span id="0f63" class="ln lo it lj b gy lt lq l lr ls">final_mat%&gt;%gather("Simulation","Price",2:501)%&gt;%ggplot(aes(x=Day,y=Price,Group=Simulation))+geom_line(alpha=0.2)+labs(title="Amazon Stock (AMZN): 500 Monte Carlo Simulations for 4 Years")+theme_bw()</span></pre><figure class="le lf lg lh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ng"><img src="../Images/db3a3d5418944c1dca2edcc191a65ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75rnDezwg2gQnjrYY9kOJQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Price Prediction with Monte Carlo</figcaption></figure><p id="4db1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的图表并不直观，所以我在四年后用亚马逊(Amazon)的价格百分比最终确定了我的发现。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4f95" class="ln lo it lj b gy lp lq l lr ls">final_mat[500,-1]%&gt;%as.numeric()%&gt;%quantile(probs=probs)</span></pre><figure class="le lf lg lh gt mr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f9f2c6d91b3d9f209e88428dbfc49993.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*V4vaKURwYU44M7PKy3X33g.png"/></div></figure><p id="a63b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要相信我的话，但从我的模拟结果来看，亚马逊(Amazon)的股票可能会在四年内达到 11198.10 美元的价格，或者跌至 834.60 美元的低点。你可以将我的发现与亚马逊(Amazon)的 CAGR 进行比较，看看我的发现是否有意义。但是如果有机会，我会马上买下这只股票！</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="2cc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读！如果你有任何反馈/想聊天，请告诉我。你可以打电话给我</p><p id="a6b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">推特:@joygraceeya</p><p id="586d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">电子邮件:joygh174@gmail.com</p><p id="43e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在这里看我的完整代码和参考文献<a class="ae np" href="https://github.com/joygraciacia/mcmc-stock" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>