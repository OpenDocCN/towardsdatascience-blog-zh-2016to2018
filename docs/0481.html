<html>
<head>
<title>Building a NARX in MATLAB to forecast time series data.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 MATLAB 中建立 NARX 来预测时间序列数据。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-narx-in-matlab-to-forecast-time-series-data-f60561864874?source=collection_archive---------2-----------------------#2017-05-09">https://towardsdatascience.com/building-a-narx-in-matlab-to-forecast-time-series-data-f60561864874?source=collection_archive---------2-----------------------#2017-05-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/12fb4c998ea31fc5924625a50a7aa818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qRPmYAfuB71S9UibV4ncg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">The Kenduskeag at high flows. At lower flows (you can literally walk out to that rock in the middle).</figcaption></figure><p id="0a07" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">去年我发表了一篇<a class="ae la" href="https://medium.com/@paddlesoft/forecasting-the-flow-of-the-kenduskeag-a731c5d35aa6" rel="noopener">文章</a>(在<a class="lb lc ep" href="https://medium.com/u/ffe5d69df3f?source=post_page-----f60561864874--------------------------------" rel="noopener" target="_blank"> PaddleSoft </a>账号上)，在文章中我描述了使用 MATLAB 中内置的 NARX 预测 Kenduskeag 流的流量。然而，我故意没有包括那么多技术细节，因为我试图为普通读者写。好了，我现在已经创建了一个完整的教程，关于如何在 MATLAB 中建立一个带有外源输入的非线性自回归网络(NARX)来预测时间序列数据。</p><h2 id="23d3" class="ld le iq bd lf lg lh dn li lj lk dp ll kn lm ln lo kr lp lq lr kv ls lt lu lv bi translated">教程</h2><p id="d33a" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz ij bi translated">这个过程实际上相当简单:导入数据，创建模型，训练模型，然后进行预测。</p><p id="f200" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个<a class="ae la" href="https://github.com/isaacmg/lstm_stream/blob/master/height.csv" rel="noopener ugc nofollow" target="_blank"> CSV </a>是我们将在教程中使用的 CSV 类型的一个例子。基本上有三列:高度、温度和降雨量。我们希望使用先前的高度以及温度和降雨量来预测当前的高度。</p><ol class=""><li id="c79d" class="mb mc iq ke b kf kg kj kk kn md kr me kv mf kz mg mh mi mj bi translated"><strong class="ke ir">导入数据</strong></li></ol><p id="1749" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我们必须导入数据。我们将使用一个简单的函数来实现:</p><figure class="mk ml mm mn gt jr"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="b154" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们用<code class="fe mq mr ms mt b">[X_input,height]=load_data('height.csv')</code>调用这个函数(注意，即使我们使用 xlsread，它仍然可以处理 CSV 文件)。</p><p id="208f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 2。培训</strong></p><p id="74a8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们看看我们的培训代码:</p><figure class="mk ml mm mn gt jr"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="d3fb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们稍微分解一下这段代码。我们要做的第一件事是使用 tonndata 函数将我们的输入放入单元格数组。接下来，我们必须选择我们的训练函数。我个人在贝叶斯正则化(即 trainbr)方面取得了最大的成功，但是，这可能需要更长的时间。之后，p <a class="ae la" href="https://www.mathworks.com/help/nnet/ref/preparets.html" rel="noopener ugc nofollow" target="_blank"> reparets </a>将为我们的 NARX (24)准备正确格式的数据。</p><p id="988f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输入延迟和反馈延迟参数非常重要，将极大地影响您的预测。我最初选择的方法是绘制降雨量与高度变化的曲线图，以确定降雨量何时对河流高度影响最大。然后我试验了各种配置。也有更多的数学方法来确定它使用互相关<a class="ae la" href="https://www.mathworks.com/matlabcentral/answers/84271-narx-time-delay-estimation" rel="noopener ugc nofollow" target="_blank">(见 MATLAB 论坛回答这里</a>)。然而，现在，你可以试着看看什么是最好的。</p><p id="2ad6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，我们在第 28–30 行做出相当标准的决策，如训练/验证/测试分割，最后训练网络(第 30 行)。代码的其余部分是可选的，所以我不会详细介绍。但是，请随意尝试，了解一下有哪些可用的东西。</p><p id="aed9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 3。做出预测</strong></p><p id="f95a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，为了在 CSV 上进行预测，我们将使用新创建的 height_net。我个人发现最简单的方法是将测试数据分成两个 CSV:一个包含 stamps 0:length-240 的输入(temp 和 rain)和高度值，另一个只包含 length-240:length 的输入(*其中 length 是测试 CSV 中的行数)。这大致类似于 10 天天气预报的预测(即使用一个已知的长时间序列，然后预测从天气 API 获得的 10*24 个时间戳)。你可以很容易地在你的 MATLAB 代码中分割数据，但是我发现这样做最简单。考虑到这一点，下面是我们的预测代码:</p><figure class="mk ml mm mn gt jr"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="22a2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将已知的时间戳序列传入<em class="mu"> open </em> height net，得到<code class="fe mq mr ms mt b">xf</code>和<code class="fe mq mr ms mt b">af</code>。然后我们关闭网络进行多重预测(12)。最后，我们进行实际预测(13)。你现在可以通过看 y2 或者我们重新分配的 unknownY 来看预测。</p><p id="28cb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我希望这个例子足以让你熟悉 MATLAB 中的 NARX(s)。在未来，我希望更深入地研究 NARXs 相对于 LSTMs 等其他 rnn 的优势。</p><p id="8e67" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可以关注我，也可以查看我写的更多内容。</p></div></div>    
</body>
</html>