<html>
<head>
<title>Docker for Data Science Without the Hassle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松获得数据科学的 Docker</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-without-the-hassle-b98447caedd8?source=collection_archive---------12-----------------------#2018-12-18">https://towardsdatascience.com/docker-without-the-hassle-b98447caedd8?source=collection_archive---------12-----------------------#2018-12-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/793c85f5ef472c272cc357254a9e2dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-fkz8Gme4BGpOmF_Oxz2g.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk"><a class="ae jd" href="https://www.pexels.com/photo/black-and-white-dolphin-on-body-of-water-during-daytime-51964/" rel="noopener ugc nofollow" target="_blank">(Source)</a></figcaption></figure><div class=""/><div class=""><h2 id="e6e7" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">如何使用 repo2docker 自动构建 docker 映像</h2></div><p id="3feb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您没有使用<a class="ae jd" rel="noopener" target="_blank" href="/docker-for-data-science-4901f35d7cf9"> docker 进行数据科学</a>，那么您可能应该使用。Docker 最好被认为是一个运行映像——环境——的轻型虚拟机，其中包含项目的所有库、数据和代码。Docker 对于可再生的数据科学来说是非常棒的，因为它使得共享代码更加容易:不用发送代码和需求，你可以制作一个 Docker 映像，当其他人运行你的映像时，你的项目就可以在他们的机器上工作。这解决了每当人们试图共享代码时不可避免地出现的“依赖地狱”问题:“它在我的机器上工作”现在是一个过去的短语，感谢 Docker。</p><p id="d2c1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">即使拥有 Docker 的明显优势，许多数据科学家仍然没有接受这项技术。制作 Docker 映像需要<a class="ae jd" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">编写一个</a> <code class="fe lr ls lt lu b"><a class="ae jd" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">Dockerfile</a>with the</code>命令来构建映像。虽然这并不困难，但是<a class="ae jd" href="https://pip.pypa.io/en/stable/reference/pip_freeze/" rel="noopener ugc nofollow" target="_blank">仅仅</a> <code class="fe lr ls lt lu b"><a class="ae jd" href="https://pip.pypa.io/en/stable/reference/pip_freeze/" rel="noopener ugc nofollow" target="_blank">pip freeze &gt; requirements.txt</a></code>一个 Python 环境并使用它要容易得多(不是最佳实践，但总比没有好)。幸运的是，多亏了 Jupyter 项目<a class="ae jd" href="https://github.com/jupyter" rel="noopener ugc nofollow" target="_blank">的<code class="fe lr ls lt lu b"><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">repo2docker</a></code>工具，从 GitHub 库创建 Docker 映像的过程现在只需要一行代码。</a></p><h2 id="bec4" class="lv lw jg bd lx ly lz dn ma mb mc dp md le me mf mg li mh mi mj lm mk ml mm mn bi translated"><strong class="ak">使用方法:极短版本</strong></h2><ol class=""><li id="17f6" class="mo mp jg kx b ky mq lb mr le ms li mt lm mu lq mv mw mx my bi translated"><a class="ae jd" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">安装对接器</a></li><li id="cd73" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated"><a class="ae jd" href="https://github.com/jupyter/repo2docker" rel="noopener ugc nofollow" target="_blank">安装 repo2docker </a> : <code class="fe lr ls lt lu b">pip install jupyter-repo2docker</code></li><li id="0292" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">运行<code class="fe lr ls lt lu b">repo2docker repo-link</code>并在几分钟内获得图像:</li></ol><pre class="ne nf ng nh gt ni lu nj nk aw nl bi"><span id="20be" class="lv lw jg lu b gy nm nn l no np">repo2docker <a class="ae jd" href="https://github.com/WillKoehrsen/feature-selector" rel="noopener ugc nofollow" target="_blank">https://github.com/WillKoehrsen/feature-selector</a></span></pre><p id="2c7d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果这对你来说足够了，那就去<a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">开始吧</a>！否则，请继续阅读更多细节。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><h2 id="34ee" class="lv lw jg bd lx ly lz dn ma mb mc dp md le me mf mg li mh mi mj lm mk ml mm mn bi translated">Repo2Docker 基础知识</h2><p id="c2b2" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le nx lg lh li ny lk ll lm nz lo lp lq ij bi translated">Repo2Docker 的工作方式是检查 GitHub 库中的<a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html" rel="noopener ugc nofollow" target="_blank">任意数量的配置文件</a>，例如 Python 库的<code class="fe lr ls lt lu b"><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html#requirements-txt-install-a-python-environment" rel="noopener ugc nofollow" target="_blank">requirements.txt</a></code><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html#requirements-txt-install-a-python-environment" rel="noopener ugc nofollow" target="_blank"/>、Conda 的<code class="fe lr ls lt lu b"><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html#environment-yml-install-a-python-environment" rel="noopener ugc nofollow" target="_blank">environment.yml</a></code><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html#environment-yml-install-a-python-environment" rel="noopener ugc nofollow" target="_blank"/>或构建 Python 包的<code class="fe lr ls lt lu b"><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html#setup-py-install-python-packages" rel="noopener ugc nofollow" target="_blank">setup.py</a></code><a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/config_files.html#setup-py-install-python-packages" rel="noopener ugc nofollow" target="_blank"/>。然后，它将这些内容翻译成 Dockerfile 文件并构建图像。最后，它运行映像并启动一个 Jupyter 服务器，在那里您可以访问 Jupyter 笔记本(甚至 RStudio)。所有这些都在一个命令中完成！</p><p id="3e86" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有关 repo2docker 的更多信息，请查看:<a class="ae jd" href="https://blog.jupyter.org/introducing-repo2docker-61a593c0752d" rel="noopener ugc nofollow" target="_blank"> Intro post </a>、<a class="ae jd" href="https://repo2docker.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> documentation </a>或 GitHub <a class="ae jd" href="https://github.com/jupyter/repo2docker" rel="noopener ugc nofollow" target="_blank"> repository </a>(随时欢迎投稿)。(repo2docker 也是 <code class="fe lr ls lt lu b"><a class="ae jd" href="https://mybinder.org/" rel="noopener ugc nofollow" target="_blank">binder</a></code>背后的技术<a class="ae jd" href="https://mybinder.org/" rel="noopener ugc nofollow" target="_blank">，Jupyter 的另一个项目值得一试。)</a></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><h2 id="3d06" class="lv lw jg bd lx ly lz dn ma mb mc dp md le me mf mg li mh mi mj lm mk ml mm mn bi translated">如何使用:稍微友好的版本</h2><ol class=""><li id="f43c" class="mo mp jg kx b ky mq lb mr le ms li mt lm mu lq mv mw mx my bi translated">首先安装 docker。您的<a class="ae jd" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">机器的说明可以在这里找到</a>。<a class="ae jd" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank"> docker 入门指南</a>对于学习 docker 如何工作是有用的，尽管我们不需要细节来有效地使用它</li><li id="1504" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">确保 docker 正在运行。如果<code class="fe lr ls lt lu b">docker run hello-world</code>显示信息<code class="fe lr ls lt lu b">Hello from Docker!</code>，那么你就可以开始了。</li><li id="e654" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">用<code class="fe lr ls lt lu b">pip install jupyter-repo2docker</code>安装<code class="fe lr ls lt lu b">repo2docker</code>。通过键入<code class="fe lr ls lt lu b">repo2docker -h</code>调出帮助选项，确认它可以工作。</li><li id="5dfe" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">找到一个至少有一个<code class="fe lr ls lt lu b">requirements.txt</code>文件的 GitHub 库。例如，我正在为<code class="fe lr ls lt lu b"><a class="ae jd" href="https://github.com/WillKoehrsen/feature-selector" rel="noopener ugc nofollow" target="_blank">feature-selector</a></code>使用 repo，这是我为<a class="ae jd" rel="noopener" target="_blank" href="/a-feature-selection-tool-for-machine-learning-in-python-b64dd23710f0">机器学习特征选择</a>制作的一个工具，它有一个<code class="fe lr ls lt lu b">setup.py</code>文件。</li><li id="97b3" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">运行 magic line <code class="fe lr ls lt lu b">repo2docker repo-link</code>，它会自动创建一个新的 docker 映像，安装所有需要的依赖项，最后在环境中启动一个 jupyter 服务。这可能需要 5-10 分钟，但请记住，这可以节省您的工作时间和挫败感。</li><li id="1572" class="mo mp jg kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">命令完成后，复制 url 并导航到 docker 容器中运行的 Jupyter 记事本。</li></ol><p id="8e1d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">命令和最终输出将如下所示:</p><pre class="ne nf ng nh gt ni lu nj nk aw nl bi"><span id="42a8" class="lv lw jg lu b gy nm nn l no np">repo2docker <a class="ae jd" href="https://github.com/WillKoehrsen/feature-selector" rel="noopener ugc nofollow" target="_blank">https://github.com/WillKoehrsen/feature-selector</a></span><span id="de21" class="lv lw jg lu b gy oa nn l no np">... Lots of steps ...<br/>... while your Docker image ...<br/>... is built and run ...</span><span id="150a" class="lv lw jg lu b gy oa nn l no np">Final output:</span><span id="a7c0" class="lv lw jg lu b gy oa nn l no np">Copy/paste this URL into your browser when you connect for the first time,<br/>    to login with a token:<br/>        <a class="ae jd" href="http://127.0.0.1:65375/?token=c23a4e26bb5a8cfd7c818eb2747198f207bead7512b71eb1" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:65375/?token=</a>randomstringofcharacters</span></pre><p id="eeb9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行笔记本，惊叹使用 docker 和<code class="fe lr ls lt lu b">repo2docker</code>是多么容易</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/acdba8a69b6cc0ddd75c5efab5621830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WVnkZ437niyYSyTiRKIr4g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Notebook running in a docker container</figcaption></figure><h2 id="08b0" class="lv lw jg bd lx ly lz dn ma mb mc dp md le me mf mg li mh mi mj lm mk ml mm mn bi translated">重要注意事项</h2><p id="4a7c" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le nx lg lh li ny lk ll lm nz lo lp lq ij bi translated">docker 容器运行后，打开一个新的 shell 并键入<code class="fe lr ls lt lu b"><a class="ae jd" href="https://docs.docker.com/engine/reference/commandline/ps/" rel="noopener ugc nofollow" target="_blank">docker ps</a></code>来查看容器进程。获取<code class="fe lr ls lt lu b">CONTAINER_ID</code>然后运行<code class="fe lr ls lt lu b">docker exec -it CONTAINER_ID /bin/bash</code>在运行容器中打开一个<a class="ae jd" href="https://docs.docker.com/engine/reference/commandline/exec/" rel="noopener ugc nofollow" target="_blank">交互外壳</a> <em class="oc">。在 shell 中，您可以在命令行上做任何事情，比如列出文件、运行 python 脚本或监控进程。</em></p><p id="7b80" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当您完成会话后，您可以使用 ctrl + c 或<code class="fe lr ls lt lu b"><a class="ae jd" href="https://docs.docker.com/engine/reference/commandline/stop/" rel="noopener ugc nofollow" target="_blank">docker stop</a> CONTAINER ID</code>关闭 Jupyter 服务器和容器。好消息是，当我们想要重启容器时，我们不必再次重新运行<code class="fe lr ls lt lu b">repo2docker repo-link</code>。整个环境被保存为我们机器上的 docker 图像，我们可以用<code class="fe lr ls lt lu b">docker image list</code>看到。</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/3f6ae7083bc60d1fbe5a9adcf8711647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRDjtv14d41Av4cUc3tb5w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Output of docker image list</figcaption></figure><p id="8629" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要再次启动该容器，选择<code class="fe lr ls lt lu b">IMAGE ID</code>并运行命令:</p><pre class="ne nf ng nh gt ni lu nj nk aw nl bi"><span id="cf53" class="lv lw jg lu b gy nm nn l no np">docker run -p 12345:8888 IMAGE ID jupyter notebook --ip 0.0.0.0 </span></pre><p id="3d45" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将启动容器，将容器的端口 8888 发布到主机端口 12345，并运行可在 127.0.0.1:12345 访问的 jupyter 笔记本。您可以再次在浏览器中访问 Jupyter 笔记本，所有要求都已准备就绪。(感谢 t <a class="ae jd" href="https://github.com/jupyter/repo2docker/issues/450" rel="noopener ugc nofollow" target="_blank">他在 GitHub </a>上的问题提供了这个解决方案。此外，更多选项请参见<a class="ae jd" href="https://docs.docker.com/engine/reference/run/" rel="noopener ugc nofollow" target="_blank"> docker 上的文档</a></p><p id="4782" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe lr ls lt lu b">repo2docker</code>正在<a class="ae jd" href="https://github.com/jupyter/repo2docker" rel="noopener ugc nofollow" target="_blank">持续工作</a>，如果 GitHub 库中的配置文件没有改变，有<a class="ae jd" href="https://github.com/jupyter/repo2docker/pull/511" rel="noopener ugc nofollow" target="_blank">主动拉取请求</a>自动使用预建镜像。上述命令始终有效，也可用于不是通过<code class="fe lr ls lt lu b">repo2docker</code>创建的图像。一旦你从<code class="fe lr ls lt lu b">repo2docker</code>学会了基础知识，试着阅读一些<a class="ae jd" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank"> Docker 指南</a>，看看如何有效地利用 Docker。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><h1 id="b9b3" class="oe lw jg bd lx of og oh ma oi oj ok md km ol kn mg kp om kq mj ks on kt mm oo bi translated">结论</h1><p id="5c07" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le nx lg lh li ny lk ll lm nz lo lp lq ij bi translated">正如在 Keras 中构建神经网络时不必担心反向传播的细节一样，您也不必掌握复杂的命令来实践可再现的数据科学。幸运的是，数据科学的工具继续变得更好，使得采用最佳实践更容易，并有望鼓励更多不同的人进入该领域。</p><p id="f966" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Repo2docker 是这些技术中的一种，它将使你作为一名数据科学家更加高效。当然，你可以是那个满腹牢骚的老人:“我花了那么多时间学习 docker，而现在这些年轻人甚至不会写 docker 文件”，或者你可以走大路，庆祝不断增加的抽象层。这些层将您从繁琐的细节中分离出来，使您能够专注于数据科学的最佳部分:通过数据做出更好的决策。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="58cd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一如既往，我欢迎反馈和建设性的批评。可以通过推特<a class="ae jd" href="http://twitter.com/@koehrsen_will" rel="noopener ugc nofollow" target="_blank"> @koehrsen_will </a>联系到我。</p></div></div>    
</body>
</html>