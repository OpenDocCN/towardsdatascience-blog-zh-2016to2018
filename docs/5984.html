<html>
<head>
<title>3D Visualization of NN layers with TensorSpace.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorSpace.js 实现神经网络图层的三维可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3d-visualization-of-nn-layers-with-tensorspace-js-7a8ef5440125?source=collection_archive---------19-----------------------#2018-11-19">https://towardsdatascience.com/3d-visualization-of-nn-layers-with-tensorspace-js-7a8ef5440125?source=collection_archive---------19-----------------------#2018-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7e03768f37f049af0f7475da30b974ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAgb87rFy4R-lhfe5Vo2Fw.png"/></div></div></figure><h2 id="786a" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h2><p id="665c" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">你有没有想过:“CNN 内部到底发生了什么？”，“我的模型学习了哪些功能？”，“如何正确地可视化我的深层网络的中间层，而无需编写大量代码和安装几十个库？”。</p><p id="245c" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">如果你的答案是肯定的——tensor space . js 是你梦寐以求的图书馆！</p><h2 id="3e8b" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">TLDR:</h2><ul class=""><li id="4c6a" class="lu lv iq kw b kx ky lb lc kh lw kl lx kp ly lo lz ma mb mc bi translated"><a class="ae md" href="https://github.com/asakryukin/TSTutorial/tree/master" rel="noopener ugc nofollow" target="_blank"> GitHub 教程代码</a></li><li id="fdaf" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated"><a class="ae md" href="https://tensorspace.org/" rel="noopener ugc nofollow" target="_blank"> TensorSpace.js 网页</a></li></ul><p id="bba0" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">tensor space . js——是一个神奇的框架，可以在您的浏览器中实现神经网络层的 3D 可视化！它的第一个版本刚刚在一周前发布(如果你正在 2018 年 11 月阅读这篇文章)，可以与 Tensorflow、Tensorflow.js 和 Keras 模型配合使用。</p><p id="2fd0" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">在本文中，我将向您介绍可视化张量流模型的基本步骤。我将解释您应该如何训练和导出您的模型以与 TensorSpace.js 兼容，以及我将解释如何在您的浏览器中可视化保存的模型。</p><h2 id="9d9d" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">先决条件</h2><p id="a445" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">我假设您已经安装了 Tensorflow。</p><p id="fa3d" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">另外，为了保持简短，我不会详细介绍 TensorSpace.js 的安装。这相当简单，你可以使用我的<a class="ae md" href="https://github.com/asakryukin/TSTutorial/tree/master" rel="noopener ugc nofollow" target="_blank"> GitHub 代码</a>模板，并安装所有 TensorSpace.js 依赖项。</p><h2 id="a0e2" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">模特培训</h2><p id="65c4" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">为了简单起见，这里我们将使用 Tensorflow 训练一个简单的 CNN 模型来识别 MNIST 数字。</p><p id="bfb6" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">首先，让我们创建一个 DataHandler 类来处理我们的数据:</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="1e50" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">该类从 csv 文件中加载 MNIST 数据，将其分成训练集和测试集，并提供训练批次。</p><p id="ba12" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">接下来，我们将创建一个模型类来创建、训练和保存我们的模型。这里我们将使用具有 3 个卷积层和 2 个全连接层的简单 CNN。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="386e" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在，在训练您的模型时，您应该记住一些重要的注意事项:</p><ol class=""><li id="6c6e" class="lu lv iq kw b kx lp lb lq kh mp kl mq kp mr lo ms ma mb mc bi translated">为您想要可视化的所有层定义“名称”(因为您将在模型转换和网络可视化阶段使用这些名称)。注意，这里我们使用的是纯 tensorflow 方法，还有像<code class="fe mt mu mv mw b">tf.layers.conv2d</code>这样的包装器，实际上是在后台创建多个变量。</li><li id="b099" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo ms ma mb mc bi translated">使用<code class="fe mt mu mv mw b">tf.saved_model</code>方法导出你的模型，而不是<code class="fe mt mu mv mw b">tf.train.</code></li></ol><p id="86cc" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">在这里，我们希望可视化 3 个卷积层、相应的最大池层、密集层和 softmax 函数后的模型输出。</p><p id="bd79" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">此外，我们输出图形变量列表只是为了确保我们知道想要显示的变量的正确名称。我们将使用以下变量:</p><ul class=""><li id="69da" class="lu lv iq kw b kx lp lb lq kh mp kl mq kp mr lo lz ma mb mc bi translated">l1/Relu</li><li id="752f" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l1max</li><li id="e80b" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l2/Relu</li><li id="6acd" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l2max</li><li id="bfd4" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l3/Relu</li><li id="7daa" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l3max</li><li id="8d05" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l4/Relu</li><li id="2a12" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">l5/BiasAdd</li><li id="1b7c" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">输出</li></ul><p id="b16d" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">最后，我们还将输出。验证图像的 json 文件，我们将使用它进行流可视化。</p><h2 id="fe9a" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">模型导出</h2><p id="aaca" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">训练完我们的模型后，您应该会得到包含以下内容的模型文件夹:</p><ul class=""><li id="784b" class="lu lv iq kw b kx lp lb lq kh mp kl mq kp mr lo lz ma mb mc bi translated">变量</li><li id="1099" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">——variables . data-00000/00001</li><li id="3d00" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">— —变量.索引</li><li id="491a" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">已保存 _ 模型. pb</li></ul><p id="d4d6" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在我们需要将我们的模型转换为 Tensorflow.js 模型。如果您之前没有安装，只需在终端中键入:</p><p id="8f7e" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated"><code class="fe mt mu mv mw b">pip install tensorflowjs</code></p><p id="5685" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在，让我们用要可视化的张量流变量的名称创建一个变量:</p><p id="754c" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated"><code class="fe mt mu mv mw b">vs='l1/Relu,l1max,l2/Relu,l2max,l3/Relu,l3max,l4/Relu,l5/BiasAdd,output'</code></p><p id="d698" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated"><strong class="kw ir">注意:在所有阶段，遵循与初始化时相同的命名顺序。</strong></p><p id="2b35" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在我们把它转换成 Tensorflow.js 模型！</p><p id="74b1" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated"><code class="fe mt mu mv mw b">tensorflowjs_converter --input_format=tf_saved_mode --output_node_names=$vs --saved_model_tags=serve Model TensorSpace/mnist/model</code></p><p id="3009" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">这里 Model 是包含保存模型的文件夹，TensorSpace/mnist/model 是转换输出的目标。因此，在您的 TensorSpace/mnist/model 文件夹中，您应该会获得以下文件:</p><ul class=""><li id="2c0a" class="lu lv iq kw b kx lp lb lq kh mp kl mq kp mr lo lz ma mb mc bi translated">第 1 组-第 1 部分，共 1 部分</li><li id="c726" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">tensorflowjs_model.pb</li><li id="c5b0" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">权重 _ 清单. json</li></ul><p id="38c5" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在我们可以开始可视化部分！</p><h2 id="c117" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">TensorSpace.js 可视化</h2><p id="f52d" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">最后，我们需要创造。将输出结果的 html 文件。</p><p id="b55c" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">不要把时间花在设置 TensorFlow.js 和 JQuery 上，我鼓励你只使用我在 TensorSpace 文件夹中的模板。文件夹结构如下所示:</p><ul class=""><li id="cf6f" class="lu lv iq kw b kx lp lb lq kh mp kl mq kp mr lo lz ma mb mc bi translated">index.html—输出 html 文件以运行可视化</li><li id="7329" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">lib/-存储所有依赖项的文件夹</li><li id="8b8e" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">data/ —包含的文件夹。带有网络输入的 json 文件</li><li id="93f7" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated">model/-包含导出模型的文件夹</li></ul><p id="abcc" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">对于我们的 html 文件，我们需要首先导入依赖项并编写一个 TensorSpace 脚本。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="13b5" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">在脚本中，我们需要定义所有要可视化的图层(带参数)。可能的层的完整列表可以在<a class="ae md" href="https://tensorspace.org/html/docs/layerIntro.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。接下来，我们在<code class="fe mt mu mv mw b">model.load</code>方法中加载转换后的模型，指明生成的模型文件的路径和要可视化的变量的名称。最后，我们运行<code class="fe mt mu mv mw b">model.init</code>来处理输入文件(我们在模型训练结束时生成的文件)。</p><p id="af96" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">瞧，现在你可以在任何兼容<a class="ae md" href="https://tensorspace.org/html/docs/startSystem.html" rel="noopener ugc nofollow" target="_blank">的浏览器</a>中运行你的 html 文件，并从内部探索你的模型！</p><p id="569b" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">您的结果应该类似于:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/2bc9d11a231fb5f9a4851c7d03ee17d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9B6mWEyxm1XzAvFnKcIb6Q.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">3D Network visualization with TensorSpace.js</figcaption></figure><p id="73d6" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在，您可以开始探索您的网络工作流程了！</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/55441757c7e19c10630750591edd8469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58P2PV_sBWWi3VfiDurGoQ.png"/></div></div></figure><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/f2119aa2f4cb6d75817fa802e997c4e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEvESI5K_CqVdVzwMGW9rA.png"/></div></div></figure><h2 id="c49c" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h2><p id="3ad7" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">在本教程中，我们接触了 TensorSpace.js 功能的一小部分。我鼓励你使用<a class="ae md" href="https://github.com/asakryukin/TSTutorial" rel="noopener ugc nofollow" target="_blank">代码</a>并在你自己的模型上试用它！</p><p id="d384" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">如果你有问题或者你想探索 TensorSpace.js 的其他功能或者它在其他模型上的应用(Keras，Tensorflow.js ),请在下面留下评论！</p><ul class=""><li id="6e72" class="lu lv iq kw b kx lp lb lq kh mp kl mq kp mr lo lz ma mb mc bi translated"><a class="ae md" href="https://github.com/asakryukin/TSTutorial/tree/master" rel="noopener ugc nofollow" target="_blank"> GitHub 教程的代码</a></li><li id="820d" class="lu lv iq kw b kx me lb mf kh mg kl mh kp mi lo lz ma mb mc bi translated"><a class="ae md" href="https://tensorspace.org/" rel="noopener ugc nofollow" target="_blank"> TensorSpace.js 网页</a></li></ul></div></div>    
</body>
</html>