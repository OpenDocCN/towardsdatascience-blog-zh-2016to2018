<html>
<head>
<title>Coloring Plotly Box-Plots</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">给盒图着色</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/applying-a-custom-colormap-with-plotly-boxplots-5d3acf59e193?source=collection_archive---------3-----------------------#2018-07-23">https://towardsdatascience.com/applying-a-custom-colormap-with-plotly-boxplots-5d3acf59e193?source=collection_archive---------3-----------------------#2018-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7bb7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将自定义色标应用于绘图箱线图</h2></div><p id="61b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的老板最近要求我为一个<a class="ae lb" href="https://plot.ly/products/dash/" rel="noopener ugc nofollow" target="_blank">破折号</a>应用程序对一系列<a class="ae lb" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank">plottly</a><a class="ae lb" href="https://plot.ly/python/box-plots/" rel="noopener ugc nofollow" target="_blank">Box plots</a>应用色标。这个想法是在同一个图上绘制多个盒状图，并根据每个盒状图与数据集中总体中值的距离，使每个盒状图变暗或变亮。</p><h1 id="5126" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">问题是</h1><p id="3d96" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">这里的问题是 Plotly 只支持热图的<a class="ae lb" href="https://plot.ly/python/colorscales/" rel="noopener ugc nofollow" target="_blank">色标</a>，散点图&amp;等高线图。</p><p id="204f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将通过绘制一些为加拿大人球员生成的数据来演示默认行为，如下所示:</p><blockquote class="md me mf"><p id="561a" class="kf kg mg kh b ki kj jr kk kl km ju kn mh kp kq kr mi kt ku kv mj kx ky kz la ij bi translated">注意:完整的代码在文章的最后</p></blockquote><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/425196bdfd5f08bdd90b7a0e4f06f10e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3TnVapNTl9A9x-dKu6gtQQ.png"/></div></div></figure><p id="f720" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">绿色虚线代表<code class="fe lz ma mb mc b">NHL league average +/- per game at +2.0</code>，我的老板想要的是根据<code class="fe lz ma mb mc b">each players median +/- </code>值与<code class="fe lz ma mb mc b">league average</code>的距离将每个方框图涂成更深或更浅的颜色。</p><h1 id="fff9" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">解决方案</h1><p id="cf73" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">鉴于我已经处于 Python 环境中，我选择使用来自<a class="ae lb" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a> Python 模块的<code class="fe lz ma mb mc b">colormap</code> &amp; <code class="fe lz ma mb mc b">colormap normalizer</code>特性。</p><p id="1c7d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一步是导入 Matplotlib:</p><pre class="ml mm mn mo gt mw mc mx my aw mz bi"><span id="5d4f" class="na ld iq mc b gy nb nc l nd ne">import matplotlib.pyplot as plt<br/>import matplotlib<br/>import pandas as pd</span></pre><p id="a386" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后确定数据集中的<code class="fe lz ma mb mc b">min</code>和<code class="fe lz ma mb mc b">max</code>值:</p><pre class="ml mm mn mo gt mw mc mx my aw mz bi"><span id="1312" class="na ld iq mc b gy nb nc l nd ne">x_data = ['Henrik Sedin', 'Daniel Sedin',<br/>          'Brock Boeser', 'Elias Pettersen',<br/>          'Bo Horvat', 'Pavel Bure',]</span><span id="55c0" class="na ld iq mc b gy nf nc l nd ne"># Generate random data<br/>y0 = np.random.randn(50)+4<br/>y1 = np.random.randn(50)+4<br/>y2 = np.random.randn(50)+2<br/>y3 = np.random.randn(50)+2<br/>y4 = np.random.randn(50)+1<br/>y5 = np.random.randn(50)+3</span><span id="b2eb" class="na ld iq mc b gy nf nc l nd ne">y_data = [y0,y1,y2,y3,y4,y5]</span><span id="d2ec" class="na ld iq mc b gy nf nc l nd ne">df = pd.DataFrame(y_data)<br/>vmin, vmax = df.min().min(), df.max().max()</span></pre><p id="c6b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">初始化 Matplotlib cmap 和规格化器:</p><pre class="ml mm mn mo gt mw mc mx my aw mz bi"><span id="a2cb" class="na ld iq mc b gy nb nc l nd ne">norm = matplotlib.colors.Normalize(vmin=vmin, vmax=vmax)<br/>cmap = matplotlib.cm.get_cmap('GnBu') # green to blue color way</span></pre><p id="e5c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">找到每个<code class="fe lz ma mb mc b">y_data</code>的中间值，并使用规格化器根据中间值将其映射到适当的颜色:</p><pre class="ml mm mn mo gt mw mc mx my aw mz bi"><span id="4ccb" class="na ld iq mc b gy nb nc l nd ne">for xd, yd in zip(x_data, y_data):<br/>        <br/>        median = np.median(yd) # find the median<br/>        color = 'rgb' + str(cmap(norm(median))[0:3]) # normalize<br/>        <br/>        traces.append(go.Box(<br/>            y=yd,<br/>            name=xd,<br/>            boxpoints='all',<br/>            jitter=0.5,<br/>            whiskerwidth=0.2,<br/>            fillcolor=color,      # add the box plot color<br/>            marker=dict(<br/>                size=2,<br/>            ),<br/>            line=dict(width=1)<br/>        ))</span></pre><h1 id="30b0" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">维奥拉。</h1><p id="5e6d" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated"><code class="fe lz ma mb mc b">players median +/-</code>离<code class="fe lz ma mb mc b">league average</code>越远，产生的图将呈现越暗的<code class="fe lz ma mb mc b">fillcolor</code>，反之亦然。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/55bb3c0411835505907b4967756ea094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QpX-B-2vZhRcPkari11IHA.png"/></div></div></figure><h1 id="e11f" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">奖金</h1><p id="3798" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">下面是获得上述结果的完整代码:</p><pre class="ml mm mn mo gt mw mc mx my aw mz bi"><span id="c3a7" class="na ld iq mc b gy nb nc l nd ne">from plotly import __version__<br/>from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot<br/>init_notebook_mode(connected=True)<br/>import plotly.graph_objs as go<br/>import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import matplotlib</span><span id="1bdc" class="na ld iq mc b gy nf nc l nd ne">x_data = ['Henrik Sedin', 'Daniel Sedin',<br/>          'Brock Boeser', 'Elias Pettersen',<br/>          'Bo Horvat', 'Pavel Bure',]</span><span id="6720" class="na ld iq mc b gy nf nc l nd ne">y0 = np.random.randn(50)+4<br/>y1 = np.random.randn(50)+4<br/>y2 = np.random.randn(50)+2<br/>y3 = np.random.randn(50)+2<br/>y4 = np.random.randn(50)+1<br/>y5 = np.random.randn(50)+3</span><span id="2d5c" class="na ld iq mc b gy nf nc l nd ne">y_data = [y0,y1,y2,y3,y4,y5]</span><span id="f46a" class="na ld iq mc b gy nf nc l nd ne">traces = []</span><span id="1dbe" class="na ld iq mc b gy nf nc l nd ne">df = pd.DataFrame(y_data)<br/>vmin, vmax = df.min().min(), df.max().max()</span><span id="1862" class="na ld iq mc b gy nf nc l nd ne">norm = matplotlib.colors.Normalize(vmin=vmin, vmax=vmax)<br/>cmap = matplotlib.cm.get_cmap('GnBu')</span><span id="9afa" class="na ld iq mc b gy nf nc l nd ne">for xd, yd in zip(x_data, y_data):<br/>        median = np.median(yd)<br/>        color = 'rgb' + str(cmap(norm(median))[0:3])<br/>        <br/>        traces.append(go.Box(<br/>            y=yd,<br/>            name=xd,<br/>            boxpoints='all',<br/>            jitter=0.5,<br/>            whiskerwidth=0.2,<br/>            fillcolor=color,<br/>            marker=dict(<br/>                size=2,<br/>                color='rgb(0, 0, 0)'<br/>            ),<br/>            line=dict(width=1),<br/>        ))</span><span id="553b" class="na ld iq mc b gy nf nc l nd ne">layout = go.Layout(<br/>    title='Canucks all time +/- per game',<br/>    yaxis=dict(<br/>        autorange=True,<br/>        showgrid=True,<br/>        zeroline=True,<br/>        dtick=5,<br/>        gridcolor='rgb(255, 255, 255)',<br/>        gridwidth=1,<br/>        zerolinecolor='rgb(255, 255, 255)',<br/>        zerolinewidth=2,<br/>    ),<br/>    margin=dict(<br/>        l=40,<br/>        r=30,<br/>        b=80,<br/>        t=100,<br/>    ),<br/>    paper_bgcolor='rgb(243, 243, 243)',<br/>    plot_bgcolor='rgb(243, 243, 243)',<br/>    showlegend=False,<br/>    shapes= [{<br/>      'type': 'line',<br/>      'x0': -1,<br/>      'y0': 2,<br/>      'x1': 6,<br/>      'y1': 2,<br/>      'line': {<br/>        'color': 'rgb(50, 171, 96)',<br/>        'width': 4,<br/>        'dash': 'dashdot'<br/>      }<br/>    }]<br/>)</span><span id="8e77" class="na ld iq mc b gy nf nc l nd ne">fig = go.Figure(data=traces, layout=layout)<br/>iplot(fig)</span></pre></div></div>    
</body>
</html>