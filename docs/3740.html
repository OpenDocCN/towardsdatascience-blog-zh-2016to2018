<html>
<head>
<title>Geocoding: OpenStreetMap + R + Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地理编码:OpenStreetMap + R + Tableau</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geocoding-tableau-and-r-integration-c5b32dc0eda6?source=collection_archive---------5-----------------------#2018-06-13">https://towardsdatascience.com/geocoding-tableau-and-r-integration-c5b32dc0eda6?source=collection_archive---------5-----------------------#2018-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">便捷的地理编码，R + Tableau BI 工具的所有功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f15e3a22d27f28a0f073355accc32997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNsIf1o8nP5e4YrTJOjvuQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Geocoding with OpenStreetMap Without API Token</figcaption></figure><h2 id="6e08" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">背景</h2><p id="9361" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在过去，谷歌地图不需要 API 令牌，这对于简短的用例很有帮助。现在，必须创建一个云帐户。老实说，令人惊讶的是谷歌允许免费令牌 API 持续这么长时间。</p><p id="064a" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在寻找需要街道地址地理位置的短期用例的替代方案时，我发现 OpenStreetMap 是一个简单而有用的替代方案。</p><h2 id="9b97" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">这项功能是为谁设计的？</h2><p id="9949" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">该特性主要面向已经有一些 r 使用经验的用户，这些用户会发现这种集成有几个好处:</p><ul class=""><li id="4598" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm mx my mz na bi translated">对安装在 R 中的任何 R 包或函数的完全访问权</li><li id="a4c9" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm mx my mz na bi translated">使用 Tableau 功能进一步分析和理解数据</li><li id="45ec" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm mx my mz na bi translated">提供一个平台，将开源数据和软件与专有软件相集成</li></ul><p id="44f2" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">用户必须能够访问 R/RStudio 和 Tableau。这两个软件可以存在于同一台计算机上，也可以远程存在(云)。</p><h2 id="aac3" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak"> Tableau 脚本— R 和 Python 集成</strong></h2><p id="0c55" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">有一种方法可以从 Tableau 执行 R 或 Python 命令，以便允许我们利用这些编程语言的功能(函数、模型和包)。您可以通过与 R 或 Python 实例动态通信的计算字段来实现这一点，结果将作为预定的数据类型(INT、REAL、BOOL、STR)返回给 Tableau。</p><p id="3c28" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">当需要动态计算的字段来支持分析师的需求，而不必单独运行代码并发回新的数据集时，这种集成非常有用。出于这个原因，我们不会使用这个功能，但你可以查看下面的相关博客。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="f459" class="nn kz it bd la no np nq ld nr ns nt lg jz nu ka lk kc nv kd lo kf nw kg ls nx bi translated"><strong class="ak">地理编码入门</strong></h1><ul class=""><li id="f001" class="ms mt it lw b lx ly ma mb lh ny ll nz lp oa mm mx my mz na bi translated">在许多情况下，我们可以访问带有位置信息的数据(例如，地址、城市、县、邮政编码、国家)。如果我们想更详细地可视化这些数据，我们需要使用地理定位。</li><li id="6691" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm mx my mz na bi translated">地理位置坐标(经度、纬度)需要基于位置数据来计算。</li><li id="2941" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm mx my mz na bi translated">nomist 是 OpenStreetMap 数据的免费搜索引擎。使用 Nominatim，我们可以很容易地从给定的地址计算地理位置坐标。</li></ul><p id="f85e" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">OpenStreetMap 由一个地图绘制者社区构建的数据组成，他们贡献并维护世界各地的道路、小径、咖啡馆、火车站等数据。</p><ul class=""><li id="78e4" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm mx my mz na bi translated"><a class="ae ob" href="https://www.openstreetmap.org/about" rel="noopener ugc nofollow" target="_blank">https://www.openstreetmap.org/about</a></li></ul><h2 id="30be" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">在 R/RStudio 中加载包</h2><p id="ec4d" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了在 R/RStudio 中加载包，我们将使用 tidyverse，这是一个为数据科学设计的 R 包以及其他帮助数据清理和处理的包的集合。下面的代码块允许您:</p><ol class=""><li id="3c3c" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm oc my mz na bi translated">检查是否安装了所需的软件包</li><li id="0db3" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">安装未安装的软件包</li><li id="c21b" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">安装后加载软件包</li></ol><p id="c864" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu">包装潮流</strong></p><div class="od oe gp gr of og"><a href="https://www.tidyverse.org/" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">Tidyverse</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">tidyverse 是 R 包的集成集合，旨在使数据科学变得快速、流畅和有趣。</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">www.tidyverse.org</p></div></div><div class="op l"><div class="oq l or os ot op ou ks og"/></div></div></a></div><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="4340" class="ky kz it ow b gy pa pb l pc pd"># CHECK IF PACKAGE IS INSTALLED<br/>if(!require("tidyverse")){</span><span id="a441" class="ky kz it ow b gy pe pb l pc pd">  # IF PACKAGE NOT FOUND, INSTALL IT<br/>  install.packages("tidyverse", dependencies = TRUE)</span><span id="4241" class="ky kz it ow b gy pe pb l pc pd">  # LOAD PACKAGE AFTER INSTALLETION<br/>  library("tidyverse")<br/>}</span></pre><p id="0dc9" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu">包 rvest </strong></p><div class="od oe gp gr of og"><a href="https://github.com/tidyverse/rvest" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">tidyverse/rvest</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">通过在 GitHub 上创建一个帐户，为 tidyverse/rvest 开发做贡献。</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="pf l or os ot op ou ks og"/></div></div></a></div><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="81c1" class="ky kz it ow b gy pa pb l pc pd"># CHECK IF PACKAGE IS INSTALLED<br/>if(!require("rvest")){</span><span id="ce9d" class="ky kz it ow b gy pe pb l pc pd"># IF PACKAGE NOT FOUND, INSTALL IT<br/>  install.packages("rvest", dependencies = TRUE)</span><span id="7648" class="ky kz it ow b gy pe pb l pc pd"># LOAD PACKAGE AFTER INSTALLETION<br/>  library("rvest")<br/>}</span></pre><p id="33e6" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu">包青天</strong></p><div class="od oe gp gr of og"><a href="https://github.com/gagolews/stringi" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">gagolews/stringi</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">带 ICU 的 R 的字符串处理包。通过在…上创建一个帐户，为 gagolews/stringi 开发做出贡献</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="pg l or os ot op ou ks og"/></div></div></a></div><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="99c4" class="ky kz it ow b gy pa pb l pc pd"># CHECK IF PACKAGE IS INSTALLED<br/>if(!require("stringi")){</span><span id="0fc8" class="ky kz it ow b gy pe pb l pc pd"># IF PACKAGE NOT FOUND, INSTALL IT<br/>  install.packages("stringi", dependencies = TRUE)</span><span id="6927" class="ky kz it ow b gy pe pb l pc pd"># LOAD PACKAGE AFTER INSTALLETION<br/>  library("stringi")<br/>}</span></pre><p id="e012" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu">包 jsonlite </strong></p><div class="od oe gp gr of og"><a href="https://github.com/jeroen/jsonlite" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">jeroen/jsonlite</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">一个健壮的、高性能的 JSON 解析器和生成器</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="ph l or os ot op ou ks og"/></div></div></a></div><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="dafe" class="ky kz it ow b gy pa pb l pc pd"># CHECK IF PACKAGE IS INSTALLED<br/>if(!require("jsonlite")){</span><span id="d6f7" class="ky kz it ow b gy pe pb l pc pd"># IF PACKAGE NOT FOUND, INSTALL IT<br/>  install.packages("jsonlite", dependencies = TRUE)</span><span id="16f2" class="ky kz it ow b gy pe pb l pc pd"># LOAD PACKAGE AFTER INSTALLETION<br/>  library("jsonlite")<br/>}</span></pre><h2 id="d967" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">OpenStreetMap API 搜索函数</h2><p id="3365" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">下面的地理编码功能允许我们向 nomist im(OpenStreetMap 数据的搜索引擎)发出请求。</p><ul class=""><li id="988c" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm mx my mz na bi translated">提名:<a class="ae ob" href="https://nominatim.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank">https://nominatim.openstreetmap.org/</a></li><li id="aab6" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm mx my mz na bi translated">资源:<a class="ae ob" href="https://nominatim.org/release-docs/develop/api/Search" rel="noopener ugc nofollow" target="_blank">https://nominatim.org/release-docs/develop/api/Search</a></li></ul><p id="95f7" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">该函数获取并输入以下参数，这些参数可以根据您的需要进行修改:<em class="pi">【姓名】、【地址】、【城市】、【州】、【邮政编码】</em></p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="c2de" class="ky kz it ow b gy pa pb l pc pd">geocode &lt;- function(name, address, city, state, zipcode){<br/>  # NOMINATIM SEARCH API URL<br/>  src_url &lt;- "<a class="ae ob" href="https://nominatim.openstreetmap.org/search?q=" rel="noopener ugc nofollow" target="_blank">https://nominatim.openstreetmap.org/search?q=</a>"<br/>  <br/>  # CREATE A FULL ADDRESS<br/>  addr &lt;- paste(address, city, state, zipcode, sep = "%2C")<br/>  <br/>  # CREATE A SEARCH URL BASED ON NOMINATIM API TO RETURN GEOJSON<br/>  requests &lt;- paste0(src_url, query, "&amp;format=geojson")<br/>  <br/>  # ITERATE OVER THE URLS AND MAKE REQUEST TO THE SEARCH API<br/>  for (i in 1:length(requests)) {<br/>    <br/>    # QUERY THE API TRANSFORM RESPONSE FROM JSON TO R LIST<br/>    response &lt;- read_html(requests[i]) %&gt;%<br/>      html_node("p") %&gt;%<br/>      html_text() %&gt;%<br/>      fromJSON()<br/>    <br/>    # FROM THE RESPONSE EXTRACT LATITUDE AND LONGITUDE COORDINATES<br/>    lon &lt;- response$features$geometry$coordinates[[1]][1]<br/>    lat &lt;- response$features$geometry$coordinates[[1]][2]<br/>    <br/>    # CREATE A COORDINATES DATAFRAME<br/>    if(i == 1) {<br/>      loc &lt;- tibble(name = name[i], <br/>                    address = str_replace_all(addr[i], "%2C", ","),<br/>                    latitude = lat, longitude = lon)<br/>    }else{<br/>      df &lt;- tibble(name = name[i], <br/>                   address = str_replace_all(addr[i], "%2C", ","),<br/>                   latitude = lat, longitude = lon)<br/>      loc &lt;- bind_rows(loc, df)<br/>    }<br/>  }<br/>  return(loc)<br/>}</span></pre></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="9ab5" class="nn kz it bd la no np nq ld nr ns nt lg jz nu ka lk kc nv kd lo kf nw kg ls nx bi translated">数据来源:芝加哥市食品检验局</h1><p id="3c59" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">这些信息来源于从 2010 年 1 月 1 日至今对芝加哥的餐馆和其他食品机构的检查。芝加哥公共卫生部食品保护项目的工作人员使用标准化程序进行检查。</p><div class="od oe gp gr of og"><a href="https://data.cityofchicago.org/browse?q=food+inspection&amp;sortBy=relevance" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">芝加哥市|数据门户</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">关于 2018 年 7 月 1 日影响此数据集的变更的注意事项:http://bit.ly/2yWd2JB-此信息源自检查…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">data.cityofchicago.org</p></div></div><div class="op l"><div class="pj l or os ot op ou ks og"/></div></div></a></div><p id="b15c" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">食品检测数据具有地理位置坐标，我们可以使用它们来检查结果的准确性。在这个示例数据集中，我们将只使用 location 列来查找餐馆的坐标。</p><h2 id="5028" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据检查和清理</h2><p id="3de8" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在下面的代码块中，我们正在读取数据并进行一些更改，以确保该地址与 Nominatim API 一起工作。</p><p id="8d8b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu">读取数据</strong></p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="5f26" class="ky kz it ow b gy pa pb l pc pd"># READ THE DATA<br/>data &lt;- read_csv("food_inspection_sample.csv")</span><span id="2911" class="ky kz it ow b gy pe pb l pc pd"># REMOVE SPACE FROM COLUMNS<br/>colnames(data) &lt;- str_replace_all(colnames(data)," ", "_")</span></pre><p id="66f0" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu">清理数据</strong></p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="4a3a" class="ky kz it ow b gy pa pb l pc pd"># REMOVE SPACE FROM RESULTS<br/>data$Results &lt;- data$Results %&gt;% <br/>  str_replace_all(" w/ ", " with ") %&gt;% <br/>  str_replace_all(" ", "_")</span><span id="3e8d" class="ky kz it ow b gy pe pb l pc pd"># EXTRACT RISK LEVEL <br/>data$Risk &lt;- tolower(data$Risk) %&gt;% <br/>  str_extract("\\(.*\\)") %&gt;% <br/>  str_extract("[a-z]+")</span><span id="6bc8" class="ky kz it ow b gy pe pb l pc pd">head(data)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/e0c8165a37d3e96abd6f496cda1f5183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RKK3kVHZWd22W9U0KMigeQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ob" href="https://gist.github.com/jlroo/9c65f9e599f116487b33047ed1be0837#file-food_inspection_sample-csv" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/jlroo/9c65f9e599f116487b33047ed1be0837#file-food_inspection_sample-csv</a></figcaption></figure><h2 id="436a" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">地址的地理定位</h2><p id="e064" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在本节中，我们将准备 address 变量来匹配 nomim API 样式。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="ac81" class="ky kz it ow b gy pa pb l pc pd"># EXTRACT THE ADDRESS VARIABLE <br/>address &lt;- data$Address</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/1dce72e650413ccfb5d359eef2fc0e7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NcEaw0P0GDdxXHoRHVUj8Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Original address variable</figcaption></figure><p id="f9f8" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">修改地址变量以匹配 API</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="fa36" class="ky kz it ow b gy pa pb l pc pd"># CLEAN SPECIAL CASES (e.g. 1 N MAY BLDG)<br/>query &lt;- str_replace_all(string = address, <br/>                         pattern = "BLDG", <br/>                         replacement = " ")</span><span id="15bf" class="ky kz it ow b gy pe pb l pc pd"># CLEAN SPECIAL CASES (e.g. 3333-3339 N CLARK)<br/>query &lt;- stri_replace(str = query, <br/>                      replacement = " ", <br/>                      regex = "(-[0-9]+\\s)")</span><span id="1a57" class="ky kz it ow b gy pe pb l pc pd"># REPLACE SPACES (\\s) OR COMMAS (,) WITH PLUS SIGN (+)<br/>query &lt;- str_replace_all(string = query, <br/>                         pattern = "\\s|,", <br/>                         replacement = "+")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/e2dce9449bcbe4a02867fdb06d46f025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPYZYxwrFnPRF4mE2mksXQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Transformed address variable</figcaption></figure><h2 id="62b1" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">发出 API 请求-地理编码功能</h2><p id="c162" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为 API 准备好地址变量后，我们可以使用开始时创建的 geocode 函数来查找餐馆的地理坐标。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="9349" class="ky kz it ow b gy pa pb l pc pd">df &lt;- geocode(name = data$DBA_Name,<br/>              address = query,<br/>              city = data$City, <br/>              state = data$State,<br/>              zipcode = data$Zipcode)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/846023110cc83418d205267b39de1b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SwwnsFegYMqXPp_OgZg6qg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Returned DataFrame with geo coordinates</figcaption></figure><p id="7d4b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">最后，我们可以合并两个数据集来创建一个主数据集，并在 Tableau 中工作。为了实现这一点，我们使用了一个<em class="pi"> left_join </em> by 变量<em class="pi"> name </em>对<em class="pi"> </em>返回的数据帧和<em class="pi"> DBA_Name </em>变量进行连接。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="f446" class="ky kz it ow b gy pa pb l pc pd">geo_df &lt;- data %&gt;% left_join(df, by = c("DBA_Name" = "name"))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/d19490454b5a4900be91f2e2709f775a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nuz3ro6KZK2JGNfO_BHhhA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ob" href="https://gist.github.com/jlroo/e4518cf821aa1f103f822931db83e418#file-food_inspection-csv" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/jlroo/e4518cf821aa1f103f822931db83e418#file-food_inspection-csv</a></figcaption></figure></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="bde7" class="nn kz it bd la no np nq ld nr ns nt lg jz nu ka lk kc nv kd lo kf nw kg ls nx bi translated">数据可视化:使用 Tableau 进行地理定位分析</h1><p id="69ea" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">现在有了一个带有地理坐标的主数据集，我们可以将其导入 Tableau 进行进一步分析。</p><p id="2461" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">要开始处理 Tableau，请通过文本文件(CSV)连接到文件。这是之前在 r 中创建的文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/64b3abc4cda149001831db4e65a3006b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mYFyL1cJck6oWC4Yo4kQnQ.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Connect to the food_inspections.csv file</figcaption></figure><p id="6a5b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">Tableau 数据解释器有助于识别列的数据类型，但是仔细检查以确保数据类型是正确的总是很重要的。在这种情况下，我们将确保变量(纬度和经度)数据类型(地理角色)是正确的。</p><p id="ef63" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在 Tableau 中工作的一个好习惯是通过选择屏幕右上角的选项来<em class="pi">提取</em>您正在处理的数据集。这将防止您覆盖/损坏原始数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/4c30338afca8f6a73abb0859e63e50da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2ydcI3bw9SJh-wkHjFhEgA.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Check that columns data types are correct</figcaption></figure><p id="df6e" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">完成对数据类型的更改后，转到屏幕左下方突出显示的工作表部分。将出现保存数据集(提取)的提示。按照提示将其保存在默认位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/14a9222a5ebc7167a26bc976db7de51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9mgrWh7YOi3kNDMWb7xi-w.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Default Folder Location — My Tableau Repository</figcaption></figure><h2 id="160d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">测绘经度和纬度</h2><p id="2849" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在工作表中，根据数据类型(维度和度量)，您将看到数据集列分为两个部分。在 measures 部分，您将找到经度和纬度变量。要映射坐标，请遵循以下步骤:</p><ol class=""><li id="619a" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm oc my mz na bi translated">双击经度变量，Tableau 会将变量放在正确的轴(列)上。</li><li id="d6a6" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">双击纬度变量，它将被放置在正确的轴(行)上。</li><li id="5f12" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">将变量放入正确的轴后，将每个变量的数据类型从 Measure 更改为 Dimension。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/b8ca302afa521588ca95afe2a9ba65d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UaIY6XiBkI0A5qJcodtOxw.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Mapping coordinates, change of data type</figcaption></figure><h2 id="754c" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">丰富地图功能-邮政编码、细节、颜色</h2><p id="dbcf" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">有了地图中的地址，我们现在可以添加更多的要素，例如县边界、邮政编码、位置详细信息和颜色。</p><ol class=""><li id="3216" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm oc my mz na bi translated">双击<em class="pi"> DBA Name </em>变量，自动将其指定为细节标记，以查看每个位置的名称。</li><li id="5566" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">双击<em class="pi">风险</em>变量。由于有三个类别，颜色标记是自动分配的。</li><li id="6c72" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">当鼠标悬停在这些点上时，我们应该能够看到餐馆的名称、风险和地理坐标。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/5e281eb40268d65ace0b0e59b5d32e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PPPaI_6r1cLx2ayJhoqdxg.gif"/></div></div></figure><h2 id="367e" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">地图图层-邮政编码边界</h2><p id="d254" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">Tableau 允许我们向默认地图添加额外的图层。在这种情况下，了解邮政编码标签和界限会很有帮助。</p><ol class=""><li id="7d9e" class="ms mt it lw b lx mn ma mo lh mu ll mv lp mw mm oc my mz na bi translated">在主工具栏上，选择<em class="pi">地图→地图图层。</em></li><li id="513a" class="ms mt it lw b lx nb ma nc lh nd ll ne lp nf mm oc my mz na bi translated">工作表的左上角应该会出现一个地图图层视图。向下滚动并启用<em class="pi">邮政编码边界</em>和<em class="pi">邮政编码标签</em>选项。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/905ee1fe3981fcdf37c31d23d8f1fb03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Zkegl2ARPTOKr814fPqO_g.gif"/></div></div></figure><p id="eb10" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">最后，您可以放大以仔细查看特定区域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/7fd379a388363d5de61d4eb37f7d040f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wuTSDyYrr9x18zPnw47a0g.gif"/></div></div></figure><p id="bb38" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">请记住，这篇博客文章只是触及了当我们集成 OpenStreetMap、R 和 Tableau 时可能发生的事情的表面。OpenStreetMap API 不需要令牌，而其他 API(Google，Mapquest)需要令牌。</p><p id="d0ca" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">通过利用 OpenStreetMap 作为资源，简单的用例可以得到极大的丰富。也就是说，要注意你在任何时候提出的请求数量。</p></div></div>    
</body>
</html>