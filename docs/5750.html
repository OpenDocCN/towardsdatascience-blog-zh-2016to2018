<html>
<head>
<title>Using 3D visualizations to tune hyperparameters in ML models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 3D 可视化来调整 ML 模型中的超参数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-3d-visualizations-to-tune-hyperparameters-of-ml-models-with-python-ba2885eab2e9?source=collection_archive---------3-----------------------#2018-11-07">https://towardsdatascience.com/using-3d-visualizations-to-tune-hyperparameters-of-ml-models-with-python-ba2885eab2e9?source=collection_archive---------3-----------------------#2018-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><p id="81ed" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这篇文章的大部分是交互式可视化，你可以在上面悬停、缩放和移动。在电脑上阅读比在手机上阅读更好，但手机上的横向模式至少会让你比纵向模式更好地看到情节。</p></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><p id="23f3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">想象一下，你正试图为<a class="ae kw" href="https://www.kaggle.com/c/rossmann-store-sales" rel="noopener ugc nofollow" target="_blank"> Kaggle 的<br/> Rossmann 商店销售</a>竞争开发一个解决方案。你已经做了大量的功能工程，并创造了大量的新变量，这可能有助于你更好地预测未来的销售。</p><p id="be56" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您创建了一个随机森林，并试图找到其最佳超参数。大概有 1000 多种你想要评估的组合。您可以运行<a class="ae kw" href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV" rel="noopener ugc nofollow" target="_blank">随机搜索</a>来分析其中的一个子样本，或者运行<a class="ae kw" href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV" rel="noopener ugc nofollow" target="_blank">网格搜索</a>来探索整个参数网格。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lc ld l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Some of the parameters are evenly spaced on a log scale. You can do that with np.logspace</figcaption></figure><p id="c5d1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">你做了后者，现在有了一些数据。使用 rf_gridsearch.best_params_ 可以获得在测试集上产生最佳结果的 3 个参数(max_features: 0.25，min_samples_split: 13，n_estimators: 45)。但是，如果你想在三维空间中可视化所有被训练的随机森林的表现呢？</p><h2 id="600e" class="li lj it bd lk ll lm dn ln lo lp dp lq ki lr ls lt km lu lv lw kq lx ly lz ma bi translated">等等，这些流行语是什么意思？</h2><p id="4c10" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated"><a class="ae kw" href="https://en.wikipedia.org/wiki/Decision_tree_learning" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu">决策树</strong> </a>是一种受监督的机器学习算法，它给定一个数据集，将其递归地划分为具有彼此更相似的目标变量的子集。给定一些带有用于训练它的自变量的新数据，它可以预测因变量。</p><div class="kx ky kz la gt ab cb"><figure class="mg lb mh mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><img src="../Images/21e41067d2b6e68667a9d4f70e6d0598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*lFpgIkGzgy3_jpkDM1sdEw.png"/></div></figure><figure class="mg lb ms mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><img src="../Images/c40b70f31cb51b72d28ae4a26429011d.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*6cS3U6_KUH93mNAsJ8YIww.png"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk mt di mu mv">A decision tree used for regression. Credit: <a class="ae kw" href="https://ml.berkeley.edu/blog/2017/12/26/tutorial-5/" rel="noopener ugc nofollow" target="_blank">this great post from UC Berkeley</a></figcaption></figure></div><p id="e954" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一个<a class="ae kw" href="https://en.wikipedia.org/wiki/Random_forest" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu">随机森林</strong> </a>(从现在开始的 RF)是一个决策树的集合，这些决策树是在全部训练数据的子集上训练的，并且使用特征的子集。这允许它们具有较少相关的个体决策树，因此它们将更好地概括且具有较少的过度拟合。它们比神经网络训练起来更快，是解决结构化数据的分类和回归问题的一个很好的快速的首次尝试。</p><p id="5c3f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们可以在 RFs 中设置几个超参数。请在 scikit-learn 的文档中阅读所有相关内容。其中一些最重要的是:</p><ul class=""><li id="5315" class="mw mx it jz b ka kb ke kf ki my km mz kq na ku nb nc nd ne bi translated">n _ estimators:RF 中树的数量。</li><li id="8d4a" class="mw mx it jz b ka nf ke ng ki nh km ni kq nj ku nb nc nd ne bi translated">min_samples_split:将一个子集(又名节点)再分成两个子集的最小样本数。与最小样本叶和最大深度相关</li><li id="94ab" class="mw mx it jz b ka nf ke ng ki nh km ni kq nj ku nb nc nd ne bi translated">max_features <strong class="jz iu"> : </strong>分割节点时要考虑的最大特征数(独立变量)</li></ul><p id="7d5d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">RF 的复杂性随着较高的 n 估计量、最大特征和较低的最小样本分割而增加。</p><p id="250e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">交叉验证</strong>是一种用于在机器学习模型中寻找最佳超参数的技术。为了执行它，我们必须<a class="ae kw" href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html" rel="noopener ugc nofollow" target="_blank">将数据分成</a>3 个子集:一个训练集(用于训练模型)、一个验证集(优化超参数)和一个测试集(最后检查模型的性能，就像我们已经在生产中一样)。我们使用一些<a class="ae kw" href="http://scikit-learn.org/stable/modules/model_evaluation.html" rel="noopener ugc nofollow" target="_blank">分数</a>来评估模型的性能，这些分数将根据我们试图解决的问题类型(回归、分类、聚类……)而变化。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nk"><img src="../Images/d9d60c4bce1dbbabc9b3b5c010cdb4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxlkJTtfA1v25ikCafL6Jw.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">A pic is always worth 1000 words!</figcaption></figure><p id="e294" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">对于回归，<a class="ae kw" href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.r2_score.html" rel="noopener ugc nofollow" target="_blank"> R2 (R 平方)</a>效果很好，是我用过的。一般来说，模型越复杂，训练集中的分数就越好。在测试集上，它也会随着模型复杂度的增加而增加，但在某个点之后，它不会增加，还会减少。我们所做的交叉验证就是试图找到那个点。</p><h1 id="98ff" class="nl lj it bd lk nm nn no ln np nq nr lq ns nt nu lt nv nw nx lw ny nz oa lz ob bi translated">好了，我们走吧🔥</h1><p id="db14" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">在我们的例子中，模型复杂度是 3 个超参数的函数。我们接下来要做的是，尝试可视化在超参数的 3D 网格中找到最佳模型的位置，以及所有组合的表现。请注意，在图中，我使用了词语<em class="kv">测试集</em>和<em class="kv">测试分数</em>，但我指的是<em class="kv">验证。</em></p><h2 id="2c39" class="li lj it bd lk ll lm dn ln lo lp dp lq ki lr ls lt km lu lv lw kq lx ly lz ma bi translated">第一:2D 热图</h2><p id="aa16" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">作为一种快速的方法，我们可以用可能的不同参数对绘制热图，以查看在测试和训练集中实现最大 R2 的区域。这可以通过几行代码来完成:</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lc ld l"/></div></figure><div class="kx ky kz la gt ab cb"><figure class="mg lb od mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><img src="../Images/7e8c521ce1bcd6da10e68aab4b4ba42f.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*6rFfvsclz7WXMJSY0EGqgw.png"/></div></figure><figure class="mg lb oe mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><img src="../Images/79541e4ed8aeba21c5124d42b8678fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*V-LSccI0aThuhG67Z5Ypyg.png"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk of di og mv">R2 scores for the test sets</figcaption></figure></div><div class="ab cb"><figure class="mg lb oh mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><img src="../Images/64ba4c7d2c18089cd963be8c52a489ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*OemnBG7DXnLhCLj4GWSwsw.png"/></div></figure><figure class="mg lb oi mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><img src="../Images/eadfc08335f2bc3339833b0fb50030a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*eXZQZuTP-Gnh5mLIkvWPBQ.png"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk oj di ok mv">R2 scores for the training sets</figcaption></figure></div><p id="ff65" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">但是这样做我们仍然只能看到结果的一小部分。为了看到所有这些(并且比热图更清晰)，我们需要创建 3D 可视化。</p><h2 id="ac1f" class="li lj it bd lk ll lm dn ln lo lp dp lq ki lr ls lt km lu lv lw kq lx ly lz ma bi translated">散点 3D</h2><p id="30bd" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">使用<a class="ae kw" href="http://plotly.com" rel="noopener ugc nofollow" target="_blank"> Plotly </a>我们可以创建各种各样的漂亮的交互式可视化。首先，让我们创建一个 3D 散点图，其中点的大小与训练时间成比例，颜色与测试集中的 R2 分数成比例。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="ol ld l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">See this in fullscreen mode <a class="ae kw" href="https://plot.ly/~xoelop/147.embed" rel="noopener ugc nofollow" target="_blank">here</a></figcaption></figure><p id="805c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">很好，但我们还是看不到太多。我们可以说 max_features 越大，min_samples_split 越小，测试分数就越大，但是很难悬停在 3D 散点图中间的点上。</p><p id="8d0b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这样做的代码对于 Medium 来说太长了，但是你可以在这里看到所有的内容</p><h2 id="b430" class="li lj it bd lk ll lm dn ln lo lp dp lq ki lr ls lt km lu lv lw kq lx ly lz ma bi translated">更好:添加滑块</h2><p id="f801" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">我们有 3 个独立变量，这 3 个参数是我们要优化的。更直观的方法是保持其中一个变量的值不变，绘制测试 R2 分数与其他两个变量的 3D 表面。<br/>这更接近我们习惯看到的 1D 验证曲线，如果我们添加一个滑块来移动第三个变量，我们可以有效地看到与之前的图相同的信息，但以更清晰的方式</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="ol ld l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Fullscreen mode <a class="ae kw" href="https://plot.ly/~xoelop/137.embed" rel="noopener ugc nofollow" target="_blank">here</a>.</figcaption></figure><p id="0dc7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">或者，如果您更喜欢 3D 散点图，以便您可以看到每个单独的点，这就是。点数的大小与训练时间成比例，颜色与 R2 分数成比例。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="ol ld l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk"><a class="ae kw" href="https://plot.ly/~xoelop/139.embed" rel="noopener ugc nofollow" target="_blank">Fullscreen</a></figcaption></figure><h2 id="a25b" class="li lj it bd lk ll lm dn ln lo lp dp lq ki lr ls lt km lu lv lw kq lx ly lz ma bi translated">最后但同样重要的是…</h2><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="ol ld l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">How the size of the bubbles will be after scaling it.</figcaption></figure><p id="de80" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有一种方法可以显示第一个 3D 散点图，显示所有的点，但使测试分数最高的点比其他点大得多，这样我们就可以专注于它们。这是通过将平均测试分数除以其最大值，并以一种特殊的方式进行缩放来获得我们想要的大小。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="bf75" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，如果我们这样做，这就是情节的样子。重要的几点现在看得更清楚了:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi om"><img src="../Images/4705823155b217a158678cb79fec0b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CwvAqj99xcPDgQkCdm47w.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">This is an image. To see the interactive plot go <a class="ae kw" href="https://plot.ly/~xoelop/151.embed" rel="noopener ugc nofollow" target="_blank">here</a></figcaption></figure><p id="190e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果我们想更进一步，优化 4 个超参数，我们可以将第 4 个维度作为滑块添加到该图中，就像前面的例子一样，并且能够通过 4 个维度有效地可视化数据。想不到！</p></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="on ld l"/></div></figure><h2 id="1c20" class="li lj it bd lk ll lm dn ln lo lp dp lq ki lr ls lt km lu lv lw kq lx ly lz ma bi translated"><strong class="ak">鳍</strong></h2><p id="fa9f" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">点击查看 Python 笔记本中创建这个<a class="ae kw" href="https://github.com/xoelop/Medium-posts/blob/master/3d%20cross%20validation/ML%206%20-%20Gridsearch%20visulizations%20.ipynb" rel="noopener ugc nofollow" target="_blank">的代码</a></p><p id="7ba4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">玩得开心！</p></div></div>    
</body>
</html>