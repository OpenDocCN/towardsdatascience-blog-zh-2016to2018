<html>
<head>
<title>Solving bike stations problem in Mexico City</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决墨西哥城的自行车站问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/solving-bike-stations-problem-in-mexico-city-f35b1cfd3ff1?source=collection_archive---------9-----------------------#2018-08-02">https://towardsdatascience.com/solving-bike-stations-problem-in-mexico-city-f35b1cfd3ff1?source=collection_archive---------9-----------------------#2018-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/86cd0c77cc7d70cfaf0f06d7bd01eedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DifP8KS9GMqg4vxF"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@wayneb250?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Wayne Bishop</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="f696" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几年前，我住在墨西哥城，是名为 eco bici T1 的城市自行车系统的常客。这个系统真的很容易使用，在过去的几年里它变得如此受欢迎真是令人惊讶。然而，由于墨西哥城是一个巨大的城市，对于用户来说，关于在不同的取货站分配自行车的许多问题是日常事务。我们分两节课总结一下这些问题:接送问题和落车问题。这些问题中的第一个是当用户想要骑自行车时缺少可用的自行车。第二类问题依赖于你可以归还自行车的免费停车位的稀缺。从现在起，我将集中讨论第一类问题。</p><figure class="lb lc ld le gt is"><div class="bz fp l di"><div class="lf lg l"/></div></figure><blockquote class="lh li lj"><p id="9398" class="kd ke lk kf b kg kh ki kj kk kl km kn ll kp kq kr lm kt ku kv ln kx ky kz la ij bi translated">一名 EcoBici 用户抱怨自行车在取货站的分配不合理。这只是这个庞大的交通系统每天都会遇到的问题的一个例子。</p></blockquote><p id="7768" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将在接下来的文章中解释一个基于公开可用的<a class="ae jd" href="https://www.ecobici.cdmx.gob.mx/en/informacion-del-servicio/open-data" rel="noopener ugc nofollow" target="_blank">数据</a>的每日预测模型。首先，我试图通过使用<a class="ae jd" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average" rel="noopener ugc nofollow" target="_blank"> ARIMA </a>模型来模拟每天的出行次数，但我意识到如果我想让这个模型真正准确和有用，我需要模拟每个车站的每日出行次数，这将涉及到创建大约 400 个 ARIMA 模型。经过一些考虑，我决定使用著名的 LSTM 网络(如果你不熟悉他们，看看<a class="ae jd" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="noopener ugc nofollow" target="_blank">这里</a>)。</p><p id="0655" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们看看按性别划分的旅行总次数。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lo"><img src="../Images/da47889a85354f586404ddff9545cc27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xjWvA8SvcsO5OvpcUxrNw.png"/></div></div></figure><p id="ef2b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从这张图表中很容易看出周末的季节性影响，而且只有 24%的日常出行是由女性完成的。这段时间从 2017/01/01 到 2017/03/31。</p><h2 id="b768" class="lp lq jg bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"><strong class="ak">在研究期间关于 EcoBici 系统的事实</strong></h2><p id="1b12" class="pw-post-body-paragraph kd ke jg kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">448 个站点<br/> 41%的站点每天最多有 5 场活动<br/> 27，593 次平均每日出行<br/> 5，072 辆平均每月有用的自行车<br/> 34.7 岁是用户的平均年龄</p><h2 id="ab9a" class="lp lq jg bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"><strong class="ak">数据</strong></h2><p id="2221" class="pw-post-body-paragraph kd ke jg kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">该模型旨在根据每个车站最近 3 周的活动预测一整周的活动。为此，我需要“打包”28 天的行程(21 天作为输入，7 天作为输出),为此，我移动了 28 天的时间段，从 2017 年 1 月 1 日开始，到 2017 年 3 月 3 日结束，得到 62 组 28 天的行程。最后一个需要乘以站的数量，我们总共有 27，776 个实例，应该分成训练集和验证集。此外，正如我们之前看到的，周末有很强的季节性影响，所以我引入了一个分类变量来表示工作日(星期一、星期二、星期三……)</p><p id="0350" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，数据集的结构为:<br/> (#stations*#sets，#days，trips+one-hot encoding for weekdays)<br/>=(448 * 62，28，1+7) = ( 27776，28，8) <br/>这 27776 个实例需要划分为训练集和验证集。通过将 75%的实例设置为训练集，我们有:20，832 个训练实例和 6，944 个验证实例。</p><h2 id="c4f0" class="lp lq jg bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">模型结构</h2><p id="dbe2" class="pw-post-body-paragraph kd ke jg kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我使用一个批量大小为 32 的 LSTM 层、一个 p=0.5 的下降层和一个 7 个单位的密集层来连接输出。而且我用的是<a class="ae jd" href="https://keras.io" rel="noopener ugc nofollow" target="_blank"> keras </a>的<a class="ae jd" href="https://arxiv.org/abs/1412.6980" rel="noopener ugc nofollow" target="_blank">亚当优化器</a>，学习率 0.0005。最后，作为损失函数，我考虑了均方误差。</p><h2 id="d912" class="lp lq jg bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"><strong class="ak">业绩和预测</strong></h2><p id="8cf3" class="pw-post-body-paragraph kd ke jg kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我运行了 300 个时期的训练过程，但是为了更好的可视化，这里是前 100 个时期的损失值的图。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/2b3ddb4b5d12205fc43c7b7825176d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*OIkLG-BVYrZ5Cvv7BqSaFg.png"/></div></figure><p id="de4b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">损失值如下所示:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/a4f99d7e7403e023beaa6f8fd0b1c92b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*NitGn-BYVgMc_WVu34IiVg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Loss function values over epochs</figcaption></figure><p id="ac43" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可视化预测的一种方法是计算网络的预测值，并将这些值与真实值进行比较。由于我们有大约 6900 个测试实例，我决定简单地随机选取一个实例，并绘制预测值与真实值的对比图。下面是一些相应的 MAPE(平均百分比误差)值的例子。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8396ae19706c9c507c160cc756a814e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*VyCM2whfHrLLeTW-sF7c7g.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">MAPE 8.3%</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/bb919f06f9d954e17897dbd4703c7e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*Y_uVncsjRCoIZyuXn2JBxQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">MAPE 9.1%</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/3377552c5303cc76135146164ea7cd51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*8LIrN_upm7xIx9XXXLxRlw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">MAPE 18.7</figcaption></figure><h2 id="30ce" class="lp lq jg bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">摘要</h2><p id="f1cb" class="pw-post-body-paragraph kd ke jg kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我引入了一个 LSTM 模型来预测墨西哥城 EcoBici 系统的自行车使用量。该模型的输入是 21 天内的旅行次数，以预测随后 7 天的旅行次数，此外，该模型将一周中的某一天视为一次性编码向量。</p><p id="18ec" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该模型产生的平均 MAPE(测试集的平均值)为 21%，这意味着还有很多需要改进的地方。</p><h2 id="15de" class="lp lq jg bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">后续步骤</h2><p id="185b" class="pw-post-body-paragraph kd ke jg kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">为了获得更好的结果，可以添加更多的信息:假期、允许识别站点是否在线的布尔变量、每天有用自行车的数量等。</p><p id="3759" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应测试输入内容的不同组合。也许考虑到前 21 天可能会有很多噪音，</p><p id="87ef" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我打算让这个模型成为一个可操作的工具，所以我认为聚合级别应该以小时为基础。</p><p id="33c8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">换句话说，更多的信息，更好的结果，这可能会导致更好的自行车分布在不同的车站。</p><p id="58fa" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这款车型的代码可在<a class="ae jd" href="https://github.com/cristhianrivera/EcoBiciDS/blob/master/EcoBiciLSTMDay.R" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="0db2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的下一篇文章将展示该模型的第二个版本。请随意评论！</p></div></div>    
</body>
</html>