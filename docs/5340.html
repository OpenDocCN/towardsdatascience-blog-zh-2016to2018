<html>
<head>
<title>Natural Language Processing for Fuzzy String Matching with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 实现模糊字符串匹配的自然语言处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/natural-language-processing-for-fuzzy-string-matching-with-python-6632b7824c49?source=collection_archive---------2-----------------------#2018-10-12">https://towardsdatascience.com/natural-language-processing-for-fuzzy-string-matching-with-python-6632b7824c49?source=collection_archive---------2-----------------------#2018-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/0a24b75ff025b0051aecabadf522bf37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-nu2nuMb9Qn7uys98ogNA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">photo credit: Pexels</figcaption></figure><div class=""/><div class=""><h2 id="25c3" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">当我们比较不同网站的酒店房价时，我们必须确保我们是在进行比较</h2></div><p id="5cdf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Approximate_string_matching" rel="noopener ugc nofollow" target="_blank">在计算机科学中，模糊字符串匹配是一种寻找与模式近似(而不是精确)匹配的字符串的技术</a>。换句话说，模糊字符串匹配是一种即使用户拼错单词或只输入部分单词也能找到匹配项的搜索类型。也被称为<a class="ae lq" href="https://en.wikipedia.org/wiki/Approximate_string_matching" rel="noopener ugc nofollow" target="_blank">近似串匹配</a>。</p><p id="a0b7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">模糊字符串搜索可用于各种应用，例如:</p><ul class=""><li id="df31" class="lr ls jf kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">拼写检查和拼写错误，错别字校正器。例如，用户在谷歌中输入<a class="ae lq" href="https://www.google.ca/search?ei=rc64W6rHIOeUjwT3z6-4CA&amp;q=missisaga&amp;oq=missisaga&amp;gs_l=psy-ab.3..0i10k1l10.30325.30325.0.30947.1.1.0.0.0.0.75.75.1.1.0....0...1c.1.64.psy-ab..0.1.74....0.gGpQVAid93s" rel="noopener ugc nofollow" target="_blank">“密西沙加”，会返回一个点击列表以及“显示密西沙加的结果”。也就是说，即使用户输入包含额外的或缺失的字符，或其他类型的拼写错误，搜索查询也将返回结果。</a></li><li id="287d" class="lr ls jf kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">一个软件可以用来检查重复的记录。例如，如果由于客户姓名的不同拼法(例如 Abigail Martin vs . Abigail Martinez)而在数据库中多次列出不同的购买记录，则可能是新地址或错误输入的电话号码。</li></ul><p id="4074" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">说到重复数据删除，它可能不像听起来那么简单，尤其是当您有成千上万条记录时。甚至 Expedia 也没有做到 100%正确:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/6dad29d3b9748a263bef6395daf34d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDNIYd_Zcmjz3PuQ3KFX_w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Source: Expedia</figcaption></figure><p id="3ff0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这篇文章将解释什么是模糊字符串匹配及其用例，并给出使用 Python 的<a class="ae lq" href="https://github.com/seatgeek/fuzzywuzzy" rel="noopener ugc nofollow" target="_blank"> Fuzzywuzzy 库</a>的例子。</p><p id="4b5f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">每家酒店都有自己的房间命名法，在线旅行社也是如此。例如，同一家酒店的一个房间，Expedia 称之为“工作室，一张特大床和沙发床，角落”，Booking.com 可能会发现简单地将房间显示为“角落特大工作室”是安全的。</p><p id="22ae" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这没有错，但当我们想要比较在线旅行社之间的房价时，或者一家在线旅行社想要确保另一家在线旅行社遵守<a class="ae lq" href="https://www.siteminder.com/what-is-hotel-rate-parity/" rel="noopener ugc nofollow" target="_blank">价格平价</a>协议时，这可能会导致混乱。换句话说，为了能够比较价格，我们必须确保我们是在比较苹果与苹果。</p><p id="4116" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">对于价格比较网站和应用程序来说，最令人沮丧的问题之一是试图自动判断两件商品(或酒店房间)是否是同一件东西。</p><h1 id="e44e" class="mk ml jf bd mm mn mo mp mq mr ms mt mu kl mv km mw ko mx kp my kr mz ks na nb bi translated">Python 中的 FuzzyWuzzy</h1><p id="8eab" class="pw-post-body-paragraph ku kv jf kw b kx nc kg kz la nd kj lc ld ne lf lg lh nf lj lk ll ng ln lo lp ij bi translated"><a class="ae lq" href="https://github.com/seatgeek/fuzzywuzzy" rel="noopener ugc nofollow" target="_blank"> Fuzzywuzzy </a>是一个 Python 库，使用<a class="ae lq" href="https://en.wikipedia.org/wiki/Levenshtein_distance" rel="noopener ugc nofollow" target="_blank"> Levenshtein 距离</a>来计算一个简单易用的包中序列之间的差异。</p><p id="5605" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了演示，我创建了自己的<a class="ae lq" href="https://github.com/susanli2016/NLP-with-Python/blob/master/room_type.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>，也就是说，对于同一个酒店，我从 Expedia 获取一个房间类型，比如“套房，一张特大床(客厅)”，然后我将其与 Booking.com 的一个房间类型“特大客厅套房”进行匹配。只要有一点点经验，大多数人就会知道它们是一样的。按照这种方法，我创建了一个小型数据集，包含 100 多个房间类型对，可以在<a class="ae lq" href="https://github.com/susanli2016/NLP-with-Python/blob/master/room_type.csv" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><p id="94d2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">利用这个数据集，我们将测试 Fuzzywuzzy 是如何思考的。换句话说，我们使用 Fuzzywuzzy 来匹配两个数据源之间的记录。</p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="cdb9" class="nm ml jf ni b gy nn no l np nq">import pandas as pd</span><span id="9966" class="nm ml jf ni b gy nr no l np nq">df = pd.read_csv('room_type.csv')<br/>df.head(10)</span></pre><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/536e705984c5f95242cb2cebe9769e51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_CluiTiE-YoLrpGIV009w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="badb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">数据集是我自己创建的，所以，很干净。</p><p id="4e8b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Fuzzywuzzy 中比较两个字符串有几种方法，我们一个一个来试试。</p><ul class=""><li id="4328" class="lr ls jf kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe nt nu nv ni b">ratio</code>，比较整个字符串的相似度，按顺序排列。</li></ul><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="3839" class="nm ml jf ni b gy nn no l np nq">from fuzzywuzzy import fuzz<br/>fuzz.ratio('Deluxe Room, 1 King Bed', 'Deluxe King Room')</span></pre><p id="4e31" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 62 </em> </strong></p><p id="c7a5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这告诉我们“豪华客房，一张特大床”和“豪华大床房”大约有 62%是相同的。</p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="2b1e" class="nm ml jf ni b gy nn no l np nq">fuzz.ratio('Traditional Double Room, 2 Double Beds', 'Double Room with Two Double Beds')</span></pre><p id="a11c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 69 </em> </strong></p><p id="3495" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">“传统双人房，两张双人床”和“双人房，两张双人床”大约有 69%相同。</p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="e25f" class="nm ml jf ni b gy nn no l np nq">fuzz.ratio('Room, 2 Double Beds (19th to 25th Floors)', 'Two Double Beds - Location Room (19th to 25th Floors)')</span></pre><p id="a0e2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 74 </em> </strong></p><p id="18c2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">“房间，两张双人床(19 至 25 层)”和“两张双人床-位置房间(19 至 25 层)”对大约 74%相同。</p><p id="3925" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我对这些感到失望。事实证明，这种天真的方法对词序的微小差异、遗漏或多余的单词以及其他类似问题过于敏感。</p><ul class=""><li id="88c5" class="lr ls jf kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe nt nu nv ni b">partial_ratio</code>，比较部分字符串相似度。</li></ul><p id="86bf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们仍然使用相同的数据对。</p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="430c" class="nm ml jf ni b gy nn no l np nq">fuzz.partial_ratio('Deluxe Room, 1 King Bed', 'Deluxe King Room')</span></pre><p id="c827" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 69 </em> </strong></p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="3e86" class="nm ml jf ni b gy nn no l np nq">fuzz.partial_ratio('Traditional Double Room, 2 Double Beds', 'Double Room with Two Double Beds')</span></pre><p id="004b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 83 </em> </strong></p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="46bc" class="nm ml jf ni b gy nn no l np nq">fuzz.partial_ratio('Room, 2 Double Beds (19th to 25th Floors)', 'Two Double Beds - Location Room (19th to 25th Floors)')</span></pre><p id="949f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 63 </em> </strong></p><p id="3704" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">对于我的数据集，比较部分字符串并不能带来整体更好的结果。我们继续。</p><ul class=""><li id="a6e9" class="lr ls jf kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe nt nu nv ni b">token_sort_ratio</code>，忽略词序。</li></ul><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="dc75" class="nm ml jf ni b gy nn no l np nq">fuzz.token_sort_ratio('Deluxe Room, 1 King Bed', 'Deluxe King Room')</span></pre><p id="f162" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 84 </em> </strong></p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="a2d6" class="nm ml jf ni b gy nn no l np nq">fuzz.token_sort_ratio('Traditional Double Room, 2 Double Beds', 'Double Room with Two Double Beds')</span></pre><p id="aa6f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 78 </em> </strong></p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="174a" class="nm ml jf ni b gy nn no l np nq">fuzz.token_sort_ratio('Room, 2 Double Beds (19th to 25th Floors)', 'Two Double Beds - Location Room (19th to 25th Floors)')</span></pre><p id="7090" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 83 </em> </strong></p><p id="d9e1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">目前为止最好的。</p><ul class=""><li id="48ee" class="lr ls jf kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe nt nu nv ni b">token_set_ratio</code>，忽略重复单词。它类似于令牌排序比率，但更灵活一点。</li></ul><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="c9db" class="nm ml jf ni b gy nn no l np nq">fuzz.token_set_ratio('Deluxe Room, 1 King Bed', 'Deluxe King Room')</span></pre><p id="ef9b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 100 </em> </strong></p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="d9a3" class="nm ml jf ni b gy nn no l np nq">fuzz.token_set_ratio('Traditional Double Room, 2 Double Beds', 'Double Room with Two Double Beds')</span></pre><p id="5a1c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">T3】78T5】</strong></p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="c1a1" class="nm ml jf ni b gy nn no l np nq">fuzz.token_set_ratio('Room, 2 Double Beds (19th to 25th Floors)', 'Two Double Beds - Location Room (19th to 25th Floors)')</span></pre><p id="f5b1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nw"> 97 </em> </strong></p><p id="f0ec" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">看起来<code class="fe nt nu nv ni b">token_set_ratio </code>最适合我的数据。根据这个发现，我决定将<code class="fe nt nu nv ni b">token_set_ratio</code>应用于我的整个数据集。</p><pre class="mg mh mi mj gt nh ni nj nk aw nl bi"><span id="aac0" class="nm ml jf ni b gy nn no l np nq">def get_ratio(row):<br/>    name = row['Expedia']<br/>    name1 = row['Booking.com']<br/>    return fuzz.token_set_ratio(name, name1)<br/>len(df[df.apply(get_ratio, axis=1) &gt; 70]) / len(df)</span></pre><p id="6164" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"><em class="nw">0.9029126213592233</em></strong></p><p id="e054" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">当设置比率&gt; 70 时，超过 90%的配对超过 70 的匹配分数。没那么寒酸！</p><p id="e2e3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://github.com/susanli2016/NLP-with-Python/blob/master/Fuzzy%20String%20Matching.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>可以在<a class="ae lq" href="https://github.com/susanli2016/NLP-with-Python/blob/master/Fuzzy%20String%20Matching.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。星期五快乐！</p></div></div>    
</body>
</html>