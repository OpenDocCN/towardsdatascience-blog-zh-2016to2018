<html>
<head>
<title>Predicting Dengue Spread Using Seasonal ARIMAX Model and Meteorological Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用季节性 ARIMAX 模型和气象数据预测登革热传播</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-dengue-spread-using-seasonal-arimax-model-on-meteorology-data-3f35979ec5d?source=collection_archive---------6-----------------------#2018-08-12">https://towardsdatascience.com/predicting-dengue-spread-using-seasonal-arimax-model-on-meteorology-data-3f35979ec5d?source=collection_archive---------6-----------------------#2018-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5f76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在过去的几十年中，登革热病毒已经在世界的亚热带地区传播，严重形式的登革热的数量增加，例如严重出血、低血压，甚至死亡。由于疾病由蚊子传播，登革热的传播与温度和降水等气象变量有关。在这篇博文中，我将回顾一下我是如何应对<a class="ae kl" href="https://www.drivendata.org/competitions/44/dengai-predicting-disease-spread/" rel="noopener ugc nofollow" target="_blank">邓艾竞赛</a>的论文和代码可以在<a class="ae kl" href="https://github.com/bostonchopsticks/Predicting-Disease-Spread" rel="noopener ugc nofollow" target="_blank">我的 github </a>上找到！</p><p id="cb32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是游戏计划:</p><ol class=""><li id="3500" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">数据分割</li><li id="29c7" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">描述性分析和数据可视化</li><li id="93f4" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">处理缺失值</li><li id="fb33" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">模型诊断</li><li id="a46f" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">模型形成</li><li id="e40c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">预测</li></ol></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="6f71" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">数据分割</h1><p id="3c9d" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">邓艾竞赛数据集本质上是一个杂乱的数据集，包含两个不同的城市和两个不同的时间框架。我根据两个城市将数据集分成两个小数据集:圣胡安和伊基托斯。从两个数据集中，我将每个数据集分为训练集和验证集，以便在选择最佳模型在最终测试集上执行之前测试不同的模型。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/49176e25a6e0c6d4016002a5bda2a9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CLMKEaQ-2oGUqcaKbsTIA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 1:</strong> Data Split</figcaption></figure></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="d567" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">描述性分析和数据可视化</h1><p id="fe71" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">圣胡安和伊基托斯的数据处理非常相似，所以我在这一节只展示圣胡安的图表。伊基托斯的图表将在<a class="ae kl" href="https://github.com/bostonchopsticks/Predicting-Disease-Spread" rel="noopener ugc nofollow" target="_blank">我的论文</a>中提供。</p><p id="73d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个数据集包含 25 个变量，包括气象和地理变量。在此查看每个变量<a class="ae kl" href="https://www.drivendata.org/competitions/44/dengai-predicting-disease-spread/page/82/" rel="noopener ugc nofollow" target="_blank">的详细信息。</a></p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/939c5d8563572ac2930a268696a47960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*HhDaR2doDYgE6gekDxAZww.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 2:</strong> Descriptive Analysis of San Juan</figcaption></figure><p id="2d9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相关图将有助于诊断两个变量之间是否存在任何线性关系。我们可以看到，这些变量中没有一个与总病例数<strong class="jp ir">(图 3) </strong>高度相关。然而，如果我们包括 2 个以上的变量并运行多元线性回归，每个预测因子的大小可能会改变。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nc"><img src="../Images/59ef700893fb29f4787284c4f67852bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KIMq2ISjROvOFiJBfGYmkg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 3:</strong> Correlation Plot of San Juan</figcaption></figure><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/44db3683c8478be5e589b82d0d08c584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*f6WnQsyBVevr9KENqEGJyA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 4:</strong> Time Series Plot of Total Cases of San Juan</figcaption></figure><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/0a5de52ea47cec09f95514ca60e7a4d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*bziC1vcTTLtb74yIkiNXQA.png"/></div></figure><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/50033c51a828742f295cda0f25680e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*JidkGUVwtHCUPrIjYGR0bQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 5:</strong> Scatter Plots of Total Cases and Climate Variables of San Juan</figcaption></figure><p id="db10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">时间序列图表明数据中可能存在季节性，因为每年夏季前后总病例数达到高峰。两个散点图也表明了总病例数和两个气候变量之间可能的线性关系。(温度和湿度)</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/e920f68e4e3335821c3bbb9c5cac2a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*QkcFtusWLqJ3PMqAOWpN5w.png"/></div></figure><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ffbbf9ab8230a60f07015cef1fc3a7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*_4RUEL8SYtCt4hFse0lAog.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 6:</strong> Time Series Plot of Total Cases and Climate Variables of San Juan</figcaption></figure><p id="c857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看总例数和温度以及总例数和湿度的双时间序列图，我们可以看到有时例数和气候值一起上下移动；有时天气变量首先达到峰值或直线下降，然后总病例数在 3 -4 周后上下波动。更有趣的是，登革热症状通常在被受感染的蚊子叮咬后 4 至 7 天开始出现。蚊子在 70 华氏度时可能需要 14 天完成其生命周期，而在 80 华氏度时只需要 10 天。因此，在温度、降雨量或湿度上下波动后，平均需要 3-4 周才能报告病例。</p><p id="2de2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">描述性分析和数据可视化提出了一个具有额外预测变量的时间序列模型，并且可能有一些预测变量的先前滞后。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="a816" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">处理缺失值</h1><p id="cae6" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">我通过使用 R 中的<strong class="jp ir">最后一次观察结转</strong>方法来处理缺失数据，这基本上是用之前最近的非 NA 替换每个 NA。这里我假设本周的天气与上周的天气不会有太大的不同。</p><pre class="ml mm mn mo gt nh ni nj nk aw nl bi"><span id="c17e" class="nm li iq ni b gy nn no l np nq"><em class="nr"># build a function to impute data with the most recent that is non missing</em><br/>  na.locf.data.frame &lt;- <br/>    <strong class="ni ir">function</strong>(object, <strong class="ni ir">...</strong>) replace(object, TRUE, lapply(object, na.locf, <strong class="ni ir">...</strong>))<br/>  <br/>  <em class="nr">#fill in NAs - SJ</em><br/>  sjdata.train.imputed &lt;- na.locf.data.frame(sjdata.train)<br/>  <br/>  <em class="nr">#fill in NAs - IQ</em><br/>  iqdata.train.imputed &lt;- na.locf.data.frame(iqdata.train)</span></pre></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="2a31" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">模型诊断</h1><p id="5275" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">一个增强的 Dickey-Fuller 检验表明时间序列数据集是平稳的。该数据集具有复杂的季节性，每周数据点(频率= 52.18)。ETS、分解等方法大多要求季节周期为整数。即使我们把它四舍五入到 52，大多数方法也不会有效地处理这么大的季节周期。一种可能的方法是通过在 ARIMA 模型中包括傅立叶项来使用动态谐波回归模型。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/1d00c4ce08e72a4a22e4f926b32a25f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*qhCrGAqVUWBhhFx98fXY3w.png"/></div></figure><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/4f58ebbc1de3c81a316d072299e5113e.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*HFB1lrco6g9ZG1xkaLb7jw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 7:</strong> ACF and PACF Plots of Total Cases of San Juan Time Series</figcaption></figure><p id="e14e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，为了挑选 MA 和 AR 术语，我首先检查了早期滞后(1，2，3，…)来判断非季节性术语。在低滞后时，ACF 中的这些峰值表示非季节性 MA 术语。此外，PACF 在低滞后时的峰值表明可能存在非季节性 AR 项。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="c001" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">模型形成</h1><p id="50b1" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">通过经验审查和数据诊断，我决定尝试 3 种模型:SARIMA、SARIMAX 和神经网络。我从一个只有全部病例的基本而简单的季节性 ARIMA 开始，然后我在模型中添加了更多的预测因子，如温度、湿度、降雨量。最后，我用 r 中的 NNETAR 包建立了神经网络模型(多层前馈网络)。这里我将只报告建立最佳模型的过程，即季节性 ARIMAX。</p><p id="77be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">季节性 ARIMAX </strong></p><p id="b4ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在研究了影响蚊子繁殖的因素后，我使用 xreg 参数将这些变量添加到季节性 ARIMA 中:</p><ul class=""><li id="49cb" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk nt ks kt ku bi translated">降水量 _ 金额 _ 毫米</li><li id="bf4e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated">再分析露点温度 k</li><li id="4c12" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated">再分析 _ 相对湿度 _ 百分比</li><li id="7682" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated">车站平均温度 c</li><li id="b7dc" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated">车站 _ 昼夜 _ 温度 _rng_c</li><li id="8664" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated">车站最高温度 c</li><li id="d1fd" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated">车站最低温度 c</li></ul><p id="ac79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，如果你在一个热带国家长大，你可能知道蚊子的生命周期包括在水中和空气中的四个不同的阶段。因此，降水、温度和湿度在加速蚊子数量方面起着重要作用。请参考此链接了解更多信息。</p><p id="865e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时，包含在回归模型中的预测因子的影响不是简单而直接的。例如，高温和高降雨量可能在几周之后的一段时间内影响所有病例。我运行了 CCF(交叉相关函数),以查看预测因子的任何先前滞后是否与总病例的当前滞后高度相关。似乎前 4 周的露水温度可能与当前的病例数正相关。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/4590cd028e13a3197446d2197fbe7bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*2ojYAO-u_mvXgHIuPxGE0Q.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 8:</strong> CCF Plots of Total Cases and Dew Temperature of San Juan Time Series</figcaption></figure><p id="c327" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ARIMA 模型的选择是使用赤池的信息标准(AIC)进行的。在所有测试的模型中，a SARIMAX (3，0，2)(0，0，1)[52]是最适合圣胡安市的模型，而 ARIMAX (0，1，2)的季节傅立叶项 K = 1 是伊基托斯市的最佳模型。</p><p id="af65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 ARIMA 和 NNET 之间的最终选择基于使用 MAE 作为主要参数的样本内交叉验证。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nv"><img src="../Images/2d894f52b187916c0912a47d8d42afac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hAledktsp2tSt52VZeNODg.png"/></div></div></figure></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="5a38" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">预测</h1><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2bf088c44ecffa3af50eb944ab2f103d.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*t1J1DGMjKaqgDHgJfc8WJQ.png"/></div></figure><p id="f344" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是两个城市的预测图。我综合了圣胡安和伊基托斯总病例的预测，并将结果提交给数据驱动网站。我 MAE 得了 25.6587，排名 674/4392。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/2b224f33fdf71e37425ad2267b748532.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*OeT6BgPaBP6cbFj0lpUfqA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk"><strong class="bd na">Figure 9:</strong> Forecasted Values of Total Cases of San Juan and Iquitos</figcaption></figure><p id="aa8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终的模型有一些缺点，可以在将来解决。首先，我完全忽略了“ndvi”(地理变量和卫星植被指数)，而这些变量可能对疾病的爆发很重要。然而，为了包括这些变量，我需要做更多的研究，以更好地理解它们是什么、为什么以及如何重要。其次，该模型没有完全捕捉到导致登革热传播的所有因素。更多与这两个城市的基础设施和医疗保健系统相关的变量应该包括在模型中。最后，可以使用多季节周期模型来显示周、月和年的不同季节模式，因为当前模型仅捕获每周的季节性。</p></div></div>    
</body>
</html>