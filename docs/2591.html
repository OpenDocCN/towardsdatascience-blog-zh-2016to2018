<html>
<head>
<title>Setting Your Seed Value with Sparklyr</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Sparklyr设置种子值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-your-seed-value-with-sparklyr-56dba13b15f?source=collection_archive---------12-----------------------#2018-02-09">https://towardsdatascience.com/setting-your-seed-value-with-sparklyr-56dba13b15f?source=collection_archive---------12-----------------------#2018-02-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5edbb5a027e6f1d93bd7b6abc6b56394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*faNZ9T2l-Xp7t8Lh6uk9PA.jpeg"/></div></div></figure><p id="bd71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">几个月前，我做了一个关于可重复研究的雄心勃勃的报告。本演示的一部分包括演示如何使用R和Sparklyr包分析Spark cluster上的数据。</p><p id="e491" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您接受数据科学家培训时，您首先要学习的事情之一是设置一个种子值。设置种子位于创建预测模型时运行的每个脚本的顶部。写那一行代码变得反射性和第二天性，以至于你可能会忘记为什么要写它。</p><p id="c601" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你写它是为了可复制性。我不会深入讨论如何和在哪里，但是任何时候你可能必须生成随机数，你要确保如果别人运行你的脚本，他们得到相同的结果。由于预测建模算法大量使用随机数发生器，所以你必须在你做的几乎每个项目中播种。通过运行下面的示例代码，可以看到set seed的效果。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="e47a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我为我的演示构建Sparklyr示例代码时，我尽职尽责地用我以前无数次做过的方式设置了种子。然而，这一次，我不太确定我是否应该这样做。我看到的示例代码没有在任何地方设置种子。我认为这只是一个疏忽，但我不确定。因为我是习惯的奴隶，所以我把它留在了家里。</p><p id="7336" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在展示的那天晚上，一位火花专家在人群中。我知道她每天都和Sparklyr一起工作，所以我邀请她随时参与进来。果不其然，她指出set seed与Spark的工作方式并不像我想象的那样。后来，我们就这个问题进行了热烈的讨论；最重要的是，我们都不知道为什么它不起作用。</p><p id="4af2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们回到几天前:我正在准备另一个讲座，这次是专门关于Sparklyr的。我想检查一下set seed的问题是否已经解决。我用谷歌搜索了这个问题，用了各种我认为会有所收获的关键词，但什么也没找到。然后，我做了任何一个有自尊的工程师都会做的事，走向了Stackoverflow。</p><p id="e95f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里看到帖子<a class="ae lc" href="https://stackoverflow.com/questions/48613867/does-using-set-seed-with-sparklyr-work-now/48622563#_=_" rel="noopener ugc nofollow" target="_blank"/>，但是我想把答案和提问的背景放在一起。<a class="ae lc" href="https://stackoverflow.com/users/6910411/user6910411" rel="noopener ugc nofollow" target="_blank"> user6910411 </a>很好地给了我一个全面的回答，我会在这里完整地分享。</p><p id="d495" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">TL；DR:当你在R中使用Spark时，你在两个不同的地方工作——你的本地机器和Spark集群。set seed在您的本地机器上。要在群集上设置种子，请使用Sparklyr函数中的参数。</strong></p><p id="ea98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一般来说，set.seed在它应该在的地方工作得很好——在本地R会话中，也称为驱动程序(您调用spark_connect的地方)。它不起作用，而且由于许多原因，它不能跨执行器工作，包括不同的执行上下文(R、JVM)和/或不同的环境(使用spark_apply这样的方法)。</p><p id="6856" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">带火花包装器:</strong></p><p id="0dc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用ml_*或者ft_等方法。种子由Spark设置，通常使用种子参数公开。例如ml_kmeans:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="ee5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也可以为RNG SQL函数设置种子:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="1928" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">带执行器端R代码</strong></p><p id="e959" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">据我所知，目前还没有任何选择。跨多台机器正确设置RNG种子将需要API来访问低级任务信息，并且即使假设没有其他不确定性来源，在异构环境中也可能是脆弱的。</p><p id="cd96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">然而</strong></p><p id="e7b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">RNG状态不是分布式系统中非确定性行为的唯一来源。因为在Spark中一般不保证任何特定的执行顺序，所以不同运行之间的结果可能不同，即使RNG状态设置正确。</p><p id="f897" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">总体</strong>:</p><p id="4018" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你的目标是可重复的研究，你可能仍然可以使用Spark，但它需要一个防御性的编程，有意识地建立集群，这不是你可以用内置工具做的事情，更不用说像sparklyr这样有限的高级包装器了。</p></div></div>    
</body>
</html>