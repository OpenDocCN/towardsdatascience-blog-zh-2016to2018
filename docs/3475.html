<html>
<head>
<title>Adjusting Prices for Inflation in Python with Pandas Merge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调整 Python 与熊猫合并的价格以适应通货膨胀</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/adjusting-prices-for-inflation-in-pandas-daaaa782cd89?source=collection_archive---------5-----------------------#2018-05-15">https://towardsdatascience.com/adjusting-prices-for-inflation-in-pandas-daaaa782cd89?source=collection_archive---------5-----------------------#2018-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="38e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几年来，我管理着一家小型初创投资基金。虽然华尔街分析师在分析公司时通常只回顾一两年，但我经常会追溯到 20 年或 30 年前。我甚至会偶尔翻阅上世纪 50 年代、20 年代或罕见的 19 世纪的经济和价格数据，以便更好地理解市场周期。然而，当你进行这种深度长期历史分析时，你会遇到一个问题:<strong class="jp ir"> <em class="kl">名义价格可能非常具有欺骗性</em> </strong>。</p><p id="0a27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以谷物价格为例。我们有<a class="ae km" href="https://fred.stlouisfed.org/series/WPU012" rel="noopener ugc nofollow" target="_blank">谷物生产者价格指数</a>追溯到 1926 年 1 月，当时该指数在 20 世纪 20 年代的繁荣时期为 37.9。2018 年 4 月，同一指数为 151.5。因此，在 92 年的时间框架内，谷物价格上涨了 4 倍。如果我们从 1933 年大萧条的底部开始衡量(当时指数为 11.0)，价格已经上涨了 15 倍！</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/9f45c454fca23bb624d9d1291cac9db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5lmdCNBArlK7cR7OzzHv_A.jpeg"/></div></div></figure><p id="019e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一张非常容易误导人的图片，仅仅从上面的图表很难看出这一点。一旦我们对通货膨胀进行调整，我们就会得到下面这张看起来完全不同的图表。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kz"><img src="../Images/ffcc3b7461171c6abb7c5238d5b9434d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OLwb6vSMD2cd0Vk8-T4wXw.jpeg"/></div></div></figure><p id="a2d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着时间的推移，谷物价格不仅没有上涨，实际上还在下跌。经 CPI 通胀调整后，如今的谷物价格比 1926 年低了 71%。今天的价格甚至比大萧条时期的低点低 24%。</p><p id="d206" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着时间的推移，谷物变得越来越便宜，实际农产品价格的下降缓解了世界大部分地区的贫困状况。你可能从来没有通过简单地看顶部图表中的名义价格而获得这种洞察力。你必须根据通胀进行调整，才能获得这种视角。</p><p id="1023" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">美国的通货膨胀</p><p id="468a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在过去的一个世纪里，美国的通货膨胀出现了戏剧性的循环。在第二次世界大战中，通货膨胀率飙升至 10.5%。到 1953 年，通货膨胀率一路下降到 0.8%。1980 年，通货膨胀率高达 13.5%，之后美联储对其进行了打击。2005 年，官方 CPI 通胀率为 3.4%，但美国最大的 20 个大都市区的房价却上涨了 14%！2017 年，通胀相对温和，为 2.0%(但随着劳动力和投入成本继续上升，通胀开始再次回升)。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi la"><img src="../Images/cffad170c3b93db9fdbf6af17af201d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WD4EdHAlsotGDy36YgOTg.jpeg"/></div></div></figure><p id="fe75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通货膨胀调整让你对实际价格有更好的理解。这个分析可以很有见地。事实上，我最成功的投资论文之一围绕着考察日本资产泡沫期间经通胀调整的铜价，并将其与 2000 年代末/2000 年代初的铜价泡沫进行比较。</p><p id="9628" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果你在一个<a class="ae km" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫数据框架</a>中工作，通货膨胀调整在 Python 中似乎是一个棘手的问题。您可能有数千行“数据点”,其日期分散在数据框的整个范围内。然而，通货膨胀数据往往是连续月度数据的形式。你如何将两者联系起来？</p><p id="1853" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">寻找你的消息来源</strong></p><p id="e199" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先要说的是来源。你用什么数据来调整通货膨胀？你在哪里找到通货膨胀的数据？</p><p id="268d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并不总是有一个“正确”的答案，但是如果你住在美国或者正在处理美国的价格数据，那么<a class="ae km" href="https://fred.stlouisfed.org/" rel="noopener ugc nofollow" target="_blank">美联储经济数据</a>(通常缩写为“FRED”)应该是你的首选来源之一。有几十种通货膨胀衡量方法，但我最常用的一种叫做“<a class="ae km" href="https://fred.stlouisfed.org/series/CPIAUCNS" rel="noopener ugc nofollow" target="_blank"> CPIAUCNS </a>”。这个通胀数据集可以一直追溯到 1913 年，这就是为什么它往往是我最喜欢的长期分析。</p><p id="a19d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有许多其他数据集。例如，如果你正在查看明尼阿波利斯的房价数据，你可能更喜欢查看房价指数，如<a class="ae km" href="https://fred.stlouisfed.org/series/ATNHPIUS33460Q" rel="noopener ugc nofollow" target="_blank">全交易房价指数</a>或<a class="ae km" href="https://fred.stlouisfed.org/series/MNXRSA" rel="noopener ugc nofollow" target="_blank"> Case-Shiller 明尼阿波利斯房价指数</a>。然而，通常情况下，CPI 的某个变量就是你要用的指数。</p><p id="a17b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">设置您的索引</strong></p><p id="aa0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CPI 通胀指数和房价指数已经以某种方式进行了指数化，但是你可能需要重新对数据进行指数化以适应你自己的目的。例如，如果您的通货膨胀数据在 1982 年 1 月的指数为 100，而您的数据集处理的是 2004 年到 2017 年的数据，您可能希望根据 2004 年的价格(开始)或 2017 年的价格(结束)来索引您的数据。</p><p id="c39d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以用 Excel 或者 Python 来做这个。诚然，我发现在 Excel 中调整数据通常更容易，但如果我们有一个特别大的数据集，Python 可能是一个更好的选择。</p><p id="f0ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Python 中，我们可以通过加载通胀数据并为“指数乘数”创建一个新列来实现这一点。然后，我们只需将名义价格乘以“指数乘数”。</p><pre class="ko kp kq kr gt lb lc ld le aw lf bi"><span id="1590" class="lg lh iq lc b gy li lj l lk ll"># load inflation data<br/>inflation = pd.read_excel(‘inflation_data.xls’, sheetname=’Data’)</span><span id="0132" class="lg lh iq lc b gy lm lj l lk ll"># create index multiplier<br/>inflation[‘CPI_Multiplier’] = inflation[‘CPI’].iloc[-1] / inflation[‘CPI’]</span></pre><p id="c287" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意在这个例子中，我使用最后一个数据值来创建指数，因此价格将被索引到今天的价格。如果我们使用第一个数据点基于开始的起始点进行索引，我们将选择第一个值而不是最后一个值。</p><p id="8545" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个调整价格的指数。我们需要合并两个数据集来执行操作。</p><p id="db68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">匹配日期</strong></p><p id="e5bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，在我们合并之前，我们必须处理这个练习中最棘手的部分:日期。日期可能是编程中的一大难题。有几种方法可以处理它们。</p><p id="a91f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在最近的数据集中，我发现月份和年份在不同的列中，如下例所示。</p><pre class="ko kp kq kr gt lb lc ld le aw lf bi"><span id="9d7c" class="lg lh iq lc b gy li lj l lk ll">Month Year<br/>01    2008<br/>04    2012<br/>09    2016</span></pre><p id="b449" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同时，我的通货膨胀数据上的日期被识别为 yyyy/mm/dd 格式，如下所示:</p><pre class="ko kp kq kr gt lb lc ld le aw lf bi"><span id="a118" class="lg lh iq lc b gy li lj l lk ll">Date          CPI_Multiplier<br/>2008/01/01    1.000<br/>2008/02/01    1.003<br/>2008/03/01    1.005<br/>2008/04/01    1.011</span></pre><p id="8325" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两者如何对齐？</p><p id="d5dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答案有很多，但我创建了一个“日”列，并将其赋值为 1(以匹配通货膨胀数据中的日期)，并使用<a class="ae km" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.to_datetime.html" rel="noopener ugc nofollow" target="_blank"> pd.to_datetime </a>在原始数据集中创建一个“日期”列。</p><pre class="ko kp kq kr gt lb lc ld le aw lf bi"><span id="cc01" class="lg lh iq lc b gy li lj l lk ll"># load data set<br/>df = pd.read_excel('training_data.xlsx')</span><span id="bc4f" class="lg lh iq lc b gy lm lj l lk ll"># create new day column for 'day'<br/>df['day'] = 1</span><span id="508a" class="lg lh iq lc b gy lm lj l lk ll">#create new dataframe to store date info<br/>new_df = df[['year', 'month', 'day']]</span><span id="89a3" class="lg lh iq lc b gy lm lj l lk ll"># create new column 'Date' in original data w/ datetime conversion<br/>df['Date'] = pd.to_datetime(new_df)</span></pre><p id="8630" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Pandas 中，pd.to_datetime()是一个强大的工具，但是您必须让您的数据恰到好处地工作。</p><p id="c453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">合并数据</strong></p><p id="68d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们加载膨胀数据，并使用<a class="ae km" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.merge.html" rel="noopener ugc nofollow" target="_blank"> pd.merge </a>来合并两个数据帧。“how”参数指定联接的类型。在这种情况下，我将“df”(我的主数据集)设置为第一个参数，将“inflation”(通货膨胀数据)设置为第二个参数，并使用“left”连接在“Date”进行合并。</p><pre class="ko kp kq kr gt lb lc ld le aw lf bi"><span id="4060" class="lg lh iq lc b gy li lj l lk ll"># merge dataframe<br/>df = pd.merge(df, inflation, how='left', on='Date')</span></pre><p id="64e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，有了合并的数据框架，创建索引就很容易了。</p><pre class="ko kp kq kr gt lb lc ld le aw lf bi"><span id="aa52" class="lg lh iq lc b gy li lj l lk ll">df[‘CPIAdjPrice’] = df[‘SalePrice’] * df[‘CPI_Multiplier’] </span></pre><p id="29e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">维奥拉。我们现在可以看到实际价格了！</p><p id="cda3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结论</strong></p><p id="c844" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在长期数据序列中，通货膨胀调整对理解数据至关重要。通过使用名义价格，它也可以使预测变得更加棘手。</p><p id="767c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通货膨胀调整可以用于观察商品价格或零售价格，但也可以与住房价格指数一起使用，以调整动荡市场中的住房价格。这样，我们可以将“市场波动”和“通货膨胀”作为预测模型的一部分。</p></div></div>    
</body>
</html>