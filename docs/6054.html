<html>
<head>
<title>Plant AI — Deploying Deep Learning Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">植物人工智能—部署深度学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/plant-ai-deploying-deep-learning-models-9dda5f6c1088?source=collection_archive---------3-----------------------#2018-11-23">https://towardsdatascience.com/plant-ai-deploying-deep-learning-models-9dda5f6c1088?source=collection_archive---------3-----------------------#2018-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a53c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在我的<a class="ae kl" href="https://medium.com/@tairuoluwafemi09/plant-ai-plant-disease-detection-using-convolutional-neural-network-9b58a96f2289" rel="noopener">上一篇</a>中，我谈到了我是如何构建植物 AI 的——一个使用卷积神经网络的植物病害检测模型。最后，我们有了一个模型，将在本文中部署。工厂 AI 的代码可以在<a class="ae kl" href="https://www.kaggle.com/emmarex/plant-disease-detection-using-keras" rel="noopener ugc nofollow" target="_blank">这里</a>找到，输出<a class="ae kl" href="https://www.kaggle.com/emmarex/plant-disease-detection-using-keras/output" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/c162ac8cbb0206da0e0358ad51a7deef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-rNjyXQfADqjG5lrTpsDw.png"/></div></div></figure><p id="f6eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是一个不能用的模型有什么好？因此，在这篇文章中，我将讲述我是如何通过 API 将这个模型部署到 Android 应用程序中的。</p><p id="2995" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了通过 API 部署我们训练好的模型，我们将做一些类似于下面的事情:</p><ul class=""><li id="c4c7" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">加载我们的训练模型</li><li id="67f3" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">接受传入数据并对其进行预处理</li><li id="93fc" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">使用我们加载的模型进行预测</li><li id="51f7" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">处理预测输出。</li></ul><p id="46cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在生产中以多种方式使用我们的模型，例如:</p><ul class=""><li id="902c" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">将它直接加载到我们的应用程序中:这里我们假设您的模型可以与其他应用程序文件一起保存。这允许我们直接加载模型。我们可以通过简单的编写来加载我们的模型</li></ul><blockquote class="lm ln lo"><p id="0420" class="jn jo lp jp b jq jr js jt ju jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj kk ij bi translated">model _ file = pickle . load(open(" CNN _ model . pkl "，' rb '))</p><p id="7528" class="jn jo lp jp b jq jr js jt ju jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj kk ij bi translated">或者 model _ file = load _ model(' my _ model . H5 ')</p></blockquote><ul class=""><li id="065d" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">通过 API 使模型可用。这就是我为植物人工智能所做的。有许多方法可以让我们通过 API 获得一个模型。其中一些包括:</li></ul><p id="6aeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用 Django 或 Flask </strong>定制 REST-API:在这种情况下，我们用<a class="ae kl" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>的<a class="ae kl" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>之一构建一个定制 REST-API。这样，我们必须使我们的模型在我们的项目文件夹中可用，如上所述，加载它并执行预测，然后将结果作为 JSON 响应发送回来。</p><p id="a83d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Tensorflow </strong>:我们也可以使用 Tensorflow 部署我们的机器学习模型，使用<a class="ae kl" href="https://www.tensorflow.org/serving/" rel="noopener ugc nofollow" target="_blank"> Tensorflow 服务</a>。Tensorflow Serving 是为将机器学习模型部署到生产中而开发的，因此它包含用于与 Tensorflow 模型或任何其他模型集成的开箱即用工具。你可以看看这篇关于如何用 Tensorflow 机器学习模型的文章。</p><p id="3a7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">AWS Lambda/无服务器</strong>:这涉及到使用 AWS Lambda 使你的深度学习模型可用。你可以查看<a class="ae kl" href="https://aws.amazon.com/blogs/machine-learning/how-to-deploy-deep-learning-models-with-aws-lambda-and-tensorflow/" rel="noopener ugc nofollow" target="_blank"> AWS 文档</a>关于用<a class="ae kl" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>部署深度学习模型的帮助。</p><p id="ad6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个选择是利用 Kubernetes 来部署你的模型。你可以查阅 Kubernetes 文档或这篇<a class="ae kl" href="https://medium.com/analytics-vidhya/deploy-your-first-deep-learning-model-on-kubernetes-with-python-keras-flask-and-docker-575dc07d9e76" rel="noopener">中型文章</a>来获得如何使用 Kubernetes、Docker 和<a class="ae kl" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>部署深度学习模型的指导</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="60b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用<a class="ae kl" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a> — Python Web 框架开发了 Plant AI 的 API。无论您决定使用哪种 Python 框架，过程都应该是相同的。</p><ul class=""><li id="ec5f" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">首先确保您已经安装了这些软件包</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ma"><img src="../Images/24466ac7e4a949e46f88a2c4ff1a9818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKOhfmUlujgROqQ4A14kww.png"/></div></div></figure><p id="41d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Django </strong> </a>:一个 python web 框架。使用<a class="ae kl" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>或者你选择的任何其他 Python web 框架都没问题。</p><p id="3bca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/heroku/django-heroku" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Django-Heroku</strong></a>(仅当您将在<a class="ae kl" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>上托管您的应用时需要)</p><p id="7238" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.django-rest-framework.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Django-rest framework</strong></a><strong class="jp ir">:</strong>构建 web APIs 的强大工具。</p><p id="f112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">guni corn</strong></a><strong class="jp ir"/>:是一个用于 UNIX 的 WSGI HTTP 服务器。</p><p id="28ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://www.numpy.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Numpy</strong></a>:Python 编程语言的库，增加了对大型多维数组和矩阵的支持，以及对这些数组进行操作的大量高级数学函数。(来源:<a class="ae kl" href="https://en.wikipedia.org/wiki/Scikit-learn" rel="noopener ugc nofollow" target="_blank">维基百科</a>)</p><p id="ce74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Keras </strong> </a> : Keras 是用 Python 编写的开源神经网络库。它能够在 TensorFlow、微软认知工具包或 Theano 上运行。旨在实现深度神经网络的快速实验，它专注于用户友好、模块化和可扩展。(来源:<a class="ae kl" href="https://en.wikipedia.org/wiki/Scikit-learn" rel="noopener ugc nofollow" target="_blank">维基百科</a>)</p><p id="6cee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Sklearn </strong> </a>:一款<a class="ae kl" href="https://en.wikipedia.org/wiki/Free_software" rel="noopener ugc nofollow" target="_blank">免费软件</a> <a class="ae kl" href="https://en.wikipedia.org/wiki/Machine_learning" rel="noopener ugc nofollow" target="_blank">机器学习</a> <a class="ae kl" href="https://en.wikipedia.org/wiki/Library_(computing)" rel="noopener ugc nofollow" target="_blank">库</a>为<a class="ae kl" href="https://en.wikipedia.org/wiki/Python_(programming_language)" rel="noopener ugc nofollow" target="_blank"> Python </a>编程语言。它具有各种<a class="ae kl" href="https://en.wikipedia.org/wiki/Statistical_classification" rel="noopener ugc nofollow" target="_blank">分类</a>、<a class="ae kl" href="https://en.wikipedia.org/wiki/Regression_analysis" rel="noopener ugc nofollow" target="_blank">回归</a>和<a class="ae kl" href="https://en.wikipedia.org/wiki/Cluster_analysis" rel="noopener ugc nofollow" target="_blank">聚类</a>算法，包括<a class="ae kl" href="https://en.wikipedia.org/wiki/Support_vector_machine" rel="noopener ugc nofollow" target="_blank">支持向量机</a>、<a class="ae kl" href="https://en.wikipedia.org/wiki/Random_forests" rel="noopener ugc nofollow" target="_blank">随机森林</a>、<a class="ae kl" href="https://en.wikipedia.org/wiki/Gradient_boosting" rel="noopener ugc nofollow" target="_blank">梯度推进</a>、<a class="ae kl" href="https://en.wikipedia.org/wiki/K-means_clustering" rel="noopener ugc nofollow" target="_blank">、T25】 k  -means </a>和<a class="ae kl" href="https://en.wikipedia.org/wiki/DBSCAN" rel="noopener ugc nofollow" target="_blank"> DBSCAN </a>，旨在与 Python 数值和科学库<a class="ae kl" href="https://en.wikipedia.org/wiki/NumPy" rel="noopener ugc nofollow" target="_blank"> NumPy </a>和<a class="ae kl" href="https://en.wikipedia.org/wiki/SciPy" rel="noopener ugc nofollow" target="_blank">互操作(来源:</a><a class="ae kl" href="https://en.wikipedia.org/wiki/Scikit-learn" rel="noopener ugc nofollow" target="_blank">维基百科</a>)</p><p id="b33d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/ottoyiu/django-cors-headers" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Django-cors-headers</strong></a><strong class="jp ir">:</strong>一款 Django App，为响应添加 CORS(跨源资源共享)头。</p><ul class=""><li id="8cc2" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">设置您的 Django 项目。</li><li id="6591" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">接下来，确保您的模型在项目文件的一个文件夹中。你可以在这里下载植物 AI <a class="ae kl" href="https://www.kaggle.com/emmarex/plant-disease-detection-using-keras/output" rel="noopener ugc nofollow" target="_blank">的模型</a></li><li id="0955" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">下面是我的代码的样子</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mb"><img src="../Images/5ecfec16fadd14b2caf18065d608ca3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IRmzrubrl9rYYktJiGIEw.png"/></div></div></figure><p id="4882" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像往常一样，在<strong class="jp ir">线 1–7</strong>上，我导入了所需的必要包。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mc"><img src="../Images/1aa4adb2a0610621770b6755e1552dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hCDuaxAWTIVfTEkeK41unA.png"/></div></div></figure><p id="64c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">的第 33 行</strong>，我将通过 API 端点发送的数据(base64 中患病植物的图像)保存在 request_data 中。然后在<strong class="jp ir">第 34 行</strong>我分割数据，只得到图像。然后使用下面的<strong class="jp ir"> convert_image </strong>函数将图像转换成一个数组。该函数将返回一个图像数组，或者不返回任何图像数组，如果有错误消息，则返回一条错误消息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/80dbf243197bc2e642a29a8dbd296d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*bWXCBIBS4Tid_tv55o34qA.png"/></div></figure><p id="0260" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的第 38 行，我使用 Pickle 加载了生成的模型。然后在第 39 行，我将图像数组传递给模型。这将返回一个二进制化的标签。在我们的项目<a class="ae kl" href="https://www.kaggle.com/emmarex/plant-disease-detection-using-keras/output" rel="noopener ugc nofollow" target="_blank">中加载的标签二进制化器的帮助下，我能够将模型预测转换成任何可用的标签(在这种情况下是各种植物疾病)。</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi me"><img src="../Images/0e50e8410bf25b80aa877f15e7c40ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fBG5HBxW0WD4hGOy4RgIA.png"/></div></div></figure><p id="ba5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第 41–43 行</strong>包含一个 Python 字典，该字典包含该 API 将要传递的输出。在第 60 行上，这个 dict 作为 JSON 响应被发送回来。是的，就是这样！！！</p><p id="0507" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 Postman 测试我的 API，在大约 47312.525 毫秒(47.3 秒)内给出了我想要的结果。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mf"><img src="../Images/ae16bc5e5af6ca67c22bc74e144c71da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lpu4TMb6EZBIJEhxtl5QaA.png"/></div></div></figure><p id="b848" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个项目可以在 Github <a class="ae kl" href="https://github.com/Emmarex/naijahacks-fort-API" rel="noopener ugc nofollow" target="_blank">这里</a>获得。感谢阅读。</p></div></div>    
</body>
</html>