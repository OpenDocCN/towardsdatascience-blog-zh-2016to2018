<html>
<head>
<title>How I got Matplotlib to plot Apple Color Emojis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何让 Matplotlib 绘制苹果颜色表情符号</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-got-matplotlib-to-plot-apple-color-emojis-c983767b39e0?source=collection_archive---------18-----------------------#2018-12-26">https://towardsdatascience.com/how-i-got-matplotlib-to-plot-apple-color-emojis-c983767b39e0?source=collection_archive---------18-----------------------#2018-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="875b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及为什么图书馆目前不能</h2></div><h1 id="707d" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">问题是</h1><p id="ac40" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你尝试绘制表情符号，你可能会看到这样的东西:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/21035deba840dfc726f8714bb5945dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51gn6QalAzuPAEvDRJD_Lw.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">This graph has no meaning other than to demonstrate the appearance of plotted emojis.</figcaption></figure><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="14f4" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">虽然我们明确指定为字体，但这些表情符号并不是苹果色表情符号。它们来自字体 DejaVu Sans，默认字体在 Matplotlib 无法处理我们指定的字体后接管，抛出以下错误:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="652a" class="my kj it mu b gy mz na l nb nc">RuntimeError: In FT2Font: Could not set the fontsize<!-- -->.</span></pre><p id="63c5" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">关于 Matplotlib 中绘制表情符号的堆栈溢出的一些相关问题:</p><ul class=""><li id="bffe" class="nd ne it lc b ld mo lg mp lj nf ln ng lr nh lv ni nj nk nl bi translated"><a class="ae nm" href="https://stackoverflow.com/questions/47102873/how-to-plot-high-quality-emoji-in-matplotlib?noredirect=1&amp;lq=1" rel="noopener ugc nofollow" target="_blank">如何在 matplotlib 中绘制(高质量)表情符号？</a></li><li id="2004" class="nd ne it lc b ld nn lg no lj np ln nq lr nr lv ni nj nk nl bi translated"><a class="ae nm" href="https://stackoverflow.com/questions/43419590/matplotlib-annotate-plot-with-emoji-labels?noredirect=1&amp;lq=1" rel="noopener ugc nofollow" target="_blank"> matplotlib:用表情符号标签标注剧情</a></li><li id="fcd2" class="nd ne it lc b ld nn lg no lj np ln nq lr nr lv ni nj nk nl bi translated"><a class="ae nm" href="https://stackoverflow.com/questions/30049760/emoji-in-matplotlib-figures-on-os-x" rel="noopener ugc nofollow" target="_blank">OS X Matplotlib 中的表情符号</a></li><li id="93e5" class="nd ne it lc b ld nn lg no lj np ln nq lr nr lv ni nj nk nl bi translated"><a class="ae nm" href="https://stackoverflow.com/questions/51989729/emojis-in-matplotlibs-xticks" rel="noopener ugc nofollow" target="_blank">matplotlibs x ticks 中的表情符号</a></li><li id="3644" class="nd ne it lc b ld nn lg no lj np ln nq lr nr lv ni nj nk nl bi translated"><a class="ae nm" href="https://stackoverflow.com/questions/48765035/could-not-load-the-emoji-font-in-matplotlib/53368464#53368464" rel="noopener ugc nofollow" target="_blank">无法加载 Matplotlib 中的表情字体</a></li></ul><p id="53d2" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">所有这些都没有答案。最近版本的 Matplotlib 根本无法做到这一点。看看 Matplotlib 的 GitHub repo 就会发现问题<a class="ae nm" href="https://github.com/matplotlib/matplotlib/issues/3135" rel="noopener ugc nofollow" target="_blank"> #3135 </a>、<a class="ae nm" href="https://github.com/matplotlib/matplotlib/issues/4492" rel="noopener ugc nofollow" target="_blank"> #4492 </a>和<a class="ae nm" href="https://github.com/matplotlib/matplotlib/issues/12830" rel="noopener ugc nofollow" target="_blank"> #12830 </a>，其中第一个问题截至 2022 年已经开放了近 8 年。</p><p id="508c" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">为什么 Matplotlib 不能从苹果彩色表情符号字体中绘制表情符号？我们如何克服这种功能性的缺失来绘制表情符号呢？本帖回答了这些问题。</p><h1 id="aa03" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">为什么 Matplotlib 不能绘制表情符号</h1><p id="6f9e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">苹果颜色表情符号是一个 TrueType 集合(TTC)文件。这种格式将多种字体合并到一个文件中，以节省空间。我们之前看到的抛出运行时错误的依赖项 FT2Font 只支持从 TTC 文件中获取第一种字体。虽然这可能行得通，但是转换依赖项 ttconv 的限制阻止了后端实际使用这种字体。</p><p id="db3b" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">有一个解决方案是以拉请求的形式出现的<a class="ae nm" href="https://github.com/matplotlib/matplotlib/pull/9787" rel="noopener ugc nofollow" target="_blank"> #9787 </a>。目前正在等待进一步审查。</p><p id="fc56" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">当我们等待拉请求被合并时，有一个直接的解决方案，我们可以使用 Matplotlib 成功地绘制表情符号。</p><h1 id="4e48" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">直接解决方案:使用第三方后端</h1><p id="f202" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">输入<a class="ae nm" href="https://github.com/anntzer/mplcairo" rel="noopener ugc nofollow" target="_blank"> Mplcairo </a>。作为“Matplotlib 的 cairo 后端的一个全新的、本质上完整的实现”，Mplcairo 在最初后端的几个方面进行了改进。最值得注意的是，Mplcairo 引入了对在 TTC 文件中使用第一种字体的支持。</p><p id="0127" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">看起来我们应该能够通过<code class="fe ns nt nu mu b">pip install mplcairo</code>轻松安装 Mplcairo，但是对我来说，当我试图将它导入到我的代码中时，这个安装继续抛出错误。</p><p id="e736" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">相反，我用 git 将 repo 克隆到我的机器上(<code class="fe ns nt nu mu b">git clone https://github.com/matplotlib/mplcairo.git</code>)，然后遵循<a class="ae nm" href="https://github.com/anntzer/mplcairo#building" rel="noopener ugc nofollow" target="_blank">构建</a>和<a class="ae nm" href="https://github.com/anntzer/mplcairo#installation" rel="noopener ugc nofollow" target="_blank">安装</a>指令。下面我总结一下我的过程。</p><h2 id="cd9e" class="my kj it bd kk nv nw dn ko nx ny dp ks lj nz oa ku ln ob oc kw lr od oe ky of bi translated">建筑物</h2><p id="8ade" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">由于车轮不可用于 OS X，我们需要建立自己的 OS X 车轮使用终端。为此，我们需要以下依赖关系:</p><ul class=""><li id="f71c" class="nd ne it lc b ld mo lg mp lj nf ln ng lr nh lv ni nj nk nl bi translated"><strong class="lc iu">支持 C++17 的 C++编译器，如 GCC ≥ 7.2 或 Clang ≥ 5.0 </strong>。我用<code class="fe ns nt nu mu b">brew install llvm</code>安装了后者。</li><li id="f10c" class="nd ne it lc b ld nn lg no lj np ln nq lr nr lv ni nj nk nl bi translated"><strong class="lc iu"> Cairo 和 FreeType 头，以及定位它们的 pkg-config 信息。由于 cairo <a class="ae nm" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Cairo-1.15.8-Colored-Emoji" rel="noopener ugc nofollow" target="_blank">在 1.15.8 版本中引入了对表情符号</a>的颜色支持，我们需要一个不早于此的 cairo 版本。直到康达-福吉<a class="ae nm" href="https://github.com/conda-forge/cairo-feedstock/pull/44" rel="noopener ugc nofollow" target="_blank">更新</a>它的开罗，<code class="fe ns nt nu mu b">brew install cairo</code>。然后是<code class="fe ns nt nu mu b">pip install pycairo</code>。</strong></li></ul><p id="3130" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">一旦我们获得了依赖项，我们就可以激活 llvm(如<code class="fe ns nt nu mu b">brew info llvm</code>所述)并构建 OS X 轮子，而在 mplcairo 的根文件夹中:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="3f70" class="my kj it mu b gy mz na l nb nc">echo 'export PATH="/usr/local/opt/llvm/bin:$PATH"' &gt;&gt; ~/.bash_profile                <br/>source ~/.bash_profile<br/>export LDFLAGS="-L/usr/local/opt/llvm/lib"<br/>export CPPFLAGS="-I/usr/local/opt/llvm/include"<br/>export CC='/usr/local/opt/llvm/bin/clang'<br/>export CXX='/usr/local/opt/llvm/bin/clang++'<br/>tools/build-macos-wheel.sh</span></pre><h2 id="e5b2" class="my kj it bd kk nv nw dn ko nx ny dp ks lj nz oa ku ln ob oc kw lr od oe ky of bi translated">装置</h2><p id="9c67" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们已经构建了 Mplcairo，我们可以用<code class="fe ns nt nu mu b">pip install dist/mplcairo-0.1.post47+g109b19f-cp37-cp37m-macosx_10_9_x86_64.whl</code>在系统范围内(或者在我们的虚拟环境中)安装它。</p><p id="5740" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">这可能是一个异常，但是在构建终端时，我的 Python 从版本 3.7.0 降级到版本 3.6.5。当我打开一个新的终端窗口时，Python 又回到了 3.7.0，我可以安装滚轮了。</p><p id="2313" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated"><em class="og">注(2020 年 8 月 16 日):确认 tools/build-macos-wheel.sh 和 dist/mpl cairo-0.1 . post 47+g 109 b 19 f-cp37-cp37m-ma cosx _ 10 _ 9 _ x86 _ 64 . whl 是正确的文件路径——2018 年我第一次发表这篇文章的时候，它们的命名是不同的。</em></p><h2 id="d13f" class="my kj it bd kk nv nw dn ko nx ny dp ks lj nz oa ku ln ob oc kw lr od oe ky of bi translated">用法！</h2><p id="29cb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了绘制我们的表情符号，我们只需导入 Mplcairo 并将其设置为 Matplotlib 的新后端。</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="9bdb" class="my kj it mu b gy mz na l nb nc">import matplotlib, mplcairo<br/>print('Default backend: ' + matplotlib.get_backend()) <br/>matplotlib.use("module://mplcairo.macosx")<br/>print('Backend is now ' + matplotlib.get_backend())</span></pre><p id="cf9f" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">运行上面的脚本后，您应该会看到以下输出:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="aa37" class="my kj it mu b gy mz na l nb nc">Default backend: module://ipykernel.pylab.backend_inline<br/>Backend is now module://mplcairo.macosx</span></pre><p id="bd12" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">您的默认后端可能会有所不同，这取决于您运行脚本的位置。我的默认后端来自 Jupyter 笔记本。(如果使用的是 Jupyter Notebook，必须先重置内核，然后才能重置后端。您还必须在导入 matplotlib.pyplot 之前重置后端。)</p><p id="3251" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">一旦你启动并运行 Mplcairo，Matplotlib 就能漂亮地绘制表情符号。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oh"><img src="../Images/cb953ffc1c8aa807e2075f7d5477465c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WDbHyGydEk0d8MsihHOaYw.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">Lo and behold the emoji.</figcaption></figure><p id="f190" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">完整代码:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mm mn l"/></div></figure><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mm mn l"/></div></figure></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="91ab" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated"><strong class="lc iu">如果你想阅读更多我的文章或者探索数以百万计的其他文章，你可以注册成为中级会员:</strong></p><div class="op oq gp gr or os"><a href="https://brienna.medium.com/membership" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">通过我的推荐链接加入 Medium-briena Herold</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">brienna.medium.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg mg os"/></div></div></a></div><p id="1cee" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated"><strong class="lc iu">你也可以订阅我的邮件列表，以便在我发表新文章时得到通知:</strong></p><div class="op oq gp gr or os"><a href="https://brienna.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">每当布蕾娜·赫罗尔德发表。</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">每当布蕾娜·赫罗尔德发表。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">brienna.medium.com</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg mg os"/></div></div></a></div><p id="b1bd" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated"><strong class="lc iu">你可能会对我的其他一些故事感兴趣:</strong></p><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/how-to-download-twitter-friends-or-followers-for-free-b9d5ac23812"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">如何免费下载 Twitter 好友或关注者</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">Python 中的简单指南</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pi l pd pe pf pb pg mg os"/></div></div></a></div><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/how-to-bulk-access-arxiv-full-text-preprints-58026e19e8ef"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">如何批量获取 arXiv 全文预印本</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">使用 Python3 和 MacOS X 命令行</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pj l pd pe pf pb pg mg os"/></div></div></a></div><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/collecting-data-from-the-new-york-times-over-any-period-of-time-3e365504004"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">从《纽约时报》收集任何时期的数据</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">Python 中的简单指南</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pk l pd pe pf pb pg mg os"/></div></div></a></div></div></div>    
</body>
</html>