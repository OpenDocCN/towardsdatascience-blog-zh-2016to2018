<html>
<head>
<title>Exploring &amp; Machine Learning for Airbnb Listings in Toronto</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索和机器学习多伦多的 Airbnb 房源</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-machine-learning-for-airbnb-listings-in-toronto-efdbdeba2644?source=collection_archive---------5-----------------------#2018-11-29">https://towardsdatascience.com/exploring-machine-learning-for-airbnb-listings-in-toronto-efdbdeba2644?source=collection_archive---------5-----------------------#2018-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/1b2cd97416c3b69f5243b5d0efb02056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3a4ZSQwh2Ar5cAPfrMZ6BA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo credit: Inside Airbnb</figcaption></figure><div class=""/><div class=""><h2 id="fe8e" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">Airbnb 房源、特征工程、探索性分析、回归</h2></div><p id="cee1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://www.airbnb.ca/?locale=en" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg"> Airbnb </strong> </a>不提供我们可以使用的巨型数据库或转储意义上的开放数据。然而，Airbnb 内部的<a class="ae lq" href="http://insideairbnb.com/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="kw jg"/></a>利用从 Airbnb 网站汇编的公开信息，分析关于一个城市的 Airbnb 房源的公开信息，并提供过滤器和关键指标，以便我们可以看到 Airbnb 在世界各大城市的使用情况。Airbnb 内部的<a class="ae lq" href="http://insideairbnb.com/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="kw jg"/></a>是一套独立的、非商业性的工具和数据，与 Airbnb 或 Airbnb 的任何竞争对手都没有关联，也没有得到它们的认可。</p><p id="db92" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">然而，Airbnb  内<a class="ae lq" href="http://insideairbnb.com/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg">提供的信息对我们来说是不够的。我们将从那里下载数据用于我们自己的分析。</strong></a></p><p id="bf05" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我将与<a class="ae lq" href="http://insideairbnb.com/toronto/" rel="noopener ugc nofollow" target="_blank">多伦多数据</a>合作。因为我住在这里，我知道这里的一些街区。欢迎你选择任何你喜欢的城市。</p><p id="9c1d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将查看 Airbnb 的房源和日历，并尝试提供一些关于预测房源价格的探索性分析，如果我们假设在 Airbnb 工作，也是为了消费者。我们开始吧！</p><h1 id="c470" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">日历</h1><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="366d" class="ms ls jf mo b gy mt mu l mv mw">calendar = pd.read_csv('calendar.csv.gz')<br/>print('We have', calendar.date.nunique(), 'days and', calendar.listing_id.nunique(), 'unique listings in the calendar data.')</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/00c9042df3a695e53af4f721513169fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RStWt3vmJhx3G2Ug3_eXcg.png"/></div></div></figure><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="aaba" class="ms ls jf mo b gy mt mu l mv mw">calendar.date.min(), calendar.date.max()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi my"><img src="../Images/7b661a32448419b33e434379c70b6e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*zR5K6EY5tHhVAG2olKn5wA.png"/></div></figure><p id="f02f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">该日历涵盖一年的时间范围，即下一年每天的价格和可用性。在我们的案例中，从 2018–10–16 到 2019–10–15。</p><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/30abff02c3ec86752fbde0c3dd6eacfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*o1N38xvbJxB2epeSiVAHoQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><h2 id="d98d" class="ms ls jf bd lt na nb dn lx nc nd dp mb ld ne nf md lh ng nh mf ll ni nj mh nk bi translated">日历上的可用性</h2><p id="e579" class="pw-post-body-paragraph ku kv jf kw b kx nl kg kz la nm kj lc ld nn lf lg lh no lj lk ll np ln lo lp ij bi translated">当我们查看日历数据时，我们可能想问这样的问题:未来一年多伦多的 Airbnb 主机会有多忙？</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="8b71" class="ms ls jf mo b gy mt mu l mv mw">calendar.available.value_counts()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d17d97fe4f99d10ffa2ce6e94907e9c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*S4tcwEP57i7tkRT-C9ZCrw.png"/></div></figure><p id="8f54" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">f(假)表示不可用，t(真)表示可用。为了找出一年的日平均可用性，如果可用，我们将把 available 列转换为 0，如果不可用，则转换为 1。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d2b7" class="ms ls jf mo b gy mt mu l mv mw">calendar_new = calendar[['date', 'available']]<br/>calendar_new['busy'] = calendar_new.available.map( lambda x: 0 if x == 't' else 1)<br/>calendar_new = calendar_new.groupby('date')['busy'].mean().reset_index()<br/>calendar_new['date'] = pd.to_datetime(calendar_new['date'])</span><span id="b99b" class="ms ls jf mo b gy nr mu l mv mw">plt.figure(figsize=(10, 5))<br/>plt.plot(calendar_new['date'], calendar_new['busy'])<br/>plt.title('Airbnb Toronto Calendar')<br/>plt.ylabel('% busy')<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/8aa29d2023540b416dc6d2f0f80ba250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkemzhSV96aa4UjiG6H1mw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><p id="a14d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">多伦多最繁忙的月份是刚刚过去的十月。接下来忙碌的几个月似乎是在四月之后，一直延续到夏天。这些都在我们的体验和预期之内。</p><h2 id="080f" class="ms ls jf bd lt na nb dn lx nc nd dp mb ld ne nf md lh ng nh mf ll ni nj mh nk bi translated">日历上的价格</h2><p id="423a" class="pw-post-body-paragraph ku kv jf kw b kx nl kg kz la nm kj lc ld nn lf lg lh no lj lk ll np ln lo lp ij bi translated">价格如何逐月逐年变化？</p><p id="f547" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们删除 price 列中的“$”符号，将其转换为数字，并将 date 转换为 datetime 数据类型。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c554" class="ms ls jf mo b gy mt mu l mv mw">calendar['date'] = pd.to_datetime(calendar['date'])<br/>calendar['price'] = calendar['price'].str.replace(',', '')<br/>calendar['price'] = calendar['price'].str.replace('$', '')<br/>calendar['price'] = calendar['price'].astype(float)<br/>calendar['date'] = pd.to_datetime(calendar['date'])<br/>mean_of_month = calendar.groupby(calendar['date'].dt.strftime('%B'),<br/>                                 sort=False)['price'].mean()<br/>mean_of_month.plot(kind = 'barh' , figsize = (12,7))<br/>plt.xlabel('average monthly price');</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nt"><img src="../Images/20f692d642bf7af5ac145984900e72ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03WGRGm_WXaaYQOhD0RMdw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><p id="333f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">多伦多的 Airbnb 价格在 7 月、8 月和 10 月上涨。同意，这三个月是游览多伦多最好的月份。</p><p id="8ee8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">价格在一周中的某一天是如何变化的？</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7ca7" class="ms ls jf mo b gy mt mu l mv mw">calendar['dayofweek'] = calendar.date.dt.weekday_name<br/>cats = [ 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']<br/>price_week=calendar[['dayofweek','price']]<br/>price_week = calendar.groupby(['dayofweek']).mean().reindex(cats)<br/>price_week.drop('listing_id', axis=1, inplace=True)<br/>price_week.plot()<br/>ticks = list(range(0, 7, 1)) # points on the x axis where you want the label to appear<br/>labels = "Mon Tues Weds Thurs Fri Sat Sun".split()<br/>plt.xticks(ticks, labels);</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/14279b57ee1ffea0a30965a6ea10fd9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*cFFiuOzeztCRSXELmvqsQw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><p id="64e2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">星期五和星期六比一周中的其他时间要贵 10 美元以上。</p><h1 id="da06" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">清单</h1><p id="5e61" class="pw-post-body-paragraph ku kv jf kw b kx nl kg kz la nm kj lc ld nn lf lg lh no lj lk ll np ln lo lp ij bi translated"><strong class="kw jg">每个街区的列表数量</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="2880" class="ms ls jf mo b gy mt mu l mv mw">listings = pd.read_csv('listings.csv.gz')<br/>print('We have', listings.id.nunique(), 'listings in the listing data.')</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/322ef68987d2811ae359f19c9ff8cb88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*gykddAUcV0So5JeUjVY2QQ.png"/></div></figure><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a1f1" class="ms ls jf mo b gy mt mu l mv mw">listings.groupby(by='neighbourhood_cleansed').count()[['id']].sort_values(by='id', ascending=False).head(10)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/04f32e760862beaf37ef78dc2db65982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*UNbkIv42-F0s0O7KeFvfuw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><p id="afca" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">列表数量最多的街区是海滨社区——岛屿，几乎是第二多的街区(尼亚加拉)的四倍。从上面的标题图，我们也可以看到这一点。</p><p id="059c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">审核评分等级</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="11cf" class="ms ls jf mo b gy mt mu l mv mw">plt.figure(figsize=(12,6))<br/>sns.distplot(listings.review_scores_rating.dropna(), rug=True)<br/>sns.despine()<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nx"><img src="../Images/5a4013704a779a930b65c85535430601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spGOyJuzYk6iQofN_eoVPA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="50ac" class="ms ls jf mo b gy mt mu l mv mw">listings.review_scores_rating.describe()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/61b229a810f6aaf45ff8201f5b63f86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Wy9HHSbhjUbJ5pbooqJgSg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><p id="ea23" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">不出所料，大多数评论者都给出了高分。</p><h2 id="efd0" class="ms ls jf bd lt na nb dn lx nc nd dp mb ld ne nf md lh ng nh mf ll ni nj mh nk bi translated">探索价格</h2><p id="35f9" class="pw-post-body-paragraph ku kv jf kw b kx nl kg kz la nm kj lc ld nn lf lg lh no lj lk ll np ln lo lp ij bi translated">price 列需要一些清理，例如删除“$”并转换为数字。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="dff3" class="ms ls jf mo b gy mt mu l mv mw">listings['price'] = listings['price'].str.replace(',', '')<br/>listings['price'] = listings['price'].str.replace('$', '')<br/>listings['price'] = listings['price'].astype(float)</span><span id="a68d" class="ms ls jf mo b gy nr mu l mv mw">listings['price'].describe()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/6d0228565fa5c5e66d6a25b17c6fa8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*ri-MGNaqnl2V8m3oaumVUw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><p id="8360" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">多伦多最贵的 Airbnb 房源是 12933 美元/晚。从<a class="ae lq" href="https://www.airbnb.ca/rooms/16039481?locale=en" rel="noopener ugc nofollow" target="_blank">的列表网址</a>，据我所知似乎是合法的。一位艺术收藏家在多伦多最时尚街区的顶层公寓。不错！</p><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oa"><img src="../Images/170eb08dca1569395b454c1cf856bd8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ny1FaCQsGT3rzCpXikcw7g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">source: Airbnb</figcaption></figure><p id="e094" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了不受极端情况的影响，我决定删除超过 600 美元/晚的房源，以及 7 个价格为 0 的房源，以便进行下面的探索性分析。</p><p id="549a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">剔除异常值后的列表价格分布</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="1f9c" class="ms ls jf mo b gy mt mu l mv mw">listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)].price.hist(bins=200)<br/>plt.ylabel('Count')<br/>plt.xlabel('Listing price in $')<br/>plt.title('Histogram of listing prices');</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/ab6f4da13726d7a65dd3938451a38618.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASyoJ5Sn1WYmSE1rFtgPuw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><p id="7824" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">邻里关系与价格</strong></p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">neighbourhood vs. price</figcaption></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/8cc5b525d30ec1d2f8eefcbad72ff775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xnEf_kYEJA2AQq0NSHxwsw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><p id="fca0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">不仅是滨水社区——岛上的房源数量最多，它还享有最高的中位价，而米利肯的中位价最低。</p><p id="0848" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">物业类型与价格</strong></p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">property_type vs. price</figcaption></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/74c83ee6c0f4f970ca35f517b5c46b97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dqwo1WWSDyD9Bv6p5EySkg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><p id="a485" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">当我们查看每种物业类型的中值价格时，我们必须小心，不能说“最贵的物业类型是公寓式酒店，帐篷和停车位的中值价格高于公寓和城堡。”，因为 Aparthotel、Tend 和 Parking Space 各只有一个列表。</p><p id="33de" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">房型与价格</strong></p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">room_type vs. price</figcaption></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi og"><img src="../Images/3b6aa2c9c5919ea03fbbc21dc8c03758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pscOrqWKxH22GATWVbkkuw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 12</figcaption></figure><p id="d4a0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">不言而喻，整个房间/公寓的价格比其他类型的房间要高得多。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="35d3" class="ms ls jf mo b gy mt mu l mv mw">listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)].pivot(columns = 'room_type', values = 'price').plot.hist(stacked = True, bins=100)<br/>plt.xlabel('Listing price in $');</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/5be5fb810bcf5135674ed6f51ca6023b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkdQSeEUagFmKnBCCnPuPQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 13</figcaption></figure><p id="312d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">整个家/公寓也有最多的房源。Airbnb 内部已经表明<a class="ae lq" href="http://insideairbnb.com/toronto/" rel="noopener ugc nofollow" target="_blank">整栋整栋的住宅或公寓全年对游客开放，可能没有主人在场，可能是非法的，更重要的是，正在取代居民</a>。我们将暂时把忧虑放在一边。</p><p id="9a70" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">床型与价格</strong></p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">bed_type vs. price</figcaption></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/1e771c5b7e8c554be5c70b10ccc1e8aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4m2VhOgNnG3SYaIz6bMqbw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 14</figcaption></figure><p id="1764" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这里没有惊喜。</p><p id="78f7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">便利设施</strong></p><p id="ff80" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">便利设施文本框需要清理一下。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="135d" class="ms ls jf mo b gy mt mu l mv mw">listings.amenities = listings.amenities.str.replace("[{}]", "").str.replace('"', "")<br/>listings['amenities'].head()</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/ecb49bf494b50a0a359957143baedd85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*ib22A6s8bGq8MM0GvAk-xA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 15</figcaption></figure><p id="220a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">20 种最常见的娱乐设施。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="4f3e" class="ms ls jf mo b gy mt mu l mv mw">pd.Series(np.concatenate(listings['amenities'].map(lambda amns: amns.split(","))))\<br/>    .value_counts().head(20)\<br/>    .plot(kind='bar')<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha='right', fontsize=12)<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/fec59f645b8912a14cc6de159e8a854b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hl3crrk4mGdFZ3Vx4k11KQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 16</figcaption></figure><p id="78ec" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Wifi、暖气、必需品、厨房和烟雾探测器等都是最常见的便利设施。</p><p id="91ff" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">便利设施与价格前 20 名</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="cf35" class="ms ls jf mo b gy mt mu l mv mw">amenities = np.unique(np.concatenate(listings['amenities'].map(lambda amns: amns.split(","))))<br/>amenity_prices = [(amn, listings[listings['amenities'].map(lambda amns: amn in amns)]['price'].mean()) for amn in amenities if amn != ""]<br/>amenity_srs = pd.Series(data=[a[1] for a in amenity_prices], index=[a[0] for a in amenity_prices])</span><span id="b2d8" class="ms ls jf mo b gy nr mu l mv mw">amenity_srs.sort_values(ascending=False)[:20].plot(kind='bar')<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha='right', fontsize=12)<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/f088e80f88dc9d8fae4f0027ecf9d6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8I1aaiQx5K3yUdibJr7NYA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 17</figcaption></figure><p id="d0ee" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有趣的是，便利设施功能似乎与价格有一定关系。</p><p id="35bf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">床位数量与价格</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5640" class="ms ls jf mo b gy mt mu l mv mw">listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)].pivot(columns = 'beds',values = 'price').plot.hist(stacked = True,bins=100)<br/>plt.xlabel('Listing price in $');</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ol"><img src="../Images/e4325ee5374dd920e2426e1514cc91f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpiajjxvY8OwQhOfXzYjow.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 18</figcaption></figure><p id="41c2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">绝大多数房源都有一张床，一张床的房源价格差异很大。有没有床的列表。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9aba" class="ms ls jf mo b gy mt mu l mv mw">sns.boxplot(y='price', x='beds', data = listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)])<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/7fd021d57618d810acd7a478cc825429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyYA64v1NIdZZsrqauJuMg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 19</figcaption></figure><p id="53dc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有趣的是，无床房源的中值价格高于 1 床和 2 床房源，而 10 床房源的中值价格非常低。</p><p id="7556" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">数字特征</strong></p><p id="78a6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们选择了几个数字特征，并尝试一起探索它们。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="0fce" class="ms ls jf mo b gy mt mu l mv mw">col = ['host_listings_count', 'accommodates', 'bathrooms', 'bedrooms', 'beds', 'price', 'number_of_reviews', 'review_scores_rating', 'reviews_per_month']<br/>sns.set(style="ticks", color_codes=True)<br/>sns.pairplot(listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)][col].dropna())<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/d428e3388e1b9b062d73140f231f6c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFRtkJbJ7WCSX1PQylPVXQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 20</figcaption></figure><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5bb5" class="ms ls jf mo b gy mt mu l mv mw">corr = listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)][col].dropna().corr()<br/>plt.figure(figsize = (6,6))<br/>sns.set(font_scale=1)<br/>sns.heatmap(corr, cbar = True, annot=True, square = True, fmt = '.2f', xticklabels=col, yticklabels=col)<br/>plt.show();</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f02671cd7990bcc3ad1b12708217b2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*WHkAHDSjgcn9vXA-W3FJYA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 21</figcaption></figure><p id="df97" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有一些不坏的消息，如卧室和住宿的数量似乎与价格相关。也容纳，床和卧室是相关的，我们将保留其中一个模型。</p><h1 id="7897" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">建模标价</h1><h2 id="b7b7" class="ms ls jf bd lt na nb dn lx nc nd dp mb ld ne nf md lh ng nh mf ll ni nj mh nk bi translated"><strong class="ak">数据预处理和特征工程</strong></h2><p id="6308" class="pw-post-body-paragraph ku kv jf kw b kx nl kg kz la nm kj lc ld nn lf lg lh no lj lk ll np ln lo lp ij bi translated">清理<strong class="kw jg">价格</strong>特征。我们将要建模和预测的特征。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="77bb" class="ms ls jf mo b gy mt mu l mv mw">listings['price'] = listings['price'].str.replace(',', '')<br/>listings['price'] = listings['price'].str.replace('$', '')<br/>listings['price'] = listings['price'].astype(float)<br/>listings = listings.loc[(listings.price &lt;= 600) &amp; (listings.price &gt; 0)]</span></pre><p id="3f2f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">娱乐设施</strong>功能的术语文档矩阵。</p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">amenities</figcaption></figure><p id="a5c8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果为“f”，则将以下特性中的值替换为 0，如果为“t”，则替换为 1。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a7fb" class="ms ls jf mo b gy mt mu l mv mw">columns =  ['host_is_superhost', 'host_identity_verified', 'host_has_profile_pic',<br/>                   'is_location_exact', 'requires_license', 'instant_bookable',<br/>                   'require_guest_profile_picture', 'require_guest_phone_verification']<br/>for c in columns:<br/>    listings[c] = listings[c].replace('f',0,regex=True)<br/>    listings[c] = listings[c].replace('t',1,regex=True)</span></pre><p id="f711" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">用同样的方法清理其他货币值列。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="92e4" class="ms ls jf mo b gy mt mu l mv mw">listings['security_deposit'] = listings['security_deposit'].fillna(value=0)<br/>listings['security_deposit'] = listings['security_deposit'].replace( '[\$,)]','', regex=True ).astype(float)<br/>listings['cleaning_fee'] = listings['cleaning_fee'].fillna(value=0)<br/>listings['cleaning_fee'] = listings['cleaning_fee'].replace( '[\$,)]','', regex=True ).astype(float)</span></pre><p id="dff8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下是我们将使用的<strong class="kw jg">数字</strong>功能。</p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">numeric_features</figcaption></figure><p id="dc75" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">用中位数填充数值要素中缺失的值。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d071" class="ms ls jf mo b gy mt mu l mv mw">for col in listings_new.columns[listings_new.isnull().any()]:<br/>    listings_new[col] = listings_new[col].fillna(listings_new[col].median())</span></pre><p id="9ac1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">处理和添加<strong class="kw jg">分类</strong>特征。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="defd" class="ms ls jf mo b gy mt mu l mv mw">for cat_feature in ['zipcode', 'property_type', 'room_type', 'cancellation_policy', 'neighbourhood_cleansed', 'bed_type']:<br/>    listings_new = pd.concat([listings_new, pd.get_dummies(listings[cat_feature])], axis=1)</span></pre><p id="6d9c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">添加我们之前从便利设施功能创建的术语文档矩阵。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c25b" class="ms ls jf mo b gy mt mu l mv mw">listings_new = pd.concat([listings_new, df_amenities], axis=1, join='inner')</span></pre><p id="d667" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">数据预处理和特征工程完成了！</p><h2 id="3e26" class="ms ls jf bd lt na nb dn lx nc nd dp mb ld ne nf md lh ng nh mf ll ni nj mh nk bi translated"><strong class="ak">随机森林回归器</strong></h2><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">RandomForestRegressor</figcaption></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi op"><img src="../Images/de0a58bad9eb7085014336f293393303.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*ztZ6MsDFGXe7uRnD_Xahbw.png"/></div></figure><p id="16ca" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">随机森林的特征重要性</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d706" class="ms ls jf mo b gy mt mu l mv mw">coefs_df = pd.DataFrame()</span><span id="afab" class="ms ls jf mo b gy nr mu l mv mw">coefs_df['est_int'] = X_train.columns<br/>coefs_df['coefs'] = rf.feature_importances_<br/>coefs_df.sort_values('coefs', ascending=False).head(20)</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/e8bed9e37265386b6eaeb07f880484c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*Wxbxy-eDCka5jtBB26GTsA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 22</figcaption></figure><h2 id="7bcf" class="ms ls jf bd lt na nb dn lx nc nd dp mb ld ne nf md lh ng nh mf ll ni nj mh nk bi translated">LightGBM</h2><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">LightGBM</figcaption></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/2ba69dca13e1ffb593556765c8e91a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zB3ExDEPtxhqBYSsNsulNw.png"/></div></div></figure><figure class="mj mk ml mm gt is gh gi paragraph-image"><div class="gh gi os"><img src="../Images/96be5c650c295716ac38d9bcec422e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*dUqUGqzetfL32MfAm2CWhw.png"/></div></figure><p id="ba94" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">light GBM 的特征重要性</strong></p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d207" class="ms ls jf mo b gy mt mu l mv mw">feat_imp = pd.Series(clf.feature_importances_, index=X.columns)<br/>feat_imp.nlargest(20).plot(kind='barh', figsize=(10,6))</span></pre><figure class="mj mk ml mm gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ot"><img src="../Images/14958b00790101e19835f7e393eb6152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1gKoDua31DHTlpu1JkIIw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 23</figcaption></figure><p id="e8ab" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这两个模型产生的特征重要性是相似的。</p><p id="b3cd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">因此，我们取得的最好结果是平均小于 60 美元的测试 RMSE 误差，该模型解释了 62.4%的上市价格波动。</p><p id="d69b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">结果好吗？不太好。然而，价格是一个很难建模的东西，似乎在功能中没有足够的信号。我们可能希望添加季节性、预订窗口、停留时间等功能。我将把它留给其他时间。</p><p id="3134" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Airbnb%20Listing%20Toronto.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>可以在<a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Airbnb%20Listing%20Toronto.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。享受这周剩下的时光。</p></div></div>    
</body>
</html>