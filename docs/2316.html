<html>
<head>
<title>Collect Your Own Fitbit Data with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 收集您自己的 Fitbit 数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/collect-your-own-fitbit-data-with-python-ff145fa10873?source=collection_archive---------0-----------------------#2018-01-09">https://towardsdatascience.com/collect-your-own-fitbit-data-with-python-ff145fa10873?source=collection_archive---------0-----------------------#2018-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5c31636b4bdd0a29389a48abe8edc9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8C2GHqk6zMaQlRyLXiYSA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Python Generated Fitbit Cloud</figcaption></figure><p id="d75f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">所以你在圣诞假期有了你的 Fitbit，你也有了一些新年决心。你上网查看仪表盘上的图表，但还是不满意。你想要更多的数据、更多的图表和更多的信息。好了，不多说，因为我将教你如何收集你自己的 Fitbit 数据，只用一点 Python 代码。有了这个教程，你可以得到你难以捉摸的分分钟数据(也称为日内数据)，这是你第一次得到 Fitbit 时不容易得到的。</p><p id="6678" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第一步</strong>:设置你的账户并创建应用程序</p><p id="2238" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你需要做的第一件事是创建一个<a class="ae ld" href="https://www.fitbit.com/" rel="noopener ugc nofollow" target="_blank"> Fitbit 账户</a>。一旦你完成了这些，你就可以去 dev.fitbit.com 的 T4。在“管理”下，转到“注册应用程序”。这将引导您进入一个如下所示的页面:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/25090ee9f3577f994b008cf5c2b48f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJHMOYsFZvrBmpNjFfpBJA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Application Registration</figcaption></figure><p id="3d33" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">对于应用网站和组织网站，可以用“http://”或“https://”开头的任何名称命名。其次，确保 OAuth 2.0 应用程序类型为“个人”，因为这是允许我们下载当天数据的关键。最后，确保回调 URL 是“http://127.0.0.1:8080/”，以便让我们的 Fitbit API 正确连接。之后，点击协议框并提交。</p><p id="3955" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">注意</strong>:根据应用程序的不同，我们可能需要一个额外的步骤来填写表格，以便在<a class="ae ld" href="https://dev.fitbit.com/build/reference/web-api/help/" rel="noopener ugc nofollow" target="_blank">这个链接</a>获得我们当天数据的许可。Fitbit 支持个人项目和任何其他非营利研究，因此这些应该已经可以调用，但商业应用程序可能需要更长时间才能获得批准。</p><p id="6850" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">之后，您将被重定向到如下页面:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lj"><img src="../Images/69fb0b0bd8da3781ba67276ac2b5bf96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlUn1-7XoaBnnpnsEMf9mg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Registered Application</figcaption></figure><p id="0547" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将从这个页面中需要的部分是 OAuth 2.0 客户端 ID 和客户端密码。</p><p id="6259" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第二步:</strong>API</p><p id="6f27" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦第一步完成，我们的下一步是使用一个<a class="ae ld" href="https://github.com/orcasgit/python-fitbit" rel="noopener ugc nofollow" target="_blank"> Fitbit 非官方 API </a>。点击右侧的绿色按钮下载回购文件，然后解压文件。然后，打开命令行，将目录切换到包含解压缩文件的目录，并快速运行“sudo pip install-r requirements/base . txt”。</p><p id="e27d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们终于准备好开始编码了。首先，我们需要导入必要的包，并引入之前的 Client_ID 和 Client_Secret 来授权我们自己。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="ea77" class="lp lq it ll b gy lr ls l lt lu">import fitbit<br/>import gather_keys_oauth2 as Oauth2<br/>import pandas as pd <br/>import datetime</span><span id="34d7" class="lp lq it ll b gy lv ls l lt lu">CLIENT_ID = '22CPDQ'<br/>CLIENT_SECRET = '<!-- -->56662aa8bf31823e4137dfbf48a1b5f1<!-- -->'</span></pre><p id="6b24" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用 ID 和 Secret，我们可以获得授权我们获取数据的访问和刷新令牌。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="4d34" class="lp lq it ll b gy lr ls l lt lu">server = Oauth2.OAuth2Server(CLIENT_ID, CLIENT_SECRET)<br/>server.browser_authorize()</span><span id="249d" class="lp lq it ll b gy lv ls l lt lu">ACCESS_TOKEN = str(server.fitbit.client.session.token['access_token'])<br/>REFRESH_TOKEN = str(server.fitbit.client.session.token['refresh_token'])</span><span id="3473" class="lp lq it ll b gy lv ls l lt lu">auth2_client = fitbit.Fitbit(CLIENT_ID, CLIENT_SECRET, oauth2=True, access_token=ACCESS_TOKEN, refresh_token=REFRESH_TOKEN)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lw"><img src="../Images/65980ab280d17c8f82f89eb04b8d6d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_j1o5hXDvWoga90qaEavw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">What the page should look like after authorization and signing in</figcaption></figure><p id="a5b5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们进去了。…但没那么快。我们已经验证了自己的身份，但仍未获得数据。在开始之前，我有一个方便的技巧，可以节省大量的手工输入:许多调用都需要日期格式(YYYY-MM-DD)作为字符串格式。因此，如果您每天收集数据，我们必须每天手动更改该字符串。相反，我们可以导入有用的“datetime”包，让它替我们格式化。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="dd84" class="lp lq it ll b gy lr ls l lt lu">yesterday = str((datetime.datetime.now() - datetime.timedelta(days=1)).strftime("%Y%m%d"))</span><span id="10c1" class="lp lq it ll b gy lv ls l lt lu">yesterday2 = str((datetime.datetime.now() - datetime.timedelta(days=1)).strftime("%Y-%m-%d"))</span><span id="358b" class="lp lq it ll b gy lv ls l lt lu">today = str(datetime.datetime.now().strftime("%Y%m%d"))</span></pre><p id="2b15" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第三步</strong>:采集数据</p><p id="9225" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们现在终于可以调用我们的数据了。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="0f0b" class="lp lq it ll b gy lr ls l lt lu">fit_statsHR = auth2_client.intraday_time_series('activities/heart', base_date=yesterday2, detail_level='1sec')</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lx"><img src="../Images/c435747b2adb139b9d26611f0ead1abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TogrkOsFJXFixC3xZ4bpnw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Heart Rate Data</figcaption></figure><p id="8256" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">虽然这些数据对我们来说是可读的，但它还不能保存在我们的电脑上。以下代码读取字典格式并遍历字典值——在将两者组合成一个<a class="ae ld" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫数据帧</a>之前，将各自的时间和值保存为列表。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="1e89" class="lp lq it ll b gy lr ls l lt lu">time_list = []<br/>val_list = []</span><span id="55de" class="lp lq it ll b gy lv ls l lt lu">for i in fit_statsHR['activities-heart-intraday']['dataset']:<br/>    val_list.append(i['value'])<br/>    time_list.append(i['time'])</span><span id="46bc" class="lp lq it ll b gy lv ls l lt lu">heartdf = pd.DataFrame({'Heart Rate':val_list,'Time':time_list})</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ly"><img src="../Images/a63309110604ce22e542bbad41e4be82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Grq2FAX5cbnEW3l1lRqIVQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Our Newly Created Fitbit pandas data frame</figcaption></figure><p id="4f15" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在终于可以在本地保存我们的数据了。考虑到未来，我们将一次一个数据地调用我们的数据(1 个文件= 1 天)，所以我们希望有一个良好的命名约定，以防止任何未来的混淆或覆盖数据。我的首选格式是 heartYYYMMDD.csv。以下代码获取我们的心脏数据帧，并将其作为 csv 文件保存在/Downloads/python-fitbit-master/Heart/目录中。</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="d4ad" class="lp lq it ll b gy lr ls l lt lu">heartdf.to_csv('/Users/shsu/Downloads/python-fitbit-master/Heart/heart'+ \<br/>               yesterday+'.csv', \<br/>               columns=['Time','Heart Rate'], header=True, \<br/>               index = False)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lz"><img src="../Images/4019ed5439baa7bd1662598338f24673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehlMUFBf_sIH6nwGLwLSSg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Small army of heart rate files</figcaption></figure><p id="0e9b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">但是等等！还有更多！</p><p id="86c4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">阅读<a class="ae ld" href="https://python-fitbit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">文档</a>，我们还可以收集很多其他数据，比如:</p><p id="c598" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们的睡眠日志数据:</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="384d" class="lp lq it ll b gy lr ls l lt lu">"""Sleep data on the night of ...."""</span><span id="fd8a" class="lp lq it ll b gy lv ls l lt lu">fit_statsSl = auth2_client.sleep(date='today')<br/>stime_list = []<br/>sval_list = []</span><span id="9809" class="lp lq it ll b gy lv ls l lt lu">for i in fit_statsSl['sleep'][0]['minuteData']:<br/>    stime_list.append(i['dateTime'])<br/>    sval_list.append(i['value'])</span><span id="e948" class="lp lq it ll b gy lv ls l lt lu">sleepdf = pd.DataFrame({'State':sval_list,<br/>                     'Time':stime_list})</span><span id="5083" class="lp lq it ll b gy lv ls l lt lu">sleepdf['Interpreted'] = sleepdf['State'].map({'2':'Awake','3':'Very Awake','1':'Asleep'})<br/>sleepdf.to_csv('/Users/shsu/Downloads/python-fitbit-master/Sleep/sleep' + \<br/>               today+'.csv', \<br/>               columns = ['Time','State','Interpreted'],header=True, <br/>               index = False)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ma"><img src="../Images/f25745a1f4f190fabe5a1092472d098e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prlo7i93Ec4sIuOXd1Vnqg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Sleep Log</figcaption></figure><p id="2338" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">或者我们的睡眠总结:</p><pre class="lf lg lh li gt lk ll lm ln aw lo bi"><span id="c0fe" class="lp lq it ll b gy lr ls l lt lu">"""Sleep Summary on the night of ...."""</span><span id="1b0a" class="lp lq it ll b gy lv ls l lt lu">fit_statsSum = auth2_client.sleep(date='today')['sleep'][0]</span><span id="c85f" class="lp lq it ll b gy lv ls l lt lu">ssummarydf = pd.DataFrame({'Date':fit_statsSum['dateOfSleep'],<br/>                'MainSleep':fit_statsSum['isMainSleep'],<br/>               'Efficiency':fit_statsSum['efficiency'],<br/>               'Duration':fit_statsSum['duration'],<br/>               'Minutes Asleep':fit_statsSum['minutesAsleep'],<br/>               'Minutes Awake':fit_statsSum['minutesAwake'],<br/>               'Awakenings':fit_statsSum['awakeCount'],<br/>               'Restless Count':fit_statsSum['restlessCount'],<br/>               'Restless Duration':fit_statsSum['restlessDuration'],<br/>               'Time in Bed':fit_statsSum['timeInBed']<br/>                        } ,index=[0])</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mb"><img src="../Images/0a17fda88aa2f1c3e2b6c2f347aba153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rT_gFEINg1sEFjt5Dk1wDg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Sleep Summary</figcaption></figure><p id="d2c2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这就是开始收集所有 Fitbit 数据所需的全部内容！所以，再玩一会儿，阅读 Python Fitbit 文档，完全沉浸其中，找到出路，看看你的心脏数据有多棒。如果你想知道如何利用这些数据，这里有一个<a class="ae ld" href="https://medium.com/@shsu14/what-i-learned-from-analyzing-my-fitbit-data-61125d85af40" rel="noopener">链接</a>指向我对自己心脏数据的分析。</p><p id="9ce0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">感谢您花时间阅读我的教程，并随时在<a class="ae ld" href="https://www.linkedin.com/in/stephenjhsu/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上发表评论或联系，因为我将发布更多关于数据挖掘和数据科学的教程。</p><p id="4831" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">参考资料:</p><ol class=""><li id="f175" class="mc md it kh b ki kj km kn kq me ku mf ky mg lc mh mi mj mk bi translated"><a class="ae ld" href="https://github.com/orcasgit/python-fitbit" rel="noopener ugc nofollow" target="_blank"> Orcas Fitbit API Github </a></li><li id="6704" class="mc md it kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><a class="ae ld" href="http://python-fitbit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Python-Fitbit 文档</a></li><li id="292e" class="mc md it kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><a class="ae ld" href="https://dev.fitbit.com/build/reference/web-api/" rel="noopener ugc nofollow" target="_blank">官方 Fitbit API 文档</a></li><li id="76f9" class="mc md it kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><a class="ae ld" href="https://dev.fitbit.com/build/reference/web-api/help/" rel="noopener ugc nofollow" target="_blank"> Fitbit 日内访问表</a></li><li id="ed6d" class="mc md it kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><a class="ae ld" href="https://github.com/stephenjhsu/fitbit" rel="noopener ugc nofollow" target="_blank">个人 Github 与所有代码</a></li><li id="70fc" class="mc md it kh b ki ml km mm kq mn ku mo ky mp lc mh mi mj mk bi translated"><a class="ae ld" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫数据框文档</a></li></ol></div></div>    
</body>
</html>