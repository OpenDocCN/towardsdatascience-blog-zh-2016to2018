<html>
<head>
<title>Acoustic Noise Cancellation by Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过机器学习消除声学噪声</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/acoustic-noise-cancellation-by-machine-learning-4144af497661?source=collection_archive---------1-----------------------#2018-06-25">https://towardsdatascience.com/acoustic-noise-cancellation-by-machine-learning-4144af497661?source=collection_archive---------1-----------------------#2018-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="84fa" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用 TensorFlow 制作的 DIY 噪声消除系统原型。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/d2faa6e7a0557b71bb9fd2b73aad6151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Oi4_jD2tyo7AGMUaR9_pJw.jpeg"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Image by TheDigitalArtist on Pixabay</figcaption></figure><p id="0cd1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我描述了我如何通过自己的神经网络建立一个主动噪声消除系统。我刚刚得到了我要分享的第一个结果，但是这个系统看起来像一堆脚本、二进制文件、电线、声卡、麦克风和耳机，所以我还不打算公布任何来源。可能以后吧。</p><h1 id="5f51" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">使用 Tensorflow、ALSA、C++ &amp; SIMD 和 Python 的 Pet 项目</h1><p id="73af" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在过去的一年里，我一直在构建一个基于人工神经网络的声学噪声消除系统。我是在业余时间做的，所以这就是为什么一个相对小的实验花了这么长时间。我建立的系统是一个概念验证，它显示了神经网络作为噪声消除器的一致性。</p><p id="fe6f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我对 ML 最近在像神经风格转移这样的图像处理方面的成就印象深刻。我想:“如果我们用重复的音频噪声模式来教 RNN，以便通过 ANC 来抑制它，会怎么样？”我之前已经在 DSP 上为一些雷达的东西实现了感知器，所以我不担心在实时软件中实现神经网络的必要性。虽然我以前没有和 tensorflow 和 gpu 打过交道，但我渴望用它们做点什么。到目前为止，在我看来，这是一次有趣的旅行，最后我取得了一些成果，并获得了许多开发人员的乐趣。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/1cbfd1edf9680b84f223f191de0b47ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*uP71unfJGsii4UZUwS-JHg.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Artificial Brain Denoising</figcaption></figure><h2 id="3bb7" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">为什么我们需要 ML 来抑制噪声？</h2><p id="b1eb" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现代 ANC 系统成功地抑制了飞机中的平稳噪声。常见的方法包括自适应滤波器，如<a class="ae mw" href="https://en.wikipedia.org/wiki/Least_mean_squares_filter" rel="noopener ugc nofollow" target="_blank"> LMS </a>或<a class="ae mw" href="https://en.wikipedia.org/wiki/Recursive_least_squares_filter" rel="noopener ugc nofollow" target="_blank"> RLS </a>。这种方法的主要缺陷是，它们的核心只是 FIR 滤波器，其系数是不断调整的，并且它仅在几千个样本后才适合噪声。这意味着自适应滤波器开始重新适应环境噪声的每一个变化，即使它在几秒钟前听到了那个模式。由于神经网络能够适应内部结构非常复杂的信号，因此在 ANC 中使用 ML 方法可以提高其性能。</p><blockquote class="mx my mz"><p id="b75c" class="kr ks na kt b ku kv jr kw kx ky ju kz nb lb lc ld nc lf lg lh nd lj lk ll lm ij bi translated">ANC 中的 NN 用于预测在黑噪声与麦克风位置的噪声相遇的时刻的噪声样本值。</p></blockquote><p id="39ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我认为室外的噪音，比如大声的排气系统或洗碗机，从广义上来说不是静止的，而是相当重复的，可以相对容易地被神经网络学习到。</p><h1 id="957a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">测试设置</h1><p id="1477" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我的宠物项目作为经典的噪音消除耳机，除了麦克风位于耳罩内<strong class="kt ir">。测试设置看起来简单明了:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8ffa8010db069895b2aa1fe187d0a879.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*7f7FTXH621K6Eu0XQ-svwg.png"/></div></figure><p id="a6ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我没有把麦克风放在外面(像所有降噪耳机一样)，因为我想在更广泛的情况下解决 ANC 问题。这种设置让我可以轻松地根据房间或汽车环境调整代码，因为所有情况下的结构看起来都是一样的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/f0a13d5f58d3745f8d1411cce7f45326.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*Bmtw1li4M7HX2nN14SPJfg.jpeg"/></div></figure><h2 id="ac17" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">软件布局</h2><p id="0f4c" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">该软件由三个进程组成:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/b894bef38dc8e05d0d586e1b223d90a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*KHcXBMKBLZ2f7XLMC4hhvQ.jpeg"/></div></figure><ul class=""><li id="1f94" class="nh ni iq kt b ku kv kx ky la nj le nk li nl lm nm nn no np bi translated"><strong class="kt ir"> C++程序</strong>进行实时信号处理，</li><li id="18f3" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm nm nn no np bi translated"><strong class="kt ir">管理者</strong>是用 tensorflow 教 NN 的 Python 脚本，</li><li id="d808" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm nm nn no np bi translated">而<strong class="kt ir">学习者</strong>是另一个管理整个过程的 Python 脚本。</li></ul><p id="50bd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">管理器脚本通过<a class="ae mw" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> gprc </a>与他人通信。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/de8ba0c212b7bff534c76b22094ce9b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WnQSyktwS8AJ6HopnYCNQ.jpeg"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">DIY mic-preamp and my old and dirty audio-technica ATH-910PRO</figcaption></figure><p id="bc65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">麦克风前置放大器和耳机连接到声卡，声卡通过 USB 连接到装有 Linux Mint 17 的笔记本电脑。</p><p id="e7bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">麦克风测量噪声和黑噪声的组合。然后 C++程序做以下事情:</p><ol class=""><li id="3b56" class="nh ni iq kt b ku kv kx ky la nj le nk li nl lm oa nn no np bi translated">读取样本，</li><li id="e868" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm oa nn no np bi translated">分离外部噪声和来自耳机的反信号，</li><li id="73b4" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm oa nn no np bi translated">将噪声样本传递到神经网络的前馈通道以获得黑噪声样本，</li><li id="fcf7" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm oa nn no np bi translated">将 NN 产生的黑噪声样本回放到耳机，</li><li id="d391" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm oa nn no np bi translated">通过管理器脚本将噪声样本传输到学习器脚本，从管理器获取新的神经网络系数。</li></ol><p id="ebad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我站在离耳机几米远的地方，用手机播放噪音。这种结构成功抑制了不同的噪音模式，甚至是像一束束鼻窦这样的非平稳信号，可以用手随意打开和关闭。</p><h1 id="0f21" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">内部细节</h1><p id="cc53" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><strong class="kt ir">输入声音</strong>以 48 kHz、16 位宽采样。它被代码向下采样 8x 倍，并被转发到分离器。</p><p id="4c58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">需要分离器</strong>将外部噪声与输入样本隔离，就好像没有信号反馈到耳机一样。</p><p id="d874" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">感知器</strong>是我自己用 C++实现的，为了满足实时处理的要求，内置了 SIMD 指令。感知器由两个隐藏层组成:</p><ul class=""><li id="3752" class="nh ni iq kt b ku kv kx ky la nj le nk li nl lm nm nn no np bi translated">输入层 tanh[304 x 64]采用之前隔离的外部噪声的最后 304 个样本。</li><li id="4c49" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm nm nn no np bi translated">中间层 tanh[64 x 64]。</li><li id="709e" class="nh ni iq kt b ku nq kx nr la ns le nt li nu lm nm nn no np bi translated">输出图层是线性的[64 x 1]。</li></ul><p id="71e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个相对较小的网络，能够管理最近 304 个样本的范围。它实现简单，只需 30-60 秒就能学会。我要把它升级成某种递归变体，我已经在 Jupyter 笔记本上检查了 RNN 模型适应一些复杂声音的能力。它看起来很有希望，但需要更多的时间来收敛。希望以后写一篇关于这个笔记本的帖子。</p><p id="71cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">输出信号</strong>被上采样 8 倍并发送给耳机。</p><p id="cb2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与此同时，该程序正在向 python 脚本发送大量外部噪声样本，该脚本不断调整感知器的权重以适应新测量的噪声模式，并将其发送回 c++程序。我在带有 GPU 的虚拟机中的云中运行这个 python 脚本。顺便说一句，我发现 Paperspace 是最适合 ML 实验的！下面是我的<a class="ae mw" href="https://www.paperspace.com/&amp;R=DUWONN" rel="noopener ugc nofollow" target="_blank">推荐链接</a>。</p><h1 id="ed23" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结果</h1><p id="3bb4" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">这是一些展示已有成果的图表。这个数据是来自 C++程序的一个日志，现在还没有客观的测量。然而，我试着把这个耳机戴在头上，它看起来就像剧情显示的那样工作。</p><h2 id="9b20" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">条款</h2><p id="4e7d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><strong class="kt ir">黑噪声</strong>是送到麦克风的信号。</p><p id="dd65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">纯噪声</strong>是被分离器隔离的外部噪声。</p><p id="8b4d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">转换到麦克风输入端的黑噪声</strong>是分离器分离出的信号的剩余部分。</p><p id="e1b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> samples_in </strong>是麦克风测得的原始声音样本(当然是 8 倍下采样)。</p><p id="aad3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是感知器如何感知输入并开始操作的示意图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/140b3faba8d9e75af9aea06c6bd79461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2V6cZuiWZLIYvmEF8pltA.jpeg"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Single sine-wave @ 880 Hz</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/3bdaadc91c47272b94e6fa8c6217dd57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFTX_DyNdDzRUgiyKDcsTQ.jpeg"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Multiple sine-waves and longer period of time.</figcaption></figure></div></div>    
</body>
</html>