<html>
<head>
<title>Predicting destination countries for new users of Airbnb</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测 Airbnb 新用户的目的地国家</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-destination-countries-for-new-users-of-airbnb-eb0d7db7579f?source=collection_archive---------7-----------------------#2018-12-02">https://towardsdatascience.com/predicting-destination-countries-for-new-users-of-airbnb-eb0d7db7579f?source=collection_archive---------7-----------------------#2018-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9b56d828bf4be917523fd0a6e55080c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9tuc30-kkkZ1I_IKq0p5ow.png"/></div></div></figure><p id="4281" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在 3 年前发现了 Airbnb 在 Kaggle 上发布的这个有趣的挑战。但是，让您参与刺激的数据挑战永远不会太晚！:)</p><p id="e350" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个 Kaggle 挑战提出了一个预测哪个国家将成为新用户预订目的地的问题。为了这个挑战，我们将使用 Airbnb 提供的三个数据集。</p><ol class=""><li id="2023" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">训练集</li><li id="74f6" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">测试设备</li><li id="79c5" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">会话数据</li></ol><p id="639b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们了解一下用户资料在训练和测试数据集中的样子。</p><p id="17b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">描述每个用户的 16 个特征如下</p><ol class=""><li id="bd59" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">id:用户 id</li><li id="5e2a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">date_account_created:帐户创建日期</li><li id="bb7b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">timestamp_first_active:第一个活动的时间戳，注意它可以早于 date_account_created 或 date_first_booking，因为用户可以在注册之前进行搜索</li><li id="8bd4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">date_first_booking:首次预订的日期</li><li id="649c" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">性别</li><li id="c409" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">年龄</li><li id="6fe1" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">注册方法</li><li id="f206" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">注册流:用户注册的页面</li><li id="015e" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">语言:国际语言偏好</li><li id="9a3d" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">affiliate_channel:什么样的付费营销</li><li id="1f9d" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">affiliate_provider:营销的地方，如谷歌，craigslist，其他</li><li id="ec7a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">first_affiliate_tracked:用户在注册之前互动的第一个营销是什么</li><li id="df3d" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">注册应用程序</li><li id="2a00" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">第一设备类型</li><li id="8722" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">第一个浏览器</li><li id="f4de" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">country_destination:这是我们要预测的目标变量</li></ol><p id="d267" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，有 6 个特征来描述用户的每个 web 会话，如下所示:</p><ol class=""><li id="98b5" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">user_id:与 users 表中的列' id '连接</li><li id="dc14" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">行为</li><li id="16ef" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">动作类型</li><li id="f9d5" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">行动 _ 详细信息</li><li id="c160" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">设备类型</li><li id="6fae" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">secs _ elapsed</li></ol><p id="f3ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我把对这个挑战的分析分成了两部分—</p><p id="7b5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一.探索性分析</p><p id="6a1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">二。预测建模</p><p id="c778" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们首先开始探索数据集。</p><h1 id="586b" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">一.探索性分析</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="6b7f" class="mr ll iq mn b gy ms mt l mu mv"># Importing the necessary libraries<br/>import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline<br/>import warnings<br/>warnings.filterwarnings("ignore")</span></pre><p id="095e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们现在加载数据。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="7f8c" class="mr ll iq mn b gy ms mt l mu mv">train_users = pd.read_csv("train_users_2.csv")<br/>test_users = pd.read_csv("test_users.csv")</span><span id="bc42" class="mr ll iq mn b gy mw mt l mu mv">print("There were", train_users.shape[0], "users in the training set and", test_users.shape[0], "users in the test set.") </span><span id="7851" class="mr ll iq mn b gy mw mt l mu mv">print("In total there were",train_users.shape[0] + test_users.shape[0], "users in total." )</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/69a9ebd7c72d17d2f7685374fce703dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbhyW3Gy91PRhNE3q21ldw.png"/></div></div></figure><p id="d89c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将探索训练集和测试集中的所有用户。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4a21" class="mr ll iq mn b gy ms mt l mu mv">df = pd.concat((train_users, test_users), axis = 0, ignore_index = True, sort = True)</span></pre><p id="c27d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查空值。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="5300" class="mr ll iq mn b gy ms mt l mu mv">display(df.isnull().sum())</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/e809467f20e7daebb2a8fb598a929189.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*MOtNxpg_V3XH3q0ZOmT9Ag.png"/></div></figure><p id="3862" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们看到“年龄”、“国家/地区 _ 目的地”、“日期 _ 首次预订”、“首次会员 _ 追踪”列中有空值。</p><p id="daf7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们尝试检查每一列中的唯一值，以确定是否有任何丢失的数据。我们发现“性别”和“第一浏览器”列中有未知数。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="bb32" class="mr ll iq mn b gy ms mt l mu mv">df.gender.unique()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/94d642150d08142a1c84b57e8745befb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qapay_gWdjheltc3isaqbQ.png"/></div></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a000" class="mr ll iq mn b gy ms mt l mu mv">df.first_browser.unique()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/be73b8cee074597673ffc2623a98cc0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZntk-Nb1AIJLs7JbM4XgA.png"/></div></div></figure><p id="5ed6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们用 NaNs 替换 unknowns，并删除列“date_first_booking ”,因为它在我们的测试集中没有任何值。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="218d" class="mr ll iq mn b gy ms mt l mu mv">df.gender.replace("-unknown-", np.nan, inplace=True)<br/>df.first_browser.replace("-unknown-", np.nan, inplace=True)<br/>df.drop("date_first_booking", axis = 1, inplace=True)</span></pre><h1 id="8916" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">用户年龄</h1><p id="d798" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">现在让我们检查年龄的统计摘要，看看是否有任何明显的异常。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4976" class="mr ll iq mn b gy ms mt l mu mv">df.age.describe()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/c9ea620ee864668d6c3ff512217b63a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*Og-vt1Zsv_916db-wfgF3A.png"/></div></figure><p id="67a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最大年龄是 2014，这是不可能的。看起来用户无意中填写了年份而不是年龄。还有，最小年龄 1 看起来很荒谬。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="e3c9" class="mr ll iq mn b gy ms mt l mu mv">df.loc[df['age']&gt;1000]['age'].describe()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/5acd6662b332967d7732bfdbfea9f2de.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*quqQ5NG6GOdFoltPq7NIXQ.png"/></div></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8d44" class="mr ll iq mn b gy ms mt l mu mv">df.loc[df['age']&lt;18]['age'].describe()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/d2a026cd749aee341cf97260a856d0b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*gKWTw4pJ3YTIaExf8x1DqQ.png"/></div></figure><p id="2aea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们纠正错误填写的年龄，然后设置年龄限制(18-下限和 95-上限)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="46bf" class="mr ll iq mn b gy ms mt l mu mv">df_with_year = df['age'] &gt; 1000<br/>df.loc[df_with_year, 'age'] = 2015 - df.loc[df_with_year, 'age']<br/>df.loc[df_with_year, 'age'].describe()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/e23ad2ccdf0b475082782ec4b0344f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*nNKMqMduxCquhADGg7uHLQ.png"/></div></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="c205" class="mr ll iq mn b gy ms mt l mu mv">df.loc[df.age &gt; 95, 'age'] = np.nan<br/>df.loc[df.age &lt; 18, 'age'] = np.nan</span></pre><p id="9590" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可视化用户的年龄。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1bab" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.distplot(df.age.dropna(), rug=True)<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/4c891506c32138ede383fe9b31027776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKI30N9PbSblIaxMmkKiFg.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.1: Plot visualizing the age bracket of the users</figcaption></figure><p id="1df1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们在图 1 中看到的，大多数用户群都在 20 到 40 岁之间。</p><h1 id="f15d" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak">用户性别</strong></h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9640" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='gender', data=df)<br/>plt.ylabel('Number of users')<br/>plt.title('Users gender distribution')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/994903ab99fa6bb7a31a3f3c34843369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCaLmc4biLfv97Q-OCBu5Q.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.2: Plot visualizing gender distribution of the users</figcaption></figure><p id="41dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们在图 2 中看到的，男性和女性用户之间没有显著差异。</p><h1 id="84aa" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">旅游目的地</h1><p id="2489" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">这是我们预测问题的目标变量。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="d135" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data=df)<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/f1f935d0ed9b24fd177784de7f6e73a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDbnUwkNP1HbrHBVNXHMpQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.3: Plot showing popular destinations among users</figcaption></figure><p id="0155" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在图 3 中看到，近 60%的用户最终没有预订 NDF 代表的任何旅行。考虑到这个问题中的用户群来自美国，大多数用户预订了美国的目的地(约 30%)。因此，我的推断是，美国旅行者倾向于在我们自己内部旅行。</p><p id="b269" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在将只分析那些至少进行了一次预订的用户。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="508d" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>df_without_NDF = df[df['country_destination']!='NDF']<br/>sns.boxplot(y='age' , x='country_destination',data=df_without_NDF)<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Age of users')<br/>plt.title('Country destination vs. age')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/6c044da86c65bbb481507f92ff5661e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwcRPpYwEB7qxg4BPwRJMQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.4: Plot showing choice of destination countries varies across ages</figcaption></figure><p id="13e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图 4 示出了在预订到图表中显示的目的地的旅行的用户中没有显著的年龄差异。然而，预订去英国旅行的用户似乎比预订去西班牙和荷兰旅行的用户年龄更大。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1f5e" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='signup_method', data = df_without_NDF)<br/>plt.xlabel('Signup Method')<br/>plt.ylabel('Number of users')<br/>plt.title('Users sign up method distribution')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/5583ca2b76b95422c6798f360aca8435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6u0sRUL322iDVL41i286Q.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.5: Plot showing sign up method distribution</figcaption></figure><p id="5cb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图 5 显示，在至少预订过一次的所有用户中，近 70%的人使用基本方法(电子邮件)在 Airbnb 注册。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ce6b" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data = df_without_NDF, hue = 'signup_method')<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.title('Users sign up method vs. destinations')<br/>plt.legend(loc='upper right')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/f4cecd8312c0a6316185e855681bf26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOv1-_I14UsWLuIr40OS-Q.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.6: Plot showing distribution of sign-up methods vs. destinations</figcaption></figure><p id="9143" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图 6 告诉我们，在至少预订过一次的用户中，无论预订的目的地是哪个国家，大多数人都使用电子邮件的方式注册 Airbnb。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="7a64" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='signup_app', data=df_without_NDF)<br/>plt.xlabel('Signup app')<br/>plt.ylabel('Number of users')<br/>plt.title('Signup app distribution')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/d32fc2523818d4022f97c77c9198b26a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOZ5OP51yrwj-xXhNtpHNw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.7: Plt showing signup app distribution</figcaption></figure><p id="1021" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在所有预订者中，大多数人都是使用 Airbnb 的网站注册的。接下来，大多数用户使用 iOS 注册(图 7)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="d320" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF, hue='signup_app')<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.title('Destination country based on signup app')<br/>plt.legend(loc = 'upper right')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/02dafc055ca8ffdb1d315413f1bebd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJCG-6ZolPK9bx_pTn0RmQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.8: Plot showing distribution of destination countries based on signup app</figcaption></figure><p id="c80f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们看到，美国用户在 Airbnb 上注册时使用了各种各样的应用程序。在其他国家，用户似乎更喜欢只在 Airbnb 的网站上注册(图 8)。</p><h1 id="aeaa" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">接纳</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="7a36" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='affiliate_channel', data=df_without_NDF)<br/>plt.xlabel('Affiliate channel')<br/>plt.ylabel('Number of users')<br/>plt.title('Affiliate channel distribution')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/1c4acbe189e9a4c4f0c414d0d710ce51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgodmKnNQTvqr5LvckAAtg.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.9: Plot showing distribtution of affiliate channels</figcaption></figure><p id="68a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们看到，近 70%的用户直接来到 Airbnb 的网站，没有任何附属机构的参与(图 9)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="daf1" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(18,6))<br/>sns.countplot(x='first_device_type', data=df_without_NDF)<br/>plt.xlabel('First device type')<br/>plt.ylabel('Number of users')<br/>plt.title('First device type distribution')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/e7ef650c15f2dec013ceacb5bfd9942d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCWzRpLICMpWLKlYOs0nTA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.10: Plot showing distribution of first device type used by users</figcaption></figure><p id="38fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从图 10 来看，用户首次访问 Airbnb 网站时最常用的设备似乎是 Mac 桌面(40%)，其次是 Windows 桌面(30%)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="5af4" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(18,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF, hue='first_device_type')<br/>plt.ylabel('Number of users')<br/>plt.title('First device type vs. country destination')<br/>plt.legend(loc = 'upper right')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/31dca2b14d94eb72f3cef7c0c77dd9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JkckaYcNzBL7nXc7Jkl4hA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.11: Plot showing distribution of first device type vs. country destination</figcaption></figure><p id="9efc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从图 11 中可以看出，无论预订的目的地是哪个国家，Mac Desktop 都是用户访问 Airbnb 网站的首选设备。这似乎是美国最高的。紧随其后的是 Windows 桌面。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2fed" class="mr ll iq mn b gy ms mt l mu mv">df_without_NDF_US = df_without_NDF[df_without_NDF['country_destination']!='US']<br/>plt.figure(figsize=(18,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF_US, hue='first_device_type')<br/>plt.ylabel('Number of users')<br/>plt.title('First device type vs. country destination without the US')<br/>plt.legend(loc = 'upper right')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/e81615d3eddc5158b808b8e295fb51e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-1vvkFGZGSdtqHQYF4JrA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.12: Plot showing distribution of first device type vs. destinations (excluding US)</figcaption></figure><p id="1e4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在美国以外，苹果设备似乎比 Windows 设备更受欢迎(图 12)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="031a" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(20,6))<br/>sns.countplot(x='first_browser', data=df_without_NDF)<br/>plt.xlabel('First browser')<br/>plt.ylabel('Number of users')<br/>plt.title('First browser distribution')<br/>plt.xticks(rotation=90)<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/81051338841f1e04589b5a76a9392b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjhSiAG43tSlYnE_nW_D4Q.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.13: Plot showing distribution of first browsers used by users</figcaption></figure><p id="c960" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如预期的那样，30%的预订者使用 Chrome 浏览器访问 Airbnb 网站。接下来最受欢迎的似乎是 Safari 浏览器(图 13)。</p><h1 id="3dfe" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">用户的首选语言</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="e59a" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(12,6))<br/>sns.countplot(x='language', data=df_without_NDF)<br/>plt.xlabel('language')<br/>plt.ylabel('Number of users')<br/>plt.title('Users language distribution')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/971fd003a1771678b736bdc574aaf73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JyEsA0XeLsqLFIOrqUqCpg.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.14: Plot showing user language distribution</figcaption></figure><p id="67a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">几乎所有用户的语言偏好都是英语。这是合理的，因为我们的人口问题来自我们。</p><h1 id="0be4" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">日期</h1><p id="552c" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">为了直观地显示预订如何随月份和年份而变化，让我们首先将日期列转换为 datetime 类型。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8f5a" class="mr ll iq mn b gy ms mt l mu mv">df_without_NDF['date_account_created'] = pd.to_datetime(df_without_NDF['date_account_created'])<br/>df_without_NDF['timestamp_first_active'] = pd.to_datetime((df_without_NDF.timestamp_first_active)//1000000, format='%Y%m%d')<br/>plt.figure(figsize=(12,6))<br/>df_without_NDF.date_account_created.value_counts().plot(kind='line', linewidth=1.2)<br/>plt.xlabel('Date')<br/>plt.title('New account created over time')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/4d7e83cb925c8cec730a665f03d9d2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpcEVIZFejuATcijMeHclA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.15: Plot showing trend of user account creation</figcaption></figure><p id="7cb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2014 年后，账户创建量将大幅增加。Airbnb 在 2014 年后突飞猛进(图 15)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="dd07" class="mr ll iq mn b gy ms mt l mu mv">#Creating a separate dataframe for the year 2013 to analyse it further.<br/>df_2013 = df_without_NDF[df_without_NDF['timestamp_first_active'] &gt; pd.to_datetime(20130101, format='%Y%m%d')]<br/>df_2013 = df_2013[df_2013['timestamp_first_active'] &lt; pd.to_datetime(20140101, format='%Y%m%d')]</span><span id="0f06" class="mr ll iq mn b gy mw mt l mu mv">plt.figure(figsize=(12,6))<br/>df_2013.timestamp_first_active.value_counts().plot(kind='line', linewidth=2)<br/>plt.xlabel('Date')<br/>plt.title('First active date 2013')<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/fdc4df80d5afe5ddcc899ee8f2ff8943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aY5-72SeHNqeFgllW0-JjQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.16: Plot showing trend of first activity of users in 2013</figcaption></figure><p id="b772" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们看到用户每月的活跃程度，那么高峰月份是 7 月、8 月和 10 月。另一方面，最不活跃的月份是 12 月(图 16)。</p><h1 id="8b96" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">用户会话数据探索性分析</h1><p id="dc92" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">正在加载会话数据。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="961f" class="mr ll iq mn b gy ms mt l mu mv">sessions = pd.read_csv("sessions.csv")</span><span id="9504" class="mr ll iq mn b gy mw mt l mu mv">print("There were", len(sessions.user_id.unique()),"unique user ids in the sessions data.")</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/5e41b498729439bf0d8b8de3ea1303d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BY2Wz3F06UnHPgZzbey5ag.png"/></div></div></figure><p id="c118" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查空值。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2084" class="mr ll iq mn b gy ms mt l mu mv">display(sessions.isnull().sum())</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/bd498493d0545328ba345fa9aa781e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*RpnBLdl5JGPuSOYur8MDGg.png"/></div></figure><p id="6927" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查未知数。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="fbf9" class="mr ll iq mn b gy ms mt l mu mv">sessions.action_type.unique()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/1bc8a10a63066b81e44fc5a5813d863d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofxUjQAUMbOgG4-QpZBF0Q.png"/></div></div></figure><p id="94ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们看到“action_type”列中有 nan 和 unknown，因此我们将所有 unknown 转换为 nan。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9d8e" class="mr ll iq mn b gy ms mt l mu mv">sessions.action_type.replace('-unknown-', np.nan, inplace=True)</span><span id="aa32" class="mr ll iq mn b gy mw mt l mu mv">sessions.action.value_counts().head(10)</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/c2254f0fc720b342ab8514f2f6bbb86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*IR1bz7AIrH2vrmcQMo2Tzw.png"/></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="fc43" class="mr ll iq mn b gy ms mt l mu mv">sessions.action_type.value_counts().head(10)</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/f5e23eef7fcdf30ef678a0d4f296111f.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*xUuDNFn2psq6JIYrAeTFVw.png"/></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="f98d" class="mr ll iq mn b gy ms mt l mu mv">sessions.action_detail.value_counts().head(10)</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/c228b067560549f5b21981590477fe78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*BslX13ox9ymq2xHLwmtsfA.png"/></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="e635" class="mr ll iq mn b gy ms mt l mu mv">plt.figure(figsize=(18,6))<br/>sns.countplot(x='device_type', data=sessions)<br/>plt.xlabel('Device type')<br/>plt.ylabel('Number of sessions')<br/>plt.title('Device type distribution')<br/>plt.xticks(rotation=90)<br/>plt.show()</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/4c34d75dc6edec13cca8e8fed0486267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVDpT7uxrfcN5T0W-7h78A.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">Fig.17: Plot showing device type distribution</figcaption></figure><p id="a0f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们在更早的时候研究用户数据时发现的那样，访问 Airbnb 最流行的设备似乎是 Mac Desktop。现在让我们来看看至少预订了一次的用户的会话行为(图 17)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="6a81" class="mr ll iq mn b gy ms mt l mu mv">session_booked = pd.merge(df_without_NDF, sessions, how = 'left', left_on = 'id', right_on = 'user_id')</span><span id="2aa6" class="mr ll iq mn b gy mw mt l mu mv">#Let us see what all columns we have for session_booked<br/>session_booked.columns</span></pre><p id="efaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看看预订者通常会做的 5 大行为。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="65da" class="mr ll iq mn b gy ms mt l mu mv">session_booked.action.value_counts().head(5)</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/f006d793c1b0a0b9b08ed5daada35376.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*D5GHzrpNieLPvpTp-71cTg.png"/></div></figure><h1 id="9838" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">二。预测建模</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="0bd5" class="mr ll iq mn b gy ms mt l mu mv">#Importing necessary libraries<br/>import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt</span></pre><p id="a0a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">加载数据集并在此过程中进行一些数据预处理。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="950f" class="mr ll iq mn b gy ms mt l mu mv">train_users = pd.read_csv('train_users_2.csv')<br/>test_users = pd.read_csv('test_users.csv')<br/>df = pd.concat((train_users, test_users), axis=0, ignore_index=True)<br/>df.drop('date_first_booking', axis=1, inplace=True)</span></pre><p id="55e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">特色工程</strong></p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="5901" class="mr ll iq mn b gy ms mt l mu mv">df['date_account_created'] = pd.to_datetime(df['date_account_created'])</span><span id="7f38" class="mr ll iq mn b gy mw mt l mu mv">df['timestamp_first_active'] = pd.to_datetime((df.timestamp_first_active // 1000000), format='%Y%m%d')</span><span id="0ad5" class="mr ll iq mn b gy mw mt l mu mv">df['weekday_account_created'] = df.date_account_created.dt.weekday_name<br/>df['day_account_created'] = df.date_account_created.dt.day<br/>df['month_account_created'] = df.date_account_created.dt.month<br/>df['year_account_created'] = df.date_account_created.dt.year</span><span id="6c9d" class="mr ll iq mn b gy mw mt l mu mv">df['weekday_first_active'] = df.timestamp_first_active.dt.weekday_name<br/>df['day_first_active'] = df.timestamp_first_active.dt.day<br/>df['month_first_active'] = df.timestamp_first_active.dt.month<br/>df['year_first_active'] = df.timestamp_first_active.dt.year</span></pre><p id="9b56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">计算时间滞后变量。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4116" class="mr ll iq mn b gy ms mt l mu mv">df['time_lag'] = (df['date_account_created'] - df['timestamp_first_active'])<br/>df['time_lag'] = df['time_lag'].astype(pd.Timedelta).apply(lambda l: l.days)</span><span id="936d" class="mr ll iq mn b gy mw mt l mu mv">df.drop( ['date_account_created', 'timestamp_first_active'], axis=1, inplace=True)</span></pre><p id="69e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们用-1 来代替年龄一栏中的 NaNs。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="f110" class="mr ll iq mn b gy ms mt l mu mv">df['age'].fillna(-1, inplace=True)</span></pre><p id="0f4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们按 user_id 分组，并计算每个用户的动作数量、动作类型和动作细节。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1a85" class="mr ll iq mn b gy ms mt l mu mv">#First we rename the column user_id as just id to match the train and test columns</span><span id="6db7" class="mr ll iq mn b gy mw mt l mu mv">sessions.rename(columns = {'user_id': 'id'}, inplace=True)</span><span id="d12f" class="mr ll iq mn b gy mw mt l mu mv">action_count = sessions.groupby(['id', 'action'])['secs_elapsed'].agg(len).unstack()<br/>action_type_count = sessions.groupby(['id', 'action_type'])['secs_elapsed'].agg(len).unstack()<br/>action_detail_count = sessions.groupby(['id', 'action_detail'])['secs_elapsed'].agg(len).unstack()<br/>device_type_sum = sessions.groupby(['id', 'device_type'])['secs_elapsed'].agg(sum).unstack()</span><span id="576d" class="mr ll iq mn b gy mw mt l mu mv">sessions_data = pd.concat([action_count, action_type_count, action_detail_count, device_type_sum],axis=1)<br/>sessions_data.columns = sessions_data.columns.map(lambda x: str(x) + '_count')</span><span id="8f19" class="mr ll iq mn b gy mw mt l mu mv"># Most used device<br/>sessions_data['most_used_device'] = sessions.groupby('id')['device_type'].max()</span><span id="2ced" class="mr ll iq mn b gy mw mt l mu mv">print('There were', sessions.shape[0], 'recorded sessions in which there were', sessions.id.nunique(), 'unique users.')</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/d378c8e7a11d9f639a045cd404e1e09f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHLh-Js-NyVDbmjkxRXQYw.png"/></div></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="bbc1" class="mr ll iq mn b gy ms mt l mu mv">secs_elapsed = sessions.groupby('id')['secs_elapsed']</span><span id="5b4a" class="mr ll iq mn b gy mw mt l mu mv">secs_elapsed = secs_elapsed.agg(<br/>    {<br/>        'secs_elapsed_sum': np.sum,<br/>        'secs_elapsed_mean': np.mean,<br/>        'secs_elapsed_min': np.min,<br/>        'secs_elapsed_max': np.max,<br/>        'secs_elapsed_median': np.median,<br/>        'secs_elapsed_std': np.std,<br/>        'secs_elapsed_var': np.var,<br/>        'day_pauses': lambda x: (x &gt; 86400).sum(),<br/>        'long_pauses': lambda x: (x &gt; 300000).sum(),<br/>        'short_pauses': lambda x: (x &lt; 3600).sum(),<br/>        'session_length' : np.count_nonzero<br/>    }<br/>)<br/>secs_elapsed.reset_index(inplace=True)<br/>sessions_secs_elapsed = pd.merge(sessions_data, secs_elapsed, on='id', how='left')<br/>df = pd.merge(df, sessions_secs_elapsed, on='id', how = 'left')</span><span id="6910" class="mr ll iq mn b gy mw mt l mu mv">print('There are', df.id.nunique(), 'users from the entire user data set that have session information.')</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/8ee7312c2ee63d2b62a635258464f788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yTpe_sGVHfaiHd82pi0ElQ.png"/></div></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="f8ed" class="mr ll iq mn b gy ms mt l mu mv">#Encoding the categorical features<br/>categorical_features = ['gender', 'signup_method', 'signup_flow', 'language','affiliate_channel', 'affiliate_provider', 'first_affiliate_tracked', 'signup_app', 'first_device_type', 'first_browser', 'most_used_device', 'weekday_account_created', 'weekday_first_active']</span><span id="1c6f" class="mr ll iq mn b gy mw mt l mu mv">df = pd.get_dummies(df, columns=categorical_features)</span><span id="745d" class="mr ll iq mn b gy mw mt l mu mv">df.set_index('id', inplace=True)</span></pre><h1 id="a068" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">分裂训练和测试</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="c813" class="mr ll iq mn b gy ms mt l mu mv">#Creating train dataset<br/>train_df = df.loc[train_users['id']]</span><span id="eb15" class="mr ll iq mn b gy mw mt l mu mv">train_df.reset_index(inplace=True)<br/>train_df.fillna(-1, inplace=True)</span><span id="0e84" class="mr ll iq mn b gy mw mt l mu mv">#Creating target variable for the train dataset<br/>y_train = train_df['country_destination']</span><span id="d172" class="mr ll iq mn b gy mw mt l mu mv">train_df.drop(['country_destination', 'id'], axis=1, inplace=True)</span><span id="8d55" class="mr ll iq mn b gy mw mt l mu mv">from sklearn.preprocessing import LabelEncoder<br/>label_encoder = LabelEncoder()<br/>encoded_y_train = label_encoder.fit_transform(y_train) #Transforming the target variable using labels</span><span id="3b7e" class="mr ll iq mn b gy mw mt l mu mv">#We see that the destination countries have been successfully encoded now<br/>encoded_y_train</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/cd178afd96542493d9c2c53f3559f9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*rwYM4AkISWH_ZDORKPyOIg.png"/></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a576" class="mr ll iq mn b gy ms mt l mu mv">#Creating test set<br/>test_df = df.loc[test_users['id']].drop('country_destination', axis=1)<br/>test_df.reset_index(inplace=True)</span><span id="a324" class="mr ll iq mn b gy mw mt l mu mv">id_test = test_df['id']<br/>test_df.drop('id', axis=1, inplace=True)</span></pre><p id="4726" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从训练和测试中移除副本(如果有)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8885" class="mr ll iq mn b gy ms mt l mu mv">duplicate_columns = train_df.columns[train_df.columns.duplicated()]</span><span id="ef85" class="mr ll iq mn b gy mw mt l mu mv">duplicate_columns</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/d4e207da413428783a8422ee6c6cca14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ICj2P-AbpGUcRbtMBC53_Q.png"/></div></div></figure><p id="ea52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们发现有重复的，因此我们删除它们。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1319" class="mr ll iq mn b gy ms mt l mu mv">#Removing the duplicates <br/>train_df = train_df.loc[:,~train_df.columns.duplicated()]</span></pre><p id="b2eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，处理测试集中的重复项。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="dd61" class="mr ll iq mn b gy ms mt l mu mv">test_df.columns[test_df.columns.duplicated()]</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/076b4dda31213f2fdc61786cbfcd3f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1srKq9OVMDLc_TgINikwvQ.png"/></div></div></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="010e" class="mr ll iq mn b gy ms mt l mu mv">test_df = test_df.loc[:,~test_df.columns.duplicated()]</span></pre><h1 id="dea4" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">训练模型并进行预测</h1><p id="bde0" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">对于给定的预测问题，我们使用 XGBoost 模型。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="311a" class="mr ll iq mn b gy ms mt l mu mv">import xgboost as xgb<br/>xg_train = xgb.DMatrix(train_df, label=encoded_y_train)</span><span id="9317" class="mr ll iq mn b gy mw mt l mu mv">#Specifying the hyperparameters<br/>params = {'max_depth': 10,<br/>    'learning_rate': 1,<br/>    'n_estimators': 5,<br/>    'objective': 'multi:softprob',<br/>    'num_class': 12,<br/>    'gamma': 0,<br/>    'min_child_weight': 1,<br/>    'max_delta_step': 0,<br/>    'subsample': 1,<br/>    'colsample_bytree': 1,<br/>    'colsample_bylevel': 1,<br/>    'reg_alpha': 0,<br/>    'reg_lambda': 1,<br/>    'scale_pos_weight': 1,<br/>    'base_score': 0.5,<br/>    'missing': None,<br/>    'nthread': 4,<br/>    'seed': 42<br/>          }</span><span id="1a1a" class="mr ll iq mn b gy mw mt l mu mv">num_boost_round = 5</span><span id="2115" class="mr ll iq mn b gy mw mt l mu mv">print("Train a XGBoost model")<br/>gbm = xgb.train(params, xg_train, num_boost_round)</span></pre><h1 id="34c9" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">对测试集进行预测</h1><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9186" class="mr ll iq mn b gy ms mt l mu mv">y_pred = gbm.predict(xgb.DMatrix(test_df))</span></pre><p id="63c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为每个用户 id 选择前 5 个目的地。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="fcd5" class="mr ll iq mn b gy ms mt l mu mv">ids = []  #list of ids<br/>cts = []  #list of countries<br/>for i in range(len(id_test)):<br/>    idx = id_test[i]<br/>    ids += [idx] * 5<br/>    cts += label_encoder.inverse_transform(np.argsort(y_pred[i])[::-1])[:5].tolist()</span></pre><p id="2db5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个包含用户及其五大目的地国家的数据框架。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ccb1" class="mr ll iq mn b gy ms mt l mu mv">predict = pd.DataFrame(np.column_stack((ids, cts)), columns=['id', 'country'])</span></pre><p id="e272" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建最终预测 csv。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="757c" class="mr ll iq mn b gy ms mt l mu mv">predict.to_csv('prediction.csv',index=False)</span></pre><p id="8737" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经成功预测了 Airbnb 新用户的目的地国家！</p><p id="3618" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">下一步:</strong></p><ol class=""><li id="3ba3" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">由于我们知道哪些目的地国家更受用户欢迎，Airbnb 可以实施有针对性的营销。这意味着，将这些特定国家的营销策略集中于上述练习中确定的用户。</li><li id="4266" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">Airbnb 可以提前计划他们应该更多地搜寻哪些国家，以获得住宿提供商的支持，因为他们可以清楚地看到用户访问这些国家的倾向。</li><li id="0c2a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">根据特定用户对目的地国家的选择，Airbnb 可能会想到类似的目的地国家(在气候、地形、娱乐选择等方面)。)作为其他可行的旅行选项提供给用户。</li><li id="86f1" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">该分析提供了关于用户简档看起来如何的广泛想法。Airbnb 利用这一优势来试验新的营销策略，或者头脑风暴未来几年的需求变化。</li></ol><p id="b80e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢看我的分析，一定要给我掌声！:)</p><p id="6597" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="oq">源代码托管在</em> <a class="ae or" href="https://github.com/tanmayeewaghmare/Airbnb-Kaggle-Challenge/blob/master/Airbnb%20Kaggle%20prediction%20.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="oq"> GitHub </em> </a> <em class="oq">上。</em></p></div></div>    
</body>
</html>