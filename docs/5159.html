<html>
<head>
<title>Use Python to calculate the Sharpe ratio for a portfolio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 计算投资组合的夏普比率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/calculating-sharpe-ratio-with-python-755dcb346805?source=collection_archive---------2-----------------------#2018-10-01">https://towardsdatascience.com/calculating-sharpe-ratio-with-python-755dcb346805?source=collection_archive---------2-----------------------#2018-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3927c873f1e23eca8545edae764e7ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0eQYSSRLbXNNgPUnI0sUAQ.png"/></div></div></figure><p id="a070" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我将向您展示如何使用 Python 来计算包含多只股票的投资组合的夏普比率。<strong class="kd iu">夏普比率是指每单位波动率</strong>(在股票市场中，波动率代表资产的风险)所赚取的超过无风险利率的平均回报。它允许我们使用数学来量化平均日收益率和日收益率的波动性(或标准差)之间的关系。</p><p id="0af1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简单来说，夏普比率越大，风险调整后的回报越有吸引力。</p><p id="7036" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据我们的风险偏好，这种计算也有助于我们找到投资组合中每只股票的“最佳”配置。</p><div class="kz la gp gr lb lc"><a rel="noopener follow" target="_blank" href="/python-markowitz-optimization-b5e1623060f5"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用 Python 绘制马科维茨有效边界</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">基于历史数据，这个边界将允许你根据你的期望优化你的投资组合配置…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">towardsdatascience.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq jz lc"/></div></div></a></div><div class="kz la gp gr lb lc"><a href="https://medium.datadriveninvestor.com/visualizing-some-key-financial-metrics-for-your-stocks-f987ea37035e" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">可视化你的股票的一些关键财务指标</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">使用 Python 创建一个仪表盘，帮助您对公司做出更明智的投资决策</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="ll l"><div class="lr l ln lo lp ll lq jz lc"/></div></div></a></div><blockquote class="ls"><p id="d58a" class="lt lu it bd lv lw lx ly lz ma mb ky dk translated">一旦你准备好创建一个完全定制的仪表板来跟踪你的投资组合，我将通过两个课程教你<a class="ae mc" href="https://fneves.podia.com/" rel="noopener ugc nofollow" target="_blank">！</a></p></blockquote></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="0ad2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我们需要股票价格数据。我将使用四个简单的文件，有两列——日期和收盘价。你可以用自己的数据，或者在 Quandl 里找点东西，这个用途很好。我们有 4 家公司——亚马逊、IBM、思科和苹果。苹果数据的前五行打印如下。</p><blockquote class="mk ml mm"><p id="7108" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">AAPL = PD . read _ CSV(' AAPL _ 关闭'，索引 _ 列= '日期'，解析 _ 日期=真)</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/ad2610c462f074491e63b260b20b3c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*_zbhWpLtUzXzQMP4uJqolQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">After reading the files, this is what all the dataframes should look like (aapl, amzn, cisco and ibm)</figcaption></figure><p id="c831" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要为每个股票数据框架添加几列。通过几个简单的循环的<em class="mn">,我们可以将标准化收益、我们在投资组合中的股票配置以及每只股票每天的头寸价值相加。首先是归一化收益，它只是将每个收盘价除以数据中的最后一个收盘价。</em></p><blockquote class="mk ml mm"><p id="6a8a" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">对于 stock_df in (aapl，cisco，ibm，amzn):<br/>stock _ df[' Norm return ']= stock _ df[' adj . Close ']/stock _ df . iloc[0][' adj . Close ']</p></blockquote><p id="4e3e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们假设我们的投资组合将包括:苹果 35%，思科 25%，IBM 和亚马逊各 20%。</p><blockquote class="mk ml mm"><p id="75fa" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">对于 stock_df，在 zip 中的分配((aapl，cisco，ibm，amzn)，[.35，. 25，. 2，. 2]):<br/>stock _ df[' Allocation ']= stock _ df[' Norm return ']*分配</p></blockquote><p id="2558" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">循环的最后一个<em class="mn">将添加一列位置值。假设我们的投资组合规模在第一天是 10k。我们只需将它与已经调整到标准化回报的分配列相乘。</em></p><blockquote class="mk ml mm"><p id="b727" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">对于 stock_df in (aapl，cisco，ibm，amzn): <br/> stock_df['位置'] = stock_df['分配']*10000</p></blockquote><p id="335a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是现在四个数据帧的样子。对于每一天，你都知道你的头寸对四只股票的价值。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/4300c38dc50b48d3e8f0e2f8294a453e.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*IEdgZDQdMtZ5a4gIOXmG7g.png"/></div></figure><p id="ff3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了在一个表中得到我们所有的头寸，我们可以从每只股票中分离出列“Position ”,并将其合并到一个名为“portf_val”的新数据框架中。然后，我们重命名列以匹配每只股票。</p><blockquote class="mk ml mm"><p id="13a2" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">all_pos = [aapl['position']，cisco['Position']，ibm['Position']，AMZN[' Position ']<br/>portf _ val . columns =[' AAPL Pos '，'思科 Pos '，' IBM Pos '，' AMZN Pos ']<br/>portf _ val = PD . concat(all _ Pos，axis=1)</p></blockquote><p id="3e45" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以创建一个列来显示所有头寸的总和，这就是我们的总头寸。</p><blockquote class="mk ml mm"><p id="4074" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">portf _ val[' Total Pos ']= portf _ val . sum(axis = 1)<br/>portf _ val . head()</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/dfce40f13f532974a0c025016702c724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*lJkuokijpDAkOHWiiIAsgg.png"/></div></figure><p id="4b9d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从这里，我们实际上可以绘制一些图表，以了解在我们的数据中的所有日子里，我们的投资组合价值发生了什么。</p><blockquote class="mk ml mm"><p id="0aaa" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">将 matplotlib.pyplot 导入为 PLT<br/>PLT . style . use(' fivethirtyeight ')<br/>portf _ val[' Total Pos ']。plot(figsize=(10，8))</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/a506009993f7eeeabd0bbecc098940a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6PO7W6Ypvk4WdHvlJc9QFA.png"/></div></div></figure><p id="1fca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它实际上表现得非常好(不要忘记，大约从 2009 年开始，我们一直处于牛市之中！).我们的个股怎么样？他们表现如何？</p><blockquote class="mk ml mm"><p id="6aac" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">portf_val.drop('总位置'，轴=1)。plot(figsize=(10，8))</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3927c873f1e23eca8545edae764e7ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0eQYSSRLbXNNgPUnI0sUAQ.png"/></div></div></figure><p id="1899" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以看到亚马逊(绿色)表现很好，但另一方面，IBM(黄色)表现不佳。这里有一个很好的例子来说明为什么多样化很重要！</p><p id="9e80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们看看我们的累计回报率是多少。</p><blockquote class="mk ml mm"><p id="3661" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">cumulative _ return = 100 *(portf _ val[' Total Pos '][-1]/portf _ val[' Total Pos '][0]-1)<br/>print('您的累计回报为{:.2f}% '。format(cumulative_return))</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/89530b2cf63ebe8e0152ca942be12375.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*mA4K4CVqCKzlh21zGP5-Gw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">output of the print statement above</figcaption></figure><p id="ea68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以检查 portf_val 的最后一行，看看我们的投资组合值多少钱。</p><blockquote class="mk ml mm"><p id="de7c" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">portf_val.tail(1)</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/1df9e0e61188ff77497801b229779ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*xCcUVmZmEhMguDrF57E8IQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Our portfolio value grew from 10k to more than 22.5k</figcaption></figure><p id="1031" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">126.5%是非常体面的回报！我们将向我们的<em class="mn"> portf_val </em> dataframe 添加另一列。这一次，我们将添加每天的百分比变化，因此在下面的公式中为 1。日回报率对于计算夏普比率很重要。</p><blockquote class="mk ml mm"><p id="261b" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">portf_val['每日回报'] = portf_val['总头寸']。pct_change(1)</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/10a74682914cd543f812c19921aa79b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*gaGrIJJHB-Gt8LirDFbzlQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">The first daily return is a non-value since there is no day before to calculate a return</figcaption></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="302e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在是时候计算夏普比率了。这个公式非常简单直观:从预期投资组合回报中去掉你从无风险投资中获得的回报率。将结果除以投资组合的标准差。如今，由于利率如此之低，人们普遍认为无风险利率为零，因为如果你把钱存入储蓄账户(无风险资产的一般例子)，你只能得到很少的钱。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/053a6239b21a55a446dd68b3981503ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*_vtXNcT9X0iIut1A2x_RuA.png"/></div></figure><p id="c1d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以这个公式就是日收益的平均值，除以日收益的标准差。在 Python 中，它看起来像这样:</p><blockquote class="mk ml mm"><p id="ff05" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">S <!-- --> harpe_Ratio = portf_val['日线回报']。mean() / portf_val['每日回报']。标准()</p></blockquote><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/722c36a96b38f98995eddc7b05ac567d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9lwCL9Sml4jeAnimbUSMg.png"/></div></div></figure><p id="c3d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了完成这篇文章，我们需要按年计算夏普比率，因为我们是从每天的数值计算出来的。一年有 252 个交易日，所以年化的简单方法是用夏普比率乘以 252 的平方根。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/258745225ba7d8b661289bd47c9c1cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1G_Yyk079bE3Q-C6Fb4jVA.png"/></div></div></figure><p id="ccf3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！我们有年度夏普比率，我们准备在未来的文章中使用它来优化我们的股票配置。</p><p id="5cfe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你对 Python 的金融分析感兴趣，有两本很棒的书，几乎涵盖了你需要的所有内容:</p><ul class=""><li id="3760" class="nj nk it kd b ke kf ki kj km nl kq nm ku nn ky no np nq nr bi translated">金融 python:<a class="ae mc" href="https://amzn.to/3SE6Mu0" rel="noopener ugc nofollow" target="_blank">https://amzn.to/3SE6Mu0</a></li><li id="3569" class="nj nk it kd b ke ns ki nt km nu kq nv ku nw ky no np nq nr bi translated">用 Python 写金融理论:【https://amzn.to/3SC4Vpq T2】</li></ul><p id="78ad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另外，<a class="ae mc" href="https://www.investopedia.com/terms/s/sharperatio.asp" rel="noopener ugc nofollow" target="_blank"> Investopedia </a>是定义这些指标的最佳资源之一。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="f9ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">欢迎留下任何问题或评论，或通过<a class="ae mc" href="https://www.linkedin.com/in/fabioneves" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。披露:上面的一些链接是附属链接。这意味着，对你来说零成本，如果你通过链接完成购买，我将赚取代销商佣金！</p></div></div>    
</body>
</html>