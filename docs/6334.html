<html>
<head>
<title>Mobile Ads Click-Through Rate (CTR) Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动广告点击率预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mobile-ads-click-through-rate-ctr-prediction-44fdac40c6ff?source=collection_archive---------2-----------------------#2018-12-08">https://towardsdatascience.com/mobile-ads-click-through-rate-ctr-prediction-44fdac40c6ff?source=collection_archive---------2-----------------------#2018-12-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/231293c3215feec8cef3530e3b36c443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3WrezGorBLJ0bf-j8v9PA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo credit: Pixabay</figcaption></figure><div class=""/><div class=""><h2 id="2b2d" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">在线广告，Google PPC，AdWords 活动，移动广告</h2></div><p id="ae0f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在互联网营销中，<a class="ae lq" href="https://www.wordstream.com/click-through-rate" rel="noopener ugc nofollow" target="_blank">点击率(CTR)是一种衡量广告客户在每一次展示中获得的点击量的指标</a>。</p><p id="f0ad" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">移动已经与所有渠道无缝连接，移动是推动所有商业的驱动力。<a class="ae lq" href="https://www.digitalcommerce360.com/2018/07/27/how-big-is-amazons-ad-business/" rel="noopener ugc nofollow" target="_blank">预计今年移动广告收入将达到 10.8 亿美元，比去年增长 122%。</a></p><p id="fe35" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在这项研究分析中，Criteo Labs 分享了 10 天的<a class="ae lq" href="https://www.kaggle.com/c/avazu-ctr-prediction" rel="noopener ugc nofollow" target="_blank"> Avazu 数据</a>，供我们开发预测广告点击率(CTR)的模型。给定用户和他(或她)正在访问的页面。他(或她)点击给定广告的概率是多少？此分析的目标是为 CTR 估计的最精确 ML 算法设定基准。我们开始吧！</p><h1 id="3348" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">数据</h1><p id="948e" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">数据集可以在<a class="ae lq" href="https://www.kaggle.com/c/avazu-ctr-prediction/data" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="f4a5" class="mo ls jf bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">数据字段</h2><ul class=""><li id="ea74" class="na nb jf kw b kx mj la mk ld nc lh nd ll ne lp nf ng nh ni bi translated">id:广告标识符</li><li id="3e64" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">单击:0/1 表示非单击/单击</li><li id="b5ef" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">小时:格式为 YYMMDDHH，因此 14091123 表示 UTC 2014 年 9 月 11 日 23:00。</li><li id="8034" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">C1——匿名分类变量</li><li id="7e87" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">横幅 _ 位置</li><li id="75dc" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">站点 id</li><li id="b1a3" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">站点 _ 域</li><li id="73aa" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">站点 _ 类别</li><li id="19ad" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">app_id</li><li id="628b" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">app_domain</li><li id="ae8c" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">app _ 类别</li><li id="f7e3" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">设备 id</li><li id="6636" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">设备 _ip</li><li id="1403" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">设备型号</li><li id="e9f2" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">设备类型</li><li id="3174" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">设备连接类型</li><li id="fa2b" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">C14-C21-匿名分类变量</li></ul><h2 id="79cb" class="mo ls jf bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">EDA 和特征工程</h2><p id="2019" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">训练集包含超过 4000 万条记录，为了能够在本地处理，我们将随机抽取其中的 100 万条。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="01e0" class="mo ls jf nt b gy nx ny l nz oa">import numpy as n<br/>import random<br/>import pandas as pd<br/>import gzip</span><span id="cfed" class="mo ls jf nt b gy ob ny l nz oa">n = 40428967  #total number of records in the clickstream data <br/>sample_size = 1000000<br/>skip_values = sorted(random.sample(range(1,n), n-sample_size))</span><span id="e057" class="mo ls jf nt b gy ob ny l nz oa">parse_date = lambda val : pd.datetime.strptime(val, '%y%m%d%H')</span><span id="ab3c" class="mo ls jf nt b gy ob ny l nz oa">with gzip.open('train.gz') as f:<br/>    train = pd.read_csv(f, parse_dates = ['hour'], date_parser = parse_date, dtype=types_train, skiprows = skip_values)</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/d5bfaef8d720dbc2e967278e1ffa7a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJ-FZE-wsxopa-xiyzfN9A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="2535" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">由于匿名化，我们不知道每个特性中的每个值意味着什么。此外，大多数特征是分类的，并且大多数分类特征具有很多值。这使得 EDA 不太直观更容易混淆，但我们会尽力而为。</p><p id="4496" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">特性</strong></p><p id="4d73" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们可以将数据中的所有特征分为以下几类:</p><ul class=""><li id="124b" class="na nb jf kw b kx ky la lb ld od lh oe ll of lp nf ng nh ni bi translated">目标特征:单击</li><li id="8498" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">站点特征:站点 id，站点域，站点类别</li><li id="876c" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">应用功能:应用 id、应用域、应用类别</li><li id="c491" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">设备特征:设备标识、设备 ip、设备型号、设备类型、设备连接类型</li><li id="3aa4" class="na nb jf kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">匿名分类特征:C14-C21</li></ul><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="17bc" class="mo ls jf nt b gy nx ny l nz oa">import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="0556" class="mo ls jf nt b gy ob ny l nz oa">sns.countplot(x='click',data=train, palette='hls')<br/>plt.show();</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi og"><img src="../Images/aeb07c49eba2f52090f2906d4ea4278e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*oDu3jZKxm7Xlxux9b8JjEQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="7c1a" class="mo ls jf nt b gy nx ny l nz oa">train['click'].value_counts()/len(train)</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/03d2fd27e24e58bf5cf808ced9bf0f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*tOEvQ8G855VC02evirszgA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><p id="0482" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">整体点击率约为。17%，而大约。83%没有被点击。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="438d" class="mo ls jf nt b gy nx ny l nz oa">train.hour.describe()</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/54bc12c725ad09d530badd7c5d6bf4f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*Z5b-CUDUYdeoRtnEvXbSyg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><p id="dc8e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">该数据涵盖了从 2014 年 10 月 21 日到 2014 年 10 月 30 日的 10 天点击流数据，即 240 个小时。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="c952" class="mo ls jf nt b gy nx ny l nz oa">train.groupby('hour').agg({'click':'sum'}).plot(figsize=(12,6))<br/>plt.ylabel('Number of clicks')<br/>plt.title('Number of clicks by hour');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/b5a027a2a486554ceb2b1affacd87b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bv9Tn6eS9Wx2P4y0c4i4jw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><p id="3388" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">每小时的点击模式每天看起来都很相似。然而，有几个高峰时间，一个是在 10 月 22 日中午，另一个是在 10 月 28 日中午。10 月 24 日午夜时分，点击量非常低。</p><h2 id="843b" class="mo ls jf bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated"><strong class="ak">日期时间特征的特征工程</strong></h2><p id="2a64" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated"><strong class="kw jg">小时</strong></p><p id="b344" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从日期时间特征中提取小时。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="2cb4" class="mo ls jf nt b gy nx ny l nz oa">train['hour_of_day'] = train.hour.apply(lambda x: x.hour)<br/>train.groupby('hour_of_day').agg({'click':'sum'}).plot(figsize=(12,6))<br/>plt.ylabel('Number of clicks')<br/>plt.title('click trends by hour of day');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/c22a95dbf80c757b0bae6f1c10ffbfe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4udwnqustiwX5222DlYjGw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><p id="2ef0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">一般来说，点击数最高的是 13 和 14 小时(下午 1 点和 2 点)，点击数最低的是 0 小时(午夜)。对于粗略估计，这似乎是一个有用的特性。</p><p id="ba88" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们考虑一下印象。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="31d7" class="mo ls jf nt b gy nx ny l nz oa">train.groupby(['hour_of_day', 'click']).size().unstack().plot(kind='bar', title="Hour of Day", figsize=(12,6))<br/>plt.ylabel('count')<br/>plt.title('Hourly impressions vs. clicks');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ol"><img src="../Images/a55d4055abf247ecbfca0d15865b9ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HE6-dTqd3Gnz81-KI1hXVQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><p id="6584" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这里没有什么令人震惊的。</p><p id="7540" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">既然我们已经看了点击和印象。我们可以计算点击率(CTR)。CTR 是广告点击与印象的比率。它衡量每个广告的点击率。</p><p id="a3df" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">每小时一次</strong></p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="7945" class="mo ls jf nt b gy nx ny l nz oa">import seaborn as sns</span><span id="46e8" class="mo ls jf nt b gy ob ny l nz oa">df_click = train[train['click'] == 1]<br/>df_hour = train[['hour_of_day','click']].groupby(['hour_of_day']).count().reset_index()<br/>df_hour = df_hour.rename(columns={'click': 'impressions'})<br/>df_hour['clicks'] = df_click[['hour_of_day','click']].groupby(['hour_of_day']).count().reset_index()['click']<br/>df_hour['CTR'] = df_hour['clicks']/df_hour['impressions']*100</span><span id="4360" class="mo ls jf nt b gy ob ny l nz oa">plt.figure(figsize=(12,6))<br/>sns.barplot(y='CTR', x='hour_of_day', data=df_hour)<br/>plt.title('Hourly CTR');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/bd9e781c795b606421968592d39f2224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7tNM_TwN5PGnlZrBrvEfLQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><p id="95d6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这里一个有趣的观察是最高的点击率发生在午夜，1，7 和 15。如果你记得的话，午夜前后的浏览量和点击量最少。</p><p id="7863" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">星期几</strong></p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="b9ed" class="mo ls jf nt b gy nx ny l nz oa">train['day_of_week'] = train['hour'].apply(lambda val: val.weekday_name)<br/>cats = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']<br/>train.groupby('day_of_week').agg({'click':'sum'}).reindex(cats).plot(figsize=(12,6))<br/>ticks = list(range(0, 7, 1)) # points on the x axis where you want the label to appear<br/>labels = "Mon Tues Weds Thurs Fri Sat Sun".split()<br/>plt.xticks(ticks, labels)<br/>plt.title('click trends by day of week');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/3e6356760bc7766bfaecec737e229a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_V8_bWkJyFgBPtd8LekVaA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="9b19" class="mo ls jf nt b gy nx ny l nz oa">train.groupby(['day_of_week','click']).size().unstack().reindex(cats).plot(kind='bar', title="Day of the Week", figsize=(12,6))<br/>ticks = list(range(0, 7, 1)) # points on the x axis where you want the label to appear<br/>labels = "Mon Tues Weds Thurs Fri Sat Sun".split()<br/>plt.xticks(ticks, labels)<br/>plt.title('Impressions vs. clicks by day of week');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/205741a230178342acf41a85de22cc19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itIE5HrEsakY6Trj3D00jA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><p id="fec5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">周二的浏览量和点击数最多，周三次之，周四次之。周一和周五的浏览量和点击量最少。</p><p id="9b5a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">星期几中心</strong></p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="d6b5" class="mo ls jf nt b gy nx ny l nz oa">df_click = train[train['click'] == 1]<br/>df_dayofweek = train[['day_of_week','click']].groupby(['day_of_week']).count().reset_index()<br/>df_dayofweek = df_dayofweek.rename(columns={'click': 'impressions'})<br/>df_dayofweek['clicks'] = df_click[['day_of_week','click']].groupby(['day_of_week']).count().reset_index()['click']<br/>df_dayofweek['CTR'] = df_dayofweek['clicks']/df_dayofweek['impressions']*100</span><span id="4c8f" class="mo ls jf nt b gy ob ny l nz oa">plt.figure(figsize=(12,6))<br/>sns.barplot(y='CTR', x='day_of_week', data=df_dayofweek, order=['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'])<br/>plt.title('Day of week CTR');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi op"><img src="../Images/7390d89537649cc44225b3f11f158a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUzpoN12tgkhr1tH_CxOdg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><p id="49d7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">虽然周二和周三的点击数和点击数最高，但它们的点击率却是最低的。周六和周日享受最高的 CTR。显然，人们在周末有更多的时间点击。</p><p id="bc8d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> C1 专题</strong></p><p id="9a8b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">C1 是匿名分类特征之一。虽然我们不知道它的意义，但我们还是想看看它的分布。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="531a" class="mo ls jf nt b gy nx ny l nz oa">print(train.C1.value_counts()/len(train))</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5ecd8ce4f33fd5b4b506349ce7d99430.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*PZ_NyI1Q_3CAtGAhmF1EHA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 12</figcaption></figure><p id="214b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">C1 值= 1005 拥有最多的数据，几乎是我们正在使用的所有数据的 92%。让我们看看 C1 的值是否能说明一些关于 CTR 的东西。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="7e42" class="mo ls jf nt b gy nx ny l nz oa">C1_values = train.C1.unique()<br/>C1_values.sort()<br/>ctr_avg_list=[]<br/>for i in C1_values:<br/>    ctr_avg=train.loc[np.where((train.C1 == i))].click.mean()<br/>    ctr_avg_list.append(ctr_avg)<br/>    print("for C1 value: {},  click through rate: {}".format(i,ctr_avg))</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/b0c581a3015c83854fb5bc373bb8f7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wq-OKHl5AOpD8scYDj77Vg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 13</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="a639" class="mo ls jf nt b gy nx ny l nz oa">train.groupby(['C1', 'click']).size().unstack().plot(kind='bar', figsize=(12,6), title='C1 histogram');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/0118e8eee0c73432abd6e94e9b3a5aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9SCt76ytCjqNZJJKSQ5mWg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 14</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="d43c" class="mo ls jf nt b gy nx ny l nz oa">df_c1 = train[['C1','click']].groupby(['C1']).count().reset_index()<br/>df_c1 = df_c1.rename(columns={'click': 'impressions'})<br/>df_c1['clicks'] = df_click[['C1','click']].groupby(['C1']).count().reset_index()['click']<br/>df_c1['CTR'] = df_c1['clicks']/df_c1['impressions']*100</span><span id="55bd" class="mo ls jf nt b gy ob ny l nz oa">plt.figure(figsize=(12,6))<br/>sns.barplot(y='CTR', x='C1', data=df_c1)<br/>plt.title('CTR by C1');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ot"><img src="../Images/176a6fe47223c9f9e5d7c643a8a9683a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1nKMdfTXNIbEvBF2Qb5Cg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 15</figcaption></figure><p id="9f8f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">重要的 C1 值和 CTR 对有:</p><p id="a86e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">C1=1005: 92%的数据和 0.17%的点击率</p><p id="f11a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">C1=1002: 5.5%的数据和 0.21%的点击率</p><p id="dc4d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">C1=1010:数据的 2.2%和 0.095 的点击率</p><p id="daf0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">C1 = 1002 比平均 CTR 高得多，C1=1010 比平均 CTR 低得多，这两个 C1 值似乎对预测 CTR 很重要。</p><p id="03c1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">横幅位置</strong></p><p id="04a2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">听说<a class="ae lq" href="https://www.wikihow.com/Position-Ads-on-Your-Website" rel="noopener ugc nofollow" target="_blank">影响你横幅广告效果的因素有很多，但最有影响的还是横幅位置</a>。让我们看看这是不是真的。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="e8c0" class="mo ls jf nt b gy nx ny l nz oa">print(train.banner_pos.value_counts()/len(train))</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/039b4cee3a2ffe11dabf762c04170885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*CqtbyUguG-Z6KDzhKvCORA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 16</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="b4cf" class="mo ls jf nt b gy nx ny l nz oa">banner_pos = train.banner_pos.unique()<br/>banner_pos.sort()<br/>ctr_avg_list=[]<br/>for i in banner_pos:<br/>    ctr_avg=train.loc[np.where((train.banner_pos == i))].click.mean()<br/>    ctr_avg_list.append(ctr_avg)<br/>    print("for banner position: {},  click through rate: {}".format(i,ctr_avg))</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ov"><img src="../Images/02535eed676807e5e30687fdf41ee6cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mbNfgvopawPj-7s7Z8zlbA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 17</figcaption></figure><p id="7f59" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">重要的横幅位置有:</p><p id="7026" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">位置 0:数据的 72%和 0.16 CTR</p><p id="cdc9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">位置 1: 28%的数据和 0.18%的 CTR</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="ab44" class="mo ls jf nt b gy nx ny l nz oa">train.groupby(['banner_pos', 'click']).size().unstack().plot(kind='bar', figsize=(12,6), title='banner position histogram');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ow"><img src="../Images/ad3142907cb9115d5ece11db33bad029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeKuZKffx0mfspz8S1UcYw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 18</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="3ba3" class="mo ls jf nt b gy nx ny l nz oa">df_banner = train[['banner_pos','click']].groupby(['banner_pos']).count().reset_index()<br/>df_banner = df_banner.rename(columns={'click': 'impressions'})<br/>df_banner['clicks'] = df_click[['banner_pos','click']].groupby(['banner_pos']).count().reset_index()['click']<br/>df_banner['CTR'] = df_banner['clicks']/df_banner['impressions']*100<br/>sort_banners = df_banner.sort_values(by='CTR',ascending=False)['banner_pos'].tolist()<br/>plt.figure(figsize=(12,6))<br/>sns.barplot(y='CTR', x='banner_pos', data=df_banner, order=sort_banners)<br/>plt.title('CTR by banner position');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ox"><img src="../Images/639e95afa4bfd639f69564c8fde7b4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upTj5IkozAovVN5e6mf1Yg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 19</figcaption></figure><p id="8c79" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">虽然横幅位置 0 具有最高的印象和点击量，但横幅位置 7 享有最高的点击率。增加横幅位置 7 的广告数量似乎是一个好主意。</p><p id="4ba3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">设备类型</strong></p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="8cf8" class="mo ls jf nt b gy nx ny l nz oa">print('The impressions by device types')<br/>print((train.device_type.value_counts()/len(train)))</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/b37b1adb178444483ca93056b9115dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*hKSh0bl11F0Lnz2gm7_Yow.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 20</figcaption></figure><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="0428" class="mo ls jf nt b gy nx ny l nz oa">train[['device_type','click']].groupby(['device_type','click']).size().unstack().plot(kind='bar', title='device types');</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/5116018c4bf69796420c47e75e14585b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*gEAtbqa-ON03_lIz6OAWpw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 21</figcaption></figure><p id="26e5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">设备类型 1 获得最多的展示和点击，其他设备类型仅获得最少的展示和点击。我们可能想要查看关于设备类型 1 的更多细节。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="5668" class="mo ls jf nt b gy nx ny l nz oa">df_click[df_click['device_type']==1].groupby(['hour_of_day', 'click']).size().unstack().plot(kind='bar', title="Clicks from device type 1 by hour of day", figsize=(12,6));</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi op"><img src="../Images/914d04722266289803ce01f72e5f22af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xP73sTQj_dBsQEDFF1XjxQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 22</figcaption></figure><p id="aa79" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">正如所料，大多数点击发生在营业时间，来自设备类型 1。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="b493" class="mo ls jf nt b gy nx ny l nz oa">device_type_click = df_click.groupby('device_type').agg({'click':'sum'}).reset_index()<br/>device_type_impression = train.groupby('device_type').agg({'click':'count'}).reset_index().rename(columns={'click': 'impressions'})<br/>merged_device_type = pd.merge(left = device_type_click , right = device_type_impression, how = 'inner', on = 'device_type')<br/>merged_device_type['CTR'] = merged_device_type['click'] / merged_device_type['impressions']*100</span><span id="acf8" class="mo ls jf nt b gy ob ny l nz oa">merged_device_type</span></pre><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/483c8b93bdb8164342c9b0f8be7dfca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*kpNCKoioNxar_kLqtvIt1A.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 23</figcaption></figure><p id="a1cd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最高的 CTR 来自设备类型 0。</p><p id="e5d2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">用同样的方法，我探索了所有其他分类功能，如网站功能，应用程序功能和 C14 C21 功能。探索的方式大同小异，详细内容可以在<a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Click-Through%20Rate%20Prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到，在此不再赘述。</p><h1 id="7304" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">建筑模型</h1><h2 id="8a6c" class="mo ls jf bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">哈希简介</h2><p id="8e20" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Hash_function" rel="noopener ugc nofollow" target="_blank">散列函数</a>是一个将一组对象映射到一组整数的函数。当使用散列函数时，这种映射将任意长度的键作为输入，并输出特定范围内的整数。</p><p id="e377" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们的精简数据集仍然包含 100 万个样本和～2M 特征值。哈希的目的是最小化功能的内存消耗。</p><p id="9111" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果你想了解更多，这里有一篇由<a class="pb pc ep" href="https://medium.com/u/fe16abb58a96?source=post_page-----44fdac40c6ff--------------------------------" rel="noopener" target="_blank">卢卡斯·伯纳蒂</a>撰写的关于杂凑技巧的优秀文章<a class="ae lq" href="https://booking.ai/dont-be-tricked-by-the-hashing-trick-192a6aae3087" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4c5f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Python 有一个内置函数，它执行一个名为<code class="fe pd pe pf nt b">hash()</code>的散列。对于我们数据中的对象，散列并不奇怪。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="4fb5" class="mo ls jf nt b gy nx ny l nz oa">def convert_obj_to_int(self):<br/>    <br/>    object_list_columns = self.columns<br/>    object_list_dtypes = self.dtypes<br/>    new_col_suffix = '_int'<br/>    for index in range(0,len(object_list_columns)):<br/>        if object_list_dtypes[index] == object :<br/>            self[object_list_columns[index]+new_col_suffix] = self[object_list_columns[index]].map( lambda  x: hash(x))<br/>            self.drop([object_list_columns[index]],inplace=True,axis=1)<br/>    return self<br/>train = convert_obj_to_int(train)</span></pre><h2 id="e202" class="mo ls jf bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">LightGBM 模型</h2><figure class="no np nq nr gt is"><div class="bz fp l di"><div class="pg ph l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">lightGBM_CTR.py</figcaption></figure><p id="1c2e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">训练后的最终输出:</p><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/669e6fec8cf4a3279cced6f2be3a57f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*ukimf0Mz3fFzivk4iswJWA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 24</figcaption></figure><h2 id="abd9" class="mo ls jf bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">Xgboost 模型</h2><figure class="no np nq nr gt is"><div class="bz fp l di"><div class="pg ph l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Xgboost_CTR.py</figcaption></figure><p id="2585" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">它将训练到 eval-logloss 在 20 轮中没有改善。最后的输出是:</p><figure class="no np nq nr gt is gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/20126bdd25b2914c3e33dc84a7b53d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*3qVg8fdN7l95LflKztnGJw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 25</figcaption></figure><p id="5d2a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Click-Through%20Rate%20Prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>可以在<a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Click-Through%20Rate%20Prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。周末愉快！</p></div></div>    
</body>
</html>