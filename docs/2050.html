<html>
<head>
<title>Visualising stocks correlations with Networkx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Networkx可视化股票相关性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualising-stocks-correlations-with-networkx-88f2ee25362e?source=collection_archive---------0-----------------------#2017-12-09">https://towardsdatascience.com/visualising-stocks-correlations-with-networkx-88f2ee25362e?source=collection_archive---------0-----------------------#2017-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/b79df078d0d5ab6b92b3b3f7448e9f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*hL_NaHfGU3udOdWU2dRCFg.gif"/></div></figure><p id="7654" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在最近的一堂网络分析课上，我们被要求可视化股票之间的相关性。作为投资者，你对通过选择不同类型的投资来分散风险感兴趣。因此，你可能希望看到哪些股票表现相似(正相关)或非常不同(负相关)。</p><p id="ecb7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用一个包含所选股票随时间变化的价格的数据集，我们将创建一个关联矩阵，并通过Networkx可视化。</p><p id="ddb3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Github上的Jupyter笔记本(也可以在HTML文件中看到)<a class="ae ks" href="https://github.com/valeria-io/visualising_stocks_correlations/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">的完整代码。</a></p><h2 id="61dd" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">图书馆</h2><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><h1 id="e476" class="ls ku iq bd kv lt lu lv ky lw lx ly lb lz ma mb le mc md me lh mf mg mh lk mi bi translated">a.计算相关矩阵</h1><p id="8d3d" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">我们首先加载数据集，并用<code class="fe mo mp mq mr b">.corr()</code>创建相应的相关矩阵。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="63f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下图显示了数据帧的快照。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/c2e943e082c07825bc059fb47eae37c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvcHthgYHFE-zCWNadhJfg.png"/></div></div></figure><p id="fd99" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后我们存储股票名称，这样我们就可以命名图形中的节点，并将数据帧转换为矩阵，这样在networkx中创建图形就更容易了。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><h1 id="9534" class="ls ku iq bd kv lt lu lv ky lw lx ly lb lz ma mb le mc md me lh mf mg mh lk mi bi translated">b.创建图表</h1><p id="e541" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">我们现在将基于相关矩阵创建一个图表。<code class="fe mo mp mq mr b">G.edges(data=True)</code>将显示所有的边及其相应的权重。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><h1 id="8b72" class="ls ku iq bd kv lt lu lv ky lw lx ly lb lz ma mb le mc md me lh mf mg mh lk mi bi translated">c.(英)可视化(= visualization)</h1><h2 id="30f6" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">第1部分:基本图表</h2><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="21ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你会得到这样的东西:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mx"><img src="../Images/73d09c898c7b45d8dbb9707a3d8dcd50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTv05ykS12ea1cWJUCLtnQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Graph — Part 1</figcaption></figure><h2 id="bff1" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">第2部分:区分负相关和正相关</h2><p id="5fd0" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">现在，我们将从图G创建一个名为H的副本。在H中，如果我们想要可视化所有正相关，我们将删除所有负的边，反之亦然。</p><p id="c77c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这样做之后，我们需要更新代码，将“G”改为“H”。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="407a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面我们可以看到负相关和正相关的图表。我们可以注意到，可用的负相关性更少(右图)。</p><div class="lm ln lo lp gt ab cb"><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/8f835012c5346c5e222a38f7382b8caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2jgZRLS9FE0Iys4zGrfKNA.png"/></div></figure><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/a7bfccfc2cc9e190994965cdfbc7e267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9qQow8AF2p0P02BcLkLKmQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk ni di nj nk"><strong class="bd nl">Left:</strong> create_corr_network_2(G,corr_direction=”positive”) | <strong class="bd nl">Right:</strong> create_corr_network_2(G,corr_direction=”negative”)</figcaption></figure></div><h2 id="0d9e" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">第3部分:根据权重设置边的样式</h2><p id="48f5" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">我们现在需要提取边的权重，以便它们作为图中边的宽度。鉴于相关性非常小，我们将使用函数<code class="fe mo mp mq mr b">1+abs(x))**2</code>来修改每一个，这样它们在图中就不会看起来太薄。</p><p id="e79e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果相关性为正，我们将使用标度颜色<code class="fe mo mp mq mr b">plt.cm.GnBu</code>，否则使用<code class="fe mo mp mq mr b">plt.cmPuRd</code>。</p><p id="1cbf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们需要将所有这些值添加到<code class="fe mo mp mq mr b">nx.draw_networkx_edges</code>中。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="a71b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们的图表现在看起来像这样:</p><div class="lm ln lo lp gt ab cb"><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/4fdab3a6a528fffcdec407ebee22337a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pivTRzGbW3-6q89lUnenOA.png"/></div></figure><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/c20f59940787105b91cf74f1b42e90ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*kwnUwm1LzRQnvAN34ufodw.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk ni di nj nk"><strong class="bd nl">Left:</strong> create_corr_network(G,corr_direction=”positive”) | <strong class="bd nl">Right</strong>: create_corr_network(G,corr_direction=”negative”)</figcaption></figure></div><h2 id="5626" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">第4部分:用最小相关性过滤边缘</h2><p id="ebf1" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">上面的图表看起来太密集了，所以我们现在将添加一个最小相关性，这样我们只能看到更强的相关性。</p><p id="3576" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于前面的代码，我们只需要添加正相关的<code class="fe mo mp mq mr b">or weight["weight"] &lt; min_correlation</code>和负相关的<code class="fe mo mp mq mr b">or weight["weight"] &gt; min_correlation</code>。如果一条边不符合这个标准，那么它将被删除。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="0503" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用最小值。相关性为0.7和-0.7，我们得到下图:</p><div class="lm ln lo lp gt ab cb"><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/ec6fbb39126a1c5b33088455a43f26af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cbs9UfbmkXEmKRYHbWbgzA.png"/></div></figure><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/9bfd84c80217996f952ea7dfc0df9750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*_IkwbwiaTpUMWaPFCdNpAQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk ni di nj nk"><strong class="bd nl">Left:</strong> create_corr_network(G, corr_direction=”positive”, min_correlation = 0.7) | <strong class="bd nl">Right: </strong>create_corr_network(G, corr_direction=”positive”, min_correlation = -0.7)</figcaption></figure></div><h2 id="ac6c" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">第5部分:根据链接边的数量(度数)设置节点样式</h2><p id="2941" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">最后一步是根据节点链接到多少条边(也称为节点的度数)来设置节点的样式。为此，我们在node_sizes中解包所有节点，并将其缩放到<code class="fe mo mp mq mr b">x**3</code>，以便它们看起来更大。</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="6a94" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最终的图表如下所示:</p><div class="lm ln lo lp gt ab cb"><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/f0542a8b94c935c69e68afd369b90115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*3LRtT411edMQ6eO4einOKA.png"/></div></figure><figure class="nc jr nd ne nf ng nh paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/e7e171d162a4137e2b1664917aae0f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*jz1YtIXp_8Pu59fRlOLY6Q.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk ni di nj nk"><strong class="bd nl">Left:</strong> create_corr_network(G, corr_direction=”positive”, min_correlation = 0.7) | <strong class="bd nl">Right: </strong>create_corr_network(G, corr_direction=”positive”, min_correlation = -0.7)</figcaption></figure></div><p id="3a5d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建上述图表的最终代码如下:</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure></div></div>    
</body>
</html>