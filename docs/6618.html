<html>
<head>
<title>Mapping Physical Activity by Webscraping MapMyRun.com with Selenium in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过网络搜集 MapMyRun.com 和硒在 R</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mapping-physical-activity-with-r-selenium-and-leaflet-ac3002886728?source=collection_archive---------16-----------------------#2018-12-21">https://towardsdatascience.com/mapping-physical-activity-with-r-selenium-and-leaflet-ac3002886728?source=collection_archive---------16-----------------------#2018-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq"><div class="bz fp l di"><div class="jr js l"/></div></figure><p id="fa71" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们都知道锻炼是我们身心健康最重要的因素之一。随着新的一年即将到来，一个强有力的宣言是<strong class="jv ir">锻炼更多！</strong>一定会在很多分辨率排行榜上名列前茅。但是要弄清楚如何真正做到这一点是很困难的。虽然一月是<a class="ae kr" href="https://www.newsweek.com/2016/01/15/new-year-new-gym-new-you-january-412054.html" rel="noopener ugc nofollow" target="_blank">开设健身房会员最常见的月份</a>，受健身中心无处不在的<em class="ks">新年，新的我的刺激！在一些城市，这样的计划平均每年要花费 800 美元，这让许多美国人望而却步。一些人选择购买他们自己的设备，这种购买在新年<a class="ae kr" href="https://www.consumerreports.org/sports-exercise-equipment/best-places-to-buy-exercise-equipment/" rel="noopener ugc nofollow" target="_blank">达到高峰</a>，但这仍然会带来<a class="ae kr" href="https://www.treadmillreviews.net/used-vs-new-treadmills/" rel="noopener ugc nofollow" target="_blank">可观的价格标签</a>。这些障碍限制了锻炼的机会，增加了我们的健康不平等，这已经是世界上最糟糕的健康不平等了。</em></p><p id="1a93" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">这些经济限制，加上个人偏好等其他因素，导致许多人转向另一种选择:外出健身。近 6000 万人说他们在 2017 年慢跑或越野跑，比 2006 年增加了 60%，还有 1 亿 T2 人说他们出去散步是为了个人健康。虽然这是对大自然的奇妙利用，但它也带来了另一个问题:并不是所有的户外都同样美丽。大多数美国城市被划分为<a class="ae kr" href="https://www.citylab.com/equity/2016/12/the-persistent-inequality-of-neighborhoods/509408/" rel="noopener ugc nofollow" target="_blank">高贫困和低贫困社区</a>，中间几乎没有。马里兰大学的助理教授拉肖恩·雷博士说，高度贫困地区的人们不太可能锻炼，因为他们遭受犯罪的可能性更大。由于非洲裔美国人和西班牙裔美国人遭受极端贫困的可能性是白人的两倍多，这些邻里差异也导致了我们日益扩大的种族健康差距。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/55a5672a47d6d8ef28a18b6a861eac0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qfPsic93rNinuE3P"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Photo by <a class="ae kr" href="https://unsplash.com/@katetrifo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kate Trifo</a> on <a class="ae kr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4496" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">多伦多大学教授理查德·佛罗里达写道，解决这些问题需要“大量投资来改善贫困社区”，但是这种彻底的改变很难实现。与其等待整个社区被彻底改造，我想知道我是否能在高贫困社区内或附近找到“绿洲”,作为居住在附近的个人的运动区。人们通常不知道藏在自家后院的宝藏，这项分析可以解决这个问题。这也有利于那些想要改变锻炼习惯的活跃人群。我在户外锻炼的一个主要原因是探索我所在城市的新领域，但在像巴尔的摩这样的地方，错误的转弯可能是危险的，我经常发现自己坚持自己熟悉的东西。有了这些内部信息，无畏的城市探险者可以更安全地进行他们的冒险。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi li"><img src="../Images/f85e1f04780a1a6277e756ee2642695e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rdz28JYvFxXKN3Nj"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Photo by <a class="ae kr" href="https://unsplash.com/@dkmoneymomo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Erin White</a> on <a class="ae kr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0728" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">为了进行这项分析，我计算了在过去的四年里，巴尔的摩地区的每个 GPS 坐标在<a class="ae kr" href="http://mapmyrun.com" rel="noopener ugc nofollow" target="_blank"> MapMyRun </a>上发布的一项锻炼中被包含的次数。我分析了近 20，000 次锻炼，这些锻炼是我用<a class="ae kr" href="https://www.seleniumhq.org/" rel="noopener ugc nofollow" target="_blank"> Selenium ChromeDriver </a>刮下来的，在 R 中整理，并在<a class="ae kr" href="https://www.kaggle.com/jessekerr/bmoresbestroutes" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上分享。然后我使用 Javascript 中的<a class="ae kr" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank">传单</a>库来映射数据。本文将展示如何做到这一点，并提供在另一个城市重复这一过程所需的所有步骤。这篇文章开头的地图绝不是一个成品，如果有传单或 Javascript 经验的人能帮助我扩展它的功能，我将不胜感激。要参与或分享反馈，请发推特给我<a class="ae kr" href="https://twitter.com/halfinit" rel="noopener ugc nofollow" target="_blank"> @halfinit </a>或访问该项目的<a class="ae kr" href="https://github.com/Jesse-Kerr/MapMyRunRedone" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a>。</p><h1 id="fd21" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">获取数据</h1><p id="3a95" class="pw-post-body-paragraph jt ju iq jv b jw mh jy jz ka mi kc kd ke mj kg kh ki mk kk kl km ml ko kp kq ij bi translated">我选择使用安德玛旗下的路线追踪应用 MapMyRun 作为我的数据源，因为它有大量用户生成的巴尔的摩市和周边地区的锻炼数据。MapMyRun.com 的路线显示为覆盖在谷歌地图上的红色轨迹。这里有一个例子，2016 年 10 月 26 日发布的随机选择的 7.4 英里跑步。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mm"><img src="../Images/3f0e056c67739d0bfa5e4da723c2a920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xVKKpHaHw-NFsT5P"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Run centered in Severna Park, Maryland.</figcaption></figure><p id="33ae" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">虽然这 20，000 张路线图可以进行很好的罗夏测试，但我们需要的是作为其基础的数据，这些数据包含在一个<strong class="jv ir"> GPX 文件中的一列<strong class="jv ir"> GPS 坐标</strong>中。</strong>我们可以手动进入每次跑步的网页下载 GPX 文件，但使用 Selenium ChromeDriver 来自动化这个过程肯定更有效。如果您想按照代码进行操作，您需要在 Linux 虚拟机上运行的 Docker 容器中设置 Selenium。为了进行设置，以及获得浏览器自动化的基本背景，请查看我的教程<a class="ae kr" rel="noopener" target="_blank" href="/an-introduction-to-web-browser-automation-with-selenium-and-docker-containers-c1bcbcb91540"/>。对于 webscraping 代码，对 HTML、CSS 和 Javascript 等 web 开发概念的基本理解将对您有所帮助。</p><h1 id="114b" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">在 R 中加载库并启动 Selenium</h1><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="9168" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir"># Load the necessary libraries<br/></strong>library(tidyverse)<strong class="mo ir"># Contains many important functions including %&gt;%</strong> library(RSelenium)<strong class="mo ir"># Allows you to call Selenium functions through R<br/></strong>library(rgdal)<strong class="mo ir"> # We will use this for reading in GPX files<br/></strong>library(beepr) <strong class="mo ir"># Alerts you when R finishes a long analysis</strong></span><span id="8965" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Load Selenium in R. You'll need to have started Selenium with the Docker Quickstart Terminal first- See </strong><a class="ae kr" rel="noopener" target="_blank" href="/an-introduction-to-web-browser-automation-with-selenium-and-docker-containers-c1bcbcb91540"><strong class="mo ir">tutorial</strong></a><strong class="mo ir"> for info!) </strong></span><span id="eea0" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Tell Selenium to download files to a specific directory in<br/># the Docker Linux OS.<br/></strong>eCaps &lt;- list(chromeOptions =<br/> list(prefs = list(<br/>  “profile.default_content_settings.popups” = 0L,<br/>  “download.prompt_for_download” = FALSE,<br/>  “download.default_directory” = “home/seluser/Downloads”<br/>  )<br/> )<br/>)</span><span id="3b4c" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Sets how long the driver should wait when searching for elements.<br/></strong>remDr$setTimeout(type = “implicit”, milliseconds = 100000)</span><span id="aba1" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Sets how long it should wait for the page to load.<br/></strong>remDr$setTimeout(type = “page load”, milliseconds = 100000)</span><span id="05c7" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Set up the remoteDriver as remDr. Include chromeOptions<br/></strong>remDr &lt;- remoteDriver(remoteServerAddr = “192.168.99.100”, browserName= “chrome”, port=4445L, extraCapabilities = eCaps)</span><span id="c243" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir">#Open remoteDriver<br/></strong>remDr$open()</span></pre><p id="355c" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">现在我们在 r 中有一个到 Selenium ChromeDriver 的活动连接，在你的全局环境中，<code class="fe my mz na mo b">remDr</code>应该是一个<code class="fe my mz na mo b">object containing active binding</code>。</p><p id="4187" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">要在 MapMyRun 中做任何事情，我们首先需要登录我们的帐户，我们可以从 MapMyRun 主页访问它。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="44a0" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir">#Navigate to MapMyRun homepage<br/></strong>remDr$navigate(“<a class="ae kr" href="https://www.mapmyrun.com" rel="noopener ugc nofollow" target="_blank">https://www.mapmyrun.com</a>")</span><span id="79b5" class="ms lk iq mo b gy mx mu l mv mw">remDr$screenshot(display = TRUE)</span></pre><p id="5d91" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在整个教程中，我使用<code class="fe my mz na mo b">remDr$screenshot</code>函数来显示浏览器中正在发生的事情。如果你看到一个截图，这意味着它被调用了，尽管为了简洁起见我会把它排除在外。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mm"><img src="../Images/89460777336067a8f87279440078227a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfrAlOTHIUvBRzeBByxiog.png"/></div></div></figure><p id="aecf" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们需要点击右上角的 Log in 链接，我们可以通过它的<strong class="jv ir"> xpath </strong>来识别它。xpath 只是一个 web 元素的路径。一个<strong class="jv ir">绝对 xpath </strong>从网页的根开始，并以<code class="fe my mz na mo b">/</code>开始，而一个<strong class="jv ir">相对 xpath </strong>从任何被选择的节点开始，并以<code class="fe my mz na mo b">//</code>开始。这里，我使用从 HTML 文档的<code class="fe my mz na mo b">header</code>开始的相对 xpath，所以我的 xpath 从<code class="fe my mz na mo b">//header</code>开始。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="45e5" class="ms lk iq mo b gy mt mu l mv mw">login &lt;- remDr$findElement(using = “xpath”, “//header/div[2]/nav[2]/ul/li[1]/a”)</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nb"><img src="../Images/49848546ffdaf27dd22988896d060c23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mX5Mcwo4MAKSnF96eE7_Q.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">The HTML for MapMyRun’s homepage, with the relative xpath to the Log in Link highlighted.</figcaption></figure><p id="7eb7" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">现在我们告诉 ChromeDriver 点击 login 元素。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="fc0e" class="ms lk iq mo b gy mt mu l mv mw">login$clickElement()</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mm"><img src="../Images/b9a99c8f4ba586e5abeab59cbc06314a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*msNZqfXXuVM3U9wC3vgzWg.png"/></div></div></figure><p id="2e25" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">这将把我们带到登录页面，在这里我们需要输入我们的电子邮件和密码。但是它们的输入形式都是<strong class="jv ir">输入元素</strong>，那么我们如何区分它们呢？幸运的是，web 开发人员已经通过给每个元素赋予自己的<strong class="jv ir">属性</strong>解决了这个问题。<a class="ae kr" href="https://www.w3schools.com/tags/ref_attributes.asp" rel="noopener ugc nofollow" target="_blank">存在许多类型的属性</a>，但是我们将主要使用的三个是<strong class="jv ir">名称、ID 和类别</strong>。每个网页只使用一次 id，而类可以多次使用<a class="ae kr" href="http://www.htmldog.com/guides/css/intermediate/classid/" rel="noopener ugc nofollow" target="_blank"/>。姓名通常用在<a class="ae kr" href="https://stackoverflow.com/questions/1397592/difference-between-id-and-name-attributes-in-html" rel="noopener ugc nofollow" target="_blank">表单</a>中，就像我们的电子邮件/密码输入表单一样。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/1c853d5680e38d826e1020aa7b3dff1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*KryfbQ_p0949iKwQ7GRvHw.png"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">The HTML for the input form, with the name and ID of our input elements highlighted.</figcaption></figure><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="7fdd" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir"># Either name or id will work to select the element.</strong><br/>email &lt;- remDr$findElement(using = ‘name’, value = “email”)</span><span id="2bce" class="ms lk iq mo b gy mx mu l mv mw">password &lt;- remDr$findElement(using = ‘id’, value = “password”)</span></pre><p id="7666" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">使用<code class="fe my mz na mo b">sendKeysToElement</code>功能输入电子邮件和密码。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="c8f0" class="ms lk iq mo b gy mt mu l mv mw">email$sendKeysToElement(list(“Example@email.com”))</span><span id="2561" class="ms lk iq mo b gy mx mu l mv mw">password$sendKeysToElement(list(“Password”))</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mm"><img src="../Images/060ab5bf314c9b942791221d17756a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sh84vtFm3AeMJ4ms0bbuEA.png"/></div></div></figure><p id="28bc" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">要单击登录按钮，我们可以通过它的类来选择它，它有多个类。为了处理 RSelenium 中的复合类，我们需要使用<code class="fe my mz na mo b">css</code>作为我们的选择器。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="337f" class="ms lk iq mo b gy mt mu l mv mw">login &lt;- remDr$findElement(using = 'css', "[class='success-2jB0o button-2M08K medium-3PyzS button-2UrgI button-3ptrG']")</span><span id="e7ea" class="ms lk iq mo b gy mx mu l mv mw">login$clickElement()</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nd"><img src="../Images/818228be527a06b78d8a19f5fd9ebb65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCZp5D5StYfNZbV1PXZukg.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Some personal information blocked out</figcaption></figure><p id="3a54" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们已经登录，并在我们的主页。要访问发布的路线，我们需要导航到查找路线页面，该页面位于左上方的路线下拉列表中。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ne"><img src="../Images/797fc4db323321c6ddc3924f452232e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqzOaEF_GO006OLH_r3iqA.png"/></div></div></figure><p id="36d6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我用另一个相对 xpath 选择它。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="e4f4" class="ms lk iq mo b gy mt mu l mv mw">findRoutes&lt;- remDr$findElement(using = “xpath”,<br/>“//header/div[1]/nav[1]/ul/li[2]/ul/li/a”)</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nf"><img src="../Images/185e0f8cfa1b15b67875d6d7bbd6eb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V21vHxOPNB1dHf-65lvHNA.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">The HTML for our homepage, with the xpath to the Find Routes link highlighted.</figcaption></figure><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="916a" class="ms lk iq mo b gy mt mu l mv mw">findRoutes$clickElement()</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ng"><img src="../Images/028615d44183d0e6a4bbe3563b7dd675.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDAl3PnOVLdwvkX_vOsEug.png"/></div></div></figure><p id="f3f9" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们已经创建了 routes 页面，但是现在我们需要在 Near 部分输入我们的城市。MapMyRun 将为您提供一个默认位置(称为<strong class="jv ir">占位符</strong>，但这可能是错误的——在我的例子中，它将马里兰州的巴尔的摩与俄亥俄州的哥伦布的邮政编码组合在一起！我们将通过点击它旁边的<code class="fe my mz na mo b">x</code>来清空它，这是一个带有类<code class="fe my mz na mo b">“Select-clear”</code>的&lt; span &gt;。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nh"><img src="../Images/372083b11b1576190a046f6363fbeff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVv5_m9OYa9qpmt_8h9zGw.png"/></div></div></figure><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="c79c" class="ms lk iq mo b gy mt mu l mv mw">clear &lt;- remDr$findElement(using = “class”, value=”Select-clear”)</span><span id="1c5e" class="ms lk iq mo b gy mx mu l mv mw">clear$clickElement()</span></pre><p id="9091" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">由于 Near <input/>元素没有惟一的 ID、名称或类，我们转而使用<code class="fe my mz na mo b">findElements</code>找到页面上的所有<input/>元素，选择第二个元素，并使用 tab 键发送我们的城市信息进行自动填充。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="2bf3" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir"># Find all input elements with findElements.</strong><br/>inputElements &lt;- remDr$findElements(using = “css”, value=”input”) </span><span id="c568" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Choose the second one.<br/></strong>city &lt;- inputElements[[2]]</span><span id="a1f7" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Send city info and the code for the tab key, uE004.<br/></strong>city$sendKeysToElement(list(“Baltimore, MD, 21231”, “\uE004”))</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/bd8ba75bd2c61c7ca40e74daf79398c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*yGwgKI6rcpuqD8ynQcBIkw.png"/></div></figure><p id="dc41" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">还有一点:我们希望获得所有上传的活动，而不仅仅是三英里以上的活动。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="dab9" class="ms lk iq mo b gy mt mu l mv mw">distance &lt;- remDr$findElement(using = “name”, value = “distanceMinimum”)</span><span id="bb65" class="ms lk iq mo b gy mx mu l mv mw">distance$sendKeysToElement(list(key = “backspace”, “0”))</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/da9a0a074f20cba5184423034adfa743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*X6U0092gz_xnqxoUqxDQRQ.png"/></div></figure><p id="141e" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们现在可以单击 search 按钮，它有一个复合类。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="98e5" class="ms lk iq mo b gy mt mu l mv mw">searchButton &lt;- remDr$findElement(using = "css", "[class = 'primary-xvWQU button-2M08K medium-3PyzS']")</span><span id="93c6" class="ms lk iq mo b gy mx mu l mv mw">searchButton$clickElement()</span><span id="25e2" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir">#Scroll down the page to see the results.<br/></strong>webElem &lt;- remDr$findElement(“css”, “body”)<br/>webElem$sendKeysToElement(list(key = “end”))</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/2e71e4cb3e35ceae1db8dc264a2dd421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*veuEobO5_s3-f1KSI5w03Q.png"/></div></figure><p id="e67d" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">HTML 表格中间的每个链接都是指向保存运行数据的网页的链接。</p><p id="a864" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们需要一个功能，将下载 20 个链接(这是<a> HTML 元素)，按下一步按钮，并重复。我用一个 while 循环来完成这个操作，只要页面底部有一个“上一步”和“下一步”按钮，这个循环就会持续下去，当它下载完所有的锻炼数据时就会结束。由于这些按钮都是带有类<code class="fe my mz na mo b">pageLink-3961h</code>的<span>元素，我告诉 ChromeDriver 只要有两个这样的元素就继续下载。</span></a></p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="b600" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir"># Initialize a starter matrix<br/></strong>runs &lt;- as.tibble(matrix(nrow = 20))</span><span id="f1b5" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Start the while loop<br/></strong>while (length(remDr$findElements(using = ‘xpath’,<br/>  “//a[@class= ‘pageLink-3961h’]/span”)) == 2){</span><span id="34b3" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Find the 20 links on the page that contain “routes/view”.<br/></strong>links &lt;- remDr$findElements(‘xpath’, “//a[contains(<a class="ae kr" href="http://twitter.com/href" rel="noopener ugc nofollow" target="_blank">@href</a>, ‘routes/view’)]”)</span><span id="e0d9" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Save these in the runs starter matrix<br/></strong>for (i in 1:length(links)){<br/>  runs&lt;- links[[i]]<br/>  runs&lt;- runs$getElementAttribute(“href”)<br/>  runs[i,1] &lt;- paste(runs, sep=””)<br/>}</span><span id="5cbc" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Add 20 more empty rows to the matrix to put the next set of links in.<br/></strong>runs &lt;- rbind(as.tibble(matrix(nrow = 20)), runs)</span><span id="8787" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Click the next button<br/></strong>next&lt;- remDr$findElement(using = ‘xpath’,<br/>“//a[@class= ‘pageLink-3961h’][2]/span”)</span><span id="6ff4" class="ms lk iq mo b gy mx mu l mv mw">next$clickElement()</span><span id="ea82" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Wait to make sure the webpage fully loads.<br/></strong>Sys.sleep(10)<br/>}</span></pre><p id="0961" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在<code class="fe my mz na mo b">runs</code>数据框架中，我们现在有一个 20，000 个网址的列表，每个网址都链接到一个跑步者的网页。我们需要另一个循环来告诉 Selenium 打开每个 URL，将其导出为 GPX 文件，然后重复。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="1311" class="ms lk iq mo b gy mt mu l mv mw">for (i in 1:20000){<br/>  <br/>  <strong class="mo ir"># Navigate to this URL.<br/>  </strong>remDr$navigate(paste0(runs[i,]))</span><span id="6417" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># Finds the element with the ID “export_this_route”<br/>  </strong>exportRoute &lt;- remDr$findElement(using = "id", value = "export_this_route")</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nl"><img src="../Images/707f241c21132dc081bbc2b02b42e97a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jknwx7L6qSTiSe8grxOIbg.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">The web element with ID of “export_this_route”.</figcaption></figure><p id="e940" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">点击这个元素应该会打开一个下拉菜单，但是并不总是有效。所以我使用了一个 while 循环:只要下拉菜单(它有 ui_widget_overlay 的类)没有打开，就一直点击。</p><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="abf8" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir">  </strong>while(length(remDr$findElements(using= “xpath”,<br/>“//div[<a class="ae kr" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’ui-widget-overlay’]”))==0){<br/> <br/>  exportRoute$clickElement()<br/>}</span></pre><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/5cdc9bafb065998990307a8121cfbb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*0Q0NDSReKrdph_rU6p1BaQ.png"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">The dropdown that appears after clicking “Export This Route”.</figcaption></figure><p id="b2c6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们想点击“下载 GPX 文件”按钮。我们可以通过查看 HTML 来找出它的 ID。</p><figure class="ku kv kw kx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nn"><img src="../Images/dce2060cf2b6abf744e550a84b9cfdb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DN_QSR7WI785oJAUBWhocA.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">The button has an ID of “export_route_gpx_btn”</figcaption></figure><pre class="ku kv kw kx gt mn mo mp mq aw mr bi"><span id="3ae4" class="ms lk iq mo b gy mt mu l mv mw">gpxButton&lt;- remDr$findElement(<br/>    using = "id", value = "export_route_gpx_btn")</span><span id="96f3" class="ms lk iq mo b gy mx mu l mv mw">gpxButton$clickElement()</span><span id="1b32" class="ms lk iq mo b gy mx mu l mv mw"><strong class="mo ir"># End the for loop<br/></strong>}</span></pre><p id="5ce6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">这些 GPX 文件将位于您在启动 Selenium 时确定的文件夹中。</p><h1 id="3a76" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="afb0" class="pw-post-body-paragraph jt ju iq jv b jw mh jy jz ka mi kc kd ke mj kg kh ki mk kk kl km ml ko kp kq ij bi translated">下载完这些 GPX 文件后，我对坐标进行了合并、归一化和对数变换。然后，我将数据发送给 Javascript，并使用传单标记集群插件来创建地图。但是这部分的分析将不得不放在另一篇文章中。你可以在<a class="ae kr" href="https://www.kaggle.com/jessekerr/bmoresbestroutes" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上查看或使用数据集，也可以在这里查看地图<a class="ae kr" href="https://bmoresbestroutes.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">。感谢您的阅读，记得关注并发微博给我</a><a class="ae kr" href="https://twitter.com/halfinit" rel="noopener ugc nofollow" target="_blank"> @halfinit </a>！</p><figure class="ku kv kw kx gt jq"><div class="bz fp l di"><div class="jr js l"/></div></figure></div></div>    
</body>
</html>