<html>
<head>
<title>Visualising temperatures in Amsterdam as a heatmap in R — Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将阿姆斯特丹的温度可视化为 R 中的热图—第二部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualising-temperatures-in-amsterdam-as-a-heatmap-in-r-part-ii-92db6b37a5e1?source=collection_archive---------4-----------------------#2017-07-28">https://towardsdatascience.com/visualising-temperatures-in-amsterdam-as-a-heatmap-in-r-part-ii-92db6b37a5e1?source=collection_archive---------4-----------------------#2017-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="75ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个两部分系列的<a class="ae kl" href="https://medium.com/@deepak.gulati/visualising-temperatures-in-amsterdam-as-a-heatmap-in-r-part-i-7e1be1e251c0" rel="noopener">的最后一部分</a>中，我们研究了如何获取阿姆斯特丹的天气数据，处理这些数据并创建一个简单的热图。下面是我们的数据在第一部分结束时的样子:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="0a47" class="kv kw iq kr b gy kx ky l kz la">  YYYYMMDD  TN  TX       date year month week wday day<br/>1 20160101 1.1 8.0 2016-01-01 2016   Jan   00   Fr   1<br/>2 20160102 4.6 6.5 2016-01-02 2016   Jan   00   Sa   2<br/>3 20160103 5.3 8.5 2016-01-03 2016   Jan   00   Su   3<br/>4 20160104 4.3 7.2 2016-01-04 2016   Jan   01   Mo   4<br/>5 20160105 4.4 7.7 2016-01-05 2016   Jan   01   Tu   5<br/>6 20160106 1.8 4.4 2016-01-06 2016   Jan   01   We   6</span></pre><p id="9921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在将根据这些数据创建另一个热图，并使它看起来像一个日历。让我们首先在 y 轴上绘制星期，在 x 轴上绘制星期几:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="398c" class="kv kw iq kr b gy kx ky l kz la">ggplot(data = t.2016, aes(x = wday, y = week)) + <br/>geom_tile(aes(fill = TX)) + <br/>coord_equal(ratio = 1) + <br/>scale_fill_viridis(option="magma") + theme_tufte(base_family="Helvetica")</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lb"><img src="../Images/a9a827f2be9fddd09c9efea99856141f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LW9d7QyLbqhXi2YP3UgNyw.png"/></div></div></figure><p id="5dff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意 x 轴上的星期是按字母顺序排列的。我们将把它们转换成与一周中的天数相对应的系数:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="a5b8" class="kv kw iq kr b gy kx ky l kz la">t.2016$wday &lt;- factor(t.2016$wday, levels=c("Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"))</span></pre><p id="2695" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将在<code class="fe lj lk ll kr b">month</code>上应用一个<code class="fe lj lk ll kr b">facet_wrap</code>来给每个月分配它自己的面板。注意，我们设置了<code class="fe lj lk ll kr b">scales = "free"</code>，这样每个月都有自己独立的 x 和 y 轴。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="9def" class="kv kw iq kr b gy kx ky l kz la">ggplot(data = t.2016, aes(x = wday, y = week)) + <br/>geom_tile(aes(fill = TX)) + <br/>coord_equal(ratio = 1) + <br/>scale_fill_viridis(option="magma") + theme_tufte(base_family="Helvetica") +<br/><strong class="kr ir">facet_wrap(~month, nrow = 3, scales = "free")</strong></span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lm"><img src="../Images/ae1805854f4d33eaf8d6b7f0084d4db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNOJx36-vTeFgWgCk3bhpg.png"/></div></div></figure><p id="cc59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在很亲密。让我们使用<code class="fe lj lk ll kr b">geom_text</code>在每个图块上添加日期:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="0d27" class="kv kw iq kr b gy kx ky l kz la">ggplot(data = t.2016, aes(x = wday, y = week)) + <br/>geom_tile(aes(fill = TX)) + <br/>coord_equal(ratio = 1) + <br/>scale_fill_viridis(option="magma") + theme_tufte(base_family="Helvetica") +<br/>facet_wrap(~month, nrow = 3, scales="free") + <strong class="kr ir">geom_text(aes(label=day), color="grey", size=3)</strong></span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ln"><img src="../Images/8726260425bd819ee61012a33eaeadb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkL2enqxukIIVDlkan2-fQ.png"/></div></div></figure><p id="ed66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">差不多了，但还不完全是。看到问题了吗？我们的约会颠倒了！</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lo"><img src="../Images/8ccc9c90a3249b11e8155b9a2632f69a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trukYuITMFpAUu5ZWLpDvg.png"/></div></div></figure><p id="682d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，一个月的第一周应该在顶部(即远离 x 轴)，最后一周应该在底部。我们可以通过将周转换为按相反顺序排序的因子来实现这一点:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="45a3" class="kv kw iq kr b gy kx ky l kz la">t.2016$week &lt;- <br/>factor(t.2016$week, levels=rev(sort(unique(t.2016$week))))</span></pre><p id="0d41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此期间，我们还将添加一些收尾工作:</p><ol class=""><li id="edf0" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">隐藏每个月的 y 轴刻度线和标签。我们还将隐藏主轴的 x 和 y 轴标题。</li><li id="52b0" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">将 x 轴标签移动到顶部并隐藏其刻度线。</li><li id="5015" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">默认情况下，月份标签将放置在面板内部。我们将把它们移到外面，否则 x 轴标签会出现在它们上面。我们还将增加月份标签的字体大小，并将它们左对齐。</li><li id="69a2" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">向图表添加标题。</li></ol><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="7f35" class="kv kw iq kr b gy kx ky l kz la">ggplot(data = t.2016, aes(x = wday, y = week)) + <br/>geom_tile(aes(fill = TX)) + <br/>coord_equal(ratio = 1) + <br/>scale_fill_viridis(option = "magma") + <br/>theme_tufte(base_family = "Helvetica") +<br/>facet_wrap(~month, nrow = 3, scales="free") + <br/>geom_text(aes(label = day), color = "grey", size = 3) + </span><span id="d211" class="kv kw iq kr b gy md ky l kz la"><strong class="kr ir"># hide y-axis ticks and labels<br/></strong>theme(axis.ticks.y = element_blank()) +<br/>theme(axis.text.y = element_blank()) +</span><span id="fc81" class="kv kw iq kr b gy md ky l kz la"><strong class="kr ir"># hide main x and y-axis titles<br/></strong>theme(axis.title.x = element_blank()) + <br/>theme(axis.title.y = element_blank()) +</span><span id="a938" class="kv kw iq kr b gy md ky l kz la"><strong class="kr ir"># move x-axis labels (week names) to top, hide ticks<br/></strong>scale_x_discrete(position = "top") +<br/>theme(axis.ticks.x = element_blank()) +</span><span id="0800" class="kv kw iq kr b gy md ky l kz la"><strong class="kr ir"># move panel title (month names) outside (above week names)<br/></strong>theme(strip.placement = "outside") +<br/>theme(strip.text.x = element_text(size = "14", hjust = 0)) +</span><span id="cbd5" class="kv kw iq kr b gy md ky l kz la"><strong class="kr ir"># center-aligned plot title<br/></strong>ggtitle("2016: Heatmap of maximum temperatures in Amsterdam") + <br/>theme(plot.title = element_text(size = "16", hjust = 0.5))</span></pre><p id="cfe2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终结果:</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ln"><img src="../Images/96b9d071d01c61ab0eb0b291e148b43f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wotn9QV9Q7gRnYy6NYbXHw.png"/></div></div></figure><p id="ee33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新:</strong> <a class="ae kl" href="https://github.com/deepakg/heatmap" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div></div>    
</body>
</html>