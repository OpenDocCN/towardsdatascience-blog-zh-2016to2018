<html>
<head>
<title>Visualising crime in London using R (Part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 视觉化伦敦的犯罪(上)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualising-crime-in-london-using-r-part-i-de7853c92ba8?source=collection_archive---------3-----------------------#2017-10-10">https://towardsdatascience.com/visualising-crime-in-london-using-r-part-i-de7853c92ba8?source=collection_archive---------3-----------------------#2017-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq"><div class="bz fp l di"><div class="jr js l"/></div></figure><p id="4f38" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我最近在使用 r 可视化伦敦犯罪的时间序列数据。我忍不住创建了地图，让我可以更好地分析数据。</p><p id="aa6e" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我创建本教程是为了:</p><ol class=""><li id="4f12" class="kr ks iq jv b jw jx ka kb ke kt ki ku km kv kq kw kx ky kz bi translated">有一个用 R 绘制地图的简单例子</li><li id="0f8e" class="kr ks iq jv b jw la ka lb ke lc ki ld km le kq kw kx ky kz bi translated">展示在地图中可视化数据的优势，以便更容易地识别模式和趋势。</li></ol><p id="68ff" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在本教程中，您将学习如何使用<code class="fe lf lg lh li b">SpatialPolygonsDataFrame</code>访问绘制行政区所需的数据，以及如何使用<code class="fe lf lg lh li b">ggplot2</code>创建相应的地图。</p><p id="af54" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">本教程的代码和数据可以在 github 链接<a class="ae lj" href="https://github.com/valeria-io/crime_london_map" rel="noopener ugc nofollow" target="_blank">上找到。</a></p><h1 id="4c3e" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">访问数据</h1><h2 id="e9c1" class="mi ll iq bd lm mj mk dn lq ml mm dp lu ke mn mo ly ki mp mq mc km mr ms mg mt bi translated">犯罪数据</h2><p id="edb9" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">本教程中使用的数据集来自<a class="ae lj" href="https://data.london.gov.uk/dataset/london-ward-well-being-scores" rel="noopener ugc nofollow" target="_blank">伦敦数据存储库</a>，这是一个开放的数据共享平台，其统计数据由伦敦市长办公室提供。为了使教程简单，我只包含了一个名为<code class="fe lf lg lh li b">crime_data.csv</code>的 CSV 文件，其中只包含绘制犯罪率所需的数据。</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="nd js l"/></div></figure><p id="4ec6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">上面的代码加载犯罪数据并更改标题的名称。它将显示以下内容:</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/ae1d363bc0ab551458745dc751077f0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5i1Rcby8LG1NTRhJq96mA.png"/></div></div></figure><h2 id="492d" class="mi ll iq bd lm mj mk dn lq ml mm dp lu ke mn mo ly ki mp mq mc km mr ms mg mt bi translated">行政区的空间数据</h2><p id="38fc" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">你现在需要使用<code class="fe lf lg lh li b">readOGR</code>来加载<code class="fe lf lg lh li b">LondonBoroughs.shp</code>。</p><p id="91df" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><code class="fe lf lg lh li b">LondonBoroughs.shp</code>是项目的‘Map _ data’文件夹中的 shapefile。您会注意到几个名为“LondonBoroughs”的文件具有不同的文件扩展名。你需要它们，因为 shapefile 是由许多不同的文件组成的。prj，。dbf 和. shp。</p><p id="84b2" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><code class="fe lf lg lh li b">readOGR</code>将简单地提取 shapefile 中的信息。</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="nd js l"/></div></figure><p id="9b83" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">上面的代码将显示以下数据:</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nl"><img src="../Images/a446574a48e65664a5dcdfdda2ea69f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVr2ZSsjLhVrA4BdlBrHNA.png"/></div></div></figure><h2 id="2f03" class="mi ll iq bd lm mj mk dn lq ml mm dp lu ke mn mo ly ki mp mq mc km mr ms mg mt bi translated">将犯罪数据与空间数据联系起来</h2><p id="a79a" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">既然您已经有了两个数据集，那么您需要将它们链接在一起。为此，您只需使用<code class="fe lf lg lh li b">left_join</code>并将<code class="fe lf lg lh li b">name</code>和<code class="fe lf lg lh li b">bourough</code>用作 id。</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="nd js l"/></div></figure><p id="8592" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">运行代码后，您会注意到两个数据集现在已经链接在一起:</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nm"><img src="../Images/749863fca5ed7e0c2fed0b6f2b4d4add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLYX0XlZscVzjnAvoVywLg.png"/></div></div></figure><h2 id="6fbe" class="mi ll iq bd lm mj mk dn lq ml mm dp lu ke mn mo ly ki mp mq mc km mr ms mg mt bi translated">将空间数据转换为数据帧</h2><p id="6c35" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">准备好数据的最后一步是使用<code class="fe lf lg lh li b">fortify</code>将其转换成数据帧。这是必需的，因为<code class="fe lf lg lh li b">ggplot</code>需要一个数据帧来创建地图。</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="nd js l"/></div></figure><p id="7487" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">如果您运行上面的代码，您会看到数据看起来是一样的。唯一的区别是它现在是一个数据帧(注意，您不再需要使用<code class="fe lf lg lh li b">@data</code>来查看信息):</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nn"><img src="../Images/0f625c216e114172daf3d07538725f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BypN01F2-SUSIJEeYpWow.png"/></div></div></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="9075" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><em class="nv">如果你不信任我，就在你的控制台上运行下面的代码，仔细检查你使用的数据类型</em>:)</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2f36a336d20cb71211a92b73c2d2aa09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*dLY71tyGOUI7GNo-kczJ4w.png"/></div><figcaption class="nx ny gj gh gi nz oa bd b be z dk">Just a test!</figcaption></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="ad61" class="lk ll iq bd lm ln ob lp lq lr oc lt lu lv od lx ly lz oe mb mc md of mf mg mh bi translated">可视化地图</h1><p id="f4eb" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">现在，您已经有了绘制第一批图表的数据。</p><p id="aa54" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">如下图所示，你需要的只是<code class="fe lf lg lh li b">ggplot</code>。使用<code class="fe lf lg lh li b">fill=`2013`</code>根据列“2013”中的数据创建颜色渐变，这是相应年份每个区的犯罪率。</p><p id="9c14" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">假设您不需要<code class="fe lf lg lh li b">long</code>和<code class="fe lf lg lh li b">lat</code>出现在图形中，那么您需要删除轴和记号。</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="nd js l"/></div></figure><p id="a425" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">通过运行上面的代码，您应该能够看到您的第一个图表:</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi og"><img src="../Images/caa2c465d12b4ab03b813294b5f91a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SsUcbd9A2nVL3n9yK4x0tA.png"/></div></div></figure><p id="16f6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">如果您想创建一个 GIF 来显示一段时间内的变化，您需要首先以下列方式之一将每年的图表保存为图片:</p><ul class=""><li id="9b66" class="kr ks iq jv b jw jx ka kb ke kt ki ku km kv kq oh kx ky kz bi translated">通过使用<code class="fe lf lg lh li b">ggsave()</code>(例如:<code class="fe lf lg lh li b">ggsave("plot_2013.png")</code>)，或者</li><li id="b198" class="kr ks iq jv b jw la ka lb ke lc ki ld km le kq oh kx ky kz bi translated">通过右键单击图表并导出</li></ul><p id="1a38" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">确保所有图表的图例值保持相同(如果图例发生变化，可能会影响地图的大小)。为此，只需将<code class="fe lf lg lh li b">limits(0, max_value)</code>添加到<code class="fe lf lg lh li b">scale_fill_gradient2</code>中。在这种情况下，max_value 可以是 140。<code class="fe lf lg lh li b">scale_fill_gradient2</code>的最终结果如下所示:</p><pre class="mz na nb nc gt oi li oj ok aw ol bi"><span id="b42b" class="mi ll iq li b gy om on l oo op">scale_fill_gradient2(low = "#BDBDBD",high = "#2196F3", # colors<br/>                        name = "Crime rate", limits = c(0, 140))</span></pre><p id="be7e" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">然后你需要做的就是把这些图片添加到 gif 创建工具中，就像从<a class="ae lj" href="https://giphy.com/create/gifmaker" rel="noopener ugc nofollow" target="_blank"> Giphy </a>中得到的一样。最终结果将如下所示:</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="jr js l"/></div></figure><p id="3712" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">从上面的图表中，你可以注意到随着时间的推移，所有行政区的犯罪率都下降了。远离市中心的行政区似乎犯罪率最低，而靠近市中心的行政区似乎犯罪率最高。</p><h1 id="aea3" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">犯罪率最高的行政区</h1><p id="adbd" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">如果您只想给犯罪率高于特定水平(例如 90)的行政区着色，那么您需要做的就是将填充中的值更改为<code class="fe lf lg lh li b">fill=`2013`&gt;90</code>。</p><p id="54db" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">该图的完整代码如下所示:</p><figure class="mz na nb nc gt jq"><div class="bz fp l di"><div class="nd js l"/></div></figure><p id="a285" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">结果如下图所示:</p><figure class="mz na nb nc gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oq"><img src="../Images/ecf9db6f83d7593560fb034d6f56fa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COW232AvxwekjmboZECcKw.png"/></div></div><figcaption class="nx ny gj gh gi nz oa bd b be z dk">Boroughs with crime rates above 90 in 2013</figcaption></figure><p id="5d7c" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">从上面可以看到，2013 年犯罪率在 90 以上的行政区有兰贝斯、哈克尼、哈林盖、纽汉等。</p><h1 id="1ab1" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">下一个教程</h1><p id="5feb" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">在下一个教程中，我将展示如何在一个图表中绘制每年的地图。这真的很容易。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><blockquote class="or"><p id="7216" class="os ot iq bd ou ov ow ox oy oz pa kq dk translated">我希望你喜欢这个教程❤.</p><p id="81a6" class="os ot iq bd ou ov ow ox oy oz pa kq dk translated">如果您有任何问题，请使用下面的评论部分。</p><p id="71e2" class="os ot iq bd ou ov ow ox oy oz pa kq dk translated">谢谢！</p></blockquote></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="2607" class="lk ll iq bd lm ln ob lp lq lr oc lt lu lv od lx ly lz oe mb mc md of mf mg mh bi translated">关于作者</h1><p id="85ba" class="pw-post-body-paragraph jt ju iq jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp kq ij bi translated">我是 Valeria，我热衷于通过美丽的可视化和分析进行数据发现。我希望你喜欢这篇文章！</p><p id="6ae0" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">你可以在<a class="ae lj" href="https://twitter.com/ValeriaCortezVD" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae lj" href="https://www.instagram.com/valeria.ioo/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上找到我，或者访问我在<a class="ae lj" href="http://www.valeria.io/" rel="noopener ugc nofollow" target="_blank"> valeria.io </a>的页面。</p></div></div>    
</body>
</html>