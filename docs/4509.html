<html>
<head>
<title>Human Activity Recognition (HAR) Tutorial with Keras and Core ML (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Keras 和 Core ML 的人体活动识别(HAR)教程(第 2 部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/human-activity-recognition-har-tutorial-with-keras-and-core-ml-part-2-857104583d94?source=collection_archive---------9-----------------------#2018-08-20">https://towardsdatascience.com/human-activity-recognition-har-tutorial-with-keras-and-core-ml-part-2-857104583d94?source=collection_archive---------9-----------------------#2018-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d04c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将 Keras 模型加载到您的 iOS 项目中的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/74b2824a773b40d4dc7c7d9a40079a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0lBOfz3vEmKRIGAdApE-Q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo: a-image/Shutterstock</figcaption></figure><p id="2267" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我之前的<a class="ae lu" href="https://medium.com/@nils.ackermann/human-activity-recognition-har-tutorial-with-keras-and-core-ml-part-1-8c05e365dfa0" rel="noopener">文章</a>讲述了在 Python 中使用苹果的 Core ML 工具从 Keras 创建一个多维深度神经网络的核心 ML 文件(DNN)。如果你想知道如何在不创建完整的 iOS 应用程序的情况下，在 Swift 操场上快速测试这个模型，请继续阅读。本文将涵盖以下步骤:</p><ul class=""><li id="670a" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">将核心 ML 模型文件加载到 Xcode 中</li><li id="1c3a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">检索生成的核心 ML 存根源和编译的核心 ML 模型</li><li id="6a1b" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">创建一个 Xcode 游乐场，并导入核心 ML 存根源和编译的核心 ML 模型</li><li id="5495" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">写几行 Swift 代码，以便对多维传感器数据进行预测</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="cb48" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">将核心 ML 文件加载到 Xcode 中</h1><p id="996e" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">为了在 Swift 操场上使用任何 Core ML 模型，首先需要创建一个常规的 Xcode 项目(例如，单视图应用程序)。一旦项目被创建，搜索文件<code class="fe nn no np nq b">HARClassifier.mlmodel</code>，这是你在我上一篇文章中作为最后一步创建的。将文件拖放到您创建的 Xcode 项目中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/5ae56234812d8c5b9d4f47d93b7d7b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ilPihB6q62CaIssfnto0-A.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Drag and drop the mlmodel file into Xcode</figcaption></figure><p id="0f53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您单击 Xcode 中的<code class="fe nn no np nq b">HARClassifier.mlmodel</code>，模型评估参数将与我们在 Keras 中定义的输入和输出相匹配:</p><ul class=""><li id="3719" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><strong class="la iu">输入:</strong>这是一个包含 240 个条目的多数组(原始 80 x 3 矩阵的平面向量)</li><li id="d861" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><strong class="la iu">输出:</strong>输出参数将六项活动中每一项的概率存储为字典；classLabel 参数是一个字符串，包含给定输入的最可能活动的名称</li></ul><p id="ef05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，您需要两件工艺品来为您的游乐场做准备:</p><ul class=""><li id="bac2" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><strong class="la iu">核心 ML 存根来源:</strong>在“模型评估参数”部分上方，您将看到一个名为“模型类”的部分。核心 ML 模型的导入也创建了必要的 Swift 代码，以便在操场上使用该模型。如果单击类名 HARClassifier 旁边的箭头，您可以查看已生成的代码。</li><li id="8bb0" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><strong class="la iu">核心 ML 模型的编译版本:</strong>继续构建并运行您的应用程序。一旦您的应用程序已经构建并且模拟器已经启动，您必须检索编译的<code class="fe nn no np nq b">.mlmodelc</code>文件。打开取景器并按下<code class="fe nn no np nq b">CMD-Shift-G</code>，然后进入以下路径<code class="fe nn no np nq b">~/Library/Developer/Xcode/DerivedData</code>。导航到为您的应用程序创建的文件夹。在那里，进入文件夹<code class="fe nn no np nq b">Build/Products/Debug-iphonesimulator</code>，显示程序<code class="fe nn no np nq b">MediumHARTutorial</code>的包内容(或者你给你的 Xcode 项目取的任何名字)。最后，在这里你会找到文件夹<code class="fe nn no np nq b">HARClassifier.mlmodelc</code>。这是模型的编译版本。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/9ecfdcfc6eaeb51ab88c948915fbd133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUaI5lt11nUpdKX9F2waqw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Retrieve the model class and the compiled Core ML model</figcaption></figure><p id="a327" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了这两件艺术品，你现在就可以创建你的 Swift 游乐场了。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="49e8" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建一个新的 Swift 游乐场</h1><p id="c804" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">返回 Xcode，创建一个新的(空白)playground 文件。在 playground 中，将编译后的核心 ML 模型添加到<code class="fe nn no np nq b">Resources</code>文件夹中，将 Swift 源文件添加到<code class="fe nn no np nq b">Sources</code>文件夹中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/33671c8eae1230c570c36fd300f9c2be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMEOdKmIazEMUKpVDeF_xA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Add model class and compiled Core ML model to the playground</figcaption></figure><p id="9009" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在导入核心 ML 模型期间创建的存根源都有一个内部保护级别。您需要将所有三个类及其成员都改为<code class="fe nn no np nq b">public</code>(文件在本文末尾引用)，以便在您的游戏中使用它们。生成的三个类是:</p><ul class=""><li id="71d9" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">定义类型<code class="fe nn no np nq b">MLFeatureProvider</code>的模型预测输入的类。</li><li id="a25a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">定义类型<code class="fe nn no np nq b">MLFeatureProvider</code>的模型预测输出的类。</li><li id="305d" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">该类提供对核心 ML 模型的访问，主要用于通过<code class="fe nn no np nq b">prediction</code>函数进行推理。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d599" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">做预测</h1><p id="3184" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">现在，是时候在 Swift 中最终做出预测了。为此，您只需要几行代码。</p><p id="56ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实际上，您可以直接从加速度计加载传感器数据，并进行与训练期间相同的归一化预处理。出于简单的原因，您可以简单地将选定的传感器序列从 Python 复制并粘贴到 XCode 中，然后处理结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Swift Core ML example code to make predictions for accelerometer data</figcaption></figure><p id="d986" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">XCode Playground 中的输出显示了概率最高的预测标签以及所有其他标签的概率。</p><pre class="kj kk kl km gt nv nq nw nx aw ny bi"><span id="9b9b" class="nz mr it nq b gy oa ob l oc od">Predicted label: Upstairs<br/>Probability per label: ["Sitting": 2.0439521186688125e-09, "Jogging": 0.00010426577500766143, "Upstairs": 0.49756348133087158, "Standing": 1.2845226184804437e-12, "Walking": 0.11116743087768555, "Downstairs": 0.39116477966308594]</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3749" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">摘要</h1><p id="5c61" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">在前一篇文章和本文中，我们经历了在 Keras 中创建机器学习模型、将其导入 Xcode 并使用 Swift 编程语言在 iOS 中进行预测的端到端过程。操场文件和 Jupyter 笔记本(来自上一篇文章)可以在<a class="ae lu" href="https://github.com/ni79ls/har-keras-coreml" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ecec" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">放弃</h1><p id="b37c" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated"><em class="oe">本网站上的帖子是我个人的，不一定代表我的雇主的帖子、策略或观点。</em></p></div></div>    
</body>
</html>