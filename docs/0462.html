<html>
<head>
<title>How to change the number of breaks on a datetime axis with R and ggplot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用R和ggplot2更改日期时间轴上的中断数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-change-the-number-of-breaks-on-a-datetime-axis-with-r-and-ggplot2-douglas-watson-338f0d353f05?source=collection_archive---------5-----------------------#2017-05-06">https://towardsdatascience.com/how-to-change-the-number-of-breaks-on-a-datetime-axis-with-r-and-ggplot2-douglas-watson-338f0d353f05?source=collection_archive---------5-----------------------#2017-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="20d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我花了惊人的时间才找到如何在ggplot2日期时间轴上更改刻度间隔，而无需手动指定每个位置的日期。一旦你知道了语法，解决方案就出奇的简单明了:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="8610" class="ku kv iq kq b gy kw kx l ky kz">scale_x_datetime(breaks = date_breaks("12 hours"))</span></pre><p id="d094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着每12小时休息一次。间隔可以是<code class="fe la lb lc kq b">scales</code>包接受的任何值:“秒”、“分”、“小时”、“天”、“周”、“月”或“年”。尾部的<code class="fe la lb lc kq b">s</code>被忽略。请阅读如何旋转标签文本的示例和说明。</p><h1 id="41e3" class="ld kv iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">例子</h1><p id="9a7e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我们用一些假数据来说明。我重用了我的闪亮教程中的CSV数据。你可以在这里下载文件<a class="ae mf" href="http://douglas-watson.github.io/data/datetime/data.csv" rel="noopener ugc nofollow" target="_blank"/>。格式如下所示:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="2fd2" class="ku kv iq kq b gy kw kx l ky kz">"timestamp","date","origin","variable","value" <br/>1448315085.07,2015-11-23 21:44:45,"kitchen","temperature",24.4 <br/>1448315085.07,2015-11-23 21:44:45,"kitchen","humidity",44.9 <br/>1448315085.07,2015-11-23 21:44:45,"bedroom","temperature",24.8 <br/>1448315085.07,2015-11-23 21:44:45,"bedroom","humidity",46.1 <br/>1448318685.07,2015-11-23 22:44:45,"kitchen","temperature",23 <br/>1448318685.07,2015-11-23 22:44:45,"kitchen","humidity",41.1 <br/>1448318685.07,2015-11-23 22:44:45,"bedroom","temperature",23.6 <br/>1448318685.07,2015-11-23 22:44:45,"bedroom","humidity",45.7 <br/>1448322285.07,2015-11-23 23:44:45,"kitchen","temperature",23.4 <br/>...</span></pre><p id="cea7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将它加载到R dataframe中，确保将date列转换为R datetime对象(参见我的<a class="ae mf" href="http://douglas-watson.github.io/posts/gdocs_2_R" rel="noopener ugc nofollow" target="_blank">上一篇关于这个主题的文章</a>，然后创建一个简单的温度-时间图:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="ddb6" class="ku kv iq kq b gy kw kx l ky kz">library(ggplot2) <br/>library(dplyr) </span><span id="2d6d" class="ku kv iq kq b gy mg kx l ky kz">data &lt;- read.csv("data.csv") <br/>data$date &lt;- as.POSIXct(data$date) <br/>temperatures &lt;- filter(data, variable == "temperature", <br/>                       origin == "kitchen") </span><span id="a81f" class="ku kv iq kq b gy mg kx l ky kz">qplot(date, value, data = temperatures, geom="line", <br/>      ylab = "Temperature [C]")</span></pre><figure class="kl km kn ko gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/52a9e887abbfbc6c008f5a99469296a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cm3E7O4BmbQHbAl7.png"/></div></div></figure><p id="38b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认的休息时间很合理，但是为了便于说明，让我们将它们改为每两天休息一次。标签格式遵循strftime语法(见<a class="ae mf" href="http://www.foragoodstrftime.com/" rel="noopener ugc nofollow" target="_blank">http://www.foragoodstrftime.com/</a>帮助构建它们):</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="8cfe" class="ku kv iq kq b gy kw kx l ky kz">qplot(date, value, data = temperatures, <br/>      geom="line", ylab = "Temperature [C]") + <br/>    scale_x_datetime(breaks = date_breaks("2 day"), <br/>                     labels = date_format("%b %d"))</span></pre><figure class="kl km kn ko gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/3b7b8f2b3e23a0b31447b5a498656581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iWMxQPShYIaLfZ2s.png"/></div></div></figure><p id="b325" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到休息的次数已经改变了。很多时候，我更感兴趣的是增加它们的密度。让我们切换到以小时为单位的时间间隔，并在标签中包括时间:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="62b2" class="ku kv iq kq b gy kw kx l ky kz">qplot(date, value, data = temperatures, <br/>      geom="line", ylab = "Temperature [C]") + <br/>    scale_x_datetime(breaks = date_breaks("12 hour"), <br/>                     labels = date_format("%b %d - %H:%M"))</span></pre><figure class="kl km kn ko gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/1ea4e6230ce059c9c9bf490ef018d820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B_GHitoGxf15_6Oe.png"/></div></div></figure><p id="2175" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哎哟！标签不可读。幸运的是，我们可以旋转文本以防止它们重叠:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="2e88" class="ku kv iq kq b gy kw kx l ky kz">qplot(date, value, data = temperatures, <br/>      geom="line", ylab = "Temperature [C]") + <br/>    scale_x_datetime(breaks = date_breaks("12 hour"), <br/>                     labels = date_format("%b %d - %H:%M")) +<br/>    theme(axis.text.x = element_text(angle = 25, <br/>                                     vjust = 1.0, hjust = 1.0))</span></pre><figure class="kl km kn ko gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/911b043840cbc0a1c482c5e63825f537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9yO0EQNKw_TNnw7n.png"/></div></div></figure><p id="5d2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那好多了！如果您将角度设置为90度，或者如果您有一个旧版本的R，您将需要调整<code class="fe la lb lc kq b">vjust</code>和<code class="fe la lb lc kq b">hjust</code>值，直到标签正确排列。尝试将<code class="fe la lb lc kq b">debug = TRUE</code>添加到<code class="fe la lb lc kq b">element_text</code>来显示文本锚点。</p><h1 id="822f" class="ld kv iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">包括图书馆里的这些</h1><p id="c91f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我发现自己在许多R笔记本上加载相同的数据格式并制作类似的图形，所以我编写了一个小型函数库，可以在我的所有分析中重用。<a class="ae mf" href="https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/" rel="noopener ugc nofollow" target="_blank">希拉里·帕克的指南</a>解释了你自己写作所需要的一切。我的函数类似于下面的代码，我可以选择指定一个刻度间隔。如果我以小时为单位指定时间间隔，标签会自动包含时间。如果我将参数留空，ggplot将保持其默认值:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="a704" class="ku kv iq kq b gy kw kx l ky kz">plot_temperature &lt;- function(data, title = "", breaks = "", angle = 25) {<br/>    p &lt;- ggplot2::qplot(date, value, data = data, <br/>                        ylab="Temperature [C]") <br/>    <br/>    if (title != '') {<br/>      p &lt;- p + ggplot2::ggtitle(title)<br/>    }<br/>    <br/>    if ( breaks != '' ) {<br/>      if ( grepl("hour", breaks) ) {<br/>        fmt &lt;- "%b %d - %H:%M"<br/>      } else {<br/>        fmt &lt;- "%b %d"<br/>      }<br/>      p &lt;- p + ggplot2::scale_x_datetime(date_breaks = breaks, <br/>                                         date_labels = fmt) +<br/>        ggplot2::theme(axis.text.x = ggplot2::element_text(<br/>          angle = angle, vjust = 1.0, hjust = 1.0<br/>        ))<br/>    }<br/>    return(p)<br/>}</span></pre><p id="c5ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您将函数移动到外部库时，指定您调用的每个函数的名称空间非常重要。于是<code class="fe la lb lc kq b">ggplot2::</code>分散各处。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="e144" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mw">原载于</em><a class="ae mf" href="http://douglas-watson.github.io/post/2017-05_ggplot_datetime/" rel="noopener ugc nofollow" target="_blank"><em class="mw">Douglas-Watson . github . io</em></a><em class="mw">。</em></p></div></div>    
</body>
</html>