<html>
<head>
<title>Dataset creation and cleaning: Web Scraping using Python — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据集创建和清理:使用 Python 进行 Web 抓取—第 2 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dataset-creation-and-cleaning-web-scraping-using-python-part-2-7dce33cddf66?source=collection_archive---------11-----------------------#2018-10-05">https://towardsdatascience.com/dataset-creation-and-cleaning-web-scraping-using-python-part-2-7dce33cddf66?source=collection_archive---------11-----------------------#2018-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e9045a3279b038cff56ab7ae5245911b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nga3kJin1cK9yUut"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">“open book lot” by <a class="ae kc" href="https://unsplash.com/@impatrickt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Patrick Tomasso</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="af27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个由两部分组成的系列文章的第一部分中，我们介绍了一种在 BeautifulSoup 和 Python 的帮助下使用网络抓取从维基百科网页中提取数据的方法。仔细观察数据集，我们可以清楚地看到，在收集的数据中存在必须消除的噪声。每当使用网络抓取收集数据时，它通常充满了我们在这里可以看到的噪音。因此，在执行任何分析之前，需要清理收集的数据以创建统一且可用的数据集。</p><p id="a64f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们将处理我们在上一部分创建的维基百科数据集，并逐一处理每一列，直到我们有一个相当有用的数据集。</p><h1 id="cfbc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导入库并读取 CSV 文件</h1><p id="e2a2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们导入三个库<em class="me"> re </em>、<em class="me"> numpy </em>和<em class="me"> pandas </em>。我们已经知道 numpy 和熊猫。第三个库<code class="fe mf mg mh mi b">re</code>实际上是用来根据一个<em class="me">正则表达式</em>(通常称为<em class="me"> regex </em>)格式化字符串，它基本上定义了一个搜索模式。我们将在本文中探索它的用法，如何使用它摘自它的<a class="ae kc" href="https://docs.python.org/3/library/re.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="ad44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们使用 pandas 函数<code class="fe mf mg mh mi b">read_csv()</code>读取数据集文件，并将其存储在<code class="fe mf mg mh mi b">dataset</code>变量中。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><h1 id="348a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">替换标题</strong></h1><p id="28b5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">仔细检查后，可以发现标题可以做得更具描述性，因此我们将在必要的地方进行替换。我们将把<code class="fe mf mg mh mi b">Country(or dependent territory)</code>改为<code class="fe mf mg mh mi b">Country</code>、<code class="fe mf mg mh mi b">% of worldpopulation</code>改为<code class="fe mf mg mh mi b">Percentage of World Population</code>、<code class="fe mf mg mh mi b">Total Area</code>改为<code class="fe mf mg mh mi b">Total Area (km2)</code>。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/229d62d5fecc369bb83c1c6dd38169db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qz450ISR64C-OIexA_KtpA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Finalised column headings</figcaption></figure><p id="e1eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将使用新确定的列名来访问数据并细化其中的内容。</p><h1 id="281c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">分析和清理数据集</h1><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/ac35e5bd914909046b55727ea56b6311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xMHksRLbedttr-RvelgTg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Dataset.csv</figcaption></figure><p id="9316" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们首先来看看数据集的当前状态。我们可以看到，几乎所有的列都有方括号和圆括号内的信息。方括号内的文字通常是指维基百科页面上的进一步链接。在我们的例子中，我们不会访问任何链接，这些链接不会提供有用的信息，所以我们可以删除它们。括号内的数据通常包括关于真实数据的附加信息。例如，在列<code class="fe mf mg mh mi b">Total Area</code>中，面积在括号内以其他公制单位定义。我们也不需要这些数据，所以我们也可以删除所有的括号。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="c579" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们从列<code class="fe mf mg mh mi b">Percentage of World Population</code>和<code class="fe mf mg mh mi b">Percentage Water</code>的所有值中删除“%”符号，因为这从列标题中可以直接看出。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/82d5ce829ae1323ef4f8b35b5470b20b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMzhAIoYlhSK69vAuo-jPA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Resultant dataframe</figcaption></figure><p id="1548" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据现在看起来好多了，但我们还有很多事情要做。</p><h1 id="7178" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">一次处理一列</h1><p id="ff6b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mf mg mh mi b">Country</code>帮助我们识别上下文，现在不需要修改。在我们前面的步骤之后，<code class="fe mf mg mh mi b">Percentage of World Population</code>已经是正确的格式了，所以我们也不改变它。</p><h2 id="b51f" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">人口和总面积列</h2><p id="de98" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mf mg mh mi b">Population</code>列中的数字用逗号分隔。这里，我们将使用<code class="fe mf mg mh mi b">replace()</code>函数删除逗号。这个函数将第一个参数作为我们想要替换的字符，第二个参数定义我们想要替换的字符。这里，我们什么都不用替换<code class="fe mf mg mh mi b">,</code>，因此有了函数<code class="fe mf mg mh mi b">replace(',','')</code>。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="0e69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了访问每个单元格，我们在<code class="fe mf mg mh mi b">for</code>循环的帮助下迭代该列，然后使用 Pandas 函数<code class="fe mf mg mh mi b">iloc[]</code>读取和更新该列中的特定单元格。</p><p id="91b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们移动到<code class="fe mf mg mh mi b">Total Area (km2)</code>列。我们也从删除该列中的逗号开始。接下来，一些列的数据在<code class="fe mf mg mh mi b">sq mi</code>中，而其他列的面积在<code class="fe mf mg mh mi b">km2</code>中。我们必须将所有的<code class="fe mf mg mh mi b">sq mi</code>值乘以 2.58999，转换成<code class="fe mf mg mh mi b">km2</code>。</p><p id="336c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了实现这一点，我们检查单元格在字符串中是否有<code class="fe mf mg mh mi b">sq mi</code>，如果有，我们删除除了<code class="fe mf mg mh mi b">.</code>之外的所有非数字字符，并将值乘以 2.58999。该值最终被转换回整数。我使用了一个函数<code class="fe mf mg mh mi b">repr</code>来获得该列中值的可打印版本。在查看结果时，我看到在可打印的格式中，<code class="fe mf mg mh mi b">sq mi</code>实际上被表示为<code class="fe mf mg mh mi b">sq\xa0mi</code>,匹配必须针对它进行。这也反映在代码中。如果单位已经在<code class="fe mf mg mh mi b">km2</code>中，我们只需删除除<code class="fe mf mg mh mi b">.</code>之外的所有非数字字符，并将值转换为整数。为了移除所有这样的字符，我们使用正则表达式<code class="fe mf mg mh mi b">[^0-9.]+</code>，这基本上意味着我们移除任何计数中的所有字符(用<code class="fe mf mg mh mi b">+</code>标记)，除了数字 0 到 9 和<code class="fe mf mg mh mi b">.</code></p><p id="77ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在做同样的尝试时，我发现一些值在范围内，我们需要首先解决它们。因此，对于所有这些国家，我们读取范围，使用<code class="fe mf mg mh mi b">split('-')</code>函数将其分割，并将第一个值作为我们将为该单元格考虑的值。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/691e8b2f22fbc68be8638ae42d746ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I8V5RRwQHyHG1dtR52YL4Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Modified ‘Population’ and ‘Total Area’ columns</figcaption></figure><h2 id="e3be" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">百分比水柱</h2><p id="3e0f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">该列有一些异常值。首先，对于一些含水量很低的国家，如<em class="me">阿尔及利亚</em>和<em class="me">阿富汗</em>，此栏数值标有<code class="fe mf mg mh mi b">Negligible</code>或<code class="fe mf mg mh mi b">negligible</code>。此外，对于<em class="me">智利</em>来说，最后还有一个额外的<code class="fe mf mg mh mi b">b</code>存在。</p><p id="c109" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们需要用<code class="fe mf mg mh mi b">0.0</code>替换<code class="fe mf mg mh mi b">Negligible</code>和<code class="fe mf mg mh mi b">negligible</code>，并删除这些单元格中除数字和<code class="fe mf mg mh mi b">.</code>之外的任何额外字符。我们使用前面定义的不带和带正则表达式的<code class="fe mf mg mh mi b">replace()</code>函数来实现这一点。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="d19a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于某些缺失值的情况，记录的值不正确，必须删除。幸运的是，这很容易解决。我们可以简单地删除所有大于 100 的行。这是可行的，因为百分比值不能超过 100。我们首先使用<code class="fe mf mg mh mi b">astype(float)</code>将列中的每个字符串转换为 float，然后只保留那些值小于或等于 100 的列。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/68e8efe1b22fe6b84fc02697128f30f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UamcI9tLNzDET34zfAy0cA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Modified ‘Percentage Water’ column</figcaption></figure><h2 id="d7c5" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">名义国内生产总值和人均国内生产总值栏</h2><p id="8cd9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">对于<code class="fe mf mg mh mi b">Total Nominal GDP</code>，我们首先去掉美元符号。接下来，我们观察到这一列中的金额被表示为<em class="me">万亿</em>、<em class="me">十亿</em>和<em class="me">百万</em>的字符串。因此，我们读取每个单元格，识别面额，删除除数字和<code class="fe mf mg mh mi b">.</code>之外的所有字符，并将金额乘以面额数值。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="5cee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于<code class="fe mf mg mh mi b">Per Capita GDP</code>,我们保留数字 0-9 和<code class="fe mf mg mh mi b">.</code>,同时删除所有其他字符，包括逗号和美元符号。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/77285bd1d6162c6ae9ecf0d5ebf1300b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zKdeDvMKhJcqA8VCK-GgwA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Final Dataset</figcaption></figure><h1 id="01d0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导出最终数据集</h1><p id="0502" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">最后，我们的数据集现在是干净的，可以导出到外部 CSV 文件中。我们使用熊猫函数<code class="fe mf mg mh mi b">to_csv</code>将数据帧导出到文件<code class="fe mf mg mh mi b">Final_dataset.csv</code>。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><h1 id="49ed" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="1e1b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在这篇文章中，我们发现虽然网络搜集的第一步即数据收集很重要，但是数据的清理也同样重要。这一步本身也有一些挑战，我们必须先解决这些挑战，然后才能开发合适的数据集进行有用的分析。最终的<a class="ae kc" href="https://github.com/kb22/Web-Scraping-using-Python/blob/master/Final_dataset.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>也存在于 GitHub 存储库中。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="a9c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望你喜欢我的作品。请随时伸出手，评论，分享，发表你的看法。</p></div></div>    
</body>
</html>