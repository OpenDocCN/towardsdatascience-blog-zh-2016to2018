<html>
<head>
<title>Handling Sparse matrix — Concept behind Compressed Sparse Row (CSR) matrix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理稀疏矩阵——压缩稀疏行(CSR)矩阵背后的概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/handling-sparse-matrix-concept-behind-compressed-sparse-row-csr-matrix-4fe6abe58a7a?source=collection_archive---------3-----------------------#2018-01-05">https://towardsdatascience.com/handling-sparse-matrix-concept-behind-compressed-sparse-row-csr-matrix-4fe6abe58a7a?source=collection_archive---------3-----------------------#2018-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/55dfb9e2086c531c350cdca088312cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKTaGzT3sR9SxYqoiyPTOQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: <a class="ae kc" href="https://www.loginworks.com/web-scraping-blogs/text-mining/" rel="noopener ugc nofollow" target="_blank">https://www.loginworks.com/web-scraping-blogs/text-mining/</a></figcaption></figure><p id="e913" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有两种常见的矩阵——密集矩阵和稀疏矩阵</p><p id="2104" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">稀疏矩阵的大部分元素为零，而密集矩阵的大部分元素不为零。对于大矩阵，通常大部分元素为零。因此，只使用非零值来执行运算是有意义的，因为零乘以任何值都将始终等于零。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/5c26d68c6b9f2d1acabd42a2fab5f732.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*KSkt4cZ1zc3JLXkD-5ncbQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: <a class="ae kc" href="https://www.coin-or.org/Ipopt/documentation/node38.html" rel="noopener ugc nofollow" target="_blank">https://www.coin-or.org/Ipopt/documentation/node38.html</a></figcaption></figure><p id="22af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Scipy提供了各种只存储非零元素的稀疏矩阵函数。通过这样做，可以最小化数据存储所需的存储器。机器学习过程通常需要数据帧在内存中。它分解数据帧以适合RAM。通过压缩，数据可以很容易地放入RAM。仅使用稀疏矩阵的非零值来执行操作可以大大提高算法的执行速度。</p><p id="2bec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">压缩稀疏行(CSR)算法是Scipy提供的类型之一。下面是它的工作原理。</p><h1 id="ef31" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">样本文本文档</strong></h1><p id="abf3" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">短句</p><p id="027d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不是一个短句</p><p id="201e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有下雨。是吗？</p><p id="4013" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第一步——步进</strong></p><p id="6821" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给单词编号。如果单词重复，分配相同的数字。通过这一步，我们知道整个文档中有多少单词。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/ad45face7212fa5251934ba85f6461ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*lM_yG3XdraMzVMgwUKjHFw.png"/></div></figure><p id="e353" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">索引从0开始。第一个单词是“short ”,它被索引为“0 ”,同样，每个唯一单词都将被索引。单词“Short”出现两次，因此它每次在文档中出现时都获得相同的索引值“0”。</p><p id="0b73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤2——文档的矢量表示</strong></p><p id="6c9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于文档中的每一行，创建向量表示。计算唯一索引的数量。在这种情况下，我们有从0到7的8个索引，因此每个文档(行)使用8个值来表示，每个值表示对应于该索引的特定单词出现的次数。</p><p id="537c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">(索引，单词)——(0，短，(1，句子)，(2，这个，(3，是)，(4，不是)，(5，a)，(6，它)，(7，下雨)</p><p id="0b3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">01234567</p><p id="113d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">[11000000]</p><p id="5100" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">[11111100]</p><p id="b5fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">[00021021]</p><p id="7feb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，第一个向量的第一个位置中的值1表示索引为“0”的单词在文档中出现1次。第三个向量的第四个位置的值2表示索引为“3”的单词在该文档中出现了两次。</p><p id="a061" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤3——为每个文档创建稀疏向量</strong></p><p id="2ac6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是每个文档的稀疏矩阵表示。它删除所有零值，只存储非零值。</p><p id="991b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文档1: &lt;0 1, 1 1&gt;</p><p id="f986" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个文档只在前两个位置有值，所以只表示它们。(0 1)表示第0个位置的值为1，而(1 1)表示第1个位置的值为1。在&lt;0 1, 1 1&gt;的(0-1)中，0对应于索引，而1对应于特定索引在文档中出现的次数(值)</p><p id="ee21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文件2: &lt;0 1, 1 1, 2 1, 3 1, 4 1, 5 1&gt;</p><p id="2966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文件3: &lt; 3 2, 4 1, 6 2, 7 1&gt;</p><p id="120f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CSR矩阵表示需要三个数组——索引、值和指针。</p><p id="6f8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">索引</strong></p><p id="f12f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Ind — [0，1，0，1，2，3，4，5，3，4，6，7]</p><p id="587a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从上述步骤中获得的每个文档的索引被合并为一个。索引的大小是文档中非零值的个数。</p><p id="d5ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">值</strong></p><p id="1ea5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瓦尔-[1，1，1，1，1，1，1，1，2，1，2，1]</p><p id="d174" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">值数组包含与从每个文档中获得的每个索引相对应的值。索引的大小是文档中非零值的个数。</p><p id="b8b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">指针</strong></p><p id="a8bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们已经组合了文档中所有行的索引和值。指针有助于在索引和值数组中标识完整文本文档中每个文档(行)的开头和结尾。</p><p id="5ed8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ptr -[0，2，8，12]</p><p id="85ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">0表示文档1(行1)的开始，它在开始后两个位置结束。从第三个位置开始，文档2(行2)开始并在第八个位置结束。从第9个位置开始，文档3(第3行)开始并在第12个位置结束。这适用于索引数组和值数组。指针有助于理解索引和值数组。给定一个索引和指针数组，就可以知道每个文档的开始和结束。</p><p id="05e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">传递这些数组将给出CSR矩阵，这就是scipy中csr_matrix函数的工作方式。</p><p id="cd02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">代码</strong></p><p id="10b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来自scipy.sparse import *</p><p id="c721" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来自scipy import *</p><p id="9f39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ind = [0，1，0，1，2，3，4，5，3，4，6，7]</p><p id="d9fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">val = [1，1，1，1，1，1，1，1，2，1，2，1]</p><p id="f976" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ptr = [0，2，8，12]</p><p id="4587" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">csr_matrix( (val，ind，ptr))</p><p id="cc7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出:&lt; 3x8 sparse matrix of type ‘<type/></p><p id="aa87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">具有压缩稀疏行格式的12个存储元素&gt;</p><p id="40a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">处理文本文档时，CSR矩阵就是这样创建的。</p><p id="8653" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">……未完待续</p><p id="e4ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">灵感来自我的数据挖掘课。</p></div></div>    
</body>
</html>