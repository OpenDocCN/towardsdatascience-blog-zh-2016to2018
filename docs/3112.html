<html>
<head>
<title>Survival Analysis to Explore Customer Churn in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索 Python 中客户流失的生存分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/survival-analysis-in-python-a-model-for-customer-churn-e737c5242822?source=collection_archive---------2-----------------------#2018-04-10">https://towardsdatascience.com/survival-analysis-in-python-a-model-for-customer-churn-e737c5242822?source=collection_archive---------2-----------------------#2018-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/49a109efc7a376b8af36383ed866d27b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRrryehc4IP5_ApZ5wlyYQ.png"/></div></div></figure><p id="bfb7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">生存分析是指一套统计技术，用于推断<em class="kz">、【寿命】、</em>或事件时间序列，而无需观察训练集中每个受试者感兴趣的事件。感兴趣的<em class="kz">事件</em>有时被称为受试者的<em class="kz">【死亡】</em>，因为这些工具最初被用于在临床试验中分析药物治疗对患者存活率的影响。</p><p id="b35c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同时，<em class="kz">客户流失</em>(定义为 c <em class="kz">客户保持</em>的反义词)是许多面向客户的企业渴望最小化的关键成本。没有<a class="ae la" href="https://www.kdnuggets.com/2017/03/datascience-building-predictive-churn-model.html" rel="noopener ugc nofollow" target="_blank">预测哪些客户会流失的银弹方法</a>(在<a class="ae la" href="https://www.datascience.com/blog/intro-to-predictive-modeling-for-customer-lifetime-value" rel="noopener ugc nofollow" target="_blank">如何定义客户是否已经流失非订阅产品</a>时，必须小心谨慎)，但是<em class="kz">生存分析</em>为探索时间-事件系列<em class="kz">提供了有用的工具。</em></p><h1 id="804c" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为什么我们不能用 OLS 线性回归呢？</h1><p id="153f" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">OLS 通过绘制最小化误差平方和的回归线来工作。然而，对于未观察到的数据，误差项是未知的，因此不可能使这些值最小化。</p><p id="bdca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简单地将审查的日期作为所有受试者已知的有效最后一天，或者更糟的是，删除所有被审查的受试者会使我们的结果产生偏差。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/f66ee87fdce51f9279eea764abef93f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yHhG4TVcAAi29Ln88t0_5Q.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Not all deaths have been observed by t1, the time of observation. Image by author.</figcaption></figure><p id="9b98" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上图中，U002 从损失到跟进都经过了审查(例如，可能是由于账户上的一个未解决的技术问题导致客户在数据提取时的状态未知)，而 U003 和 U004 经过了审查，因为它们是当前客户。截止到<em class="kz"> t1 </em>，只有 U001 和 U005 都观察到了出生和死亡。如图所示，删除未观察到的数据会低估客户的寿命，并使我们的结果产生偏差。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="8fa0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">生存分析处理事件<em class="kz">审查</em>完美无缺。被审查的客户，是死亡没有被观察到的客户。发生这种情况的主要原因是在观察时客户的生命周期尚未结束。(注意:在临床试验中，<em class="kz">失访</em>或退出研究的患者也被视为审查对象。)</p><h1 id="c8bf" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">卡普兰-迈耶曲线</h1><p id="efb2" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">对于每个主体(或顾客，或用户)只能有一个“出生”(注册、激活或签约)和一个“死亡”(不管是否被观察到)的任何问题，第一个也是最好的起点是卡普兰-迈耶曲线。这将允许我们估计一个或多个队列的“生存函数”,这是生存分析中最常用的统计技术之一。</p><p id="806f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">生存分析可以作为一种探索性的工具，用来比较不同群体、不同客户群或不同客户原型之间的客户寿命差异。在 Python 中，我们可以使用 Cam Davidson-Pilon 的<a class="ae la" href="https://github.com/CamDavidsonPilon/lifelines" rel="noopener ugc nofollow" target="_blank">生命线</a>库来开始。</p><p id="29aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以这个<a class="ae la" href="https://www.ibm.com/communities/analytics/watson-analytics-blog/predictive-insights-in-the-telco-customer-churn-data-set/" rel="noopener ugc nofollow" target="_blank"> IBM Watson telco 客户演示数据集</a>为例。通过对单条电话线与多条电话线的二元特征进行分段，我们得到以下 Kaplan-Meier 曲线。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/6c9f1dea4bf02b1f2a177e795d4bb3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BihVwY1nTkmoXBf03exMvA.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Customers with one phone line have a steeper survival curve initially, but by ~4 years 3 months customer lifetime the error bars make the two groups indistinguishable. Image generated using matplotlib by author.</figcaption></figure><p id="f57c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以看到，在只有一条电话线的用户中，有 1/4 的用户在第 25 个月时发生了变化。相比之下，在拥有多条电话线路的用户中，1/4 的用户在 43 个月前流失，相差 18 个月(额外 1.5 年的收入！)</p><p id="faea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">相关性不是因果关系，因此这张图本身不能被认为是“可操作的”。然而，我们可能会看到这一点，并开始怀疑一些可能性，如拥有多条电话线的客户更“固定”，因此比单电话线用户更不容易流失。另一方面，也许更忠诚的客户首先倾向于选择多条电话线。</p><p id="9250" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">谁应该得到更多的投资？如果这两个集团的利润相当，那么花更多的钱来让单线电话用户满意可能是值得的，因为他们目前倾向于更快地流失。或者，一个实验性设计可以揭示一些激励措施可以使<em class="kz">所有客户、</em>的生命周期翻倍，并且由于多线路用户的生命周期最初往往更长，这种倍增效应实际上会为该细分市场带来更多利润。</p><p id="1d26" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果没有更多的背景，以及可能的实验设计，我们无法确定。</p><h1 id="021f" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">卡普兰-迈耶曲线的利弊</h1><p id="c6cf" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated"><strong class="kd iu">优点:</strong></p><ul class=""><li id="085a" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky na nb nc nd bi translated">需要最少的功能集。Kaplan-Meier 只需要事件发生的时间(死亡或审查)和出生与事件之间的生命周期。</li><li id="fa84" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">许多时间序列分析很难实现。卡普兰-迈耶只需要所有的事件都发生在感兴趣的同一时间段内</li><li id="9099" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">自动处理类别不平衡(死亡与审查事件的任何比例都可以)</li><li id="c2d1" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">因为它是一种非参数方法，所以很少对数据的基本分布进行假设</li></ul><p id="2318" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">缺点:</strong></p><ul class=""><li id="300a" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky na nb nc nd bi translated">无法估计感兴趣的生存-预测关系差异的<em class="kz">大小</em>(无风险比或相对风险)</li><li id="30c0" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">无法在事件发生时间研究中同时考虑每个受试者的多个因素，也无法控制混杂因素</li><li id="f337" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">假设删截和存活之间是独立的，这意味着在时间【that，那些已经删截的人应该和那些没有删截的人有相同的预后。</li><li id="b2ce" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">因为它是一个非参数模型，在底层数据分布已知的问题上，它不如竞争技术有效或准确</li></ul><h1 id="12ba" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">现在自己试试吧！</h1><p id="efea" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">要查看我是如何制作这个卡普兰-迈耶图的，并开始你自己的生存分析，从我的 Github 账户下载<a class="ae la" href="https://github.com/loldja/loldja.github.io/blob/master/assets/code/blog/Kaplan%20Meier%20demo.ipynb" rel="noopener ugc nofollow" target="_blank"> jupyter 笔记本</a>。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="4695" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae la" href="http://laurenoldja.net" rel="noopener ugc nofollow" target="_blank"> <em class="kz"> Lauren Oldja </em> </a> <em class="kz">是纽约布鲁克林的一名数据科学家。</em></p></div></div>    
</body>
</html>