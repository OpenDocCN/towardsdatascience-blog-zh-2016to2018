<html>
<head>
<title>DC Bikeshare: Where do they all go?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DC:他们都去哪里了？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dc-bikeshare-where-do-they-all-go-41f36baabcd9?source=collection_archive---------3-----------------------#2017-03-12">https://towardsdatascience.com/dc-bikeshare-where-do-they-all-go-41f36baabcd9?source=collection_archive---------3-----------------------#2017-03-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aff8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">与R一起寻找310万次骑行的罗盘方位</h2></div><p id="4084" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几周前，我写了一篇关于人们使用DC自行车共享服务的文章，我仍然对这些数据感到好奇。热图的结果是显而易见的:在早上和下午的高峰时段，乘车人数激增。写完帖子后，我开始思考每一次旅行的方向，以及这些旅行在一天中的每个小时分手的方向。警告:了解DC的地理位置将有助于理解这篇文章。</p><p id="2760" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于自行车共享数据有无数的事情要做(并且已经被做了),但是我从来没有见过它和我想象的一样。在我的脑海中，我看到了上午前往杜邦公司办公室、法拉古广场和K街地区的自行车流，然后在下午前往周围的街区。</p><p id="20a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我想回答两个问题:</p><ol class=""><li id="7956" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la lh li lj lk bi translated">对于一天中的每个小时，自行车共享用户的平均去向是什么？</li><li id="442e" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">对于几个选定的站点，自行车共享用户通常每小时去哪个方向？</li></ol><h1 id="af24" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated"><strong class="ak">数据准备</strong></h1><p id="a151" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">数据集需要一些调整才能成形。首先，我删除了在同一个车站开始和结束的乘车。有113，167个观察被删除，因为我不认为它们是真正的乘坐。接下来，我需要添加每次骑行的起点和终点的GPS坐标。最后，我需要计算从起点到终点的方位。</p><p id="c41d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个自行车共享点的纬度和经度都要感谢<a class="ae lb" href="http://opendata.dc.gov/datasets/a1f7acf65795451d89f0a38565a975b3_5?uiTab=table" rel="noopener ugc nofollow" target="_blank">区交通局</a>。然后，我总结了这个大型数据集，向我展示了每个小时的平均起点和终点。和往常一样，<a class="ae lb" href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html" rel="noopener ugc nofollow" target="_blank"> dplyr库</a>在这里是个救星。为了最终得到我想要的可视化效果，我需要两个数据集(一个接一个的骑行和一个接一个的小时),就像这篇文章后面解释的那样。</p><p id="c5e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了两个数据集中的开始和结束GPS坐标，通过我从<a class="ae lb" href="https://cran.r-project.org/web/packages/fossil/fossil.pdf" rel="noopener ugc nofollow" target="_blank"> fossil包</a>中提取的一个函数，计算每个观测的方位就很简单了。我不是地理空间分析方面的专家，所以这省去了我一些大麻烦。</p><p id="80b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，要找到所有这些乘坐的平均方位，我不能简单地取每个观察方位的平均值。罗盘方位在0到359.9度之间。想象一个指南针，其北0度，东90度，南180度，西270度。例如，假设大多数游乐设施通常是向北行驶的。轴承将是350至360度和0至10度的组合。这些乘坐的平均值将是大约180度(南方)，并给我们准确的错误答案(数学版本:350度乘坐和10度乘坐的平均值将是(350 + 10) / 2 = 180)。因此，我必须找到每小时的平均起点坐标和平均终点坐标，然后计算这条路线的方位。</p><p id="6785" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里的一张表格中，无聊地呈现了每小时DC自行车共享出行的平均方位。为了美好的事物…</p><h1 id="0b52" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated"><strong class="ak">可视化自行车方向</strong></h1><p id="d680" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">是时候策划了！为了实现我想象的可视化，我需要使用两个数据集，完整的310万个观察数据集和逐小时数据集。第一个数据集将显示来自所有单独乘坐的方向喷雾，第二个数据集将显示该小时块中平均乘坐的方位。</p><p id="925f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的脑海中，我看到一个指南针，背景中所有的游乐设施都是透明的，一个箭头根据小时和平均方向从左向右摆动。<a class="ae lb" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwjmxazN69HSAhVBvJAKHehWDMsQFggbMAA&amp;url=http%3A%2F%2Fdocs.ggplot2.org%2F&amp;usg=AFQjCNENXr1noqouLiE37qbZurgHz0PriA&amp;sig2=AfEUhgwBlnJ8GxTBIsOB7Q" rel="noopener ugc nofollow" target="_blank"> ggplot包</a>有一个<a class="ae lb" href="http://docs.ggplot2.org/current/coord_polar.html" rel="noopener ugc nofollow" target="_blank"> coord_polar函数</a>将直方图转换成圆形图。在修改了主题之后，我能够让它看起来像一个指南针！</p><p id="768f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我为每张图表创建了24张图片，每张图片代表一天中的一个小时，然后把它们放入GIF制作机中，瞧！</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/f09273d2b7392637c82f3d0d85ef1af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*lUikgdcSSBp9-LyA2iPSMQ.gif"/></div></div></figure><p id="be7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">gif上的一些注释:</p><ul class=""><li id="84db" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la mz li lj lk bi translated">灰色条代表那个小时在那个方向乘坐的次数。最长长度代表该小时在该方向上的最大乘坐量。因此，您无法比较一个小时与下一个小时的条形高度。我插入了那个小时乘坐的次数来提供一些背景。</li><li id="cb43" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la mz li lj lk bi translated">这张GIF不以任何方式代表每次乘坐的距离。只是方向。</li></ul><h1 id="6df6" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">车站gif</h1><p id="4bfa" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我决定分解上面的GIF，看看骑行一站一站地走向哪里。我选择它们是基于它们在DC的位置(还有一个在芒特普莱森特，因为我曾经住在那里)。</p><div class="mo mp mq mr gt ab cb"><figure class="na ms nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/a617273379211f7b190413afeb762664.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*2E-M7xy5kzaKu4NO6xRCwQ.gif"/></div></figure><figure class="na ms nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/8d22d587a114086ec1cd1031a9fcf8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*tlzGfMoRMncwRVtK6qkWPw.gif"/></div></figure><figure class="na ms nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/58d079d897375affa229b4f9edc0a034.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*_tv0xENI88ZUrWfT7-nXqw.gif"/></div></figure></div><div class="ab cb"><figure class="na ms nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/33ab16c3da9791719aaf813b5a06d405.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*-TNr8Nko7WCIId-OYa7qvA.gif"/></div></figure><figure class="na ms nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/b355fa547839962485f2142e77734a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*m2H_SaldAf7VSm8nBK6WGA.gif"/></div></figure><figure class="na ms nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><img src="../Images/5896f12f54c1792b156cdb040c6da90f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*4GNWP-vmTgrN9akIcGimaA.gif"/></div></figure></div><p id="5387" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你所看到的，根据车站在DC的位置，大多数乘坐的方向可能会有很大的不同。同样，这在直觉上是有意义的。如果你从DC的东边开始，你可能会向西走，因为那个方向有更多的活动，有更多的车站可以停靠你的自行车。</p><p id="2f0d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还注意到有很多游乐设施直接向西、向东或向南行驶。由于DC是一个网格城市，似乎许多自行车骑行开始和结束在同一条街上。这是有道理的。这也是有道理的，某些车站，如联合车站，主要是向西(K街，杜邦等)的方向。).</p><p id="246e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我有几个理由来解释为什么正北不是一个常见的方位。首先，我删除了所有在同一个车站开始和结束的乘车。这些飞行会产生0度的方位，或者直接指向北方。然而，应该仍然有直接向北行驶的游乐设施，比如说沿第14街西北方向。我的理论是，你越往北走，就越容易上坡。作为重型自行车，上坡骑并不流行。</p><h1 id="4b80" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">结论和后续步骤</h1><p id="e9c6" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">看一下自行车共享站的地图(以及整个DC的地图)，大多数的站和人都在西北方向。从西北方向去上班，你通常会往南走。要回家，你通常会向北走。</p><p id="a389" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再往深里看，另一个帖子的成因，除了方位，我还想看每一次乘坐距离每一站的距离。这将把我带到<a class="ae lb" href="https://cran.r-project.org/web/packages/ggmap/ggmap.pdf" rel="noopener ugc nofollow" target="_blank"> ggmap包</a>，我刚刚开始修补它。</p><p id="bae4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一如既往，我很想听听你的想法。如果你认为我错过了一个很棒的电视台，给我一声，我很乐意去看看。或者如果你想看看你当地的车站，我也可以帮你！</p><p id="d888" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码可在我的<a class="ae lb" href="https://github.com/AlexJF12/DC-Bikeshare" rel="noopener ugc nofollow" target="_blank"> GitHub repo这里</a>(寻找<a class="ae lb" href="https://github.com/AlexJF12/DC-Bikeshare/blob/master/dc%20bikeshare%20direction.R" rel="noopener ugc nofollow" target="_blank"> dc bikeshare方向。R </a>和<a class="ae lb" href="https://github.com/AlexJF12/DC-Bikeshare/blob/master/station%20bearing%20gif%20function.R" rel="noopener ugc nofollow" target="_blank">站承载gif功能。R </a>)。</p></div></div>    
</body>
</html>