<html>
<head>
<title>Graphs and ML: Linear Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图形和 ML:线性回归</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/graphs-and-linear-regression-734d1446e9cd?source=collection_archive---------5-----------------------#2018-06-28">https://towardsdatascience.com/graphs-and-linear-regression-734d1446e9cd?source=collection_archive---------5-----------------------#2018-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="60fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">为了启动机器学习的一系列 Neo4j 扩展，我实现了一组</em> <a class="ae km" href="https://neo4j.com/docs/developer-manual/current/extending-neo4j/procedures/#user-defined-procedures" rel="noopener ugc nofollow" target="_blank"> <em class="kl">用户定义的过程</em> </a> <em class="kl">，在图形数据库中创建线性回归模型。在这篇文章中，我演示了在 Neo4j 浏览器中使用线性回归来建议德克萨斯州奥斯汀的短期租赁价格。让我们来看看用例:</em></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/dd8c610ab139c10b732696cfb4741cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qurMKJp7X_lVCuji.jpg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo from Yelp user Benigno A. (<a class="ae km" href="https://www.yelp.com/user_details?userid=GS2R_auCwoSzfQccLJIY6Q" rel="noopener ugc nofollow" target="_blank">https://www.yelp.com/user_details?userid=GS2R_auCwoSzfQccLJIY6Q</a>)</figcaption></figure><p id="7c12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">德克萨斯州奥斯汀最受欢迎的地区是通过邮政编码的最后两位数字“04”来识别的。这里有最时尚的俱乐部、餐馆、商店和公园，“04”是游客经常去的地方。假设你是一个将要去度假的奥斯汀当地人。你想趁你不在的时候，通过出租你的房子来利用你的邻居的声望。然而，你在每晚收费多少上有点卡住了。</p><p id="c2d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://github.com/johnymontana/neo4j-listings/blob/master/Neo4j%20Short%20Term%20Rental%20Listings.ipynb" rel="noopener ugc nofollow" target="_blank">此处</a> William Lyon 使用 Neo4j 对德克萨斯州奥斯汀的现有短期房屋租赁进行建模。除了每晚的价格，每个<code class="fe ld le lf lg b">Listing</code>节点还包含诸如卧室数量、浴室数量、容纳的客人数量和可用性等属性。你家有四间卧室，两间浴室，可以住五个客人。我们如何使用存储在 Will 图表中的住房数据来为您的列表预测合适的每夜房价？</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lh"><img src="../Images/22738c3069253a0681f3df56fc836ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wz92mFJiQ2hIUwpn-yvBuw.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Will’s data model demonstrates that the data set is well suited for Neo4j</figcaption></figure><p id="cc12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须以某种方式量化<em class="kl">未知变量</em>(价格)和<em class="kl">已知变量</em>(卧室、浴室和可容纳的客人数量)之间的关系。住房市场中的许多价格预测者使用房间总数来预测住房价格。他们假设价格和房间数量之间的关系是线性的。我们将把这一理念扩展到短期租赁市场。<em class="kl">线性回归</em>是一种用于分析变量之间关系的工具，在这里，它可以用于量化每晚租金与列表中总房间数之间的关系。</p><h1 id="dab2" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">一些背景:</strong></h1><p id="d406" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">回归是建模两个变量之间关系的线性方法。<strong class="jp ir">因变量</strong>、<em class="kl"> y </em>，是我们希望预测的数量(在本例中是租赁价格)。我们使用<strong class="jp ir">独立</strong>变量的已知值，“<em class="kl"> x </em>”来预测因变量。简单线性回归的目标是创建一个以自变量为输入并输出因变量预测值的函数。记得代数课吗？由于模型是一条线，所以以<code class="fe ld le lf lg b"><em class="kl">y</em> = <strong class="jp ir">a</strong> + <strong class="jp ir">b</strong>*<em class="kl">x</em> </code>的形式写出来，可以让它用两个参数唯一表示:<br/>斜率(<strong class="jp ir"> b </strong>)和截距(<strong class="jp ir"> a </strong>)。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/e23d0b241b070079c0cfa7e57b390ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*sOXq3-HRw5Mlr9jB.png"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk"><a class="ae km" href="https://en.wikipedia.org/wiki/Linear_regression" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Linear_regression</a></figcaption></figure><p id="d38c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目测有几个(<em class="kl"> x </em>，<em class="kl"> y </em>)数据点的图。简单的线性回归找出通过点的直线，这些点与数据最“符合”。为了确定最佳拟合线，我们使用最小二乘法的<a class="ae km" href="http://mathworld.wolfram.com/LeastSquaresFitting.html" rel="noopener ugc nofollow" target="_blank">方法找到系数<strong class="jp ir"> a </strong>和<strong class="jp ir"> b </strong>，这些系数根据线性模型<code class="fe ld le lf lg b"><em class="kl">y</em> = <strong class="jp ir">a</strong> + <strong class="jp ir">b</strong>*<em class="kl">x</em></code>最小化每个观察值的<strong class="jp ir">实际</strong> <em class="kl"> y </em>值与其<strong class="jp ir">预测</strong> <em class="kl"> y </em>值之间的平方差之和。</a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mm"><img src="../Images/300bb723cb537f2132cda34546f255b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDPJDEOQD7UWR73Ml2xEcg.png"/></div></div></figure><p id="9929" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有几种测量方法试图量化模型的成功，或它与数据的“拟合”程度。例如，<em class="kl">决定系数(R ) </em>是从自变量中可预测的因变量方差的比例。系数 R = 1 表示因变量的方差完全可以从自变量中预测出来(因此模型是完美的)。</p><p id="a636" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">线性回归是统计学中最流行的工具之一，它经常被用作机器学习的预测器。</p><h1 id="e791" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">等等，这是图的问题吗？</h1><p id="7097" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">最小二乘法可以追溯到 19 世纪早期。它不依赖于数据可能存储在图中的事实。如果不是图形问题，为什么要在 Neo4j 中实现线性回归？因为在我们的例子中，我们感兴趣的数据已经存在于一个图表中了！</p><p id="0ad2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图表是租赁数据模型的合理选择，因为短期租赁数据固有的关联特性，建模为<br/> <code class="fe ld le lf lg b">(:User)-[:WRITES]-&gt;(:Review)-[:REVIEWS]-&gt;(:Listing)</code> <br/>以及列表、用户和评论的持续更新。线性回归可能不是图的问题，但数据集总体上肯定是。价格预测只是我们想要做的整体分析的一部分。在 Neo4j 中实现回归程序可以让我们避免将数据导出到另一个软件中的麻烦。通过这种方式，我们可以利用图形数据库的独特功能，同时也不会忘记更传统的统计方法，如线性回归。我们还创建了另一个构建模块，用于在我们的图形数据上运行更复杂的分析管道。</p><p id="ff28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于这些<a class="ae km" href="https://neo4j.com/docs/developer-manual/current/extending-neo4j/procedures/#user-defined-procedures" rel="noopener ugc nofollow" target="_blank">用户自定义过程</a>的实现细节，请查看我的<a class="ae km" href="https://medium.com/@lauren.shin/a-developers-look-ml-models-in-neo4j-7d4cbacb320c" rel="noopener">下一篇文章</a>。在这里，我们将在创建过程之后进行分析。</p><h1 id="4fc4" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">我们开始吧</h1><h2 id="46f9" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">安装程序</h2><p id="3695" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">在<a class="ae km" href="https://neo4j.com/download/" rel="noopener ugc nofollow" target="_blank"> Neo4j 桌面</a>中创建项目和数据库。从最新的<a class="ae km" href="https://github.com/neo4j-graph-analytics/ml-models/releases/latest" rel="noopener ugc nofollow" target="_blank">线性回归版本</a>下载 jar 文件。将 JAR 文件放到数据库的 plugins 文件夹中。将<code class="fe ld le lf lg b">regression</code>包的内容添加到<em class="kl">管理- &gt;设置</em>底部的已识别程序中。如果你已经安装了<a class="ae km" href="https://neo4j-contrib.github.io/neo4j-apoc-procedures/" rel="noopener ugc nofollow" target="_blank"> APOC </a>和<a class="ae km" href="https://neo4j.com/developer/graph-algorithms/" rel="noopener ugc nofollow" target="_blank">图形算法</a>，它看起来会像这样:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="e70b" class="mn lj iq lg b gy nl nm l nn no">dbms.security.procedures.whitelist=algo.*,apoc.*,regression.*</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi np"><img src="../Images/3b293fb1e01c9ca9eb54d22a2615a727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1TIh8WbtihySyY5bqGVUXA.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">How to add to a Neo4j Desktop Database</figcaption></figure><p id="3601" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新启动数据库。奔跑</p><p id="c1a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ld le lf lg b">CALL dbms.procedures() YIELD name WHERE name CONTAINS 'regr' RETURN *</code></p><p id="9220" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查<code class="fe ld le lf lg b">regression.linear.*</code>程序是否可以使用。</p><h2 id="9f90" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">导入数据</h2><p id="5768" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">打开 Neo4j 浏览器。从 Neo4j 浏览器运行<code class="fe ld le lf lg b">:play http://guides.neo4j.com/listings</code>,按照导入查询创建威尔的短期租赁列表。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/75338fd75077a3d3d74a5f8d132ce9da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ga3W4R87hlKE0CJ5"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Neo4j Browser Guide (Slides) for the Rental Listings</figcaption></figure><h2 id="23f0" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">添加我们的列表</h2><p id="ba63" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">创建一个新的<code class="fe ld le lf lg b">Listing</code>节点，代表我们希望添加到“04”短期租赁市场的房屋。在图中，每个<code class="fe ld le lf lg b">Neighborhood</code>都可以通过存储在属性<code class="fe ld le lf lg b">neighborhood_id</code>中的邮政编码来识别。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="5786" class="mn lj iq lg b gy nl nm l nn no">MATCH (hood:Neighborhood {neighborhood_id:'78704'})<br/>CREATE (list:Listing <br/>      {listing_id:'12345', bedrooms:4, bathrooms:2, accommodates:5}) <br/>MERGE (list)-[:IN_NEIGHBORHOOD]-&gt;(hood)</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/0c230b9a8dee7618a81d354ee4514010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D5r83nnvM1JuEoLy"/></div></div></figure><h2 id="fe4f" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">分割训练和测试数据</h2><p id="2981" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">我们应该使用哪个房屋数据子集来创建模型？房价因位置而异，所以让我们只使用位于“04”附近的列表来创建一个模型。列表节点包含<code class="fe ld le lf lg b">bedrooms</code>和<code class="fe ld le lf lg b">bathrooms</code>属性，所以我们将这两个值的和作为房间总数的近似值。因此，我们的数据集是“04”邻域中具有有效的<code class="fe ld le lf lg b">price</code>、<code class="fe ld le lf lg b">bedrooms</code>和<code class="fe ld le lf lg b">bathrooms</code>属性的所有列表。</p><p id="78f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用整个数据集来训练模型，但这样我们就无法在看不见的数据上测试模型的性能。因此，我们将数据集分成 75:25(训练:测试)的样本。从所有合格的列表节点中收集节点 id，并使用<code class="fe ld le lf lg b">regression.linear.split</code>函数随机选择 75%的数据集。用<code class="fe ld le lf lg b">Train</code>标记这个子集。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="c228" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing)-[:IN_NEIGHBORHOOD]-&gt;(:Neighborhood {neighborhood_id:'78704'}) <br/>WHERE exists(list.bedrooms) AND exists(list.bathrooms)<br/>AND exists(list.price) <br/>WITH regression.linear.split(collect(id(list)), 0.75) AS trainingIDs<br/>MATCH (list:Listing) WHERE id(list) in trainingIDs <br/>SET list:Train</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/ab9d4da3c2856b484c2d7595baac81f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m8KQhKE52FH4wmZt"/></div></div></figure><p id="bcc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<code class="fe ld le lf lg b">:Test</code>标签添加到数据集中剩余的列表节点。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="f8e8" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing)-[n:IN_NEIGHBORHOOD]-&gt;(hood:Neighborhood {neighborhood_id:'78704'})<br/>WHERE exists(list.bedrooms) AND exists(list.bathrooms)<br/>AND exists(list.price) AND NOT list:Train SET list:Test</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/2ff03624c64b79f722799960711c88ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qu4KJkYmwNnBaE2d"/></div></div></figure><h2 id="a71e" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">初始化模型</h2><p id="1486" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">查看我们的<code class="fe ld le lf lg b">create</code>程序，它有这样的签名:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="cdef" class="mn lj iq lg b gy nl nm l nn no">create('model-name', 'model-type' = 'Simple',<br/>       constantTerm? = true, noOfIndependentVars = 1)</span></pre><p id="7411" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了给将来使用相同的<code class="fe ld le lf lg b">create</code>程序实施多元线性回归创造灵活性，您必须输入模型类型<code class="fe ld le lf lg b">'Simple'</code>。create 过程还将模型是否应该包含常数项和独立变量的数量作为参数。这些默认设置分别等于<code class="fe ld le lf lg b">true</code>和<code class="fe ld le lf lg b">1</code>。如果您知道您的数据在其整个域<strong class="jp ir"/><em class="kl">上遵循一个<em class="kl">线性关系，并且<em class="kl">必须经过原点</em>，则仅使用<code class="fe ld le lf lg b">false</code>排除常数项。</em></em></p><p id="77af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ld le lf lg b">CALL regression.linear.create('rental prices', 'Simple', true, 1)</code></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/9b22be129f0a3d05d1ecab926eaf4792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yIhq3TMppEMmBWVO"/></div></div></figure><h2 id="bce8" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">添加培训数据</h2><p id="ab0d" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">找到所有标有<code class="fe ld le lf lg b">Train</code>的<code class="fe ld le lf lg b">Listing</code>节点，添加每个对应的(<code class="fe ld le lf lg b">bedrooms</code>、<code class="fe ld le lf lg b">price</code>)数据点。如果我们不小心多次添加来自同一个列表的数据，我们的模型将会不太准确。作为额外的预防措施，让我们用标签<code class="fe ld le lf lg b">Seen</code>来标记<code class="fe ld le lf lg b">Listing</code>节点，以表明训练数据已经被添加到模型中:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="c936" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing:Train) WHERE NOT list:Seen <br/>CALL regression.linear.add('rental prices',<br/>     [list.bedrooms+list.bathrooms], list.price) <br/>SET list:Seen</span></pre><blockquote class="nr ns nt"><p id="d7cb" class="jn jo kl jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">注意，<code class="fe ld le lf lg b">regression.linear.add</code>程序采用<code class="fe ld le lf lg b">List&lt;Double&gt;</code>类型的独立变量，即使这是简单的线性回归。这保留了将来创建多元线性回归(具有多个独立变量)并继续使用相同程序的灵活性。</p></blockquote><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/c746a7380195ae4da95454dd08cd6b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3-u522Rplp8Qcdu5"/></div></div></figure><h2 id="433d" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">检查模型</h2><p id="2453" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">注意<em class="kl">在</em>的任何一点，你都可以调用<code class="fe ld le lf lg b">info</code>程序。它将总是返回关于模型的信息流，并且如果模型的状态表明这些字段是有效的，它将使用关于训练和测试数据的统计来填充<code class="fe ld le lf lg b">trainInfo</code>和<code class="fe ld le lf lg b">testInfo</code>映射。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="a8e4" class="mn lj iq lg b gy nl nm l nn no">CALL regression.linear.info('rental prices')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/d2bbe011a74b5152c757ece435940234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jfOQvkRmD-ZZWPTV"/></div></div></figure><h1 id="64a5" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">添加测试数据</h1><p id="1878" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">既然我们已经训练了模型，我们需要在看不见的数据上测试它的性能。添加测试数据:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="ab25" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing:Test) WHERE NOT list:Seen <br/>CALL regression.linear.add('rental prices', <br/>               [list.bedrooms + list.bathrooms], list.price, <strong class="lg ir">'test'</strong>) <br/>SET list:Seen</span></pre><blockquote class="nr ns nt"><p id="4266" class="jn jo kl jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">注意，为了添加测试数据，我们使用相同的<code class="fe ld le lf lg b">add</code>过程，但是将数据类型(采用默认值<code class="fe ld le lf lg b">'train'</code>)设置为<code class="fe ld le lf lg b">'test'</code>。</p></blockquote><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/3ec10fe82b1d1e34edf07dc7e2955948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OMfGbMozKIiQYex_"/></div></div></figure><h1 id="1b16" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">执行测试计算</h1><p id="74a7" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">一旦我们最终确定了测试数据，调用<code class="fe ld le lf lg b">test</code>程序来分析模型。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="ede5" class="mn lj iq lg b gy nl nm l nn no">CALL regression.linear.test('rental prices')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/a66cb1e1a01f4a4eb295e722be8ef0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sS_DnA6LCc--UZJv"/></div></div></figure><p id="6bf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，<strong class="jp ir">训练</strong> R = 0.363，<strong class="jp ir">测试</strong> R = 0.456。该模型预测测试数据中出现的方差比训练中出现的方差比例更大！虽然这两个值都比我们希望的要低一点(理想情况下，R 为 0.6 或更大)，但这些数字表明模型在看不见的数据上表现相似。为了直观的理解，您可以看到测试数据比训练数据更接近趋势线。这是因为采样的测试数据点较少:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nx"><img src="../Images/68c6085326e58077ae0e8039bf3acbaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WYvGysi2pVZQfLXn"/></div></div></figure><h1 id="41a6" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">做出并存储预测</h1><p id="c32f" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">这些线性回归过程是用来自<a class="ae km" href="http://commons.apache.org/proper/commons-math/javadocs/api-3.3/org/apache/commons/math3/stat/regression/SimpleRegression.html" rel="noopener ugc nofollow" target="_blank"> Commons Math </a>库的<code class="fe ld le lf lg b">SimpleRegression</code>构建的。虽然过程<code class="fe ld le lf lg b">regression.linear.train</code>确实存在，并且将用于具有多个独立变量的未来线性模型，但是对于简单回归，不需要调用<code class="fe ld le lf lg b">train</code>过程(如果调用，它将只返回关于模型的信息)。只要模型中有两个或更多数据点，模型就能够做出预测<em class="kl">。作为用户，您可以决定是否在进行预测之前对模型进行测试。</em></p><p id="4230" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们已经测试了模型，我们可以做出明智的价格预测。我们可以使用用户定义的<strong class="jp ir">函数</strong> <code class="fe ld le lf lg b">regression.linear.predict</code>来预测您在“04”中列出的 4 卧室、2 浴室(总共大约 6 个房间)的价格:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="e510" class="mn lj iq lg b gy nl nm l nn no">RETURN regression.linear.predict('rental prices', [6])</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/61e976487ee9e7f1c601b0603c561aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lNZmp22-pTKQ6tRP"/></div></div></figure><p id="d7e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者在图表中为每个价格未知的“04”列表进行预测并存储预测:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="509d" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing)-[:IN_NEIGHBORHOOD]-&gt;<br/>      (:Neighborhood {neighborhood_id:'78704'})<br/>WHERE exists(list.bedrooms)and exists(list.bathrooms) <br/>  AND <strong class="lg ir">NOT exists(list.price)</strong></span><span id="a3f8" class="mn lj iq lg b gy ny nm l nn no">WITH list, list.bedrooms + list.bathrooms as rooms<br/>SET list.predicted_price = <br/>  regression.linear.predict('rental prices', [rooms])<br/>RETURN DISTINCT rooms, list.predicted_price AS predictedPrice <br/>ORDER BY rooms</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/86bbaa85d828e79afd1e6a0c5ea174bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bA_35fKy4HsfHO5V"/></div></div></figure><p id="5530" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，所有“04”列表都存储了推荐价格，可以提供给主机，以帮助他们做出明智的价格选择。</p><h1 id="bfed" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">编辑测试/培训数据</h1><p id="0624" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">我们对数据集一无所知，只知道所有列表都位于“04”中，并且包含有效的<code class="fe ld le lf lg b">bedrooms</code>、<code class="fe ld le lf lg b">bathrooms</code>和<code class="fe ld le lf lg b">price</code>数据。让我们通过排除不受欢迎的列表来改进我们的模型。我们将只列出属于<code class="fe ld le lf lg b">(:Review)-[:REVIEWS]-&gt;(:Listing)</code>关系的数据点，这表明该列表至少有一个审查。希望这将消除来自新上市房源的数据(潜在的不可靠定价)。</p><p id="68d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，通过<strong class="jp ir">从“租赁价格”模型中复制培训数据</strong>来创建一个新模型。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="bf67" class="mn lj iq lg b gy nl nm l nn no">CALL regression.linear.create('popular rental prices', 'Simple')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/d3f41b9f56fa7d8fd4db537d828ac1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sz1zPQ5SP_9495T5"/></div></div></figure><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="bb70" class="mn lj iq lg b gy nl nm l nn no">CALL regression.linear.copy('rental prices', <br/>                            'popular rental prices')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/11407c22014383b4d5fd4b8b7a6fb124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sOH37B2ZHnU2XAbh"/></div></div></figure><p id="3f9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后通过从没有评论的列表中删除数据来编辑模型。</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="4730" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing:Train) <br/>WHERE <strong class="lg ir">NOT (:Review)-[:REVIEWS]-&gt;(list)</strong> <br/>CALL regression.linear.<strong class="lg ir">remove</strong>('popular rental prices',  <br/>       [list.bedrooms+list.bathrooms], list.price) <br/>REMOVE list:Train, list:Seen</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/3be3f4a64cdb432efcbaa3299e386c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TgmP2swaE3ccDjP8"/></div></div></figure><p id="227b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们必须从没有审查的列表中删除测试数据。随着测试数据被添加到模型中，使用在训练期间创建的模型参数来执行计算。因此，如果任何训练数据被更新，则模型改变，并且所有测试计算无效。更改训练数据会自动使测试数据无效。因此，我们必须从没有评论的列表中删除<code class="fe ld le lf lg b">Test</code>标签，然后重新添加所有剩余的测试数据。</p><blockquote class="nr ns nt"><p id="25dd" class="jn jo kl jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">请注意，如果在模型测试期间，您希望更新测试数据，您可以调用<code class="fe ld le lf lg b">regression.linear.add</code>或<code class="fe ld le lf lg b">regression.linear.remove</code>而无需重新添加所有测试数据。只要<strong class="jp ir">训练数据</strong>保持不变，这就会起作用。</p></blockquote><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="505c" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing:Test) WHERE NOT (:Review)-[:REVIEWS]-&gt;(list) REMOVE list:Test</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/17b3d8da9c1d1d556954459808446761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DE-QRQXdWJCmvmlr"/></div></div></figure><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="821f" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing:Test) <br/>CALL regression.linear.add('popular rental prices', <br/>              [list.bedrooms + list.bathrooms], list.price, 'test') <br/>RETURN count(list)</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/409dc18485635b25773c85bfc649ae6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xbaEcfKwN1newPWe"/></div></div></figure><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="2231" class="mn lj iq lg b gy nl nm l nn no">CALL regression.linear.test('popular rental prices')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/592642bae012d7c5815a2443698afaf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ETh5FJkCr48P3tsY"/></div></div></figure><p id="102a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇，消除“不受欢迎”的列表数据提高了我们模型的拟合度！现在，训练 R = 0.500，测试 R = 0.561。两者都增加了，而且测试 R 再次高于训练。这表明我们的模型更好地解释了价格数据中的差异，并在看不见的数据上表现良好。让我们更新图表中的预测价格:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="06be" class="mn lj iq lg b gy nl nm l nn no">MATCH (list:Listing)-[:IN_NEIGHBORHOOD]-&gt;<br/>      (:Neighborhood {neighborhood_id:’78704'})<br/>WHERE exists(list.bedrooms)and exists(list.bathrooms) <br/>      AND NOT exists(list.price)</span><span id="496c" class="mn lj iq lg b gy ny nm l nn no">WITH list, list.bedrooms + list.bathrooms AS rooms<br/>SET list.predicted_price = <br/>      regression.linear.predict('popular rental prices', [rooms])</span><span id="b056" class="mn lj iq lg b gy ny nm l nn no">RETURN DISTINCT rooms, list.predicted_price AS predictedPrice <br/>ORDER BY rooms</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/d8ce2048db5f8d6f6a902eb75797c589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2NNIJSMOl0FIgkKE"/></div></div></figure><h2 id="f727" class="mn lj iq bd lk mo mp dn lo mq mr dp ls jy ms mt lw kc mu mv ma kg mw mx me my bi translated">存储、删除和重新加载模型</h2><p id="92f0" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">我们完成了今天的分析！让我们保存刚刚创建的模型。<code class="fe ld le lf lg b">SimpleRegression</code>的每个命名实例都作为静态变量存储在用户定义的过程中。只要数据库关闭，这些变量就会被清除。确保在关闭数据库之前，您存储了您想要在图中或外部保留的任何模型的序列化版本:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="9a9b" class="mn lj iq lg b gy nl nm l nn no">MERGE (m:ModelNode {model: 'popular rental prices'})<br/>SET m.data = regression.linear.data('popular rental prices')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/6b16fe0bbb6d19e8fd9cd43a0b557297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*runkEw3yfgUIRitB"/></div></div></figure><p id="e2fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">删除模型:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="c805" class="mn lj iq lg b gy nl nm l nn no">CALL regression.linear.delete('popular rental prices')</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/c1a9372362144ab9fe6dcfc3ae52da6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OoqS-sPCbtgclWAZ"/></div></div></figure><p id="f189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您重新启动数据库时，将模型从图中加载回过程中:</p><pre class="ko kp kq kr gt nh lg ni nj aw nk bi"><span id="71e4" class="mn lj iq lg b gy nl nm l nn no">MATCH (m:ModelNode {model: 'popular rental prices'})<br/>CALL regression.linear.load(m.model, m.data, 'Simple')<br/>YIELD model, framework, hasConstant, numVars, state, nTrain, nTest, trainInfo, testInfo<br/>RETURN *</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nq"><img src="../Images/e27737e7ce59d70d335f7dcab6207fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hwMlS7I8uv3GWNOV"/></div></div></figure><p id="5e7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，模型已经准备好进行额外的数据更改、测试和预测了！注意，新加载的简单回归不包含任何测试数据。</p><h1 id="f6c9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">附加功能</h1><p id="a0ea" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">请注意，以下程序存在，但不在本文讨论范围内:</p><ul class=""><li id="8d8e" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated"><code class="fe ld le lf lg b">regression.linear.clear</code>-默认情况下清除模型中的所有数据，或者只清除带有附加参数的测试数据<code class="fe ld le lf lg b">'test'</code></li><li id="35d7" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated"><code class="fe ld le lf lg b">regression.linear.addM</code>-从输入/输出数据列表中添加相应的数据点。如果从外部来源(如 CSV 文件)添加数据，会很有帮助</li><li id="2a56" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated"><code class="fe ld le lf lg b">regression.linear.removeM</code>-从输入/输出数据列表中删除相应的数据点</li></ul></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><blockquote class="nr ns nt"><p id="602b" class="jn jo kl jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">有问题吗？评论？你是更新测试数据回归平方和(SSR)计算公式的专家吗(我需要一些帮助)？请联系<a class="ae km" href="https://www.linkedin.com/in/laurenshin/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae km" href="https://twitter.com/ML_auren" rel="noopener ugc nofollow" target="_blank"> @ML_auren </a></p><p id="c1a0" class="jn jo kl jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">特别感谢格蕾丝·特诺里奥对这个项目的帮助。查看她的博客或在推特上与她交谈</p></blockquote></div></div>    
</body>
</html>