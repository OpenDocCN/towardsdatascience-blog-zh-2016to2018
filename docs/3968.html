<html>
<head>
<title>Recreating (more) data visualizations from the book “Knowledge is Beautiful”: Part III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从《知识是美丽的》一书中再现(更多)数据可视化:第三部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iii-5fd393b4c548?source=collection_archive---------6-----------------------#2018-07-05">https://towardsdatascience.com/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iii-5fd393b4c548?source=collection_archive---------6-----------------------#2018-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a4b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎来到本系列的第三部分，在第<code class="fe kl km kn ko b">R</code>部分，我重新创建了数据可视化，来自大卫·麦坎多斯的《知识是美丽的》一书<a class="ae kp" href="https://informationisbeautiful.net/2014/knowledge-is-beautiful/" rel="noopener ugc nofollow" target="_blank"><em class="kq"/></a>。</p><p id="2956" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该系列的第<a class="ae kp" rel="noopener" target="_blank" href="/recreating-data-visualizations-from-the-book-knowledge-is-beautiful-e455e7126071"> I </a>、<a class="ae kp" href="https://medium.com/@MattOldach_65321/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-ii-2f1d1da68e3a" rel="noopener"> II </a>、<a class="ae kp" rel="noopener" target="_blank" href="/recreating-more-data-visualizations-from-the-book-knowledge-is-beautiful-part-iv-686938a84c9e"> IV </a>部分的链接可在此处找到。</p><p id="7619" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据科学中的挫折有很多，例如:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d95a298546c2aaa206e6b01aae296303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OY88qBQvf5Ir5jPUl1K1GA.png"/></div></div></figure><p id="f683" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑上面的第 4 点。即使数据是可用的，它仍然可以以令人沮丧的格式分发。在本系列的第一部分中，我展示了如何使用<code class="fe kl km kn ko b">readxl</code>包访问特定的 excel 表格。在第二部分中，我展示了如何用<code class="fe kl km kn ko b">tabulizer</code>包解析 R 中的 PDF 表格。一些人可能会感兴趣，<a class="ae kp" href="https://twitter.com/LuisDVerde" rel="noopener ugc nofollow" target="_blank"> Luis D. Verde </a>最近发表了一篇关于<a class="ae kp" href="https://luisdva.github.io/rstats/excel-trivia/" rel="noopener ugc nofollow" target="_blank">如何在 R </a>中处理 Excel 中令人沮丧的单元格格式的伟大文章。</p><p id="0124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管 McCandless 公开了所有数据，但在制作可视化之前，我还是做了一些清理工作。我决定，既然这个系列的重点是数据可视化，我将把数据管理代码留在这个系列的其余部分，而是提供为<code class="fe kl km kn ko b">ggplot</code>准备好的<code class="fe kl km kn ko b">tidy</code>数据的<code class="fe kl km kn ko b">.csv</code>文件。</p><h1 id="8d26" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">长寿</h1><p id="1466" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">长寿可视化是一个发散的条形图，描绘了某些行为如何影响你的寿命。</p><pre class="ks kt ku kv gt mg ko mh mi aw mj bi"><span id="83c3" class="mk le iq ko b gy ml mm l mn mo">library(dplyr)<br/>library(ggplot2)</span><span id="73a6" class="mk le iq ko b gy mp mm l mn mo"># load the data<br/>livelong &lt;- read.csv("livelong.csv")</span><span id="de33" class="mk le iq ko b gy mp mm l mn mo"># Order by action<br/>livelong$action &lt;- factor(livelong$action, levels = c("Sleep too much", "Be optimistic", "Get promoted", "Live in a city", "Live in the country", "Eat less food", "Hang out with women - a lot!", "Drink a little alcohol", "Be conscientious", "Have more orgasms", "And a little red wine", "With close friends", "Be polygamous, maybe", "Go to church regularly", "Sit down", "More pets", "Eat red meat", "Avoid cancer", "Avoid heart disease", "Be alcoholic", "Get health checks", "Get married!", "Be rich", "Be a woman", "Suffer severe mental illness", "Become obese", "Keep smoking", "Live healthily", "Exercise more", "Live at high altitude"))</span><span id="7449" class="mk le iq ko b gy mp mm l mn mo"># Set legend title<br/>legend_title &lt;- "Strength of science"</span><span id="f022" class="mk le iq ko b gy mp mm l mn mo"># Make plot<br/>p &lt;- ggplot(livelong, aes(x = action, y = years, fill=strength)) +<br/>  geom_bar(stat = "identity") +<br/>  scale_fill_manual(legend_title, values = c("#8BC7AC","#D99E50","#CDAD35")) +<br/>  labs(title = "Live Long...", subtitle = "What will really extend your life?", caption = "Source: bit.ly/KIB_LiveLong") +<br/>  scale_y_continuous(position = "bottom") +<br/>  scale_x_discrete(limits = rev(factor(livelong$action))) +<br/>  #scale_x_reverse() +<br/>  coord_flip() +<br/>  theme(legend.position = "top",<br/>      panel.background = element_blank(),<br/>        plot.title = element_text(size = 13, <br/>                                  family = "Georgia", <br/>                                  face = "bold", lineheight = 1.2), plot.subtitle = element_text(size = 10,<br/>                                     family = "Georgia"), <br/>        plot.caption = element_text(size = 5,<br/>                                    hjust = 0.99, family = "Georgia"),  <br/>        axis.text = element_text(family = "Georgia"),<br/>      # Get rid of the y- and x-axis titles<br/>      axis.title.y=element_blank(),<br/>      axis.title.x=element_blank(),<br/>      # Get rid of axis text<br/>      axis.text.y = element_blank(),<br/>      axis.ticks.y = element_blank(),<br/>      legend.text = element_text(size = 8, family = "Georgia"),<br/>      legend.title = element_text(size = 8, family = "Georgia"),<br/>      legend.key.size = unit(1,"line"))</span></pre><p id="cf6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，这是第一次尝试用<code class="fe kl km kn ko b">geom_text()</code>做注释</p><pre class="ks kt ku kv gt mg ko mh mi aw mj bi"><span id="9e70" class="mk le iq ko b gy ml mm l mn mo">p + geom_text(aes(label = action), size = 3, family = "Georgia")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mq"><img src="../Images/b1d993c23d27ca58fdb5f88572317587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6wB1iQBdQfx2_OgGdDZDw.jpeg"/></div></div></figure><p id="7bf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">人们会立即注意到文本注释没有对齐。此外，由于条形图在中心(零)发散，修改<code class="fe kl km kn ko b">hjust</code>参数本身并不能解决问题。</p><p id="adf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个可能的解决方法是使用<code class="fe kl km kn ko b">ggfittext</code>包，它通过<code class="fe kl km kn ko b">geom_fit_text()</code>函数将文本约束在一个定义的区域内，该函数的工作方式与<code class="fe kl km kn ko b">ggplot2::geom_text()</code>差不多。</p><pre class="ks kt ku kv gt mg ko mh mi aw mj bi"><span id="4bbd" class="mk le iq ko b gy ml mm l mn mo"># currently only supported by the dev version<br/>devtools::install_github("wilkox/ggfittext")<br/>library(ggfittext)</span><span id="3b70" class="mk le iq ko b gy mp mm l mn mo">p + geom_fit_text(aes(label = action), position = "stack", family = "Georgia")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mr"><img src="../Images/ec086b46c7995a6b8b21fb7743d31f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ifbyTXHZcScjxly06cALsw.jpeg"/></div></div></figure><p id="612f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到小条没有被注释，因为字符串太大了，无法在条中显示。</p><p id="cf7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初的可视化从来不会将文本限制在条中，所以最好的方法是向表中添加一个变量，允许您左对齐一些标签，右对齐其他标签。</p><pre class="ks kt ku kv gt mg ko mh mi aw mj bi"><span id="156e" class="mk le iq ko b gy ml mm l mn mo"># Set postive as "Up" and negative numbers as "Down"<br/>livelong$direction &lt;- ifelse(livelong$years &gt; 0, "Up", "Down")</span><span id="d21a" class="mk le iq ko b gy mp mm l mn mo">livelong$just &lt;- ifelse(livelong$direction=="Down",0,1)</span><span id="93f6" class="mk le iq ko b gy mp mm l mn mo">p + geom_text(aes(label = action), size = 3, family = "Georgia", hjust=livelong$just)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mr"><img src="../Images/cebd49fa88f5ef2ef92d1ac2573ae8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1PyAOjEgo4jBYMvmg6APQ.jpeg"/></div></div></figure><p id="7d54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这证明了盒子的合理性，因此减少你寿命的行为是左调整的，而延长你寿命的行为是右调整的。唯一的问题是，在最初的可视化中，文本排列在图表的中心。我不知道如何做到这一点，所以加分，如果你能想出这一点，并张贴到评论！</p><p id="3be5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个视觉上吸引人的选择是把名字放在栏外。</p><pre class="ks kt ku kv gt mg ko mh mi aw mj bi"><span id="7580" class="mk le iq ko b gy ml mm l mn mo">livelong$just &lt;- ifelse(livelong$direction=="Up",0,1)</span><span id="16e3" class="mk le iq ko b gy mp mm l mn mo">p + geom_text(aes(label = action), size = 3, family = "Georgia", hjust=livelong$just)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ms"><img src="../Images/5b29655f9fdf632989be21a2591f134d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*19V9FL2OF3d5hsAwH1ieZw.jpeg"/></div></div></figure><h1 id="5e76" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">盘点原因英国</h1><p id="858f" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated"><strong class="jp ir">统计英国</strong>慈善事业<a class="ae kp" href="https://docs.google.com/spreadsheets/d/16q9OGYALTfyAwXDuH46UdCK2TJPcabo5U0UBKXaVgfQ/edit#gid=4" rel="noopener ugc nofollow" target="_blank">数据集</a>显示了英国公民捐赠最多的慈善机构。</p><p id="20ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<code class="fe kl km kn ko b">Treemap</code>库创建一个类似的可视化。它创建嵌套矩形的分层显示，然后平铺在代表子分支的较小矩形内。</p><pre class="ks kt ku kv gt mg ko mh mi aw mj bi"><span id="0285" class="mk le iq ko b gy ml mm l mn mo">library(treemap)</span><span id="0157" class="mk le iq ko b gy mp mm l mn mo">my_data &lt;- read.csv("treemap.csv")</span><span id="df7a" class="mk le iq ko b gy mp mm l mn mo">tm &lt;- treemap(my_data, index = c("main","second", "third"), vSize = "percent", vColor = "percent", type = "value", title = "Counting the Cause UK")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mt"><img src="../Images/adc11ae93a99303aa30d8cd703f108d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1rBEvhl_IvfNcXP_MCyHw.jpeg"/></div></div></figure></div></div>    
</body>
</html>