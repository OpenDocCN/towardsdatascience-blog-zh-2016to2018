<html>
<head>
<title>How to setup Deep Learning environment on AWS GPU instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS GPU实例上设置深度学习环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-set-up-deep-learning-machine-on-aws-gpu-instance-3bb18b0a2579?source=collection_archive---------3-----------------------#2017-07-26">https://towardsdatascience.com/how-to-set-up-deep-learning-machine-on-aws-gpu-instance-3bb18b0a2579?source=collection_archive---------3-----------------------#2017-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="8bc7" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">设定我们的目标</strong></h1><p id="27fa" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">目标是学习如何在Amazon的AWS GPU实例上建立一个机器学习环境，通过使用docker容器，该环境可以很容易地复制并用于其他问题。</p><h1 id="bc18" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">设置环境</strong></h1><p id="68f7" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">第一步是在亚马逊的网络服务上建立一个虚拟机。为此，我们需要选择正确的硬件和软件包来构建深度学习模型。深度学习模型消耗大量计算能力，对非常大的矩阵进行矩阵运算。AWS上有两个硬件选项。仅限CPU或GPU。GPU代表图形处理单元。CPU和GPU架构的主要区别在于，GPU是并行处理器，但更加专业化。相反，CPU是通用计算架构，在并行计算上做不好。Amazon允许您为繁重的计算建立一个带有专用GPU核心的虚拟机。当然，这增加了一点你的成本，但是如果你考虑到你节省的时间，这是一个很好的交易。</p><p id="a355" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">或者，如果你真的想认真对待这个问题，那么我建议你在家里用nvidia GPUs构建自己的系统。</p><p id="dde0" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">下面是我们在AWS上设置GPU实例所需的步骤:</p><ul class=""><li id="d433" class="lo lp iq kn b ko lj ks lk kw lq la lr le ls li lt lu lv lw bi translated">启动实例</li><li id="de32" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">选择ubuntu 16.04</li><li id="9d54" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">选择g2.xlarge — 8个vCPU、15Gb RAM、60GB启动SSD、1个GPU K520</li><li id="dd4b" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">选择可用性区域</li><li id="e8a5" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">防止意外终止</li><li id="444c" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">添加存储— 120 GB</li><li id="6eeb" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">添加标签，如名称和环境…</li><li id="8219" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">选择安全组</li><li id="2fea" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">启动并选择键</li></ul><p id="4e90" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">连接到实例</strong></p><p id="73f3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">导航到存储SSH密钥的目录，使用下面的命令在终端中连接到您的实例</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="fbc7" class="ml jo iq mh b gy mm mn l mo mp">ssh -i “your_ssh_key.pem” ubuntu@<em class="mq">[your instance public IP address]</em></span></pre><p id="952e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">安装NVIDIA驱动程序</strong></p><blockquote class="mr ms mt"><p id="8a48" class="kl km mq kn b ko lj kq kr ks lk ku kv mu ll ky kz mv lm lc ld mw ln lg lh li ij bi translated">ref:<a class="ae mx" href="https://medium.com/towards-data-science/how-to-set-up-a-deep-learning-environment-on-aws-with-keras-theano-b0f39e3d861c" rel="noopener">https://medium . com/forward-data-science/how-to-set-up-a-deep-learning-environment-on-AWS-with-keras-the ano-b 0f 39 e 3d 861 c</a></p></blockquote><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="d099" class="ml jo iq mh b gy mm mn l mo mp">sudo apt-get update</span><span id="2ef5" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get upgrade</span></pre><p id="ec37" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">要领</strong></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4fee" class="ml jo iq mh b gy mm mn l mo mp">sudo apt-get install openjdk-8-jdk git python-dev python3-dev python-numpy python3-numpy build-essential python-pip python3-pip python3-venv swig python3-wheel libcurl3-dev</span><span id="b2c1" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install -y gcc g++ gfortran git linux-image-generic linux-headers-generic linux-source linux-image-extra-virtual libopenblas-dev</span></pre><p id="db57" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir"> NVIDIA驱动程序</strong></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="85cf" class="ml jo iq mh b gy mm mn l mo mp">sudo add-apt-repository ppa:graphics-drivers/ppa -y</span><span id="a452" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get update</span><span id="d46b" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install -y nvidia-375 nvidia-settings</span></pre><p id="d8bf" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">安装CUDA 8库</strong></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="99a0" class="ml jo iq mh b gy mm mn l mo mp">wget <a class="ae mx" href="https://developer.nvidia.com/compute/cuda/8.0/Prod2/local_installers/cuda-repo-ubuntu1604-8-0-local-ga2_8.0.61-1_amd64-deb" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/compute/cuda/8.0/Prod2/local_installers/cuda-repo-ubuntu1604-8-0-local-ga2_8.0.61-1_amd64-deb</a></span><span id="53de" class="ml jo iq mh b gy my mn l mo mp">sudo dpkg -i cuda-repo-ubuntu1604-8-0-local-ga2_8.0.61-1_amd64-deb</span><span id="3b9f" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get update</span><span id="4aaa" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install cuda</span><span id="db41" class="ml jo iq mh b gy my mn l mo mp">nvidia-smi</span></pre><p id="b1c3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">为nvidia GPU机器设置docker引擎(nvidia-docker) </strong></p><blockquote class="mr ms mt"><p id="eaa8" class="kl km mq kn b ko lj kq kr ks lk ku kv mu ll ky kz mv lm lc ld mw ln lg lh li ij bi translated">参考:https://docs.docker.com/engine/installation/linux/ubuntu</p></blockquote><p id="3f43" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">添加docker引擎库</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="abca" class="ml jo iq mh b gy mm mn l mo mp">sudo apt-get update</span><span id="a0d6" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install \ apt-transport-https \ ca-certificates \ curl \ software-properties-common</span><span id="e50b" class="ml jo iq mh b gy my mn l mo mp">curl -fsSL <a class="ae mx" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -</span><span id="7dcf" class="ml jo iq mh b gy my mn l mo mp">sudo apt-key fingerprint 0EBFCD88</span><span id="d3b2" class="ml jo iq mh b gy my mn l mo mp">sudo add-apt-repository \ “deb [arch=amd64] <a class="ae mx" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> \ $(lsb_release -cs) \ stable”</span></pre><p id="e8a8" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">安装docker引擎ce</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f1db" class="ml jo iq mh b gy mm mn l mo mp">sudo apt-get update</span><span id="3608" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install docker-ce</span><span id="e54c" class="ml jo iq mh b gy my mn l mo mp">sudo docker run hello-world</span><span id="1541" class="ml jo iq mh b gy my mn l mo mp">sudo usermod -aG docker $USER</span></pre><p id="57f4" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">安装nvidia-docker</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b43b" class="ml jo iq mh b gy mm mn l mo mp"># Install nvidia-docker and nvidia-docker-plugin</span><span id="2c8f" class="ml jo iq mh b gy my mn l mo mp">wget -P /tmp <a class="ae mx" href="https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1-1_amd64.deb" rel="noopener ugc nofollow" target="_blank">https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1-1_amd64.deb</a></span><span id="5703" class="ml jo iq mh b gy my mn l mo mp">sudo dpkg -i /tmp/nvidia-docker*.deb &amp;&amp; rm /tmp/nvidia-docker*.deb</span><span id="cf5a" class="ml jo iq mh b gy my mn l mo mp"># Test if docker is using nvidia GPUs</span><span id="0e84" class="ml jo iq mh b gy my mn l mo mp">nvidia-docker run — rm nvidia/cuda nvidia-smi</span></pre><p id="c093" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">用jupyter笔记本、tensorflow和机器学习库建立docker容器</strong></p><p id="fbc9" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">为gpu拉张量流docker图像</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="bf06" class="ml jo iq mh b gy mm mn l mo mp">docker pull tensorflow/tensorflow:latest-gpu-py3</span></pre><p id="19e1" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">用tensorflow为gpu创建docker容器</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b3e2" class="ml jo iq mh b gy mm mn l mo mp">nvidia-docker run -it -name planet -p 8888:8888 tensorflow/tensorflow:latest-gpu-py3 bash</span></pre><p id="225b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">码头集装箱内</p><p id="85a4" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">奠定基础</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ef47" class="ml jo iq mh b gy mm mn l mo mp">apt-get update</span><span id="734e" class="ml jo iq mh b gy my mn l mo mp">apt-get install sudo</span><span id="3118" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get update</span><span id="d434" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install git</span><span id="8933" class="ml jo iq mh b gy my mn l mo mp">sudo apt-get install nano #or your choice of editor </span></pre><p id="f035" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">设置Python环境</p><p id="2062" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">首先让我们看看我们需要什么，我们有什么。我们需要:</p><p id="c689" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Python 3.5，PIP3 9.0.1，带Python 3.5内核的jupyter笔记本，tensorflow 1.1，带tensorflow后端的keras，还有这些librarise: cv2 (OpenCV)，sys，os，gc，numpy，pandas，seaborn，matplotlib，scikit-learn (sklearn)，scipy，itertools，subprocess，six，skimage，IPython.display，tqdm，多重处理，concurrent.futures</p><p id="5cea" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">运行ipython并导入下面的库，以确保一切正常。这些库的大部分已经安装在tensorflow docker映像中。但是，其中一些可能不包括在内。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="cc3b" class="ml jo iq mh b gy mm mn l mo mp">import sys</span><span id="58d2" class="ml jo iq mh b gy my mn l mo mp">import os</span><span id="3994" class="ml jo iq mh b gy my mn l mo mp">import gc</span><span id="43b4" class="ml jo iq mh b gy my mn l mo mp">import numpy</span><span id="4409" class="ml jo iq mh b gy my mn l mo mp">import pandas</span><span id="47b3" class="ml jo iq mh b gy my mn l mo mp">import seaborn</span><span id="3c7d" class="ml jo iq mh b gy my mn l mo mp">import matplotlib</span><span id="a4ea" class="ml jo iq mh b gy my mn l mo mp">import sklearn</span><span id="4538" class="ml jo iq mh b gy my mn l mo mp">import scipy</span><span id="b687" class="ml jo iq mh b gy my mn l mo mp">import itertools</span><span id="9b57" class="ml jo iq mh b gy my mn l mo mp">import subprocess</span><span id="d55d" class="ml jo iq mh b gy my mn l mo mp">import six</span><span id="9076" class="ml jo iq mh b gy my mn l mo mp">import skimage</span><span id="8b14" class="ml jo iq mh b gy my mn l mo mp">import IPython.display</span><span id="63d6" class="ml jo iq mh b gy my mn l mo mp">import tensorflow</span><span id="5272" class="ml jo iq mh b gy my mn l mo mp">import keras</span><span id="5b33" class="ml jo iq mh b gy my mn l mo mp">import tqdm</span><span id="0a8f" class="ml jo iq mh b gy my mn l mo mp">import multiprocessing</span><span id="e5eb" class="ml jo iq mh b gy my mn l mo mp">import concurrent.futures</span><span id="b819" class="ml jo iq mh b gy my mn l mo mp">import cv2</span></pre><p id="ec7c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">安装缺失的库</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="74ed" class="ml jo iq mh b gy mm mn l mo mp">pip3 install seaborn</span><span id="69fa" class="ml jo iq mh b gy my mn l mo mp">pip3 install scikit-image</span><span id="1f0a" class="ml jo iq mh b gy my mn l mo mp">pip3 install keras</span><span id="2db8" class="ml jo iq mh b gy my mn l mo mp">pip3 install tqdm</span><span id="6184" class="ml jo iq mh b gy my mn l mo mp">pip3 install opencv-python</span></pre><p id="3359" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">从这个容器创建一个新的图像，并将其命名为keras-tf</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3cb2" class="ml jo iq mh b gy mm mn l mo mp">docker commit amazon keras-tf:latest</span></pre></div></div>    
</body>
</html>