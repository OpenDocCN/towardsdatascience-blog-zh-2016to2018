<html>
<head>
<title>A Chatbot from Future: Building an end-to-end Conversational Assistant with Rasa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自未来的聊天机器人:用 Rasa 构建端到端的对话助手</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-chatbot-from-future-building-an-end-to-end-conversational-assistant-with-rasa-ai-51a1c93dabf2?source=collection_archive---------4-----------------------#2018-10-01">https://towardsdatascience.com/a-chatbot-from-future-building-an-end-to-end-conversational-assistant-with-rasa-ai-51a1c93dabf2?source=collection_archive---------4-----------------------#2018-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/17e1ad159c6904437a32aba2aafe1dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QGWZHyHGM3Ll4jmB"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Figure1: A Chatbot from future! by <a class="ae kf" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4e74" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> Y </span>你可能已经在我的<a class="ae kf" rel="noopener" target="_blank" href="/automate-the-boring-task-chatbots-in-enterprise-software-dc83cc8f09d8">上一篇文章</a>中看到，我一直在使用<a class="ae kf" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>构建聊天机器人。你会在 Rasa 上找到很多使用 Rasa APIs 构建聊天机器人的教程。但是我没有发现任何关于这些 API 的细节，不同的 API 参数是什么，这些参数是什么意思等等。在这篇文章中，我不仅会分享如何使用 Rasa 构建聊天机器人，还会讨论使用的 API 以及如何使用 Rasa 模型作为服务从 NodeJS 应用程序进行通信。</p><h1 id="2a1c" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">什么是 Rasa</h1><p id="57ca" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">Rasa 是一个开源的对话式人工智能框架。我喜欢 Rasa 的一点是，你不必拘泥于预先构建的模型或用例(Dialogflow 等)。).因此，您可以根据您的使用情形对其进行定制，这可以成为一项市场优势。Rasa 不是一个基于规则的框架(如僵尸工具)，你不需要像 Dialogflow、Microsoft LUIS 或 Amazon Lex 那样担心将你的数据放在别人的云中。</p><p id="8c7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Rasa 有两个主要组件— <a class="ae kf" href="https://nlu.rasa.ai/" rel="noopener ugc nofollow" target="_blank"> Rasa NLU </a>和<a class="ae kf" href="https://core.rasa.ai/" rel="noopener ugc nofollow" target="_blank"> Rasa 核心</a>。</p><p id="b8db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">NLU 是<em class="mq">自然语言理解者</em>。假设用户说“<code class="fe mr ms mt mu b">I want to order a book</code>”。NLU 的工作就是接受这个输入，理解用户的<em class="mq">意图</em>并在输入中找到<em class="mq">实体</em>。例如，在上面的句子中，意图是<em class="mq">订购</em>，实体是<em class="mq">图书</em>。Rasa NLU 内部使用<code class="fe mr ms mt mu b">Bag-of-Word (BoW)</code>算法寻找意图，使用<code class="fe mr ms mt mu b">Conditional Random Field (CRF)</code>寻找实体。尽管您可以使用其他算法通过 Rasa 来查找意图和实体。为此，您必须创建一个自定义管道。关于定制管道的细节超出了本文的范围。如果你有兴趣，可以查看<a class="ae kf" href="https://rasa.com/docs/nlu/master/choosing_pipeline/" rel="noopener ugc nofollow" target="_blank">这个链接</a>。</p><p id="254e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Rasa 核心的工作主要是为聊天机器人生成回复消息。它采用 Rasa NLU ( <em class="mq">意图</em>和<em class="mq">实体</em>)的输出，并应用机器学习模型来生成回复。我们将在稍后的 API 讨论中讨论更多可能的机器学习模型。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/5f2f93430a0b7ec7904756a62dc1969e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BW6rDwaNGSZP6K7mGcATMQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Figure2: Basic steps of Rasa app internally works to reply a message. Reference <a class="ae kf" href="https://rasa.com/docs/core/architecture/" rel="noopener ugc nofollow" target="_blank">here</a>.</figcaption></figure><p id="76bd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如上图所示，输入消息由一个<code class="fe mr ms mt mu b">Interpreter</code>解释以提取<code class="fe mr ms mt mu b">intent</code>和<code class="fe mr ms mt mu b">entity</code>。然后，它被传递给跟踪对话当前状态的<code class="fe mr ms mt mu b">Tracker</code>。<code class="fe mr ms mt mu b">Policy</code>应用机器学习算法来确定什么应该是回复，并相应地选择<code class="fe mr ms mt mu b">Action</code>。<code class="fe mr ms mt mu b">Action</code>更新<code class="fe mr ms mt mu b">Tracker</code>以反映当前状态。</p><h1 id="6185" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><strong class="ak">打造聊天机器人</strong></h1><p id="63c1" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">假设我们正在构建一个客户服务聊天机器人。创建一个名为<code class="fe mr ms mt mu b">customer_bot</code>的目录，并在其中创建一个名为<code class="fe mr ms mt mu b">data</code>的目录。还要创建一个名为<code class="fe mr ms mt mu b">config_spacy.yml</code>的配置文件</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="bb79" class="ne lo it mu b gy nf ng l nh ni">$mkdir customer_bot<br/>$cd customer_bot<br/>$mkdir data<br/>$vi config_spacy.yml</span></pre><p id="1f31" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将<a class="ae kf" href="https://github.com/nahidalam/customer_bot/blob/master/config_spacy.yml" rel="noopener ugc nofollow" target="_blank">中的<code class="fe mr ms mt mu b">config_spacy.yml</code>文件内容复制到此处</a>。在配置文件中，我们指定了用于构建各种模型的管道类型。在这种情况下，我们使用<code class="fe mr ms mt mu b">Spacy</code>和<code class="fe mr ms mt mu b">Scikit-learn</code>来构建管道，并且仅支持如下配置中指定的<code class="fe mr ms mt mu b">English</code>语言:</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="ce55" class="ne lo it mu b gy nf ng l nh ni">language: "en" <br/>pipeline: "spacy_sklearn"</span></pre><p id="dc6b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以使用 Rasa 支持的其它管线类型，也可以创建自定义模型管线并在配置中指定它。</p><h2 id="6195" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated"><strong class="ak">建立 NLU 模型</strong></h2><p id="f61e" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">首先，我们需要建立 NLU 模型。拉莎·NLU 使用监督学习模型工作。因此，您需要训练数据来训练 NLU 模型。在训练数据中，我们需要指定该数据的<code class="fe mr ms mt mu b">intent</code>和<code class="fe mr ms mt mu b">entity</code>是什么。例如，如果机器人的输入文本是'<em class="mq"> hi </em>，您可以将意图定义为'<em class="mq"> greet </em>'。在这种情况下没有实体。因此，训练数据集如下所示</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="c615" class="ne lo it mu b gy nf ng l nh ni">{        <br/> "text": "hi",        <br/> "intent": "greet",        <br/> "entities": []     <br/>}</span></pre><p id="0a0a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以使用我的 github 复制粘贴整个<a class="ae kf" href="https://github.com/nahidalam/customer_bot/blob/master/data/data.json" rel="noopener ugc nofollow" target="_blank">训练数据</a>用于代码中。将其命名为<code class="fe mr ms mt mu b">data.json</code>并放入<code class="fe mr ms mt mu b">data</code>文件夹中。</p><p id="7018" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">手动创建这些 trining 数据非常耗时。因此，相反，你可以使用这个<a class="ae kf" href="https://rasahq.github.io/rasa-nlu-trainer/" rel="noopener ugc nofollow" target="_blank">网络用户界面</a>来创建数据来训练拉沙 NLU。</p><p id="d324" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在使用<code class="fe mr ms mt mu b">data.json</code>和<code class="fe mr ms mt mu b">config_spacy.yml</code>，我们需要训练一个 NLU 模型。创建<code class="fe mr ms mt mu b">nlu_model.py</code>并放在<code class="fe mr ms mt mu b">customer_bot</code>文件夹下。NLU 模特培训代码如下:</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="34a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以像下面这样调用上面的<code class="fe mr ms mt mu b">train_nlu</code>方法:</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="9cf4" class="ne lo it mu b gy nf ng l nh ni">if __name__ == '__main__': <br/>    model_directory = train_nlu('./data/data.json', 'config_spacy.yml', './models/nlu')</span></pre><p id="f7c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看这是怎么回事。我们正在使用<code class="fe mr ms mt mu b">load_data</code>加载训练数据。<code class="fe mr ms mt mu b">load_data</code>函数读取训练数据并返回一个<code class="fe mr ms mt mu b">TrainingData</code>对象。然后我们使用通过<code class="fe mr ms mt mu b">config_spacy.yml</code>传递的配置创建一个<code class="fe mr ms mt mu b">Trainer</code>对象。现在使用那个<code class="fe mr ms mt mu b">trainer</code>对象，我们实际上可以训练数据来创建一个机器学习模型——在这种情况下，Rasa NLU 模型如图<code class="fe mr ms mt mu b">trainer.train(training_data)</code>所示。一旦模型被训练，我们需要将模型保存在一个目录中。我们通过调用<code class="fe mr ms mt mu b">Trainer</code>类的<code class="fe mr ms mt mu b">persist</code>方法来实现。正如您在上面看到的，在<code class="fe mr ms mt mu b">trainer.persist</code>中，我们指定了保存模型的目录，并为我们的模型指定了一个名称— <code class="fe mr ms mt mu b">customernlu</code>。</p><p id="35b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然我们已经训练并保存了模型，我们可以像下面这样运行 NLU 模型:</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="5e9a" class="ne lo it mu b gy nf ng l nh ni">def run_nlu(model_directory): <br/>      interpreter = Interpreter.load(model_directory)</span></pre><h2 id="f278" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated"><strong class="ak">建立对话管理模式</strong></h2><p id="62b3" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">对话管理是 Rasa 核心的工作。在构建对话模型之前，我们需要定义我们希望对话如何流动。实质上，我们正在为对话模型创建一组训练示例。我们将创建一个文件<code class="fe mr ms mt mu b">stories.md</code>并将其放在<code class="fe mr ms mt mu b">data</code>文件夹中。让我们来看看<code class="fe mr ms mt mu b">stories.md</code>的一组样本数据。</p><h2 id="8c5f" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated">使用 stories.md 训练对话模型</h2><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="d399" class="ne lo it mu b gy nf ng l nh ni">## story_001<br/>* greet<br/>   - utter_greet<br/>* order_product<br/>   - utter_ask_product_name<br/>* order_product[router=829]<br/>   - slot{"router": "829"}<br/>   - action_order_product<br/>* goodbye<br/>   - utter_goodbye</span></pre><p id="c6d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们想要一个当用户说<code class="fe mr ms mt mu b">Hi</code>时开始的对话。我们可以将意图定义为<code class="fe mr ms mt mu b">greet</code>。当机器人发现一个<code class="fe mr ms mt mu b">greet</code>意图时，它会回复<code class="fe mr ms mt mu b">utter_greet</code>。<code class="fe mr ms mt mu b">utter_greet</code>的内容将在后面的<code class="fe mr ms mt mu b">domain</code>文件中定义。</p><h2 id="1882" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated">插槽和动作</h2><p id="a6de" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我们再举一个例子。假设用户说“<code class="fe mr ms mt mu b">I want to order an 829 router</code>”。机器人明白这是一个<code class="fe mr ms mt mu b">order_product</code>意图，实体是<code class="fe mr ms mt mu b">router</code>。实体的值是 829，这意味着有不同产品 ID 的路由器，但是用户只对 829 感兴趣。因此路由器及其值 829 在这里被定义为时隙的一部分<code class="fe mr ms mt mu b">slot{“router”: “829”}</code>。插槽本质上是你的机器人的内存，被定义为一个键值对。更多关于插槽的信息可以在这里找到<a class="ae kf" href="https://rasa.com/docs/core/slots/" rel="noopener ugc nofollow" target="_blank">。有时，来自机器人的回复消息不是静态消息。相反，机器人可能需要调用一些服务或执行一些其他计算来创建回复消息的内容。如上文<code class="fe mr ms mt mu b">action_order_product</code>所示，这些通过<code class="fe mr ms mt mu b">action</code>定义。在<code class="fe mr ms mt mu b">action_order_product</code>中实际发生的事情将在<code class="fe mr ms mt mu b">actions.py</code>中定义。</a></p><p id="da9f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个项目的<code class="fe mr ms mt mu b">stories.md</code>文件可以在<a class="ae kf" href="https://github.com/nahidalam/customer_bot/blob/master/data/stories.md" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7a53" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于<code class="fe mr ms mt mu b">stories</code>数据格式的详细说明是<a class="ae kf" href="https://rasa.com/docs/core/stories/" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><h2 id="9f05" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated">定义域</h2><p id="0271" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">我们将为名为<code class="fe mr ms mt mu b">customer_domain.yml</code>的域创建一个<code class="fe mr ms mt mu b">yml</code>文件，并将其放在<code class="fe mr ms mt mu b">customer_bot</code>目录中。域文件指定了<code class="fe mr ms mt mu b">slots</code>、<code class="fe mr ms mt mu b">intent</code>、<code class="fe mr ms mt mu b">entities</code>、<code class="fe mr ms mt mu b">actions</code>和<code class="fe mr ms mt mu b">templates</code>(例如在<code class="fe mr ms mt mu b">utter_greet</code>对不同话语的示例回复)。这个项目的域文件可以在这里找到<a class="ae kf" href="https://github.com/nahidalam/customer_bot/blob/master/customer_domain.yml" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="b335" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated">actions.py</h2><p id="ba04" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">如果您的 bot 的回复消息都是静态消息，您不需要任何操作。但最有可能的情况并非如此。任何真实的机器人应用程序都会与一些其他服务进行通信，或者至少为它的一些回复进行实时计算。在我们的项目中，一旦产品被订购，机器人应该回复一个确认号。对于不同的用户/产品，此确认号码会有所不同。因此，产品订购流程将成为行动的一部分。为了简单起见，在我们当前的代码中，我们显示了一个硬编码的确认号，假设产品订单是成功的。</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">How to write an action in Rasa</figcaption></figure><p id="b1bd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在这里找到这个项目<a class="ae kf" href="https://github.com/nahidalam/customer_bot/blob/master/actions.py" rel="noopener ugc nofollow" target="_blank">的<code class="fe mr ms mt mu b">actions.py</code>文件。</a></p><h2 id="6fb3" class="ne lo it bd lp nj nk dn lt nl nm dp lx kr nn no mb kv np nq mf kz nr ns mj nt bi translated">训练对话模型</h2><p id="47e9" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">为了训练对话模型，我们将编写一个函数<code class="fe mr ms mt mu b">train_dialogue</code>。该函数需要 3 个参数——域文件、故事文件和训练后保存对话模型的路径。在 Rasa 中，我们使用代理类来训练对话模型。您通过传递<code class="fe mr ms mt mu b">domain</code>文件并指定一个<code class="fe mr ms mt mu b">policy</code>来创建一个<code class="fe mr ms mt mu b">agent</code>对象。政策本质上是模型。例如<code class="fe mr ms mt mu b">KerasPolicy</code>内部使用<a class="ae kf" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="noopener ugc nofollow" target="_blank"> LSTM </a>网络。在你的训练数据中记忆对话。根据您使用的 Rasa 核心版本，您可能有不同类型的可用策略。更多关于政策<a class="ae kf" href="https://rasa.com/docs/core/policies/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9423" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们必须使用<code class="fe mr ms mt mu b">agent</code>对象的<code class="fe mr ms mt mu b">train</code>方法来训练使用<code class="fe mr ms mt mu b">stories.md</code>文件。如上图所示，您可以指定<code class="fe mr ms mt mu b">epochs</code>、<code class="fe mr ms mt mu b">batch_size</code>和<code class="fe mr ms mt mu b">validation_split</code>。我们将使用<code class="fe mr ms mt mu b">agent.persist</code>保存模型。</p><p id="41fc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要运行对话模型，我们需要一个如<code class="fe mr ms mt mu b">run_customer_bot</code>方法所示的<code class="fe mr ms mt mu b">interpreter</code>对象。解释器做它所说的——解释输入给机器人的文本。凭直觉，您可能会理解，您需要之前创建的<code class="fe mr ms mt mu b">NLU model</code>来创建一个<code class="fe mr ms mt mu b">interpreter</code>对象。因为 NLU 的工作是解释传入的文本——理解<code class="fe mr ms mt mu b">intent</code>和<code class="fe mr ms mt mu b">entity</code>。然后您需要创建一个<code class="fe mr ms mt mu b">agent</code>对象，它接受<code class="fe mr ms mt mu b">interpreter</code>对象和您刚刚通过<code class="fe mr ms mt mu b">train_dialogue</code>方法创建的<code class="fe mr ms mt mu b">dialogue model</code>。一旦有了代理对象，就可以使用<code class="fe mr ms mt mu b">agent.handle_channel()</code>来运行将进行对话的机器人。在这种情况下，我们使用 Mac 终端作为输入/输出网关，因此我们将<code class="fe mr ms mt mu b">ConsoleInputChannel()</code>作为<code class="fe mr ms mt mu b">agent.handle_channel</code>的参数传递。Rasa 核心支持一些其他的输入通道或者你可以创建你自己的自定义通道。更多关于<code class="fe mr ms mt mu b">interpreter</code>的信息可以在这里找到<a class="ae kf" href="https://rasa.com/docs/core/api/interpreter/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d662" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你们中的一些人可能已经注意到<code class="fe mr ms mt mu b">dialogue_management_model.py</code>不是图 2 的 100%反映。例如，<code class="fe mr ms mt mu b">dialogue_management_model.py</code>中没有使用<code class="fe mr ms mt mu b">Tracker</code>对象。这是因为图 2 反映了内部发生的事情，而不一定是您用代码编写的内容。您仍然可以使用<code class="fe mr ms mt mu b">tracker</code>功能来了解对话的当前状态。关于追踪器更多的是<a class="ae kf" href="https://rasa.com/docs/core/api/tracker/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="eeb4" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">怎么跑</h1><p id="0d2c" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">本教程是在 MacBook 上完成的。按照 Rasa 文件安装<a class="ae kf" href="https://rasa.com/docs/nlu/installation/" rel="noopener ugc nofollow" target="_blank"> Rasa NLU </a>和<a class="ae kf" href="https://rasa.com/docs/core/installation/" rel="noopener ugc nofollow" target="_blank"> Rasa 核心</a>。对于本教程，我使用了 NLU 版本<code class="fe mr ms mt mu b">0.12.3</code>和核心版本<code class="fe mr ms mt mu b">0.9.0a6</code></p><p id="4ff8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从我的 github 下载<a class="ae kf" href="https://github.com/nahidalam/customer_bot" rel="noopener ugc nofollow" target="_blank">完整代码</a>。</p><p id="da2a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建 NLU 模式</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="afbb" class="ne lo it mu b gy nf ng l nh ni">$python nlu_model.py</span></pre><p id="65e3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建对话模型。<em class="mq">注释</em>出<code class="fe mr ms mt mu b">__main__</code>里面的<code class="fe mr ms mt mu b">run_customer_bot()</code>方法。然后运行下面的命令。</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="81c5" class="ne lo it mu b gy nf ng l nh ni">$python dialogue_management_model.py</span></pre><p id="b60f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在<em class="mq">取消<code class="fe mr ms mt mu b">__main__</code>处<code class="fe mr ms mt mu b">run_customer_bot()</code>方法的</em>注释，<em class="mq">注释掉<code class="fe mr ms mt mu b">train_dialogue()</code>方法的</em>。然后再往下面跑。</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="bba8" class="ne lo it mu b gy nf ng l nh ni">$python dialogue_management_model.py</span></pre><p id="d531" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您应该已经在终端中运行了 bot。</p><h1 id="c2b3" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">将模型作为服务使用</h1><p id="c647" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">一旦您准备好了 NLU 和对话模型，您就可以将 Rasa 核心作为服务器运行，并从服务器应用程序与它通信</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="448c" class="ne lo it mu b gy nf ng l nh ni">$cd customer_bot<br/>$python -m rasa_core.server -d models/dialogue -u models/nlu/default/customernlu/ --debug -o out.log --cors *</span></pre><p id="c216" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Rasa 核心服务器默认运行在端口<code class="fe mr ms mt mu b">5005</code>上。假设用户说<code class="fe mr ms mt mu b">hello</code>。这个用户输入来自 NodeJS 服务器中的前端到后端。NodeJS 服务器希望与运行在端口<code class="fe mr ms mt mu b">5005</code>上的 Rasa 核心服务器通信，并希望从 Rasa bot 获得回复。下面的示例 NodeJS 代码可以做到这一点。</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="a5d3" class="ne lo it mu b gy nf ng l nh ni">var messageToRasa = 'hello'<br/>request.post(<br/>      '<a class="ae kf" href="http://localhost:5005/conversations/default/respond'" rel="noopener ugc nofollow" target="_blank">http://localhost:5005/conversations/default/respond'</a>,<br/>      { json: { 'query': messageToRasa} },<br/>      function (error, response, body) {<br/>          if (!error &amp;&amp; response.statusCode == 200) {</span><span id="0dad" class="ne lo it mu b gy nw ng l nh ni">              //body[0].text is the reply from Rasa<br/>              console.log(body[0].text)<br/>              }<br/>          else{<br/>            console.log(`Error: \n${error}`);<br/>          }<br/>      }<br/>  );</span></pre><h1 id="2dcb" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">参考:</h1><ol class=""><li id="d080" class="nx ny it ki b kj ml kn mm kr nz kv oa kz ob ld oc od oe of bi translated">Justina 关于如何使用 Rasa 构建一个简单聊天机器人的优秀教程</li><li id="649b" class="nx ny it ki b kj og kn oh kr oi kv oj kz ok ld oc od oe of bi translated">使用 Rasa 时的一些有趣的<a class="ae kf" href="https://hackernoon.com/building-a-chatbot-using-rasa-stack-intro-and-tips-c6d1057d8536" rel="noopener ugc nofollow" target="_blank">提示</a>。</li><li id="7cdc" class="nx ny it ki b kj og kn oh kr oi kv oj kz ok ld oc od oe of bi translated">揭开拉莎·NLU 的神秘面纱。</li><li id="d650" class="nx ny it ki b kj og kn oh kr oi kv oj kz ok ld oc od oe of bi translated">条件随机场<a class="ae kf" href="http://blog.echen.me/2012/01/03/introduction-to-conditional-random-fields/" rel="noopener ugc nofollow" target="_blank">简介</a>。</li><li id="d54f" class="nx ny it ki b kj og kn oh kr oi kv oj kz ok ld oc od oe of bi translated">自然语言处理从业者指南<a class="ae kf" rel="noopener" target="_blank" href="/a-practitioners-guide-to-natural-language-processing-part-i-processing-understanding-text-9f4abfd13e72">这里</a>。</li><li id="9813" class="nx ny it ki b kj og kn oh kr oi kv oj kz ok ld oc od oe of bi translated">带插图的 LSTM 指南。</li><li id="6690" class="nx ny it ki b kj og kn oh kr oi kv oj kz ok ld oc od oe of bi translated">更多关于 Rasa 核心<a class="ae kf" href="https://medium.com/@souvikghosh_archidev/contextual-conversational-engine-the-rasa-core-approach-part-1-1acf95b3d237" rel="noopener">政策</a>的信息。</li></ol></div></div>    
</body>
</html>