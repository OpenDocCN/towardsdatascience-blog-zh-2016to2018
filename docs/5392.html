<html>
<head>
<title>Weekend project: Detecting solar panels from satellite imagery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">周末项目:从卫星图像中探测太阳能电池板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/weekend-project-detecting-solar-panels-from-satellite-imagery-f6f5d5e0da40?source=collection_archive---------10-----------------------#2018-10-15">https://towardsdatascience.com/weekend-project-detecting-solar-panels-from-satellite-imagery-f6f5d5e0da40?source=collection_archive---------10-----------------------#2018-10-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4917398e75b1b848e1b319767b7bba36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R8HTctnZkU1Y38JGGqkBhw.png"/></div></div></figure><p id="f6e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我花了很多时间处理卫星图像或衍生产品，主要是与土壤科学相关的项目。你可以看看我以前的一篇文章，我用多任务卷积神经网络和环境信息来预测土壤有机碳含量:</p><div class="kz la gp gr lb lc"><a rel="noopener follow" target="_blank" href="/deep-learning-and-soil-science-part-2-129e0cb4be94"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">深度学习和土壤科学—第二部分</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">使用上下文空间信息的数字土壤制图。从点信息生成土壤图的多任务 CNN</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">towardsdatascience.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq jz lc"/></div></div></a></div><p id="8d94" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个周末，我想探索另一个领域，我认为这将是一个好主意，试图从卫星图像检测太阳能电池板。目前我住在澳大利亚，利用太阳能的潜力是巨大的。政府坚持推动使用煤来生产能源，所以我认为任何强调可再生能源的个人努力都是重要的。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="1203" class="ly lz it bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">目标</h1><p id="7ab1" class="pw-post-body-paragraph kb kc it kd b ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky im bi translated">这是一个周末项目，所以我的想法是在短时间内实现一些东西，并希望得到一些下降的结果。结果并不完美，但这是良好的第一步。</p><p id="a0bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">整个过程包括:</p><ul class=""><li id="71c4" class="nb nc it kd b ke kf ki kj km nd kq ne ku nf ky ng nh ni nj bi translated">生成数据集</li><li id="e8c0" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">训练卷积神经网络(CNN)</li><li id="0adc" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">尝试用模型做一些有趣的事情</li></ul><h1 id="6b50" class="ly lz it bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">资料组</h1><p id="9c4e" class="pw-post-body-paragraph kb kc it kd b ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky im bi translated">我确信有可能找到一个好的数据集来实现这一点，但目标之一是从头生成一个数据集。CNN 非常强大，但是没有数据，你做不了什么。</p><p id="d5cb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了生成对应于太阳能电池板位置的多边形，我使用了<a class="ae nu" href="https://medium.com/google-earth" rel="noopener">谷歌地球引擎</a>。我花了大约 1.5 个小时在 1 公里的范围内划分太阳能电池板，结果总共 124 个多边形(没有我预期的那么多)。</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/52368abdbc8ecb3bd84cb73d283518f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-kzFIjMpJZJXpv717zW8IQ.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Creating polygons</figcaption></figure><p id="e040" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一步是在这些多边形内生成 1800 个随机点，并提取以这些位置为中心的图像。那些是阳性样品(有太阳能电池板)。对于负样本(没有太阳能电池板)，我生成了 1800 个不与多边形相交的随机点(加上一个缓冲区，以确保电池板不在图像中)。</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4983a3eac3a7439c502e8213fb1dad34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*rPOStelv8KHk5mcDVe7cPg.png"/></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Examples of positive samples (top) and negative samples (bottom)</figcaption></figure><h1 id="6c8d" class="ly lz it bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">模型</h1><p id="567c" class="pw-post-body-paragraph kb kc it kd b ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky im bi translated">我能想到几种检测太阳能电池板的方法。我们可以尝试分割图像，使用遮罩，预测多边形的顶点。我不想花几个小时训练这个模型，所以我选择了一个相对简单的完全卷积神经网络来预测一个像素成为太阳能电池板一部分的概率。几个 conv-马克斯普尔序列，最初几层中的一些空间退学者，以及接近结尾时更多的退学者。我使用的一个小技巧(我在一次会议上从谷歌的某人那里学到的)是计算 RGB 图像的<a class="ae nu" href="https://en.wikipedia.org/wiki/Relative_luminance" rel="noopener ugc nofollow" target="_blank">相对亮度</a>，并将其用作上下文。我对 RGB 图像进行了裁剪(没有调整大小),并将其与亮度图像合并(在使用一些卷积减少亮度图像的大小之后)。</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/418b2506ddf5e1a4323c2893f0fa15ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JnZx7MJosNsFaz6Zmdi5A.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">People has been asking about this “trick”. Just make sure that the shape of the cropped RGB is equal to the RelLum after the convolutions. The number of convolutions will depend on the shape of the original image and how much you crop it (not resize it).</figcaption></figure><p id="0c7c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在训练 100 个时期的模型之前，我使用 Kera 的<code class="fe og oh oi oj b">ImageDataGenerator</code>对图像应用了一些数据增强(垂直和水平翻转，80-120%亮度范围)。用 GPU 在桌面上运行训练只需要几分钟。</p><h1 id="e8a5" class="ly lz it bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">结果</h1><p id="ac9a" class="pw-post-body-paragraph kb kc it kd b ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky im bi translated">考虑到我花在生成数据集和训练模型上的时间，我对结果印象深刻。该模型对训练集和验证集的准确率分别达到了 95%和 92%。</p><p id="938b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出的几个例子:</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/1a6796e67be816080e6d4ce37bdba4ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*-UxaL6q9PvEIwL5Jpd_RLQ.png"/></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">High probabilities in an image with solar panels (top) and low probability in image without panels.</figcaption></figure><p id="7984" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">总的来说，结果是好的。有些地方模型会混淆，比如汽车挡风玻璃，房屋边缘，电缆。在实践中这不是一个大问题，因为在这些区域的概率通常低于 0.8，所以在适当的阈值下，误差是最小的。通过这个模型的第一次迭代，我可以预测一个大的区域，并手动选择负样本来进一步改进模型。</p><h1 id="0f05" class="ly lz it bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">使用私有 API 进行预测</h1><p id="c200" class="pw-post-body-paragraph kb kc it kd b ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky im bi translated">我决定使用 Flask 编写一个小的 tile 服务器，而不是运行 Jupyter 笔记本并使用它来预测新图像。大概我会写一篇关于这个的文章，但总的来说逻辑是:</p><ul class=""><li id="19fd" class="nb nc it kd b ke kf ki kj km nd kq ne ku nf ky ng nh ni nj bi translated">给定 API 的视口，前端向 API 请求图块。</li><li id="e7d0" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">API 从官方切片服务器(卫星视图)检索切片。</li><li id="38c7" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">API 使用图块进行预测。</li><li id="8c9a" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">API 使用用户定义的模型、阈值和不透明度生成覆盖图(原始图像+概率)。</li><li id="77ff" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">前端显示瓷砖。</li></ul><p id="4894" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于这种方法，我可以探索任何领域，并迅速得到预测。</p><figure class="nw nx ny nz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/ce672908f7bb65c809f965cbe1b18965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLIXOqTi-RcbPH46pDEV4Q.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Frontend displaying tiles predicted “on-the-fly”. Showing probabilities &gt; 95%. Still some errors, but probably easy to correct with more negative samples.</figcaption></figure><h1 id="2336" class="ly lz it bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">最后的话</h1><p id="e953" class="pw-post-body-paragraph kb kc it kd b ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky im bi translated">这是一个有趣的项目，结果比我预期的好得多。我可能会尝试改进模型，使其达到生产水平。API 肯定是我想继续改进的东西，因为我需要这样的东西已经有一段时间了。如果有人知道替代方案，请告诉我。</p><p id="cd9c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望你喜欢这篇文章。我想我会坚持太阳能主题，并尝试生成一个辐射模型来估计一所房子安装太阳能电池板的潜力。</p></div></div>    
</body>
</html>