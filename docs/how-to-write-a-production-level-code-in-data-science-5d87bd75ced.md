# 数据科学如何写一个生产级代码？

> 原文：<https://towardsdatascience.com/how-to-write-a-production-level-code-in-data-science-5d87bd75ced?source=collection_archive---------1----------------------->

![](img/1867e98b08265ad2278e1bd9f4399cb4.png)

dreamstime/Scyther5

编写生产级代码的能力是数据科学家角色的抢手技能之一——无论是否明确公布。对于一个从软件工程师转型为数据科学家的人来说，这听起来可能不是一个具有挑战性的任务，因为他们可能已经完善了开发生产级代码的技能，并多次部署到生产中。

本文面向那些刚开始编写生产级代码并对学习它感兴趣的人，如大学应届毕业生或任何进入数据科学领域(或计划转型)的专业人士。对他们来说，编写生产级代码似乎是一项艰巨的任务。

我会给你一些关于如何编写生产级代码并实践它的技巧，你不一定要在数据科学的角色中学习这项技能。

## **1。保持模块化**

这基本上是推荐给任何软件工程师的软件设计技术。这里的想法是根据它的功能将一个大的代码分成小的独立部分(函数)。它有两个部分。

(I)将代码分成较小的部分，每个部分用于执行特定的任务(可能包括子任务)

(ii)基于其可用性将这些功能分组到模块(或 python 文件)中。它还有助于保持组织性和代码的易维护性

第一步是将一个大代码分解成许多具有特定输入(和输入格式)和输出(和输出格式)的简单函数。如前所述，每个函数应该执行一个任务，如*清除数据中的异常值、替换错误值、对模型评分、计算均方根误差(RMSE)* 等等。试着将这些功能进一步分解为执行子任务，继续下去，直到没有功能可以进一步分解。

***低级函数*** —不能再分解的最基本的函数。例如，计算数据的 *RMSE* 或 Z 分数。这些函数中的一些可以广泛用于任何算法或机器学习模型的训练和实现。

***中级功能*** —使用一个或多个低级功能和/或其他中级功能来执行其任务的功能。例如，*清除异常值*函数使用*计算 Z 值*函数来移除异常值，只保留特定范围内的数据，或者使用*计算 RMSE* 函数的*误差*函数来获取 RMSE 值。

***高级功能*** —使用一个或多个中级功能和/或低级功能来执行其任务的功能。例如，使用几个函数的模型训练函数，例如获得随机采样数据的函数、模型评分函数、度量函数等。

最后的步骤是将对多个算法有用的所有低级和中级函数分组到一个 python 文件中(可以作为一个模块导入),并将仅对所考虑的算法有用的所有其他低级和中级函数分组到另一个 python 文件中。所有的高级函数都应该驻留在一个单独的 python 文件中。这个 python 文件规定了算法开发的每个步骤——从组合来自不同来源的数据到最终的机器学习模型。

遵循以上步骤没有硬性规定，但是我强烈建议你从这些步骤开始，然后发展你自己的风格。

## **2。测井和仪器仪表**

记录和仪表(LI)类似于飞机上的黑匣子，记录驾驶舱内发生的所有事情。LI 的主要目的是记录代码执行过程中的有用信息，帮助程序员在出现问题时进行调试，并提高代码的性能(如减少执行时间)。

日志记录和检测有什么区别？

**(i)日志记录—** 仅记录可操作的信息，如运行时的关键故障，以及结构化数据，如代码本身稍后将使用的中间结果。在开发和测试阶段，可以接受多种日志级别，如调试、信息、警告和错误。然而，在生产过程中要不惜一切代价避免它们。

*日志记录应尽量少，仅包含需要人工关注和立即处理的信息*。

**(ii)检测—** 记录日志中遗漏的所有其他信息，这些信息将帮助我们验证代码执行步骤，并在必要时改进性能。在这种情况下，拥有更多的数据总是更好，因此要尽可能多地收集信息。

为了验证代码执行步骤——我们应该记录诸如任务名称、中间结果、经过的步骤等信息。这将有助于我们验证结果，并确认算法遵循了预期的步骤。无效的结果或异常执行的算法可能不会引发在日志记录中会被捕获的严重错误。因此记录这些信息是必要的。

为了提高性能，我们应该记录每个任务/子任务花费的时间和每个变量使用的内存。这将有助于我们改进代码，进行必要的修改，优化代码以运行得更快并限制内存消耗(或者识别 python 中常见的内存泄漏)。

插装应该记录日志中遗漏的所有其他信息，这些信息将帮助我们验证代码执行步骤并致力于性能改进。数据多总比少好。

**3。代码优化**

代码优化意味着降低时间复杂度(运行时间)和降低空间复杂度(内存使用)。时间/空间复杂度通常表示为 O(x)，也称为 ***Big-O 表示法*** 其中 x 是时间或空间占用多项式中的主导项。时间复杂度和空间复杂度是衡量 ***算法效率*** 的度量。

例如，假设我们有一个嵌套的 *for* 循环，每个循环的大小为 *n* ，每次运行大约需要 2 秒，然后是一个简单的 *for* 循环，每次运行需要 4 秒。那么时间消耗的等式可以写成

耗时~ 2 n +4 n = O(n +n) = O(n)

对于 Big-O 表示，我们应该去掉非主导项(因为它可以忽略不计，因为 *n* 趋向于 *inf* )以及系数。系数或比例因子被忽略，因为我们在优化灵活性方面对其控制较少。请注意，绝对耗时中的系数是指循环的*数量与每次运行所用时间的乘积，而 O(n +n)中的系数代表*循环的*数量(1 个双*用于*循环，1 个单*用于*循环)。同样，我们应该从等式中去掉低阶项。因此，上述过程的大 O 是 O(n)。*

现在，我们的目标是用时间复杂度更低的更好的替代方案替换效率最低的代码部分。比如 O(n)比 O(n)好。代码中最常见的杀手是循环的*，最不常见但比*循环的*更糟糕的是递归函数(O(branch^depth)).尝试用 python 模块或函数替换尽可能多的 *for* 循环，这些模块或函数通常用可能的 C 代码执行计算进行了大量优化，以实现更短的运行时间。*

我强烈推荐你阅读盖尔·麦克道尔的《破解编码采访[*中关于“大 O”的部分。事实上，试着通读整本书来提高你的编码技能。*](https://www.amazon.com/Cracking-Coding-Interview-Programming-Questions/dp/0984782850/ref=sr_1_1?ie=UTF8&qid=1517896199&sr=8-1&keywords=cracking+the+coding+interviews)

**4。单元测试**

*单元测试*——根据功能自动化代码测试

您的代码在进入生产之前必须清除多个测试和调试阶段。通常有三个级别—开发、试运行和生产。在一些公司中，在生产之前会有一个模拟生产系统确切环境的阶段。代码应该没有任何明显的问题，并且应该能够在进入生产时处理潜在的异常。

为了能够识别可能出现的不同问题，我们需要针对不同的场景、不同的数据集、不同的边缘和角落情况等来测试我们的代码。每次我们想要测试代码时，手动执行这个过程是低效的，因为每次我们对代码进行重大修改时都会这样。因此，选择包含一组测试用例的单元测试，它可以在我们想要测试代码的任何时候执行。

我们必须添加具有预期结果的不同测试用例来测试我们的代码。单元测试模块逐个检查每个测试用例，并将代码的输出与期望值进行比较。如果没有达到预期的结果，测试就会失败——这是您的代码在部署到产品中时会失败的早期迹象。我们需要调试代码，然后重复这个过程，直到所有的测试用例都被清除。

为了让我们的生活变得简单，python 有一个名为 *unittest* 的模块来实现单元测试。

**5。与生态系统的兼容性**

最有可能的是，你的代码不会是一个独立的函数或模块。它将被整合到公司的代码生态系统中，您的代码必须与生态系统的其他部分同步运行，没有任何缺陷/故障。

例如，假设你开发了一个算法来给出推荐。流程通常包括从数据库中获取最近的数据，更新/生成推荐，将其存储在数据库中，该数据库将被前端框架(如网页)读取(使用 API)以向用户显示推荐的项目。简单！它就像一条链条，新的链环应该与前一个和下一个链环锁在一起，否则该过程将失败。同样，每个进程都必须按预期运行。

每个流程都有明确定义的输入和输出需求、预期的响应时间等等。如果当其他模块(从网页)请求更新的建议时，您的代码应该在可接受的时间内以期望的格式返回期望值。如果结果是意想不到的值(当我们在购买电子产品时建议购买牛奶)，不希望的格式(以文本而不是图片的形式提出的建议)，以及不可接受的时间(没有人等待分钟来获得建议，至少在这些日子里)，这意味着代码与系统不同步。

避免这种情况的最好方法是在我们开始开发过程之前与相关团队讨论需求。如果团队不在，仔细阅读代码文档(很可能你会在那里找到很多信息)和代码本身，如果必要的话，理解需求。

**6。版本控制**

git——一个版本控制系统是最近发生在源代码管理上的最好的事情之一。它跟踪对计算机代码的修改。也许有许多现有的版本控制/跟踪系统，但是与其他任何系统相比，Git 被广泛使用。

这个过程简单来说就是“修改和提交”。我把它过分简化了。这个过程有很多步骤，例如创建一个开发分支，在本地提交更改，从远程提取文件，将文件推送到远程分支，等等，我将留给您自己去探索。

每当我们对代码进行更改时，我们不是用不同的名称保存文件，而是提交更改——这意味着用新的更改覆盖旧的文件，并使用与之链接的键。我们通常在每次提交代码变更时都要写注释。比方说，你不喜欢在最后一次提交中所做的更改，并且想要恢复到以前的版本，使用提交引用键可以很容易地做到这一点。Git 对于代码开发和维护来说是如此强大和有用。

您可能已经理解了为什么这对生产系统很重要，以及为什么必须学习 Git。我们必须总是能够灵活地回到稳定的旧版本，以防新版本意外失败。

**7。可读性**

你写的代码对其他人来说也应该是容易理解的，至少对你的团队成员来说是这样。此外，如果没有遵循正确的命名约定，即使是对您来说，在编写代码后的几个月内理解自己的代码也是一个挑战。

**(一)适当的变量和函数名**

变量和函数名应该是不言自明的。当有人阅读你的代码时，应该很容易找到每个变量包含什么，每个函数做什么，至少在某种程度上是这样。

使用一个能清楚说明其功能/作用的长名称，而不是使用诸如 x、y、z 等短名称，是完全可以的。，那都是模糊的。变量名不要超过 30 个字符，函数名不要超过 50–60 个字符。

以前，基于完全过时的 IBM 标准，标准代码宽度是 80 个字符。现在按照 GitHub 的标准，大概是 120 左右。为角色名设置 1/4 的页面宽度限制，我们得到 30，这足够长了，但并没有填满页面。函数名可以稍微长一点，但是也不应该占满整个页面。因此，通过设置 1/2 页宽的限制，我们得到 60。

例如，样本数据中亚洲男性平均年龄的变量可以写成 *mean_age_men_Asia* 而不是*年龄*或 *x* 。类似的论点也适用于函数名。

**(二)文档字符串和注释**

除了适当的变量名和函数名之外，在任何必要的地方都要有注释和注解，以帮助读者理解代码。

***文档字符串*** —特定于函数/类/模块。函数定义中的前几行文本，描述函数的角色及其输入和输出。文本应该放在一组 3 个双引号之间。

定义<function_name>:</function_name>

" " " "<docstring>" " "</docstring>

返回

***注释*** —可以放在代码中的任何位置，以告知读者特定部分/行的操作/角色。如果我们给变量和函数起一个合适的名字，注释的需求就会大大减少——代码在很大程度上是不言自明的。

## **代码审查:**

尽管这不是编写产品质量代码的直接步骤，但是您的同行对代码的评审将有助于提高您的编码技能。

没有人能写出完美的计算机代码，除非有人有 10 年以上的经验。总会有改进的余地。我见过有几年编写糟糕代码经验的专业人士，也见过有杰出编程技能的正在攻读学士学位的实习生——你总能找到比你更好的人。这完全取决于一个人投入了多少时间来学习、练习，最重要的是提高这一特殊技能。

我知道比你更好的人总是存在的，但是在你的团队中并不总是可能找到他们，只有他们你才能分享你的代码。也许你是你团队中最棒的。在这种情况下，让团队中的其他人测试你的代码并给出反馈是可以的。即使他们没有你好，有些东西可能会逃过你的眼睛，他们可能会抓住。

当您处于职业生涯的早期阶段时，代码审查尤其重要。这将极大地提高你的编码技能。请按照下面的步骤成功审查您的代码。

(I)在您完成所有开发、测试和调试的代码编写之后。确保你没有遗漏任何愚蠢的错误。然后恳请您的同行进行代码审查。

(ii)将您的代码链接转发给他们。不要让他们一次复习几个剧本。一个接一个地问他们。他们对第一个脚本的评论可能也适用于其他脚本。在发送第二个脚本进行审查之前，请确保将这些更改应用于其他脚本(如果适用)。

(iii)给他们一到两周的时间来阅读和测试你每次迭代的代码。还要提供所有必要的信息来测试您的代码，比如样本输入、限制等等。

㈣与他们每个人会面，听取他们的建议。记住，你不必在你的代码中包含他们所有的建议，根据你自己的判断选择那些你认为会改进代码的建议。

(v)重复，直到你和你的团队满意为止。尝试在最初的几次迭代(最多 3-4 次)中修复或改进您的代码，否则它可能会对您的代码能力产生不好的印象。

希望这篇文章是有帮助的，你喜欢阅读它。

我很乐意阅读您的反馈。