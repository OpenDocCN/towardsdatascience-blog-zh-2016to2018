<html>
<head>
<title>Deep Learning with Tensorflow: Part 2 — Image classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">张量流深度学习:第二部分——图像分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-with-tensorflow-part-2-image-classification-58fcdffa7b84?source=collection_archive---------5-----------------------#2017-08-02">https://towardsdatascience.com/deep-learning-with-tensorflow-part-2-image-classification-58fcdffa7b84?source=collection_archive---------5-----------------------#2017-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0b01c709721a6d9ae37f47e29dc13e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vGUfB562XtC6vvmL.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">image classification</figcaption></figure><p id="b729" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">大家好，欢迎回到我的紧张流系列，这是第二部分。<br/>我已经在第一部分描述了神经网络和Tenserflow的逻辑和功能，也向你展示了如何建立你的编码环境。如果你还没有检查过，在这里找到它<a class="ae ld" href="https://medium.com/@m_ko/deep-learning-with-tensorflow-part-1-b19ce7803428" rel="noopener">。</a></p><p id="1662" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">图像识别和分类是这一部分的主题。使用Inception-v3模型，我们将开始使用Google预先训练的ImageNet数据集对图像进行分类，然后继续构建我们自己的分类器。我们开始吧。</p><h2 id="c095" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">什么是inception-v3模型？</h2><p id="2aa0" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated"><a class="ae ld" href="https://github.com/tensorflow/models/tree/master/inception" rel="noopener ugc nofollow" target="_blank"> Inception v3 </a>模型是一个<a class="ae ld" href="https://ujjwalkarn.me/2016/08/11/intuitive-explanation-convnets/" rel="noopener ugc nofollow" target="_blank">深度卷积神经网络</a>，它已经使用2012年的数据为<a class="ae ld" href="http://image-net.org/" rel="noopener ugc nofollow" target="_blank"> ImageNet </a>大型视觉识别挑战进行了预训练，它可以区分1000个不同的类别，像“猫”、“洗碗机”或“飞机”。</p><p id="ce25" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">TensorFlow团队已经准备了关于如何在你的机器上执行图像分类的<a class="ae ld" href="https://www.tensorflow.org/tutorials/image_recognition" rel="noopener ugc nofollow" target="_blank">教程</a>。不过，我还是会给你看的。</p><h1 id="6569" class="mc lf it bd lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp mq mr lv ms bi translated">基于预训练ImageNet数据集的图像分类</h1><p id="c6bb" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">因为我们不是从零开始，所以从克隆GitHub的<a class="ae ld" href="https://github.com/tensorflow/models" rel="noopener ugc nofollow" target="_blank"> Tensorflow模型repo </a> sitory开始。运行以下命令:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="a228" class="le lf it my b gy nc nd l ne nf">git clone https://github.com/tensorflow/models.git<br/>cd models/tutorials/image/imagenet<br/>python classify_image.py</span></pre><p id="69ec" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你还没有安装Git，在这里下载<a class="ae ld" href="https://git-scm.com/download/win" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="cbca" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">当程序第一次运行时，从谷歌的后端下载训练好的模型。您的硬盘上需要大约200 MB的可用空间。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/424af6a171a6d0a367449aa8f061771a.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/0*LKl4k_BABDdpAQuV.jpg"/></div></figure><p id="6212" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">上述命令将对提供的熊猫图像进行分类。</p><p id="ed88" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果模型正确运行，脚本将产生以下输出:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="3b25" class="le lf it my b gy nc nd l ne nf">giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca (score = 0.88493)<br/>indri, indris, Indri indri, Indri brevicaudatus (score = 0.00878)<br/>lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens (score = 0.00317)<br/>custard apple (score = 0.00149)<br/>earthstar (score = 0.00127)</span></pre><p id="e252" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果您希望提供其他图像，您可以通过编辑<code class="fe ng nh ni my b">--image_file</code>参数来实现:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="9c95" class="le lf it my b gy nc nd l ne nf">python classify_image.py --iAmAdifferentImage.jpg</span></pre><p id="514e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这并不难，是吗？但是不要担心，它会变得更有挑战性。上面的脚本允许我们在Google团队预先训练的课程上对图像进行分类。但是如果你想为我们自己的课程重新培训盗梦空间呢？</p><h1 id="7c26" class="mc lf it bd lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp mq mr lv ms bi translated">针对特定类别重新培训Inception的最终层</h1><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="ab gu cl nk"><img src="../Images/62dec6d359337c6490b05fb1b543611f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uXfC5fcbDsL0TJG4T8PsVw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Inception’s layer model</figcaption></figure><h2 id="8b0b" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">设置</h2><p id="7aaf" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">我们将向初始模型添加四个新的类，称为“圆形”、“正方形”、“加号”和“三角形”。</p><p id="0e88" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先从GitHub克隆我的存储库，键入:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="4f7e" class="le lf it my b gy nc nd l ne nf">git clone <a class="ae ld" href="https://github.com/koflerm/tensorflow-image-classifier.git" rel="noopener ugc nofollow" target="_blank">https://github.com/koflerm/tensorflow-image-classifier.git</a></span></pre><p id="b29a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在您克隆了提到的存储库之后，我们必须以某种方式告诉Inception每个图像的正确标签是什么。</p><p id="f355" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因为我们要对一个对象是三角形、正方形、加号还是圆形进行分类，所以我们需要添加一个“training_dataset”目录，并用四个子文件夹填充它，并以“class”标签命名。这些文件夹将包含要进行分类的受试者的数据集(图像)。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="83d5" class="le lf it my b gy nc nd l ne nf">/<br/>--- /training_dataset<br/>|    |<br/>|    --- /circle<br/>|    |    circle1.jpg<br/>|    |    circle_small_red.png<br/>|    |    ...<br/>|    |<br/>|    --- /square<br/>|         square.jpg<br/>|         square3.jpg<br/>|         ...</span></pre><p id="470b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来，我们必须实际获取用于训练过程的数据集。由于手动下载每张图片非常耗时，我们使用了一个名为“<a class="ae ld" href="https://chrome.google.com/webstore/detail/fatkun-batch-download-ima/nnjjahlikiabnchcpehcpkdeckfgnohf" rel="noopener ugc nofollow" target="_blank"> Fatkun批量下载图片</a>”的Chrome扩展。它允许我们从谷歌图片搜索中自动下载前50张图片。只需将它们复制到文件夹中(图像格式并不重要！)</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/c5dfa9057c94df88b1d42ec9f690241a.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*ht_SLEis2EZM9-crWyXlPQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">exemplary training images for class “plus”</figcaption></figure><h2 id="5fe6" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">执行</h2><p id="7d84" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">设置好所有目录和数据集后，开始训练吧！双击执行<code class="fe ng nh ni my b">train.sh</code>脚本。该脚本安装初始模型(如果还没有安装的话),并为指定的图像数据集启动重新训练过程。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f6c9974772e70b071248001461667a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*_pW0vpQRgFXxHkOPMGqRZw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">re-training process</figcaption></figure><p id="d569" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦这个过程完成，它将返回大约90%的训练准确率。</p><p id="483e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">重新培训的标签、图表和培训总结将保存在名为<code class="fe ng nh ni my b">tf_files</code>的文件夹中，以备您查看。</p><p id="a652" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在重新训练模型之后，现在是在我们自己的图像上测试模型的时候了。下载或绘制另一个图像，并将其复制到根目录。我下载了另一张“三角形”图片。通过键入以下命令执行测试:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="5632" class="le lf it my b gy nc nd l ne nf">python classify.py downloadedImage.jpg</span></pre><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c13729f24229e398a540686668c7df61.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*NvTR7MECXqsaIVNwov_fBw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">left: downloadedImage.jpg | right: score for each class</figcaption></figure><p id="2d8e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">太好了，我的三角形居然被归为三角形！</p><p id="b40a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(可选):如果您已经为新类添加了一些图像或子文件夹，但是您不想调用<code class="fe ng nh ni my b">train.sh</code>和<code class="fe ng nh ni my b">classify.sh</code>，您可以通过键入以下命令来合并输入:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="e875" class="le lf it my b gy nc nd l ne nf">python retrain.py — bottleneck_dir=tf_files/bottlenecks — how_many_training_steps=500 — model_dir=inception — summaries_dir=tf_files/training_summaries/basic — output_graph=tf_files/retrained_graph.pb — output_labels=tf_files/retrained_labels.txt — image_dir=training_dataset — eval_step_interval=100 &amp; python classify.py image.jpg</span></pre><blockquote class="no np nq"><p id="83b8" class="kf kg nr kh b ki kj kk kl km kn ko kp ns kr ks kt nt kv kw kx nu kz la lb lc im bi translated">注意:image.jpg是您想要测试的图像</p></blockquote><h2 id="3af7" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">分类问题</h2><p id="02af" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">尽管分类在大多数情况下确实有效，但还是有一些问题:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/229f4cbbe2e5270a7bee102e71ffb1e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*kOBsMsjuimjUkIhjoF1j3Q.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Gets recognized as a plus</figcaption></figure><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/5e529927f43117a7e643af5c897a5569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*HTF-wPg8zF2ZFWWg1rNwmA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Again, not recognized as a circle</figcaption></figure><p id="7b12" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Inception是为单标签图像分类而训练的，这意味着多标签分类是不可能的。如果我仍然想将上面的图像归类为圆形，我只需为该类使用更准确的训练集。这实际上有点费时，单靠Chrome扩展无法为你提供所有最好的结果。</p><h2 id="d67e" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">好了，我们已经看到程序做了它应该做的事情(至少大部分时间)。但是再培训过程是如何进行的呢？</h2><p id="5ac1" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">基本上，该脚本加载预训练的Inception v3模型，移除旧的顶层，并在您想要添加的几何形状类上训练新的顶层。这就是所谓的迁移学习。再培训分为两个阶段——瓶颈和培训:</p><p id="9d1c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">第一阶段分析磁盘上的所有映像，并计算每个映像的瓶颈值。“瓶颈”是一个非正式的术语，指的是实际进行分类的最终输出层之前的层。它将图像处理成有意义且简洁的图像摘要。</p><p id="2880" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">第二阶段是网络顶层的实际训练。您可以看到一系列的步骤输出，每个输出都显示了训练精度、验证精度和交叉熵。训练准确度显示了在训练中使用的图像的百分比被标记为正确的类别。验证准确度是从不同组中随机选择的一组图像的精确度。交叉熵是一个损失函数，它给出了学习过程进展如何的一瞥。</p><p id="3e21" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你想深入了解，请往这边走</p><h1 id="0a76" class="mc lf it bd lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp mq mr lv ms bi translated">结论</h1><p id="d0a9" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">恭喜，你现在能够使用Tensorflow对图像进行分类。在第三部分，我将向您展示Tensorflow的一些其他用例。所以请继续关注，直到下一篇文章！</p><p id="856b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi">__</p><p id="4e7d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">链接到第三部分:<a class="ae ld" href="https://medium.com/towards-data-science/deep-learning-with-tensorflow-part-3-music-and-text-generation-8a3fbfdc5e9b" rel="noopener">https://medium . com/forward-data-science/deep-learning-with-tensor flow-Part-3-music-and-text-generation-8 a3 FB FDC 5 e 9 b</a></p></div></div>    
</body>
</html>