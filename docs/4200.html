<html>
<head>
<title>Deep Latent Factor Models and Variational Inference with Backprop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深层潜在因素模型与反投影变分推理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-latent-factor-models-and-variational-inference-with-backprop-89d4aae0fe34?source=collection_archive---------3-----------------------#2018-07-28">https://towardsdatascience.com/deep-latent-factor-models-and-variational-inference-with-backprop-89d4aae0fe34?source=collection_archive---------3-----------------------#2018-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/5c3cb6b9551c3ab451fe4ede806ce731.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*j4oZHt09rQidiT2T1o0w2A.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Multivariate normally distributed factors generate the image together with complex f(.) function. (Just an illustration of a process)</figcaption></figure><p id="621a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们周围的材料，我们正在目睹的过程和场合，我们拥有的数据集都是我们的观察结果，自然界中有生成模型，我们无法观察但可以生成这些观察结果。潜在因素模型从概率上描述了我们对观察结果生成过程的信念。今天的主题是深度潜在因素模型，这是一种试图用低维(希望是可解释的)因素解释高维复杂数据的统计模型。在深层潜在因素模型中，我们假设有一个复杂的函数，它接受很少的潜在因素作为输入，并生成我们观察到的复杂输出。</p><p id="b278" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">人们可能有各种动机去使用潜在因素模型。可解释性显然是其中之一。想象一下，我们找到了产生面部图像的可解释因素。我们有决定头发形状的因素，决定眼睛颜色的因素，以及决定性别的因素。如果我们有这些因素，我们将能够通过指定它们的一些属性来生成全新的面孔。你可能会说 GANs 也会产生新的看不见的面孔。但是记住 GANs 是从估计的概率分布中抽取样本，完全随机，GANs 中没有属性规范(至少据我所知是这样的。有大量的 GAN 模型，很难跟上人工智能的最新发展。打破维度的诅咒是另一个动机。如果数据的维数很大，并且我们想要训练分类模型，则需要学习的参数数量也很高，并且对于一个良好概括的模型来说需要大量数据。通过降低维度，我们还减少了参数的数量，因此学习所需的数据更少。降维对于可视化也很有用，尤其是当维度可以降到 2 或 3 的时候。这些只是使用潜在因素模型的少数动机。</p><p id="aefa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">快速提示:了解一些期望值最大化算法的知识是理解本文其余部分的先决条件。在毕晓普的《模式识别与机器学习》一书中可以找到见解清晰、数学优雅的精彩章节。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/e3cb13dee414812fd7915599d6bc0f93.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*C7TmCy9FrwPgYM7bICY6UQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">A general graphical representation of latent factor models. z represents latent variable vector. x is observation vector and there are N observations.</figcaption></figure><p id="3e05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始时，我们假设有模型参数θ，我们希望应用最大似然参数估计，即设置参数以使似然分布达到最大值。如果我们知道每个数据的 z 值，估计参数就相当容易了(更多信息，请看看我在 GLM 的文章)。记住，我们的任务之一是估计将 z 值映射到 x 值的参数。如果我们不知道 z 值，那怎么可能呢？EM 算法为我们提供了一种通过迭代应用期望和最大化步骤来实现它的方法。让我们通过定义目标来钻研数学</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/727924706a3906c7b09afb4eab267283.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*k6vppV_TOkQSA5nESqpUfA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Maximum likelihood objective function where X and Z represent all the observations and latent variables respectively. Theta is model parameter(s).</figcaption></figure><p id="6955" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不幸的是，由于需要求和的元素呈指数增长，上述目标包含难以处理的求和操作。为了克服这个问题，我们引入了一个 q(Z)项，并利用<a class="ae lj" href="https://en.wikipedia.org/wiki/Jensen%27s_inequality" rel="noopener ugc nofollow" target="_blank">詹森不等式</a>找到对数似然的一个下界。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lk"><img src="../Images/586122009f25750033fc1476c619a82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pi-QF5gyBrOBSOEAQrMsFw.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Lower bound to log-likelihood which is a function of q and theta</figcaption></figure><p id="4190" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">寻找对数似然性下限背后的动机是，虽然我们不能直接评估对数似然性，但我们可以评估下限，以便我们可以获得关于对数似然性的信息。为此，我们重新排列了下界项，并把它写成对数似然项和一个附加散度项之和。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lp"><img src="../Images/b1193d9746ba604c7b18f039cd3c06d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a0vIqedrfHC3WETkLNI7UQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">loglikelihood can be written as summation of Lower bound and reverse-KL divergence terms</figcaption></figure><p id="2f2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lj" href="https://en.wikipedia.org/wiki/Kullback–Leibler_divergence" rel="noopener ugc nofollow" target="_blank"> KL 散度</a>是一种非对称度量，度量两个概率分布之间的散度，当两个分布相同时，取 0 的值为最小值。正如你所看到的，当 KL 散度取最小值时，对数似然变得等于下限。因此，我们需要使 q(Z)等于 Z p(Z|X)的后部，以使 KL 散度为 0。让我们用 p(Z|X)代替 q(Z)重写 lower bound。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lq"><img src="../Images/a25145847d4fe95d11af42bfdb41b74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hy2GlrP9xL2-pioa3RSJUA.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Changing the q(Z) terms with the posterior of Z which is calculated for the old theta parameters</figcaption></figure><p id="9e5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以评估旧θ参数的对数似然值，它基本上等于旧θ的下限值。但是下限值可以通过优化θ值来增加。下限的第二项仅包括旧的θ参数，对于该部分没有任何作用。但是可以进一步优化第一部分，并且可以增加下界的值。这也意味着对数似然性可以通过估计新的θ值来进一步增加。当你仔细观察第一部分时，你会发现它是一个期望项，对这个期望项求值就形成了 EM 算法的 E 部分。E 步包含了 Z 的后验的推断，所以我们可以用推断步来重命名 E 步。通过估计新的模型参数来最大化下界，这叫 M 步，但我觉得叫学习步没有错。考虑到文章接下来的部分，我倾向于重命名 E 和 M 步骤。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/ff282c63c4c02b399b259f0fac54b7cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*pVX1KAqE9fA3EjlS1cXK9g.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">E and M steps</figcaption></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="fcbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">寻找潜在因素的后验并不总是容易的，尤其是当我们处理复杂的模型时。这一次，我们不是精确地计算后验概率，而是用一个具有可变参数φ的建议分布 q(z)来逼近它。在这种情况下，我们假设没有模型参数。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/d9afb8efa647839328b76886b77fbafa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*WsgPcq-0eSgcjTniBCCELg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">We assume there are no model parameters theta, and we approximate to p(Z|X) by tuning variational parameters phi.</figcaption></figure><p id="7c5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，对数似然是常数，不随 q 和 phi 的选择而变化，但我们不能直接评估它。我们需要做的是巧妙地选择一个变分分布 q(我们试图选择一个与 z 的后验分布尽可能相似的分布族)并优化它的参数φ，以便减小原始后验分布和建议分布之间的 KL 散度。换句话说，我们通过调整输入 q 和 phi 来逼近具有下限的对数似然。寻找函数 q 是变分法的主题，但是对于完全分解的 q(平均场近似)，q 的形式是已知的(更多信息请看 Bishop 的书)。这个过程被称为变分贝叶斯。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="41c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下一部分，我们将深入到深层潜在因素模型的变分推理的细节，我将介绍著名的变分自动编码器。在这之前，我们将重新安排一下下限方程。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lt"><img src="../Images/84bbdf7d474f4da66f6e750a40c8db13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ksS213s0tvd1cUBj4idccQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Rearranging lower bound equation</figcaption></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="0943" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果模型也有参数呢？然后下界变成 q，theta，和 phi 的函数。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lu"><img src="../Images/2633f902cb6138ab1e7a7a7c78b35619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m776ksPbwMxudxGyf3ki9Q.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Lower bound is the function of q, theta, phi</figcaption></figure><p id="d7db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了使问题更简单，我们可以通过考虑共轭性来仔细设计模型，并使用全分解的 q 函数来不优化关于 q 的目标函数。因此，下界需要关于模型参数θ和变分参数φ进行优化。模型参数的估计就是 e M 算法的 M 步。另一方面，变分参数估计与寻找潜在变量的后验有关，因此它是一个推理步骤，构成了 EM 算法的 E 步骤。我们称这个全过程为变分 EM。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="4c66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在考虑一个具有高斯似然的复杂模型，其中均值和协方差是接受潜在因子 z 作为输入的神经网络。我们还将潜在因素的先验分布定义如下。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lv"><img src="../Images/7ca9d08a8d83110456aebacd6ceace25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49A9l6WYdvavRDN-LQYRsg.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">A complex generative model</figcaption></figure><p id="c729" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用经典的变分推理方法很难对如此复杂的模型做出有效的推理。变分推理的最新进展使我们能够在这些复杂的模型中进行推理。在上面的模型中，我们想要估计的模型参数(θ)只不过是神经网络的权重。</p><p id="0541" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于推理，我们将高斯分布指定为变分分布族，但这次我们定义了神经网络结构，该结构将观察值映射到变分分布的均值和协方差(我们可能不喜欢使用观察和推理网络，但在可能的情况下使用它们是明智的)。所以变分 EM 部分的目标变成了</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lw"><img src="../Images/33b0f3e1e36a887e10cf18638654a322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXRMT1PNW8vzvnnHejKH5w.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Lower bound for stochastic training</figcaption></figure><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lx"><img src="../Images/691788b31e752d5ac44f2943200076ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUyd_iUja_odU7jxkYMFPw.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Inference network</figcaption></figure><p id="eb8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有趣的是，观察到每个潜在特征(z_i)都有它自己的变分参数(均值和协方差矩阵),但是这些参数是由作为推理网络权重的观测值(x_i)和全局变分参数(phi)产生的。</p><p id="7ae7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">深度学习社会更喜欢使用损失函数作为目标，因此我们可以最小化它的负值，而不是最大化下界。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ly"><img src="../Images/e1abeeb43103211c6253b250ee7b4b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yC8An7pbU5VD7G434SIE5A.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Loss function</figcaption></figure><p id="9f86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">损失函数定义了一个自动编码器，因为它的第一项试图重建涉及解码器的观测值，而第二项通过试图使观测值尽可能接近先验值来将观测值编码成潜在表示。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lz"><img src="../Images/7f46d4fc95e37adb1b410da6d8ad6655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsU1De6nWeWUplKO9b8r6w.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">KL divergence between two multivariate Gaussians</figcaption></figure><p id="c847" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">损失函数的第二项是两个多元高斯函数之间的 KL 散度，我们知道它的形式。该表达式取决于变分参数φ，并且该项将随着随机梯度下降而相对于φ进行优化。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ma"><img src="../Images/7beb6c4885045bb374b9e08a7ac95e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82Dye_GGqK01NiI-rqShGA.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Monte Carlo integration to estimate expectation</figcaption></figure><p id="727f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一项是一个期望值，我们可以用蒙特卡罗积分来估计它，而不是用解析方法计算(我们不能)。这里的问题是，在从 q(z|x)采样 z 之后，我们失去了与变分参数的所有联系，并且不能优化 w.r.t .变分参数项，尽管该项依赖于它们。重新参数化技巧是克服这个问题的好方法。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mb"><img src="../Images/3b8989f5876e6be707f1ec6cc3bd22e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NdxVOmKjxiTwvatWy4c3SA.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Reparametrization trick</figcaption></figure><p id="a2e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在重新参数化技巧中，我们将样本 z 写成具有参数μ和适马的确定性函数的输出，输入ε是来自零均值单位方差正态分布的样本。现在我们可以用链式法则(dE/dz * dz/dphi)优化 w.r.t .变分参数项。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="f540" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我试图从众所周知的 EM 算法开始解释变分自动编码器的基本思想。有趣的是，通过在目标函数中引入具有小更新的推理网络，我们得到了一种特殊类型的正则化自动编码器，这使得我们能够运行具有反向传播算法的变分 EM 的 E 和 M 步骤。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="0727" class="mc md iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">参考</h1><p id="fc66" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">金玛、迪德里克·p 和马克斯·韦林。<a class="ae lj" href="https://arxiv.org/abs/1312.6114" rel="noopener ugc nofollow" target="_blank">“自动编码变分贝叶斯”</a> <em class="nf"> arXiv 预印本 arXiv:1312.6114 </em> (2013)。</p><p id="8c1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">毕晓普的模式识别和机器学习书</p><p id="6934" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lj" href="https://chrischoy.github.io/research/Expectation-Maximization-and-Variational-Inference/" rel="noopener ugc nofollow" target="_blank"> EM 和变分推理</a></p></div></div>    
</body>
</html>