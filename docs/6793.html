<html>
<head>
<title>GraphQL schema use case and functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraphQL 模式用例及功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/graphql-schema-use-case-and-functions-731ec4a39061?source=collection_archive---------25-----------------------#2018-12-31">https://towardsdatascience.com/graphql-schema-use-case-and-functions-731ec4a39061?source=collection_archive---------25-----------------------#2018-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0444" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 graphql-tools 复制、混合和定制现有的 API</h2></div><p id="2e2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我介绍了 GraphQL API 的一些用例。对于新 API 的创建，有用的功能有“远程模式”、“模式拼接”、“模式转换”。它们能够复制、混合和定制现有的 API 模式。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="dee4" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">用例</h1><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/4dc3955e19bd97d48ef2f585652fe136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jl7pnq_j-4wyyqke.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">One API service called “Gian” is created from existing APIs called “Nobita” and “Suneo”</figcaption></figure><p id="6827" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时我们使用现有的 API 来创建新的 API。有人会从别人的 API 中复制 API 模式。其他人会将一个 API 模式与另一个 API 模式混合在一起。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mq"><img src="../Images/96b47ee36210e3542bfe84e942825a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6Z22lE8hrjQVWTx5.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">“Gian” web service frontend utilizing API “manga” originated in “Nobita” API</figcaption></figure><h2 id="80c8" class="mr lj iq bd lk ms mt dn lo mu mv dp ls ko mw mx lu ks my mz lw kw na nb ly nc bi translated">如果您在 REST API 世界中</h2><p id="5686" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">这是一个 web 服务“Gian”的用例。这个服务有一些 API(REST API)。大多数 API 源自其他服务“Nobita”和“Suneo”。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ni"><img src="../Images/f0e7c4a8b80771f64ccabb2fa19af76c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k1BQYLIYPnAwXsPD.png"/></div></div></figure><ol class=""><li id="96fa" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la no np nq nr bi translated">“漫画”API 是从一个服务大雄<strong class="kh ir">复制</strong>而来，“游戏”API 是从一个服务 Suneo】复制而来</li><li id="4743" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">服务巨人融合了服务大雄和服务太阳</li><li id="1446" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">orenomanga 的 API 是原创的，但它的内容来自“漫画”API。服务 Gian 修改 API 的内容。(例如。添加新字段或重命名现有字段。)</li></ol><p id="2485" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用 API 网关工具，但是管理许多 API 是一件困难的事情。</p><h1 id="268f" class="li lj iq bd lk ll nx ln lo lp ny lr ls jw nz jx lu jz oa ka lw kc ob kd ly lz bi translated">有用的功能:在 GraphQL 世界中复制、混合和定制模式</h1><p id="bd6d" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">GraphQL 和一些工具为复制、混合和定制 API 准备了有用的函数。</p><ul class=""><li id="36a3" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la oc np nq nr bi translated">[初步]模式自省</li><li id="09a8" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">API 复制的远程模式</li><li id="dd99" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">用于 API 混合的模式拼接</li><li id="429f" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">用于 API 复制和定制的模式委托</li><li id="f968" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">用于 API 定制(修改)的模式转换</li></ul><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi od"><img src="../Images/6749ed0044271739c8f48acfd17ee133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sUzxYlR2eSdYQNSk.png"/></div></div></figure><h2 id="8086" class="mr lj iq bd lk ms mt dn lo mu mv dp ls ko mw mx lu ks my mz lw kw na nb ly nc bi translated">初步知识:GraphQL 中的模式检查</h2><p id="8e05" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">在 GraphQL 中，你只用 GraphQL Schema 语言定义数据类型，然后 GraphQL 服务器自动提供 API 和文档并发布。例如，服务 Nobita 定义了以下数据类型。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="db41" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GraphQL 模式语言包括数据名称、类型和描述。这些信息被重组为 API 规范文档的格式，称为自省。您可以通过特殊查询<code class="fe og oh oi oj b">__schema.</code>向 GraphQL 服务器请求这些信息</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ok"><img src="../Images/ce89879ef01c08dc68ccd232ae8b58e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lkZcwfGWBBwD_qnF.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">GraphQL schema creates API and document (__schema) automatically.</figcaption></figure><p id="6ba9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自省使 GraphQL 服务器和客户机能够共享模式并验证查询。</p><h2 id="b79d" class="mr lj iq bd lk ms mt dn lo mu mv dp ls ko mw mx lu ks my mz lw kw na nb ly nc bi translated">功能 1(复制一个 API)“远程模式”</h2><p id="05e1" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated"><strong class="kh ir">远程模式</strong>从远程 GraphQL 服务器获取 API 模式🤔。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ol"><img src="../Images/44c978811080122cb6846c7e6d52b63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cGwGugHOXiKlQ_ru.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Remote schema enables Gian to copy Nobita’s API schema and reproduce it.</figcaption></figure><p id="7385" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当大雄 web 服务正在发布其 API 文档时，<code class="fe og oh oi oj b">graphql-tools makeRemoteExecutableSchema</code> <a class="ae om" href="https://www.apollographql.com/docs/graphql-tools/remote-schemas.html" rel="noopener ugc nofollow" target="_blank"> (→ref) </a>可以获取 API 文档并复制 API。此函数接收远程 GraphQL 服务器 URL 作为参数。<code class="fe og oh oi oj b">introspectSchema</code>在通常情况下连用。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Web service Gian. (gian.ts)</figcaption></figure><p id="fe76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe og oh oi oj b">graphql-tools</code>中的<code class="fe og oh oi oj b">makeRemoteExecutableSchema</code>获取大雄的 API 文档(__schema)并在该服务器中生成可执行的 API 和自己的文档。😲</p><p id="7e0d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个 web 服务器从下面几行开始😜</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Starting web service Gian</figcaption></figure><h2 id="6cb1" class="mr lj iq bd lk ms mt dn lo mu mv dp ls ko mw mx lu ks my mz lw kw na nb ly nc bi translated">功能 2(混合 API)“模式拼接”</h2><p id="4626" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">融合大雄的 API 和 Suneo 的 API(模式拼接)🤔</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi on"><img src="../Images/62b82f2806e328dda1b19bf58c73331d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JkAcbDNv9lwNEHxa.png"/></div></div></figure><p id="a624" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe og oh oi oj b">graphql-tools</code>的<code class="fe og oh oi oj b">mergeSchemas</code>(→<a class="ae om" href="https://www.apollographql.com/docs/graphql-tools/schema-stitching.html" rel="noopener ugc nofollow" target="_blank">ref</a>)作为模式拼接工具非常好用。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1863" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">过程</p><ul class=""><li id="8257" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la oc np nq nr bi translated">使用远程模式获取 Nobita 和 Suneo 的模式(上一节)</li><li id="973d" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">将模式数组传递给<code class="fe og oh oi oj b">mergeSchemas </code>参数<code class="fe og oh oi oj b">schemas</code></li></ul><p id="5d48" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了一个新的服务，包括现有的多个 API😀</p><h2 id="c527" class="mr lj iq bd lk ms mt dn lo mu mv dp ls ko mw mx lu ks my mz lw kw na nb ly nc bi translated">功能 3(复制和定制 API)“模式委托”</h2><p id="600a" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">当您想要复制 API 模式并进行一些定制时(例如重命名查询字段)，可以使用<code class="fe og oh oi oj b">Schema Delegation</code>的<a class="ae om" href="https://www.apollographql.com/docs/graphql-tools/schema-delegation.html" rel="noopener ugc nofollow" target="_blank">(→ref)<code class="fe og oh oi oj b">graphql-tools.</code>的</a></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oo"><img src="../Images/22735cd169f83995b4af688888d25ff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Oalja0iaZIyocMOP.png"/></div></div></figure><p id="6b56" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在 query <code class="fe og oh oi oj b">resolver</code>中使用<code class="fe og oh oi oj b">delegateToSchema</code>，然后你让你的服务器上的任何请求转移到指定的服务器并进行查询。</p><p id="821b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下示例显示了将原始的<code class="fe og oh oi oj b">manga </code>查询重命名为另一个名称<code class="fe og oh oi oj b">orenomanga</code>😳</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="84a0" class="mr lj iq bd lk ms mt dn lo mu mv dp ls ko mw mx lu ks my mz lw kw na nb ly nc bi translated">功能 4(修改 API)“模式转换”</h2><p id="697c" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">当你想定制一个现有的 API(例如删除查询字段)，你可以使用<code class="fe og oh oi oj b">Schema Transforms</code><a class="ae om" href="https://www.apollographql.com/docs/graphql-tools/schema-transforms.html" rel="noopener ugc nofollow" target="_blank">(→ref)<code class="fe og oh oi oj b">graphql-tools.</code>的</a></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi op"><img src="../Images/9a0359d3c26188ec21b00589d81d0eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NRWbEOU3N92NraYs.png"/></div></div></figure><p id="0ccb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下示例暗示原始查询<code class="fe og oh oi oj b">manga</code>被 Gian 移除😱</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4ce1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe og oh oi oj b">transformSchema</code>的第二个参数是转换类型。在本例中，它被设置为<code class="fe og oh oi oj b">FilterRootFields</code>，这意味着“场移除”。</p><p id="f14b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其他转换</p><ul class=""><li id="b906" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la oc np nq nr bi translated"><strong class="kh ir">过滤器类型</strong> /移除类型/有时使用</li><li id="bbb3" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">有时重命名类型/使用</li><li id="32c0" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated"><strong class="kh ir"> TransformRootFields，RootField / </strong>修改查询、变异、订阅/很少使用之一</li><li id="092d" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated"><strong class="kh ir"> FilterRootFields / </strong>删除字段/使用大部分</li><li id="319b" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated"><strong class="kh ir">重命名根字段</strong> /重命名字段/常用</li><li id="473e" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated"><strong class="kh ir"> ExtractField / </strong>换路径/不太懂……</li><li id="eaef" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated"><strong class="kh ir"> WrapQuery </strong> /也许全能/不太懂…</li></ul><h1 id="fd57" class="li lj iq bd lk ll nx ln lo lp ny lr ls jw nz jx lu jz oa ka lw kc ob kd ly lz bi translated">摘要</h1><p id="e52f" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">GraphQL 和<code class="fe og oh oi oj b">graphql-tools </code>是优秀的工具🍺</p><ul class=""><li id="e6c9" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la oc np nq nr bi translated">复制/ <code class="fe og oh oi oj b">makeRemoteExecutableSchema,</code> <code class="fe og oh oi oj b">introspectSchema</code> / <strong class="kh ir">这么有用</strong></li><li id="d6fe" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">迸/ <code class="fe og oh oi oj b">mergeSchemas</code> / <strong class="kh ir">有用的</strong></li><li id="8e0a" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">定制/ <code class="fe og oh oi oj b">transformSchema</code> /也许有用</li></ul><p id="30a0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我没有提到模式指令。您可以通过身份验证来限制访问。</p><h1 id="0521" class="li lj iq bd lk ll nx ln lo lp ny lr ls jw nz jx lu jz oa ka lw kc ob kd ly lz bi translated">遗留问题</h1><p id="6812" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">如果重用 API，可能会遇到新的问题。</p><ul class=""><li id="36bb" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la oc np nq nr bi translated">N+1 problem⌛️ <br/>有时候，会出现性能问题。模式拼接可能会从一个请求带来 N+1 个请求的结果。用于批处理查询的数据加载器对于这类问题是有效的。数据加载器由来自脸书的 GraphQL 联合开发者 Lee Byron 开发。</li><li id="5db2" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la oc np nq nr bi translated">版权问题👁<br/>当您使用任何其他人的 API 时，您必须遵守规则。例如，当重用的 API 需要 creative commons cc-by 时，必须说明作者的姓名。您可以向 GraphQL 响应添加元数据，并使用中间件进行定制。</li></ul><h1 id="3c8a" class="li lj iq bd lk ll nx ln lo lp ny lr ls jw nz jx lu jz oa ka lw kc ob kd ly lz bi translated">摘要</h1><p id="1c5a" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">GraphQL 工具(远程模式和模式拼接)支持复制、混合和定制 API。很简单。</p></div></div>    
</body>
</html>