<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://towardsdatascience.com/crash-your-data-science-code-before-it-is-too-late-d4697c836a1d?source=collection_archive---------15-----------------------#2018-11-07">https://towardsdatascience.com/crash-your-data-science-code-before-it-is-too-late-d4697c836a1d?source=collection_archive---------15-----------------------#2018-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f6e9cbfd2075c284a2c23e83f8ea979c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94hSQw1yT0coBlpnEGP-LQ.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/photos/fzjWFym9jjE?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Dlanor S</a> on <a class="ae jd" href="https://unsplash.com/search/photos/warning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d3e6" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">当你的脚本崩溃时，你有什么感觉？如果剧本在制作中，你就有问题了。即使不在生产中，也不是地球上最好的感觉。不管它让你感觉如何，一个崩溃的脚本对你来说是一件好事。在正确的地点和时间崩溃的脚本可以节省您大量的时间和精力。</p><p id="983d" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">当我们编码时，我们不断地做出假设。这些假设是我们对数据的期望，代码将如何被使用，等等。有时我们会主动做出假设。其他时候，我们甚至没有意识到我们什么时候犯了这些错误。假设在代码中随处可见。甚至用一个变量除一个数都包含假设。假设可以保存你的代码，或者在最意想不到的地方和时间破坏它。假设是不可避免的，但是可以被检验。</p><p id="c3f5" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">让我来告诉你一个最简单的分歧是如何造成灾难性后果的。在这个例子中，我们将 1 除以一个变量(1/var)。如果变量的值为零，您将得到一个错误。虽然这在大多数情况下是正确的，但一些库(如 numpy)允许这样做。在这些情况下，表达式将产生无限值。</p><figure class="ke kf kg kh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kd"><img src="../Images/25f061b4f62f93fd5f5ebd88d68418d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKiQ0m9b32AKzB9xWe_mCQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">While python (std) gives an error, numpy results a division by 0 with infinity.</figcaption></figure><p id="377a" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">如果代码抛出一个错误，比继续处理错误数据要好。这是因为如果你的代码停在那里，你会立即知道有问题。此外，你会知道问题的确切位置。如果它不停止，您的代码将继续运行，并继续执行损坏/错误的数据。根据代码的不同，这个问题可能会像疾病一样传播。它可能用损坏的数据更新数据存储，或者启动需要几天的训练序列。在任何情况下，由于问题已经传播到后来的状态，检测和调试问题将是一个更大的麻烦。</p><p id="ca64" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">没有在正确的地方崩溃的程序会引起大麻烦。如果程序没有任何错误地完成，甚至发现有问题也可能是困难的。在数据科学领域，这是一个更加具体的问题。我们经常与不确定性和复杂的机器学习系统一起工作。如果你的系统是随机的和/或有机器学习组件，奇怪的结果变得更难证明。当代码有问题时，通常会将意外结果归咎于机器学习组件，反之亦然。</p><p id="0d11" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">在讨论了代码中假设的重要性之后，让我来介绍一下我的方法。假设可能很危险，但幸运的是它们很容易被检验。我学到的最简单的方法是在代码中检查尽可能多的假设。每次运行时，检查是为了确保假设在运行时仍然成立。在 python 中，我们可以用<code class="fe ki kj kk kl b">assert</code>来检查假设(以及其他东西)。表达方式很简单。语法如下:</p><p id="0490" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated"><code class="fe ki kj kk kl b">assert &lt;&lt;the expression that must be always true&gt;&gt;</code>，或者:</p><p id="10cf" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated"><code class="fe ki kj kk kl b">assert &lt;&lt;the expression that must be always true&gt;&gt;, &lt;&lt;string that will be printed if not&gt;&gt;</code></p><p id="d72c" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">事情就是这么简单。Assert 只做一件事。在运行时，它检查表达式是否为真。如果不是，它将使程序崩溃。如果你提供了一个字符串，当它崩溃时，它将打印这个字符串。如果表达式为真，它不会做任何事情。程序流程将简单地继续。</p><p id="f653" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">例如，让我们检查一下列表的长度。让我们假设我们从不期望列表是空的。针对这种期望(假设)的测试就像这样简单:</p><p id="cd42" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated"><code class="fe ki kj kk kl b">assert len(mylist) &gt; 0</code>或者<code class="fe ki kj kk kl b">assert mylist</code></p><p id="39f6" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">如果<code class="fe ki kj kk kl b">mylist</code>是空的，那么这个单独的行将会破坏你的脚本。当它崩溃时，您将看到断言失败，并且您将确切地知道导致崩溃的原因。</p><figure class="ke kf kg kh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi km"><img src="../Images/64d9de1d182ce2e2e6a5dc5d34e47992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P07WA9KDEKazyrnCASBpLg.png"/></div></div></figure><p id="9b35" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">有时断言本身可能不是描述性的。更好的做法是放置一条描述性消息，说明断言失败的原因。</p><p id="18ff" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated"><code class="fe ki kj kk kl b">assert mylist, "Expected non-empty list, got an empty one"</code></p><figure class="ke kf kg kh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kn"><img src="../Images/1893ef1b69a136e9d594b315f23291ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtdMyxQ257__3HKiABgfmQ.png"/></div></div></figure><p id="ea11" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">作为另一个例子，让我们回到除法的例子。在这个例子中，我们将有一个函数，它接受一个 numpy 数组并用该数组除 1。为了便于演示，让我们假设我们不希望数组中有任何零值。这是一个相当合理的假设。使用不定式是不常见的。</p><figure class="ke kf kg kh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ko"><img src="../Images/af3e769300f2678a410663f829773474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8s7YQETTCch6sIB6tTUgA.png"/></div></div></figure><p id="46aa" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">如您所见，该数组包含一个零数字，这导致生成的数组中的一个元素为无穷大。有一个警告，但它很容易被忽视。相反，让它像这样继续下去，我们可以放一个断言来检查我们的假设:</p><figure class="ke kf kg kh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kp"><img src="../Images/809441cd72b0dd9dcf8bb282ac0f7928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hsmXrgdtSNFd3Onh10mLOw.png"/></div></div></figure><p id="301a" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">像编写测试一样，最好在编码时放置断言。不要等到完成了一大段代码才放置断言。当你编码时，你不断地思考这个问题。因此，在更改或添加代码时进行检查是最好的方法。如果你等待，你可能不会有同样的心态。</p><p id="8bee" class="pw-post-body-paragraph je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ij bi translated">尽管本文中的例子很简单，但是您可以在各种场合使用断言。一个例子可能是检查数据分布。例如，您可以使用 KL-Divergence 来检查一个特性的分布是否仍然类似于运行时的训练。我发现另一个非常有用的方法是在每个数据处理步骤之后检查特征排序是否仍然相同。尤其是在数据科学领域，我们无法逃避假设。但是我们可以检查它们以交付高质量和有效的结果/代码。</p></div></div>    
</body>
</html>