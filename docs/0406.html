<html>
<head>
<title>Analytics on the New York rental market | Top 15% on Kaggle!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">纽约租赁市场分析| ka ggle排名前15%的网站！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analytics-on-the-new-york-rental-market-top-17-on-kaggle-91bb139d8f4b?source=collection_archive---------2-----------------------#2017-04-28">https://towardsdatascience.com/analytics-on-the-new-york-rental-market-top-17-on-kaggle-91bb139d8f4b?source=collection_archive---------2-----------------------#2017-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7122b08d6c0ebeaed71b44622712a19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0D4-N-LZeockF4UtaRbnSg.jpeg"/></div></div></figure><p id="2d35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我第一次认真参与Kaggle竞赛的文档资料——rent hop租赁咨询。两个半月，<a class="ae kw" href="https://github.com/shubh24/renthop" rel="noopener ugc nofollow" target="_blank"> 146 git提交</a>和<a class="ae kw" href="https://kaggle.com/shubh24" rel="noopener ugc nofollow" target="_blank"> 87提交</a>之后，我站在排行榜的<a class="ae kw" href="https://kaggle.com/shubh24" rel="noopener ugc nofollow" target="_blank">前15% </a>之内——一个我引以为豪的位置！</p><p id="b332" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kaggle比赛是由Renthop组织的，rent hop是一家专门针对纽约市场的租赁网站。给定各种列表参数，如价格、位置、经理(经纪人)、建筑、图像，我们必须预测每个租赁列表将获得的兴趣(互联网流量)。“兴趣列表”是一个离散变量，分为“高”、“中”和“低”。</p><p id="ea63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个竞赛的领域引起了我相当大的兴趣——就在4个月前，我还在班加罗尔混乱的房地产市场中沮丧地寻找一个像样的地方！再加上竞争激烈的纽约市场，我们有一个现实世界的问题等待解决。</p><p id="9891" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我的旅程</strong> —对我来说，这场比赛真是过山车——我的情绪和我的排行榜位置之间绝对存在正相关关系！不过，我学到了很多，从疯狂的功能工程到实现新算法，从修复验证漏洞到构建我的定制stacker-ensemble——这种学习为未来的竞争提供了一个很好的跳板。</p><p id="1bf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">也就是说，这篇博客有点技术性。可以的话就离开；)</em></p><p id="0d73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我构建预测模型的标准方法是在标准变量上构建一个随机森林。没有太多的探索或特性工程——这种方法没有给我带来好处。在这次比赛中，我花了前两个月的时间来理解这些特性，并尝试它们的组合。</p><p id="6750" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">特征工程</strong></p><p id="58db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">价格</em> —最明显的特征之一是租赁列表的价格(价格的对数)，这导致了一个更好的衡量标准——每间客房的价格。当与邻里或街道等其他变量相结合时，价格可以很好地代表“这是21街上最好的公寓吗？”。不过，对于一室公寓来说，这个功能有点棘手，因为根据定义，一室公寓没有卧室。</p><p id="3677" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经理人 —纽约市场将经理人(或经纪人)视为高度可信的来源，这一点从经纪人代理机构的关系中可以看出。由于manager_id是一个高度分类的变量，kagglers的同事们想出了一个巧妙的特性——“manager _ score”！它基本上是该经理的“高兴趣”列表和“中等兴趣”列表的百分比的组合。这是我几乎所有模型中最重要的特征。</p><p id="57ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我提出了“经理机会”的概念，它表明一个经理的列表相对于通过同一经理的其他列表有多好。基本上，将租金价格与经理的中值价格进行对比——“布朗先生，你有更便宜的2BHK公寓吗？”</p><p id="2bf9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">建筑物——这个特征应该是致命的，因为这是我们在谈论地点时所能得到的最狭窄的范围。我试着映射像“建筑分数”、“建筑机会”、“建筑数量”这样的特征，但是它们都抛弃了我的简历分数。许多Kagglers也经历了同样的情况，最可能的原因似乎是坏的数据点-16.8%的建筑物具有building _ id“0”，尽管它们具有不同的坐标。然而，对建筑物的一个积极认识是，90%的“零建筑物标识”的建筑物是“低兴趣”的，至关重要！</p><p id="8a98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">邻域</em> —普通的旧纬度和经度被证明是相当重要的特征，但我们并没有就此止步:)一个包含60个聚类的简单k-means给了我广泛的邻域，从而产生了诸如“neighborhood_score”和“neighborhood_opportunity”等特征。最初，我使用Google API将坐标映射到广阔的区域(正如Renthop网站上提到的)。</p><figure class="kz la lb lc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ky"><img src="../Images/d95cb059625b452486bf0caf21865822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UEZO2VUyv31Kmrb1.jpg"/></div></div></figure><p id="1306" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着我构建越来越多的功能，我注意到一个共同的主题——价格和兴趣是核心部分，而“经理”、“邻居”、“建筑”、“街道地址”、“邮寄时间”是外围部分。当外围部分通过中间部分(或计数，或某种一般化)与中心部分整合时，会产生显著的改进。这张图是我接下来几天的必看之物:)</p><p id="fae8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">街道/显示地址</em> —提供了两种地址，街道地址和显示地址，这是街道地址的一种精简形式。我尝试了像“公寓_计数_街道”这样的功能(这条街道的出租有多受欢迎？)和通用的“street_opportunity”。</p><p id="320a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我对街道地址的另一个想法是，它们是否包含“街道号码”，这应该有助于“地址的准确性”(Renthop关心的一个变量！).结果没什么帮助。</p><p id="c19b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个从kaggler同事那里借来的想法——String Difference b/w the street _ address和display_addres。这是一个相当大的差异，在“高利息”，而不是一个清晰的想法为什么！</p><p id="44e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">发布时间</em> —当然，作为季节性业务，基于时间的功能派上了用场(mday，wday，hour，minutes)。我们无法探究年度季节性，因为数据集夹在2016年4月和2016年6月之间。</p><p id="151b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">据报道，Renthop上的一个房源停留时间为5-6分钟，竞争非常激烈！这促使我查看哪些房源是在同一小时内发布的，结果是“hour_opportunity”(在过去的30分钟内是否有更便宜的公寓发布？").这个特性并没有带来改进，尽管一个类似的特性很有用——“hour _ frequency”(那个小时发布的列表数量)。这可能会影响到一天中特定时段的在线消费者数量。</p><p id="ed1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> Listing_Id </em> —这只是一个普通的序列号，至少我是这么认为的！结果证明这是一个非常重要的特性，因为它与“创建的”变量惊人地相关。此外，还有一些离群的列表，它们的listing_id比同一天发布的租赁的listing_id中值要高。而这些离群值中有很大一部分是“低兴趣”，陪审团对为什么会有分歧！</p><p id="d3f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无论如何，这是一个令人难以置信的洞察力——有时，序列id可能与其他变量有很大关系！</p><p id="0700" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">描述</em>——这应该是关于公寓的微小细节的宝藏，比如“允许携带宠物”、“门卫”、“电梯”等等。许多人尝试了著名的tfidf算法，但无济于事——我的假设是，人们最初是根据价格、位置和经理表现出兴趣的。细节在租赁后期考虑(就在最终确定之前？).</p><p id="c00d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想到的几个功能与识别描述中的垃圾邮件有关——可能，我是第一个公开这些内容的竞争者:)计算了大写字母的百分比和感叹号的数量——“啊！！你喜欢这个描述吗？！!"</p><p id="8253" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还尝试将电话号码或电子邮件地址作为一个因素变量。虽然没帮上什么忙。</p><p id="2735" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Renthop评分——在试图提取租户的使用模式时，我发现了一些见解。他们中的大多数人受到了Renthop分数的启发(Renthop根据这个内部计算的分数对列表进行排名)。我也尝试了一些基于主要特征的经验公式，但是几乎总是增加我的对数损失。一个重要的学习——总是组合单调的特征，随机分割或对数不起作用。</p><p id="715f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">高基数特性的基数</em>—Branden Murray的内核向我们kagglers介绍了一个漂亮的特性，用于计算经理的高分、中分或其他分类变量。</p><p id="cff1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我解释一下。经理M有“n”个列表，假设有“M”个经理。如果经理M的列表通常具有“高兴趣”,我们想要奖励他。我们如何对此进行量化？经理X可能只有两个都是“高兴趣”(100%命中率)的列表，但是经理Y可能有100个列表，其中60个是“高兴趣”(60%命中率)。我们应该倾向于经理Y，因为他的一致性，而不是经理X(成功，但短暂的职业生涯)。</p><p id="5bdd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要对此进行量化，请计算一个全局高比率(整体高利息百分比)并计算经理的高利息百分比。用λ将它们合并，λ与他的计数的负对数成反比。</p><p id="25f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经理高分=(经理高百分比)(lambda) +(全局高百分比)(1 — lambda)，其中lambda = 1/(c + e^(-count/d)，c和d为经验常数</p><p id="5530" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，当经理的(发布的列表)计数达到最高时，我们看重他的百分比，反之，我们看重他的全球百分比。</p><p id="1687" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">主要学习—验证漏洞</strong></p><p id="d5c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在建立我的验证渠道时，我观察到我的本地简历分数一直比我的公开简历分数好。当我往下钻的时候，泄漏的源头让我大吃一惊，那是我的第一手经验；)显然，在计算manager_score时，我必须计算高兴趣、中等兴趣和低兴趣列表的百分比。我对整个训练集进行计算，然后对该训练集本身的子集计算logloss，因此引入了泄漏。后来我做了一个函数，它根据给定的训练集、验证集和测试集分别计算这些百分比。</p><p id="b915" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">另一种学习——分层拆分</strong></p><p id="e2fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就兴趣水平而言，数据集非常不平衡——只有7.8%的列表是“高兴趣”，22.8%是“中等兴趣”。因此，当为了验证而进行分割时，我特意做了分层分割，以保持平衡。</p><p id="74ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">成功的模型</strong></p><ul class=""><li id="03b5" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">H2O . GBM——我在整个锦标赛中的主要工作。我已经手动调到接近最佳状态，我希望；)</li><li id="9e67" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">XGBoost — XgBoost是爱。XgBoost就是生活！在性能方面与gbm相当</li><li id="cdce" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">H2O . RF——一种易于设置的算法，但结果不如gbm和xgboost。</li></ul><p id="2891" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总的来说，我应该自动调整我的算法。目前是一个非常手动和缓慢的过程。此外，我意识到模型种子相当重要，多次运行平均(用不同的种子)是有益的。虽然放弃了，时间限制:(</p><p id="0131" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">不起作用的模型</strong></p><ul class=""><li id="0056" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">H2O.deeplearning没有给出一个好的结果，可能是一个糟糕的超参数选择的结果。还是那句话，不擅长调音。</li><li id="4527" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">extra trees——一个随机化的随机森林，让它工作了，但是我的系统没有足够好的ram来进行适当的测试</li><li id="0a88" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">SVM、KNN、Logreg——所有更简单的ML模型都存在空值问题，并且没有给出好的结果。</li></ul><p id="0317" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">堆叠</strong></p><figure class="kz la lb lc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ky"><img src="../Images/932f5b5d2cc4ce8574b7f61dac0a34c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7MAgxvJgcGdqKFna.jpg"/></div></div></figure><p id="fec5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我第一次学习stackers，阅读了MLWave的<a class="ae kw" href="https://mlwave.com/kaggle-ensembling-guide/" rel="noopener ugc nofollow" target="_blank">不可思议的解释者博客</a>，并着手实施我自己的！最初我失败得很惨，又看了一遍博客，终于明白了堆叠的本质。慢慢；)</p><figure class="kz la lb lc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ky"><img src="../Images/ef19885624cab1b7e28614dc8592fe39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wu99czsxBhJnAUiG.jpg"/></div></div></figure><p id="b363" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，我有一个3层堆垛机，但没有太多的多样性。前两层由我的3个工作模型组成——XGBoost、GBM和RF。第三层是第二层模型的简单集合。或许，更关注简单的模型会给我带来更多的多样性——尽管如此，我还是获得了相当不错的0.01的跳跃:)</p><p id="fd1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">注意:对于我的最终提交，我用一个</em> <a class="ae kw" href="https://www.kaggle.com/brandenkmurray/two-sigma-connect-rental-listing-inquiries/it-is-lit/" rel="noopener ugc nofollow" target="_blank"> <em class="kx">出色的公共脚本</em> </a> <em class="kx">对我的提交进行了平均。可能每个人都在这么做。)</em></p><p id="cfb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">魔法特性</strong></p><p id="27b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在比赛的最后一周，Kaggle上一位非常慷慨的大师KazAnova发布了一个非常强大的漏洞——图像文件夹的时间戳。仅仅插入时间戳就给了大多数人0.01的跳跃。我试着挖掘时间戳，它与“创建”变量的关系等等——这很可能是一个内部原因。</p><p id="d1b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个类似的神奇特性是包含在图像URL中的listing_id——大多数与原始的listing _ id相同。那些不同的列表可能是同一套公寓的转贴，这表明它还没有被出售→“低利息”</p><p id="02cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">结论</strong></p><p id="9ed2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我从比赛中获得的主要收获是:</p><ul class=""><li id="c298" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">探索每一个变量。他们每一个人。查看数值的平均值、中值、最大值、异常值，以及类别的分布</li><li id="0553" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">把大部分时间花在特色上。当你认为你已经拥有了一切，再从头开始。</li><li id="54e7" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">建立一个系统的管道。很容易引入漏洞</li><li id="ed65" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">快速构建和测试。拥有高效、快速、易于调整的算法进行测试。</li><li id="c812" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">搭建一个模型测试平台，堆叠变得容易。</li><li id="413f" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">花大量时间在Kaggle内核和讨论上。他们太酷了:)</li></ul><p id="4ce5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总的来说，这是有趣的几个月！学到了很多，这只是未来比赛的起点。很快就会达到前10%:)</p><p id="6e04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">此文最初发布在我的</em> <a class="ae kw" href="https://shubh24.github.io" rel="noopener ugc nofollow" target="_blank"> <em class="kx">博客</em> </a> <em class="kx">上。每周一篇博客</em></p></div></div>    
</body>
</html>