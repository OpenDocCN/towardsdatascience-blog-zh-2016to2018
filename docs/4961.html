<html>
<head>
<title>How to train Deep Learning models on AWS Spot Instances using Spotty?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Spotty 在 AWS Spot 实例上训练深度学习模型？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-train-deep-learning-models-on-aws-spot-instances-using-spotty-8d9e0543d365?source=collection_archive---------5-----------------------#2018-09-18">https://towardsdatascience.com/how-to-train-deep-learning-models-on-aws-spot-instances-using-spotty-8d9e0543d365?source=collection_archive---------5-----------------------#2018-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/806d2b3a4ff837ee7d2642c115680b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AfUuMYN8qj9Mqqy0eP6C2w.png"/></div></div></figure><p id="46e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/apls777/spotty" rel="noopener ugc nofollow" target="_blank"> Spotty </a>是一个工具，它极大地<strong class="ka ir">T5】简化了 AWS 上深度学习模型的训练。</strong></p><h2 id="83ec" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">你为什么会❤️这个工具？</h2><ul class=""><li id="df55" class="lq lr iq ka b kb ls kf lt kj lu kn lv kr lw kv lx ly lz ma bi translated">它使得在 AWS GPU 实例上的培训就像在本地计算机上的培训一样简单</li><li id="22bf" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">它自动管理所有必要的 AWS 资源，包括 ami、卷、快照和 SSH 密钥</li><li id="787c" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">它使得每个人都可以通过几个命令在 AWS 上训练你的模型</li><li id="909a" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">它使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Tmux" rel="noopener ugc nofollow" target="_blank"> tmux </a>轻松地将远程进程从 SSH 会话中分离出来</li><li id="c888" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">通过使用<a class="ae kw" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" rel="noopener ugc nofollow" target="_blank"> AWS Spot 实例</a>，它可以为您节省高达 70%的成本</li></ul><p id="0e1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了展示它是如何工作的，让我们采用一些非平凡的模型，并尝试训练它。我选择了<a class="ae kw" href="https://github.com/Rayhane-mamah/Tacotron-2" rel="noopener ugc nofollow" target="_blank"> Tacotron 2 </a>的一个实现。这是谷歌的语音合成系统。</p><p id="5557" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将 Tacotron 2 的存储库克隆到您的计算机上:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="dfee" class="kx ky iq ml b gy mp mq l mr ms">git clone https://github.com/Rayhane-mamah/Tacotron-2.git</span></pre><h1 id="91ee" class="mt ky iq bd kz mu mv mw lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj bi translated">Docker 图像</h1><p id="9fbe" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">码头集装箱内参差不齐的火车模型。因此，我们需要找到一个满足模型需求的公开可用的 Docker 映像，或者用适当的环境创建一个新的 Docker 文件。</p><p id="e42e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Tacotron 的这个实现使用 Python 3 和 TensorFlow，所以我们可以使用 Docker Hub 的官方 Tensorflow 图像<a class="ae kw" href="https://hub.docker.com/r/tensorflow/tensorflow/" rel="noopener ugc nofollow" target="_blank">。但是这个图像并不满足“requirements.txt”文件中的所有要求。所以我们需要扩展映像，并在其上安装所有必要的库。</a></p><p id="97bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将“requirements.txt”文件复制到“docker/requirements-spotty.txt”文件中，并创建包含以下内容的<code class="fe nn no np ml b">docker/Dockerfile.spotty</code>文件:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="499b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们扩展了原始的 TensorFlow 映像，并安装了所有其他需求。当您启动实例时，将自动构建此映像。</p><h1 id="df78" class="mt ky iq bd kz mu mv mw lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj bi translated">参差不齐的配置文件</h1><p id="48d0" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">一旦我们有了 docker 文件，我们就可以编写一个参差不齐的配置文件了。在项目的根目录下创建一个<code class="fe nn no np ml b">spotty.yaml</code>文件。</p><p id="4eb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/apls777/Tacotron-2/blob/master/spotty.yaml" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以找到这个文件的全部内容。它由 4 个部分组成:<em class="ns">项目</em>、<em class="ns">容器</em>、<em class="ns">实例</em>、<em class="ns"> </em>和<em class="ns">脚本</em>。我们一个一个来看。</p><h2 id="01a6" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第一部分:项目</h2><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0e37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此部分包含以下参数:</p><ol class=""><li id="801c" class="lq lr iq ka b kb kc kf kg kj nt kn nu kr nv kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">name</strong></code> <strong class="ka ir"> : </strong>项目名称。该名称将用于 Spotty 为此项目创建的所有 AWS 资源的名称中。例如，它将用作 EBS 卷的前缀，或者用在帮助将项目代码与实例同步的 S3 存储桶的名称中。</li><li id="7193" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">syncFilters</strong></code> <strong class="ka ir"> : </strong>同步过滤器。这些过滤器将用于在将项目代码与正在运行的实例同步时跳过一些目录或文件。在上面的例子中，我们忽略了 PyCharm 配置、Git 文件、Python 缓存文件和训练数据。在幕后，Spotty 通过“aws s3 sync”命令使用这些过滤器，因此您可以在这里获得更多关于它们的信息:<a class="ae kw" href="https://docs.aws.amazon.com/cli/latest/reference/s3/index.html#use-of-exclude-and-include-filters" rel="noopener ugc nofollow" target="_blank">使用排除和包含过滤器</a>。</li></ol><h2 id="7173" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第二部分:集装箱</h2><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="77e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本节描述了项目的 Docker 容器:</p><ol class=""><li id="8d7e" class="lq lr iq ka b kb kc kf kg kj nt kn nu kr nv kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">projectDir</strong></code> <strong class="ka ir"> : </strong>容器内的一个目录，一旦实例启动，本地项目将被同步到这个目录。确保它是卷装载路径的子目录(见下文)或者与卷装载路径完全匹配，否则，一旦实例停止，对项目代码的所有远程更改都将丢失。</li><li id="5861" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">volumeMounts</strong></code> <strong class="ka ir"> : </strong>定义 EBS 卷应该挂载到的容器内的目录。EBS 卷本身将在配置文件的<code class="fe nn no np ml b">instances</code>部分描述。该列表的每个元素描述一个挂载点，其中<code class="fe nn no np ml b">name</code>参数应该与来自<code class="fe nn no np ml b">instance</code>部分的相应 EBS 卷相匹配(见下文)，而<code class="fe nn no np ml b">mountPath</code>参数指定一个卷在容器中的目录。</li><li id="aca8" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">file</strong></code>:我们之前创建的 Dockerfile 文件的路径。一旦实例启动，Docker 映像将自动构建。作为一种替代方法，您可以在本地构建映像，并将其推送到<a class="ae kw" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>，然后您可以使用<code class="fe nn no np ml b"><strong class="ka ir">image</strong></code>参数而不是<code class="fe nn no np ml b"><strong class="ka ir">file</strong></code> <strong class="ka ir"> </strong>参数直接指定映像的名称。</li><li id="489a" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">ports</strong></code>:实例应该公开的端口。在上面的例子中，我们打开了 2 个端口:6006 用于 TensorBoard，8888 用于 Jupyter Notebook。</li></ol><p id="a4b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://apls777.github.io/spotty/docs/configuration/" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于其他容器参数的信息。</p><h2 id="e2b4" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第 3 节:实例</h2><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="df94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本节描述了实例及其参数的列表。每个实例包含以下参数:</p><ol class=""><li id="6841" class="lq lr iq ka b kb kc kf kg kj nt kn nu kr nv kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">name</strong></code>:实例名称。该名称将用于专门为此实例创建的 AWS 资源的名称中。例如，EBS 卷和 EC2 实例本身。此外，如果在配置文件中有多个实例，这个名称也可以用在 Spotty 命令中。例如，<code class="fe nn no np ml b">spotty start i1</code>。</li><li id="8ba7" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">provider</strong></code>:实例的云提供商。目前，Spotty 只支持“<strong class="ka ir"> aws </strong>”提供商(亚马逊网络服务)，但在不久的将来也会支持谷歌云平台。</li><li id="dc36" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">parameters</strong></code>:实例的参数。它们特定于云提供商。请参见下面的 AWS 实例参数。</li></ol><p id="721a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> AWS 实例参数:</strong></p><ol class=""><li id="05cc" class="lq lr iq ka b kb kc kf kg kj nt kn nu kr nv kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">region</strong></code>:应该启动 Spot 实例的 AWS 区域。</li><li id="cd67" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">instanceType</strong></code>:EC2 实例的类型。点击阅读更多关于 AWS GPU 实例<a class="ae kw" href="https://docs.aws.amazon.com/dlami/latest/devguide/gpu.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></li><li id="7873" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">volumes</strong></code>:应该附加到实例的 EBS 卷列表。要将一个卷附加到容器的文件系统，参数<code class="fe nn no np ml b">name</code>应该匹配来自<code class="fe nn no np ml b">container</code>部分的一个<code class="fe nn no np ml b">volumeMounts</code>名称。请参见下面对 EBS 卷参数的描述。</li><li id="5ba4" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">dockerDataRoot</strong></code>:使用此参数，我们可以更改 Docker 存储所有图像(包括我们构建的图像)的目录。在上面的示例中，我们确保它是连接的 EBS 卷上的一个目录。所以下一次不会再重建图像，而只是从 Docker 缓存中加载。</li></ol><p id="859a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> EBS 音量参数:</strong></p><ol class=""><li id="a63f" class="lq lr iq ka b kb kc kf kg kj nt kn nu kr nv kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">size</strong></code>:卷的大小，以 GB 为单位。</li><li id="c91a" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">deletionPolicy</strong></code>:使用<code class="fe nn no np ml b">spotty stop</code>命令停止实例后，如何处理卷。可能的值包括:"<strong class="ka ir"> create_snapshot </strong> " <em class="ns">(默认)</em>，<strong class="ka ir"> update_snapshot </strong>"，<strong class="ka ir"> retain </strong>，<strong class="ka ir"> delete </strong>"。在文档中阅读更多信息:<a class="ae kw" href="https://apls777.github.io/spotty/docs/aws-provider/volumes-and-deletion-policies/" rel="noopener ugc nofollow" target="_blank">卷和删除策略</a>。</li><li id="ca41" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv nw ly lz ma bi translated"><code class="fe nn no np ml b"><strong class="ka ir">mountDir</strong></code>:将在实例上安装卷的目录。默认情况下，它将被装载到“/mnt/ &lt; ebs_volume_name &gt;”目录中。在上面的例子中，我们需要为“docker”卷显式指定这个目录，因为我们在<code class="fe nn no np ml b">dockerDataRoot</code>参数中重用了这个值。</li></ol><p id="8ef8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://apls777.github.io/spotty/docs/aws-provider/instance-parameters/" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于其他 AWS 实例参数的信息。</p><h2 id="fd5d" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第 4 部分:脚本</h2><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="54aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">脚本是可选的，但是非常有用。可以使用以下命令在实例上运行它们:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="dedb" class="kx ky iq ml b gy mp mq l mr ms">spotty run &lt;SCRIPT_NAME&gt;</span></pre><p id="1ccf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个项目，我们创建了 4 个脚本:</p><ul class=""><li id="5b6d" class="lq lr iq ka b kb kc kf kg kj nt kn nu kr nv kv lx ly lz ma bi translated"><strong class="ka ir">预处理</strong>:下载数据集并为训练做准备。</li><li id="e1f4" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated"><strong class="ka ir">训练</strong>:开始训练，</li><li id="0aea" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated"><strong class="ka ir"> tensorboard </strong>:在 6006 端口运行 tensorboard，</li><li id="4480" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated"><strong class="ka ir"> jupyter </strong>:启动端口 8888 上的 jupyter 笔记本服务器。</li></ul><p id="d68a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">就是这样！该模型已准备好在 AWS 上接受训练。</strong></p><h1 id="c5c1" class="mt ky iq bd kz mu mv mw lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj bi translated">参差不齐的安装</h1><h2 id="eaa6" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">要求</h2><ul class=""><li id="01bd" class="lq lr iq ka b kb ls kf lt kj lu kn lv kr lw kv lx ly lz ma bi translated">Python ≥3.5</li><li id="c5ec" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">安装和配置 AWS CLI(参见<a class="ae kw" href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html" rel="noopener ugc nofollow" target="_blank">安装 AWS 命令行界面</a>)</li></ul><h2 id="653e" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">装置</h2><p id="dcf1" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">使用<a class="ae kw" href="http://www.pip-installer.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> pip </a>安装 Spotty:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="2a97" class="kx ky iq ml b gy mp mq l mr ms">pip install -U spotty</span></pre><h1 id="cb42" class="mt ky iq bd kz mu mv mw lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj bi translated">模特培训</h1><p id="943c" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi nx translated"><span class="l ny nz oa bm ob oc od oe of di"> 1。</span>使用 Docker 容器启动 Spot 实例:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="e5eb" class="kx ky iq ml b gy mp mq l mr ms">spotty start</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/f057a7aecc0ee17c0749fe8bf975a8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJU7nrGs3PIM3F-WinBNFQ.png"/></div></div></figure><p id="a6d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦实例启动并运行，您将看到它的 IP 地址。以后用它打开 TensorBoard 和 Jupyter 笔记本。</p><p id="8707" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi nx translated"><span class="l ny nz oa bm ob oc od oe of di"> 2。</span>下载并预处理 Tacotron 模型的数据。我们在配置文件中已经有了一个自定义脚本来完成这个任务，只需运行:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="abdc" class="kx ky iq ml b gy mp mq l mr ms">spotty run preprocess</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/91efe1b30b000e41fbdae4df343ca365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EO6F-56XS1Dk9mL4c7dXWw.png"/></div></div></figure><p id="b6cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据处理完毕后，使用<code class="fe nn no np ml b"><strong class="ka ir">Ctrl + b</strong></code>，然后使用<code class="fe nn no np ml b"><strong class="ka ir">x</strong></code>组合键关闭 tmux 面板。</p><p id="4f8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi nx translated"><span class="l ny nz oa bm ob oc od oe of di"> 3。</span>预处理完成后，训练模型。运行“训练”脚本:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="ca5c" class="kx ky iq ml b gy mp mq l mr ms">spotty run train</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/8a17e3c8d2f97e3de116bfa300819d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpE7qXiaG0Nc1lonb3ny1A.png"/></div></div></figure><p id="4411" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用<code class="fe nn no np ml b"><strong class="ka ir">Ctrl + b</strong></code>，然后使用<code class="fe nn no np ml b"><strong class="ka ir">d</strong></code>组合键来分离这个 SSH 会话。训练过程不会中断。要重新连接该会话，只需再次运行<code class="fe nn no np ml b">spotty run train</code>命令。</p><h2 id="7061" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">张量板</h2><p id="1b89" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">使用“TensorBoard”脚本启动 tensorboard:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="056c" class="kx ky iq ml b gy mp mq l mr ms">spotty run tensorboard</span></pre><p id="1b64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">TensorBoard 将在端口 6006 上运行。您可以使用<code class="fe nn no np ml b"><strong class="ka ir">Ctrl + b</strong></code>键和<code class="fe nn no np ml b"><strong class="ka ir">d</strong></code>组合键分离 SSH 会话，TensorBoard 仍将运行。</p><h2 id="1207" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">Jupyter 笔记本</h2><p id="1f64" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">您也可以使用“Jupyter”脚本启动 Jupyter Notebook:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="e5f3" class="kx ky iq ml b gy mp mq l mr ms">spotty run jupyter</span></pre><p id="66d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jupyter 笔记本将在 8888 端口上运行。使用将在命令输出中看到的实例 IP 地址和令牌打开它。</p><h2 id="73e7" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">下载检查点</h2><p id="8a29" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">如果您需要将检查点或任何其他文件从正在运行的实例下载到您的本地机器，只需使用<code class="fe nn no np ml b">download</code>命令:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="ef83" class="kx ky iq ml b gy mp mq l mr ms">spotty download -f 'logs-Tacotron-2/taco_pretrained/*'</span></pre><h2 id="9cab" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">SSH 连接</h2><p id="9222" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">要通过 SSH 连接到正在运行的 Docker 容器，请使用以下命令:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="686d" class="kx ky iq ml b gy mp mq l mr ms">spotty ssh</span></pre><p id="686b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它使用一个<a class="ae kw" href="https://github.com/tmux/tmux/wiki" rel="noopener ugc nofollow" target="_blank"> tmux </a>会话，因此您可以使用<code class="fe nn no np ml b"><strong class="ka ir">Ctrl + b</strong></code>然后使用<code class="fe nn no np ml b"><strong class="ka ir">d</strong></code>组合键来分离它，并在以后再次使用<code class="fe nn no np ml b">spotty ssh</code>命令来附加该会话。</p></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><p id="7efd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">完成后，不要忘记停止实例！</strong>使用以下命令:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="2041" class="kx ky iq ml b gy mp mq l mr ms">spotty stop</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/97f9a5a271b323b58b28efdd5c21dcef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8zpPhYxt9bcZ5dbndc_iuQ.png"/></div></div></figure><p id="392e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的示例中，我们对卷使用了“保留”删除策略，因此 Spotty 将只终止实例，而不会触及卷。但是，如果我们使用“创建快照”或“更新快照”删除策略，它可以自动创建快照。</p><h1 id="86c0" class="mt ky iq bd kz mu mv mw lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj bi translated">结论</h1><p id="7ab7" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj nk kl km kn nl kp kq kr nm kt ku kv ij bi translated">使用 Spotty 是在 AWS Spot 实例上训练深度学习模型的一种便捷方式。它不仅可以为您节省高达 70%的成本，还可以节省大量为您的型号和笔记本电脑设置环境的时间。一旦你的模型有了一个参差不齐的配置，每个人都可以用几个命令来训练它。</p><p id="ee72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如果你喜欢这篇文章，请在 GitHub </strong>  <strong class="ka ir">上启动</strong> <a class="ae kw" href="https://github.com/apls777/spotty" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">项目，点击👏按钮，并与您的朋友分享这篇文章。</strong></a></p></div></div>    
</body>
</html>