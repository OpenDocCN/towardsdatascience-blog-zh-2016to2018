<html>
<head>
<title>Custom Vim Functions to Format Your Text</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义Vim函数来格式化你的文本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/custom-vim-functions-to-format-your-text-b694295f7764?source=collection_archive---------4-----------------------#2017-07-30">https://towardsdatascience.com/custom-vim-functions-to-format-your-text-b694295f7764?source=collection_archive---------4-----------------------#2017-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/951f65dadd9d4a4711c26e20290c8e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*csqpgoE3UUyh-aUsqycOfw.jpeg"/></div></div></figure><p id="e19b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vim是一个了不起的文本编辑器，多年来，它让我在编写代码或编辑文本时效率大大提高。虽然最初的学习曲线有点陡峭，但花时间学习不用鼠标导航和编辑文件是非常值得的。但是使Vim更加强大的是它是可破解的——如果您发现自己为某些任务反复执行一系列按键，您可以创建自己的函数，在整个Vim中使用。</p><p id="188d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时我会收到客户的Excel电子表格，他们希望我查看与他们在Excel列中提供给我的一系列数字相关的数据。如果我将这些数字粘贴到Vim中，我将得到如下所示的内容:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f2bf" class="lf lg iq lb b gy lh li l lj lk">300418944<br/>300404780<br/>300482301<br/>300354016<br/>300295311<br/>300417275<br/>300409184<br/>300480616<br/>300478444<br/>300491475<br/>300478160<br/>300482299<br/>300482959<br/>300154869</span></pre><p id="0ccd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我要在SQL查询的<code class="fe ll lm ln lb b">WHERE</code>子句中使用这个数字列表作为SQL列表，我需要用引号将所有数字括起来，并在每个数字的末尾加上一个逗号。最后，我需要将所有的行折叠成一行，并用括号将那一行括起来。本质上，我需要获取这些数字并创建一个元组。所以我想要这样的东西:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f4b9" class="lf lg iq lb b gy lh li l lj lk">(‘300418944’, ‘300404780’, ‘300482301’, ‘300354016’, ‘300295311’, ‘300417275’, ‘300409184’, ‘300480616’, ‘300478444’, ‘300491475’, ‘300478160’, ‘300482299’, ‘300482959’, ‘300154869’)</span></pre><p id="236e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">手动操作会花费相当多的时间，尤其是在给定一个包含数百个数字的列表的情况下。这就是Vim的亮点——我们可以在我们的<code class="fe ll lm ln lb b">vimrc</code>文件中创建一个函数来为我们处理这些步骤。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="50e1" class="lf lg iq lb b gy lh li l lj lk">“ convert rows of numbers or text (as if pasted from excel column) to a tuple</span><span id="9c48" class="lf lg iq lb b gy lo li l lj lk">function! ToTupleFunction() range<br/>    silent execute a:firstline . “,” . a:lastline . “s/^/’/”<br/>    silent execute a:firstline . “,” . a:lastline . “s/$/’,/”<br/>    silent execute a:firstline . “,” . a:lastline . “join”<br/>    silent execute “normal I(“<br/>    silent execute “normal $xa)”<br/>    silent execute “normal ggVGYY”<br/>endfunction</span><span id="7648" class="lf lg iq lb b gy lo li l lj lk">command! -range ToTuple &lt;line1&gt;,&lt;line2&gt; call ToTupleFunction()</span></pre><p id="db84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个函数不仅会格式化你的文本，还会将结果复制到你的剪贴板，这样你就可以将它粘贴到你使用的任何SQL查询编辑器中。</p><p id="b9cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们分解函数体的每一行。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="81fd" class="lf lg iq lb b gy lh li l lj lk">silent execute a:firstline . “,” . a:lastline . “s/^/’/”</span></pre><p id="b74b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于所有可视选择的行，上面的行跳转到每一行的开头，并插入一个单引号。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="3ea5" class="lf lg iq lb b gy lh li l lj lk">silent execute a:firstline . “,” . a:lastline . “s/$/’,/”</span></pre><p id="d974" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一行位于每一行的末尾，并插入一个单引号和逗号。</p><p id="7c17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一行代码将所有的文本行合并成一行:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="56f9" class="lf lg iq lb b gy lh li l lj lk">silent execute a:firstline . “,” . a:lastline . “join”</span></pre><p id="db16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们在行首添加一个左括号:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="e421" class="lf lg iq lb b gy lh li l lj lk">silent execute “normal I(“</span></pre><p id="811e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后插入结束的那个:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="ff40" class="lf lg iq lb b gy lh li l lj lk">silent execute “normal $xa)”</span></pre><p id="babe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该函数的最后一行选择整个文本，并将其复制到剪贴板(我有一个自定义的映射，用于复制到剪贴板:<code class="fe ll lm ln lb b">vnoremap YY "*y</code>)。</p><p id="973e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，下面是实际运行的函数:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/334bc418e2595aab8effdaa4367068b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fUiydA-27KvhU4Bj"/></div></div></figure><p id="ea3d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您希望有一个类似的函数来创建一个数组，那么您只需要对<code class="fe ll lm ln lb b">ToTupleFunction</code>做一点小小的修改，并给这个函数起一个新名字。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="e09e" class="lf lg iq lb b gy lh li l lj lk">“ convert rows of numbers or text (as if pasted from excel column) to an array</span><span id="d0bc" class="lf lg iq lb b gy lo li l lj lk">function! ToArrayFunction() range<br/>    silent execute a:firstline . “,” . a:lastline . “s/^/’/”<br/>    silent execute a:firstline . “,” . a:lastline . “s/$/’,/”<br/>    silent execute a:firstline . “,” . a:lastline . “join”<br/>    " these two lines below are different by only one character!<br/>    silent execute “normal I[“<br/>    silent execute “normal $xa]”</span><span id="0a5c" class="lf lg iq lb b gy lo li l lj lk">command! -range ToArray &lt;line1&gt;,&lt;line2&gt; call ToArrayFunction()</span></pre><p id="7e01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！希望这是有帮助的，如果你们有任何很酷的Vim函数，你们经常用来写代码或者只是写一般的东西，请在评论中告诉我！</p><div class="lq lr gp gr ls lt"><a href="https://bobbywlindsey.ck.page/5dca5d4310" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd ir gy z fp ly fr fs lz fu fw ip bi translated">想在数据科学方面变得更好吗？</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">当我在我发布独家帖子的媒体和个人网站上发布新内容时，请单击此处获得通知。</h3></div></div></div></a></div></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="f423" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mi">原载于2017年7月30日</em><a class="ae mj" href="https://www.bobbywlindsey.com/2017/07/30/vim-functions/" rel="noopener ugc nofollow" target="_blank"><em class="mi">【bobbywlindsey.com】</em></a><em class="mi">。</em></p></div></div>    
</body>
</html>