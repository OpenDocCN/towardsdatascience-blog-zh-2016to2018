<html>
<head>
<title>Explore Two Variables Using R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R 探究两个变量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/explore-two-variables-using-r-68ece9cbcd81?source=collection_archive---------6-----------------------#2018-09-12">https://towardsdatascience.com/explore-two-variables-using-r-68ece9cbcd81?source=collection_archive---------6-----------------------#2018-09-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="74bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文是 R-One Variable 中的<a class="ae kl" rel="noopener" target="_blank" href="/exploratory-data-analysis-in-r-explore-one-variable-using-pseudo-facebook-dataset-29031767eb07">探索性数据分析的继续，其中我们讨论了伪 facebook 数据集的 EDA。</a></p><p id="3142" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将基于 Udacity 策划的伪 facebook 数据集，了解数据聚合、条件均值和散点图。</p><p id="5e7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们将同时考察两个连续变量。散点图是检验两个变量之间关系的最佳图之一。让我们在所有用户的年龄和朋友数量之间画一个散点图。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="f166" class="kv kw iq kr b gy kx ky l kz la">qplot(age,friend_count,data=pf)</span></pre><p id="9130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运筹学</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="00cc" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_point()</span></pre><p id="55f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们使用 geom_point()时，散点图是默认图。</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/1d02e6bc5a3cbd29be10d1445de194d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*yCJHxiax0ZdkAvzdw2d14Q.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 1 Scatter Plot — Friend Count Vs Age</em></strong></figcaption></figure><p id="1dba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的图中，以下两个观察结果是相当明显的:</p><ol class=""><li id="1aa3" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">年龄不到 30 岁的人有成千上万的朋友</li><li id="7d45" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">69 岁接近 100 岁有一条垂直线，似乎不正确。</li></ol><p id="d116" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们知道持有脸书帐户的最低年龄要求是 13 岁，90 岁似乎是一个相当大的年龄，所以让我们将 x 轴限制在 13 到 90 岁之间。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="35fd" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_point()+<br/>  xlim(13,90)</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/d2677f6a7dfd83157e42c52822e04527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*59ZA2pQk8yECfqpsUx1Adw.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 2 Scatter Plot — Age Vs Friend Count (x axis restricted)</em></strong></figcaption></figure><p id="2df8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的地块比地块 1 好，但是下部人满为患，很难统计那个区域的点数。</p><blockquote class="ma mb mc"><p id="096d" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">geom_point 的 Alpha 美学可用于设置地块过度拥挤区域中点的透明度级别。</p></blockquote><p id="6224" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的场景，让我们设置 alpha 值为 1/20，这意味着需要 20 个点来完成一个黑点。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="a2bb" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_point(alpha=1/20)+<br/>  xlim(13,90)</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/13d361b101874c1cac0fd435b5d6efa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*sspKLfXoRkTLxu-eALaHVg.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 3 Scatter Plot — Age Vs Friend Count — Alpha Aesthetics</em></strong></figcaption></figure><p id="d323" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，将抖动添加到我们的绘图中，以分散过度绘制的点。</p><blockquote class="ma mb mc"><p id="9f9e" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">抖动是指向数据中添加少量随机噪声。</p></blockquote><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="3eb0" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_jitter(alpha=1/20)+<br/>  xlim(13,90)</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/9678e59765500548ed4cea3127e34a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*7YLFp32LVJweEFDb4KNhHg.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 4 Scatter Plot — Age Vs Friend Count — Jittering</em></strong></figcaption></figure><p id="5e28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的情节可以推断，25 岁以下的用户绝大多数朋友都在 1000 以下。<em class="md">这个推论与我们从情节 1 的第一个观察相矛盾，象征着 EDA 的重要性。</em></p><p id="17fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更进一步，让我们使用<a class="ae kl" href="https://ggplot2.tidyverse.org/reference/coord_trans.html" rel="noopener ugc nofollow" target="_blank"> coord_trans </a>进行可视化。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="de9d" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_point(alpha=1/20)+<br/>  xlim(13,90)+<br/>  coord_trans(y = "sqrt")</span></pre><p id="ac31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运筹学</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="baee" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_point(alpha=1/20,position=position_jitter(h=0))+<br/>  xlim(13,90)+<br/>  coord_trans(y = "sqrt")</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/d8594f4aacc5103f9b84bf16e54cce10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*fHonW60-WDQgUmihnWWlRg.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 5 Scatter Plot — Age Vs Friend Count — Use coord_trans</em></strong></figcaption></figure><p id="1bd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了这个剧情，看好友数，条件，年龄就容易多了。<br/>从数据可视化到现在，我们可以观察数据集中的每一个点。尽管如此，从这样的显示中还是无法确定重要的量，如平均值和中间值。有时我们想了解均值或中值如何随其他变量而变化。让我们创建一个表格，为我们提供所有年龄的平均值和中间值。为此我们将使用<a class="ae kl" href="https://www.r-bloggers.com/hadley-wickham-presents-dplyr-at-user-2014/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">D Plyr</strong></a>T5】。【Dplyr 的基础教程可以在<a class="ae kl" href="https://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-1/" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae kl" href="https://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-2/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。同样可以使用<a class="ae kl" href="https://rollingyours.wordpress.com/2014/10/20/the-lapply-command-101/" rel="noopener ugc nofollow" target="_blank"> lapply、tapply 和 split </a>等函数创建。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="b222" class="kv kw iq kr b gy kx ky l kz la">age_groups&lt;-group_by(pf,age)<br/>pf.fc_by_age&lt;-summarise(age_groups,<br/>          friend_count_mean=mean(friend_count),<br/>          friend_count_median=median(friend_count),<br/>          n=n())<br/>pf.fc_by_age&lt;-arrange(pf.fc_by_age,age)<br/>head(pf.fc_by_age)</span></pre><p id="0924" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的代码产生一个<a class="ae kl" href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html" rel="noopener ugc nofollow" target="_blank">tible</a>，输出如下所示:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="5dd8" class="kv kw iq kr b gy kx ky l kz la">A tibble: 6 x 4<br/>    age friend_count_mean friend_count_median     n<br/>  &lt;int&gt;             &lt;dbl&gt;               &lt;dbl&gt; &lt;int&gt;<br/>1    13              165.                 74    484<br/>2    14              251.                132   1925<br/>3    15              348.                161   2618<br/>4    16              352.                172.  3086<br/>5    17              350.                156   3283<br/>6    18              331.                162   5196</span></pre><blockquote class="ma mb mc"><p id="de09" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">Tibbles 是数据帧的现代版本。他们保留了经受住时间考验的功能，放弃了过去方便但现在令人沮丧的功能。更多信息可以在找到<a class="ae kl" href="http://r4ds.had.co.nz/tibbles.html" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="c608" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面的表格，我们将绘制年龄与朋友数量平均值的散点图。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="bcdf" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(age,friend_count_mean),data=pf.fc_by_age) +<br/>  geom_point()</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/3f92cb94519871f904742dcb619eb978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*_FGZuR3uedd2YW2s422e9A.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 6 Scatter Plot — Age Vs Friend Count Mean</em></strong></figcaption></figure><p id="22a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用线将分散的点连接起来。请遵守<strong class="jp ir">几何线。</strong></p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="d232" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(age,friend_count_mean),data=pf.fc_by_age) +<br/>  geom_line()</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/436787453c1e2577d1012ffb9e551153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*AwtJ0zYtYCONCvsXdi7jwA.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 7 Line Plot — Age Vs Friend Count Mean</em></strong></figcaption></figure><p id="794e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酷！让我们在图 5 中绘制之前的散点图。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="07af" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  geom_point(alpha=1/20,<br/>             position=position_jitter(h=0),<br/>             color='red')+<br/>  xlim(13,90)+<br/>  coord_trans(y = "sqrt")+<br/>  geom_line(stat='summary',fun.y=mean)+<br/>  geom_line(stat='summary',fun.y=median,linetype=2,color='blue')+<br/>  geom_line(stat='summary',fun.y=quantile,fun.args=list(probs=0.9),color='blue')</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/be5ef08a98d0e211d31c93e9c802496d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*wHxEds4pN-zd6LjZJkXcpQ.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 8 — Overlaying summaries with raw data</em></strong></figcaption></figure><p id="18a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面我们可以推断，超过 1000 个朋友是很少发生的。要进一步缩放，我们可以使用 coord_cartesian。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="836e" class="kv kw iq kr b gy kx ky l kz la">ggplot(aes(x=age,y=friend_count),data=pf)+<br/>  coord_cartesian(xlim=c(13,70),ylim=c(0,1000))+<br/>  geom_point(alpha=1/20,<br/>             position=position_jitter(h=0),<br/>             color='orange')+<br/>  geom_line(stat='summary',fun.y=mean)+<br/>  geom_line(stat='summary',fun.y=median,linetype=2,color='blue')+<br/>  geom_line(stat='summary',fun.y=quantile,fun.args=list(probs=0.9),color='brown')</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/4ca510253a4392a0a746dd6906996a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*Wzv0tdmOmc-8YLpelrWfkg.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="bd lj"><em class="lk">Plot 9— Overlaying summaries with raw data — Zoomed</em></strong></figcaption></figure><p id="5517" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，作为探索性数据分析系列的一部分，我们将通过 R 探索多个变量。</p></div></div>    
</body>
</html>