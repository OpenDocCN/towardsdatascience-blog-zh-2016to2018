<html>
<head>
<title>How to get fbprophet working on AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让 fbprophet 在 AWS Lambda 上工作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-get-fbprophet-work-on-aws-lambda-c3a33a081aaf?source=collection_archive---------11-----------------------#2018-09-15">https://towardsdatascience.com/how-to-get-fbprophet-work-on-aws-lambda-c3a33a081aaf?source=collection_archive---------11-----------------------#2018-09-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c834" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">解决 fbprophet 无服务器部署的包大小问题</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/64b9923cb1893bf9b704e454e2284e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jwaqqgi5dBPVLZ66RyABpQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Adi Goldstein / Unsplash</figcaption></figure><p id="966e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我假设你正在阅读这篇文章，因为你正在寻找在 AWS Lambda 上使用令人敬畏的 fbprophet(脸书开源预测)库的方法，并且你已经熟悉了完成它的各种问题。我将使用 python 3.6 示例，但是这种方法适用于其他运行时以及其他大型 ML 库。事不宜迟:</p><ol class=""><li id="dcbe" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">本地安装 Docker。另一种方法是运行 EC2 实例，并在实例和本地机器之间复制文件，这对我来说更复杂，也更不可靠。</li><li id="3c58" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">使用您的代码在工作目录中的相关 lambda 映像上运行一个 shell(看一下<a class="ae mf" href="https://github.com/lambci/docker-lambda#build-examples" rel="noopener ugc nofollow" target="_blank"> lambci </a>)，它应该在 Lambda 上运行(它有 Lambda 处理程序):</li></ol><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="8a3d" class="ml mm iq mh b gy mn mo l mp mq">docker run --rm -it -v “$PWD”:/var/task lambci/lambda:build-python3.6 bash</span></pre><p id="e790" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于这里使用的命令的解释，请点击 Docker docs 或<a class="ae mf" href="https://medium.freecodecamp.org/escaping-lambda-function-hell-using-docker-40b187ec1e48" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="0730" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.创建虚拟环境并安装相关软件包:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="340a" class="ml mm iq mh b gy mn mo l mp mq">python3 -m venv venv<br/>. venv/bin/activate<br/>pip install --upgrade pip<br/>pip install fbprophet --no-cache</span></pre><p id="522a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">4.你可以检查你的代码是否工作正常:<code class="fe mr ms mt mh b">python lambda_handler.py</code></p><p id="1664" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">5.将 venv 的大小减少到 250Mb 以下:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="713d" class="ml mm iq mh b gy mn mo l mp mq">pip uninstall -y matplolib</span><span id="a712" class="ml mm iq mh b gy mu mo l mp mq">find "$VIRTUAL_ENV/lib/python3.6/site-packages" -name "test" | xargs rm -rf</span><span id="3655" class="ml mm iq mh b gy mu mo l mp mq">find "$VIRTUAL_ENV/lib/python3.6/site-packages" -name "tests" | xargs rm -rf</span><span id="3788" class="ml mm iq mh b gy mu mo l mp mq">rm -rf "$VIRTUAL_ENV/lib/python3.6/site-packages/pystan/stan/src"</span><span id="006c" class="ml mm iq mh b gy mu mo l mp mq">rm -rf "$VIRTUAL_ENV/lib/python3.6/site-packages/pystan/stan/lib/stan_math/lib"</span><span id="4ef7" class="ml mm iq mh b gy mu mo l mp mq">echo "venv size $(du -sh $VIRTUAL_ENV | cut -f1)"</span></pre><p id="54b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里发生的事情是，您正在摆脱 matplotlib(如果您不需要绘图)、测试和 pystan 源代码(软件包中最重的部分)。最后一个命令显示 venv 的大小，应该低于 250Mb。</p><p id="b50b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">6.确保你的代码在清理后仍然工作:<code class="fe mr ms mt mh b">python lambda_handler.py</code></p><p id="8fb0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">7.创建一个. zip 文件上传到 Lambda:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="8bee" class="ml mm iq mh b gy mn mo l mp mq">pushd $VIRTUAL_ENV/lib/python3.6/site-packages/</span><span id="0f41" class="ml mm iq mh b gy mu mo l mp mq">zip -r -9 -q /var/task/name_of_your_zip.zip *</span><span id="5337" class="ml mm iq mh b gy mu mo l mp mq">popd</span><span id="bf80" class="ml mm iq mh b gy mu mo l mp mq">zip -9r name_of_your_zip.zip name_of_your_code_folder/</span><span id="cd9d" class="ml mm iq mh b gy mu mo l mp mq">zip -9 name_of_your_zip.zip lambda_handler.py</span></pre><p id="b302" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">8.现在您的工作目录中有了一个. zip 文件，可以用于 Lambda。你现在可以停止/退出 Docker 了——这个压缩文件仍然在你的文件夹里。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="c2af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其他资源:</p><p id="222f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于为 Lambda 准备 ML 库的精彩帖子:<a class="ae mf" href="https://medium.com/@maebert/machine-learning-on-aws-lambda-5dc57127aee1" rel="noopener">https://medium . com/@ Mae Bert/machine-learning-on-AWS-Lambda-5dc 57127 aee 1</a></p><p id="8d17" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为 Lambda 准备 fbprophet 的讨论:<a class="ae mf" href="https://gist.github.com/CarstVaartjes/77dbe8249d171e592bd17847f7009272" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/CarstVaartjes/77 DBE 8249d 171 e 592 BD 17847 f 7009272</a></p><p id="b1be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">缩小 scipy 的大小:<a class="ae mf" href="https://gist.github.com/wrwrwr/4a38a17113e3845f3385e9388effc064" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/wrwrwr/4a 38 a 17113 e 3845 f 3385 e 9388 effc 064</a></p></div></div>    
</body>
</html>