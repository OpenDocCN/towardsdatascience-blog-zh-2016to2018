<html>
<head>
<title>Jupyter Notebooks as Light, Percent or Sphinx scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter 笔记本，如 Light、Percent 或 Sphinx 脚本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/jupyter-notebooks-as-light-percent-or-sphinx-scripts-efca8bc3aa44?source=collection_archive---------18-----------------------#2018-10-11">https://towardsdatascience.com/jupyter-notebooks-as-light-percent-or-sphinx-scripts-efca8bc3aa44?source=collection_archive---------18-----------------------#2018-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f38c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几周前，我们<a class="ae kl" rel="noopener" target="_blank" href="/introducing-jupytext-9234fdff6c57">发布了</a> Jupytext，这是 Jupyter 的一个插件，可以像脚本一样读写 Jupyter 笔记本。将 Jupyter 笔记本表示为文本文件大大简化了笔记本的使用。笔记本作为脚本很容易编辑、重构，甚至可以在专门的 ide 中执行。Jupyter 笔记本作为脚本的版本控制产生了有意义的差异。最后，在笔记本的文本表示上合并多个贡献并不比在标准脚本上合并贡献更难，这为在 Jupyter 笔记本上更容易的协作开辟了道路。</p><p id="6632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupytext 的最初版本为笔记本引入了<code class="fe km kn ko kp b">light</code>格式作为脚本。从那以后，我们继续探索如何最好地将 Jupyter 笔记本表现为文本文件。我们与 Spyder、Hydrogen 和 Matplotlib 团队进行了有趣的交流，除了<code class="fe km kn ko kp b">light</code>格式之外，他们还发现了两种将 Jupyter 笔记本表示为 Python 脚本的现有的流行格式:<code class="fe km kn ko kp b">percent</code>和<code class="fe km kn ko kp b">sphinx</code>格式。</p><p id="57e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面，我们简要回顾一下这三种格式，并回忆一下如何在 Jupyter 笔记本和这三种格式之间来回转换。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/309571356b2c6fa8011672f5059fca06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-hozvxbgANL8brPH.gif"/></div></div></figure><h1 id="f707" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><code class="fe km kn ko kp b">light</code>格式</h1><p id="118c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">当我们准备 Jupytext 的初始版本时，我们在设计<code class="fe km kn ko kp b">light</code>格式时考虑了以下目标:</p><ul class=""><li id="5242" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">将任意脚本作为笔记本打开，带有有意义的单元格，</li><li id="e05f" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">将笔记本表示为带有少量单元格标记的脚本，如果可能的话，不要标记，</li><li id="4a93" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">在往返转换时保留笔记本的脚本和输入。</li></ul><p id="e04f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">普通脚本没有单元格标记。所以我们决定代码段应该是自然细胞。后跟缩进行的空行以及属于多行注释的空行不被视为单元格分隔符。完全注释的段落被理解为标记单元格。</p><p id="7e73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Jupytext 中，我们关心的是往返转换——我们不想弄乱你的笔记本！因此，我们必须找到一种方法来明确地识别在 Jupyter 笔记本中包含不止一个代码段的代码单元。为此，我们使用<code class="fe km kn ko kp b"># +</code>作为单元开始标记，使用<code class="fe km kn ko kp b"># -</code>作为单元结束标记。</p><p id="4686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于所有类型的单元格，<code class="fe km kn ko kp b">light</code>格式完全支持单元格元数据。包含元数据的单元格有一个显式的头<code class="fe km kn ko kp b"># + {JSON}</code>，其中元数据以 JSON 格式表示。</p><p id="e5eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此处提供了<code class="fe km kn ko kp b">light</code>格式的笔记本样本<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/demo/World%20population.lgt.py" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d9d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">light</code>格式已经在 Python 脚本上进行了广泛的测试。Jupytext 也为 R、Julia、Scheme、C++实现了那种格式，如果这里没有列出你最喜欢的语言，欢迎询问！</p><h1 id="fa80" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><code class="fe km kn ko kp b">percent</code>格式</h1><p id="1eb4" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">受 Matlab 启发的<code class="fe km kn ko kp b">percent</code>格式是 Spyder 在五年前推出的。现在支持该格式的有:</p><ul class=""><li id="b102" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated"><a class="ae kl" href="https://docs.spyder-ide.org/editor.html#defining-code-cells" rel="noopener ugc nofollow" target="_blank"> Spyder IDE，</a></li><li id="bff7" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated"><a class="ae kl" href="https://atom.io/packages/hydrogen" rel="noopener ugc nofollow" target="_blank">氢，</a>基于原子的笔记本编辑器，</li><li id="1ddf" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated"><a class="ae kl" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS 代码</a>使用<a class="ae kl" href="https://marketplace.visualstudio.com/items?itemName=donjayamanne.jupyter" rel="noopener ugc nofollow" target="_blank"> vscodeJupyter </a>扩展时，</li><li id="7f43" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated"><a class="ae kl" href="https://github.com/Microsoft/PTVS" rel="noopener ugc nofollow" target="_blank">Visual Studio 的 Python 工具</a>，</li><li id="6ca7" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated"><a class="ae kl" href="https://www.jetbrains.com/pycharm/" rel="noopener ugc nofollow" target="_blank"> PyCharm 专业</a>。</li></ul><p id="6836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupytext 也实现了<code class="fe km kn ko kp b">percent</code>格式。为了实现 Jupyter 笔记本到<code class="fe km kn ko kp b">percent</code>脚本的无损往返转换，我们扩展了格式以支持 markdown 和 raw 单元格，以及单元格元数据。我们实现的单元头是:</p><pre class="kr ks kt ku gt mt kp mu mv aw mw bi"><span id="0fc5" class="mx ld iq kp b gy my mz l na nb"># %% Optional cell title [cell type] {optional JSON metadata}</span></pre><p id="f4b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中单元格类型要么省略(代码单元格)，要么<code class="fe km kn ko kp b">[markdown]</code>或<code class="fe km kn ko kp b">[raw]</code>。显然，markdown 和 raw 单元格的内容在<code class="fe km kn ko kp b">percent</code>脚本中被注释掉了！</p><p id="2d88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有<code class="fe km kn ko kp b">percent</code>格式的笔记本样品<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/demo/World%20population.pct.py" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="26be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">格式不限于 Python。<a class="ae kl" href="https://atom.io/packages/hydrogen" rel="noopener ugc nofollow" target="_blank"> Hydrogen </a>已经将<code class="fe km kn ko kp b">percent</code>格式推广到所有的 Jupyter 语言:Julia、Python、R、Javascript 等等！Jupytext 目前实现了 Julia、Python、R、Scheme 和 C++的<code class="fe km kn ko kp b">percent</code>格式。再说一次，你可以要求更多。</p><p id="cdba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面列出的所有编辑器都可以识别单元格，并允许执行它们的内容。Hydrogen 甚至在输入电池的正下方显示输出，就像 Jupyter 笔记本一样。并且<a class="ae kl" href="https://gist.githubusercontent.com/mwouts/91f3e1262871cdaa6d35394cd14f9bdc/raw/3e2dde646d66207e132fba30d7c407a5917c0371/percent_format_matplotlib.png" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a>和<a class="ae kl" href="https://gist.githubusercontent.com/mwouts/91f3e1262871cdaa6d35394cd14f9bdc/raw/3e2dde646d66207e132fba30d7c407a5917c0371/percent_format_plotly.png" rel="noopener ugc nofollow" target="_blank"> Plotly </a>两个图都很好的集成在编辑器中。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/348b0dc66b937286990c3c2ede5cc771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*drT1u09jCPip45be.png"/></div></div></figure><h1 id="2703" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">狮身人面像画廊格式</h1><p id="813a" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">这是 Matplotlib 用来生成其<a class="ae kl" href="https://matplotlib.org/gallery.html" rel="noopener ugc nofollow" target="_blank">图库</a>的格式。文本单元格表示为三重引号字符串或注释文本块，以带有许多散列符号的行开始。连续的代码单元用空字符串分隔。</p><p id="fef7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupytext 实现了 Jupyter 笔记本的<code class="fe km kn ko kp b">sphinx</code>格式，这里给出了一个笔记本示例<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/demo/World%20population.spx.py" rel="noopener ugc nofollow" target="_blank">。如果你想为你的斯芬克斯画廊设计新的例子，使用这种格式，或者反过来，如果你想使用</a><a class="ae kl" href="http://mybinder.org/" rel="noopener ugc nofollow" target="_blank"> mybinder </a>和<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/README.md#sphinx-gallery-scripts" rel="noopener ugc nofollow" target="_blank"> Jupytext </a>作为 Jupyter 笔记本访问你的斯芬克斯画廊。</p><h1 id="977a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">使用 Jupytext</h1><p id="209e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">使用升级 Jupytext</p><pre class="kr ks kt ku gt mt kp mu mv aw mw bi"><span id="517a" class="mx ld iq kp b gy my mz l na nb">pip install jupytext --upgrade</span></pre><p id="bbda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupytext 为 Jupyter 提供了一个插件，允许你在 Jupyter 中将脚本作为笔记本打开，并与配对的笔记本一起工作(下面将详细介绍)。将 Jupytext 的内容管理器添加到您的 Jupyter 配置文件<code class="fe km kn ko kp b">.jupyter/jupyter_notebook_config.py</code>:</p><pre class="kr ks kt ku gt mt kp mu mv aw mw bi"><span id="117a" class="mx ld iq kp b gy my mz l na nb">c.NotebookApp.contents_manager_class="jupytext.TextFileContentsManager"</span></pre><p id="28f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过将<code class="fe km kn ko kp b">"jupytext": {"formats": "ipynb,py:percent"},</code>添加到笔记本元数据，将脚本或笔记本转换为配对笔记本。然后，Jupyter 将你的笔记本保存为传统的<code class="fe km kn ko kp b">.ipynb</code>文件和补充的<code class="fe km kn ko kp b">percent</code>格式的<code class="fe km kn ko kp b">.py</code>文件。正如<a class="ae kl" rel="noopener" target="_blank" href="/introducing-jupytext-9234fdff6c57">公告</a>中所述，您可以编辑<code class="fe km kn ko kp b">.py</code>文件，并刷新 Jupyter 以获得更新的输入单元格(通过在单元格中运行<code class="fe km kn ko kp b">%autosave 0</code>关闭 Jupyter 的自动保存)。</p><p id="5d55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，使用<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/README.md#command-line-conversion" rel="noopener ugc nofollow" target="_blank">命令行转换器</a>将 Jupyter 笔记本转换为<code class="fe km kn ko kp b">percent</code>脚本，然后再转换回来:</p><pre class="kr ks kt ku gt mt kp mu mv aw mw bi"><span id="e83d" class="mx ld iq kp b gy my mz l na nb"># create notebook.py with '# %%'-cells<br/>jupytext --to py:percent notebook.ipynb</span><span id="0c63" class="mx ld iq kp b gy nc mz l na nb"># update input cells in notebook.ipynb<br/>jupytext --to ipynb --update notebook.py</span></pre><p id="36fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将<code class="fe km kn ko kp b">light</code>脚本转换为<code class="fe km kn ko kp b">percent</code>脚本:</p><pre class="kr ks kt ku gt mt kp mu mv aw mw bi"><span id="23d9" class="mx ld iq kp b gy my mz l na nb"># Convert light.py to percent.py<br/>jupytext --from py:light --to py:percent --output percent.py light.py</span><span id="fff9" class="mx ld iq kp b gy nc mz l na nb"># In place conversion! Handle with care.<br/>jupytext --from py:light --to py:percent notebook.py</span></pre><h1 id="68fb" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">所有格式一览</h1><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nd"><img src="../Images/cebf2d1e33a8a1d1337d0f2cd66211a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*si4rlsB5xE7OqgbdXv0grw.png"/></div></div></figure><h1 id="c4c1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="efd0" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">将笔记本表示为文本文件可以方便地重构、共享和版本控制 Jupyter 笔记本。作为文本文件的笔记本不包括输出单元格，因此当<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/README.md#paired-notebooks" rel="noopener ugc nofollow" target="_blank">将</a>与传统的<code class="fe km kn ko kp b">.ipynb</code>笔记本配对时，它们工作得最好。</p><p id="9481" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupyter 笔记本可以用各种文本格式表示。除了<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/demo/World%20population.md" rel="noopener ugc nofollow" target="_blank"> Markdown </a>和<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/demo/World%20population.Rmd" rel="noopener ugc nofollow" target="_blank"> R Markdown </a>之外，Jupytext 还将 Jupyter 笔记本实现为<code class="fe km kn ko kp b">light</code>和<code class="fe km kn ko kp b">percent</code>脚本。使用<code class="fe km kn ko kp b">light</code>格式(由 Jupytext 提供)打开任意脚本作为笔记本，并以离散单元格格式保存笔记本。或者用 Spyder 五年前贡献的<code class="fe km kn ko kp b">percent</code>格式，现在很多编辑都支持。这四种格式是语言不可知的，已经在 Python、Julia、R、Scheme 和 C++笔记本上进行了测试。</p><p id="783b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你愿意投稿吗？我们想使格式规范坚如磐石，请让我们知道你是否能帮忙。我们也对向<code class="fe km kn ko kp b">light</code>和<code class="fe km kn ko kp b">percent</code>格式添加<a class="ae kl" href="https://github.com/mwouts/jupytext/blob/master/README.md#extending-the-light-and-percent-formats-to-more-languages" rel="noopener ugc nofollow" target="_blank">更多语言</a>的贡献感兴趣。一个能够编辑元数据的<a class="ae kl" href="https://github.com/mwouts/jupytext/issues/86" rel="noopener ugc nofollow" target="_blank">笔记本扩展</a>将会改善用户体验。</p></div></div>    
</body>
</html>