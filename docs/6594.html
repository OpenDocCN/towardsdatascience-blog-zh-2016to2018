<html>
<head>
<title>Using Python to Find Myself A Rental Home</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 给自己找了个出租房</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-python-to-find-myself-a-rental-home-a0b1bf6f02e?source=collection_archive---------8-----------------------#2018-12-20">https://towardsdatascience.com/using-python-to-find-myself-a-rental-home-a0b1bf6f02e?source=collection_archive---------8-----------------------#2018-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="626d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过网络抓取、网络地图和数据可视化缩小我对房屋的搜索范围</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4edd99da8abef9710bbe819f1a0ca4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BNFUdEcDJuSkBqTs.jpg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">HDB flats in Singapore</figcaption></figure><p id="fbf1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">“你好，世界！”</p><p id="a823" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">随着我在欧洲的冬季交流项目接近尾声，我意识到了现实:我需要在新加坡找到一个新的公寓。</p><p id="fbab" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个简单！我所要做的就是登录这些网站，输入一些搜索参数来找到我的理想公寓。以前租过房子，这个过程相当熟悉和舒适。然而，在快速浏览 Python 一段时间后，我认为这将是创建一个更加<strong class="kx ir">高效的</strong>搜索过程的好方法，并通过处理一个真实世界的问题来测试我的技能。</p><p id="c104" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> <em class="ls">在我们深入研究这个项目之前，先花些时间浏览一下 iProperty 的</em></strong><a class="ae lr" href="https://www.iproperty.com.sg/robots.txt" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="ls">robot . txt</em></strong></a><strong class="kx ir"><em class="ls">文件。虽然他们确实允许机器人抓取他们的网站，但保持谨慎和不滥用赋予我们的这一特权总是很重要的。</em> </strong></p><h1 id="5da2" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">语境</h1><p id="9c02" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">现在，当我找到一个出租公寓时，我寻找什么？简单地说，我的最优出租公寓可以描述为这两个变量的函数:</p><ul class=""><li id="314c" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">靠近捷运(地铁)站，方便随时随地通勤。</li><li id="ec6c" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">价格合理(因为我是一个破产的学生)。</li></ul><p id="191d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通常，我会采取以下步骤来找到最佳公寓:</p><ol class=""><li id="dd2e" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq ne mw mx my bi translated">在房产网站上搜索，找到一个价格合适的单位。</li><li id="92b5" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq ne mw mx my bi translated">在谷歌地图上查找地址，看看它是否位于捷运站附近。</li><li id="fa38" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq ne mw mx my bi translated">如果位置是我想要的，太好了！不管怎样，我会把它记在某个地方。</li><li id="74c8" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq ne mw mx my bi translated">如果位置不是我想要的，那么我会再次重复步骤 1 到 3。</li></ol><p id="7a9c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果重复 3 到 4 次，上面的步骤看起来很容易。然而，对于任何潜在的租户来说，我们知道这种情况很少发生。我们通常必须运行许多迭代来创建足够大的单元池，以便我们进行比较并做出决定。此外，在上面提到的过程之后，接下来是与代理人交谈的过程，根据我的喜好找到单位都是循规蹈矩的，等等。如果在任何时间点出了问题，那么将再次回到步骤 1 到 4。</p><p id="5eb6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">必须有一种方法，我可以在一个工作空间中编辑所有我想要的搜索结果，只需点击一个按钮就可以进行更有效的比较。 </p><p id="de9a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经下定决心要在一个叫 Ang Mo Kio 的地方找到一套三居室公寓，这个地方位于新加坡的 20 区。至于网站，我将主要关注<a class="ae lr" href="https://www.iproperty.com.sg/" rel="noopener ugc nofollow" target="_blank"> iProperty </a>。<strong class="kx ir">记住这些参数，因为它们会在这篇文章中反复出现:地区= 20，卧室= 3。</strong></p><p id="0f98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">考虑到这一点，我想到了可以帮助我做出这样一个决定的视觉辅助形式。它们是:</p><ul class=""><li id="1a93" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">一个交互式地图，它可以显示我在一个地区的所有出租屋的位置。</li><li id="fdf5" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">描绘该地区价格分布的图表，这样我就知道会发生什么。</li></ul><p id="963c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我用 Python 来做这件事吧！这个项目回购的链接可以在<a class="ae lr" href="https://github.com/reubenlee3/real-estate-rental" rel="noopener ugc nofollow" target="_blank">这里</a>找到。现在让我们开始吧。</p><h1 id="d7b8" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第 1 部分:数据源</h1><p id="082b" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">我需要的数据可以从房地产网站上获得。问题是，这不是我习惯的通常的 excel 或 csv 文件。数据以 HTML 的形式出现，看起来有点不同…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/a332184492bd9837bdf06d32910408d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZEAVGq0ZEfy-h59mwh6xA.png"/></div></div></figure><p id="3af5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我可以使用 Python 漂亮的 Soup 4 包。它允许我从网站上删除 HTML 数据。不过在刮之前，需要增加一些手续:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="758e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我需要什么信息？也许是公寓的价格、地址和大小。让我从抓取<em class="ls">地址</em>的数据开始。我不是 HTML 专家，但我知道一些元素类型中包含各种形式的信息。图 1 将演示这一点。通过检查源代码，我们可以看到，对于这个特定的单元，关于它的地址的信息包含在这个元素&lt; a &gt;中，在类‘fsKEtj’的 main &lt; div &gt;下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/b64fde31875376109655474ea8fd4862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RNinNrh_slugheI1NmOmyg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 1: Inspecting the source code</figcaption></figure><p id="8289" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">提取信息并将其存储在空的“地址”列表中的代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 2</figcaption></figure><p id="92f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">地址输出？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/4bdf52977ecd7add9ab3426944e6917f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*a2jCZ9B7BqkpRvlzbHQ7qQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 3: First five rows of the addresses scraped from the website</figcaption></figure><p id="7875" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">太好了！现在已经完成了，我们只需重复同样的过程来查找包含<em class="ls">价格</em>和<em class="ls">大小</em>信息的元素，并通过调整图 2 中的代码来提取这些信息。</p><p id="c735" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是 iProperty 搜索页面的第一页，显示了 10 套公寓。我需要更多的信息来进行适当的比较。在这篇文章中，我会选择从 5 页搜索结果中提取数据，给自己一个可供选择的公寓池。如何做到这一点？幸运的是，iProperty 的 URL 相当简单:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="4d68" class="np lu iq nl b gy nq nr l ns nt"><a class="ae lr" href="https://www.iproperty.com.sg/rent/district-20/hdb/?bedroom=3&amp;page=1" rel="noopener ugc nofollow" target="_blank">https://www.iproperty.com.sg/rent/district-20/hdb/?bedroom=3&amp;page=1</a></span></pre><p id="40a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如您所见，它只包含三个部分:<em class="ls">地区、卧室数量和页码</em>。这让生活变得容易多了，因为我现在可以循环浏览第 1 页到第 5 页。在每个循环之间，我还植入了一个<em class="ls"> time.sleep </em>函数，只是为了让我的网页抓取器表现得有点像人类，并防止我自己被阻止访问网站。</p><p id="63aa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了这个，我现在有了一个合理大小的公寓池，有三个变量:<em class="ls">价格、地址和大小</em>。在使用 pandas 将它们组合成一个数据框之后(还要注意，没有错误显示行数不同，这意味着显示的每个单元都有地址、价格和大小)，我现在需要清理数据。让我们看一下数据集的前五行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/b9b58b829ba9f659f3ef73d86695f0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tgIfgkwYfz7r6j5cJITjA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 4: First five rows of the full data set</figcaption></figure><p id="1073" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在球棒的右边，你可以看到数据的各个方面需要调整。首先，我希望<em class="ls">价格</em>和<em class="ls">尺寸</em>列是数字。因此，SGD、build-up 和必须删除。此外，仔细检查 size 列，有几个单位用“sq”表示。m 而不是 sq。英尺。。这些也需要清洗。所有采取的数据清理步骤都可以在我的<a class="ae lr" href="https://github.com/reubenlee3/real-estate-rental/blob/master/script.py" rel="noopener ugc nofollow" target="_blank">项目报告</a>中的脚本中看到。请看一下图 5 中清理过的数据集！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/2b50245b4434e41433d3ea03a768425c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*xHOlP5avmEpifgqfIzPBdw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 5: The cleaned data set</figcaption></figure><p id="e46c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">快到了！注意到单元有什么问题吗？似乎有一个“流氓”公寓(指数 1)，面积很小(100 平方英尺)，但非常昂贵(2400 美元/月)。作为一项预防措施，我检查了移除这些单元。</p><p id="4510" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我有了 iProperty 上列出的所有公寓的完整数据集，参数区= 20，卧室= 3，让我们开始创建一个交互式地图。</p><h1 id="1940" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第 2 部分:创建交互式地图</h1><p id="bb53" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">诚然，这部分是项目中最具挑战性的方面。为了在地图上绘制我的数据集中的公寓，我需要上述公寓的坐标。在这里，我将使用 Geopy 包根据我的数据集中的地址检索坐标，并使用 follow 利用这些坐标来创建地图及其交互功能。</p><p id="47d6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们遍历数据集中包含的所有地址，并提取出每个公寓的纬度和经度。然后，这两个变量将被添加到主数据集中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 6</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/50fb01212673b1aa33b4e0e9b3ab42a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHewxQsvJDclhcRFcfVOlw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 7: Full data set with new latitude and longitude columns</figcaption></figure><p id="fbf8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在获得每个公寓的坐标后，我们现在准备将它们全部标绘在新加坡地图上！让我们创建基本地图:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="0781" class="np lu iq nl b gy nq nr l ns nt">location = [1.3521,103.8198]<br/>sgmap = folium.Map(location,zoom_start = 12)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/c02eee438dd7e024eb7df7650583dfaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CcMnqMn3s64kahdF9HwhlQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 8: Base map of Singapore</figcaption></figure><p id="700f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在该添加标记了！对于我的记号笔，我包含了两个可以帮助我更有效地整合信息的特性。</p><ul class=""><li id="9f81" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">每个标记都根据其价格进行了颜色编码。所有租赁价格都是有序的，并计算它们各自的百分位数。绿色标记表示公寓的租金在 0-30%之间，橙色标记表示 30-70%之间，红色标记表示 70%以上的租金价格。</li><li id="8e47" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">每个标记处都会弹出一个窗口，显示公寓的地址和价格。</li></ul><p id="ad1a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最终产品看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/cfdec25558be3224f574ec0f69446758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSrwAyuOePyHQu9OvgFwtA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 9: Interactive map with all rental units in the Ang Mo Kio area</figcaption></figure><p id="a344" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从地图上，我可以看到大约有 5 个单位靠近捷运站。有两个相对昂贵的单位(红色)，两个价格适中的单位(橙色)和一个相对便宜的单位(绿色)。如果我点击这些单位的标记，将会出现一个如地图所示的弹出窗口。</p><h1 id="adde" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第 3 部分:显示租金价格分布</h1><p id="052c" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">这部分相当简单，因为我有我们需要的所有数据。我现在需要做的就是使用 Matplotlib 和 plot charts 来帮助我更好地理解这个地区的价格分布。我更喜欢使用箱线图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/cf627de52cf634df8254fd677b438495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_Bg8alw-ay3ur1gr9r-mA.png"/></div></div></figure><p id="db91" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">箱线图显示了价格的分布和平均价格。它让我推断出，在 Ang Mo Kio 的大多数三居室单元每月花费大约 2300 美元到 2600 美元。</p><h1 id="d836" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论和未来的改进</h1><p id="b82b" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">这个项目有许多方面可以改进。我将来非常想探索的一个领域是在展示公寓时加入一个排名系统。例如，可以使用诸如到 MRT(地铁)的距离、到超市的距离、到学校的距离等因素来给特定公寓分配分数，并且具有较高分数的公寓将更有利地显示在地图上。现在，我的空闲时间到了，我不得不满足于现有的模式。</p><p id="7585" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一个方面是，所有这些都是在笔记本 IDE 上完成的。如果我想让其他人使用这个工具，他们首先需要访问一个笔记本环境。在未来，我一定会把这变成一个基于网络的应用程序！</p><p id="cf86" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过这个项目，我创造了一个简单的工具，可以帮助我更有效地找到未来的家。摆弄 Python 和它的库是一次愉快的旅程，我一定会回来学习更多！</p><h1 id="816f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">参考</h1><p id="0451" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated"><a class="ae lr" rel="noopener" target="_blank" href="/master-python-through-building-real-world-applications-part-2-60d707955aa3">https://towards data science . com/master-python-through-building-real-world-applications-part-2-60d 707955 aa3</a>—一份精彩的使用 real 的指南</p></div></div>    
</body>
</html>