<html>
<head>
<title>Getting R and D3.js to play nicely in R markdown</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让R和D3.js在R markdown中正常运行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-r-and-d3-js-to-play-nicely-in-r-markdown-270e302a52d3?source=collection_archive---------0-----------------------#2016-12-08">https://towardsdatascience.com/getting-r-and-d3-js-to-play-nicely-in-r-markdown-270e302a52d3?source=collection_archive---------0-----------------------#2016-12-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/b78e950531d12bb3bd7d725f20429f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*cuHmndYevKsJUol14LlWtA.png"/></div></figure><div class=""/><p id="563a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为已经有很多优秀的资源是由更有资格的人制作的，所以这并不是JavaScript、D3.js、R或R markdown的全面教程。相反，它的目的是展示在一个文件中使用所有这些文件的经验。</p><p id="484c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了使本教程简单，让我们假设数据已经完全科学化，剩下的就是创建D3可视化。请看一下R附带的原始样本数据集</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="d4b3" class="le lf ix kv b gy lg lh l li lj">head(cars)</span><span id="c5d4" class="le lf ix kv b gy lk lh l li lj">##   speed dist<br/>## 1     4    2<br/>## 2     4   10<br/>## 3     7    4<br/>## 4     7   22<br/>## 5     8   16<br/>## 6     9   10</span></pre><p id="585d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在语言之间传递数据不像引用包含它们的变量的名称那么简单。如果您尝试在上面的R块后面添加JavaScript代码<code class="fe ks kt ku kv b">console.log(cars);</code>，它将返回一个<code class="fe ks kt ku kv b">ReferenceError</code>，因为<code class="fe ks kt ku kv b">cars</code>尚未在JavaScript中定义。</p><p id="2e30" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以将数据写入一个新文件，然后使用D3中适当的加载方法读回该文件。但是，可以将数据直接传递给。Rmd文件。</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="1019" class="le lf ix kv b gy lg lh l li lj">cat(<br/>  paste(<br/>  '&lt;script&gt;<br/>    var data = ',cars,';<br/>  &lt;/script&gt;'<br/>  , sep="")<br/>)</span><span id="3b61" class="le lf ix kv b gy lk lh l li lj">## <br/>## &lt;script&gt;<br/>##   var data = c(4, 4, 7, ... 24, 24, 25);<br/>## &lt;/script&gt;<br/>## &lt;script&gt;<br/>##   var data = c(2, 10, 4, ... 93, 120, 85);<br/>## &lt;/script&gt;</span></pre><p id="77c2" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">上面的代码确实会将数据传递到我们的JavaScript空间；然而，我们给自己制造了两个新问题:</p><ul class=""><li id="5498" class="ll lm ix jw b jx jy kb kc kf ln kj lo kn lp kr lq lr ls lt bi translated">数据中的每一列都作为R向量被传递，JavaScript会将其解释为对某个函数<code class="fe ks kt ku kv b">c()</code>的调用，每个值都作为参数被传递。</li><li id="e7cd" class="ll lm ix jw b jx lu kb lv kf lw kj lx kn ly kr lq lr ls lt bi translated">这些列被逐个传递给JavaScript变量<code class="fe ks kt ku kv b">data</code>，用<code class="fe ks kt ku kv b">dist</code>列中的值覆盖<code class="fe ks kt ku kv b">speed</code>列中的值。</li></ul><p id="ddf0" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要同时解决这两个问题，可以利用D3的假设，即它处理的数据是JSON格式的。r的<code class="fe ks kt ku kv b">jsonlite</code>库是轻量级的，有一个简单的<code class="fe ks kt ku kv b">toJSON()</code>方法，非常适合我们的目的。</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="a348" class="le lf ix kv b gy lg lh l li lj">library("jsonlite")<br/>cat(<br/>  paste(<br/>  '&lt;script&gt;<br/>    var data = ',toJSON(cars),';<br/>  &lt;/script&gt;'<br/>  , sep="")<br/>)</span><span id="acca" class="le lf ix kv b gy lk lh l li lj">## &lt;script&gt;<br/>##   var data = [{"speed":4,"dist":2},<br/>##               {"speed":4,"dist":10},<br/>##               {"speed":7,"dist":4},<br/>##                 ...<br/>##               {"speed":24,"dist":93},<br/>##               {"speed":24,"dist":120},<br/>##               {"speed":25,"dist":85}];<br/>## &lt;/script&gt;</span></pre><p id="f5e8" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy"><em class="lz">* *您必须在代码块顶部的花括号中包含results="asis "选项，以便通过** </em> </strong>传递数据</p><p id="333a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在JavaScript有了数据，而且是它可以处理的格式。是时候开始D3ing了！</p><p id="82d0" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有两种方法可以加载D3库。在可视化之前的任何时候，将<code class="fe ks kt ku kv b">&lt;script src="https://d3js.org/d3.v4.min.js"&gt;&lt;/script&gt;</code>直接包含在您的降价文件中。或者在与您相同的目录中创建一个. html文件，其中只包含相同的脚本标记。Rmd文件和<a class="ae ma" href="http://rmarkdown.rstudio.com/html_document_format.html#includes" rel="noopener ugc nofollow" target="_blank">包含它</a></p><p id="364f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你现在可以在R markdown中自由地想象D3.js，直到你满意为止。只需用JavaScript代码块添加代码，直接在markdown中的脚本标记之间，或者在用脚本标记链接的单独文件中。</p><p id="695a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我应该加一句警告。如果你是那种只从https://bl.ocks.org T2复制/粘贴的人，这没什么不好意思的——我个人不知道有谁使用D3不这么做——但是你必须记住他们的数据总是通过D3的加载方法从外部来源读入的。您必须删除这些代码行，并在D3的<code class="fe ks kt ku kv b">.data()</code>方法中代入您的数据变量。此外，一定要检查D3代码，更新对列名的所有数据引用。</p><p id="a4db" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ma" href="https://github.com/becausealice2/D3-in-Rmd" rel="noopener ugc nofollow" target="_blank">查看GitHub上的代码</a></p></div></div>    
</body>
</html>