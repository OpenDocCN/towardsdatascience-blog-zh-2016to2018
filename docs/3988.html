<html>
<head>
<title>Visualizing Professional StarCraft with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 可视化职业星际争霸</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-professional-starcraft-with-r-598b5e7a82ac?source=collection_archive---------5-----------------------#2018-07-07">https://towardsdatascience.com/visualizing-professional-starcraft-with-r-598b5e7a82ac?source=collection_archive---------5-----------------------#2018-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/60cf328b70be17c42099aa819ed042db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HOnCQ4ozLzGYYXzkaYBfPg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Snapshot of a Protoss vs Terran Match</figcaption></figure><div class=""/><p id="b60c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">自从我开始为《星际争霸:育雏战争》进行数据挖掘专业回放以来，已经过去了将近十年。在最近试用了 R 中的新动画包后，我想重新访问这个数据集，看看我是否可以用<a class="ae la" href="https://github.com/thomasp85/gganimate" rel="noopener ugc nofollow" target="_blank"> gganimate </a>和<a class="ae la" href="https://github.com/thomasp85/tweenr" rel="noopener ugc nofollow" target="_blank"> tweenr </a>包使用其中一些回放制作一个有趣的可视化效果。结果就是下面的视频:</p><figure class="lb lc ld le gt is"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Terran vs Zerg</figcaption></figure><p id="7952" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这篇博文讲述了我创作这个视频的 R 脚本。用于生成该可视化的所有数据和代码都可以在<a class="ae la" href="https://github.com/bgweber/StarCraftMining/tree/master/viz" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。我通过观看星际争霸中的回放并使用<a class="ae la" href="https://github.com/bwapi/bwapi" rel="noopener ugc nofollow" target="_blank"> BWAPI </a>每 5 秒输出一次游戏状态的快照来生成数据集。这里也可以使用可用的数据集<a class="ae la" href="http://nova.wolfwork.com/dataMining.html" rel="noopener ugc nofollow" target="_blank"/>。这个过程的结果是，我最终得到了以下格式的 CSV 文件:</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="9f50" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg">frame,pID,unitID,x,y<br/></strong>0,0,12,3792,864<br/>0,0,19,3744,858<br/>0,0,30,3704,864<br/>0,0,34,3808,834<br/>0,0,64,3768,864</span></pre><p id="079e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该文件指定了游戏帧或刻度计数、控制该单元的玩家的 ID、用于跟踪该单元的游戏内标识符以及该单元的位置。虽然包含单位类型和状态变量(如健康)会很有用，但这些数据为可视化军队的移动提供了一个起点。数据集包括建筑物和移动单位，但不包括中立单位和结构。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="369f" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg"># libraries<br/></strong>library(ggplot2)<br/>library(gganimate)<br/>library(ggforce)<br/>library(tweenr)<br/>library(dplyr)</span></pre><p id="2d1b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如前所述，我使用 gganimate 和 tweenr 库来创建可视化。gganimate 对于在 R 中创建动画图很有用，而 tweenr 提供了在动画中的不同捕捉点之间进行插值的方法。ggplot2 用于创建实际绘图，ggforce 用于设计绘图样式，dplyr 用于设置数据。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="2e16" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg"># video settings <br/></strong>fps &lt;- 24<br/>nframes &lt;- 5000</span></pre><p id="0476" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我为视频回放定义了两个参数。第一个<em class="ls"> fps </em>是输出视频的帧速率，第二个<em class="ls"> nframes </em>是视频的总长度。视频的长度将为<em class="ls">n 帧/fps </em>秒。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="f4c1" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg"># load the replay data <br/></strong>df &lt;- read.csv("PvT.csv") </span><span id="4723" class="lm ln jf li b gy lt lp l lq lr"><strong class="li jg"># lag the x and y coordinates to plot lines of movement</strong> <br/>df &lt;-  df %&gt;%  group_by(unitID) %&gt;%  <br/>    mutate(x1 = dplyr::lag(x, n = 1, default = NA),         <br/>           x2 = dplyr::lag(x, n = 2, default = NA), <br/>           y1 = dplyr::lag(y, n = 1, default = NA),<br/>           y2 = dplyr::lag(y, n = 2, default = NA))</span></pre><p id="29a5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下一步是加载和转换数据。加载的数据帧包括每个单位在特定游戏时间的 x 和 y 位置，但我也想延迟这些值，以便在坐标之间画线。我使用 dplyr 和 mutate 来使 x 和 y 位置分别滞后 5 秒和 10 秒。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="faac" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg"># set up graphics <br/></strong>df$colour &lt;- ifelse(df$pID == 0, 'RED', 'GREEN')<br/>df$time &lt;- df$frame / fps<br/>df$ease = 'linear'<br/>df$size = 5<br/>df$alpha = 1 </span><span id="9c01" class="lm ln jf li b gy lt lp l lq lr"><strong class="li jg"># Use tweenr<br/></strong>dt &lt;- tween_elements(df, 'time', 'unitID', 'ease', nframes=nframes)</span></pre><p id="d835" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，我为绘图设置附加参数，包括单位的颜色和大小，以及用于动画的插值类型。最后一步使用 tweenr 构建一个数据帧，在输入数据帧的不同状态之间进行插值。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="3ff7" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg"># animate with gganimate<br/></strong>p &lt;- ggplot(data = dt) +  <br/>    geom_point(aes(x=0, y=0, size=10, alpha=0, frame = .frame)) +   <br/>    geom_segment(aes(x=x1, y=y1, xend=x2, yend=y2, size=1, <br/>                 alpha=0.5, frame = .frame, color = colour)) +   <br/>    geom_segment(aes(x=x, y=y, xend=x1, yend=y1, size=1, alpha=1,<br/>                 frame = .frame, color = colour)) +   <br/>    geom_point(aes(x=x, y=y, size=size, alpha=alpha, frame = .frame,<br/>                 color = colour)) +   <br/>    scale_size(guide = 'none') +   <br/>    scale_colour_identity() +   <br/>    scale_alpha(range = c(0, 1), guide = 'none') +     <br/>    ggforce::theme_no_axes()</span></pre><p id="412a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下一步是创建数据图，包括线和点。第一个几何点用于缩放点的大小，第二个几何点用于绘制单位。两个 geom_segment 调用用于在单元的当前和过去位置之间画线。旧的轨迹比新的轨迹颜色浅(<em class="ls"> alpha = 0.5 </em>)。代码块的其余部分修改了绘图的样式。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="37e7" class="lm ln jf li b gy lo lp l lq lr"><strong class="li jg"># output the video<br/></strong>animation::ani.options(interval = 1/fps)<br/>gganimate(p, "output.mp4", ani.width=640, ani.height=640 <br/>    ,title_frame = FALSE)</span></pre><p id="ab6c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后一步是创建动画情节的视频。我将视频大小设置为 640×640 像素，并禁用了视频顶部的帧计数器。也可以输出 gif 和网页。该脚本的结果显示在下面的示例视频中。渲染可能需要相当长的时间。</p><figure class="lb lc ld le gt is"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Protoss vs Terran</figcaption></figure><p id="c90a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">视频显示了神族(红色)对人族(绿色)游戏中的部队移动。视频的开头显示了侦察阶段和最初的冲突。稍后，你可以在地图上看到人族玩家放置蜘蛛雷的位置。在神族玩家拿出一个扩张点并获得地图中间的控制权后，比赛结束。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="8f5a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://www.linkedin.com/in/ben-weber-3b87482/" rel="noopener ugc nofollow" target="_blank">本·韦伯</a>是 Zynga 的首席数据科学家。我们正在<a class="ae la" href="https://www.zynga.com/careers/positions/categories/data-analytics-user-research" rel="noopener ugc nofollow" target="_blank">招聘</a>！</p><figure class="lb lc ld le gt is"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Zerg vs Protoss</figcaption></figure></div></div>    
</body>
</html>