<html>
<head>
<title>Deployment of Web App + ML Model + APIs — Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署 Web 应用程序+ ML 模型+API—教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simple-deployment-of-web-app-ml-model-apis-tutorial-2ece8e66d98c?source=collection_archive---------9-----------------------#2018-12-04">https://towardsdatascience.com/simple-deployment-of-web-app-ml-model-apis-tutorial-2ece8e66d98c?source=collection_archive---------9-----------------------#2018-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="14f4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何部署由逻辑回归模型提供服务的 web 应用程序。我们将创建一个应用程序来预测数据科学家年收入超过 10 万美元的概率。</h2></div><p id="15e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果不投入生产，创造一个 ML 模型有什么意义？计算模型的指标并将其调整到更好的性能并不是数据科学家工作的终点。你能做的远不止这些。事实上，部署一个可伸缩的模型比看起来容易得多。知道如何做到这一点，肯定会给你的简历增加很大的价值，因为大多数数据科学家不会走那么远。您可以将本教程视为成为数据科学独角兽的第一步。</p><h1 id="7a73" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">我们在这里做什么？</h1><p id="67d4" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">我们将在 AWS Lambda 中部署一个逻辑回归模型，然后用 API Gateway 创建 API 端点。这样你就有了一个可扩展的服务模型，你只需要做一个简单的 POST 请求，它就会把预测结果返回给你。</p><p id="ef74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们将构建一个带有 HTML 表单的 Flask 应用程序，以获取一些答案来填充我们的模型。该应用程序向我们的 API 发出请求，将用户重定向到另一个页面，并在其上展示模型预测。</p><blockquote class="mb"><p id="c817" class="mc md it bd me mf mg mh mi mj mk ld dk translated">在这里，您可以访问我们在本教程中开发的工作应用程序。你爱怎么玩就怎么玩。</p></blockquote><figure class="mn mo mp mq mr ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mm"><img src="../Images/5dd33e69e3c6e68b0ee5ad54c508d236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzhQ-kjsULhwF523pHlJBw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">This is how our Flask App will look like.</figcaption></figure><h1 id="80e7" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">第一:模型</h1><p id="6f27" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">这篇文章的主要目的不是开发一个模型，但是你可以自由地<a class="ae ml" href="https://www.kaggle.com/andresionek/what-makes-a-kaggler-valuable" rel="noopener ugc nofollow" target="_blank">查看我们在这里使用的模型是如何开发的。</a>这是一个简单的逻辑回归模型。要部署它，我们基本上有两种选择:</p><ol class=""><li id="36d3" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld ni nj nk nl bi translated">将模型导出为序列化对象，加载到 AWS lambda 并开始进行预测。</li><li id="688e" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated"><a class="ae ml" href="https://en.wikipedia.org/wiki/Parametrization" rel="noopener ugc nofollow" target="_blank">参数化</a>模型，将所有系数和截距手动加载到λ。</li></ol><p id="187a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我选择第二个选项，因为我希望模型对任何人都是透明的。应该清楚系数是什么，分数是怎么算出来的。一个系列化的模型不会让我们看到细节。</p><p id="4893" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇由本·韦伯撰写的<a class="ae ml" rel="noopener" target="_blank" href="/data-science-for-startups-model-services-2facf2dde81d">关于数据科学的文章中，你会找到关于如何向 AWS Lambda 部署序列化模型的说明。</a></p><h2 id="7afd" class="nr lf it bd lg ns nt dn lk nu nv dp lo kr nw nx lq kv ny nz ls kz oa ob lu oc bi translated">参数化:那是什么鬼东西？</h2><p id="0d36" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">逻辑回归模型可以写成这样:</p><pre class="od oe of og gt oh oi oj ok aw ol bi"><span id="8ae5" class="nr lf it oi b gy om on l oo op">log-odds = b0 + b1x1 + b2x2 + ... + bnxn </span><span id="6486" class="nr lf it oi b gy oq on l oo op"><strong class="oi iu">Where</strong>:<br/><strong class="oi iu">b0</strong> is the intercept<br/><strong class="oi iu">b1,b2, bn</strong> are the coefficients<br/><strong class="oi iu">x1, x2, xn</strong> are the variables</span></pre><p id="1d08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们<a class="ae ml" href="https://www.kaggle.com/andresionek/what-makes-a-kaggler-valuable" rel="noopener ugc nofollow" target="_blank">训练我们的模型</a>并得到所有系数的值。所以这只是一个手工写方程的问题:将所有系数和截距相加。然后为了得到 0 到 1 之间的分数(概率),我们做:</p><pre class="od oe of og gt oh oi oj ok aw ol bi"><span id="b61c" class="nr lf it oi b gy om on l oo op">scores = 1 / (1 + exp(-(b0 + b1x1 + b2x2 + ... + bnxn)))</span></pre><h1 id="908b" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">第二:λ</h1><p id="70e6" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">登录 AWS 控制台，转到 IAM 并创建一个至少附加了这些权限策略的角色:</p><ul class=""><li id="318a" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld or nj nk nl bi translated">AWSLambdaFullAccess</li><li id="0686" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld or nj nk nl bi translated">亚马逊 3 完全访问</li><li id="e96f" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld or nj nk nl bi translated">CloudWatchFullAccess</li></ul><figure class="od oe of og gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi os"><img src="../Images/02aabf175b1c72a71173db1f328ad741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWzIdFA7dCHIcJhLbrHyFg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">IAM Role Permissions</figcaption></figure><p id="e0a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后你可以去 Lambda，点击进入“创建函数”。现在我们将定义函数的基本配置。</p><figure class="od oe of og gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ot"><img src="../Images/493ab720796cf60e216cf67172152b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CqAXc5Bh_sfCAK97LkWwiw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">Choose the runtime to be Python 3.7, and the role to be the one you just created.</figcaption></figure><p id="cb32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您转到函数代码，将以下内容添加到已经创建的 lambda 函数中:</p><figure class="od oe of og gt ms"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="aa33" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">这段代码是做什么的？</strong></p><p id="10ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数接收一个 json 作为事件参数，并将其处理为正确的格式。接下来，我们用下面将要定义的帮助函数计算分数，然后我们构建一个响应并返回它。就这么简单。</p><p id="3b65" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们将创建一些辅助函数。转到文件&gt;从模板新建&gt; Python 文件:</p><figure class="od oe of og gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ow"><img src="../Images/130ddd42477e2c6377af76cb99b40d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLW5TmSNHv9xk8DOcyFfjw.png"/></div></div></figure><p id="e58a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加以下代码，并将其保存为 normalizer.py:</p><figure class="od oe of og gt ms"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="34d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建一个新的 Python 文件，将其命名为 pre_treatment.py:</p><figure class="od oe of og gt ms"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="95a4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们将添加一个计算分数的函数。请注意，这里的模型系数是硬编码的。命名为 scorer.py。</p><figure class="od oe of og gt ms"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="ecfa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">搞定了。现在让我们为我们的模型创建一个 API。在设计器&gt;添加触发器，点击 API 网关。</p><figure class="od oe of og gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ox"><img src="../Images/0fa5975256caa50d787f5cecafa9d5ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3CrZSuqrXu4h596l3Md9Q.png"/></div></div></figure><p id="db7b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击 configuration required，选择 create a new API，然后保存 lambda 函数。如果您返回到 API 网关，您应该会看到一个可用的端点。这就是你用来访问你的 API 的那个。</p><p id="9bd7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要测试您的 API，只需向端点发送一个 POST 请求，如下所示(用您刚刚创建的 url 替换 URL):</p><figure class="od oe of og gt ms"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="558c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您应该期望得到计算的分数作为响应。大概是这样的:</p><pre class="od oe of og gt oh oi oj ok aw ol bi"><span id="ad88" class="nr lf it oi b gy om on l oo op">{ “isBase64Encoded”: False, <br/>  “headers”: {“Content-Type”: “application/json”}, <br/>  “statusCode”: 200, <br/>  “body”: {“score”: 350}<br/>}</span></pre><p id="e43e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了！我们刚刚创建了一个可伸缩的服务，它在给定输入的情况下运行我们的模型。现在，我们构建了一个 web 应用程序，它向我们的服务发送请求，并期望得到答案。</p><p id="9895" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整的项目有更多的功能，看看这里:</p><div class="oy oz gp gr pa pb"><a href="https://github.com/andresionek91/kaggle-top20-predictor" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd iu gy z fp pg fr fs ph fu fw is bi translated">andresionek 91/ka ggle-top 20-预测器</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">预测数据科学家的年收入是否超过 10 万美元-andresionek 91/ka ggle-top 20-预测者</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">github.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp mx pb"/></div></div></a></div><h1 id="acef" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">第三:Flask 应用</h1><p id="467b" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">用下面的文件夹结构创建一个项目(<a class="ae ml" href="https://github.com/andresionek91/data-scientist-value" rel="noopener ugc nofollow" target="_blank">你可以从我的 github </a>中克隆它)。</p><figure class="od oe of og gt ms gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/c00855576425068e19f54875d3695e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*7GQML0HadTQ6ThYs6Y8gUg.png"/></div></figure><p id="9bb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有两个 HTML 页面(index.html 和 score.html)存储在模板文件夹中。所有的 css，图片和 js 都在静态文件夹中。我们对这个应用程序感兴趣。py:</p><figure class="od oe of og gt ms"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="ea55" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将我们的应用程序部署到 beanstalk 也很简单。</p><ol class=""><li id="1759" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld ni nj nk nl bi translated">首先确保在文件夹中创建了 git 存储库。确保代码被提交并推送到主服务器。</li><li id="7657" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">打开终端并运行<code class="fe pr ps pt oi b">pip install awsebcli</code>来安装 Beanstalk 命令行界面</li><li id="9e60" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">然后<code class="fe pr ps pt oi b">cd</code>到你的项目文件夹并运行<code class="fe pr ps pt oi b">eb init</code></li><li id="79ea" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">运行之后，您可以运行<code class="fe pr ps pt oi b">eb create</code>来创建您的应用程序</li><li id="84b3" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">最后<code class="fe pr ps pt oi b">eb open</code>会打开你的 app 网址</li></ol><p id="4188" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要进行额外的部署和更新:</p><ol class=""><li id="b0f5" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld ni nj nk nl bi translated">首先提交/推送代码</li><li id="ac38" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">然后运行<code class="fe pr ps pt oi b">eb deploy</code></li></ol><p id="157a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整烧瓶项目可从以下网址获得:</p><div class="oy oz gp gr pa pb"><a href="https://github.com/andresionek91/data-scientist-value" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd iu gy z fp pg fr fs ph fu fw is bi translated">andresionek 91/数据-科学家-价值</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">计算数据科学家报酬的 Flask 应用程序-andresionek 91/data-scientist-value</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">github.com</p></div></div><div class="pk l"><div class="pu l pm pn po pk pp mx pb"/></div></div></a></div><figure class="od oe of og gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi pv"><img src="../Images/2ce90997c0f0bc29c8ae6e5b639b9611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9EfAJkE1A60sk7x_zzwIwQ.png"/></div></div></figure><p id="18e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个将 ML 模型部署为服务的教程，创建一个 API，最后使用 Flask 构建一个 web 应用程序来请求我们的模型的 API。我知道这个教程可能过于简单，但是你可以通过简单的网上搜索找到大量关于每个主题的详细资料。这个想法只是为了证明这是可能的，而且并不复杂！</p><p id="a892" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望这篇文章能帮助你找到成为更有价值的数据科学家的方法！</p></div></div>    
</body>
</html>