<html>
<head>
<title>Live Visualisations of CNN’s Activation Maps (Using Tensorflow.js)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CNN 活动地图的实时可视化(使用 Tensorflow.js)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/live-visualisations-of-cnns-activation-maps-using-tensorflow-js-27353cfffb43?source=collection_archive---------7-----------------------#2018-09-07">https://towardsdatascience.com/live-visualisations-of-cnns-activation-maps-using-tensorflow-js-27353cfffb43?source=collection_archive---------7-----------------------#2018-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq"><div class="bz fp l di"><div class="jr js l"/></div></figure><p id="f3f1" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">CNN 中有哪些激活图？</strong></p><p id="129d" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">简单地说，激活图是特定卷积层的输出。我们可以使用激活图来可视化 CNN。</p><p id="1429" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">(这里，卷积层被称为卷积层，后跟最大池。)</p><p id="f3a7" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">激活地图有帮助吗？</strong></p><p id="11dc" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">是的，它们对 CNN 的可视化很有用，我们也可以部分地回答这样的问题:“CNN 是如何做决策的？”，“CNN 学哪些东西？”</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><p id="310e" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">剩余博文分为以下主题。</strong></p><ol class=""><li id="7702" class="ky kz iq jv b jw jx ka kb ke la ki lb km lc kq ld le lf lg bi translated">CNN 详情</li><li id="ade3" class="ky kz iq jv b jw lh ka li ke lj ki lk km ll kq ld le lf lg bi translated">将 Keras 模型转换为 Tensorflow.js 模型</li><li id="d0e2" class="ky kz iq jv b jw lh ka li ke lj ki lk km ll kq ld le lf lg bi translated">运行推理并保存激活图</li><li id="7280" class="ky kz iq jv b jw lh ka li ke lj ki lk km ll kq ld le lf lg bi translated">显示激活图</li></ol></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="f600" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">CNN 的细节</h1><p id="8af2" class="pw-post-body-paragraph jt ju iq jv b jw mk jy jz ka ml kc kd ke mm kg kh ki mn kk kl km mo ko kp kq ij bi translated">对于实时可视化，我们需要更小的 CNN，它甚至可以在 CPU 上实时输出预测。所以，任何卷积层数少的 CNN 都可以。作为机器学习课程的一部分，我训练了紧凑型 CNN (3 Conv。层+ 2 FC 层)用于使用面部图像的二元性别分类。CNN 在包含 40k 张面部图像的 IMDB-WIKI 面部数据集【1】的子集上接受训练。受过训练的 CNN 有 0.94 F1 分。</p><p id="1555" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">CNN 架构的更多细节可以在<a class="ae mp" href="https://raw.githubusercontent.com/immortal3/OnlineActivationMap/gh-pages/res/pics/model.png" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="mr ms mt mu gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mq"><img src="../Images/c4a5aa15dfbb9ba7bebfae021c4b2645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQIRSabIohKZ7e7OVERceQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk"><strong class="bd nf">Activation Map of First Layer</strong></figcaption></figure><figure class="mr ms mt mu gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ng"><img src="../Images/092b246d320ff332c5e5b1037ab0d8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEjKq39QQDiBi3zaXTpdZg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk"><strong class="bd nf">Activation Map of Second Layer</strong></figcaption></figure><figure class="mr ms mt mu gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ng"><img src="../Images/c7742c6b7989a0cab0abceb03bec1b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJy5y50vE9T-hFRD-dtHgQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk"><strong class="bd nf">Activation Map of Third Layer</strong></figcaption></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="0a12" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">将 Keras 模型转换为 Tensorflow.js 模型</h1><p id="04ca" class="pw-post-body-paragraph jt ju iq jv b jw mk jy jz ka ml kc kd ke mm kg kh ki mn kk kl km mo ko kp kq ij bi translated">CNN 在 Keras 中实现，保存为 Keras 模型。有一种简单的方法可以将 keras 模型转换为 Tensorflow.js 兼容模型。</p><p id="f0e1" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">转换模型的步骤如下。官方文件可以在<a class="ae mp" href="https://js.tensorflow.org/tutorials/import-keras.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="mr ms mt mu gt nh ni nj nk aw nl bi"><span id="437c" class="nm ln iq ni b gy nn no l np nq"># install dependency <br/>$ pip install tensorflowjs</span><span id="341a" class="nm ln iq ni b gy nr no l np nq"># Converting Model<br/>$ <!-- -->tensorflowjs_converter --input_format keras \<br/>                       path/to/my_model.h5 \<br/>                       path/to/tfjs_target_dir</span></pre><p id="5f63" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">输出填充将如下所示:</p><pre class="mr ms mt mu gt nh ni nj nk aw nl bi"><span id="b1ef" class="nm ln iq ni b gy nn no l np nq">$ ls tfjs_traget_dir<br/>model.json<br/>group1-shard1of1 <br/>group2-shard1of1<br/>...<br/>...<br/>group6-shard1of1</span></pre></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="65ce" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">运行推理并保存激活图</h1><p id="31c8" class="pw-post-body-paragraph jt ju iq jv b jw mk jy jz ka ml kc kd ke mm kg kh ki mn kk kl km mo ko kp kq ij bi translated">现在，是时候用 CNN 模型预测性别了。为简单起见，我们假设我们的面部图像来自现场直播。</p><p id="0c6f" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">您可以查看<a class="ae mp" href="https://github.com/immortal3/OnlineActivationMap" rel="noopener ugc nofollow" target="_blank">完整代码</a>，其中包含使用<a class="ae mp" href="https://trackingjs.com/examples/face_camera.html" rel="noopener ugc nofollow" target="_blank"> tracking.js </a>提取面部图像，然后调整为固定大小(50x50)的实现。</p><pre class="mr ms mt mu gt nh ni nj nk aw nl bi"><span id="8285" class="nm ln iq ni b gy nn no l np nq"># loading Model <br/>genderAI = await tf.loadModel('<a class="ae mp" href="https://immortal3.github.io/OnlineActivationMap/res/model/model.json'" rel="noopener ugc nofollow" target="_blank">https://immortal3.github.io/OnlineActivationMap/res/model/model.json'</a>);</span></pre><p id="e228" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">我们可以直接使用推论，但那样我们就只有最终结果了。我们希望在前进过程中保存激活图以便可视化。</p><pre class="mr ms mt mu gt nh ni nj nk aw nl bi"><span id="5d39" class="nm ln iq ni b gy nn no l np nq"># Final Prediction<br/>const genderprediction = model.predict(face_image);</span></pre><p id="c199" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在前进过程中保存激活地图。</p><pre class="mr ms mt mu gt nh ni nj nk aw nl bi"><span id="93ad" class="nm ln iq ni b gy nn no l np nq"># list containing input for every layer<br/>var input = []</span><span id="d610" class="nm ln iq ni b gy nr no l np nq"># First Layer;s Input is Facial Image<br/>input.push(tf.tidy(() =&gt; { return tf.expandDims(facialImage,0).asType('float32').div(255.0)}));<br/>       <br/># passing Input to every layer and saving output as input for next layer    <br/>for (var i = 1; i &lt;= 12; i++) {<br/>   input.push(genderAI.layers[i].apply(input[i-1]));<br/>}<br/>       <br/># Saving activationmaps (note that we are displaying activation map after applying max pool)     <br/>const firstconvactivationmap = input[2];<br/>const secondconvactivationmap = input[4];<br/>const thirdconvactivationmap = input[6];</span></pre></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><p id="6c9a" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">显示激活地图</strong></p><p id="3812" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">为了可视化，我们可以使用 ploty.js 中的<a class="ae mp" href="https://plot.ly/javascript/heatmaps/" rel="noopener ugc nofollow" target="_blank">热图。您可以查看包含实现的完整代码。</a></p><figure class="mr ms mt mu gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ns"><img src="../Images/21c8d0a9719a2835d22540bdf2e78c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E78Y4X1f1kq2UfpVGrHyow.png"/></div></div></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><p id="c986" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">现场演示:<a class="ae mp" href="https://immortal3.github.io/OnlineActivationMap/" rel="noopener ugc nofollow" target="_blank">https://immortal3.github.io/OnlineActivationMap/</a></p><p id="775e" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">完整代码:【https://github.com/immortal3/OnlineActivationMap T2】/</p><p id="4b12" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">关于我:【https://immortal3.github.io/about/】T4</p><p id="ce7f" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">(注意:对于 Mac 用户来说，tensorflow.js 存在一些问题，因此，它可能会工作，也可能不会工作。)</p></div></div>    
</body>
</html>