<html>
<head>
<title>Predict Where a New User Will Book Their First Travel Experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测新用户将在哪里预订他们的第一次旅行体验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predict-where-a-new-user-will-book-their-first-travel-experience-e6c9ada67cf4?source=collection_archive---------11-----------------------#2018-11-22">https://towardsdatascience.com/predict-where-a-new-user-will-book-their-first-travel-experience-e6c9ada67cf4?source=collection_archive---------11-----------------------#2018-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/92539c6bd692424266912029df0cf3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJFQhu5ed4q4QfdkVAreSA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo credit: Pixabay</figcaption></figure><div class=""/><div class=""><h2 id="d546" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">用户意图预测，学习排名</h2></div><p id="1e7a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Airbnb 网站的核心是它的搜索。其搜索的一个最重要的特点是搜索排名。</p><p id="498d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Airbnb 显示的搜索结果是个性化的，针对他们预测最适合该用户的列表和体验。</p><p id="1f56" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这篇文章详细介绍了对 Airbnb 发布的两个数据集的探索，其目的是预测 Airbnb 用户预订旅行的第一个国家。更具体地说，以相关性递减的顺序预测前 5 个旅游目的地国家。</p><p id="b5ec" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们希望通过根据客人的人口统计信息和会议活动推断客人的偏好来实现一定程度的个性化，因为客人通过参与列表和进行查询来计划他们的旅行。</p><h1 id="c974" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">数据</h1><p id="f16f" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">数据集可以从<a class="ae lq" href="https://www.kaggle.com/c/airbnb-recruiting-new-user-bookings/data" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载，我们将使用三个数据集:</p><ul class=""><li id="5814" class="mo mp jf kw b kx ky la lb ld mq lh mr ll ms lp mt mu mv mw bi translated">train _ users.csv</li><li id="307c" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">测试 _ 用户. csv</li><li id="96eb" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">sessions.csv</li></ul><p id="a77f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有 16 个特征来描述每个用户，它们是:</p><ul class=""><li id="5c97" class="mo mp jf kw b kx ky la lb ld mq lh mr ll ms lp mt mu mv mw bi translated">id:用户 id</li><li id="4bcd" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">date_account_created:帐户创建日期</li><li id="0c4e" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">timestamp_first_active:第一个活动的时间戳，注意它可以早于 date_account_created 或 date_first_booking，因为用户可以在注册之前进行搜索</li><li id="4e77" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">date_first_booking:首次预订的日期</li><li id="3ee5" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">性别</li><li id="2a69" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">年龄</li><li id="245f" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">注册方法</li><li id="125f" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">注册流:用户注册的页面</li><li id="8a4d" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">语言:国际语言偏好</li><li id="1474" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">affiliate_channel:什么样的付费营销</li><li id="1a67" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">affiliate_provider:营销的地方，如谷歌，craigslist，其他</li><li id="db43" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">first_affiliate_tracked:用户在注册之前互动的第一个营销是什么</li><li id="25a5" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">注册应用程序</li><li id="37ce" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">第一设备类型</li><li id="ee1f" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">第一个浏览器</li><li id="cfa5" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">country_destination:这是我们要预测的目标变量</li></ul><p id="ac5b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">描述每个 web 会话有 6 个特征，它们是:</p><ul class=""><li id="0619" class="mo mp jf kw b kx ky la lb ld mq lh mr ll ms lp mt mu mv mw bi translated">user_id:与 users 表中的列' id '连接</li><li id="f29f" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">行为</li><li id="d44d" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">动作类型</li><li id="f747" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">行动 _ 详细信息</li><li id="3635" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">设备类型</li><li id="d18a" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">secs _ elapsed</li></ul><h1 id="ba1c" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">用户探索</h1><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="d621" class="nl ls jf nh b gy nm nn l no np">import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="aabf" class="nl ls jf nh b gy nq nn l no np">train_users = pd.read_csv('train_users_2.csv')<br/>test_users = pd.read_csv('test_users.csv')<br/>print("There were", train_users.shape[0], "users in the training set and", test_users.shape[0], "in the test set.")<br/>print("In total there were", train_users.shape[0] + test_users.shape[0], "users.")</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/6b095b06d9f9d2f9bb93b3f8f7be6028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s1yq4BUdusJz41MwPOlCpw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="0393" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将探索训练和测试数据集中的所有用户。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="6d13" class="nl ls jf nh b gy nm nn l no np">df = pd.concat((train_users, test_users), axis=0, ignore_index=True)</span></pre><h2 id="59ef" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">缺失数据</h2><p id="d262" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">在性别栏和第一浏览器栏中有“未知”，我们将用“男”填充“未知”。此外，在测试集的 date_first_booking 列中没有任何信息，因此，我们将放弃这个特性。</p><p id="1aae" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在此之后，我们可以看到有许多数据丢失。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="8fb6" class="nl ls jf nh b gy nm nn l no np">df.gender.replace('-unknown-', np.nan, inplace=True)<br/>df.first_browser.replace('-unknown-', np.nan, inplace=True)<br/>df.drop('date_first_booking', axis=1, inplace=True)<br/>df.isnull().sum()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ff77292a96fdd0aedba2509bc6da3d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*wmIfDh68RBQLT4NImQa7Ig.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><h2 id="d9dc" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">用户年龄</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="c6ba" class="nl ls jf nh b gy nm nn l no np">df.age.describe()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/f8bbb8bf7da763caf396cb36000fadfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*VJYM0Pmo4xQp9KqrWSi7lw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><p id="be8e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最大年龄是 2014，这是不可能的。好像有些用户填了一年而不是年龄。同样，1 岁的最小年龄听起来很荒谬。根据服役期限，官方规定的最低年龄是 18 岁，但实际上这并不是强制性的。<a class="ae lq" href="https://www.quora.com/Is-there-a-minimum-age-to-use-Airbnb" rel="noopener ugc nofollow" target="_blank">如果你不满 18 岁，拥有信用卡或借记卡，并且相当有礼貌和成熟，你使用 Airbnb </a>不会有任何问题。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="74fd" class="nl ls jf nh b gy nm nn l no np">df.loc[df['age'] &gt; 1000]['age'].describe()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi of"><img src="../Images/bca4cc4dc061f49b792514e0274e79e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*gWfWQ1JJrMsO419hwf7I_w.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="9620" class="nl ls jf nh b gy nm nn l no np">df.loc[df['age'] &lt; 18]['age'].describe()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi og"><img src="../Images/04fd2fca4f44386856933f7570421b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*IFrazTS1uaH4_AD8N96sDg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><p id="da08" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">因此，我们将首先纠正每个错误填写的年龄，然后为年龄设置限制，并为异常值设置“NaN”。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="f92c" class="nl ls jf nh b gy nm nn l no np">df_with_year = df['age'] &gt; 1000<br/>df.loc[df_with_year, 'age'] = 2015 - df.loc[df_with_year, 'age']</span><span id="c9f2" class="nl ls jf nh b gy nq nn l no np">df.loc[df.age &gt; 95, 'age'] = np.nan<br/>df.loc[df.age &lt; 16, 'age'] = np.nan</span><span id="824d" class="nl ls jf nh b gy nq nn l no np">df['age'].describe()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/1f3c4b442f39ccc59c75dde305c454a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*So19z25bIZ7KjwCnhRjEGg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><p id="ef27" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">看起来更合理。我们现在可以可视化用户的年龄。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="812c" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.distplot(df.age.dropna(), rug=True)<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/67d13f017145a7424d582377c5676de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5n-liRI1ctAHmYpfJnuqg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><p id="a85e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">不出所料，Airbnb 用户最常见的年龄在 25 岁到 40 岁之间。</p><h2 id="3fba" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">用户性别</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="1dbb" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>df["gender"] = df['gender'].fillna('M')<br/>sns.countplot(data=df, x='gender')<br/>plt.xticks(np.arange(4), ("NaN", "Male", "Female", "Other"))<br/>plt.ylabel('Number of users')<br/>plt.title('Users gender distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/bdfe1964527c7179fda3b85bac34606e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UPrF4COXvhOoKXmGVcu85A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><p id="8159" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">近似的 45%的用户性别未显示。并且在 Airbnb 的平台上，女性和男性用户之间没有显著差异。</p><h2 id="e646" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">旅游目的地国家</h2><p id="af6e" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">这是我们将在测试数据中预测的。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="3250" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data=df)<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/b3df69390aec6b75a325b3d8e67340d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lnGxEXU-_lcG9nk5hcSRkQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><p id="2426" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">近 60%的用户没有预订任何目的地(NDF)。预订最多的国家是美国(近 30%的用户预订了我们)，因为数据集中的所有用户都来自美国。我们可以说，数据集中的美国旅行者更有可能在美国境内旅行。</p><p id="54e3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从现在开始，我们将只研究至少进行了一次预订的用户。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="607a" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>df_without_NDF = df[df['country_destination']!='NDF']<br/>sns.boxplot(y='age' , x='country_destination',data=df_without_NDF)<br/>plt.xlabel('Destination Country box plot')<br/>plt.ylabel('Age of Users')<br/>plt.title('Country destination vs. age')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ol"><img src="../Images/31b09cc1155729d7cc522d65e9efc5e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jx_e1-tizLxKLUNT-l6Dzw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><p id="44cd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">预订不同目的地的用户之间没有明显的年龄差异。然而，预订英国的用户往往比预订西班牙和葡萄牙的用户年龄稍大。</p><h2 id="0506" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">用户注册</strong></h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="1865" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>df_without_NDF = df[df['country_destination']!='NDF']<br/>sns.countplot(x='signup_method', data = df_without_NDF)<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.title('Users sign up method distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/91dfabc2a46b45a760ff3ff1c9295c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hnesFRyIHnQDlcFek8qfhQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><p id="9a6d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">数据中超过 70%的预订者使用基本的电子邮件方式注册 Airbnb，不到 30%的预订者使用他们的 facebook 帐户注册。数据中只有 0.26%的预订者使用他们的谷歌账户注册。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="cdeb" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data = df_without_NDF, hue = 'signup_method')<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.title('Users sign up method vs. destinations')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/374db5482b22ae694c5e40fca654841e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWOnzto5j6npAkJP-im7Vg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 12</figcaption></figure><p id="1d0d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">对于至少预订过一次的用户来说，他们中的大多数都是通过基本的电子邮件方式与 Airbnb 签约的，无论他们要去哪个国家旅行。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="78c6" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='signup_app', data=df_without_NDF)<br/>plt.xlabel('Signup app')<br/>plt.ylabel('Number of users')<br/>plt.title('Signup app distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/10e6d70c8adb0221faa4f195a332352c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sJIFnzNIAcZma-gyOEw-w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 13</figcaption></figure><p id="2463" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">数据集中超过 85%的预订者在 Airbnb 的网站上注册，超过 10%的预订者在 iOs 上注册。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="22aa" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF, hue='signup_app')<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.title('Destinatiuon country based on signup app')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi op"><img src="../Images/8b0f886ead0b96c2e36fbc7a153cd69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBGqmV6YIb_Sgxl43HboBw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 14</figcaption></figure><p id="3ec6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">美国旅行者比其他国家的旅行者有更多种类的注册应用。为了看得更清楚，我们去掉了我们。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="0cc4" class="nl ls jf nh b gy nm nn l no np">df_without_NDF_US = df_without_NDF[df_without_NDF['country_destination']!='US']<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF_US, hue='signup_app')<br/>plt.xlabel('Destination Country')<br/>plt.ylabel('Number of users')<br/>plt.title('Destinatiuon country based on signup app without the US')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oq"><img src="../Images/6164fed0dbfa772949b452e4c921d448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FEL5MovQDWZUWSoXX12JvA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 15</figcaption></figure><p id="963f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在数据中，通过 Airbnb 网站报名是预订每个目的地国家最常见的报名。</p><h2 id="edcb" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">关联公司</strong></h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="13af" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='affiliate_channel', data=df_without_NDF)<br/>plt.xlabel('Affiliate channel')<br/>plt.ylabel('Number of users')<br/>plt.title('Affiliate channel distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/7c1a48adaaa34c3dde876a30c0a8c18c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ws7dsPc9NMxYa5RHZyD6Dw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 16</figcaption></figure><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="8837" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(20,6))<br/>sns.countplot(x='affiliate_provider', data=df_without_NDF)<br/>plt.xlabel('Affiliate provider')<br/>plt.ylabel('Number of users')<br/>plt.title('Affiliate provider distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/579aeaa70f6160e65513c1e1aae4f57d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfiypLBZrAjj3AJvEOzVaQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 17</figcaption></figure><p id="9211" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">近似的 65%的预订者直接注册，没有任何附属计划，超过 23%的预订者通过谷歌附属计划注册，然而，如果你记得，只有 0.26%的预订者通过他们的谷歌账户注册。</p><h2 id="8d71" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">第一</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="3776" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='first_affiliate_tracked', data=df_without_NDF)<br/>plt.ylabel('Number of users')<br/>plt.title('First affiliate tracked distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ot"><img src="../Images/4ffdfd6a00030fb7c86d03b1909991be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rhlmKRYt65sKEKQaKB6W7Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 18</figcaption></figure><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="5c24" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(18,6))<br/>sns.countplot(x='first_device_type', data=df_without_NDF)<br/>plt.xlabel('First device type')<br/>plt.ylabel('Number of users')<br/>plt.title('First device type distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ou"><img src="../Images/50395a5a743285330a6889251c041e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f7w0aHbBe45WKYHZmVnHEg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 19</figcaption></figure><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="90f3" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(18,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF, hue='first_device_type')<br/>plt.ylabel('Number of users')<br/>plt.title('First device type vs. country destination')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ov"><img src="../Images/974623de2767f32027324b2a77dcba27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGWH2ndHsSbswiG_Hl1-bA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 20</figcaption></figure><p id="9ccc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">大约 60%的预订者使用苹果设备。尤其是在美国。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="c46a" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(18,6))<br/>sns.countplot(x='country_destination', data=df_without_NDF_US, hue='first_device_type')<br/>plt.ylabel('Number of users')<br/>plt.title('First device type vs. country destination without the US')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ow"><img src="../Images/4e405b2fe7d85a44e1ba757be2dad615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AtVwfk3JadP7z2gSPP6W9g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 21</figcaption></figure><p id="2a94" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">然而，在美国之外，Windows 桌面更加普遍，特别是在加拿大和澳大利亚，Mac 桌面和 Windows 桌面的使用差异很小。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="6e1b" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(20,6))<br/>sns.countplot(x='first_browser', data=df_without_NDF)<br/>plt.xlabel('First browser')<br/>plt.ylabel('Number of users')<br/>plt.title('First browser distribution')<br/>plt.xticks(rotation=90)<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ox"><img src="../Images/d690b07e981499f780897fad29f79fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xBBcNbyakpwyuV_rcug1g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 22</figcaption></figure><p id="c94c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">数据中几乎 30%的预订者使用 Chrome 浏览器。</p><h2 id="ff77" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">用户的首选语言</strong></h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="7bd8" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='language', data=df_without_NDF)<br/>plt.xlabel('language')<br/>plt.ylabel('Number of users')<br/>plt.title('Users language distribution')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oy"><img src="../Images/435ac622eb47f9de38e64e311b958cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxyJGFN6Jti4-1fu-xa2ng.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 23</figcaption></figure><p id="8158" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">绝大多数预订者的语言偏好是英语，这并不奇怪，因为数据集中的大多数用户来自美国。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="a889" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>sns.countplot(x='language', data=df_without_NDF_US)<br/>plt.xlabel('language')<br/>plt.ylabel('Number of users')<br/>plt.title('Users language distribution without the US')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oz"><img src="../Images/b7b1d1a57dc56990d4a9f21d8e8ea568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1tUorYxmnyYppeOc_2lvmw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 24</figcaption></figure><p id="a8f4" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">除了美国，英语仍然是最受欢迎的语言，有趣的是，在数据中，中文是预订者第二受欢迎的语言。</p><h2 id="39c9" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">日期</h2><p id="ef3f" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">为了可视化时间序列，我们首先需要将数据类型转换为日期时间。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="9a38" class="nl ls jf nh b gy nm nn l no np">df_without_NDF['date_account_created'] = pd.to_datetime(df_without_NDF['date_account_created'])<br/>df_without_NDF['timestamp_first_active'] = pd.to_datetime((df_without_NDF.timestamp_first_active // 1000000), format='%Y%m%d')</span><span id="25bb" class="nl ls jf nh b gy nq nn l no np">plt.figure(figsize=(12,6))<br/>df_without_NDF.date_account_created.value_counts().plot(kind='line', linewidth=1.2)<br/>plt.xlabel('Date')<br/>plt.title('New account created over time')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pa"><img src="../Images/fbeb916c73a8d10c3d2644a2754fe1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZ8_A7__fcAYGxIKyfsr6w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 25</figcaption></figure><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="a456" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(12,6))<br/>df_without_NDF.timestamp_first_active.value_counts().plot(kind='line', linewidth=1.2)<br/>plt.xlabel('Date')<br/>plt.title('First active date over time')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pb"><img src="../Images/e5c006f1d970a08b5def24bc3bc3d50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JByNNcipSYmUM1v-PeLH8w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 26</figcaption></figure><p id="2c70" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">帐户创建日期和首次激活日期之间的模式看起来很相似，这是应该的。从这两个地块可以看出 Airbnb 在 2014 年到 2015 年的成长速度有多快。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="551c" class="nl ls jf nh b gy nm nn l no np">df_2013 = df_without_NDF[df_without_NDF['timestamp_first_active'] &gt; pd.to_datetime(20130101, format='%Y%m%d')]<br/>df_2013 = df_2013[df_2013['timestamp_first_active'] &lt; pd.to_datetime(20140101, format='%Y%m%d')]<br/>plt.figure(figsize=(12,6))<br/>df_2013.timestamp_first_active.value_counts().plot(kind='line', linewidth=2)<br/>plt.xlabel('Date')<br/>plt.title('First active date 2013')<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pc"><img src="../Images/a38dbce91a7875cc42d7093ff0ec0193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XYW_vSOJmThs0avEXqf8g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 27</figcaption></figure><p id="5f8f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">当进入 2013 年时，我们看到 Airbnb 预订者有几个高峰期，如 7 月、8 月和 10 月，而 12 月是 Airbnb 预订者最不活跃的月份。此外，它遵循相似的模式，例如相似距离处的峰值和非峰值。</p><h1 id="a6d0" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated"><strong class="ak">用户会话探索</strong></h1><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="280b" class="nl ls jf nh b gy nm nn l no np">sessions = pd.read_csv('sessions.csv')</span><span id="4fcf" class="nl ls jf nh b gy nq nn l no np">print("There were", len(sessions.user_id.unique()), " unique user IDs in the session data.")</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/e382a5a27297acd765c92368e8b8c365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*x6a8XdwlN0yLfIMZ-Rejgg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 28</figcaption></figure><h2 id="4fec" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">动作类型</strong></h2><p id="1d96" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">动作类型有“难”和“未知”。所以我们将“未知”改为“南”。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="a6ca" class="nl ls jf nh b gy nm nn l no np">sessions.action_type.replace('-unknown-', np.nan, inplace = True)<br/>sessions.action_type.value_counts()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/7a13edb846e43c93d2b023188bc86bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*A6kKUs9ZP-Jb82EhVLKNVA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 29</figcaption></figure><h2 id="5858" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">行动</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="0a91" class="nl ls jf nh b gy nm nn l no np">sessions.action.value_counts().head(10)</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/7cd3ccd9a70571cdcdf53e2a18586253.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*LKKdEPXvE74kB7qmKnc13w.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 30</figcaption></figure><h2 id="d3d2" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">行动细节</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="11b6" class="nl ls jf nh b gy nm nn l no np">sessions.action_detail.value_counts().head(10)</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/fd1e967c8dcf62d1b313e9872a8951da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*ZmgengcICjYDdG8i9I_8JQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 31</figcaption></figure><h2 id="d146" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">设备类型</strong></h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="8847" class="nl ls jf nh b gy nm nn l no np">plt.figure(figsize=(18,6))<br/>sns.countplot(x='device_type', data=sessions)<br/>plt.xlabel('device type')<br/>plt.ylabel('Number of sessions')<br/>plt.title('device type distribution')<br/>plt.xticks(rotation=90)<br/>sns.despine()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ph"><img src="../Images/f7a8b1b75c6700f3a991f72d2e20b770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CAkH31_DX5m7Thid5Z_17A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 32</figcaption></figure><p id="fa78" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这肯定了之前关于用户的发现。Airbnb 用户中最常见的设备类型是苹果产品。</p><h2 id="2d2c" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">已预订用户的会话</strong></h2><p id="bb9b" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">从前面的分析中，我们知道哪些用户通过 Airbnb 平台进行了预订，所以我们想探索这些 bookers 会话数据。和非预订者有区别吗？</p><h2 id="a46d" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">Bookers 操作类型</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="4ded" class="nl ls jf nh b gy nm nn l no np">booker_session = pd.merge(df_without_NDF, sessions, how = 'left', left_on = 'id', right_on = 'user_id')<br/>booker_session.action_type.value_counts()</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/482fe151fc9a3f4447c1a93d478d9761.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*CovyUYErmM4e6ZuPysF7iA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 33</figcaption></figure><h2 id="f503" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">Bookers 热门活动</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="5d70" class="nl ls jf nh b gy nm nn l no np">booker_session.action.value_counts().head(10)</span></pre><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/8aaebfb39cc3e5d9e70f2c3150bac170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*3s8WGn4e3JfktPytj_u8Tw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 34</figcaption></figure><p id="e403" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">不幸的是，预订者和所有用户之间的行为没有显著差异。</p><h2 id="ac1e" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">数据预处理和特征工程</h2><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="c01d" class="nl ls jf nh b gy nm nn l no np">train_users = pd.read_csv('train_users_2.csv')<br/>test_users = pd.read_csv('test_users.csv')<br/>df = pd.concat((train_users, test_users), axis=0, ignore_index=True)<br/>df.drop('date_first_booking', axis=1, inplace=True)</span></pre><p id="8daf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">日期时间特性</strong></p><ul class=""><li id="ea38" class="mo mp jf kw b kx ky la lb ld mq lh mr ll ms lp mt mu mv mw bi translated">将日期时间列转换为属性日期时间格式。</li><li id="bfc0" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">将日期分为日、周、月、年。</li><li id="2523" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">获取帐户创建日期和首次激活日期之间的差异(时滞)。</li><li id="b44e" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">最后，我们删除不再需要的列。</li></ul><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">datetime_features</figcaption></figure><p id="5315" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">年龄特征</strong></p><p id="39d8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">将年份转换为年龄，设置年龄限制，并用-1 填充 NaNs。</p><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">age_features</figcaption></figure><p id="ba6b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">用户会话动作特征</strong></p><p id="593b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有 10，567，737 个记录的会话，数据中有 135，483 个独立用户。</p><p id="7469" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将按 user_id 分组，计算每个用户执行操作的次数、操作类型和操作细节。做<code class="fe pm pn po nh b">groupby.agg(len)</code>大概比<code class="fe pm pn po nh b">groupby.size()</code>快一倍。因此，我使用<code class="fe pm pn po nh b">groupby.agg(len)</code>。对于设备类型，我们按 user_id 分组，合计每个用户的总秒数。最后，我们为每个用户最常用的设备添加一个名为“最常用设备”的新列。</p><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">sessions_features</figcaption></figure><p id="59bb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">用户会话 secs_elapsed 特性</strong></p><p id="987a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将从每个用户的 secs_elapsed 特征中提取信息，例如总和、平均值、最小值、最大值、中值、方差，如果 secs_elapsed 的总和大于 86，400 秒，我们考虑 day_pause，如果 secs_elapsed 的总和大于 300，000 秒，我们考虑它是长暂停，如果 secs_elapsed 的总和小于 3，600 秒，我们考虑它是短暂停。之后，我们将会话数据与用户数据合并。</p><p id="b318" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下脚本借用自<a class="ae lq" href="https://www.kaggle.com/davidgasquez/user-data-exploration" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>。</p><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">secs_elapsed</figcaption></figure><p id="5d06" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">编码分类特征</strong></p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="4e7e" class="nl ls jf nh b gy nm nn l no np">categorical_features = ['gender', 'signup_method', 'signup_flow', 'language','affiliate_channel', 'affiliate_provider', 'first_affiliate_tracked', 'signup_app', 'first_device_type', 'first_browser', 'most_used_device', 'weekday_account_created', 'weekday_first_active']<br/>df = pd.get_dummies(df, columns=categorical_features)</span></pre><h2 id="29a5" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated"><strong class="ak">归一化贴现累计收益(NDCG) </strong></h2><p id="051e" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">NDCG 是<a class="ae lq" href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain" rel="noopener ugc nofollow" target="_blank">折现累积收益(DCG) </a>度量的归一化。NDCG 是一个排名措施广泛使用的家庭实践。特别是，NDCG 在评估网络搜索方面非常受欢迎。</p><p id="119d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有几篇关于 NDCG 的优秀论文可以在<a class="ae lq" href="http://proceedings.mlr.press/v30/Wang13.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae lq" href="http://hal.in2p3.fr/file/index/docid/726760/filename/07-busa-fekete.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="6e43" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们的评估指标是 NDCG @k，其中 k=5。所以我们选择前 5 名，然后取平均值。</p><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">ndcg_score</figcaption></figure><h2 id="350e" class="nl ls jf bd lt ns nt dn lx nu nv dp mb ld nw nx md lh ny nz mf ll oa ob mh oc bi translated">使用 Xgboost 进行交叉验证</h2><ul class=""><li id="7abe" class="mo mp jf kw b kx mj la mk ld pp lh pq ll pr lp mt mu mv mw bi translated">我们将使用训练数据进行交叉验证</li><li id="47ea" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">我们将用-1 填充 NaN。</li><li id="6e1d" class="mo mp jf kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated">我们如下设置通用参数、树助推器参数和学习任务参数，我们的评价指标是 mlogloss(多类 logloss)。关于如何设置 Xgboost 参数的详细指南可以在<a class="ae lq" href="https://xgboost.readthedocs.io/en/latest/parameter.html#general-parameters" rel="noopener ugc nofollow" target="_blank">其官方网站</a>上找到。</li></ul><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">xgb_cv</figcaption></figure><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ps"><img src="../Images/36ba00e6e1aa8b39e3347cd6edb002fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*apUnRUNFDXFAj_WCka2qcA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 35</figcaption></figure><p id="6ead" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从上面的脚本中，我们已经达到的最高平均测试 NDCG 分数是 0.827582。</p><p id="9bdf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Airbnb%20New%20User%20Bookings.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>可以在<a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Airbnb%20New%20User%20Bookings.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。享受这周剩下的时光吧！</p></div></div>    
</body>
</html>