<html>
<head>
<title>The Gamification Of Fitbit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Fitbit 的游戏化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-gamification-of-fitbit-how-an-api-provided-the-next-level-of-training-eaf7b267af00?source=collection_archive---------17-----------------------#2018-11-10">https://towardsdatascience.com/the-gamification-of-fitbit-how-an-api-provided-the-next-level-of-training-eaf7b267af00?source=collection_archive---------17-----------------------#2018-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="054a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">API 如何提供下一层次的培训</h2></div><blockquote class="kf kg kh"><p id="25cb" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">任何人都可以在精品店寻找时尚，在博物馆寻找历史。富有创造力的探险家在五金店寻找历史，在机场寻找时尚”——罗伯特·威德</p></blockquote><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/4d2b32614458e19d83b9b347e1d042af.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*8RLsDiMctQXxopZbPkrbDg.png"/></div></figure><h1 id="6e09" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">项目灵感</h1><p id="b737" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">你可能听说过这个词，也可能没有，但你很可能经历过。</p><p id="eed6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><code class="fe mn mo mp mq b">Gamification</code>是游戏设计元素和游戏原则在非游戏环境中的应用。这个想法是，如果你使用游戏的元素，比如将规则和奖励链接到一个反馈系统中，你可以使(几乎)任何活动变得激励和有趣。</p><p id="9800" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><code class="fe mn mo mp mq b">Gamification</code>是<strong class="kl ir">电子学习</strong>背后的概念。我记得在小学时，所有的学生都想在电脑课上玩俄勒冈小径 T21。我还记得另一个游戏，你必须在东西落地之前解决数学问题。好吧，也许这不是对<code class="fe mn mo mp mq b">gamification</code>最激动人心的介绍，但我仍然记得。</p><p id="ef42" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">在我职业生涯的某个时候，我厌倦了使用<code class="fe mn mo mp mq b">nano</code>，决定尝试学习<code class="fe mn mo mp mq b">Vim</code>。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ae8892f20075a11f453388e70b5c68c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*AmTt7JNbFu1jFMNsPyQu-A.jpeg"/></div></figure><p id="6093" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">就在那时，我发现了两个非常有趣的<code class="fe mn mo mp mq b">gamification</code>的例子:</p><ul class=""><li id="18e7" class="mt mu iq kl b km kn kp kq mh mv mj mw ml mx le my mz na nb bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://vim-adventures.com/" rel="noopener ugc nofollow" target="_blank">Vim Adventures</a></code>有点像<code class="fe mn mo mp mq b">Zelda</code>中的<code class="fe mn mo mp mq b">Gameboy</code>，你必须在环境中移动并解开谜语——除了用<code class="fe mn mo mp mq b">Vim</code>命令！你可以在这里看它在 Twitch 上播放。</li></ul><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/3452dc6bca24582e595bba10dd465a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Okxo0zg6qVP04FoAXae8pw.png"/></div></div></figure><ul class=""><li id="a901" class="mt mu iq kl b km kn kp kq mh mv mj mw ml mx le my mz na nb bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://www.shortcutfoo.com/" rel="noopener ugc nofollow" target="_blank">shortcutFoo</a></code>教你<code class="fe mn mo mp mq b">Vim</code>、<code class="fe mn mo mp mq b">Emacs</code>、<code class="fe mn mo mp mq b">Command Line</code>、<code class="fe mn mo mp mq b">Regex</code>、<em class="kk">等快捷键。</em>通过<strong class="kl ir">间歇训练</strong>，本质上是间隔重复。这有助于你更有效地记忆快捷方式。</li></ul><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/07ff46b188d496c45d2b7c8c7be0a0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ud55u_gAzfpMCsi0kOs8A.png"/></div></div></figure><p id="0f77" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">今天，我喜欢在像<a class="ae mr" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwiQm7ib677eAhUovlkKHRr-BygQFjAAegQIAhAC&amp;url=https%3A%2F%2Fwww.duolingo.com%2F&amp;usg=AOvVaw0GVHP2wYuntJMUTG1EDY5y" rel="noopener ugc nofollow" target="_blank"> DuoLingo </a>和<a class="ae mr" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwiQm7ib677eAhUovlkKHRr-BygQFjAAegQIAhAC&amp;url=https%3A%2F%2Fwww.duolingo.com%2F&amp;usg=AOvVaw0GVHP2wYuntJMUTG1EDY5y" rel="noopener ugc nofollow" target="_blank"> DataCamp </a>这样的平台上进行电子教学。</p><p id="0f0c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我最近也开始参加一个 Kaggle 竞赛，“PUBG 完成位置预测”。Kaggle 是谷歌为数据科学爱好者开设的一个场所，他们可以使用机器学习来解决预测分析问题，以获得现金和影响力。类似象棋还有所谓的<strong class="kl ir"> Kaggle 特级大师</strong>。</p><h1 id="8464" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">探索</h1><p id="268d" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">我们的实验室研究围产期对心理健康结果的早期逆境的生物嵌入的影响。我们将遗传学、表观遗传学和流行病学方法结合起来，以确定哪些孕妇的后代可能存在不良精神健康后果的潜在风险。</p><blockquote class="kf kg kh"><p id="c810" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我的主管向我提出挑战；从 200 个 Fitbits 获取生物特征数据的可行性有多大？</p></blockquote><p id="8eb3" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">所以我给自己买了一个 Fitbit Charge2 健身追踪器，然后去了健身房！</p><p id="09ff" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">在某个时刻，我想我们都意识到这个项目将是一个大工程。也许<code class="fe mn mo mp mq b">R</code>并不真正打算从 API 服务中进行大规模实时数据管理。这对于静态文件或者静态端点来说是很棒的，但是如果你和多个参与者一起工作，像<a class="ae mr" href="https://www.fitabase.com/" rel="noopener ugc nofollow" target="_blank"> Fitabase </a>这样的专用解决方案可能是最好的——或者他们是这么宣称的。</p><p id="39de" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">尽管如此，我还是想在<code class="fe mn mo mp mq b">R</code>尝试一些很酷的新事物，比如用<code class="fe mn mo mp mq b">blogdown</code>制作个人网站，用<code class="fe mn mo mp mq b">Rokemon</code>使用<code class="fe mn mo mp mq b">gganimate</code>，用<code class="fe mn mo mp mq b">httr</code>访问 fitbit API，以及用一些自定义 CSS/HTML 添加背景图片。有可能有更好的方法来缩短我的学习曲线吗——我认为没有。</p><p id="7e77" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><strong class="kl ir">以下是我对</strong><code class="fe mn mo mp mq b"><strong class="kl ir">R</strong></code><strong class="kl ir"/><code class="fe mn mo mp mq b"><strong class="kl ir">gamification</strong></code><strong class="kl ir">的网络学习尝试。</strong></p><p id="14de" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我使用了<code class="fe mn mo mp mq b"><a class="ae mr" href="https://bookdown.org/yihui/blogdown/" rel="noopener ugc nofollow" target="_blank">blogdown</a></code>包，允许我以 R Markdown 文档的形式写博客，将一切编织成一个漂亮整洁的静态网站，我可以在网上推送。这是一个学习 pandoc、Hugo、隐藏在服务器端代码下的 CSS/HTML 的好机会。我决定继续使用<a class="ae mr" href="https://themes.gohugo.io/academic/" rel="noopener ugc nofollow" target="_blank">Hugo</a>的学术主题，从 Fitbit API 中获取尽可能多的数据，对其进行清理，然后进行一些探索性的数据分析。在这个过程中，我生成了一些很酷的动画精灵，并使用视频游戏启发的可视化效果。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/268fa36af07a2639acd7a2fdf46017fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*Iv2UzWmwJOtzbUQD-cFofg.gif"/></div></figure><h1 id="10c3" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">设置 Fitbit 开发人员帐户</h1><p id="9809" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">Fitbit 使用<a class="ae mr" href="https://dev.fitbit.com/build/reference/web-api/oauth2/" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir">OAuth 2.0</strong></a><strong class="kl ir">Access</strong>令牌向 Fitbit API 发出 HTTP 请求。您需要设置一个帐户来使用 API，并在<code class="fe mn mo mp mq b">R</code>中包含您的令牌。我不会去阅读 FITBIT 开发帮助部分，而是让读者在这里找到更好更简洁的说明。</p><p id="a3c2" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">现在你有一个帐户，我们准备在<code class="fe mn mo mp mq b">R</code>做事情。</p><p id="b015" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">设置您的令牌:</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="a636" class="nn lo iq mq b gy no np l nq nr"># You Found A Secret Area!<br/>token = "yourToken"</span></pre><h1 id="a108" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">使用<code class="fe mn mo mp mq b">fitbitr</code>包</h1><p id="c3e1" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">我以前从未提出过<code class="fe mn mo mp mq b">HTTP</code>请求，尽管这个过程在这里<a class="ae mr" href="https://moldach.github.io/fitbit-project/(https://dev.fitbit.com/build/reference/web-api/oauth2/)" rel="noopener ugc nofollow" target="_blank">有正式记录</a>，但它可能会让人不知所措。因此，我最初求助于使用一个名为<code class="fe mn mo mp mq b">fitbitr</code>的包来访问 R API。</p><p id="2cab" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">不幸的是，这将限制我只能访问一些基本的用户信息、<code class="fe mn mo mp mq b">heart rate</code>和<code class="fe mn mo mp mq b">step count</code>数据。</p><h1 id="ee09" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">获取基本用户信息</h1><p id="05ff" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">这个包中的第一个函数向<code class="fe mn mo mp mq b">Get Profile</code> <a class="ae mr" href="https://dev.fitbit.com/build/reference/web-api/user/#get-profile" rel="noopener ugc nofollow" target="_blank">资源 URL </a>发送一个<code class="fe mn mo mp mq b">GET</code>请求。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="eac7" class="nn lo iq mq b gy no np l nq nr"># Extracting Resources</span><span id="648a" class="nn lo iq mq b gy ns np l nq nr"># Get userInfo<br/>user_info &lt;- fitbitr::getUserInfo(token)</span><span id="3c90" class="nn lo iq mq b gy ns np l nq nr"># Hailing a Chocobo!</span><span id="0041" class="nn lo iq mq b gy ns np l nq nr"># What is my stride length in meters?<br/>strideLengthWalking &lt;- user_info$strideLengthWalking</span></pre><p id="106c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我的步幅是 68.5。</p><p id="0ccd" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><em class="kk">步幅是从脚跟到脚跟测量的，它决定了你每走一步走多远。平均来说，男人走路的步幅是 2.5 英尺，也就是 30 英寸，而女人的平均步幅是 2.2 英尺，也就是 26.4 英寸，根据这个</em> <a class="ae mr" href="https://livehealthy.chron.com/average-walking-stride-length-7494.html" rel="noopener ugc nofollow" target="_blank"> <em class="kk">报道</em> </a> <em class="kk">。</em></p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="4807" class="nn lo iq mq b gy no np l nq nr"># Hitting 80 MPH</span><span id="2888" class="nn lo iq mq b gy ns np l nq nr"># What is my running stride length<br/>strideLengthRunning &lt;- user_info$strideLengthRunning</span></pre><p id="0a69" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我跑步的步幅是 105.5。</p><p id="f972" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><em class="kk">默认情况下，Fitbit 使用您的</em> <code class="fe mn mo mp mq b"><em class="kk">sex</em></code> <em class="kk">和</em> <code class="fe mn mo mp mq b"><em class="kk">height</em></code> <em class="kk">来测量您的步幅，这可能会不准确。</em></p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="777f" class="nn lo iq mq b gy no np l nq nr"># Looking for the fourth chaos emerald </span><span id="249d" class="nn lo iq mq b gy ns np l nq nr"># What is my average daily steps?<br/>averageDailySteps &lt;- user_info$averageDailySteps</span></pre><p id="83df" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我每天的平均步数是 14214 步。</p><p id="7757" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">考虑到每天推荐的步数是 10，000，我认为这是可以接受的。也就是说，总有改进的空间。</p><h1 id="0681" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">使用<code class="fe mn mo mp mq b">fitbitr</code>包获取心率和脚步</h1><p id="dee1" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">我要为一个非常初步的 EDA 获取一周的数据。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="b8c1" class="nn lo iq mq b gy no np l nq nr"># Smashing buttons</span><span id="6d3b" class="nn lo iq mq b gy ns np l nq nr">days &lt;- c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")</span><span id="4396" class="nn lo iq mq b gy ns np l nq nr">monday_heart &lt;- getTimeSeries(token, type = "heart", activityDetail = "1min", date = "2018-08-20", startTime = "00:00", endTime = "23:59")<br/>monday_heart %&lt;&gt;% mutate(date = "2018-08-20")<br/>monday_steps &lt;- getTimeSeries(token, type = "steps", activityDetail = "1min", date = "2018-08-20")<br/>monday_steps %&lt;&gt;% mutate(date = "2018-08-20")<br/>monday &lt;- monday_heart %&gt;% full_join(monday_steps)<br/>monday %&lt;&gt;% mutate(week_date = "Monday")<br/>monday %&lt;&gt;% mutate(day_of_week = "1")</span><span id="b20e" class="nn lo iq mq b gy ns np l nq nr">tuesday_heart &lt;- getTimeSeries(token, type = "heart", activityDetail = "1min", date = "2018-08-21")<br/>tuesday_heart %&lt;&gt;% mutate(date = "2018-08-21")<br/>tuesday_steps &lt;- getTimeSeries(token, type = "steps", activityDetail = "1min", date = "2018-08-21")<br/>tuesday_steps %&lt;&gt;% mutate(date = "2018-08-21")<br/>tuesday &lt;- tuesday_heart %&gt;% full_join(tuesday_steps)<br/>tuesday %&lt;&gt;% mutate(week_date = "Tuesday")<br/>tuesday %&lt;&gt;% mutate(day_of_week = "2")</span><span id="d801" class="nn lo iq mq b gy ns np l nq nr">wednesday_heart &lt;- getTimeSeries(token, type = "heart", activityDetail = "1min", date = "2018-08-22")<br/>wednesday_heart %&lt;&gt;% mutate(date = "2018-08-22")<br/>wednesday_steps &lt;- getTimeSeries(token, type = "steps", activityDetail = "1min", date = "2018-08-22")<br/>wednesday_steps %&lt;&gt;% mutate(date = "2018-08-22")<br/>wednesday &lt;- wednesday_heart %&gt;% full_join(wednesday_steps)<br/>wednesday %&lt;&gt;% mutate(week_date = "Wednesday")<br/>wednesday %&lt;&gt;% mutate(day_of_week = "3")</span><span id="aa12" class="nn lo iq mq b gy ns np l nq nr">thursday_heart &lt;- getTimeSeries(token, type = "heart", activityDetail = "1min", date = "2018-08-23")<br/>thursday_heart %&lt;&gt;% mutate(date = "2018-08-23")<br/>thursday_steps &lt;- getTimeSeries(token, type = "steps", activityDetail = "1min", date = "2018-08-23")<br/>thursday_steps %&lt;&gt;% mutate(date = "2018-08-23")<br/>thursday &lt;- thursday_heart %&gt;% full_join(thursday_steps)<br/>thursday %&lt;&gt;% mutate(week_date = "Thursday")<br/>thursday %&lt;&gt;% mutate(day_of_week = "4")</span><span id="72c9" class="nn lo iq mq b gy ns np l nq nr">friday_heart &lt;- getTimeSeries(token, type = "heart", activityDetail = "1min", date = "2018-08-24")<br/>friday_heart %&lt;&gt;% mutate(date = "2018-08-24")<br/>friday_steps &lt;- getTimeSeries(token, type = "steps", activityDetail = "1min", date = "2018-08-24")<br/>friday_steps %&lt;&gt;% mutate(date = "2018-08-24")<br/>friday &lt;- friday_heart %&gt;% full_join(friday_steps)<br/>friday %&lt;&gt;% mutate(week_date = "Friday")<br/>friday %&lt;&gt;% mutate(day_of_week = "5")</span><span id="75c3" class="nn lo iq mq b gy ns np l nq nr">saturday_heart &lt;- getTimeSeries(token, type = "heart", activityDetail = "1min", date = "2018-08-24")<br/>saturday_heart %&lt;&gt;% mutate(date = "2018-08-24")<br/>saturday_steps &lt;- getTimeSeries(token, type = "steps", activityDetail = "1min", date = "2018-08-24")<br/>saturday_steps %&lt;&gt;% mutate(date = "2018-08-24")<br/>saturday &lt;- saturday_heart %&gt;% full_join(saturday_steps)<br/>saturday %&lt;&gt;% mutate(week_date = "Saturday")<br/>saturday %&lt;&gt;% mutate(day_of_week = "6")</span><span id="9205" class="nn lo iq mq b gy ns np l nq nr">week &lt;- monday %&gt;% bind_rows(tuesday) %&gt;% bind_rows(wednesday) %&gt;% bind_rows(thursday) %&gt;% bind_rows(friday) %&gt;% bind_rows(saturday)<br/>        <br/>week$date &lt;- as.Date(week$date)</span></pre><h1 id="3df8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">汇总统计数据</h1><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="02d2" class="nn lo iq mq b gy no np l nq nr"># Opening pod bay doors</span><span id="79ab" class="nn lo iq mq b gy ns np l nq nr">week %&gt;% <br/>        group_by(type) %&gt;% <br/>                summarise(<br/>                        total = sum(value),<br/>                        minimum = min(value),<br/>                        mean = mean(value),<br/>                        median = median(value),<br/>                        maximum = max(value),<br/>                        max_time = max(time)<br/>                        ) %&gt;%<br/>        knitr::kable(digits = 3) %&gt;% <br/>        kable_styling(full_width = F)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nt"><img src="../Images/83a702d9041387e9a04bd21fa1a8c3a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFqP9E4gxIHqo9IKlgSERg.png"/></div></div></figure><h1 id="0be2" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">探索性数据分析</h1><p id="76d3" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">因为这是一个关于<code class="fe mn mo mp mq b">gamification</code>的帖子，我决定用我的探索性数据可视化做一些有趣的事情。我想使用<code class="fe mn mo mp mq b">Rokemon</code>包，它允许我将<code class="fe mn mo mp mq b">ggplot2</code>(和<code class="fe mn mo mp mq b">ggplot2</code>扩展)的主题设置为<code class="fe mn mo mp mq b">Game Boy</code>和<code class="fe mn mo mp mq b">Game Boy Advance</code>主题！方便的时候，我会用<code class="fe mn mo mp mq b">cowplot</code>组合剧情。</p><p id="3d6a" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我们来快速看一下<code class="fe mn mo mp mq b">heart rate</code>和<code class="fe mn mo mp mq b">step count</code>的关系和分布。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="7e49" class="nn lo iq mq b gy no np l nq nr"># Doing the thing...</span><span id="7021" class="nn lo iq mq b gy ns np l nq nr">g &lt;- week %&gt;% <br/>        spread(type, value) %&gt;% <br/>        rename(hear_rate = "heart rate") %&gt;% <br/>        na.omit() %&gt;% <br/>        ggplot(aes(steps, hear_rate)) + geom_point() + geom_smooth(method="lm", se=F, colour = "#DE7243") </span><span id="7f0b" class="nn lo iq mq b gy ns np l nq nr">gb &lt;- g + theme_gameboy()<br/>gba &lt;- g + theme_gba()</span><span id="8424" class="nn lo iq mq b gy ns np l nq nr">plot_grid(gb, gba, labels = c("", ""), align = "h")</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/b0aa4cd5a685ae6a0b4a693edafb82f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tL7RuSmO6g0rBWYmjqiCjw.png"/></div></div></figure><p id="914f" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">或者，我们可以通过<code class="fe mn mo mp mq b">ggExtra</code>包中的<code class="fe mn mo mp mq b">ggMarginal()</code>函数将边际密度图添加到散点图中，从而更好地查看数据。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/6aeb1a30578a0bcad333975064a1cce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*awEEdUUu0qsU31Cgwb9RSQ.png"/></div></div></figure><h1 id="cb43" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">每周趋势</h1><p id="786e" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">让我们快速看一下连续变量的分布，以获得比平均值和中位数更好的想法。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="f0bc" class="nn lo iq mq b gy no np l nq nr"># Loading..... Wait, what else were you expecting?</span><span id="4eee" class="nn lo iq mq b gy ns np l nq nr">annotations_steps &lt;- data_frame(<br/>        x = c(45, 100, 165),<br/>        y = c(0.01, 0.01, 0.01),<br/>        label = c('walking pace', 'brisk walking pace', 'running pace'),<br/>        type = c('steps', 'steps', 'steps')<br/>)</span><span id="c698" class="nn lo iq mq b gy ns np l nq nr">g &lt;- week %&gt;% <br/>  ggplot(aes(value)) + <br/>  geom_density(fill = "#DE7243") +<br/>  geom_text(data = annotations_steps, aes(x = x, y = y, label = label), angle = -30, hjust = 1) +<br/>  facet_grid(.~type, scales = 'free_x') + <br/>  labs(title = 'Heart Rate and Steps-per-minute over two months',<br/>       subtitle = 'Data gathered from Fitbit Charge2')</span><span id="69b9" class="nn lo iq mq b gy ns np l nq nr">g + theme_gameboy()<br/>g + theme_gba()</span></pre><div class="lg lh li lj gt ab cb"><figure class="nv lk nw nx ny nz oa paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><img src="../Images/792d5d4070fad8568396acc65e887085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*H2NbPNizSKZqPZSwlCGaWQ.png"/></div></figure><figure class="nv lk nw nx ny nz oa paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><img src="../Images/c838b4be9cc11aa8c4bcca663eafa9d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Avm4lYB5WP_Tze6PFwW_5A.png"/></div></figure></div><p id="fc16" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><code class="fe mn mo mp mq b">Heart rate</code>有点右偏，可能是睡眠和久坐工作的原因。同样，对于<code class="fe mn mo mp mq b">step count</code>你可以看到，当我滑板上班时，在<code class="fe mn mo mp mq b">brisk walking pace</code>下面只有一个小凸起。</p><h1 id="8fce" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">锻炼模式</h1><p id="7ccb" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">这个星期我没有健身，所以我想我至少应该在上班的路上看看。下图显示蓝色为<code class="fe mn mo mp mq b">heart rate/min</code>，橙色为<code class="fe mn mo mp mq b">steps/min</code>的编号。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="fbca" class="nn lo iq mq b gy no np l nq nr"># You are carrying too much to be able to run</span><span id="3c7d" class="nn lo iq mq b gy ns np l nq nr">between_six_nine &lt;- function(time) time &gt; 7*60*60 &amp; time &lt; 10*60*60</span><span id="7433" class="nn lo iq mq b gy ns np l nq nr">is_weekday &lt;- function(day_of_week) day_of_week %in% 1:6</span><span id="3c0f" class="nn lo iq mq b gy ns np l nq nr">week$week_date_f &lt;- factor(week$week_date, levels=c("Monday","Tuesday","Wednesday", "Thursday", "Friday", "Saturday"))</span><span id="3c87" class="nn lo iq mq b gy ns np l nq nr">g &lt;- week %&gt;% <br/>        filter(between_six_nine(time) &amp; is_weekday(day_of_week)) %&gt;% <br/>        spread(type, value) %&gt;% <br/>        ggplot(aes(x = time)) +<br/>        geom_bar(aes(y = steps), color = '#DE7243', alpha = 0.3, stat = 'identity') + <br/>        geom_line(aes(y = `heart rate`), color = '#E3F24D', size = 0.8) + <br/>        facet_grid(~week_date_f) +<br/>        scale_x_continuous(breaks=c(27000, 30000, 33000, 36000), labels=c("7am", "8am", "9am", "10am"))</span><span id="18b4" class="nn lo iq mq b gy ns np l nq nr">g + theme_gameboy()<br/>g + theme_gba()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ob"><img src="../Images/4d9b79aff2ce9b192aaca974cac2f751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D3D8lvHds59v4HbWaKULOA.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ob"><img src="../Images/62330c8e57997f1f628ea5965cbfa27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xcR0gCR0-SQI5vmxo1hzg.png"/></div></div></figure><p id="f6d0" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">自从我每天早上滑滑板去上班后，我的活动整个星期都差不多一样。</p><h1 id="2a49" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">最活跃时间</h1><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="30ef" class="nn lo iq mq b gy no np l nq nr"># 60% of the time, it loads ALL the time</span><span id="d035" class="nn lo iq mq b gy ns np l nq nr">step_counts &lt;- week %&gt;% <br/>  filter(type == 'steps') %&gt;% <br/>  group_by(day_of_week) %&gt;% <br/>  summarise(<br/>    type = last(type), <br/>    avg_num_steps = sprintf('avg num steps: %3.0f', sum(value)/52)<br/>  )</span><span id="7947" class="nn lo iq mq b gy ns np l nq nr">g &lt;- week %&gt;%<br/>        ggplot(aes(x= value, y = fct_rev(factor(day_of_week)))) +<br/>        geom_density_ridges(scale = 2.5, fill = "#DE7243") +<br/>        geom_text(data = step_counts, nudge_y = 0.15, hjust = 0, <br/>            aes(x = 85, y = fct_rev(factor(day_of_week)), label = avg_num_steps)) +<br/>        scale_y_discrete(breaks=1:6, labels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")) +<br/>        facet_grid(.~type, scales = "free") +<br/>        labs(x = '', y = "Day of the Week") </span><span id="e9d6" class="nn lo iq mq b gy ns np l nq nr">g + theme_gameboy()<br/>g + theme_gba()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/b3a5825571de3dc447e70f1c8d72039b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Z0waiTSvovqTlZC-9ud5g.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/a6fb9968abca16c97276f71968360be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFddnm9WhH2-fWaB2lii5Q.png"/></div></div></figure><p id="94c6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">每分钟的步数分布相当稳定，因为我说过我没有锻炼；这可能反映了我拖着脚步去喝茶。</p><p id="9f64" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">看起来周一是我心跳加速最多的一天，双峰高峰可能是我四处寻找出租物业的时候。</p><h1 id="84ec" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">用<code class="fe mn mo mp mq b">httr</code>包直接访问 Fitbit API</h1><p id="da95" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">最终，我找到了一个由<a class="ae mr" href="https://github.com/obrl-soil" rel="noopener ugc nofollow" target="_blank"> obrl-soil </a>撰写的优秀的<a class="ae mr" href="https://obrl-soil.github.io/fitbit-api-r/" rel="noopener ugc nofollow" target="_blank">教程</a>，它向我介绍了<code class="fe mn mo mp mq b">httr</code>包，并给了我阅读<a class="ae mr" href="https://dev.fitbit.com/build/reference/web-api/" rel="noopener ugc nofollow" target="_blank"> Fitbit DEV web API 参考</a>所需的信心。现在我能够访问更多的数据来源。</p><h1 id="0af6" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">有哪些数据可用？</h1><p id="0081" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">Fitbit API 提供了哪些数据的简要概述:</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="64f6" class="nn lo iq mq b gy no np l nq nr"># Your Boko Club is badly damaged</span><span id="b591" class="nn lo iq mq b gy ns np l nq nr"># make a kable table for data you can access from Fitbit API<br/>dt01 &lt;- data.frame(Scope = c("activity",<br/>                             "heartrate",<br/>                             "location",<br/>                             "nutrition",<br/>                             "profile",<br/>                             "settings",<br/>                             "sleep",<br/>                             "social",<br/>                             "weight"),<br/>                   Description = c("The activity scope includes activity data and exercise log related features, such as steps, distance, calories burned, and active minutes",<br/>                                   "The heartrate scope includes the continuous heart rate data and related analysis",<br/>                                   "The location scope includes the GPS and other location data",<br/>                                   "The nutrition scope includes calorie consumption and nutrition related features, such as food/water logging, goals, and plans",<br/>                                   "The profile scope is the basic user information",<br/>                                   "The settings scope includes user account and device settings, such as alarms",<br/>                                   "The sleep scope includes sleep logs and related sleep analysis",<br/>                                   "The social scope includes friend-related features, such as friend list, invitations, and leaderboard",<br/>                                   "The weight scope includes weight and related information, such as body mass index, body fat percentage, and goals")<br/>)</span><span id="b233" class="nn lo iq mq b gy ns np l nq nr">dt01 %&gt;%<br/>  kable("html") %&gt;%<br/>  kable_styling(full_width = F) %&gt;%<br/>  column_spec(1, bold = T, border_right = T) %&gt;%<br/>  column_spec(2, width = "30em", background = "#E3F24D")</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oc"><img src="../Images/b2e2399041fea2e4e0d415a14cacd3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xj5DbVpOv9ypbHhPocCW9Q.png"/></div></div></figure><p id="d4d4" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">测量单位是什么？</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="1adb" class="nn lo iq mq b gy no np l nq nr"># Loading Cutscenes You Can't Skip</span><span id="cae4" class="nn lo iq mq b gy ns np l nq nr"># make a Kable table or measurement information<br/>dt03 &lt;- data.frame(unitType = c("duration",<br/>                                "distance",<br/>                                "elevation",<br/>                                "height",<br/>                                "weight",<br/>                                "body measurements",<br/>                                "liquids",<br/>                                "blood glucose"),<br/>                   unit = c("milliseconds",<br/>                            "kilometers",<br/>                            "meters",<br/>                            "centimeters",<br/>                            "kilograms",<br/>                            "centimeters",<br/>                            "milliliters",<br/>                            "millimoles per liter"))<br/>dt03 %&gt;%<br/>  kable("html") %&gt;%<br/>  kable_styling(full_width = F) %&gt;%<br/>  column_spec(1, bold = T, border_right = T) %&gt;%<br/>  column_spec(2, width = "30em", background = "#E3F24D")</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi od"><img src="../Images/4d64472785157aab20c3dcda30bcbf34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T3BNmCI84G5ee8NnBXbybQ.png"/></div></div></figure><p id="f87e" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">定义一个将<code class="fe mn mo mp mq b">json</code>列表转换成数据帧的函数。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="82c8" class="nn lo iq mq b gy no np l nq nr"># Inserting last-minute subroutines into program...</span><span id="3c6f" class="nn lo iq mq b gy ns np l nq nr"># json-as-list to dataframe (for simple cases without nesting!)<br/>jsonlist_to_df &lt;- function(data = NULL) {<br/>    purrr::transpose(data) %&gt;%<br/>    purrr::map(., unlist) %&gt;%<br/>    as_tibble(., stringsAsFactors = FALSE)<br/>}</span></pre><h1 id="68eb" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">调查我的 10 公里跑</h1><p id="d2a7" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated"><code class="fe mn mo mp mq b">GET</code>请求检索我的 10km 跑步的每分钟心率数据。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="2142" class="nn lo iq mq b gy no np l nq nr"># Preparing for the mini-boss</span><span id="0c18" class="nn lo iq mq b gy ns np l nq nr">get_workout &lt;- function(date = NULL, start_time = NULL, end_time = NULL, <br/>                         token = Sys.getenv('FITB_AUTH')) {<br/>GET(url =<br/>        paste0('https://api.fitbit.com/1/user/-/activities/heart/date/',<br/>        date, '/1d/1min/time/', start_time, '/', end_time, '.json'), <br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}</span><span id="512b" class="nn lo iq mq b gy ns np l nq nr"># Get the workout for my 10Km run <br/>got_workout &lt;- get_workout(date = '2018-10-21', start_time = '09:29', end_time = '10:24')</span><span id="54f0" class="nn lo iq mq b gy ns np l nq nr">workout &lt;- content(got_workout)</span><span id="32f0" class="nn lo iq mq b gy ns np l nq nr"># summary</span><span id="b13f" class="nn lo iq mq b gy ns np l nq nr">workout[['activities-heart']][[1]][['heartRateZones']] &lt;- jsonlist_to_df(workout[['activities-heart']][[1]][['heartRateZones']])</span><span id="d320" class="nn lo iq mq b gy ns np l nq nr"># the dataset<br/>workout[['activities-heart-intraday']][['dataset']] &lt;- jsonlist_to_df(workout[['activities-heart-intraday']][['dataset']])</span><span id="33b3" class="nn lo iq mq b gy ns np l nq nr"># format the time <br/>workout$`activities-heart-intraday`$dataset$time &lt;- as.POSIXlt(workout$`activities-heart-intraday`$dataset$time, format = '%H:%M:%S')<br/>lubridate::date(workout$`activities-heart-intraday`$dataset$time) &lt;- '2018-10-21'</span><span id="e6ff" class="nn lo iq mq b gy ns np l nq nr"># find time zone<br/># grep("Canada", OlsonNames(), value=TRUE)<br/>lubridate::tz(workout$`activities-heart-intraday`$dataset$time) &lt;- 'Canada/Eastern'</span></pre><p id="85cf" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">让我们来看看我的 10 公里跑的总结:</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="e906" class="nn lo iq mq b gy no np l nq nr"># Farming Hell Cows</span><span id="617f" class="nn lo iq mq b gy ns np l nq nr">workout$`activities-heart`[[1]]$heartRateZones %&gt;% kable() %&gt;% kable_styling(full_width = F)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oe"><img src="../Images/97bc23d2b85a7c0233d2ed7f7835a1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6K4-HyAJVhifc8w0wqVaKw.png"/></div></div></figure><p id="e959" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated"><a class="ae mr" href="https://obrl-soil.github.io/fitbit-api-r/" rel="noopener ugc nofollow" target="_blank"> obrl-soil </a>使用的是<code class="fe mn mo mp mq b">MyZone Efforts Points</code><a class="ae mr" href="https://myzone.org/the-zones/" rel="noopener ugc nofollow" target="_blank">【MEPS】</a>，它是以每分钟最大心率的百分比计算的。它衡量的是投入的努力——分数越多越好。另一个<code class="fe mn mo mp mq b">gamification</code>的例子。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="b7d4" class="nn lo iq mq b gy no np l nq nr"># Looting a chest</span><span id="2ec1" class="nn lo iq mq b gy ns np l nq nr">meps_max &lt;- function(age = NULL) { 207 - (0.7 * age) }</span></pre><p id="ad6c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我的是 186。</p><p id="5eea" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">现在，我们创建一个包含 4 个心率范围的表格，显示下限和上限，并使用上面的<code class="fe mn mo mp mq b">mutate()</code>函数计算我的最大心率(包含下限和上限)。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="6eb8" class="nn lo iq mq b gy no np l nq nr"># Taking the hobbits to Isengard</span><span id="6b13" class="nn lo iq mq b gy ns np l nq nr">my_MEPS &lt;- tribble(~MEPS, ~hr_range, ~hr_lo, ~hr_hi, <br/>                       1,  '50-59%',   0.50,   0.59,<br/>                       2,  '60-69%',   0.60,   0.69,<br/>                       3,  '70-79%',   0.70,   0.79,<br/>                       4,    '&gt;=80',   0.80,   1.00) %&gt;%<br/>  mutate(my_hr_low = floor(meps_max(30) * hr_lo),<br/>         my_hr_hi  = ceiling(meps_max(30) * hr_hi))<br/>my_MEPS</span><span id="b942" class="nn lo iq mq b gy ns np l nq nr">## # A tibble: 4 x 6<br/>##    MEPS hr_range hr_lo hr_hi my_hr_low my_hr_hi<br/>##   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;<br/>## 1     1 50-59%     0.5  0.59        93      110<br/>## 2     2 60-69%     0.6  0.69       111      129<br/>## 3     3 70-79%     0.7  0.79       130      147<br/>## 4     4 &gt;=80       0.8  1          148      186</span></pre><p id="ac71" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">有了现在定义的方程，让我们来计算我的总 MEPS:</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="cdce" class="nn lo iq mq b gy no np l nq nr"># Checkpoint!</span><span id="dd57" class="nn lo iq mq b gy ns np l nq nr">mep &lt;- mutate(workout$`activities-heart-intraday`$dataset,<br/>       meps = case_when(value &gt;= 146 ~ 4,<br/>                        value &gt;= 128 ~ 3,<br/>                        value &gt;= 109 ~ 2,<br/>                        value &gt;= 91  ~ 1,<br/>                        TRUE ~ 0)) %&gt;%<br/>  summarise("Total MEPS" = sum(meps))</span></pre><p id="0cbd" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">哇是 216！</p><p id="5ae9" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我不知道这到底是什么意思，但显然在 42 分钟的锻炼中最大可能的 MEPS 是 168，因为我在 54:35 跑完了 10 公里，我想这很好？</p><p id="2984" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我想在我的下一次 10 公里跑中坚持 50 分钟，但我不确定我是否应该争取更高的<code class="fe mn mo mp mq b">peak</code>心率分钟数——我想我需要对此进行研究。</p><h1 id="b772" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">一晚每分钟的睡眠数据</h1><p id="7e37" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">让我们检查一下我昨晚的睡眠模式。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="8b6e" class="nn lo iq mq b gy no np l nq nr"># Resting at Campfire</span><span id="3a2f" class="nn lo iq mq b gy ns np l nq nr">get_sleep &lt;- function(startDate = NULL, endDate = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1.2/user/-/sleep/date/', startDate, "/", endDate, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}</span><span id="ce97" class="nn lo iq mq b gy ns np l nq nr"># make sure that there is data for those days otherwise it tosses an error</span><span id="0686" class="nn lo iq mq b gy ns np l nq nr">got_sleep &lt;- get_sleep(startDate = "2018-08-21", endDate = "2018-08-22")<br/>sleep &lt;- content(got_sleep)</span><span id="6790" class="nn lo iq mq b gy ns np l nq nr">dateRange &lt;- seq(as.Date("2018-08-21"), as.Date("2018-08-22"), "days")</span><span id="3396" class="nn lo iq mq b gy ns np l nq nr">sleep_pattern &lt;- NULL<br/>for(j in 1:length(dateRange)){<br/>        sleep[['sleep']][[j]][['levels']][['data']] &lt;- jsonlist_to_df(sleep[['sleep']][[j]][['levels']][['data']])<br/>        tmp &lt;- sleep$sleep[[j]]$levels$`data`<br/>sleep_pattern &lt;- bind_rows(sleep_pattern, tmp)<br/>}</span></pre><p id="7a8e" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">好了，现在数据管理完成了，让我们来看看我的睡眠模式。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="0eb1" class="nn lo iq mq b gy no np l nq nr"># Now entering... The Twilight Zone</span><span id="5667" class="nn lo iq mq b gy ns np l nq nr">g &lt;- sleep_pattern %&gt;% group_by(level, seconds) %&gt;% <br/>        summarise() %&gt;% <br/>        summarise(seconds = sum(seconds)) %&gt;%<br/>        mutate(percentage = seconds/sum(seconds)) %&gt;% <br/>                ggplot(aes(x = "", y = percentage, fill = c("S", "A", "R"))) +<br/>                        geom_bar(width = 1, stat = "identity") +<br/>                        theme(axis.text.y = element_blank(),<br/>                              axis.text.x = element_blank(), axis.line = element_blank(), plot.caption = element_text(size = 5), plot.title = element_blank()) +<br/>                        labs(fill = "class", x = NULL, y = NULL, title = "Sleep stages", caption = "A = Awake; R = Restless; S = Asleep") +<br/>                        coord_polar(theta = "y", start = 0) +<br/>        scale_fill_manual(values = c("#FF3F3F", "#2BD1FC", "#BA90A6"))</span><span id="45ae" class="nn lo iq mq b gy ns np l nq nr">g + theme_gameboy()<br/>g + theme_gba()</span></pre><div class="lg lh li lj gt ab cb"><figure class="nv lk of nx ny nz oa paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><img src="../Images/d9b7056cae579824b6c4f38f8dd8b792.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*50x__0wpHqAmx5JegwLG_Q.png"/></div></figure><figure class="nv lk og nx ny nz oa paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><img src="../Images/ab1071b3d814f23b07ddde85dd467b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*Tk2cVpX_Udwan5C4T7aTWg.png"/></div></figure></div><p id="9251" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">饼图可能不是显示这些数据的最佳方式。让我们用一个箱线图来形象化这个分布。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="617d" class="nn lo iq mq b gy no np l nq nr"># Entering Cheat Codes!</span><span id="95e3" class="nn lo iq mq b gy ns np l nq nr">g &lt;- ggplot(sleep_pattern, aes(y=log10(seconds), x=level)) + <br/>        geom_boxplot(color="#031300", fill='#152403') +<br/>        labs(x = "", title = 'Sleep patterns over a month',<br/>       subtitle = 'Data gathered from Fitbit Charge2') +<br/>        theme(legend.position = "none") </span><span id="ff4b" class="nn lo iq mq b gy ns np l nq nr">g + theme_gameboy()<br/>g + theme_gba()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/e15123175b46f8595b787673b540974d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9dd9RScJF9yV_2-ecWrqgQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/6d3e83ac59cf6b5a02446fbf7a75bcf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3R7eMENM1Tqg5HlqKIVjA.png"/></div></div></figure><p id="8f49" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">一个更好的可视化分布的方法是使用覆盖原始数据点的小提琴图。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="8d41" class="nn lo iq mq b gy no np l nq nr"># Neglecting Sleep...<br/></span><span id="8e99" class="nn lo iq mq b gy ns np l nq nr">g &lt;- ggplot(sleep_pattern, aes(y=log10(seconds), x=level)) + <br/>        geom_violin(color="#031300", fill='#152403') +<br/>        geom_point() +<br/>        labs(x = "", title = 'Sleep patterns over a month',<br/>       subtitle = 'Data gathered from Fitbit Charge2') +<br/>        theme(legend.position = "none")</span><span id="05af" class="nn lo iq mq b gy ns np l nq nr">g + theme_gameboy()<br/>g + theme_gba()</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/a230cfd99b30a03d25b55139c1ddf327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3aEYsgW7te8sc29ueAJuw.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/11c81d8a757460eeea32d3a2a29ce9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAzy3-c1mOsBXvRI2ekLMA.png"/></div></div></figure><h1 id="3d41" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">获取 3 个月的日常活动模式</h1><p id="924f" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">您可以从 Fitbit <a class="ae mr" href="https://dev.fitbit.com/build/reference/web-api/activity/" rel="noopener ugc nofollow" target="_blank">活动和练习日志</a>中为不同的时间段执行 API 请求，但是因为我只有几个月的时间，所以我将使用<code class="fe mn mo mp mq b">3m</code>时间段。</p><p id="944f" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我还需要剔除未来的任何一天，否则它们会在数字中显示为<code class="fe mn mo mp mq b">0</code>卡路里。做<code class="fe mn mo mp mq b">EDA</code>的时候最好使用<code class="fe mn mo mp mq b">Sys.Date()</code>功能而不是硬编码日期，做一个闪亮的 app，或者<a class="ae mr" href="https://resources.rstudio.com/rstudio-connect-2/parameterized-r-markdown-reports-with-rstudio-connect-aron-atkins" rel="noopener ugc nofollow" target="_blank">参数化一个</a> <code class="fe mn mo mp mq b"><a class="ae mr" href="https://resources.rstudio.com/rstudio-connect-2/parameterized-r-markdown-reports-with-rstudio-connect-aron-atkins" rel="noopener ugc nofollow" target="_blank">RMarkdown</a></code> <a class="ae mr" href="https://resources.rstudio.com/rstudio-connect-2/parameterized-r-markdown-reports-with-rstudio-connect-aron-atkins" rel="noopener ugc nofollow" target="_blank">文件</a>。这样你就可以探索不同的时间段，而不会出现任何问题。</p><p id="323b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我不记得我是什么时候开始戴 Fitbit 的，但我们可以通过下面的代码来解决这个问题:</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="82ac" class="nn lo iq mq b gy no np l nq nr"># ULTIMATE IS READY!</span><span id="7b7f" class="nn lo iq mq b gy ns np l nq nr"># Query how many days since you've had fitbit for<br/>inception &lt;- user_info$memberSince</span></pre><p id="0d43" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我从 2018 年 8 月 20 日开始使用 Fitbit。</p><p id="c588" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">让我们收集 2018 年 9 月 20 日至 11 月 6 日的数据。</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="78d5" class="nn lo iq mq b gy no np l nq nr"># Catching them all!</span><span id="e9a0" class="nn lo iq mq b gy ns np l nq nr">### Calories<br/>get_calories &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/calories/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_calories &lt;- get_calories(baseDate = "2018-11-20", period = "3m")<br/>calories &lt;- content(got_calories)<br/># turn into df<br/>calories[['activities-calories']] &lt;- jsonlist_to_df(calories[['activities-calories']])<br/># assign easy object and rename<br/>calories &lt;- calories[['activities-calories']]<br/>colnames(calories) &lt;- c("dateTime", "calories")</span><span id="c382" class="nn lo iq mq b gy ns np l nq nr">### STEPS<br/>get_steps &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/steps/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_steps &lt;- get_steps(baseDate = "2018-11-20", period = "3m")<br/>steps &lt;- content(got_steps)<br/># turn into df<br/>steps[['activities-steps']] &lt;- jsonlist_to_df(steps[['activities-steps']])<br/># assign easy object and rename<br/>steps &lt;- steps[['activities-steps']]<br/>colnames(steps) &lt;- c("dateTime", "steps")</span><span id="a877" class="nn lo iq mq b gy ns np l nq nr">### DISTANCE<br/>get_distance &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/distance/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_distance &lt;- get_distance(baseDate = "2018-11-20", period = "3m")<br/>distance &lt;- content(got_distance)<br/># turn into df<br/>distance[['activities-distance']] &lt;- jsonlist_to_df(distance[['activities-distance']])<br/># assign easy object and rename<br/>distance &lt;- distance[['activities-distance']]<br/>colnames(distance) &lt;- c("dateTime", "distance")</span><span id="2a07" class="nn lo iq mq b gy ns np l nq nr">### FLOORS<br/>get_floors &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/floors/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_floors &lt;- get_floors(baseDate = "2018-11-20", period = "3m")<br/>floors &lt;- content(got_floors)<br/># turn into df<br/>floors[['activities-floors']] &lt;- jsonlist_to_df(floors[['activities-floors']])<br/># assign easy object and rename<br/>floors &lt;- floors[['activities-floors']]<br/>colnames(floors) &lt;- c("dateTime", "floors")</span><span id="0c60" class="nn lo iq mq b gy ns np l nq nr">### ELEVATION<br/>get_elevation &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/elevation/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_elevation &lt;- get_elevation(baseDate = "2018-11-20", period = "3m")<br/>elevation &lt;- content(got_elevation)<br/># turn into df<br/>elevation[['activities-elevation']] &lt;- jsonlist_to_df(elevation[['activities-elevation']])<br/># assign easy object and rename<br/>elevation &lt;- elevation[['activities-elevation']]<br/>colnames(elevation) &lt;- c("dateTime", "elevation")</span><span id="fb2d" class="nn lo iq mq b gy ns np l nq nr">### minutesSedentary<br/>get_minutesSedentary &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/minutesSedentary/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_minutesSedentary &lt;- get_minutesSedentary(baseDate = "2018-11-20", period = "3m")<br/>minutesSedentary &lt;- content(got_minutesSedentary)<br/># turn into df<br/>minutesSedentary[['activities-minutesSedentary']] &lt;- jsonlist_to_df(minutesSedentary[['activities-minutesSedentary']])<br/># assign easy object and rename<br/>minutesSedentary &lt;- minutesSedentary[['activities-minutesSedentary']]<br/>colnames(minutesSedentary) &lt;- c("dateTime", "minutesSedentary")</span><span id="6efa" class="nn lo iq mq b gy ns np l nq nr">### minutesLightlyActive<br/>get_minutesLightlyActive &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/minutesLightlyActive/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_minutesLightlyActive &lt;- get_minutesLightlyActive(baseDate = "2018-11-20", period = "3m")<br/>minutesLightlyActive &lt;- content(got_minutesLightlyActive)<br/># turn into df<br/>minutesLightlyActive[['activities-minutesLightlyActive']] &lt;- jsonlist_to_df(minutesLightlyActive[['activities-minutesLightlyActive']])<br/># assign easy object and rename<br/>minutesLightlyActive &lt;- minutesLightlyActive[['activities-minutesLightlyActive']]<br/>colnames(minutesLightlyActive) &lt;- c("dateTime", "minutesLightlyActive")</span><span id="85da" class="nn lo iq mq b gy ns np l nq nr">### minutesFairlyActive<br/>get_minutesFairlyActive &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/minutesFairlyActive/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_minutesFairlyActive &lt;- get_minutesFairlyActive(baseDate = "2018-11-20", period = "3m")<br/>minutesFairlyActive &lt;- content(got_minutesFairlyActive)<br/># turn into df<br/>minutesFairlyActive[['activities-minutesFairlyActive']] &lt;- jsonlist_to_df(minutesFairlyActive[['activities-minutesFairlyActive']])<br/># assign easy object and rename<br/>minutesFairlyActive &lt;- minutesFairlyActive[['activities-minutesFairlyActive']]<br/>colnames(minutesFairlyActive) &lt;- c("dateTime", "minutesFairlyActive")</span><span id="4ad0" class="nn lo iq mq b gy ns np l nq nr">### minutesVeryActive<br/>get_minutesVeryActive &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/minutesVeryActive/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_minutesVeryActive &lt;- get_minutesVeryActive(baseDate = "2018-11-20", period = "3m")<br/>minutesVeryActive &lt;- content(got_minutesVeryActive)<br/># turn into df<br/>minutesVeryActive[['activities-minutesVeryActive']] &lt;- jsonlist_to_df(minutesVeryActive[['activities-minutesVeryActive']])<br/># assign easy object and rename<br/>minutesVeryActive &lt;- minutesVeryActive[['activities-minutesVeryActive']]<br/>colnames(minutesVeryActive) &lt;- c("dateTime", "minutesVeryActive")</span><span id="c2e5" class="nn lo iq mq b gy ns np l nq nr">### activityCalories<br/>get_activityCalories &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>        GET(url = paste0('https://api.fitbit.com/1/user/-/activities/activityCalories/date/', baseDate, "/", period, '.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/> <br/>got_activityCalories &lt;- get_activityCalories(baseDate = "2018-11-20", period = "3m")<br/>activityCalories &lt;- content(got_activityCalories)<br/># turn into df<br/>activityCalories[['activities-activityCalories']] &lt;- jsonlist_to_df(activityCalories[['activities-activityCalories']])<br/># assign easy object and rename<br/>activityCalories &lt;- activityCalories[['activities-activityCalories']]<br/>colnames(activityCalories) &lt;- c("dateTime", "activityCalories")</span><span id="1bc9" class="nn lo iq mq b gy ns np l nq nr">##### Join multiple dataframes with purrr::reduce and dplyr::left_join<br/>activity_df &lt;- list(calories, steps, distance, floors, elevation, activityCalories, minutesSedentary, minutesLightlyActive, minutesFairlyActive, minutesVeryActive) %&gt;% <br/>        purrr::reduce(left_join, by = "dateTime")</span><span id="1105" class="nn lo iq mq b gy ns np l nq nr"># Add the dateTime to this dataframe<br/>activity_df$dateTime &lt;- as.Date(activity_df$dateTime)</span><span id="528d" class="nn lo iq mq b gy ns np l nq nr">names &lt;- c(2:ncol(activity_df))<br/>activity_df[,names] &lt;- lapply(activity_df[,names], as.numeric)</span><span id="2fa9" class="nn lo iq mq b gy ns np l nq nr"># trim off any days that haven't happened yet<br/>activity_df %&lt;&gt;% filter(dateTime &lt;= "2018-11-06")</span></pre><h1 id="d721" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">获取最近的活动类型</h1><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="ae44" class="nn lo iq mq b gy no np l nq nr"># We're giving it all she's got!<br/><br/>get_frequentActivities &lt;- function(baseDate = NULL, period = NULL, token = Sys.getenv('FITB_AUTH')){<br/>    GET(url = paste0('https://api.fitbit.com/1/user/-/activities/recent.json'),<br/>        add_headers(Authorization = paste0("Bearer ", token)))<br/>}<br/><br/>got_frequentActivities &lt;- get_frequentActivities(baseDate = "2018-11-20", period = "3m")<br/>frequentActivities &lt;- content(got_frequentActivities)</span><span id="1fe1" class="nn lo iq mq b gy ns np l nq nr"># This is a list object let's look at how many frequent activities are logged<br/>length(frequentActivities)<br/>## [1] 5</span><span id="2fc3" class="nn lo iq mq b gy ns np l nq nr"># Take a look at the object with str()<br/>str(frequentActivities)</span><span id="572f" class="nn lo iq mq b gy ns np l nq nr">## List of 5<br/>##  $ :List of 6<br/>##   ..$ activityId : int 2131<br/>##   ..$ calories   : int 0<br/>##   ..$ description: chr ""<br/>##   ..$ distance   : int 0<br/>##   ..$ duration   : int 3038000<br/>##   ..$ name       : chr "Weights"<br/>##  $ :List of 6<br/>##   ..$ activityId : int 90009<br/>##   ..$ calories   : int 0<br/>##   ..$ description: chr "Running - 5 mph (12 min/mile)"<br/>##   ..$ distance   : int 0<br/>##   ..$ duration   : int 1767000<br/>##   ..$ name       : chr "Run"<br/>##  $ :List of 6<br/>##   ..$ activityId : int 90013<br/>##   ..$ calories   : int 0<br/>##   ..$ description: chr "Walking less than 2 mph, strolling very slowly"<br/>##   ..$ distance   : int 0<br/>##   ..$ duration   : int 2407000<br/>##   ..$ name       : chr "Walk"<br/>##  $ :List of 6<br/>##   ..$ activityId : int 90001<br/>##   ..$ calories   : int 0<br/>##   ..$ description: chr "Very Leisurely - Less than 10 mph"<br/>##   ..$ distance   : int 0<br/>##   ..$ duration   : int 4236000<br/>##   ..$ name       : chr "Bike"<br/>##  $ :List of 6<br/>##   ..$ activityId : int 15000<br/>##   ..$ calories   : int 0<br/>##   ..$ description: chr ""<br/>##   ..$ distance   : int 0<br/>##   ..$ duration   : int 1229000<br/>##   ..$ name       : chr "Sport"</span></pre><p id="e2db" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我从来不认为自己是达尔文或梭罗，但显然，就花费的时间而言，慢慢散步是我最喜欢的活动。</p><p id="170b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">你可以看到我的 Fitbit 也记录了<code class="fe mn mo mp mq b">Weights</code>、<code class="fe mn mo mp mq b">Sports</code>和<code class="fe mn mo mp mq b">Biking</code>的时间，这可能是我手动记录我的活动时记录的。Fitbit 有可能会在我玩滑板的时候注册<code class="fe mn mo mp mq b">Biking</code>。</p><h1 id="4d65" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">活动相关图</h1><p id="7047" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">以前我总是使用<code class="fe mn mo mp mq b">corrplot</code>包来创建一个相关图；然而，它不能很好地与<code class="fe mn mo mp mq b">ggplot</code>配合，这意味着你不能轻易地添加<code class="fe mn mo mp mq b">Game Boy</code>主题。尽管如此，我还是给了它一个复古的调色板，做了一些小小的调整。</p><p id="ce2a" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">由于我从最初的<code class="fe mn mo mp mq b">gameboy</code>中想到了两种颜色，并且知道它们的<code class="fe mn mo mp mq b">hex</code>代码，我能够从这个网站中<a class="ae mr" href="https://meyerweb.com/eric/tools/color-blend/#CADCA0:0F380E:10:hex" rel="noopener ugc nofollow" target="_blank">生成一个调色板。</a></p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="b632" class="nn lo iq mq b gy no np l nq nr"># Aligning Covariance Matrices </span><span id="2dca" class="nn lo iq mq b gy ns np l nq nr"># drop dateTime<br/>corr_df &lt;- activity_df[,2:11]</span><span id="773f" class="nn lo iq mq b gy ns np l nq nr"># Correlation matrix<br/>corr &lt;- cor(na.omit(corr_df))<br/>corrplot(corr, type = "upper", bg = "#9BBB0E", tl.col = "#565656", col = c("#CADCA0", "#B9CD93", "#A8BE85", "#97AF78", "#86A06B", "#75915E", "#648350", "#537443", "#426536", "#315629", "#20471B", "#0F380E"))</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/0c16b1e20a3cb14d346009fd1ee40cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTg5t-6UxM1TAnPzQPSXVg.png"/></div></div></figure><p id="e4bb" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">在相关图中，每个圆圈的颜色表示相关性的大小，圆圈的大小表示相关性的显著性。</p><p id="a061" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">在搜索了一会儿<code class="fe mn mo mp mq b">ggplot2</code>扩展之后，我能够使用<code class="fe mn mo mp mq b">ggcorrplot</code>，这允许我再次使用<code class="fe mn mo mp mq b">gameboy</code>主题！</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="1863" class="nn lo iq mq b gy no np l nq nr"># Generating textures...</span><span id="3790" class="nn lo iq mq b gy ns np l nq nr">ggcorrplot(corr, hc.order = TRUE, <br/>           type = "lower", <br/>           lab = TRUE, <br/>           lab_size = 2,<br/>           tl.cex = 8,<br/>           show.legend = FALSE,<br/>           colors = c( "#306230", "#306230", "#0F380F" ), <br/>           title="Correlogram",<br/>           ggtheme=theme_gameboy)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oh"><img src="../Images/449e1f9be798e813a18bc13baa0f69b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1SU_WnacCEwUMKyktMf5mw.png"/></div></div></figure><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="372d" class="nn lo iq mq b gy no np l nq nr"># Game Over. Loading previous save<br/><br/>ggcorrplot(corr, hc.order = TRUE, <br/>           type = "lower", <br/>           lab = TRUE, <br/>           lab_size = 2,<br/>           tl.cex = 8,<br/>           show.legend = FALSE,<br/>           colors = c( "#3B7AAD", "#56B1F7", "#1D3E5D" ), <br/>           title="Correlogram",<br/>           ggtheme=theme_gba)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oi"><img src="../Images/4febc731cf7200468c7a6cfacb469988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzc7qhOaNtKUGMvhxJTnEQ.png"/></div></div></figure><h1 id="188e" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">探索活动</h1><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="ff05" class="nn lo iq mq b gy no np l nq nr"># Link saying "hyahhh!"<br/><br/># Static<br/>g &lt;- activity_df %&gt;% <br/>        ggplot(aes(x=dateTime, y=calories)) + <br/>        geom_line(colour = "black") +<br/>        geom_point(shape = 21, colour = "black", aes(fill = calories), size = 5, stroke = 1) +<br/>        xlab("") +<br/>        ylab("Calorie Expenditure")<br/><br/>g + theme_gameboy() + theme(legend.position = "none")<br/>g + theme_gba() + theme(legend.position = "none")</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oj"><img src="../Images/64fc1ecef5a1ff055f7f0d110bb060e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_8lQAMs8dYrGcTqmrxR_Yw.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oj"><img src="../Images/772f9f17b40466d54b575c2af70475b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7BveAdVwZZJAC6xDvoulg.png"/></div></div></figure><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="04aa" class="nn lo iq mq b gy no np l nq nr"># Panick! at the Discord...<br/><br/># gganimate<br/>g &lt;- activity_df %&gt;% <br/>        ggplot(aes(x=dateTime, y=calories)) + <br/>        geom_line(colour = "black") +<br/>        geom_point(shape = 21, colour = "black", aes(fill = calories), size = 5, stroke = 1) +<br/>        transition_time(dateTime) +<br/>        shadow_mark() +<br/>        ease_aes('linear') +<br/>        xlab("") +<br/>        ylab("Calorie Expenditure") <br/><br/>g + theme_gba() + theme(legend.position = "none")</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oj"><img src="../Images/82af32b6777702b9c3855c839f0df6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4pdWa_N8doJnrfJ9uXSqjA.gif"/></div></div></figure><p id="fdc3" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">距离是由你的步数和你估计的步幅(你输入的身高)决定的。</p><p id="25f2" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">我还制作了<code class="fe mn mo mp mq b">Distance</code>、<code class="fe mn mo mp mq b">Steps</code>、<code class="fe mn mo mp mq b">Elevation</code>和<code class="fe mn mo mp mq b">Floors</code>的剧情，但是你必须<a class="ae mr" href="https://moldach.github.io/fitbit-project/" rel="noopener ugc nofollow" target="_blank">查看这个页面才能看到它们</a>。</p><h1 id="c41e" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结束语</h1><p id="0fb7" class="pw-post-body-paragraph ki kj iq kl b km mf jr ko kp mg ju kr mh mi ku kv mj mk ky kz ml mm lc ld le ij bi translated">尽管 Fitbit 为单个用户提供了一个很好的仪表板，但它是不可扩展的。通过直接访问数据，人们可以向 200 个甚至更多的人提问。如果有人愿意，他们甚至可以构建一个带有定制可视化效果的奇特<code class="fe mn mo mp mq b">Shiny</code>仪表盘。</p><p id="0faa" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mh kt ku kv mj kx ky kz ml lb lc ld le ij bi translated">如果您有任何问题或意见，您可以随时通过 LinkedIn 联系我。在那之前，下一篇文章再见！</p><pre class="lg lh li lj gt nj mq nk nl aw nm bi"><span id="b731" class="nn lo iq mq b gy no np l nq nr"># Wubba Lubba Dub Dub<br/><br/># https://www.spriters-resource.com/game_boy_advance/kirbynim/sheet/15585/<br/>sprite_sheet &lt;- png::readPNG("kirby.png")<br/><br/>Nframes       &lt;- 11      # number of frames to extract<br/>width         &lt;- 29      # width of a frame<br/>sprite_frames &lt;- list()  # storage for the extracted frames<br/><br/># Not equal sized frames in the sprite sheet. Need to compensate for each frame<br/>offset &lt;- c(0, -4, -6, -7, -10, -16, -22, -26, -28, -29, -30)<br/><br/># Manually extract each frame<br/>for (i in seq(Nframes)) {<br/>  sprite_frames[[i]] &lt;- sprite_sheet[120:148, (width*(i-1)) + (1:width) + offset[i], 1:3]<br/>}<br/><br/># Function to convert a sprite frame to a data.frame<br/># and remove any background pixels i.e. #00DBFF<br/>sprite_frame_to_df &lt;- function(frame) {<br/>  plot_df &lt;- data_frame(<br/>    fill  = as.vector(as.raster(frame)),<br/>    x = rep(1:width, width),<br/>    y = rep(width:1, each=width)<br/>  ) %&gt;%<br/>    filter(fill != '#00DBFF')<br/>}<br/><br/>sprite_dfs &lt;- sprite_frames %&gt;%<br/>  map(sprite_frame_to_df) %&gt;%<br/>  imap(~mutate(.x, idx=.y))<br/><br/>fill_manual_values &lt;- unique(sprite_dfs[[1]]$fill)<br/>fill_manual_values &lt;- setNames(fill_manual_values, fill_manual_values)<br/><br/>mega_df &lt;- dplyr::bind_rows(sprite_dfs)<br/><br/>p &lt;- ggplot(mega_df, aes(x, y, fill=fill)) +<br/>  geom_tile(width=0.9, height=0.9) +<br/>  coord_equal(xlim=c(1, width), ylim=c(1, width)) +<br/>  scale_fill_manual(values = fill_manual_values) +<br/>  theme_gba() +<br/>        xlab("") +<br/>        ylab("") +<br/>  theme(legend.position = 'none', axis.text=element_blank(), axis.ticks = element_blank())<br/><br/>panim &lt;- p +<br/>  transition_manual(idx, seq_along(sprite_frames)) +<br/>  labs(title = "gganimate Kirby")<br/><br/>gganimate::animate(panim, fps=30, width=400, height=400)</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/4decc33cd71f8ba05f3b0da92c3ff175.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*-Z0WH8ugtxiqyHK8oDP2Iw.gif"/></div></figure></div></div>    
</body>
</html>