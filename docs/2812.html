<html>
<head>
<title>Predicting Upsets in the NCAA Tournament with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习预测NCAA锦标赛的冷门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-upsets-in-the-ncaa-tournament-with-machine-learning-816fecf41f01?source=collection_archive---------4-----------------------#2018-03-09">https://towardsdatascience.com/predicting-upsets-in-the-ncaa-tournament-with-machine-learning-816fecf41f01?source=collection_archive---------4-----------------------#2018-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新</strong>:看看这个<a class="ae kl" href="https://link.medium.com/W02maxUDbV" rel="noopener">的后续</a>，我在这里讨论了3个额外的不安信号。</p><p id="4874" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">疯狂即将来临！一年一度的男子大学篮球锦标赛将于3月15日开始，很快数百万球迷将填写他们的括号。</p><p id="93b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对我们大多数人来说，冷门是锦标赛中最精彩的部分。在体育运动中，很少有球迷的经历能比得上看到实时爆冷的兴奋感，以及处于劣势的球队赢得胜利时的纯粹喜悦:</p><p id="79ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">唯一比看着疯狂的冷门下跌更好的事情是把冷门选秀权钉在你的支架上。说起来容易做起来难:在最近的一次全国在线括号比赛中，平均只有19%的括号选择了不满意。冷门还会让一些种子选手提前回家。例证:2016年<a class="ae kl" href="http://www.espn.com/blog/collegebasketballnation/post/_/id/112638/tournament-challenge-final-pick-results-and-bracket-numbers" rel="noopener ugc nofollow" target="_blank"> 62%的ESPN挑战赛排名</a>密歇根州立大学进入了四强，斯巴达队获得了第二多的冠军。但疯狂随之而来:汤姆伊佐的球队在第一轮就被拥有15个种子的田纳西中部州立大学淘汰了。</p><p id="23e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正确挑选冷门可以区分你的括号，给你一个竞争优势。我试图通过使用数据和机器学习来预测NCAA锦标赛中的冷门，从而战胜困难。</p><h2 id="5ca5" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">使用团队种子定义意外事件</h2><p id="f35e" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">每年，64个符合条件的团队被分成四组，每组16个(“地区”)，每个团队都被分配一个“种子”，排名从1(最好)到16(最差)，就像2016年的中西部地区一样。一个队在几乎每场比赛中都有技术优势，但人们不会对9号种子击败8号种子，甚至10号种子击败7号种子感到震惊。这些比赛基本上都是“胜负难分”的。我对预测更令人震惊和意想不到的沮丧感兴趣。</p><p id="dab4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我把一场失利定义为一个比对手</strong>低至少4位的种子队的胜利，比如1号种子输给5号种子或更低，2号种子输给6号种子或更低，等等。因为锦标赛每年都使用相同的结构，所以种子赛是一种快速、简单的方法来识别和研究冷门。</p><h1 id="86fc" class="lk kn iq bd ko ll lm ln kr lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma bi translated">数据准备和探索</h1><h2 id="57b3" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">数据</h2><p id="d2b0" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我获得了自2003年以来每支锦标赛球队在常规赛和锦标赛中球队和球员表现的数据。该数据包括584场有“潜在冷门”的锦标赛，这意味着这些球队的种子差距至少为4。</p><h2 id="e0e6" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">特征工程</h2><p id="70f0" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我为每个团队创建了一个包含82个特征的数据集，包括整个赛季的团队表现、团队效率指标、教练比武经验/成功以及团队旅行。因为目标是预测，所有特征都是在每场锦标赛游戏的之前<em class="mb">可用的特征。然后，我做了一些数据探索，以确定可能预测冷门的趋势。</em></p><h2 id="1a30" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">冷门和种子比赛</h2><p id="cc89" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">下面的图表显示了每年的冷门次数，以及每年的平均值。不要疯狂地挑太多的冷门；平均每年只有9起。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/25aab80d5a4cd1d8302c78e356424bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSY_fxZeJwy848E7NdsQVg.jpeg"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">On average only 9 upsets occur in each tournament</figcaption></figure><p id="9cab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哪些比赛最有可能导致冷门？事实证明，在第1轮和第2轮中出现的14个常见种子配对占所有“潜在冷门”游戏的85%。下面显示了这些比赛，以及它们的“冷门率”(导致冷门的比赛比例)的热图。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ms"><img src="../Images/61d1b042a7a359f3f434ec277fb61bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VO5rs3XlPz82LVeoOVGKWA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Heat map of upset rates for the most common seed pairings</figcaption></figure><p id="ef14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该图基于种子匹配确定了一些好的不规则候选:</p><ul class=""><li id="86d7" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">在第一轮中，关注12对5和11对6。12号种子选手和11号种子选手赢得这些比赛的几率约为40%。</li><li id="b8d5" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">如果你觉得大胆，在第一轮中拿一个13号种子胜过一个4号种子。13号种子队赢得了20%的比赛。</li><li id="4ce3" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">2粒种子很少在第一轮中失败(7%)，但在第二轮中，他们令人惊讶地容易被7粒种子(33%)和10粒种子(37%)打乱。</li><li id="6e8b" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">这些10粒种子和7粒种子比8粒种子和9粒种子更适合16粒种子，后者很少在第二轮中击败1粒种子(12-13%)。</li><li id="945a" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">考虑在甜蜜的16强中放一个11号种子:在第二轮中，11号种子赢得了三分之一的比赛。</li></ul><h2 id="a59b" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">发现灰姑娘和后进生</h2><p id="8130" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">除了种子赛，赢的失败者和输的热门有什么特征？</p><h2 id="9cd0" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">团队效率边际</h2><p id="3498" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">从肯·波默罗伊优秀的高级篮球分析<a class="ae kl" href="https://kenpom.com/" rel="noopener ugc nofollow" target="_blank">网站</a>，一个球队的<em class="mb">调整后的效率边际</em>是一个单一的数字，它表明了比赛的整体实力。本质上，它代表了在给定100分的情况下，一个球队相对于一个普通对手的预期胜率。下面我画出了我的数据集中每场比赛的失败者和最受欢迎者的效率边际，数据点显示了比赛是否导致了冷门。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nh"><img src="../Images/fe09e4aa0a6f6936d6086284fb71ae38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y44mkHLp_N-_3VtaLLYD3w.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Upsets involve underdogs with higher efficiency and favorites with lower efficiency</figcaption></figure><p id="0a4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数冷门都发生在差幅超过10的劣势方对差幅低于25的热门方的时候。事实上，符合这些标准的游戏有35%的时间会导致不愉快，而不符合这些标准的游戏只有13%。作为挑选冷门的简单经验法则，你当然可以做得更糟！</p><h2 id="00b8" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">赚取额外的财富——篮板和失误</h2><p id="98ee" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在篮球比赛中，球队在投篮不中或得分后交换控球权，但球队也可以通过反弹自己的失误(产生额外的投篮机会)和迫使失误(夺走对手的机会)来获得“额外”的控球权。为了计算“进攻篮板和失误率”，我计算了整个赛季中每支球队平均每场比赛的进攻篮板和失误优势。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ni"><img src="../Images/b71a6976ad311499bad3abe43f573a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rWAt_hZ8jND_UlN0hRchA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Winning underdogs have better offensive rebounding and turnover margins</figcaption></figure><p id="19a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在左边，我显示了在非冷门(左)和冷门(右)比赛中的冷门选手和热门选手的平均差距。</p><p id="7c80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在没有冷门的情况下，热门比冷门有更高的利润，但是在冷门的情况下，情况正好相反。如果处于劣势的一方比他们的对手更擅长获得进攻篮板和失误，那么这场比赛就是一场逆转。</p><h1 id="0688" class="lk kn iq bd ko ll lm ln kr lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma bi translated">用于镦粗预测的机器学习</h1><p id="22a4" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">与其逐个检查82个特征，不如让算法发挥作用。我将游戏分成训练集(80%)和测试集(20%)，并训练每个算法进行预测。</p><p id="e3d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">训练分类算法</strong></p><p id="ceef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将冷门预测作为一个分类问题，目标是将每场比赛归类为“冷门”与否。我选择了5种分类算法进行训练:</p><ul class=""><li id="ade2" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">逻辑回归</li><li id="5eac" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">神经网络</li><li id="1ae7" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">支持向量机</li><li id="936e" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">随机森林</li><li id="50f7" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">梯度树提升分类器</li></ul><p id="ddf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用python的<a class="ae kl" href="http://scikit-learn.org/stable/supervised_learning.html#supervised-learning" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>包，我使每个算法适合训练数据，并使用5重交叉验证来调整模型超参数(影响模型拟合的设置)。为了确定每个算法的最佳设置，我使用了交叉验证<em class="mb"> F1 </em>分数。这里，<em class="mb"> F1 </em>分数是扰乱<em class="mb">精度</em>(最小化不正确的扰乱预测)和<em class="mb">召回</em>(预测大多数实际扰乱)的平衡。关于<em class="mb"> F1 </em>的更多信息，请参见<a class="ae kl" href="https://en.wikipedia.org/wiki/F1_score" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="cb41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也应该承认冷门在这些数据中是“不平衡”的，只有22%的游戏是冷门。这些算法通常最适用于接近对半分割的示例。不涉及太多细节，我会注意到训练数据被<em class="mb">重采样</em>以在扰乱和非扰乱之间创建平衡(在这里阅读关于不平衡数据和重采样<a class="ae kl" href="https://svds.com/learning-imbalanced-classes/" rel="noopener ugc nofollow" target="_blank">的更多信息)。</a></p><p id="bf77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试模型性能</strong></p><p id="b6a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于每种算法，在保留的测试集上评估来自训练的最佳模型。5个模型的ROC曲线如下所示:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nj"><img src="../Images/7e435551c936f94e15cfdaf324738b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJz6UAOFmz5ohPmecEUSIw.jpeg"/></div></div></figure><p id="0538" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该图显示，对于每个分类器，随着真阳性率的增加，假阳性率也增加。大多数分类问题都是如此；随着更多的真实情况被预测，更多的虚假情况也被预测。我还注意到，这些算法在ROC曲线的不同点上最大化了真正的阳性率，因此将它们组合在一起可能会产生更好的结果。</p><p id="7c1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">“未来”对决分类</strong></p><p id="4cdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了评估一个更“真实世界的场景”，我想预测单个锦标赛的冷门。我使用逻辑回归模型预测了2017年的42场潜在冷门比赛，这些比赛是我在之前的训练和测试中推出的。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/51ea2eac78ad1d3e357713d1d6e92d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*wirE5cmPeaP2N9jhMqKveA.jpeg"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Matrix showing prediction results for 2017</figcaption></figure><p id="b790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该矩阵将预测细分为正确的非镦粗(左上)、正确的镦粗预测(右下)、不正确的非镦粗预测(左下)和不正确的镦粗预测(右上)。</p><p id="66c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该模型预测了2017年的15次颠覆。在2017年的10次实际冷门中，有8次被模型识别出来，但模型也做出了7次“假阳性”的冷门预测。该模型在预测冷门时有点过于激进，但对于这些难以预测的游戏来说，它仍然是正确的。</p><p id="18bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更仔细地观察预测，可以更深入地了解模型在哪些方面表现良好，以及在哪些方面需要改进:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nj"><img src="../Images/b32decc63c7ad72c9a78f3d4851148f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DSTFB8RfuFqU8ryNzPTqww.jpeg"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Upset predictions are most accurate for Round 1</figcaption></figure><p id="a0e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">模型真的很擅长预测第一轮，23/24场比赛预测正确。对于所有其他回合，该模型去10/18。我希望模型在整个比赛中更加精确，但第一轮也是最令人失望的时候。大多数括号池玩家可以通过在第一轮中采取模型预测的冷门来获得优势。我还计算出，在这些令人沮丧的预测上下注，将获得21%的净回报。</p><h1 id="9a29" class="lk kn iq bd ko ll lm ln kr lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma bi translated"><strong class="ak">结论</strong></h1><p id="2d5d" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我有几个改进模型预测的想法，包括添加更多的数据来创建更多的特征，对团队最近的表现进行加权，以及尝试其他算法或算法组合。我还想尝试对比赛分数而不是最终结果进行建模，并研究其他NCAA锦标赛预测问题，如识别被高估的球队提前回家的特征，以及“灰姑娘”失败者准备深入锦标赛的特征。</p><p id="4888" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将在Twitter上宣布未来的工作，所以如果你喜欢，请给我一个<a class="ae kl" href="https://twitter.com/bracket_vision" rel="noopener ugc nofollow" target="_blank">关注</a>！</p></div></div>    
</body>
</html>