<html>
<head>
<title>Step-by-step guide to build your own ‘mini IMDB’ database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您自己的“迷你IMDB”数据库的分步指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/step-by-step-guide-to-build-your-own-mini-imdb-database-fc39af27d21b?source=collection_archive---------0-----------------------#2018-02-28">https://towardsdatascience.com/step-by-step-guide-to-build-your-own-mini-imdb-database-fc39af27d21b?source=collection_archive---------0-----------------------#2018-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b1f3" class="pw-subtitle-paragraph jo ip iq bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何使用简单的Python库和内置功能从web中抓取电影信息，并将其存储在本地SQLite数据库中。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/7bc8566bcad7576d8fa25df6637bd0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eiMjmw1_R_-VuhTz."/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@charlesdeluvio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Charles Deluvio 🇵🇭🇨🇦</a> on <a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="438c" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi lt translated">在学习了几门Python入门课程后，初学者常常想知道如何编写一个很酷的Python程序，展示该语言的一些高级功能，如web抓取或数据库操作。在本文中，我将展示如何使用简单的Python库和内置功能来抓取web上的电影信息，并将它们存储在本地SQLite数据库中，稍后可以使用电影信息查询该数据库进行数据分析。请将此视为构建您自己的迷你IMDB数据库的项目！</p><blockquote class="mc md me"><p id="2413" class="kx ky mf kz b la lb js lc ld le jv lf mg lh li lj mh ll lm ln mi lp lq lr ls ij bi translated"><strong class="kz ir">这种类型的数据工程任务——从网络上收集数据并建立数据库连接——通常是数据分析项目的第一步。</strong>在你做任何酷的预测建模之前，你需要掌握这一步。这一步通常是杂乱无章的，也就是说，没有一步到位的公式或一站式商店为你做所有的事情。<strong class="kz ir">所以，你必须从网络中提取数据，检查它的结构，并构建你的代码来完美地浏览它。</strong></p></blockquote><p id="c5c8" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">具体来说，本演示将展示以下功能的用法:</p><ul class=""><li id="4a19" class="mj mk iq kz b la lb ld le lg ml lk mm lo mn ls mo mp mq mr bi translated">Python <strong class="kz ir"> urllib </strong>库</li><li id="935d" class="mj mk iq kz b la ms ld mt lg mu lk mv lo mw ls mo mp mq mr bi translated"><strong class="kz ir"> Web API服务(带密钥)</strong>用于检索数据</li><li id="1691" class="mj mk iq kz b la ms ld mt lg mu lk mv lo mw ls mo mp mq mr bi translated">Python <strong class="kz ir"> json </strong>库</li><li id="0e42" class="mj mk iq kz b la ms ld mt lg mu lk mv lo mw ls mo mp mq mr bi translated">Python <strong class="kz ir"> OS </strong>模块</li><li id="602e" class="mj mk iq kz b la ms ld mt lg mu lk mv lo mw ls mo mp mq mr bi translated">Python <strong class="kz ir"> SQLite </strong>库</li></ul><p id="dba6" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">下面给出了这些的简要描述，</p><h2 id="c9af" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">Python <em class="jn"> urllib </em>模块</h2><p id="775f" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">Python到web的网关是通过<a class="ae kw" href="https://docs.python.org/3/howto/urllib2.html" rel="noopener ugc nofollow" target="_blank"> urllib模块</a>完成的。它是一个用于获取URL(统一资源定位器)的Python模块。它以urlopen 函数的形式提供了一个非常简单的接口。这能够使用各种不同的协议获取URL。它还提供了一个稍微复杂一点的接口来处理常见情况——比如基本身份验证、cookies、代理等等。这些是由称为处理程序和打开程序的对象提供的。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="9493" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated"><strong class="ak"> Web API服务(带密钥)</strong>用于检索数据</h2><p id="5ef2" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">Web抓取通常由外部网站托管的API服务来完成。可以把它们想象成存储库或远程数据库，您可以通过自己的小程序发送搜索字符串来查询它们。在这个特定的例子中，我们将从<a class="ae kw" href="http://www.omdbapi.com/" rel="noopener ugc nofollow" target="_blank">开放电影数据库(OMDB)网站</a>获得帮助，该网站向注册用户提供API密钥，用于下载电影信息。因为这是一项免费服务，他们每天有1000个请求的限制。请注意，您必须在他们的网站上注册，并获得自己的API密钥，以便从您的Python程序发出请求。</p><p id="3384" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">从这个API服务获得的数据以JSON文件的形式返回。因此，我们需要将JSON文件解析/转换成一个Python对象，这样我们就可以轻松地工作了。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nx"><img src="../Images/77f881e833c841dfc6f8750dab87fc96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9VmcceI6GEFFPwFeHhJ5Q.png"/></div></div></figure><h2 id="d298" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">Python <em class="jn"> json </em>模块</h2><p id="77fc" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">JSON是一种轻量级的数据交换格式。对人类来说，读和写很容易。机器很容易解析生成。它基于<a class="ae kw" href="http://javascript.crockford.com/" rel="noopener ugc nofollow" target="_blank"> JavaScript编程语言</a>，<a class="ae kw" href="http://www.ecma-international.org/publications/files/ecma-st/ECMA-262.pdf" rel="noopener ugc nofollow" target="_blank">标准ECMA-262第三版——1999年12月</a>。JSON是一种完全独立于语言的文本格式，但是它使用了C语言系列的程序员所熟悉的约定，包括C、C++、C#、Java、JavaScript、Perl、Python和许多其他语言。这些特性使JSON成为理想的数据交换语言。</p><p id="1079" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="http://docs.python-guide.org/en/latest/scenarios/json/" rel="noopener ugc nofollow" target="_blank">json库</a>可以从字符串或文件中解析JSON页面。该库将JSON解析成Python字典或列表。它还可以将Python字典或列表转换成JSON字符串。这是一个非常有用的模块，学习起来非常简单。这个模块很可能在任何基于Python的web数据分析程序中使用，因为现在大多数网页在返回数据时使用JSON作为主要对象类型。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="bca8" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">Python操作系统模块</h2><p id="933a" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">该模块提供了一种使用操作系统相关功能的可移植方式。如果你只是想读或写一个文件，参见<code class="fe ny nz oa ob b"><a class="ae kw" href="https://docs.python.org/3/library/functions.html#open" rel="noopener ugc nofollow" target="_blank">open()</a></code>，如果你想操作路径，参见<code class="fe ny nz oa ob b"><a class="ae kw" href="https://docs.python.org/3/library/os.path.html#module-os.path" rel="noopener ugc nofollow" target="_blank">os.path</a></code>模块，如果你想在命令行上读取所有文件中的所有行，参见<code class="fe ny nz oa ob b"><a class="ae kw" href="https://docs.python.org/3/library/fileinput.html#module-fileinput" rel="noopener ugc nofollow" target="_blank">fileinput</a></code>模块。创建临时文件和目录见<code class="fe ny nz oa ob b"><a class="ae kw" href="https://docs.python.org/3/library/tempfile.html#module-tempfile" rel="noopener ugc nofollow" target="_blank">tempfile</a></code>模块，高级文件和目录处理见<code class="fe ny nz oa ob b"><a class="ae kw" href="https://docs.python.org/3/library/shutil.html#module-shutil" rel="noopener ugc nofollow" target="_blank">shutil</a></code>模块。在这个演示中，我们将使用操作系统模块方法来检查现有的目录，并操作文件来保存一些数据。</p><h2 id="b7a7" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">SQLite和Python SQLite3</h2><p id="76d1" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">SQLite是一个C库，它提供了一个轻量级的基于磁盘的数据库，不需要单独的服务器进程，并允许使用SQL查询语言的非标准变体来访问数据库。一些应用程序可以使用SQLite进行内部数据存储。还可以使用SQLite构建应用程序原型，然后将代码移植到更大的数据库，如PostgreSQL或Oracle。Python的<a class="ae kw" href="https://www.pythoncentral.io/introduction-to-sqlite-in-python/" rel="noopener ugc nofollow" target="_blank"> sqlite3模块</a>提供了符合DB-API 2.0规范的SQL接口。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nv nw l"/></div></figure></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h2 id="3e35" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">程序的主要流程</h2><p id="6026" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">程序的流程如下所示。<strong class="kz ir">请注意</strong> <a class="ae kw" href="https://github.com/tirthajyoti/Web-Database-Analytics-Python/blob/master/Movie_Database_Build.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">锅炉板块代码在我的</strong> </a><a class="ae kw" href="https://github.com/tirthajyoti" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> Github资源库</strong> </a>中有  <strong class="kz ir">。喜欢的请下载/叉/星。</strong></p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oj"><img src="../Images/faa14a4b91ef9878753137b6db500735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WvTpS5A6uGZ2m021K31dCQ.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Fig: Main flow of the program</figcaption></figure><p id="aa59" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">基本思想是向外部API发送带有用户输入的电影标题的请求。然后，该程序试图下载数据，如果成功，打印出来。</p><pre class="kh ki kj kk gt ok ob ol om aw on bi"><span id="0224" class="mx my iq ob b gy oo op l oq or">def search_movie(title):<br/>    if len(title) &lt; 1 or title==’quit’: <br/>    print(“Goodbye now…”)<br/>    return None</span><span id="b6ed" class="mx my iq ob b gy os op l oq or">try:<br/>    url = serviceurl + urllib.parse.urlencode({‘t’: title})+apikey<br/>    print(f’Retrieving the data of “{title}” now… ‘)<br/>    uh = urllib.request.urlopen(url)<br/>    data = uh.read()<br/>    json_data=json.loads(data)<br/> <br/> if json_data[‘Response’]==’True’:<br/>     print_json(json_data)</span><span id="f103" class="mx my iq ob b gy os op l oq or">except urllib.error.URLError as e:<br/>    print(f"ERROR: {e.reason}")</span></pre><p id="a89b" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">例如，JSON文件如下所示:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ot"><img src="../Images/202aface7247aec4272a4c3ec9dcf6ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZFG6UHyMfWDy_8OLs5pnaA.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Fig: An example JSON file retrieved from the API.</figcaption></figure><p id="4feb" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果程序找到了电影海报的图像文件的链接，它会询问用户是否想下载它。如果用户同意，它会将图像文件下载到本地目录，并以电影标题作为文件名。</p><pre class="kh ki kj kk gt ok ob ol om aw on bi"><span id="c21f" class="mx my iq ob b gy oo op l oq or"># Asks user whether to download the poster of the movie<br/>if json_data['Poster']!='N/A':<br/>    poster_yes_no=input ('Poster of this movie can be downloaded. Enter "yes" or "no": ').lower()<br/>    if poster_yes_no=='yes':<br/>        save_poster(json_data)</span></pre><p id="a023" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">接下来，它询问用户是否想在本地数据库中保存一些关于电影的基本信息。如果用户点头，它将创建或插入一个SQLite数据库中下载电影信息的子集。</p><pre class="kh ki kj kk gt ok ob ol om aw on bi"><span id="36c7" class="mx my iq ob b gy oo op l oq or">#Asks user whether to save the movie information in a local database</span><span id="1f4d" class="mx my iq ob b gy os op l oq or">save_database_yes_no=input ('Save the movie info in a local database? Enter "yes" or "no": ').lower()</span><span id="219f" class="mx my iq ob b gy os op l oq or">if save_database_yes_no=='yes':<br/>    save_in_database(json_data)</span></pre><p id="595c" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">下面是要保存在数据库中的函数定义。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ou nw l"/></div></figure><p id="4f40" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">笔记本还包含将现有数据库中的信息保存为Excel文件的功能。</p><h2 id="5a2a" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">关于秘密API密匙的一句话</h2><p id="bd7c" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">您会注意到程序使用一个秘密的API密钥来访问数据。该密钥可以通过访问OMDB网站免费获得，每天最多可使用1000次。使用秘密(特定于用户的)密钥进行web抓取是一种非常常见的做法。我保护个人API密匙完整性的方法是在Jupyter笔记本的同一个目录下创建一个小JSON文件，名为<strong class="kz ir"> APIkeys.json </strong>。该文件的内容对将看到我的代码的外部用户是隐藏的。我的Jupyter笔记本将这个JSON文件作为字典读取，复制对应于电影网站的密钥，并将其附加到由<code class="fe ny nz oa ob b">urllib.request</code>方法发送的编码URL请求字符串。</p><pre class="kh ki kj kk gt ok ob ol om aw on bi"><span id="b3d0" class="mx my iq ob b gy oo op l oq or">with open(‘APIkeys.json’) as f:<br/>    keys = json.load(f)<br/>    omdbapi = keys[‘OMDBapi’]</span><span id="1b19" class="mx my iq ob b gy os op l oq or">serviceurl = '<a class="ae kw" href="http://www.omdbapi.com/?'" rel="noopener ugc nofollow" target="_blank">http://www.omdbapi.com/?'</a><br/>apikey = '&amp;apikey='+omdbapi</span></pre><h2 id="f745" class="mx my iq bd mz na nb dn nc nd ne dp nf lg ng nh ni lk nj nk nl lo nm nn no np bi translated">摘要</h2><p id="a9d0" class="pw-post-body-paragraph kx ky iq kz b la nq js lc ld nr jv lf lg ns li lj lk nt lm ln lo nu lq lr ls ij bi translated">本文通过一个演示Python笔记本来说明如何使用免费的API服务检索关于电影的基本信息，并将电影海报和下载的信息保存在一个轻量级SQLite数据库中。</p><blockquote class="mc md me"><p id="bccb" class="kx ky mf kz b la lb js lc ld le jv lf mg lh li lj mh ll lm ln mi lp lq lr ls ij bi translated">最重要的是，它演示了Python库的简单使用，如<strong class="kz ir"> urllib、json和sqlite3 </strong>，这些库对于数据分析/ web数据挖掘任务来说是非常有用(和强大)的工具。</p></blockquote><p id="20c8" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我希望读者可以从提供的笔记本文件中受益，并根据自己的要求和想象来构建它。更多网络数据分析笔记本，<a class="ae kw" href="https://github.com/tirthajyoti/Web-Database-Analytics-Python" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">请看我的知识库。</strong> </a></p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="d7a5" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi lt translated"><span class="l lu lv lw bm lx ly lz ma mb di">如果</span>您有任何问题或想法要分享，请联系作者在<a class="ae kw" href="mailto:tirthajyoti@gmail.com" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">tirthajyoti【AT】Gmail . com</strong></a>。你也可以查看作者的<a class="ae kw" href="https://github.com/tirthajyoti?tab=repositories" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> GitHub资源库</strong> </a>中其他有趣的Python、R或MATLAB代码片段和机器学习资源。如果你像我一样对机器学习/数据科学充满热情，请随时<a class="ae kw" href="https://www.linkedin.com/in/tirthajyoti-sarkar-2127aa7/" rel="noopener ugc nofollow" target="_blank">在LinkedIn上添加我</a>或<a class="ae kw" href="https://twitter.com/tirthajyotiS" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我。</a></p></div></div>    
</body>
</html>