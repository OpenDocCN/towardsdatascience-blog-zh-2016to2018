<html>
<head>
<title>Git Version Control with Jupyter Notebooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter 笔记本的 Git 版本控制</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/version-control-with-jupyter-notebooks-f096f4d7035a?source=collection_archive---------4-----------------------#2018-10-08">https://towardsdatascience.com/version-control-with-jupyter-notebooks-f096f4d7035a?source=collection_archive---------4-----------------------#2018-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6dafb44a4955179dcd5f2ba9b5f84cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RTgn1s0GY8r0rSPsAzf8NQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Don’t loose your version control history.</figcaption></figure><p id="4020" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">版本控制是数据科学工作流的重要组成部分。在多个实验之间，了解哪个团队成员做了哪些更改和哪些更新是非常重要的。不幸的是，默认的 jupyter 设置在这方面严重不足。</p><p id="3ffc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Jupyter 笔记本是以<code class="fe la lb lc ld b">Json</code>格式存储的，因此很难看出笔记本上的差异，也很难在团队层面上进行代码审查。为了解决这个问题，我们将以<code class="fe la lb lc ld b">.ipynb</code>和<code class="fe la lb lc ld b">.Rmd</code> (r-markdown 格式)存储笔记本。这将使我们能够做差异以及合并，因为<code class="fe la lb lc ld b">.Rmd</code>只是一个文本文件。</p><h2 id="080e" class="le lf iq bd lg lh li dn lj lk ll dp lm kn ln lo lp kr lq lr ls kv lt lu lv lw bi translated">介绍 R-Markdown 及其优于普通 Markdown 的优势</h2><p id="d63d" class="pw-post-body-paragraph kc kd iq ke b kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv mb kx ky kz ij bi translated">R-Markdown 与 Markdown 格式相同，但有一个额外的优势，即您可以从它制作值得发布的 pdf/word-doc(和其他格式)。因此，如果你的笔记本存储为<code class="fe la lb lc ld b">.Rmd</code>格式，你不仅可以控制它，还可以将其转换为纸质出版格式。</p><p id="e651" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">更多关于 R-Markdown 的信息可以在<a class="ae mc" href="https://bookdown.org/yihui/rmarkdown/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。此外，如果您打算使用 R-Markdown 编写一本书，请检查 R <a class="ae mc" href="https://bookdown.org/yihui/bookdown/" rel="noopener ugc nofollow" target="_blank"> bookdown </a>包。它允许你用 markdown+code+outputs 写一本书。</p><h2 id="0ffb" class="le lf iq bd lg lh li dn lj lk ll dp lm kn ln lo lp kr lq lr ls kv lt lu lv lw bi translated">以多种格式保存的方法</h2><ul class=""><li id="5978" class="md me iq ke b kf lx kj ly kn mf kr mg kv mh kz mi mj mk ml bi translated"><a class="ae mc" rel="noopener" target="_blank" href="/version-control-for-jupyter-notebook-3e6cef13392d">小钩</a>和<a class="ae mc" href="https://gist.github.com/pbugnion/ea2797393033b54674af" rel="noopener ugc nofollow" target="_blank">大钩</a></li><li id="544b" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">Jupytext 并另存为<code class="fe la lb lc ld b">.Rmd</code></li></ul><p id="08d2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mr">尽管第一种方法更容易设置，为什么我们选择 Jupytext？</em></p><p id="0933" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第一种方法只是将它保存为代码，而 Jupytext 将其保存为 readme，因此它在 github 中可以很好地呈现，并保持文档完整。</p><h1 id="86db" class="ms lf iq bd lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf ng nh lv ni bi translated">安装和设置 Jupytext</h1><p id="2fdd" class="pw-post-body-paragraph kc kd iq ke b kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv mb kx ky kz ij bi translated">您需要在将 git repo 用于笔记本的所有系统上执行此操作。这意味着你所有的队友都必须配置 jupytext。</p><p id="1886" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们使用 Jupytext 库(<a class="ae mc" href="https://github.com/mwouts/jupytext" rel="noopener ugc nofollow" target="_blank">https://github.com/mwouts/jupytext</a>)</p><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="37e8" class="le lf iq ld b gy nr ns l nt nu">pip install jupytext --upgrade</span></pre><ul class=""><li id="057a" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">接下来用<code class="fe la lb lc ld b">jupyter notebook --generate-config</code>生成一个 Jupyter 配置，如果你还没有的话</li><li id="7530" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">编辑<code class="fe la lb lc ld b">.jupyter/jupyter_notebook_config.py</code>并添加以下内容:</li></ul><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="dd08" class="le lf iq ld b gy nr ns l nt nu">c.NotebookApp.contents_manager_class="jupytext.TextFileContentsManager"<br/>c.ContentsManager.default_jupytext_formats = ".ipynb,.Rmd"</span></pre><ul class=""><li id="c251" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">并重启 Jupyter，即运行</li></ul><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="9de5" class="le lf iq ld b gy nr ns l nt nu">jupyter notebook</span></pre><p id="8095" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">注</strong> : <code class="fe la lb lc ld b">.jupyter</code>大多出现在你的主目录里。</p><ul class=""><li id="fb2a" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">打开现有笔记本或创建新笔记本。</li><li id="4235" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">禁用 Jupyter 的自动保存以进行往返编辑，只需在顶部单元格中添加以下内容并执行。</li></ul><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="fbba" class="le lf iq ld b gy nr ns l nt nu">%autosave 0</span></pre><ul class=""><li id="10dc" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">您可以在 Jupyter 和文本编辑器中编辑<code class="fe la lb lc ld b">.Rmd</code>文件，这可以用于检查版本控制更改。</li></ul><h1 id="0c18" class="ms lf iq bd lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf ng nh lv ni bi translated">可能的 Git 工作流(2 种方式)</h1><h2 id="89da" class="le lf iq bd lg lh li dn lj lk ll dp lm kn ln lo lp kr lq lr ls kv lt lu lv lw bi translated">1.仅保存 Rmd 文件</h2><p id="c737" class="pw-post-body-paragraph kc kd iq ke b kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv mb kx ky kz ij bi translated">我们将删除<code class="fe la lb lc ld b">.ipynb</code>文件并对<code class="fe la lb lc ld b">.Rmd</code>文件做一个小的修改。</p><p id="e76b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe la lb lc ld b">ipynb</code>文件的所有输出都在它们的 json 源中，因此当这些输出存储在源代码管理中时，即使实际变化很小，也会在 diff 中增加巨大的变化。此外，他们有所有的图像/情节编码为字符串，所以它是沉重的源代码控制。因此，您只需要将 Rmd 文件签入源代码控制中。</p><p id="d436" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要在你的<code class="fe la lb lc ld b">.gitignore</code>文件中做到这一点，在新的一行中添加下面一行。</p><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="ccda" class="le lf iq ld b gy nr ns l nt nu">*.ipynb</span></pre><p id="a92f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mr">注意:</em>你的所有队友也需要这样做，这样他们才不会将<code class="fe la lb lc ld b">ipynb</code>文件提交到 git 中。</p><p id="d3b0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您已经签入了<code class="fe la lb lc ld b">ipynb</code>文件，那么在签入<code class="fe la lb lc ld b">.Rmd</code>文件后，从源代码管理中删除它们。从 gitrepo 而不是本地目录中删除文件(<a class="ae mc" href="https://stackoverflow.com/questions/2047465/how-can-i-delete-a-file-from-git-repo" rel="noopener ugc nofollow" target="_blank">请参阅此处的</a>)</p><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="f6e9" class="le lf iq ld b gy nr ns l nt nu">git rm --cached file1.ipynb<br/>git commit -m "remove file1.ipynb"</span></pre><p id="d3db" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来我们对<code class="fe la lb lc ld b">.Rmd</code>文件做一个小的修改。</p><ul class=""><li id="c667" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">打开<code class="fe la lb lc ld b">vi</code>中的<code class="fe la lb lc ld b">.Rmd</code>文件</li><li id="7f07" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">在以<code class="fe la lb lc ld b">jupytext_formats: ...</code>开头的行，修改为:</li></ul><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="c992" class="le lf iq ld b gy nr ns l nt nu">jupytext_formats: ipynb,Rmd:rmarkdown</span></pre><ul class=""><li id="b9ab" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">保存文件并退出<code class="fe la lb lc ld b">vi</code></li></ul><p id="7b83" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mr">注意:</em>第一次创建<code class="fe la lb lc ld b">.Rmd</code>文件并推送至 git remote 时，对该文件的修改只需要一次。</p><p id="4bc0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">克隆回购并创建笔记本</strong></p><p id="ca30" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦您删除了<code class="fe la lb lc ld b">ipynb</code>笔记本，当您克隆回购时，您就要创建笔记本。让我们看看怎么做。</p><ul class=""><li id="0755" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">从文件浏览器打开 jupyter 中的<code class="fe la lb lc ld b">.Rmd</code>文件。</li><li id="718f" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">您可以直接使用<code class="fe la lb lc ld b">.Rmd</code>文件，但是它不会在会话之间保持输出，所以我们将创建一个 jupyter 笔记本。</li><li id="b725" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">点击<code class="fe la lb lc ld b">File-&gt;Save</code> (Cmd/Ctrl+S)。</li><li id="9491" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">关闭<code class="fe la lb lc ld b">.Rmd</code>文件(<code class="fe la lb lc ld b"><em class="mr">File-&gt;Close and Halt</em></code>)</li><li id="02fe" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">现在打开 Jupyter 的<code class="fe la lb lc ld b">ipynb</code>。</li><li id="dfa5" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">开始编辑和保存。您的<code class="fe la lb lc ld b">.Rmd</code>文件将不断更新。</li></ul><h2 id="5d47" class="le lf iq bd lg lh li dn lj lk ll dp lm kn ln lo lp kr lq lr ls kv lt lu lv lw bi translated">2.保存 Rmd 和 Ipynb 文件</h2><p id="e6ee" class="pw-post-body-paragraph kc kd iq ke b kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv mb kx ky kz ij bi translated">不要将<code class="fe la lb lc ld b">.ipynb</code>添加到您的<code class="fe la lb lc ld b">.gitignore</code>中。</p><p id="1ea2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对<code class="fe la lb lc ld b">.Rmd</code>文件做一个小改动。</p><ul class=""><li id="493b" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">在<code class="fe la lb lc ld b">vi</code>中打开<code class="fe la lb lc ld b">.Rmd</code>文件</li><li id="4236" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">在以<code class="fe la lb lc ld b">jupytext_formats: ...</code>开头的行上，将其改为:</li></ul><pre class="nj nk nl nm gt nn ld no np aw nq bi"><span id="7601" class="le lf iq ld b gy nr ns l nt nu">jupytext_formats: ipynb,Rmd:rmarkdown</span></pre><ul class=""><li id="3edf" class="md me iq ke b kf kg kj kk kn nv kr nw kv nx kz mi mj mk ml bi translated">保存文件并退出<code class="fe la lb lc ld b">vi</code></li></ul><p id="ca44" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mr">注意:</em>对<code class="fe la lb lc ld b">.Rmd</code>文件的更改只需要在您创建它并第一次将其推送到 git remote 时进行一次。</p><p id="f1f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在此工作流程中，由于您保存了这两个文件，因此在克隆时不需要做任何额外的工作，因此<code class="fe la lb lc ld b">.ipynb</code>已经可用，因此只需在克隆回购后开始使用它。</p><p id="30b8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">记得将<code class="fe la lb lc ld b"> %autosave 0</code>放入笔记本的第一个单元格，并一直运行它。因为你已经禁用了自动保存，所以记得经常保存你的笔记本。</p><h1 id="9fb7" class="ms lf iq bd lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf ng nh lv ni bi translated">更新</h1><ul class=""><li id="d1cc" class="md me iq ke b kf lx kj ly kn mf kr mg kv mh kz mi mj mk ml bi translated">也可以只使用<code class="fe la lb lc ld b">.Rmd</code>格式。基本上不用<code class="fe la lb lc ld b">.ipynb</code>用<code class="fe la lb lc ld b">.Rmd</code>。将<code class="fe la lb lc ld b">.Rmd</code>签入 git 进行版本控制。这样做的缺点是，当你登录 git 时，你的图/结果等将被删除，因为<code class="fe la lb lc ld b">.Rmd</code>是纯文本格式。任何下载你的笔记本的人都必须运行代码才能看到图形/结果。</li></ul><h1 id="3159" class="ms lf iq bd lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf ng nh lv ni bi translated">参考</h1><div class="ny nz gp gr oa ob"><a href="https://github.com/mwouts/jupytext" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">mwouts/jupytext</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">Jupyter 笔记本作为 Markdown 文档，Julia，Python 或 R 脚本</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op jw ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/version-control-for-jupyter-notebook-3e6cef13392d"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">Jupyter 笔记本的版本控制</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">Jonathan Whitmore 撰写的 Jupyter 笔记本数据科学最佳实践非常有用，我一直…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div></div></a></div></div></div>    
</body>
</html>