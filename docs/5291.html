<html>
<head>
<title>Using LDA to Build a Missing Yelp Feature</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 LDA 构建缺失的 Yelp 特征</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-lda-to-build-a-missing-yelp-feature-43436e575d65?source=collection_archive---------9-----------------------#2018-10-09">https://towardsdatascience.com/using-lda-to-build-a-missing-yelp-feature-43436e575d65?source=collection_archive---------9-----------------------#2018-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="171e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你曾经在旧金山的金融区外出喝酒，你可能会偶然发现<a class="ae kl" href="https://www.yelp.com/biz/mikkeller-bar-san-francisco" rel="noopener ugc nofollow" target="_blank"> Mikkeller 酒吧</a>。这家丹麦啤酒馆是下班后和朋友一起去的好地方，这里的气氛非常活跃，足以进行精彩的交谈。有着丰富的名单和选择，这是我想经常去喝酒的地方。</p><p id="15d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果我在 Yelp 上搜索 Mikkeller，我不仅会得到酒吧本身，还会得到该地区类似简介的酒吧，如果我想尝试一个有类似氛围的地方，这很好。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/799e3c40c439b9b6cebb96dfe6e9e534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpN8wr8Wuya4IexZKEgwvg.png"/></div></div></figure><p id="c132" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，当您在不同的位置搜索时，这种类型的搜索不会转换。例如，如果我试图搜索芝加哥的 Mikkeller 酒吧:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ky"><img src="../Images/12c0797cc1dc5e7be4a78ca39f5b7d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*geqit1X6Toy_o-HisM3yvQ.png"/></div></div></figure><p id="79d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然通过搜索特定的关键字(如 beer hall 或腹肌)可能会得到类似的结果，但我觉得应该实现更具体的搜索方法。为什么 Yelp 没有一个功能可以让用户在他们喜欢的栏上输入内容，然后在用户选择的位置上扩展搜索？这种搜索方法也能够捕捉到不太明显的方面，如环境。因此，我决定在我的第四个<a class="ae kl" href="https://www.thisismetis.com/" rel="noopener ugc nofollow" target="_blank"> Metis </a>项目中，我将使用无监督学习和 NLP 技术来构建这个功能。</p><h1 id="a77b" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">数据</h1><h2 id="f92c" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">数据来源:</h2><p id="d3d1" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">为了这个项目，我最终从<a class="ae kl" href="https://www.yelp.com/dataset/challenge" rel="noopener ugc nofollow" target="_blank"> Yelp 挑战数据集</a>中获得了我的数据。Yelp 提供了一个公开的数据集，这是一个无价的资源，因为 Yelp 的 TOS 是非常反网络抓取的。该数据集本身非常庞大，因为有超过 600 万条针对 800，000 多家不同企业的评论，分布在美国和加拿大的 10 多个不同的大都市地区。如此多的地理多样性是我的项目的额外收获，因为我希望它是位置不可知的。Yelp 的数据存储在。json 格式，所以我使用本地 MongoDB 实例查询和过滤数据。回想起来。json 文件非常大(评论文本 JSON 为 4.72 GB)，如果我将所有内容都转移到一个大内存 AWS 实例中，那么这个项目的数据分析会更加高效。我的 Macbook Air 的 8 GB 内存不足以在不微观管理计算机资源的情况下对数据进行分析。</p><h2 id="a28f" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">数据过滤:</h2><p id="59c5" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">将我的数据加载到 MongoDB 后，我进行数据处理的第一步是只过滤酒吧的企业列表。我的第一个方法(使用<a class="ae kl" href="https://api.mongodb.com/python/current/" rel="noopener ugc nofollow" target="_blank"> pymongo </a>)是执行一个正则表达式，匹配其类别类型中包含“bar”的任何业务。“酒吧”还必须有至少 50 个评论，以便有足够的文本数据进行推断:</p><pre class="kn ko kp kq gt mo mp mq mr aw ms bi"><span id="cecc" class="lx la iq mp b gy mt mu l mv mw"># Create subset of business that contain bars in question<br/>db.business.aggregate([<br/>     {"$match": {'categories': {'$regex': 'Bars'}}},<br/>     {"$match": {"review_count": {"$gte": 50}}},<br/>     {"$out": "bars"}]);</span></pre><p id="9ec4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法最终将搜索的企业数量从 180，000+减少到 5000+。然而，我很快意识到的一个怪癖是，regex 方法不仅捕获酒吧或体育酒吧等酒吧类型，还捕获寿司店。我最终变得更加严格，编写了两个函数来返回一个只包含特定类别(在本例中为“酒吧”)的企业:</p><pre class="kn ko kp kq gt mo mp mq mr aw ms bi"><span id="4eff" class="lx la iq mp b gy mt mu l mv mw">def check_for_cat(categories, cat_type):<br/>    """<br/>    Returns whether business is a given type, returns a boolean<br/>    """<br/>    # splits input category list from json file<br/>    categories_list = categories.split(',')<br/>    # loop through each category to see if it is equal to cat_type<br/>    for category in categories_list:<br/>        # lowercase the category &amp; strip any extra spaces<br/>        mod_cat = category.strip().lower()<br/>        if mod_cat == cat_type:<br/>            return True<br/><br/>    return False<br/><br/>def filter_yelplist(locations, cat_type):<br/>    """<br/>    Function that returns list of filtered yelp locations<br/>    """<br/>    return [loc for loc in locations<br/>            if check_for_cat(loc['categories'], cat_type) == True]</span></pre><p id="f2a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种额外的过滤给了我大约 4000+条。</p><p id="0471" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我必须将每个酒吧的评论加入酒吧列表。通常在 SQL 数据库中，这可以通过一个简单 join 命令来完成。然而，MongoDB 有一个 NoSQL 数据库结构，所以我不能这样做(我用$lookup 命令做了实验)。我最终编写了以下查询来获取相关数据:</p><pre class="kn ko kp kq gt mo mp mq mr aw ms bi"><span id="b159" class="lx la iq mp b gy mt mu l mv mw"># Create subset of reviews that contain the bar ids<br/>locations = list(db.bars.find({}, {'_id': 0, 'business_id': 1, 'categories': 1}))<br/>filtered_bars = filter_yelplist(locations, 'bars')<br/>allbar_ids = [i['business_id'] for i in filtered_bars]</span><span id="689f" class="lx la iq mp b gy mx mu l mv mw">db.reviews.aggregate([<br/>   {'$match': {'business_id': {'$in': allbar_ids}}},<br/>   {"$out": "bar_reviews"}]);</span></pre><p id="418e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在所有的数据处理之后，我最终得到了一个包含 4000 多个棒线的数据子集，每个棒线至少有 50 条评论。总共有 800，000 多条评论可供我分析。</p><h2 id="0850" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">文本处理</h2><p id="d240" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在过滤了数据之后，我仍然需要处理评论文本本身，然后将它传递给分词器。我做了三件事:</p><ol class=""><li id="8f11" class="my mz iq jp b jq jr ju jv jy na kc nb kg nc kk nd ne nf ng bi translated">使用正则表达式删除数字和标点符号</li><li id="9dcc" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated">将所有大小写类型转换为小写</li><li id="ee5f" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated">将所有单词词条化</li></ol><p id="a4d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://en.wikipedia.org/wiki/Lemmatisation" rel="noopener ugc nofollow" target="_blank">词汇化</a>很重要，因为我不想让模型包含同一个单词的不同形式。词汇化完成这个任务是因为它返回单词的词汇或“词典形式”，所以给定单词的复数和分词形式被替换为基本形式。例如，“行走”的引理会是“行走”，而“更好”的引理会是“好”。</p><h1 id="023c" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">特征工程</h1><p id="e526" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">我觉得酒吧的氛围非常重要，因此我在用户评论中使用了 NLP 来捕捉这种氛围。在尝试了不同的令牌矢量化工具和降维技术之后，我最终使用了计数矢量化和潜在狄利克雷分配(LDA)的组合来给我最大的可解释性。</p><h2 id="fcde" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">…向量化…</h2><p id="3140" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在执行矢量化的过程中，我需要从评论文本中生成一个相关的标记列表。虽然 NLTK 提供了要排除的英语停用词的基本集合，但是在主题生成中还需要排除一些额外的标记。最终出现在排除列表中的令牌类型分为两类:与位置相关的和与食物相关的。为了使模型不可知位置，排除了与位置相关的标记，同时排除了与食物相关的标记，以便主题集中在饮料和环境上。就矢量器的类型而言，CountVectorizer 模型最终比 TFIDF 的性能更好。我相信 CountVectorizer 比 TFIDF 表现得更好，因为描述一个酒吧的重要词(如啤酒、音乐、饮料)会重复出现，CountVectorizer 最终会促进重复，而 TFIDF 则会惩罚它。</p><h2 id="0299" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">主题建模</h2><p id="fd55" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">通过使用 LDA，我能够执行主题建模并生成 9 个主题，我认为这些主题代表了我的数据集中不同类型的条形:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nm"><img src="../Images/1e76049cd2aeb4cc345ec7c83ff2dec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57lQVgkfhBErCK9uQsPf4w.png"/></div></div></figure><p id="8685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中两个酒吧原型最终成为最具描述性的(户外和早午餐)，因为大多数酒吧最终都被这两个主题所描述。这可以通过这两个主题如何映射到 TSNE 图来证明:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nn"><img src="../Images/e3107990d9439f3bcf705e778a70ceb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lxv8uGiMhF_pM4NOZtCrxw.png"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi no"><img src="../Images/31c3549805cd2842ea9a4f6a69dba3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h7KM_WVP97W5okEoVH1Y2w.png"/></div></div></figure><p id="aa1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其余的 7 个主题最终变得更加具体，因为它们通常描述了数据集中的几个条形。举例来说，街机和视频游戏酒吧最终被映射到我的 TSNE 情节如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/9899b41b0e20da08fe84357ca740e22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96obJ2H9WfZiLVO7ORCuoQ.png"/></div></div></figure><h2 id="6a32" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">分类特征</h2><p id="8182" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">除了 NLP 生成的特征之外，模型中还添加了一些有价值的分类特征。Yelp 数据集实际上包含许多分类特征:例如，一个地方是否适合跳舞，或者他们是否有电视可用。然而，我决定不利用这些特性，因为我想通过主题建模来确定这些特性的代理。因此，我最终直接从数据集中提取的唯一分类特征是企业的价格范围。</p><p id="c9af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然主题建模让我了解了酒吧的氛围，但我也希望我的模型关注酒吧的主要酒精类型。为了做到这一点，我决定在评论中放大某些关键词的存在。例如，对于每个小节，我检测到标记“威士忌”被提及的次数。将该计数除以总评论数，我得到了一个比例，它表明了一个给定的酒吧有多少是威士忌酒吧。我最终在关键词上创建了这些存在类型分类特征:威士忌、伏特加、啤酒、葡萄酒、龙舌兰酒、朗姆酒、烈酒、杜松子酒、白兰地、烧酒、苹果酒和清酒。</p><h1 id="ae8d" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">推荐引擎</h1><h2 id="93f9" class="lx la iq bd lb ly lz dn lf ma mb dp lj jy mc md ln kc me mf lr kg mg mh lv mi bi translated">给出建议</h2><p id="2737" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">随着要素的建立，我创建了一个管道来为我的数据集中的每个条生成要素。通过将输入条形图的<a class="ae kl" href="https://alan-j-lin.github.io/2018/08/24/project-fletcher/www.google.com/cosine_similarity" rel="noopener ugc nofollow" target="_blank">余弦相似度</a>与数据集中的所有其他条形图进行比较，给出了一个建议。如果有多个条形图作为输入，则使用输入条形图平均矢量的余弦相似度。这种相似性比较形成了我的推荐引擎的基础。基于数据集，以下是一些可能的建议:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nq"><img src="../Images/ce1d0ab46533808d5569c0fc96eebfb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVmLtSVCNbTI_EjUOOiIwQ.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Some recommendations if you are the TGIF’s type of person</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nv"><img src="../Images/744b18a489727e8445c311b31d07f833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLfwyUkxmCOMRlqq8_qvCQ.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">If you are interested in Irish pubs there appears to be plenty of options</figcaption></figure><p id="7b6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该推荐引擎随后通过 dashboard 应用程序和交互式 Tableau 仪表板部署在 Heroku 上，如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8011768b6408607b2a93e640fda68e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*WquHC2wB6GADXH8g-1hcdQ.gif"/></div></figure><p id="9c67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想自己尝试一些建议，您可以在这里访问应用程序<a class="ae kl" href="https://radiant-sea-47344.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="6c3d" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">未来的工作</h1><p id="b092" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">如果给我更多的时间来扩展这个项目，我会做一些改进:</p><ul class=""><li id="2e02" class="my mz iq jp b jq jr ju jv jy na kc nb kg nc kk nx ne nf ng bi translated"><strong class="jp ir">更多相关数据</strong>:当前的数据集不包括旧金山或纽约州等主要都会区的酒吧位置，我认为这将有助于创建更相关的建议</li><li id="253f" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nx ne nf ng bi translated"><strong class="jp ir">链接交互图形</strong>:如果这个功能真的是通过 Yelp 或者类似的服务部署的，我觉得交互图形会是一个很大的卖点。因此，我希望链接 Tableau 仪表盘和 dashboard 界面，以便对最终用户进行更大程度的控制。</li></ul><p id="e4f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解更多关于这个项目的信息，你可以在我的<a class="ae kl" href="https://github.com/alan-j-lin/new_yelp_feature" rel="noopener ugc nofollow" target="_blank"> Github repo </a>找到代码和数据。</p></div></div>    
</body>
</html>