<html>
<head>
<title>Time Left To Live — Modeling Life Expectancy and Prototyping it on the Web with Flask and PythonAnywhere</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">剩余寿命——使用 Flask 和 PythonAnywhere 在 Web 上模拟预期寿命并制作原型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-left-to-live-modeling-life-expectancy-and-prototyping-it-on-the-web-with-flask-and-68e3a8fa0fe4?source=collection_archive---------9-----------------------#2018-07-26">https://towardsdatascience.com/time-left-to-live-modeling-life-expectancy-and-prototyping-it-on-the-web-with-flask-and-68e3a8fa0fe4?source=collection_archive---------9-----------------------#2018-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/78d368c591a48200d95db6e90737462d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMBwJjoyJFOJHJy3xZF67g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: Lucas Amunategui</figcaption></figure><p id="2206" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对预期寿命建模显然属于统计学领域，但当你以互动和教育的形式将它扩展到互联网时，它就变成了应用数据科学。在本演练中，我们将把一个简单的线性回归模型与 Flask web 应用程序联系起来，实质上是将一个等式转换成一个交互式工具，整个世界都可以从中进行游戏和学习。</p><p id="f391" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们谈谈预期寿命。虽然我认为这个话题是一个重要的认知工具，但我先向那些觉得它令人沮丧的人道歉。它和那些互动银行工具一起提醒你，你还没有多少钱可以退休。</p><p id="6ec7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将使用 PythonAnywhere.com 的<a class="ae lb" href="https://www.pythonanywhere.com/" rel="noopener ugc nofollow" target="_blank">来安装这个模型，这是一个易于使用的免费实验网络服务平台。我们还将使用有趣的图形和简单的语言，以确保它切中要点，引人入胜。你可以在 TimeLeftToLive.com</a><a class="ae lb" href="http://www.timelefttolive.com/" rel="noopener ugc nofollow" target="_blank">的</a>查看完成版。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/70bda3e10b7886808aff4576e38599bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKgcm_Ckjw_vZB8DETUgJA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Traditional output versus fun &amp; Interactive</figcaption></figure><p id="7ef2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个令人惊讶的简单模型，使用顶级统计学家收集的可靠数据来构建。两个最重要的消息来源是世界卫生组织(世卫组织)和中央情报局。这里我们将使用<a class="ae lb" href="http://www.who.int/gho/en/" rel="noopener ugc nofollow" target="_blank">世界卫生组织(世卫组织)全球健康观察站的数据</a>。</p><h1 id="14dc" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">死亡率数据</h1><p id="78c2" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">我们将使用“出生时的预期寿命(岁)”和“60 岁时的预期寿命(岁)”的综合数据集。这将为我们的线性回归提供两个点，我们可以很容易地从中提取任何其他年龄。还是那句话，对此不能全信！这些只是平均水平，预期寿命每天都在提高！从世卫组织网站:</p><blockquote class="mk ml mm"><p id="8ba5" class="kc kd la ke b kf kg kh ki kj kk kl km mn ko kp kq mo ks kt ku mp kw kx ky kz ij bi translated"><strong class="ke ir"/></p><p id="2873" class="kc kd la ke b kf kg kh ki kj kk kl km mn ko kp kq mo ks kt ku mp kw kx ky kz ij bi translated"><strong class="ke ir"/></p></blockquote><h1 id="5f8a" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">简单线性回归和预测预期寿命</h1><blockquote class="mk ml mm"><p id="ec64" class="kc kd la ke b kf kg kh ki kj kk kl km mn ko kp kq mo ks kt ku mp kw kx ky kz ij bi translated"><em class="iq">线性回归模型试图用直线来解释两个或多个变量之间的关系。</em> <a class="ae lb" href="http://reliawiki.org/index.php/Simple_Linear_Regression_Analysis" rel="noopener ugc nofollow" target="_blank"> ReliaSoft 的实验设计和分析参考</a></p></blockquote><p id="acb2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将使用<a class="ae lb" href="https://docs.scipy.org/doc/scipy/reference/tutorial/stats.html" rel="noopener ugc nofollow" target="_blank"> scipy.stats 包</a>进行线性回归。让我们看一个简单的例子来说明如何使用线性回归进行预测。我们创建了两个预期寿命的虚拟数据集，一个是新生儿的，另一个是 60 岁的:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="bf48" class="mv li iq mr b gy mw mx l my mz">import pandas as pd<br/>import matplotlib.pyplot as plt</span><span id="eca5" class="mv li iq mr b gy na mx l my mz"># create fictitious data set <br/>simple_life_dataset = pd.DataFrame({'Age':[0, 60], 'Life Expectancy':[90, 30]})<br/>simple_life_dataset.head()</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/49919a83da4a2871554dab8c0053ae6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/0*XXmhuhTnkvhv3ONK.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Life expectancy at 0 and 60 years old</figcaption></figure><p id="7689" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们将这些数据输入到<strong class="ke ir">stats . Lin regressive</strong>函数中。我们将只使用它的两个输出，斜率<strong class="ke ir">和截距</strong>。这两个值和 y = mx+b 的直线方程，将为我们提供估算任何年龄预期寿命所需的一切。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="47e3" class="mv li iq mr b gy mw mx l my mz">import numpy as np<br/>from scipy import stats<br/>slope, intercept, r_value, p_value, std_err = stats.linregress(simple_life_dataset['Age'],simple_life_dataset['Life Expectancy'])<br/>print('intercept: ', intercept)<br/>print('slope: ', slope)</span><span id="ae6f" class="mv li iq mr b gy na mx l my mz">('intercept: ', 90.0)<br/>('slope: ', -1.0)</span></pre><p id="504e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么，根据我们虚构的数据，一个 20 岁的人还能活多少年？我们将 stats . Lin regressive 的输出应用于<a class="ae lb" href="https://www.mathsisfun.com/equation_of_line.html" rel="noopener ugc nofollow" target="_blank"> y = mx+b </a>线方程:</p><p id="b137" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">预期寿命估计值=斜率*年龄+截距</strong></p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="0fd5" class="mv li iq mr b gy mw mx l my mz">np.ceil(slope * 20 + intercept)</span><span id="5115" class="mv li iq mr b gy na mx l my mz">70.0</span></pre><p id="088d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们还有 70 年的寿命。如果我们把虚构的数据集和新的估计值一起画出来:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="a7c9" class="mv li iq mr b gy mw mx l my mz">fig, axes = plt.subplots(figsize=(5,5))<br/>x = [0,20,60]<br/>y = [90, 70, 30]<br/>axes.plot(x,y, color='blue', linestyle='--', marker='o')<br/>fig.suptitle('Life Expectancy')<br/>axes.set_xlabel('age')<br/>axes.set_xlim([-5,100])<br/>axes.set_ylabel('life_expectancy')<br/>axes.set_ylim([0,100])<br/>plt.show()</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/2d76d4b6a1baeb34aab4ec6cfeb07f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*suppNOhWLI4-cAGU.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">The linear relationship between age and life expectancy according to our fictitious data</figcaption></figure><h1 id="0c65" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">世卫组织死亡率数据</h1><p id="3535" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">我们下载真实数据保存到本地吧。然后，让我们进行与上面完全相同的练习:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="5d89" class="mv li iq mr b gy mw mx l my mz"># load WHO longevity data<br/># http://apps.who.int/gho/data/node.main.688<br/>who_list = pd.read_csv('http://apps.who.int/gho/athena/data/GHO/WHOSIS_000001,WHOSIS_000015?filter=COUNTRY:*&amp;x-sideaxis=COUNTRY;YEAR&amp;x-topaxis=GHO;SEX&amp;profile=verbose&amp;format=csv')</span><span id="14a0" class="mv li iq mr b gy na mx l my mz"># save a local copy of the data set for our Flask prototype later on<br/>who_list.to_csv('WHOSIS_000001,WHOSIS_000015.csv')<br/>        <br/># Keep only useful features fix case display of country text<br/>who_list = who_list[['GHO (DISPLAY)', 'YEAR (CODE)' , 'COUNTRY (DISPLAY)', 'SEX (DISPLAY)', 'Numeric']]<br/>who_list['COUNTRY (DISPLAY)'] = [ctry.title() for ctry in who_list['COUNTRY (DISPLAY)'].values]</span><span id="c4c9" class="mv li iq mr b gy na mx l my mz"># print a few rows<br/>who_list[who_list['COUNTRY (DISPLAY)']=='France'].head(10)</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/8a2a077016db1e95d59ce30891475f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VsA-uDF8x2K91XEB.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><code class="fe ne nf ng mr b">WHO longevity data for France</code></figcaption></figure><p id="7dd1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我是一个 49 岁的美国人，让我们预测一下我还能活多少年(yikes！).首先让我们看看数据，这真的很有趣。根据最新数据，美国新生儿男性的预期寿命是 77 岁，而根据最新数据，美国 60 岁男性的预期寿命是 22 岁，总共是 82 岁，给出了什么？这是统计学的复杂性之一，对一个 60 岁的人取平均值意味着这个人已经活了 60 年，这被称为<a class="ae lb" href="https://en.wikipedia.org/wiki/Survivorship_bias" rel="noopener ugc nofollow" target="_blank">生存偏差</a>。这对于我们来说意味着，这个模型对于接近于 0 的人来说有点悲观，对于接近于 60 的人来说有点乐观。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="058b" class="mv li iq mr b gy mw mx l my mz">country = 'United States Of America'<br/>sex = 'Male'</span><span id="4f00" class="mv li iq mr b gy na mx l my mz"># pull latest entries for birth and 60 years for a country and gender<br/>sub_set = who_list[who_list['COUNTRY (DISPLAY)'].str.startswith(country, na=False)]<br/>sub_set = sub_set[sub_set['SEX (DISPLAY)'] == sex]</span><span id="5b43" class="mv li iq mr b gy na mx l my mz"># sort by year in descending order to work with the latest read<br/>sub_set = sub_set.sort_values('YEAR (CODE)', ascending=False)<br/>sub_set_birth = sub_set[sub_set['GHO (DISPLAY)'] == 'Life expectancy at birth (years)'] <br/>sub_set_60 = sub_set[sub_set['GHO (DISPLAY)'] == 'Life expectancy at age 60 (years)'] </span><span id="b8fe" class="mv li iq mr b gy na mx l my mz">print('sub_set_birth:')<br/>print(sub_set_birth.head(5))<br/>print('sub_set_60:')<br/>print(sub_set_60.head(5))</span><span id="96f7" class="mv li iq mr b gy na mx l my mz">sub_set_birth:</span><span id="e876" class="mv li iq mr b gy na mx l my mz">                          GHO (DISPLAY)  YEAR (CODE)  \<br/>16046  Life expectancy at birth (years)         2015   <br/>17532  Life expectancy at birth (years)         2014   <br/>15326  Life expectancy at birth (years)         2013   <br/>12318  Life expectancy at birth (years)         2012   <br/>17531  Life expectancy at birth (years)         2011   </span><span id="d32e" class="mv li iq mr b gy na mx l my mz">              COUNTRY (DISPLAY) SEX (DISPLAY)   Numeric  <br/>16046  United States Of America          Male  76.93852  <br/>17532  United States Of America          Male  76.76836  <br/>15326  United States Of America          Male  76.45519  <br/>12318  United States Of America          Male  76.43168  <br/>17531  United States Of America          Male  76.29261  </span><span id="c76b" class="mv li iq mr b gy na mx l my mz">sub_set_60:</span><span id="b813" class="mv li iq mr b gy na mx l my mz">                           GHO (DISPLAY)  YEAR (CODE)  \<br/>7481   Life expectancy at age 60 (years)         2015   <br/>7900   Life expectancy at age 60 (years)         2014   <br/>9935   Life expectancy at age 60 (years)         2013   <br/>16044  Life expectancy at age 60 (years)         2012   <br/>16211  Life expectancy at age 60 (years)         2011   </span><span id="b05f" class="mv li iq mr b gy na mx l my mz">              COUNTRY (DISPLAY) SEX (DISPLAY)   Numeric  <br/>7481   United States Of America          Male  22.07029  <br/>7900   United States Of America          Male  21.95811  <br/>9935   United States Of America          Male  21.72074  <br/>16044  United States Of America          Male  21.72548  <br/>16211  United States Of America          Male  21.61596</span></pre><p id="9179" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们从世卫组织数据集中提取两个最新的数据点，并绘制出来:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="da23" class="mv li iq mr b gy mw mx l my mz"># create data set with both points as shown in first example<br/>lf_at_birth = sub_set_birth['Numeric'].values[0]<br/>lf_at_60 = sub_set_60['Numeric'].values[0]</span><span id="676a" class="mv li iq mr b gy na mx l my mz"># let's organize our data and plot<br/>age = [0,60]<br/>life_expectancy = [lf_at_birth, lf_at_60]</span><span id="dd7c" class="mv li iq mr b gy na mx l my mz">fig, axes = plt.subplots(figsize=(5,5))<br/>x = age<br/>y = life_expectancy<br/>axes.plot(x,y, color='blue', linestyle='--', marker='o')<br/>fig.suptitle('Life Expectancy')<br/>axes.set_xlabel('age')<br/>axes.set_xlim([-5,100])<br/>axes.set_ylabel('life expectancy')<br/>axes.set_ylim([0,100])<br/>plt.show()</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/9f1132dc3813f8759283373bf1db77d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mMNBBEFa1VYsCwMe.png"/></div></div></figure><p id="a231" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，让我们估计一下我的预期寿命:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="5d88" class="mv li iq mr b gy mw mx l my mz"># model <br/>slope, intercept, r_value, p_value, std_err = stats.linregress(age, life_expectancy)<br/>print('intercept: ', intercept)<br/>print('slope: ', slope)<br/><br/># predict life expectancy for an 49-year-old male in the USA:<br/>np.ceil(slope * 49 + intercept)</span><span id="3750" class="mv li iq mr b gy na mx l my mz">('intercept: ', 76.938519999999997)<br/>('slope: ', -0.91447049999999985)<br/>33.0</span></pre><p id="854c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">还有 33 年，最好让它们有价值！现在，让我们将上述所有代码封装到一个函数中，这样我们就可以很容易地用其他参数预测其他年龄(当我们将其移植到 Flask 时，这将使我们的生活变得容易得多)。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="5d65" class="mv li iq mr b gy mw mx l my mz">def get_life_expectancy(age, country, sex):<br/>    # pull latest entries for birth and 60 years<br/>    sub_set = who_list[who_list['COUNTRY (DISPLAY)'].str.startswith(country, na=False)]<br/>    sub_set = sub_set[sub_set['SEX (DISPLAY)'] == sex]<br/>    sub_set = sub_set.sort_values('YEAR (CODE)', ascending=False)<br/>    sub_set_birth = sub_set[sub_set['GHO (DISPLAY)'] == 'Life expectancy at birth (years)'] <br/>    sub_set_60 = sub_set[sub_set['GHO (DISPLAY)'] == 'Life expectancy at age 60 (years)'] <br/><br/>    # not all combinations exsits so check that we have data for both<br/>    if len(sub_set_birth['Numeric']) &gt; 0 and len(sub_set_60['Numeric']) &gt; 0:<br/>        # create data set with both points as shown in first example<br/>        lf_at_birth = sub_set_birth['Numeric'].values[0]<br/>        lf_at_60 = sub_set_60['Numeric'].values[0]<br/><br/>        # model <br/>        slope, intercept, r_value, p_value, std_err = stats.linregress([0,60],[lf_at_birth, lf_at_60])<br/><br/>        # predict for the age variable<br/>        return(np.ceil(slope * age + intercept))<br/>    else:<br/>        return None</span></pre><p id="f579" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们做一个快速测试:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="4ae3" class="mv li iq mr b gy mw mx l my mz"># test the function out using a 22-year-old Japanese female:<br/>get_life_expectancy(22, 'Japan', 'Female')</span><span id="4e8e" class="mv li iq mr b gy na mx l my mz">66.0</span></pre><p id="a418" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">66 岁的生活听起来是对的。</p><h1 id="31e4" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">使用 Flask 和 Pythonanywhere 构建我们的模型原型</h1><p id="ab5d" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated"><a class="ae lb" href="https://www.pythonanywhere.com/" rel="noopener ugc nofollow" target="_blank">PythonAnywhere.com</a>是一个在互联网上快速原型化你的 Python 交互式想法和模型的好方法。在 PythonAnywhere.com<a class="ae lb" href="https://www.pythonanywhere.com/" rel="noopener ugc nofollow" target="_blank">注册一个免费账户——你需要一个有效的电子邮件地址。</a></p><h1 id="af4c" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">设置 Flask Web 框架</h1><p id="bd5c" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">接下来，让我们用 Flask web 服务平台在 PythonAnywhere 上创建一个 web 服务器。这是非常容易做到的。在'<strong class="ke ir"> Web </strong>选项卡下，点击'<strong class="ke ir">添加新的 web app </strong>蓝色按钮。并接受默认设置，直到您到达“<strong class="ke ir">选择一个 Python Web 框架</strong>”并点击“<strong class="ke ir"> Flask </strong>”，然后是最新的 Python 框架。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/1816a2892132650c924b7f1918795c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_-zMBt2RBzuwAvwl.png"/></div></div></figure><p id="da76" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您将进入登录配置页面，点击绿色的“<strong class="ke ir">重新加载您的 account.pythonanywhere.com</strong>”按钮，并使用您的新 URL 进行一次旋转:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/5ffb0ca3db57a286d4f999b1b937add6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*75vfa3zrfdGjcd72.png"/></div></div></figure><p id="6a11" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您应该看到一个简单但真实的网页，带有来自 Flask 的'<strong class="ke ir"> Hello！</strong>消息:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/73b421de70f37e2f5794290386e31965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-xA0WdBWntr21DvP.png"/></div></div></figure><h1 id="13f4" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">上传预期寿命网页代码</h1><p id="339e" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">现在我们需要用我们的预期寿命代码替换 Flask 通用框架代码。点击“<strong class="ke ir">文件</strong>选项卡，在您的 root 帐户下创建一个名为“<strong class="ke ir">life _ expectations</strong>的新文件夹。在该文件夹中，上传我们之前下载并保存的'<strong class="ke ir"> WHOSIS_000001，WHOSIS_000015.csv </strong>'数据。创建一个名为'<strong class="ke ir"> flask_app.py </strong>的 Python 文件，并在下面粘贴' flask_app.py '代码。</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="ea7e" class="mv li iq mr b gy mw mx l my mz">from flask import Flask, render_template, request, url_for<br/>import pandas as pd<br/>import numpy as np<br/>from scipy import stats<br/>import logging<br/>import datetime<br/>import os.path<br/>from flask import Markup</span><span id="8c23" class="mv li iq mr b gy na mx l my mz">app = Flask(__name__)<br/>app.config["DEBUG"] = True</span><span id="331b" class="mv li iq mr b gy na mx l my mz"># constructor - load once (otherwise setup a local csv copy to save on bandwidth usage)<br/>BASE_DIR = os.path.dirname(os.path.abspath(__file__))<br/>app.logger.error(BASE_DIR)<br/>src = os.path.join(BASE_DIR, 'WHOSIS_000001,WHOSIS_000015.csv')<br/>who_list = pd.read_csv(src)<br/>who_list = who_list[['GHO (DISPLAY)', 'YEAR (CODE)' , 'COUNTRY (DISPLAY)', 'SEX (DISPLAY)', 'Numeric']]<br/>who_list['COUNTRY (DISPLAY)'] = [ctry.title() for ctry in who_list['COUNTRY (DISPLAY)'].values]<br/>country_list = sorted(set(who_list['COUNTRY (DISPLAY)'].values))</span><span id="b7d7" class="mv li iq mr b gy na mx l my mz">def get_life_expectancy(age, country, sex):<br/>    # pull latest entries for birth and 60 years<br/>    sub_set = who_list[who_list['COUNTRY (DISPLAY)'].str.startswith(country, na=False)]<br/>    sub_set = sub_set[sub_set['SEX (DISPLAY)'] == sex]<br/>    sub_set = sub_set.sort_values('YEAR (CODE)', ascending=False)<br/>    sub_set_birth = sub_set[sub_set['GHO (DISPLAY)'] == 'Life expectancy at birth (years)']<br/>    sub_set_60 = sub_set[sub_set['GHO (DISPLAY)'] == 'Life expectancy at age 60 (years)']</span><span id="86a5" class="mv li iq mr b gy na mx l my mz">    # not all combinations exsits so check that we have data for both<br/>    if len(sub_set_birth['Numeric']) &gt; 0 and len(sub_set_birth['Numeric']) &gt; 0:<br/>        # create data set with both points as shown in first example<br/>        lf_at_birth = sub_set_birth['Numeric'].values[0]<br/>        lf_at_60 = sub_set_60['Numeric'].values[0]</span><span id="c528" class="mv li iq mr b gy na mx l my mz">        # model <br/>        slope, intercept, r_value, p_value, std_err = stats.linregress([0,60],[lf_at_birth, lf_at_60])</span><span id="4c27" class="mv li iq mr b gy na mx l my mz">        # predict for the age variable<br/>        return(np.ceil(islope * age + intercept))<br/>    else:<br/>        return None</span><span id="2297" class="mv li iq mr b gy na mx l my mz">@app.route('/', methods=['POST', 'GET'])<br/>def interact_life_expectancy():<br/>    # select box defaults<br/>    default_age = 'Select Age'<br/>    selected_age = default_age<br/>    default_sex = 'Select Gender'<br/>    selected_sex = default_sex<br/>    default_country = 'Select Country'<br/>    selected_country = default_country</span><span id="6192" class="mv li iq mr b gy na mx l my mz">    # data carriers<br/>    string_to_print = ''<br/>    healthy_image_list = []</span><span id="1ddf" class="mv li iq mr b gy na mx l my mz">    if request.method == 'POST':<br/>        # clean up age field<br/>        selected_age = request.form["age"]<br/>        if (selected_age == default_age):<br/>            selected_age = int(29)<br/>        else:<br/>            selected_age = selected_age</span><span id="9af8" class="mv li iq mr b gy na mx l my mz">        # clean up sex field<br/>        selected_sex = request.form["sex"]<br/>        if (selected_sex == default_sex):<br/>            selected_sex = 'Both sexes'</span><span id="ac8a" class="mv li iq mr b gy na mx l my mz">        # clean up country field<br/>        selected_country = request.form["country"]<br/>        if (selected_country == default_country):<br/>            selected_country = 'United States Of America'</span><span id="a59f" class="mv li iq mr b gy na mx l my mz">        # estimate lifespan<br/>        current_time_left = get_life_expectancy(age=int(selected_age), country=selected_country, sex=selected_sex)<br/>        <br/>        if (current_time_left is not None):<br/>            # create output string<br/>            string_to_print = Markup("You have &lt;font size='+10'&gt;" + str(int(np.ceil(current_time_left))) + "&lt;/font&gt; healthy years left to live!")<br/>        else:<br/>            string_to_print = Markup("Error! No data found for selected parameters")<br/>            current_time_left = 1</span><span id="8844" class="mv li iq mr b gy na mx l my mz">        # healthy years<br/>        healthy_image_list = []<br/>        # squat.png, stretch.png, jog.png<br/>        healthy_years_left = int(np.ceil(current_time_left))<br/>        image_switch=0<br/>        if (healthy_years_left &gt; 0):<br/>            for y in range(healthy_years_left):<br/>                if image_switch == 0:<br/>                    healthy_image_list.append('static/images/Cycling.png')<br/>                elif image_switch == 1:<br/>                    healthy_image_list.append('static/images/Jogging.png')<br/>                elif image_switch == 2:<br/>                    healthy_image_list.append('static/images/JumpingJack.png')<br/>                elif image_switch == 3:<br/>                    healthy_image_list.append('static/images/Stretching.png')<br/>                elif image_switch == 4:<br/>                    healthy_image_list.append('static/images/WeightLifting.png')<br/>                else:<br/>                    healthy_image_list.append('static/images/Yoga.png')<br/>                    image_switch = -1<br/>                image_switch += 1</span><span id="72dd" class="mv li iq mr b gy na mx l my mz">    return render_template('main_page.html',<br/>                            country_list = country_list,<br/>                            default_country = selected_country,<br/>                            default_age=selected_age,<br/>                            default_sex=selected_sex,<br/>                            string_to_print = string_to_print,<br/>                            healthy_image_list = healthy_image_list)</span></pre><p id="5f18" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您的'<strong class="ke ir">life _ expectation</strong>'文件夹应该如下所示:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/55f76822a84c6ac6671df5756ceb5c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JhO1NxkGzQdse-D8.png"/></div></div></figure><p id="9259" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">仍然在'<strong class="ke ir">life _ expectations</strong>下创建另一个名为'<strong class="ke ir"> static </strong>的文件夹，并在其下创建另一个名为'<strong class="ke ir"> images </strong>的文件夹，并上传以下六个运动图标(不幸的是，您一次只能上传一个):</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/90019ad1d0497702b700e78d206d60b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:80/format:webp/0*iMvUC_TR2L9mE9SL.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/2d9723f92d33987942ccbf0ab724daa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:80/format:webp/0*9KCX4eIoaTknU4Vl.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/37c17680256272c2d0ca7844cf1980ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:80/format:webp/0*Nxf0k1mNUtoAWxwU.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b75fc49b5f2b0db99354076e0daf13b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:80/format:webp/0*_ukJZpitJGDcqcKg.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/0c0d7212706117984dfc0031bbca9e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:80/format:webp/0*F1ht4IUwpW4Qtr3F.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/3f025aee2ba7a9e37120c12ffba4990b.png" data-original-src="https://miro.medium.com/v2/resize:fit:80/format:webp/0*2LQFjfxopJkZR4GT.png"/></div></figure><p id="5a92" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您的“图像”文件夹应该如下所示:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/12d016af6bee8c911c5719c7f6668160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-aLD0e7t_hGY2Osi.png"/></div></div></figure><p id="a12e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">返回到'<strong class="ke ir">life _ expectations</strong>文件夹，创建'<strong class="ke ir">模板</strong>文件夹。Templates 文件夹将存储我们的 HTML 模板，Flask 将使用这些模板动态显示我们的内容。在“<strong class="ke ir">模板</strong>文件夹下，创建一个名为“<strong class="ke ir"> main_page.html </strong>的文件，粘贴以下动态 html 代码:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="3552" class="mv li iq mr b gy mw mx l my mz">&lt;!DOCTYPE html&gt;<br/>&lt;HTML lang="en"&gt;<br/>&lt;HEAD&gt;<br/>  &lt;TITLE&gt;TimeLeftToLive.com&lt;/TITLE&gt;<br/>  &lt;META charset="utf-8"&gt;<br/>  &lt;META name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"&gt;<br/>  &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"&gt;&lt;/script&gt;<br/>  &lt;script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"&gt;&lt;/script&gt;<br/>&lt;/HEAD&gt;<br/>&lt;BODY&gt;<br/>&lt;DIV class="container"&gt;<br/>  &lt;DIV class="row"&gt;<br/>    &lt;H2&gt;&lt;a href='http://www.TimeLeftToLive.com' target='_blank'&gt;TimeLeftToLive.com&lt;/a&gt;&lt;/H2&gt;<br/>    &lt;H4&gt;More Data Science and Machine Learning Articles at &lt;a href='http://amunategui.github.io' target='_blank'&gt;amunategui.github.io&lt;/a&gt;&lt;/H4&gt;&lt;BR&gt;</span><span id="d6a4" class="mv li iq mr b gy na mx l my mz">    &lt;FORM id='submit_params' method="POST" action=""&gt;</span><span id="deb7" class="mv li iq mr b gy na mx l my mz">      &lt;SELECT class="selectpicker" name="sex"&gt;<br/>          &lt;option value="" selected&gt;&lt;/option&gt;<br/>          &lt;option&gt;Both sexes&lt;/option&gt;<br/>          &lt;option&gt;Female&lt;/option&gt;<br/>          &lt;option&gt;Male&lt;/option&gt;<br/>      &lt;/SELECT&gt;</span><span id="ae48" class="mv li iq mr b gy na mx l my mz">&lt;SELECT class="selectpicker" name="age"&gt;<br/>                    &lt;option value="{{default_age}}" selected&gt;{{default_age}}&lt;/option&gt;<br/>                   {% for age in range(1,100) %}<br/>                       &lt;option value="{{age}}"&gt;{{age}}&lt;/option&gt;<br/>                   {% endfor %}<br/>                  &lt;/SELECT&gt;</span><span id="99c5" class="mv li iq mr b gy na mx l my mz">&lt;SELECT class="selectpicker"  name="country"&gt;<br/>            &lt;option value="{{default_country}}" selected&gt;{{default_country}}&lt;/option&gt;<br/>            {% for country in country_list %}<br/>              &lt;option value="{{country}}"&gt;{{country}}&lt;/option&gt;<br/>            {% endfor %}<br/>          &lt;/SELECT&gt;</span><span id="c151" class="mv li iq mr b gy na mx l my mz">       &lt;button type="submit" class="btn btn-primary"&gt;Show me&lt;/button&gt;<br/>       &lt;button type="button" class="btn btn-primary" onclick="location.href='/';" value="Reset"&gt;Reset&lt;/button&gt;</span><span id="a5ab" class="mv li iq mr b gy na mx l my mz">&lt;/FORM&gt;<br/>&lt;BR&gt;<br/>&lt;H2&gt;{{string_to_print}}&lt;/H2&gt;<br/>&lt;BR&gt;<br/>&lt;TABLE&gt;<br/>&lt;TR&gt;<br/>{% for imag in healthy_image_list %}<br/>  {% if loop.index == 21 or loop.index == 41 or loop.index == 61 or loop.index == 81 %}<br/>    &lt;/TR&gt;&lt;TR&gt;<br/>  {% endif %}<br/>  &lt;td&gt;&lt;img src={{imag}} width="40" height="40"&gt;&lt;/td&gt;</span><span id="3463" class="mv li iq mr b gy na mx l my mz">{% endfor %}</span><span id="8a14" class="mv li iq mr b gy na mx l my mz">&lt;/TR&gt;<br/>&lt;/TABLE&gt;<br/>&lt;/BODY&gt;<br/>&lt;/HTML&gt;</span></pre><p id="4b68" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您的'<strong class="ke ir">模板</strong>'文件夹应该如下所示:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/a38fbd2d16a79e3fbbe5adb9d92808e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A_YGWAWILl2MWExv.png"/></div></div></figure><h1 id="730a" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">虚拟文件刷新</h1><p id="3543" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">返回到'<strong class="ke ir"> Web </strong>选项卡，将'<strong class="ke ir">源代码</strong>从:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="01bd" class="mv li iq mr b gy mw mx l my mz">/home/manuelamunategui/mysite/</span></pre><p id="c561" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">到</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="dac9" class="mv li iq mr b gy mw mx l my mz">/home/manuelamunategui/life_expectancy/</span></pre><p id="4198" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">点击下面几行的'<strong class="ke ir">/var/www/manuelamnategui _ python anywhere _ com _ wsgi . py</strong>'链接，编辑下面一行代码:</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="6873" class="mv li iq mr b gy mw mx l my mz">project_home = u'/home/manuelamunategui/mysite'</span></pre><p id="93a7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">到</p><pre class="ld le lf lg gt mq mr ms mt aw mu bi"><span id="a771" class="mv li iq mr b gy mw mx l my mz">project_home = u'/home/manuelamunategui/life_expectancy'</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/df5ad873cc0f33e85bf5bc97f7f4a124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1HvTgDta_tvM6kws.png"/></div></div></figure><p id="4f16" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">点击绿色的“<strong class="ke ir">重新加载你的 account.pythonanywhere.com</strong>”按钮，带着你的新网址和交互式网络应用去兜风吧！</p><h1 id="a81e" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">恭喜你！</h1><p id="b022" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">在那里！恭喜那些走到这一步的人！并利用这些简单的工具和技术来展示您的 Python 想法！</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/55ec3d1111342882b299e4103f92b12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWP2hIUGLNncGxRzn459Gw.png"/></div></div></figure><p id="0f09" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">感谢阅读！</p><p id="1e72" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">曼努埃尔·阿穆纳特吉</p><p id="2b67" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">免费电子书《成为数据科学家——赞美你的技术研究的基本技巧》的作者</p><p id="52ae" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在<a class="ae lb" href="http://amunategui.github.io/" rel="noopener ugc nofollow" target="_blank"> amunategui.github.io </a>获取更多信息</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="nl nm l"/></div></figure></div></div>    
</body>
</html>