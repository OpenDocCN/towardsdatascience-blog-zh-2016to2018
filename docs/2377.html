<html>
<head>
<title>Augmentation for Image Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于图像分类的增强</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/augmentation-for-image-classification-24ffcbc38833?source=collection_archive---------2-----------------------#2018-01-18">https://towardsdatascience.com/augmentation-for-image-classification-24ffcbc38833?source=collection_archive---------2-----------------------#2018-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">分类图像时面临的问题？不要烦恼！增援来了。！</em></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/32e634ab1833c3fa25f17885cee750fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ye8R6HmWad7ttaCkFpVHhQ.jpeg"/></div></div></figure><p id="f692" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在处理图像数据时遇到的一个问题是图像的不一致性(有些图像太大或太小，有些是矩形而不是正方形，等等)。另一个经常面临的问题是训练集中图像的数量，这经常导致过度拟合。为了处理这些问题，我概述了一种使用增强变换的技术——对训练集中的图像进行变换，以提高模型识别图像不同版本的能力。这增加了模型拥有的信息的广度。它现在变得更适合于从不同对比度、大小、不同角度等图像中识别目标对象。</p><p id="f088" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了展示增强是如何工作的，我们查看了<a class="ae lb" href="http://files.fast.ai/data/dogscats.zip" rel="noopener ugc nofollow" target="_blank">狗对猫数据集</a>，并利用了深度学习库<a class="ae lb" href="https://github.com/fastai/fastai.git" rel="noopener ugc nofollow" target="_blank"> fast.ai </a>，该库由杰瑞米·霍华德和雷切尔·托马斯创建，基于 PyTorch 构建。本帖灵感来源于 fast.ai 深度学习 part 1 v2。</p><h2 id="f519" class="lc ld it bd le lf lg dn lh li lj dp lk kb ll lm ln kf lo lp lq kj lr ls lt lu bi translated"><strong class="ak">一、基准模型</strong></h2><p id="6ab2" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn im bi translated">为了将图像分类为狗或猫，我们使用 resnet34 来训练模型(在 Apil Tamang 撰写的这个令人敬畏的<a class="ae lb" href="https://medium.com/@apiltamang/yet-another-resnet-tutorial-or-not-f6dd9515fcd7" rel="noopener">博客</a>中有更多关于 resnet 架构的内容！).我们首先使用学习率 0.03 和 1 个历元来训练没有数据扩充的模型。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">The baseline model</figcaption></figure><p id="a1cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由此我们可以看到<code class="fe mi mj mk ml b">0.98584.</code>的验证准确性</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mm"><img src="../Images/0ffb4dd8a0e566fcecc540996b9f22d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXZrPb6Th3sU1OidA36TJQ.png"/></div></div></figure><p id="7583" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有一个混乱矩阵:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mn"><img src="../Images/12016ef45ebdfcd1071fd58102359bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OwXtAi3Z163davMa8mSItQ.png"/></div></div></figure><p id="0a58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我们看到 26 张图片——2000 张图片中的 20 只猫和 6 只狗被错误分类。</p><h2 id="9c4c" class="lc ld it bd le lf lg dn lh li lj dp lk kb ll lm ln kf lo lp lq kj lr ls lt lu bi translated"><strong class="ak">二。应用增强变换</strong></h2><p id="ad80" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn im bi translated">为了减少这种分类错误，我们现在增加训练数据，看看是否有改进。我们既可以从自顶向下的转换中选择，也可以从侧面转换中选择。下面快速浏览一下这些类型所涉及的内容:</p><ol class=""><li id="56f6" class="mo mp it js b jt ju jx jy kb mq kf mr kj ms kn mt mu mv mw bi translated">基本变换—角度(旋转)和光照的变化</li><li id="a12b" class="mo mp it js b jt mx jx my kb mz kf na kj nb kn mt mu mv mw bi translated">侧面变换—角度和光照的变化+围绕垂直轴翻转</li><li id="a560" class="mo mp it js b jt mx jx my kb mz kf na kj nb kn mt mu mv mw bi translated">自上而下的变换—角度和光照的变化+围绕水平轴翻转并旋转 90、180、270 度。</li></ol><p id="ed7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们使用侧面变换，因为我们有从侧面拍摄的狗和猫的图片(与从上面拍摄的相反)，它们可能需要水平翻转，而不是垂直翻转。下面是猫图像上的 6 种随机侧面变换:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nc"><img src="../Images/a9d189de8ee504731dab5a16300416cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9p3pS6Z_e4_QnjIybgadKQ.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Side-on transformations</figcaption></figure><p id="ef9d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于图像的性质，自上而下的变换在这里并不合适——猫或狗的颠倒图像很少见！</p><p id="a62e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在训练该网络时，学习速率保持不变，以便观察仅由于增强而导致的准确度差异。当我们使用增强来训练网络时，对于每个时期，生成每个图像的新变换。因此，该模型在每个时期看到相同数量的图像(与原始训练数据中的数量一样多)，尽管每次都是这些图像的新版本。因此，模型看到的图像范围随着每个时期而增加。</p><p id="be87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ResNets 之类的网络是预先训练的，也就是说，除了完全连接的层之外，该架构为每一层都预先计算了一组权重。在之前训练模型时，我们使用了 ResNet34 预先计算的权重。但是这一次，由于我们使用了新的训练图像集，我们设置了<code class="fe mi mj mk ml b">Precompute = False</code>来确保模型从头开始计算新模型的激活。如果不这样做，我们将仍然使用对应于原始训练数据的预计算激活，不会给我们带来太多的准确性改进。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Training the network with the transformed images</figcaption></figure><p id="03b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们得到了一个验证精度<code class="fe mi mj mk ml b">0.98779</code>,这是对以前模型的一个改进。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nd"><img src="../Images/37929f98adf85f8396d2b8fb228e42cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nUnfp9rX5cd7Jj5xRIxGYw.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/d86efba21c8f54805190333eae697b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-A1rsAVhWZkbeIgrGSoKg.png"/></div></div></figure><p id="2412" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从上面的混淆矩阵中，我们看到这次我们错分了 22 张图片；与以前相比错误的减少。因此，我们提高了模型的预测能力。</p><h2 id="7ae8" class="lc ld it bd le lf lg dn lh li lj dp lk kb ll lm ln kf lo lp lq kj lr ls lt lu bi translated"><strong class="ak">三。测试时间增加</strong></h2><p id="1de6" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn im bi translated">虽然增强技术有助于给我们一个更好的模型，但预测准确性可以通过所谓的测试时间增强(TTA)来进一步提高。为了理解为什么需要这样做，让我们先来看看一些分类错误的图片:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nf"><img src="../Images/a46763f194589faf017e0f361f9f062f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rd0C0A5qWKXQbBJ4BQ-7HQ.png"/></div></div></figure><p id="05dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在这里看到，由于对比度差，图像是矩形而不是正方形，或者因为狗/猫在图像中的比例很小，一些图像被错误分类。例如，看一看狗的矩形图像。当模型尝试预测此图像时，它只看到图像的中心(默认情况下裁剪为中心)。因此，它无法预测图像是狗还是猫。</p><p id="8447" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了减少这样的错误，我们使用 TTA，其中我们预测原始测试图像以及同一图像的 4 个随机变换的类别。然后，我们取预测的平均值来确定图像属于哪一类。</p><blockquote class="ng nh ni"><p id="b76f" class="jq jr ko js b jt ju jv jw jx jy jz ka nj kc kd ke nk kg kh ki nl kk kl km kn im bi translated">这背后的直觉是，即使测试图像不太容易做出预测，变换也会改变它，使得模型有更高的机会捕捉狗/猫的形状并相应地进行预测。</p></blockquote><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="7b60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用 TTA，我们现在只需要 16 张错误分类的图片就可以得到一个<code class="fe mi mj mk ml b">99.199</code>的验证精度。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nm"><img src="../Images/aafa77d61d5e47dc06ebda7acd3926d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPHHGZLBsxmLpYTj_lCWlA.png"/></div></div></figure><h2 id="128d" class="lc ld it bd le lf lg dn lh li lj dp lk kb ll lm ln kf lo lp lq kj lr ls lt lu bi translated"><strong class="ak">结论</strong></h2><p id="6b31" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn im bi translated">虽然基线 ResNet34 模型很好地拟合了数据，给出了非常好的结果，但是应用增强变换和 TTA 减少了错误分类错误，提高了模型的准确性。我们在这里讨论的只是基本的增强技术，如翻转和旋转，但是 GANs 也可以用来生成不同风格的图像，正如本文中所建议的。这可能会更有效。</p><p id="d5c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了对图像进行增强之外，看看如何将增强应用于结构化数据以提高性能也是很有趣的，就像它在非结构化数据中所做的那样！让我知道你对此的想法！！</p><h2 id="2fb4" class="lc ld it bd le lf lg dn lh li lj dp lk kb ll lm ln kf lo lp lq kj lr ls lt lu bi translated">参考</h2><ol class=""><li id="3bf3" class="mo mp it js b jt lv jx lw kb nn kf no kj np kn mt mu mv mw bi translated"><a class="ae lb" href="https://github.com/neerjad/DeepLearning/blob/master/ImageAugmentation-Copy1.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub 回购换代码</a></li><li id="eb8f" class="mo mp it js b jt mx jx my kb mz kf na kj nb kn mt mu mv mw bi translated"><a class="ae lb" href="http://course.fast.ai/" rel="noopener ugc nofollow" target="_blank">程序员实用深度学习，第一部分，作者杰瑞米·霍华德</a></li><li id="fff8" class="mo mp it js b jt mx jx my kb mz kf na kj nb kn mt mu mv mw bi translated"><a class="ae lb" href="https://arxiv.org/pdf/1712.04621.pdf" rel="noopener ugc nofollow" target="_blank">王凯峰 Luis Perez 利用深度学习在图像分类中增加数据的有效性</a></li></ol><p id="80f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">关于我:</strong>我毕业于 USF 大学数据科学专业，本科学习计算机科学，在构建预测和推荐算法以及为金融和零售客户提供商业见解方面有 2 年的经验。我对将我的机器学习和深度学习知识应用于现实世界问题的机会感到兴奋。请点击这里查看我的其他博客<a class="ae lb" href="https://medium.com/@neerja.doshi" rel="noopener">！<br/> <strong class="js iu">领英:</strong></a><a class="ae lb" href="https://www.linkedin.com/in/neerja-doshi/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">https://www.linkedin.com/in/neerja-doshi/</strong></a></p></div></div>    
</body>
</html>