<html>
<head>
<title>YOLOv2 object detection using Darkflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用暗流的 YOLOv2 对象检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/yolov2-object-detection-using-darkflow-83db6aa5cf5f?source=collection_archive---------1-----------------------#2018-07-02">https://towardsdatascience.com/yolov2-object-detection-using-darkflow-83db6aa5cf5f?source=collection_archive---------1-----------------------#2018-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dd576754b31933ad0bae0bacbf1ba5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQVt2KwhU-iQ3QN6vD2e2Q.png"/></div></div></figure><p id="bda6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个故事介绍了如何检测物体。如果您计划构建一个受益于对象检测的应用程序，这将很有帮助。幕后使用 YOLOv2 算法。不过我用的是开源实现，“<a class="ae kw" href="https://github.com/thtrieu/darkflow" rel="noopener ugc nofollow" target="_blank"> Darkflow </a>”，所以不需要担心细节。</p><p id="752b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简而言之，执行对象检测需要 4 个步骤。还有一些更多的细节，所以如果你真的想使用我的代码，请访问<a class="ae kw" href="https://github.com/deep-diver/Object-Detection-YOLOv2-Darkflow" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx">我的 github 库</em> </strong> </a>了解这个故事。这是这个故事的朱庇特笔记本。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="6213" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">安装暗流</strong></h1><p id="d393" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">其实你可以访问<a class="ae kw" href="https://github.com/thtrieu/darkflow" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx"> Darkflow 的 github 资源库</em> </strong> </a>并探索安装指南。在这里，我将让指令尽可能简单。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4c8a" class="mr lg iq mn b gy ms mt l mu mv">$ pip install Cython<br/>$ git clone <a class="ae kw" href="https://github.com/thtrieu/darkflow.git" rel="noopener ugc nofollow" target="_blank">https://github.com/thtrieu/darkflow.git</a><br/>$ cd darkflow<br/>$ python3 setup.py build_ext --inplace<br/>$ pip install .</span></pre></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="d603" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">下载重量</strong></h1><p id="ff35" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">有两种方式下载预训练的重量。首先，你可以从<a class="ae kw" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank"><em class="kx">YOLO 项目官方网页</em> </a>下载。第二，你可以在这里<a class="ae kw" href="https://drive.google.com/drive/folders/0B1tW_VtY7onidEwyQ2FtQVplWEU" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx">下载</em> </strong> </a>哪个 Darkflow 作者自己训练的版本。我决定使用第二种方法，因为我正在使用暗流实现。如果你愿意，你可以试试第一种方法。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/655476a9e280130afa8721c9d54f6429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oqb5YHgpPdNKzTr_w-UVbw.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk">Red circle indicates the weight file you need to download</figcaption></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="32be" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">建立模型</strong></h1><p id="3aad" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">正如您在下面看到的，构建模型非常简单。首先，您需要定义选项对象。然后，您需要用选项实例化 TFNet 类对象。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f2fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">选项是模型及其环境的规范。下面的截图是您可以指定的完整列表。我将为这个故事使用<strong class="ka ir"> <em class="kx">【模型】【加载】【阈值】</em></strong><strong class="ka ir"><em class="kx">【GPU】</em></strong>选项。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/a1e5b577d05900f64a1a411f8091ae59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qeywbZCflz78Lv8MDJQBxQ.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk">Darkflow Model Options</figcaption></figure><p id="2aaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">型号选项</strong>要求您指定想要使用的型号。有预定义的模型，我这里用的是<strong class="ka ir"> <em class="kx"> yolo.cfg </em> </strong>。这个文件包含了模型架构的完整描述。</p><p id="658c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">加载选项</strong>用于指定您想要使用的权重文件。由于我建议从<a class="ae kw" href="https://drive.google.com/drive/folders/0B1tW_VtY7onidEwyQ2FtQVplWEU" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx">这里</em> </strong> </a>下载 yolo.weights，我指定了。如果您有自己的预训练权重文件，这是您让模型知道的地方(就像在您训练自定义对象之后，您的系统将产生特定的权重文件)。</p><p id="f6bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您的系统上有 gpu 时，使用<strong class="ka ir"> gpu 选项</strong>。这将提高预测任务的速度。</p><p id="4a06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">阈值选项</strong>是保留被检测对象的置信概率值的底线。我把它设置为 0.1，它似乎相当低。然而，我选择这个值来试验模型可以检测到多少个对象，并且我可以在以后进行过滤。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/02f906fd4191da282af5c220ccbfda9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVdp6Yg2WnC2aJk7mkB39g.png"/></div></div></figure><p id="b954" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">模型完全加载后，您将得到如上所示的输出。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="c03a" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">检测物体并在图片上绘制方框</strong></h1><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="72a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的一行代码是你检测物体所需要做的一切。唯一指定的参数是以 numpy 数组样式表示的图像。如果你打印出结果，你会看到下面显示的对象列表。每个键在对象中的含义看起来非常直观。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/049666b268db168e71752690d8aba79d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-bfsJVnlgKPtfcEc2TtIDQ.png"/></div></div></figure><p id="8462" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在下面定义了装箱函数，这样我也可以在图像和视频上重复使用。我使用 opencv-python 模块在图像上放置盒子和标签。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="d8da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用装箱功能，您可以显示如下结果图像。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2723" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者你也可以像 follow 一样在视频上执行相同的任务。</p><p id="3493" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">*请根据您的操作系统在此处检查支持的视频输出格式<a class="ae kw" href="https://docs.opencv.org/3.1.0/dd/d43/tutorial_py_video_display.html" rel="noopener ugc nofollow" target="_blank">，并将其设置在 cv2 上。VideoWriter_fourcc 函数。就我而言，我在 Windows 10 上测试过，所以我指定了*“DIVX”。</a></p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="48aa" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结果和评价</h1><p id="182e" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">以下是我实验过的一些结果。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/adc04a213aa29dbb03a8d02af93698b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wmY4gen_jnKgRTrnDzDGSQ.png"/></div></div></figure><p id="c36e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在各种图片上都好看。然而，我在第二张和第四张图片上看到了一些缺点。</p><p id="5e5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于第二张图片的情况，看起来 YOLO 人并不希望一只狗出现在图片中间。我想很多预先训练的照片都有狗在地上。</p><p id="6105" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">YOLO 实际上非常善于发现人。然而，对于第四张图片的情况，处于动态意外姿势的人看起来不容易被检测到。此外，当太多的对象重叠时，似乎很难检测到它们中的每一个。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="nh nc l"/></div></figure><p id="9a08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以看到这个视频类似的问题。YOLO 可能受过有人驾驶汽车的训练。对于这个视频，即使是一只狗被关在车里，算法也预测出这只狗是一个人。此外，后座被预测为具有高置信度的人。</p></div></div>    
</body>
</html>