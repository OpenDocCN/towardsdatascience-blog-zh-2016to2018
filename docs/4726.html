<html>
<head>
<title>How to Create Animated Graphs in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 创建动画图形</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-animated-graphs-in-python-bb619cc2dec1?source=collection_archive---------1-----------------------#2018-09-03">https://towardsdatascience.com/how-to-create-animated-graphs-in-python-bb619cc2dec1?source=collection_archive---------1-----------------------#2018-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/1f6f1a0de877440360de12e017c5bf49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/1*j0LxVQPbwtQDpL17TH9gZw.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Animation of Heroin Deaths in the USA. Created in Python using Seaborn.</figcaption></figure><p id="6108" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Matplotlib 和 Seaborn 是 Python 中一些很好的库，可以创建很棒的图形。但是这些图都是静态的，很难用一种动态的、令人愉悦的方式来描绘数据值的变化。如果在你的下一个演示文稿、视频或社交媒体帖子中，你可以使用一个简短的视频剪辑来展示数据中的发展，那该有多好？更好的是，你仍然可以继续使用 Matplotlib、Seaborn 或任何其他你喜欢用于绘图的库！</p><p id="4161" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我最近为一部关于美国阿片类药物危机的短纪录片制作了几个动态图，所以我将在这篇文章中使用其中的数据。这些数据由美国国家药物滥用研究所和疾病预防控制中心公开提供，可以在这里下载:<a class="ae kw" href="https://www.drugabuse.gov/sites/default/files/overdose_data_1999-2015.xls" rel="noopener ugc nofollow" target="_blank">https://www . Drug Abuse . gov/sites/default/files/dodoff _ data _ 1999-2015 . xls</a>。</p><p id="e4fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将使用 Matplotlib 和 Seaborn 一起绘图，使用 Numpy 和 Pandas 一起处理数据。对于动画，matplotlib 提供了一些我们可以使用的函数。因此，让我们继续导入所有依赖项。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="a553" class="lg lh iq lc b gy li lj l lk ll">import numpy as np<br/>import pandas as pd<br/>import seaborn as sns<br/>import matplotlib<br/>import matplotlib.pyplot as plt<br/>import matplotlib.animation as animation</span></pre><p id="01e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，为了准备动画数据，我们只需要加载它，并把它放入一个熊猫数据帧。当绘制关于不同阿片类药物过量的几个图时，还可以方便地编写一个函数，用于从您感兴趣的行加载数据。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="b001" class="lg lh iq lc b gy li lj l lk ll">overdoses = pd.read_excel('overdose_data_1999-2015.xls',sheetname='Online',skiprows =6)</span><span id="1ad9" class="lg lh iq lc b gy lm lj l lk ll">def get_data(table,rownum,title):<br/>    data = pd.DataFrame(table.loc[rownum][2:]).astype(float)<br/>    data.columns = {title}<br/>    return data</span></pre><p id="d386" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们开始制作动画吧！</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="a07a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，如果你像我一样使用 jupyter 笔记本，最好用一个<code class="fe lu lv lw lc b">%matplotlib notebook</code>开始这个单元，这样你就可以立即在你的笔记本上看到动画，而不只是在它被保存之后。</p><p id="e429" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的例子中，我现在使用<code class="fe lu lv lw lc b">get_data</code>函数从表中检索海洛因过量的数字，并将其打包到一个有两列的 Pandas 数据帧中。一个用于年份，另一个用于过量用药的计数。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="28c3" class="lg lh iq lc b gy li lj l lk ll">%matplotlib notebook<br/>title = 'Heroin Overdoses'<br/>d = get_data(overdoses,18,title)<br/>x = np.array(d.index)<br/>y = np.array(d['Heroin Overdoses'])<br/>overdose = pd.DataFrame(y,x)<br/>#XN,YN = augment(x,y,10)<br/>#augmented = pd.DataFrame(YN,XN)<br/>overdose.columns = {title}</span></pre><p id="b7e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们初始化一个 writer，它使用 ffmpeg 并以 20 fps 的比特率 1800 进行记录。你当然可以自己挑选这些值。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8d40" class="lg lh iq lc b gy li lj l lk ll">Writer = animation.writers['ffmpeg']<br/>writer = Writer(fps=20, metadata=dict(artist='Me'), bitrate=1800)</span></pre><p id="5f9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们用一些标签创建一个图形。确保设置 x 轴和 y 轴的限制，以便动画不会在当前显示的数据范围内跳跃。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c761" class="lg lh iq lc b gy li lj l lk ll">fig = plt.figure(figsize=(10,6))<br/>plt.xlim(1999, 2016)<br/>plt.ylim(np.min(overdose)[0], np.max(overdose)[0])<br/>plt.xlabel('Year',fontsize=20)<br/>plt.ylabel(title,fontsize=20)<br/>plt.title('Heroin Overdoses per Year',fontsize=20)</span></pre><p id="bdb0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">动画的核心部分是动画函数，在该函数中，您可以定义视频的每一帧中发生的事情。这里的<code class="fe lu lv lw lc b">i</code>代表动画中帧的索引。使用该索引，您可以选择在该框架中应该可见的数据范围。之后，我使用 seaborn lineplot 来绘制数据选择。最后两行只是为了让剧情看起来更赏心悦目一点。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="b52c" class="lg lh iq lc b gy li lj l lk ll">def animate(i):<br/>    data = overdose.iloc[:int(i+1)] #select data range<br/>    p = sns.lineplot(x=data.index, y=data[title], data=data, color="r")<br/>    p.tick_params(labelsize=17)<br/>    plt.setp(p.lines,linewidth=7)</span></pre><p id="f307" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe lu lv lw lc b">matplotlib.animation.FuncAnimation</code>启动动画，其中链接动画功能并定义动画应包含多少帧。因此，<code class="fe lu lv lw lc b">frames</code>定义了<code class="fe lu lv lw lc b">animate(i)</code>被调用的频率。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="52cc" class="lg lh iq lc b gy li lj l lk ll">ani = matplotlib.animation.FuncAnimation(fig, animate, frames=17, repeat=True)</span></pre><p id="ce6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将这个动画保存为 mp4，你可以简单地调用<code class="fe lu lv lw lc b">ani.save()</code>。如果你只是想在保存之前看一眼，那就打电话给<code class="fe lu lv lw lc b">plt.show()</code>吧。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="dcdd" class="lg lh iq lc b gy li lj l lk ll">ani.save('HeroinOverdosesJumpy.mp4', writer=writer)</span></pre><p id="91c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以现在动画看起来是这样的:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/8c4e005cba1afd1f1b4321d62f455eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fn7w6eHAoZHRWvcnLqnTuA.gif"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Heroin Overdose Animation — Jumpy</figcaption></figure><p id="7a3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它有点工作，但仍然很跳动。为了避免跳跃，我们需要更多的数据点在我们已经有的数据点之间。为此我们可以使用另一个函数，我在这里称之为<code class="fe lu lv lw lc b">augment</code>。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="bcaf" class="lg lh iq lc b gy li lj l lk ll">def augment(xold,yold,numsteps):<br/>    xnew = []<br/>    ynew = []<br/>    for i in range(len(xold)-1):<br/>        difX = xold[i+1]-xold[i]<br/>        stepsX = difX/numsteps<br/>        difY = yold[i+1]-yold[i]<br/>        stepsY = difY/numsteps<br/>        for s in range(numsteps):<br/>            xnew = np.append(xnew,xold[i]+s*stepsX)<br/>            ynew = np.append(ynew,yold[i]+s*stepsY)<br/>    return xnew,ynew</span></pre><p id="7c56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们只需要将这个函数应用于我们的数据，并在<code class="fe lu lv lw lc b">matplotlib.animation.FuncAnimation</code>函数中增加帧数。这里我用<code class="fe lu lv lw lc b">numsteps=10</code>调用 augment，这意味着我将我的训练数据增加到 160 个数据点，并且必须设置<code class="fe lu lv lw lc b">frames=160</code>。结果看起来更加平滑，但是在数据值改变的地方仍然有一些尖锐的边缘。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/49cc4a82927f2ff1ad2cec227740ad5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Czxqc9LCLesdzRkT0ptUpw.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Heroin Overdose Animation — Sharp Edges</figcaption></figure><p id="bc38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了消除这些问题，我们可以实现一个平滑函数，如下所述:<a class="ae kw" href="https://www.swharden.com/wp/2008-11-17-linear-data-smoothing-in-python/" rel="noopener ugc nofollow" target="_blank">https://www . SW harden . com/WP/2008-11-17-linear-data-smoothing-in-python/</a></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="3f56" class="lg lh iq lc b gy li lj l lk ll">def smoothListGaussian(listin,strippedXs=False,degree=5):  <br/>    window=degree*2-1  <br/>    weight=np.array([1.0]*window)  <br/>    weightGauss=[]  <br/>    for i in range(window):  <br/>        i=i-degree+1  <br/>        frac=i/float(window)  <br/>        gauss=1/(np.exp((4*(frac))**2))  <br/>        weightGauss.append(gauss)<br/>    weight=np.array(weightGauss)*weight  <br/>    smoothed=[0.0]*(len(listin)-window)  <br/>    for i in range(len(smoothed)):        smoothed[i]=sum(np.array(listin[i:i+window])*weight)/sum(weight)  <br/>    return smoothed</span></pre><p id="cd2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我们可以添加一些颜色和风格参数，使情节看起来更有个性。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="9f64" class="lg lh iq lc b gy li lj l lk ll">sns.set(rc={'axes.facecolor':'lightgrey', 'figure.facecolor':'lightgrey','figure.edgecolor':'black','axes.grid':False})</span></pre><p id="8255" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是我们如何获得上面显示的最终结果。</p><p id="90b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章仅仅展示了 matplotlib 动画函数的一个例子。当然，你可以用它来制作任何你想制作动画的情节。简单调整<code class="fe lu lv lw lc b">animate()</code>函数中的参数和绘图类型，可能性是无限的。</p><p id="7885" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望你会喜欢 matplotlib 的这个好功能，并能把它用在更好的地方！如果你想看看我为这部纪录片制作的所有图片并从中获得灵感，你可以在这里找到:<a class="ae kw" href="https://youtu.be/7xrvuSDLHiY" rel="noopener ugc nofollow" target="_blank">https://youtu.be/7xrvuSDLHiY</a></p></div></div>    
</body>
</html>