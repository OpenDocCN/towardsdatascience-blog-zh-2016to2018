<html>
<head>
<title>Precipitation with the InsightR R package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 InsightR R 包进行沉淀</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/precipitation-with-the-insightr-r-package-bdda409321ba?source=collection_archive---------2-----------------------#2017-06-16">https://towardsdatascience.com/precipitation-with-the-insightr-r-package-bdda409321ba?source=collection_archive---------2-----------------------#2017-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="13ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<a class="ae kl" href="https://wdtinc.com/skywise-home/insight-api/" rel="noopener ugc nofollow" target="_blank"> Insight API </a>的好处之一是数据的质量和分辨率。大多数气象 API 依赖于一个点观测系统。这意味着当你询问你所在地的天气时，你实际上可能得到的是 20 英里外某个地方的天气。这对于很多用例来说是好的，但是对于其他用例来说就很糟糕了。降水是这种方法失败的一个常见用例:相隔几英里的两个站点收到的总降雨量相差很大的情况并不少见。</p><p id="4b0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Insight API 建立在我们的 SkyWise 数据之上，而不是仅仅依赖于观察站点。这些数据是通过运行一个集成了观测站、卫星和雷达的 1 公里模型产生的。你可以在下图中看到它的好处。如果你依靠一个点观测系统，你可能在你的位置有大雨，而观测站什么也没有收到，反之亦然。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/71ee7c2787ed887eda21c2c6cff105bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zFIa5MLdinqdL59o3KF3Sw.png"/></div></div></figure><p id="4566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我一直在听新闻报道说俄克拉荷马州中部需要降雨，所以我决定借此机会做一个小项目。</p><p id="963b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定在 R 做这个项目作为学习练习。我的第一步是实际学习一些 r。我从<a class="ae kl" href="https://github.com/DASpringate/Rkoans" rel="noopener ugc nofollow" target="_blank"> Rkoans 项目</a>开始，并修复了所有的测试。在编写了一些示例代码之后，我认为一个包是合适的。我发现希拉里·帕克的这个<a class="ae kl" href="https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/" rel="noopener ugc nofollow" target="_blank">关于创建 R 包的很好的参考</a>。接下来我开始阅读 Hadley Wickham 的一些优秀教程，尤其是编写 API 包装器的最佳实践。<a class="ae kl" href="https://github.com/wdtinc/InsightR" rel="noopener ugc nofollow" target="_blank">完成</a>后，让我们看看如何用它来测量降水量。</p><p id="ba35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要安装软件包:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="5068" class="lf lg iq lb b gy lh li l lj lk">devtools::install_github('wdtinc/InsightR')</span></pre><p id="06c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">加载后，您需要存储您的认证凭证(<a class="ae kl" href="https://wdtinc.com/skywise-home/insight-api" rel="noopener ugc nofollow" target="_blank">免费演示注册</a>):</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="3ee5" class="lf lg iq lb b gy lh li l lj lk">Authenticate('your_app_id', 'your_app_key')</span></pre><p id="f498" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，只需调用包装函数:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="fd2a" class="lf lg iq lb b gy lh li l lj lk">dp &lt;- DailyPrecipitation(35.235762, -97.428966, "2017-05-01", "2017-06-13")</span></pre><p id="9d08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设一切顺利，我们就可以得到总降雨量并绘制数据:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="5b81" class="lf lg iq lb b gy lh li l lj lk">&gt; dp$response$status_code == 200<br/>[1] TRUE<br/>&gt; x &lt;- as.Date(dp$content$series[[1]], "%Y-%m-%d")<br/>&gt; y &lt;- dp$content$series[[3]]<br/>&gt; sum(y)<br/>[1] 39.44<br/>&gt; plot(x,y, xlab="date", ylab="precip in mm")</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/a27a8f538373b2873710b7c6d096b9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*9qeSDVkEa0SyuGXFqT992w.png"/></div></figure><p id="f5cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们与几英里外的一个地点进行比较:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="1e9b" class="lf lg iq lb b gy lh li l lj lk">&gt; dp &lt;- DailyPrecipitation(35.183235, -97.437611, "2017-05-01", "2017-06-13")<br/>&gt; x &lt;- as.Date(dp$content$series[[1]], "%Y-%m-%d")<br/>&gt; y &lt;- dp$content$series[[3]]<br/>&gt; sum(y)<br/>[1] 77.19</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/b0ef9c14f48805e1107a9d026280a945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*3rWIiUk-ZadTyKGt-pR7XQ.png"/></div></figure><p id="64c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">77.19mm vs 39.44mm 就差几里！</p><p id="91b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在一开始对 R 的语法有点反感之后，我发现自己真的很喜欢写 R 代码。尤其是 RStudio。包装器有点不完整:它缺少文档和测试，并且它目前不支持 Insight API 的“资产”特性，该特性允许您检索字段级轮廓。也就是说，基本级别的功能已经存在，希望有些人会发现它很有用。</p></div></div>    
</body>
</html>