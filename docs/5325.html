<html>
<head>
<title>Dates in Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tableau 中的日期</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dates-in-tableau-6900c9d4d8a3?source=collection_archive---------9-----------------------#2018-10-11">https://towardsdatascience.com/dates-in-tableau-6900c9d4d8a3?source=collection_archive---------9-----------------------#2018-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8246" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章对那些正在处理财务数据的人或者任何正在追踪与去年数字相比企业表现的人来说都是有用的。</p><h1 id="4838" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">用例</h1><p id="1a41" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">用户希望从宏观和微观层面跟踪上一年的销售情况(YTD，Day YOY)。</p><ol class=""><li id="6e1a" class="lo lp iq jp b jq jr ju jv jy lq kc lr kg ls kk lt lu lv lw bi translated"><strong class="jp ir">在日期字段之间切换</strong> —当处理财务数据时，用户希望看到订单进来时的销售情况，但也希望跟踪订单何时在会计系统中登记。为用户提供在这两个日期字段之间轻松切换的能力，同时只保留一组报告和图表。</li><li id="f48e" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated"><strong class="jp ir">上下钻取</strong> —当使用日期字段构建时间序列图时，Tableau 包括上下钻取日期部分的能力。但是并不是所有的用户都知道将鼠标悬停在日期轴上来查看-/+，或者您希望限制用户向下或向上钻取的能力。</li><li id="b1d5" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated"><strong class="jp ir">日期比较</strong> —相对日期范围过滤器可用于选择 YTD、MTD 和 Today，但不允许同比(YOY)或滚动日期范围比较。构建最常见的日期范围比较，以考虑同比和滚动周期。此外，能够改变结束日期，以跟踪有多远，从去年的销售。</li></ol><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/535f0d63f67a229f07b96dd9b0101281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Pivws5zS4NIKVwOA9PRxA.png"/></div></div></figure><p id="07a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的工作簿显示了每个步骤的最终结果，最后一个选项卡“时间序列”将所有内容汇总在一起。我决定展示如何使用连续和离散来构建每个组件，因为根据需求，两者都有用例。</p><div class="mo mp gp gr mq mr"><a href="https://public.tableau.com/views/DateSelector/DateCompare?:embed=y&amp;:display_count=yes" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd ir gy z fp mw fr fs mx fu fw ip bi translated">选择日期字段；在字段日期视图之间切换；向上钻取和向下钻取日期比较；年初至今…</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">选择日期字段；在字段日期视图之间切换；向上钻取和向下钻取日期比较；年初至今，年复一年以及…</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">public.tableau.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf mm mr"/></div></div></a></div><p id="a2d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">警告</strong>涉及参数(如本工作簿中的参数)的行级计算将增加加载时间。查看<a class="ae ng" href="https://interworks.com/blog/modonnell/2015/10/09/tableau-performance-checklist-calculations-avoid-row-level-calculations/" rel="noopener ugc nofollow" target="_blank">这篇互联文章</a>。</p><p id="bc4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基于 Carl Slifer 的 Interworks <a class="ae ng" href="https://interworks.com/blog/cslifer/2016/03/22/date-comparisons-tableau-made-easy" rel="noopener ugc nofollow" target="_blank">帖子，日期比较变得容易</a>。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="13fb" class="kl km iq bd kn ko no kq kr ks np ku kv kw nq ky kz la nr lc ld le ns lg lh li bi translated">在日期字段之间切换</h1><p id="58ce" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">使用参数可以很容易地在两个或多个日期字段之间转换。</p><p id="7e5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步。</strong>创建一个参数字段，[选择日期字段]。将数据类型设置为整数将有助于提高性能，因为整数和布尔数据类型比日期和字符串数据类型运行得更快。每个值都可以有一个容易识别的名称。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1e17a116d66763f185f23af088dca67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*XIlc7iEORhvdt1PjUSrmwg.png"/></div></figure><p id="b248" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步。</strong>创建计算[选择日期字段]</p><pre class="md me mf mg gt nu nv nw nx aw ny bi"><span id="9cbb" class="nz km iq nv b gy oa ob l oc od">CASE [Parameters].[Select Date field]</span><span id="aa5d" class="nz km iq nv b gy oe ob l oc od">WHEN 1 THEN [Order Date]</span><span id="3f89" class="nz km iq nv b gy oe ob l oc od">WHEN 2 THEN [Ship Date]</span><span id="d14a" class="nz km iq nv b gy oe ob l oc od">END</span></pre><p id="01a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第三步。</strong>在视图中放置计算并显示参数。</p><p id="3d5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面我使用[选择日期字段]计算构建了两个图表。请注意，连续图表的线条中没有断点，每个月/年都没有标记，而离散图表的线条中有断点，每个年、季度和月都有标记。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/b22dcf09dc00e4aec49d19df8a1ec9d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6vGa5V1O1TDgqBVkWu2Sg.png"/></div></div></figure></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="8fcf" class="kl km iq bd kn ko no kq kr ks np ku kv kw nq ky kz la nr lc ld le ns lg lh li bi translated">上下钻取</h1><p id="261f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">构建一个参数来切换到不同的日期级别。</p><p id="21f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步。</strong>创建【日期视图】参数</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi of"><img src="../Images/15bc0dbd0f21045cd74f0683ef571e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*7wJMebvSrjiEzJrFL2DtFw.png"/></div></figure><p id="d29b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步。</strong>创建日期视图计算。请注意，我将使用在上一步中创建的[选择日期字段]。如果您不需要在日期之间切换，则可以使用所需的日期字段。</p><p id="eb34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">日期视图 _ 连续</p><pre class="md me mf mg gt nu nv nw nx aw ny bi"><span id="b525" class="nz km iq nv b gy oa ob l oc od">CASE [Parameters].[Date View]</span><span id="6949" class="nz km iq nv b gy oe ob l oc od">WHEN 5 THEN DATE(DATETRUNC('year', [Select Date field]))</span><span id="13c7" class="nz km iq nv b gy oe ob l oc od">WHEN 1 THEN DATE(DATETRUNC('quarter', [Select Date field]))</span><span id="5f3a" class="nz km iq nv b gy oe ob l oc od">WHEN 2 THEN DATE(DATETRUNC('month', [Select Date field]))</span><span id="b874" class="nz km iq nv b gy oe ob l oc od">WHEN 3 THEN DATE(DATETRUNC('week', [Select Date field]))</span><span id="1cef" class="nz km iq nv b gy oe ob l oc od">WHEN 4 THEN DATE(DATETRUNC('day', [Select Date field]))</span><span id="85e9" class="nz km iq nv b gy oe ob l oc od">END</span></pre><p id="6936" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">日期视图 _ 离散</p><pre class="md me mf mg gt nu nv nw nx aw ny bi"><span id="a2c1" class="nz km iq nv b gy oa ob l oc od">CASE [Parameters].[Date View]</span><span id="ea6f" class="nz km iq nv b gy oe ob l oc od">WHEN 5 THEN DATENAME('year',[Select Date field])</span><span id="6351" class="nz km iq nv b gy oe ob l oc od">WHEN 1 THEN DATENAME('year',[Select Date field]) + ' Q' + DATENAME('quarter',[Select Date field])</span><span id="1fc0" class="nz km iq nv b gy oe ob l oc od">WHEN 2 THEN DATENAME('year',[Select Date field]) + '-' + STR(DATEPART('month',[Select Date field]))</span><span id="252f" class="nz km iq nv b gy oe ob l oc od">WHEN 3 THEN DATENAME('year',[Select Date field]) + ' W' + STR(DATEPART('week',[Select Date field]))</span><span id="c30c" class="nz km iq nv b gy oe ob l oc od">WHEN 4 THEN DATENAME('year',[Select Date field]) + '-' + STR(DATEPART('month',[Select Date field])) + '-' + STR(DATEPART('day',[Select Date field]))</span><span id="fe68" class="nz km iq nv b gy oe ob l oc od">END</span></pre><p id="e925" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第三步。</strong>放置在视图上</p><p id="1801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">连续的</p><p id="87de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Mac 上，按住“option”键，选择[日期视图 _ 连续]并放置在列上。将弹出一个新的下拉字段窗口，选择第一个选项“日期视图 _ 连续(连续)”，该选项不会分配静态日期部分，并允许参数正常工作。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b9f33066376c317570c597d774e96fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*6BjBOyzvnlZDD32MhSQALw.png"/></div></figure><p id="71dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">分离的</p><p id="4911" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将[Date View_Discrete]移动到列中，默认情况下将不应用日期部分。</p><p id="4347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们比较两个时间序列。现在我们看到离散时间序列不包含间断。我也更喜欢离散标签，因为它根据选择的日期视图来标记日期。在连续时间序列将根据所选的日期视图进行调整的情况下，连续几个月显示的日期可能会误导用户。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/5509cf1c1ad569ca0d6b047621aa973c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R81eE6nbyWyDVHg_F3xrSg.png"/></div></div></figure></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="de45" class="kl km iq bd kn ko no kq kr ks np ku kv kw nq ky kz la nr lc ld le ns lg lh li bi translated">年初至今，滚动期间，同比</h1><p id="61fa" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">相对日期允许用户选择 YTD、MTD 和 Day，但不允许进行年度比较或滚动期比较。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/406c9d91f23fde01cea21d8f50fd8b25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*h76fPPoDoOAMdB5qSXSZug.png"/></div></figure><p id="a7e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了便于进行年度对比和滚动期对比，我们将创建 2 个参数；第一个[结束日期选择器]将决定结束日期，第二个[日期比较]将告诉您要查看的日期范围类型。下面是我经常听到用户要求的 7 个日期对比。这些比较可以分为三类:年初至今，滚动期，同比。每个结束日期将根据[结束日期选择器]确定。在<a class="ae ng" href="https://public.tableau.com/views/DateSelector/DateCompare?:embed=y&amp;:display_count=yes" rel="noopener ugc nofollow" target="_blank">日期比较仪表盘</a>上，进行选择以查看日期范围如何变化。</p><p id="443d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">年初至今</strong>:从日历年的第一天开始</p><p id="3733" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.年初至今(例如，2018 年 9 月 15 日)</p><p id="55f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.一年中的每一天(例如，星期一、星期二)</p><p id="c20e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">滚动周期</strong>:连续天数</p><p id="f6cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.年初至今累计</p><p id="5ec4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">同比</strong>:上年同期的当前结果</p><p id="3c4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.季度至今</p><p id="57c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.本月至今</p><p id="184a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.日期(例如，2018 年 9 月 15 日)</p><p id="1f7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.一周中的某一天(例如，星期一、星期二)</p><p id="00f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建[结束日期选择器]首先创建参数</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/bde8fb674307ca5be34909369654da4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*DYD6FDjJGUtYBbLSKCfO4Q.png"/></div></figure><p id="ad74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后构建[结束日期选择器]计算。这可以根据数据更新的频率进行调整。大多数时间默认为昨天，因为在许多情况下，提取每天刷新一次。当用户需要跟踪 YTD 和 MTD 发生的事情时，月末选项(例如，当前、上一个月、2 个月、当前年末)很方便。</p><pre class="md me mf mg gt nu nv nw nx aw ny bi"><span id="4d65" class="nz km iq nv b gy oa ob l oc od">DATE(Case [Parameters].[End Date Chooser]</span><span id="60fc" class="nz km iq nv b gy oe ob l oc od">WHEN 1 THEN TODAY()</span><span id="a8cb" class="nz km iq nv b gy oe ob l oc od">WHEN 2 THEN DATEADD('day', -1, TODAY())</span><span id="c360" class="nz km iq nv b gy oe ob l oc od">WHEN 3 THEN { MAX([Select Date field]) }</span><span id="5cc4" class="nz km iq nv b gy oe ob l oc od">WHEN 4 THEN [Custom End Date]</span><span id="ef03" class="nz km iq nv b gy oe ob l oc od">WHEN 5 THEN DATEADD('day',-1,DATEADD('month',1,DATETRUNC('month',TODAY())))</span><span id="df83" class="nz km iq nv b gy oe ob l oc od">WHEN 6 THEN DATEADD('day',-1,DATETRUNC('month',TODAY()))</span><span id="f67f" class="nz km iq nv b gy oe ob l oc od">WHEN 7 THEN DATEADD('day',-1,DATEADD('month', -1, DATETRUNC('month',TODAY())))</span><span id="1ab0" class="nz km iq nv b gy oe ob l oc od">WHEN 8 THEN DATEADD('day',-1,DATEADD('month', -2, DATETRUNC('month',TODAY())))</span><span id="2533" class="nz km iq nv b gy oe ob l oc od">WHEN 9 THEN DATEADD('day',-1,DATEADD('month', -3, DATETRUNC('month',TODAY())))</span><span id="d802" class="nz km iq nv b gy oe ob l oc od">WHEN 10 THEN DATEADD('day',-1,DATEADD('month', -4, DATETRUNC('month',TODAY())))</span><span id="6a10" class="nz km iq nv b gy oe ob l oc od">WHEN 11 THEN DATEADD('day',-1,DATEADD('month', -5, DATETRUNC('month',TODAY())))</span><span id="da15" class="nz km iq nv b gy oe ob l oc od">WHEN 12 THEN DATEADD('day',-1,DATEADD('month', -6, DATETRUNC('month',TODAY())))</span><span id="25fa" class="nz km iq nv b gy oe ob l oc od">WHEN 13 THEN DATEADD('day',-1,DATEADD('month', -7, DATETRUNC('month',TODAY())))</span><span id="c6ca" class="nz km iq nv b gy oe ob l oc od">WHEN 14 THEN DATEADD('day',-1,DATEADD('month', -8, DATETRUNC('month',TODAY())))</span><span id="11dc" class="nz km iq nv b gy oe ob l oc od">WHEN 15 THEN DATEADD('day',-1,DATEADD('month', -9, DATETRUNC('month',TODAY())))</span><span id="5c15" class="nz km iq nv b gy oe ob l oc od">WHEN 16 THEN DATEADD('day',-1,DATEADD('month', -10, DATETRUNC('month',TODAY())))</span><span id="c090" class="nz km iq nv b gy oe ob l oc od">WHEN 17 THEN DATEADD('day',-1,DATEADD('year', 1, DATETRUNC('year',TODAY())))</span><span id="ffd5" class="nz km iq nv b gy oe ob l oc od">END)</span></pre><p id="e890" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来创建[日期比较对象]参数。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/2477641ce550a83f56e72217a108579b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*rUS6YkbdS2-dknfmoM2VAA.png"/></div></figure><p id="197a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建[比较日期]计算</p><pre class="md me mf mg gt nu nv nw nx aw ny bi"><span id="2f45" class="nz km iq nv b gy oa ob l oc od">CASE [Parameters].[Date Compare to]</span><span id="ad3c" class="nz km iq nv b gy oe ob l oc od">//Year To Date</span><span id="a95b" class="nz km iq nv b gy oe ob l oc od">WHEN 1 THEN</span><span id="e3b9" class="nz km iq nv b gy oe ob l oc od">//Current</span><span id="d74e" class="nz km iq nv b gy oe ob l oc od">IIF( DATEPART('dayofyear',[Select Date field]) &lt;= DATEPART('dayofyear',[End Date Chooser])</span><span id="2a91" class="nz km iq nv b gy oe ob l oc od">AND YEAR([Select Date field]) - YEAR([End Date Chooser]) = 0</span><span id="e9b7" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="4f6c" class="nz km iq nv b gy oe ob l oc od">//Previous</span><span id="83ac" class="nz km iq nv b gy oe ob l oc od">, IIF( [Select Date field] &lt;=</span><span id="c8c5" class="nz km iq nv b gy oe ob l oc od">DATEPARSE('MM-dd-yyyy',(STR(MONTH([End Date Chooser]))+'-'+STR(DAY([End Date Chooser]))+'-'+STR(YEAR(DATEADD('year',-1, [End Date Chooser])))))</span><span id="483a" class="nz km iq nv b gy oe ob l oc od">AND YEAR([Select Date field]) - YEAR([End Date Chooser]) = -1</span><span id="0c12" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="1534" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="8a92" class="nz km iq nv b gy oe ob l oc od">))</span><span id="c5d7" class="nz km iq nv b gy oe ob l oc od">//Year to Weekday</span><span id="31b3" class="nz km iq nv b gy oe ob l oc od">WHEN 2 THEN</span><span id="0040" class="nz km iq nv b gy oe ob l oc od">//Current</span><span id="a451" class="nz km iq nv b gy oe ob l oc od">IIF( DATEPART('dayofyear',[Select Date field]) &lt;= DATEPART('dayofyear',[End Date Chooser])</span><span id="3345" class="nz km iq nv b gy oe ob l oc od">AND YEAR([Select Date field]) - YEAR([End Date Chooser]) = 0</span><span id="5f29" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="7d63" class="nz km iq nv b gy oe ob l oc od">//Previous</span><span id="aec3" class="nz km iq nv b gy oe ob l oc od">, IIF(  YEAR([Select Date field]) - YEAR([End Date Chooser]) = -1</span><span id="fd33" class="nz km iq nv b gy oe ob l oc od">AND DATEPART('week', [Select Date field])*10 + DATEPART('weekday', [Select Date field])</span><span id="762c" class="nz km iq nv b gy oe ob l oc od">&lt;= DATEPART('week', [End Date Chooser])*10 + DATEPART('weekday', [End Date Chooser])</span><span id="4478" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="379e" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="3b33" class="nz km iq nv b gy oe ob l oc od">))</span><span id="e694" class="nz km iq nv b gy oe ob l oc od">//Rolling  Year to Date</span><span id="f9e6" class="nz km iq nv b gy oe ob l oc od">WHEN 3 THEN</span><span id="b2cb" class="nz km iq nv b gy oe ob l oc od">//The first statement sets the conditions for a date to be considered the “current period.”</span><span id="5920" class="nz km iq nv b gy oe ob l oc od">//It will check every date to the date we've chosen as our starting point.</span><span id="437b" class="nz km iq nv b gy oe ob l oc od">//It must be based on whatever date we’ve chosen and go back a user chosen number of months, weeks, days, etc.</span><span id="472e" class="nz km iq nv b gy oe ob l oc od">//If the difference between these dates is &gt;=0 and &lt; our Period Length, we consider it to be the “current period.”</span><span id="4a69" class="nz km iq nv b gy oe ob l oc od">IIF( DATEDIFF('day',[Select Date field],[End Date Chooser]) &gt;=0</span><span id="36ff" class="nz km iq nv b gy oe ob l oc od">AND DATEDIFF('day',[Select Date field],[End Date Chooser])&lt; 365</span><span id="704c" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="5d8d" class="nz km iq nv b gy oe ob l oc od">//The second statement sets the conditions for a date to be considered the “previous period.”</span><span id="455c" class="nz km iq nv b gy oe ob l oc od">//It will compare every date to the date we've chosen as our starting point.</span><span id="e910" class="nz km iq nv b gy oe ob l oc od">//It will be based on whatever date we've chosen and it will immediately precede the “current period” and be the same length.</span><span id="327f" class="nz km iq nv b gy oe ob l oc od">//If the difference between the dates is &gt; the Period Length but also &lt; two times the length, it will be the “previous period.”</span><span id="671a" class="nz km iq nv b gy oe ob l oc od">, IIF( DATEDIFF('day',[Select Date field],[End Date Chooser]) &gt;= 365</span><span id="4034" class="nz km iq nv b gy oe ob l oc od">AND DATEDIFF('day',[Select Date field],[End Date Chooser]) &lt; 2*365</span><span id="89e6" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="150f" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="b762" class="nz km iq nv b gy oe ob l oc od">))</span><span id="76a6" class="nz km iq nv b gy oe ob l oc od">//Quarter to Date</span><span id="c2e2" class="nz km iq nv b gy oe ob l oc od">WHEN 4 THEN</span><span id="0f4a" class="nz km iq nv b gy oe ob l oc od">//Current</span><span id="9f18" class="nz km iq nv b gy oe ob l oc od">IIF( [Select Date field] &lt;= [End Date Chooser]</span><span id="3649" class="nz km iq nv b gy oe ob l oc od">AND DATEDIFF('quarter',[Select Date field],[End Date Chooser])= 0</span><span id="f8cb" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="eb9d" class="nz km iq nv b gy oe ob l oc od">//Previous</span><span id="8985" class="nz km iq nv b gy oe ob l oc od">, IIF(  [Select Date field] &lt;=</span><span id="28c7" class="nz km iq nv b gy oe ob l oc od">DATEPARSE('MM-dd-yyyy',(STR(MONTH([End Date Chooser]))+'-'+STR(DAY([End Date Chooser]))+'-'+STR(YEAR(DATEADD('year',-1, [End Date Chooser])))))</span><span id="8061" class="nz km iq nv b gy oe ob l oc od">AND DATEDIFF('quarter',[Select Date field],[End Date Chooser]) = 4</span><span id="6f21" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="b0ac" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="4784" class="nz km iq nv b gy oe ob l oc od">))</span><span id="1504" class="nz km iq nv b gy oe ob l oc od">//Month to Date</span><span id="381b" class="nz km iq nv b gy oe ob l oc od">WHEN 5 THEN</span><span id="1666" class="nz km iq nv b gy oe ob l oc od">//Current</span><span id="acb6" class="nz km iq nv b gy oe ob l oc od">IIF( [Select Date field] &lt;= [End Date Chooser]</span><span id="368a" class="nz km iq nv b gy oe ob l oc od">AND DATEDIFF('month',[Select Date field],[End Date Chooser])= 0</span><span id="8be8" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="a86b" class="nz km iq nv b gy oe ob l oc od">//Previous</span><span id="6735" class="nz km iq nv b gy oe ob l oc od">, IIF( DAY([Select Date field]) &lt;= DAY([End Date Chooser])</span><span id="961f" class="nz km iq nv b gy oe ob l oc od">AND DATEDIFF('month',[Select Date field],[End Date Chooser])= 12</span><span id="c9f3" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="c7e9" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="180e" class="nz km iq nv b gy oe ob l oc od">))</span><span id="2761" class="nz km iq nv b gy oe ob l oc od">//Date</span><span id="3369" class="nz km iq nv b gy oe ob l oc od">WHEN 6 THEN</span><span id="5b63" class="nz km iq nv b gy oe ob l oc od">//Current</span><span id="2b3a" class="nz km iq nv b gy oe ob l oc od">IIF( DATEDIFF('day',[Select Date field],[End Date Chooser])= 0</span><span id="ff9d" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="1d0a" class="nz km iq nv b gy oe ob l oc od">//Previous</span><span id="85de" class="nz km iq nv b gy oe ob l oc od">, IIF( [Select Date field] =</span><span id="66c3" class="nz km iq nv b gy oe ob l oc od">DATEPARSE('MM-dd-yyyy',(STR(MONTH([End Date Chooser]))+'-'+STR(DAY([End Date Chooser]))+'-'+STR(YEAR(DATEADD('year',-1, [End Date Chooser])))))</span><span id="6ae8" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="0870" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="4f73" class="nz km iq nv b gy oe ob l oc od">))</span><span id="ac65" class="nz km iq nv b gy oe ob l oc od">//Weekday</span><span id="7ed3" class="nz km iq nv b gy oe ob l oc od">WHEN 7 THEN</span><span id="2b35" class="nz km iq nv b gy oe ob l oc od">//Current</span><span id="737b" class="nz km iq nv b gy oe ob l oc od">IIF( DATEDIFF('day',[Select Date field],[End Date Chooser])= 0</span><span id="4160" class="nz km iq nv b gy oe ob l oc od">, 0</span><span id="dbf7" class="nz km iq nv b gy oe ob l oc od">//Previous</span><span id="ef77" class="nz km iq nv b gy oe ob l oc od">, IIF(  YEAR([Select Date field]) - YEAR([End Date Chooser]) = -1</span><span id="b982" class="nz km iq nv b gy oe ob l oc od">AND DATEPART('week', [Select Date field])*10 + DATEPART('weekday', [Select Date field])</span><span id="4634" class="nz km iq nv b gy oe ob l oc od">= DATEPART('week', [End Date Chooser])*10 + DATEPART('weekday', [End Date Chooser])</span><span id="3df0" class="nz km iq nv b gy oe ob l oc od">, -1</span><span id="d289" class="nz km iq nv b gy oe ob l oc od">, NULL</span><span id="eb1d" class="nz km iq nv b gy oe ob l oc od">))</span><span id="c9cb" class="nz km iq nv b gy oe ob l oc od">END</span></pre></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="fb4f" class="kl km iq bd kn ko no kq kr ks np ku kv kw nq ky kz la nr lc ld le ns lg lh li bi translated">把所有的放在一起</h1><p id="d1a8" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">最后一步，我们将创建一个仅使用当前年份的日期字段，这样我们就可以在月/日匹配的时间序列上显示上一个和当前时间段。</p><p id="ccb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建计算[日期月/日/年]。这将创建一个匹配月和日的新日期字段，并使用[结束日期选择器']获取当前期间年份。添加了额外的逻辑来考虑闰年，闰年在二月有额外的一天。如果不加上这个，那么 2 月 29 日将在 3 月结束。</p><pre class="md me mf mg gt nu nv nw nx aw ny bi"><span id="da16" class="nz km iq nv b gy oa ob l oc od">DATE(</span><span id="9534" class="nz km iq nv b gy oe ob l oc od">STR(MONTH([Select Date field]))</span><span id="51a5" class="nz km iq nv b gy oe ob l oc od">+"/"+</span><span id="18b4" class="nz km iq nv b gy oe ob l oc od">IIF(DATEPART('day',[Select Date field]) = 29 AND DATEPART('month',[Select Date field]) = 2</span><span id="af08" class="nz km iq nv b gy oe ob l oc od">,STR(DAY(DATEADD('day', -1, [Select Date field])))</span><span id="d717" class="nz km iq nv b gy oe ob l oc od">,STR(DAY([Select Date field]))</span><span id="c2cc" class="nz km iq nv b gy oe ob l oc od">)</span><span id="1a54" class="nz km iq nv b gy oe ob l oc od">+"/"+</span><span id="541f" class="nz km iq nv b gy oe ob l oc od">STR(YEAR([End Date Chooser]))</span><span id="5621" class="nz km iq nv b gy oe ob l oc od">)</span></pre><p id="c20a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后根据上一节中的逻辑创建[日期视图 _ 连续]和[日期视图 _ 离散]，将日期切换到[日期月/日/年]。</p><p id="d0cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了满足本文开头描述的原始用例的最终视图。最终的工作簿可以在这里<a class="ae ng" href="https://public.tableau.com/views/DateSelector/DateViewRange?:embed=y&amp;:display_count=yes" rel="noopener ugc nofollow" target="_blank">查看。</a></p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/535f0d63f67a229f07b96dd9b0101281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Pivws5zS4NIKVwOA9PRxA.png"/></div></div></figure></div></div>    
</body>
</html>