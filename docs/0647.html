<html>
<head>
<title>Steering Control for self-driving car</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动驾驶汽车的转向控制</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-self-driving-cars-steer-c8e4b5b55d7f?source=collection_archive---------2-----------------------#2017-06-02">https://towardsdatascience.com/how-self-driving-cars-steer-c8e4b5b55d7f?source=collection_archive---------2-----------------------#2017-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="de23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">用数据做酷事</em></p><p id="0dc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">典型的自动驾驶汽车从感知系统开始，该系统估计周围环境的状态，包括地标、车辆和行人。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/dddb553c32d6c4413414a641fc6343e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9prBxDE7WE869b6JpVl9Q.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Perception of local environment</figcaption></figure><p id="e8e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">定位模块将其所学与地图进行比较，以确定车辆的位置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lc"><img src="../Images/3faf377b60caea84e7dfe5d4e954ce87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QepTWu18C6GjX9qWn6tgHA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Localizing a self driving car</figcaption></figure><p id="c91a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦知道了车辆的位置，路径规划模块就绘制出到达目的地的轨迹。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ld"><img src="../Images/f0a864b109b7483ed968ef9f62219115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-LqEz_W7nQryP0n6.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Path planning trajectory</figcaption></figure><p id="618c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，控制回路在每个时间步决定转向和油门/制动，以在该轨迹上引导车辆。在这篇博客中，我将讨论控制回路如何决定转向和油门值</p><p id="bda6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我在Udacity自动驾驶汽车nano degree中的项目10，我实施了预测控制，以在模拟器中驾驶汽车。见下图。模拟器向用户提供汽车在每个时间点的位置和速度，反过来，用户向模拟器提供转向和加速度以应用于汽车。非常感谢Udacity创建了这个模拟器，并为我提供了实现模型预测控制的专业知识</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi le"><img src="../Images/4c6b798f6fd32b3da312041e9e19c9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luP5Icnj7QjDRIem5wV_Bw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Self Driving Car in Udacity Simulator</figcaption></figure><p id="5fdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经用C++分享了我的<a class="ae lf" href="https://github.com/priya-dwivedi/CarND/tree/master/Term%202/CarND-MPC%20Control%20-P5" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> GitHub </strong> </a>的链接和完整代码。</p><p id="1467" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">模型预测控制</strong></p><p id="931c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">状态</strong>:车辆在任一点的状态由四个向量描述——x位置、y位置、速度(v)和方向(psi)。</p><p id="c84f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">执行器或控制输入</strong>是转向角(δ)和节流阀(a)。刹车可以表示为负油门。因此throttle的值可以在-1和+1之间。转向角通常设置在-30度到+30度之间。</p><p id="5f9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">运动学运动模型</strong>可用于在应用转向和油门后从先前状态预测新状态。</p><p id="67db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">x _[t+1]= x[t]+v[t]* cos(psi[t])* dt<br/>y _[t+1]= y[t]+v[t]* sin(psi[t])* dt<br/>psi _[t+1]= psi[t]+v[t]/Lf * delta[t]* dt<br/>v _[t+1]= v[t]+a[t]* dt</p><p id="5b68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里Lf是车辆前部和重心之间的距离。车辆越大，转弯速度越慢</p><p id="242d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了估计理想的转向角和油门，我们从理想状态估计新状态的误差——我们想要遵循的实际轨迹和我们想要保持的速度和方向，并使用<a class="ae lf" href="https://www.coin-or.org/CppAD/Doc/ipopt_solve_get_started.cpp.htm" rel="noopener ugc nofollow" target="_blank"> Ipopt解算器</a>来最小化该误差。这有助于选择最小化期望轨迹误差的转向和油门。</p><p id="a0e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以良好运动控制的关键是很好地定义这个<strong class="jp ir">误差</strong>。我将误差设置为基于以下内容</p><ol class=""><li id="e8f7" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk ll lm ln lo bi translated">与参考点的距离——见下面的等式。我们将由于与参考x，y的差异而产生的误差(定义为跨磁道误差(CTE))、与期望取向的差异(定义为取向误差(epsi ))以及与参考速度的差异相加。n是我们预测未来的时间步数。</li></ol><pre class="kn ko kp kq gt lp lq lr ls aw lt bi"><span id="559e" class="lu lv iq lq b gy lw lx l ly lz">double cost = 0;<br/>for (int t=0; t &lt; N; t++) {<br/>    cost += pow(epsi[t], 2); //Orientation error<br/>    cost += pow(cte[t], 2); //Cross track error<br/>    cost += pow(v[t]- ref_v, 2);//Delta from ref velocity<br/>}</span></pre><p id="602c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.与执行器成比例的误差</p><pre class="kn ko kp kq gt lp lq lr ls aw lt bi"><span id="efab" class="lu lv iq lq b gy lw lx l ly lz">cost += pow(delta[t], 2); //Steering angle<br/>cost += pow(a[t], 2);//Throttle </span></pre><p id="f5bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.与致动器变化成比例的误差——成本函数中的这一附加项反映了下一个致动器状态与当前状态之间的差异。这确保了致动器值的平稳变化</p><pre class="kn ko kp kq gt lp lq lr ls aw lt bi"><span id="72f1" class="lu lv iq lq b gy lw lx l ly lz">for (int t = 0; t &lt; N-1; t++) {<br/>  cost += pow(delta[t+1] - delta[t], 2) //Change in steering<br/>  cost += pow(a[t+1] - a[t], 2)  //Change in throttle<br/>}</span></pre><p id="8a53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述各项可以乘以权重，这些权重增加了该项在总成本等式中的重要性。例如，如果我们将<code class="fe ma mb mc lq b">pow(delta[t+1] - delta[t], 2) </code>乘以500，这将确保非常平稳的转向变化，并防止模拟器中的颠簸运动</p><p id="1a74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">C++ <a class="ae lf" href="https://www.coin-or.org/CppAD/Doc/ipopt_solve_get_started.cpp.htm" rel="noopener ugc nofollow" target="_blank"> Ipopt解算器</a>用于最小化误差，并计算转向和油门的最佳值。</p><p id="984b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另外两个相当重要的参数是我们要预测转向和油门的未来时间步数(N)。和时间步长(dt)。</p><ul class=""><li id="04fd" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk md lm ln lo bi translated">dt——不同时间步长之间的时间间隔。我发现dt是模拟器中整体性能的一个非常重要的参数。如果dt太低，就会导致赛车在赛道中心来回摆动。发生这种情况可能是因为致动器输入接收非常快，并且车辆不断响应。此外，如果dt小于延迟时间(0.1秒)，则在执行前一个信号之前接收到新的致动器信号。这导致汽车的颠簸运动。另一方面，如果dt太大，在致动器被接收之前，汽车行驶了太多的距离，虽然这导致沿着轨道的直线部分的平稳性能，但是它导致汽车在弯道上偏离道路。</li><li id="a124" class="lg lh iq jp b jq me ju mf jy mg kc mh kg mi kk md lm ln lo bi translated">n-是模型预测的时间步数。随着N的增加，模型预测更远。模型预测的时间越长，预测就越不准确。此外，如果N很大，则需要进行更多的计算，这会导致求解器的结果不准确，或者求解器无法实时提供解。我发现大约10-15步是最好的</li></ul><p id="7a02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦设置了所有的模型并且定义了所有的参数，</p><ol class=""><li id="e8da" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk ll lm ln lo bi translated">我们将当前状态作为初始状态传递给模型预测控制器。</li></ol><p id="eb0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.我们称之为优化求解器。给定初始状态，求解器将返回使成本函数最小化的致动器向量。</p><p id="df62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.我们将转向和油门应用到车辆上。然后回到步骤1。</p><p id="e072" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过预测每一步正确的转向和油门来驾驶汽车绕着模拟器行驶不是一件容易的事情，但却是一次令人敬畏的学习经历。非常感谢Udacity创建了这个课程！</p><p id="a08e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">其他著述</strong>:【https://medium.com/@priya.dwivedi/】T2</p><p id="8ba6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PS:我住在多伦多，我希望将职业生涯转向深度学习。如果你喜欢我的帖子，并能把我联系到任何人，我将不胜感激:)。我的电子邮件是priya.toronto3@gmail.com</p><p id="38c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">参考文献:</strong></p><p id="375a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lf" href="https://www.udacity.com/" rel="noopener ugc nofollow" target="_blank"> Udacity </a>无人驾驶汽车Nano Degree——我感谢Udacity和巴斯蒂安·特龙给我机会成为他们新的无人驾驶汽车项目的一部分。这是一次非常有趣的旅程。我使用的大部分代码都是在课堂讲课中建议的。这里的图片和视频参考也在讲座中分享</p><p id="2f1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图片:<a class="ae lf" href="https://arxiv.org/pdf/1612.02649.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1612.02649.pdf</a></p></div></div>    
</body>
</html>