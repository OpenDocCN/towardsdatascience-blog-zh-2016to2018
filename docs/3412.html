<html>
<head>
<title>One simple way for CFOs to manage forecast uncertainties (using Monte Carlo and R)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">首席财务官管理预测不确定性的一个简单方法(使用蒙特卡罗和 R)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/one-simple-way-for-cfos-to-manage-forecast-uncertainties-using-monte-carlo-and-r-148e9b75c87c?source=collection_archive---------7-----------------------#2018-05-09">https://towardsdatascience.com/one-simple-way-for-cfos-to-manage-forecast-uncertainties-using-monte-carlo-and-r-148e9b75c87c?source=collection_archive---------7-----------------------#2018-05-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/82b9ca46c491aa45194be1f1cde65c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiPvMfJWUl9PmWpNq4lsPA.jpeg"/></div></div></figure><p id="cc85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">财务专业人士有无数种方法来预测销售，但我们并不想涵盖这些方法。本文的目标是帮助财务专业人员使用蒙特卡罗和 R 更好地管理预测不确定性，能够回答以下业务问题之一:</p><blockquote class="kw"><p id="e7ba" class="kx ky iq bd kz la lb lc ld le lf kv dk translated">"你的组织达到目标的可能性有多大？"</p><p id="f6c0" class="kx ky iq bd kz la lb lc ld le lf kv dk translated">“您组织的预测风险状况如何？”</p></blockquote><p id="06d4" class="pw-post-body-paragraph jy jz iq ka b kb lg kd ke kf lh kh ki kj li kl km kn lj kp kq kr lk kt ku kv ij bi translated">这不再仅仅是估计目标(例如:根据我们知道的过去发生的事情重新预测第四季度)。它是关于评估目标内的风险水平，并进行数据驱动的业务对话，讨论我们如何做才能实现预期的结果。它还将为财务专业人员提供机会，使他们在管理预测的方式上更具战略性(例如，是时候考虑纳入即将到来的新机会了吗？我们应该等吗？我们是否过多或过少的承诺？).</p><p id="619b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然在 Excel 中进行蒙特卡洛模拟相对容易，但我个人更喜欢使用 R，因为可以利用 R 库来拟合分布和生成蒙特卡洛模拟的样本数据。</p><p id="0730" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个练习，我们将使用一个简化的案例，它需要很少的库。通过几行代码，我们将能够清楚地回答这个问题:</p><blockquote class="kw"><p id="ae2e" class="kx ky iq bd kz la lb lc ld le lf kv dk translated">“风险很高。就目前的情况来看，我们不太可能达到目标(例如，不到 33%的可能性)。让我们想出一个计划来弥合这一差距。”</p></blockquote><p id="ca3d" class="pw-post-body-paragraph jy jz iq ka b kb lg kd ke kf lh kh ki kj li kl km kn lj kp kq kr lk kt ku kv ij bi translated">本例中我们需要的是:</p><ul class=""><li id="2c36" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><strong class="ka ir">一个商业问题/背景</strong> —“我们在第三季度完成了 1.417 亿部，我们的年度目标是 1.860 亿部；我们实现它的概率有多大？”</li><li id="8251" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">一个观察到的时间序列</strong>——某产品 ABC 按月销售的数量。</li><li id="3cfb" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">年度目标</strong> —到年底，ABC 至少售出 1.86 亿件产品。</li></ul><p id="9ec8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用以下方法来回答这个问题:</p><ul class=""><li id="db38" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><strong class="ka ir">第一步:</strong>准备数据。</li><li id="2cf6" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">步骤 2 A: </strong>对观察到的时间序列进行传统分布拟合。</li><li id="c6dd" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">步骤 2 B: </strong>对观察到的时间序列进行“补充”分布拟合。</li><li id="1f0c" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">步骤 3: </strong>为 10 月、11 月和 12 月生成一个包含 10，000 个样本的数据表。</li><li id="5546" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">第四步:</strong>生成概率，比较两个选项(选项 A = 26.75% /选项 B = 33.2%)。在这个例子中，一个很大的收获是，通过利用更好的拟合分布变得更精确不会显著改变业务结果(例如，两种方法之间 5%的风险差异)。</li><li id="0f7b" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">第 5 步:</strong>向业务部门报告风险很高，而且就目前的情况来看，他们不太可能达到目标(例如，低于 33%的可能性)。然后，想出一个缩小差距的计划。</li></ul></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="a45e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第一步:</strong>准备数据</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="87d0" class="mp mq iq ml b gy mr ms l mt mu">| library(RCurl)</span><span id="07ca" class="mp mq iq ml b gy mv ms l mt mu"># Read data<br/>mydata &lt;- read.csv(text = getURL("https://raw.githubusercontent.com/tristanga/MonteCarlo_ForecastRisk/master/TS.csv"))</span><span id="deb4" class="mp mq iq ml b gy mv ms l mt mu"># Create time serie<br/>tseries &lt;- ts(mydata$x, frequency = 12, start = c(2000, 1))</span><span id="bdb7" class="mp mq iq ml b gy mv ms l mt mu"># Check the time serie<br/>start(tseries)<br/>end(tseries)<br/>frequency(tseries)</span><span id="265b" class="mp mq iq ml b gy mv ms l mt mu"># Remove Q4<br/>tseries_sub &lt;- window(tseries, start=c(2000, 1), end=c(2015,9))</span><span id="8844" class="mp mq iq ml b gy mv ms l mt mu"># Define your target<br/>mytarget = 186.0000</span><span id="af29" class="mp mq iq ml b gy mv ms l mt mu"># Calculate actuals<br/>actualYTD &lt;- sum(window(tseries, start=c(2015, 1), end=c(2015,9)))</span><span id="c211" class="mp mq iq ml b gy mv ms l mt mu"># Check the distribution of your time serie<br/>hist(tseries_sub)<br/>boxplot(tseries_sub)<br/>tseries_df = as.data.frame(tseries_sub)</span></pre></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/2a556f5fb86adcdb52b5cf80d9f3ea01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpiAwStg7oevFnacgjWSVw.png"/></div></div></figure><p id="d9bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤 2 A: </strong>对观察到的时间序列进行传统分布拟合。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="c6ed" class="mp mq iq ml b gy mr ms l mt mu">|library(fitdistrplus)<br/>fit.norm &lt;- fitdist(as.numeric(tseries_df$x), "norm")<br/>fit.exp &lt;- fitdist(as.numeric(tseries_df$x), "exp")<br/>fit.weibull &lt;- fitdist(as.numeric(tseries_df$x), "weibull")<br/>fit.lnorm &lt;- fitdist(as.numeric(tseries_df$x), "lnorm")<br/>fit.gamma &lt;- fitdist(as.numeric(tseries_df$x), "gamma")<br/>fit.logistic &lt;- fitdist(as.numeric(tseries_df$x), "logis")<br/>fit.cauchy &lt;- fitdist(as.numeric(tseries_df$x), "cauchy")</span><span id="455e" class="mp mq iq ml b gy mv ms l mt mu"># Compare Goodness-of-fit statistics<br/>gofstat(list(fit.norm, fit.exp, fit.weibull,fit.lnorm,fit.gamma,fit.logistic,fit.cauchy),<br/>        fitnames = c("fit.norm", "fit.exp", "fit.weibull","fit.lnorm","fit.gamma","fit.logistic","fit.cauchy"))</span><span id="352b" class="mp mq iq ml b gy mv ms l mt mu"># the best Goodness-of-fit statistics is for the normal distribution<br/>option1 = fit.norm<br/>summary(option1)</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/3f8bdc83fc526e50a8022030c82cc5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVSjw256AMCC8zXVBFRz1A.png"/></div></div></figure><p id="d736" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第二步 B: </strong>对观察到的时间序列进行“补充”分布拟合。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="f710" class="mp mq iq ml b gy mr ms l mt mu">|# Using Supplementary Distributions to fit the second option<br/>library(SuppDists)<br/>parms&lt;-JohnsonFit(as.numeric(tseries_df$x), moment="quant")</span><span id="ee74" class="mp mq iq ml b gy mv ms l mt mu"># plot the distribution<br/>hist( as.numeric(tseries_df$x) , freq=FALSE)<br/>plot(function(x)dJohnson(x,parms), 0, 20, add=TRUE, col="red")</span><span id="23f3" class="mp mq iq ml b gy mv ms l mt mu"># let's create samples for october, november and december<br/>option2 &lt;- function(x)qJohnson(x,parms)</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/4797c5a01587ebe78429cc176dfe7d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8TzSXH9-Yrj2aF2kGnNFw.png"/></div></div></figure><p id="cecf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第三步:</strong>为 10 月、11 月和 12 月生成一个包含 10，000 个样本的数据表。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="544b" class="mp mq iq ml b gy mr ms l mt mu">|#Option 1<br/>library(truncnorm)<br/>fit.coef &lt;- coef(fit.norm)<br/>final_df1 &lt;- as.data.frame(rtruncnorm(n=10^4, a=min(tseries_df$x), b=max(tseries_df$x), mean=fit.coef["mean"], sd=fit.coef["sd"]))<br/>colnames(final_df1) &lt;- 'Oct'<br/>final_df1$Nov &lt;- rtruncnorm(n=10^4, a=min(tseries_df$x), b=max(tseries_df$x), mean=fit.coef["mean"], sd=fit.coef["sd"])<br/>final_df1$Dec &lt;- rtruncnorm(n=10^4, a=min(tseries_df$x), b=max(tseries_df$x), mean=fit.coef["mean"], sd=fit.coef["sd"])<br/>final_df1$Forecast &lt;- actualYTD + final_df1$Oct + final_df1$Nov +final_df1$Dec</span><span id="3e00" class="mp mq iq ml b gy mv ms l mt mu">#plot histogram of forecasted quantities<br/>hist(final_df1$Forecast)</span><span id="56ec" class="mp mq iq ml b gy mv ms l mt mu">#Option 2<br/>option2 &lt;- function(x)qJohnson(x,parms)<br/>option2sample &lt;- option2(runif(10000))<br/>hist(option2sample)<br/>boxplot(option2sample,as.numeric(tseries_df$x) )<br/>final_df2 &lt;- as.data.frame(option2(runif(10000)))<br/>colnames(final_df2) &lt;- 'Oct'<br/>final_df2$Nov &lt;- option2(runif(10000))<br/>final_df2$Dec &lt;- option2(runif(10000))<br/>final_df2$Forecast &lt;- actualYTD + final_df2$Oct + final_df2$Nov +final_df2$Dec</span><span id="2abf" class="mp mq iq ml b gy mv ms l mt mu"># Plot Option 2<br/>hist(final_df2$Forecast)</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7c15376b498077570834265e4f6303bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*Qj89Yru2TZ1OOlM2HrEsrg.png"/></div></figure><p id="a01c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第四步:</strong>生成概率，比较两个选项(选项 A = 26.75% /选项 B = 33.2%)。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="3ba0" class="mp mq iq ml b gy mr ms l mt mu">|boxplot(final_df1$Forecast,final_df2$Forecast)<br/>myproba1 &lt;- sum( final_df1$Forecast &gt;= 186 ) / 100<br/>myproba2 &lt;- sum( final_df2$Forecast &gt;= 186 ) / 100</span></pre><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7684f81a6e77b23d03d136bc09add1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*zl7FJKfK1-9n8iMoQCQQjw.png"/></div></figure><p id="d3b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第 5 步:</strong>向业务部门报告风险很高，就目前的情况来看，他们不太可能达到目标(例如，低于 33%的可能性)。然后，想出一个缩小差距的计划。</p><p id="eadd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">后续步骤:</p><ul class=""><li id="7d56" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated">增加复杂性(每个月的分布与整个时间序列，利润与销售量，在模型中包括增长/CAGR，外部变量等。).</li><li id="9d54" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">为金融专业人士写一写预测定量时间序列的其他相关统计方法。</li></ul><p id="3f28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，蒙特卡罗方法有一些风险/注意事项需要牢记:1)我们使用过去来预测未来，而不考虑除先前销售数量分布(人口、价格等)之外的任何外部因素。)，2)观测到的时间序列分布会随时间而变化；虽然选项 2 中的模型应遵循这些变化，但重要的是要不时检查它是否仍然紧密遵循选定的分布。</p><p id="7983" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该代码可在<a class="ae na" href="https://github.com/tristanga/Managing-Forecast-Uncertainty-Monte-Carlo-R" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。谢谢你看我的帖子。这是我在媒体上的第一篇文章。如果您遇到过类似的挑战，或者您希望在您的组织中得到帮助，请随时联系我。</p></div></div>    
</body>
</html>