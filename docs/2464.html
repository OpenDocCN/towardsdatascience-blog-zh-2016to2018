<html>
<head>
<title>Combinatorial Optimization: from theory to code using Google’s OR tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">组合优化:使用Google的OR工具从理论到代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/combinatorial-optimization-from-theory-to-code-using-googles-or-tools-2e55da55f028?source=collection_archive---------9-----------------------#2018-01-28">https://towardsdatascience.com/combinatorial-optimization-from-theory-to-code-using-googles-or-tools-2e55da55f028?source=collection_archive---------9-----------------------#2018-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/94f3698d6ba10b67de07d84dbf3de558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYFjMXZwMfQQlqC9HmAAeg.jpeg"/></div></div></figure><div class=""/><p id="f011" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将考虑一个来自组合优化的问题，这个问题可以理解为一般图上的约束优化。这让我有机会以一种比通常只涉及神经网络更普遍的方式介绍复杂网络的概念和语言。这里开发的概念将用于神经网络模型物理学的后续系列。</p><p id="cced" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不会从最一般的角度来讨论网络理论，我将在这里专注于解决一个特定的问题，从建立数学模型到使用Google的运筹学(或工具)库对其进行数值实现。最后，我将讨论组合优化的一些应用以及它与统计力学和计算机科学的联系。这篇文章本质上是技术性的，我决定不回避方程，而是一步一步地引导你通过数学。希望这能引发你的好奇心！</p><h1 id="46cd" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何用最少的切口在饥饿的孩子中分享巧克力棒？</h1><p id="02dc" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">让我们开始定义我们想要解决的问题。<em class="ma">有长度不等(整数)的</em> <strong class="ka jc"> <em class="ma"> m </em> </strong> <em class="ma">巧克力棒和想要不同数量巧克力的</em> <strong class="ka jc"> <em class="ma"> n </em> </strong> <em class="ma">饥饿儿童。你可以切巧克力棒，目标是确保每个孩子都能得到他们想要的量。写一个程序来分配巧克力，这样你可以切得最少。</em></p><p id="22bb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">解决方案:</strong>我决定解决问题的方式是把它映射成一个网络优化问题。我们有两个长度为m的输入向量<strong class="ka jc"> B </strong>和<strong class="ka jc"> C </strong></p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/801405dfa878f4a092bfc825eb508943.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/0*GI8IHEZ4Qc7d2Wa6"/></div></figure><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/6d6a637de3ffee189c265c2ddfe3a702.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/0*4l54QFrT3Vm7zC-d"/></div></figure><p id="4ad0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">表示巧克力棒的数量。每个酒吧有b1，b2 …可用的巧克力单位</p><p id="2687" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而<strong class="ka jc"> n </strong>是孩子的数量，每个孩子想要c1，c2，…块巧克力。我们定义了全连接(FC)有向网络(意味着连接仅从源节点到漏节点)。下图是<strong class="ka jc"> B </strong> = (2，5，7，3)和<strong class="ka jc"> C </strong> = (3，2，6，1，2)的问题实例。</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/f14421f017235b17df0186c1d7923db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*_fBWkTd9YKd6rSle"/></div></figure><p id="824d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，连接有一个箭头来定义它们的方向。在数学上，这些连接被编码在一个连接矩阵中</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/3de1d1a43b46329d3b0be6eaba066690.png" data-original-src="https://miro.medium.com/v2/resize:fit:44/0*vLUHQFbRpo63--Lr"/></div></figure><p id="9a18" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其条目指定从源节点<em class="ma"> i </em>移动到漏节点<em class="ma"> j </em>的单元数量。我们为每个连接分配一个成本</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/267303c62af063ac86a9daed5b05d263.png" data-original-src="https://miro.medium.com/v2/resize:fit:150/0*28Lu2pGmug_kF4CW"/></div></figure><p id="3e5a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们希望优选完美匹配(例如，示例中的2 — &gt;2和3 — &gt;3)，即零成本。这意味着供应和需求节点之间的“距离”必须为零。将欧几里德距离作为图上的自然度量，我们定义:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/eda81768264dab3b30795fc6ad0893b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:220/0*kw3HtA9ll8aeEsQQ"/></div></figure><p id="3d06" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时我们需要定义系统的目标函数，或者用物理学家的语言来说，问题的哈密顿量:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/0d8ae7e7781ef4a8c2e73472adeba29a.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/0*L6o2PwYFCLjVKlUf"/></div></figure><p id="11bd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二个等式中的表达式是哈密顿量的“矢量化”实现；我们已经定义了</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/6732a69952b74bce090d5b43d7ef2d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/0*mg2owyT5O_JZ25eF"/></div></figure><p id="7b63" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为长度为m的单位向量，而<em class="ma"> Ic </em>的长度为<strong class="ka jc"> n </strong>。注意，矩阵<strong class="ka jc"> M </strong>和<strong class="ka jc"> X </strong>之间的乘积是逐元素的。这是最小成本问题的哈密顿量；通过最小化哈密顿量，我们选择成本较低的矩阵元素<strong class="ka jc"> X </strong>。我们现在推测最小截形对应于图上最小长度(即成本)的路径。有两个约束要强加:一个关于“当前”守恒，另一个关于<strong class="ka jc"> X </strong>的元素是正定的。在节点之间流动的两股“电流”表示:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/20d2aa9dd50ee036dc5b9862bb32f70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/0*NlOKSwCqY1Ny4fY1"/></div></figure><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/dcb71f37d8f722108e55983e8f8285ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/0*98CXyvzyEixkCFpF"/></div></figure><p id="da5f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们将通过网络的“通量”定义为</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/e5055d5ac637971d113100782a7ac094.png" data-original-src="https://miro.medium.com/v2/resize:fit:210/0*1_keSlOi5cuz366J"/></div></figure><p id="3d0f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和偏置向量</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/5a2eb8e86e2e7bd8111c34fd04db0dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:202/0*IWxypE9rurHyUarO"/></div></figure><p id="713c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们需要加强元素方面的“巧克力保护”约束:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/160f1372bb7117262bf11175d4470730.png" data-original-src="https://miro.medium.com/v2/resize:fit:98/0*3KFlb7jPNcXT1UCt"/></div></figure><p id="bf67" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们需要强制连接矩阵的矩阵元素都是正的:对于[1，m]中的所有<em class="ma"> i </em>和[1，n]中的<em class="ma"> j </em>，X &gt;0。这个问题可以用拉格朗日形式重新描述为:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/54be6e17d5e3992cd57d783f5910031c.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/0*FEDZEaHfoiIRrTH8"/></div></figure><p id="94e5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中我们引入了两个拉格朗日乘数λ和μ来加强约束。注意不等式约束需要遵循卡鲁什-库恩-塔克条件[2]: <strong class="ka jc"> X </strong> &gt; 0，<strong class="ka jc"> mu </strong> &gt; 0和</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ec963cc303693e24690f9da3d9453662.png" data-original-src="https://miro.medium.com/v2/resize:fit:108/0*GDy6jUvhw9fLE14S"/></div></figure><p id="3d2b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述示例的解决方案如图所示。</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/4a4e210c2b1a6fbc770a8223aa0dfe14.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*yxRh7a_mA0ZKyiux"/></div></figure><p id="6a27" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">切割对应于每一行<strong class="ka jc"> X </strong>上非零元素的数量。我们认为一个切割是一个分叉，所以在下面的例子中，单元2(自下而上计数)用一个切割将原来的5个单元一分为二。因此，切割对应于在每一行<strong class="ka jc"> X </strong>上具有l &gt; 1个非零矩阵元素。你可以在我的<a class="ae kw" href="https://github.com/WessZumino/Optimization-with-Ortools" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到解决问题的python代码，连同一步一步的讲解，或者下面随便看看。我使用过谷歌的<a class="ae kw" href="https://developers.google.com/optimization/" rel="noopener ugc nofollow" target="_blank">约束优化库</a>，我发现相对于Scipy的优化工具来说，它更容易使用，也更有效。因此，如果您对学习如何使用这些库感兴趣，您会发现这里考虑的简单问题是解决更复杂问题的有用教程。另请注意，OR tools已经实现了一个最小成本函数，您可以调整该函数来解决上述问题。如果你不想从头开始做这件事，这是一个有效的选择…但是乐趣在哪里呢？</p><figure class="mc md me mf gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6478" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最小费用问题是组合优化中的经典问题之一；左图给出了这个问题的一个更经典的表述:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/bf740a7240d575ef7980a26f14b11929.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*Z5wY6q_FBgd-gblsNO7SOQ.jpeg"/></div></figure><p id="2c17" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">工厂(节点1)生产一定数量的货物，需要通过不同的路线运送到目的地(节点4和5)。每条路线都有相关的成本和可以运输的货物的最大容量。这个问题可以按照上述步骤连同对矩阵元素边缘连接矩阵的进一步限制来解决，</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d89a0cadb8d05623e9d1cc15b66866a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:178/0*d1ovkudSt1isW3O8"/></div></figure><p id="c37a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中l是每个边的最大容量。</p><h1 id="428d" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">从这里去哪里</h1><p id="8108" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在过去的几十年里，物理学家被<em class="ma">随机、</em>组合优化问题所吸引，因为它们与统计力学有关，见参考文献。[1,3].这些问题与一类被称为<strong class="ka jc">自旋玻璃</strong>的模型有关，这类模型对应于具有随机耦合的<strong class="ka jc">伊辛</strong>模型。这些模型展示了几个有趣的特征，并且是几个神经网络模型的灵感来源。</p><p id="96d3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的帖子里会有更多关于这个的内容！目前，我只想展示巧克力分配问题是如何在随机输入/输出关系的统计力学问题中被重新铸造的。关联吉布斯测度和约束配分函数:</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/af8969d36a8fdefb8dd6e5e3685046fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/0*XisDPWn3JCW-kqF_"/></div></figure><p id="350d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，该问题的哈密顿量是无量纲的，因此可以认为逆“温度”在h中被重新调整。如果β是随机变量，我们需要对其分布的自由能进行平均</p><figure class="mc md me mf gt is gh gi paragraph-image"><div class="gh gi my"><img src="../Images/c3acce73085601125f22cae3bac831bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/0*MoW1s1ldM57O8zpL"/></div></figure><p id="1df9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中最后一个表达式是复制的分区函数。如何解决这类问题将是以后文章的主题。</p><p id="9cb4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一些有用的参考资料:</p><p id="e89d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[1] M. Mezard，A. Montanari，<em class="ma">信息、物理和计算</em>，牛津大学出版社(2009)</p><p id="f3f9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[2] C. M. Bishop，<em class="ma">模式识别与机器学习</em>，Springer (2006)。</p><p id="224e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[3] M .梅扎德，g .帕里西，<em class="ma">，</em>，<a class="ae kw" href="https://hal.archives-ouvertes.fr/jpa-00232897/document" rel="noopener ugc nofollow" target="_blank">《形体快报》杂志，1985年，46期(17)，第771–778页</a>。</p><p id="79fd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">理论物理学家，从事复杂系统和量子突现现象的研究。我目前在人工智能领域工作，尤其对神经网络、它们与物理学的联系以及相关的基础问题感兴趣。<a class="ae kw" href="https://equat10ns.wordpress.com/author/brokenreplica/" rel="noopener ugc nofollow" target="_blank">查看Mirco Milletari的所有帖子</a></p><p id="5bc4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">发布</strong>2018年1月28日2018年1月30日</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="3041" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ma">原载于2018年1月28日equat10ns.wordpress.com</em><a class="ae kw" href="https://equat10ns.wordpress.com/2018/01/28/combinatorial-optimization-from-theory-to-code/" rel="noopener ugc nofollow" target="_blank"><em class="ma"/></a><em class="ma">。</em></p></div></div>    
</body>
</html>