<html>
<head>
<title>AutoWorkout: How to Improve Motion Activity Classifier Predictions?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AutoWorkout:如何改进运动活动分类器预测？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/autoworkout-how-to-improve-motion-activity-classifier-predictions-d047feead616?source=collection_archive---------9-----------------------#2018-01-24">https://towardsdatascience.com/autoworkout-how-to-improve-motion-activity-classifier-predictions-d047feead616?source=collection_archive---------9-----------------------#2018-01-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/83539a9b281fa65386693d2d3c73ed69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0QX-O8SyFRlpSS2uq8OBw.jpeg"/></div></div></figure><p id="fe91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近我开始开发<a class="ae kw" href="https://itunes.apple.com/us/app/autoworkout/id1314314336" rel="noopener ugc nofollow" target="_blank">自动锻炼</a> iOS/WatchOS应用程序。它自动识别健身运动，并提供每次运动花费的时间和重复次数(在未来的版本中)。这款应用的想法自然源于我第一次尝试<a class="ae kw" rel="noopener" target="_blank" href="/run-or-walk-detecting-user-activity-with-machine-learning-and-core-ml-part-1-9658c0dcdd90">通过机器学习</a>识别运动活动类型，首先是<a class="ae kw" rel="noopener" target="_blank" href="/run-or-walk-part-2-collecting-device-motion-data-the-right-way-58a277ff2087">收集运动数据</a>，<a class="ae kw" rel="noopener" target="_blank" href="/run-or-walk-part-3-99-accuracy-neural-network-classifier-for-detecting-motion-activity-675e16af4a7d">设计神经网络分类器</a>，然后<a class="ae kw" rel="noopener" target="_blank" href="/run-or-walk-part-4-using-keras-neural-network-classifier-in-ios-with-core-ml-a29723ab3235">在核心ML </a>的帮助下在iOS应用中利用它。</p><p id="5dfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我有意跳过应用程序实现细节，专注于使运动活动分类器预测有用，因为这是最具挑战性的问题。</p><h1 id="9249" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">没有UI才是最好的UI</h1><p id="6069" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在将预先训练好的模型导入AutoWorkout之前，我非常确定它们会在预测健身运动方面做得很好。他们确实这样做了，但各有各的方式。在这里，我将离开一点，描述我是如何识别运动活动的。</p><p id="b28d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于手腕可穿戴设备能够提供足够的传感器数据来预测人类的运动活动，而且我已经专注于iOS/Watch OS开发，所以我选择Apple Watch作为我的应用程序的目标设备。由于WatchOS支持Core ML，我可以直接在Apple Watch上运行分类器，避免iOS和Watch OS之间昂贵且不总是可靠的通信，以传输传感器数据，从而在iPhone上进行预测。iOS应用程序主要包含UI演示代码，以显示正在Apple Watch上收集和计算的锻炼统计数据。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/dad2896cd95b81b88af4f7aa5c8dde09.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*XWuZPjgZb0-uynIFyQg-nw.jpeg"/></div></figure><p id="e1a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我是拥抱<em class="mf">的粉丝，没有UI是最好的UI </em>方法，因此WatchOS应用程序中唯一的UI元素是“开始”和“停止”按钮。只需点击“开始”，开始锻炼，做你的练习，并在结束时点击“停止”。你所有的练习都会被认可，每一次花费的时间会被计算出来，重复次数会被记录下来。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/71cb45ec1f7fc3671504c48d3e26cfd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C2B-_QGKUO_Iqr01X7ZaKw.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Interface of the Apple Watch app</figcaption></figure><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/4f236734095c996c239d1ab9dbd1cd9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*fg6sKoyDNwCkCrfoCWsaPQ.jpeg"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Workout statistics</figcaption></figure><h1 id="0a85" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">预训练神经网络分类器</h1><p id="6c93" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了使这一切成为可能，我需要利用预训练的分类器，这些分类器每隔1.7秒根据传感器数据进行预测。注意到“量词”了吗？是的，我需要一个传感器数据来源——X、Y、Z加速度计——总共3个分类器，每个分类器实时预测5种活动(跳跃、俯卧撑、下蹲、弓步和练习之间的暂停)。</p><p id="ae80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在无数个小时调整他们的性能后，我最终获得了可接受的精确度:</p><ul class=""><li id="0b4f" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">x轴分类器:89.09%</li><li id="bf9d" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">y轴分类器:85.01%</li><li id="c536" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">z轴分类器:81.66%</li></ul><p id="bf3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于今天的分类问题来说，这些数字可能看起来并不令人印象深刻，但是考虑到我所受的时间和数据收集的限制，我发现它们相当不错。</p><h1 id="6ce2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">N个分类器，N个观点</h1><p id="73b8" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在我将分类器集成到应用程序中后，很明显它们能够预测健身运动，我必须检查这些预测的质量。</p><p id="63a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">理想情况下，应用程序应该记录，比如说一个俯卧撑练习，如果所有3个分类器都预测这是一个俯卧撑练习。在现实生活中，我有不到5%的情况下，所有3个模型都预测同一类。在几乎50%的情况下，3个模型中的2个模型的预测是匹配的。另外45%的病例是所有3个模型预测的不同类别。</p><p id="a3d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你有三个数据来源，并且它们告诉你不同的事情时，不容易做出决定，对吗？这是机器学习环境中的一个众所周知的问题，在机器学习环境中，存在不止一个分类器，并且存在利用由多个来源提供的预测的技术。</p><h1 id="1f4e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">投票</h1><p id="07ce" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在分类机器学习问题中<em class="mf">投票</em>可能是从多个预测中导出单个类别的最简单也是最强大的方法。在实施投票算法时，你问自己的第一个问题是，它将是<em class="mf">多数投票</em>还是<em class="mf">加权投票</em>？</p><p id="dcee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的案例中，很明显<em class="mf">模型X </em>具有最高的准确性，但是根据地面事实标签进行的测试表明<em class="mf">模型X </em>预测A类(这是不正确的)和<em class="mf">模型Y </em>和<em class="mf"> Z </em>都预测B类(并且是正确的)的情况并不少见。因此，我不能只给<em class="mf"> model X </em>在<em class="mf">投票</em>中最大的影响力，并使用<em class="mf">加权投票— </em>它必须是<em class="mf">加权</em>和<em class="mf">多数投票</em>的混合来涵盖这种情况。</p><p id="111e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然，在现实生活中的测试表明，如果至少有一个模型预测“暂停”类，用户有非常高的概率确实在那一刻暂停。</p><p id="7245" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有这些观察给了我一套简单的规则，供我在投票算法中考虑:</p><ol class=""><li id="279f" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mz mr ms mt bi translated">如果一个模型预测“暂停”，记录“暂停”</li><li id="a9db" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mz mr ms mt bi translated">如果≥ 2个模型预测“A”类，记录“A”</li><li id="6bb0" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mz mr ms mt bi translated">如果所有模型预测不同的类别，使用来自<em class="mf">模型X </em>的预测</li></ol><p id="3422" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看，规则#2实现了<em class="mf">多数投票</em>方法，而规则#3利用了<em class="mf">加权投票</em>方法，通过给予<em class="mf">模型X </em>在不确定时期被选择的权利。</p><p id="c712" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在投票算法被纳入分类管道后，我能够主观和客观地注意到预测变得正确且不那么混乱了。</p><h1 id="a896" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">离群值随处可见</h1><p id="1576" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">然而，最终用户可以看到的锻炼统计数据仍然不完美:在锻炼期间没有执行的锻炼到处出现。</p><p id="f5d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一切都感觉有一些改进的空间，我开始将投票算法做出的预测与地面真相进行比较。当我知道我做了15秒长的<em class="mf">深蹲</em>，之后停顿20秒，然后是30秒的<em class="mf">弓箭步</em>时，在一次锻炼中，这3个动作中应该没有其他的训练项目。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/a7db09e4d0fe39a0ef7e66470efea298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7sUCNMdgal_ulfcxJNMBA.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Cells with red background contain incorrect predictions. Rows with a black background and bold text are latest exercises of each kind in a row.</figcaption></figure><p id="18cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的例子中，你可以看到用户不太可能在一直做<em class="mf">深蹲</em>的同时做几个<em class="mf">深蹲</em>动作(第6、9、11行)，也不太可能在做<em class="mf">深蹲</em>时多次做<em class="mf">暂停</em>或<em class="mf">深蹲</em>(第24、26、29行)。第21行告诉我们，与地面事实相比，弓箭步检测得太早。</p><p id="b932" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，也可能有例外，人们可以按照他们想要的任何顺序和序列进行练习，这使得检测异常(最有可能是不正确的预测)的问题几乎根本无法解决。</p><p id="239c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，我做了一个有根据的猜测，并决定设计一个算法，该算法将从给定锻炼时段的所有预测数组中检测并移除异常预测。</p><h1 id="0683" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">没有要检测的单一模式</h1><p id="a312" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">当谈到任何人类活动时，很难挑出会在用户之间重复的模式。所有人都是独一无二的，每个人的锻炼方式都不一样。</p><p id="c17b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我很难推导出这种异常预测检测算法的规则，因为异常预测<em class="mf">和</em>的可变性实在太大了。但是有了预测的基础，我可以发现最常见的模式来检测异常值，并得出以下规则:</p><ol class=""><li id="b83e" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mz mr ms mt bi translated">如果当前预测与下一个预测相同，则什么也不做。</li><li id="878d" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mz mr ms mt bi translated">如果当前预测与先前预测相同，则不采取任何措施。</li><li id="f159" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mz mr ms mt bi translated">如果前一个和下一个预测都不等于当前预测，则使用前一个预测。</li></ol><p id="80dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看在执行一次算法后，它如何帮助消除第6、9、21、24、26行中的红斑:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/aca518780b682455fc07cc21432cd33c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyhr9AJ4oAPEYY-pEIPZgA.png"/></div></div></figure><p id="4ce7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，异常值去除算法在第10行引入了另一个红点，也没有解决第11行的问题，因此我决定多次应用相同的算法:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/edf460d7e366e9adeea305ad3fdf621f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OLShYvrBhBhjm-neOl5OAg.png"/></div></div></figure><p id="a187" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过对我所拥有的练习模式进行实验，我发现对由投票算法产生的“原始”预测进行3次算法传递就足以去除大部分异常值，并使结果预测尽可能接近真实情况。</p><p id="9169" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了获得对算法的更大信心，我进行了一项测试，同时比较了仅应用投票算法的预测与异常值检测算法3次通过后获得的预测的基本事实的标准偏差:</p><ul class=""><li id="05f2" class="ml mm iq ka b kb kc kf kg kj mn kn mo kr mp kv mq mr ms mt bi translated">“原始”预测与基本事实的标准偏差:15.41</li><li id="3461" class="ml mm iq ka b kb mu kf mv kj mw kn mx kr my kv mq mr ms mt bi translated">从异常值检测算法获得的预测值与真实值的标准偏差:8.09</li></ul><p id="85da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">预测准确率提高了近2倍，不错！</p><h1 id="e7bb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="64fe" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">当然，在一些极端情况下，离群值检测算法会对原始数据产生扭曲，使一项或另一项锻炼持续几秒钟以上，但尽管如此，在分类器不能提供足够准确性的情况下，它在使锻炼统计数据看起来足够方面做得很好。</p><p id="bd05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">投票算法也是分类管道的重要补充，因为没有单一的分类器可以在检测健身运动中提供接近理想的准确性。</p><p id="6af5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两种方法使AutoWorkout应用程序能够更准确地检测运动活动，并提供更好的用户体验。</p><p id="a00a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://medium.com/@vmalyi" rel="noopener"> Medium </a>和<a class="ae kw" href="https://twitter.com/victormalyy" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，看看AutoWorkout应用程序如何使用机器学习来计算锻炼次数。</p></div></div>    
</body>
</html>