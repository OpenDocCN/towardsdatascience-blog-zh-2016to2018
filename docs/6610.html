<html>
<head>
<title>How to Set-up a cost-effective AWS EMR cluster and Jupyter Notebooks for SparkSQL (Updated Nov. 2020)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为 SparkSQL 设置经济高效的 AWS EMR 集群和 Jupyter 笔记本电脑(2020 年 11 月更新)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-set-up-a-cost-effective-aws-emr-cluster-and-jupyter-notebooks-for-sparksql-552360ffd4bc?source=collection_archive---------8-----------------------#2018-12-21">https://towardsdatascience.com/how-to-set-up-a-cost-effective-aws-emr-cluster-and-jupyter-notebooks-for-sparksql-552360ffd4bc?source=collection_archive---------8-----------------------#2018-12-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5f33" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">高级数据科学技能</h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/2eebd5b0d23593c988c4fc08cde7b9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a3B7uy7EftcBIe5vzvsSWw.jpeg"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Photo by <a class="ae ko" href="https://unsplash.com/@mjessier?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Myriam Jessier</a> on <a class="ae ko" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3891" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这是一篇基于我个人工作笔记的生活类文章。随着时间的推移，AWS 界面和选项发生了很大的变化，所以我会在空闲时间不断更新本文。</p><blockquote class="ln lo lp"><p id="c613" class="kp kq lq kr b ks kt ku kv kw kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">我在一家国际信息服务公司工作，处理来自各个领域的数百个数据源，因此本文的主题对我和许多其他人来说都很重要。不要浪费时间处理我已经有的问题！</p></blockquote><h1 id="74ac" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">入门指南</h1><p id="bd96" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">创建 EMR 集群有三种主要方式:</p><ol class=""><li id="560b" class="mx my it kr b ks kt kw kx la mz le na li nb lm nc nd ne nf bi translated">从头开始创建一个，这在本文中有详细介绍。</li><li id="9bce" class="mx my it kr b ks ng kw nh la ni le nj li nk lm nc nd ne nf bi translated">克隆现有的 EMR 集群。如果您正在克隆其他人的集群，您只需更改集群名称、指定您的 RSA 密钥、启用集群自动缩放并更改集群标签<em class="lq">(即</em> <code class="fe nl nm nn no b"><em class="lq">creator</em></code> <em class="lq">、</em> <code class="fe nl nm nn no b"><em class="lq">product</em></code> <em class="lq">等)。一些公司使用标签来自动应用规则到你的集群，像闲置 X 分钟自动终止，S3 数据访问权限和会计/预算。)</em>您要克隆的集群不必当前处于活动或运行状态，即它可以处于<code class="fe nl nm nn no b">terminated </code>或<code class="fe nl nm nn no b">running</code>状态。我喜欢使用如下的命名分类法，因为它具有足够的描述性和唯一性，我可以在以后的克隆中找到:<br/> <code class="fe nl nm nn no b">project-name_myuseridANYOUNG_DDMM_spark.<br/></code>一旦你创建了一个特定于你的项目类型的集群，这个过程在将来会更加简单，因为你不需要改变你的集群标签，只需要偶尔改变你的集群名称。</li><li id="798f" class="mx my it kr b ks ng kw nh la ni le nj li nk lm nc nd ne nf bi translated">使用 AWS CLI。这是最快最有效的方法。但是，这也是最先进的方法，并且配置最适合您项目的参数的前期成本很高。对于本文的读者来说，我只在尝试了前两种方法后才推荐这种方法。</li></ol><h1 id="f5bf" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 0:创建 EMR 集群</h1><p id="98aa" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">选择右上方的区域。区域影响成本和延迟，这与实时应用相关。点击<code class="fe nl nm nn no b">Create cluster</code>按钮。</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi np"><img src="../Images/374f099cf33110f34b43ddd1bed5841d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzh2BimS19tyhFgYImySog.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><h1 id="a570" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 1:软件配置</h1><p id="740d" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">点击<code class="fe nl nm nn no b">"Go to advanced Options."</code></p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nu"><img src="../Images/cc476acc1f32e978bf8bc213925487a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDUm5HsWFbCn7nj1pdq5NQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><p id="f282" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">选择如下所示的配置，然后单击下一步。</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nu"><img src="../Images/7f9b5e788226d4e804a669dce044a03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORXHUwppoEo3MLMdBva6mA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">I recommend installing more software than you need if: 1. you work on a variety projects 2. you want a one-size-fits-most cluster to clone in the future. Image source: author, taken Nov. 2020.</figcaption></figure><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nv"><img src="../Images/2e0b2bfc0d84076054fa4de2cb097ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R3UhWxL76NSBeFoMO0XVfA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author. Taken Nov. 2020.</figcaption></figure><p id="a633" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果您打算在笔记本中安装 Python/Scala 包和 SQL 函数，请确保选择的<code class="fe nl nm nn no b">Release</code>是<code class="fe nl nm nn no b">emr-5.30.0</code> <strong class="kr jd">。有些包，尤其是实现新算法的包，不能通过带有<code class="fe nl nm nn no b">!pip install</code>或<code class="fe nl nm nn no b">pypi</code>的笔记本安装在集群的所有节点上。在撰写本文时，无论是我还是多个企业 AWS 技术支持成员(国外和美国都有，如果这对你很重要的话)都无法在任何更高版本的<code class="fe nl nm nn no b">emr</code>上安装包，尽管进行了数周的试验。坦率地说，我在使用 emr-5.30.0 版本时没有遇到任何问题，尽管目前有这么多更新的版本。</strong></p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nw"><img src="../Images/10006ff6c317c0f79f4e9400d8a963d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVjHts2Fu58TYhxGN2xNDw.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Software configuration that I recommend for a one-size-fits-most cluster. Image source: author, taken Nov. 2020.</figcaption></figure><p id="762d" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">默认情况下，选择并安装 Hadoop、Hive 和 Ganglia 应用程序。你将不得不添加火花和其他你可能需要的。安装比您需要的更多的软件的后果是，集群将需要更长的启动时间，但在大多数情况下，额外的等待时间可以忽略不计。</p><p id="8a51" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">一个可选步骤优化您的集群以读取存储在 S3 的 Parquet 格式的文件，在 PySpark 数据框中处理它们，并防止在尝试从 Jupyter 笔记本中长时间运行 Spark 作业时出现常见错误。完成上述任务的代码，</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nx"><img src="../Images/5a70b3517c62089a7e474b65c6e1078d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUkreZy4hGRfRL9yuRL5nw.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><p id="e412" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">编辑软件设置，进入配置</strong>，添加以下 JSON 代码:</p><pre class="nq nr ns nt gt ny no nz oa aw ob bi"><span id="19c7" class="oc lv it no b gy od oe l of og">[{"classification":"spark","properties":{"maximizeResourceAllocation":"true"}},{"classification":"spark-defaults","properties":{"spark.network.timeout":"1500"}},{"classification":"hdfs-site","properties":{"dfs.replication":"2"}},{"classification":"livy-conf","properties":{"livy.server.session.timeout":"10h"}},{"classification":"emrfs-site","properties":{"fs.s3.maxConnections":"100"}}]</span></pre><p id="9a7c" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">解释:</p><pre class="nq nr ns nt gt ny no nz oa aw ob bi"><span id="9992" class="oc lv it no b gy od oe l of og">"maximizeResourceAllocation":"true" -- Configures your executors to utilize the maximum resources possible on each node in a cluster. This EMR-specific option calculates the maximum compute and memory resources available for an executor on an instance in the core instance group. It then sets the corresponding <!-- -->spark-defaults<!-- --> settings based on this information. [<a class="ae ko" href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark-configure.html#emr-spark-maximizeresourceallocation" rel="noopener ugc nofollow" target="_blank">reference</a>]</span><span id="f410" class="oc lv it no b gy oh oe l of og">"livy.server.session.timeout":"10h" -- addresses errors from long-running Spark tasks in a Jupyter/EMR notebook that die after an hour of execution: <br/>An error was encountered:<br/>Invalid status code '400' from https://xxx.xx.x.xxx:18888/sessions/0/statements/20 with error payload: "requirement failed: Session isn't active." [<a class="ae ko" href="https://stackoverflow.com/questions/54220381/how-to-set-livy-server-session-timeout-on-emr-cluster-boostrap" rel="noopener ugc nofollow" target="_blank">reference</a>]</span><span id="985d" class="oc lv it no b gy oh oe l of og">"fs.s3.maxConnections":"100" -- addresses the “Timeout waiting for connection from pool” error [<a class="ae ko" href="https://aws.amazon.com/premiumsupport/knowledge-center/emr-timeout-connection-wait/" rel="noopener ugc nofollow" target="_blank">reference</a>]</span></pre><h1 id="fe95" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 2:硬件配置</h1><p id="606a" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">选择内部 AWS 工程团队指定的<strong class="kr jd">网络</strong>和<strong class="kr jd">子网，或者保留默认设置</strong>。</p><p id="b67f" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">对于 Spark 作业，建议申请以下实例数量和类型:</p><p id="ff0a" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">1 个<strong class="kr jd">主</strong>节点实例、<br/> 1 个<strong class="kr jd">核心</strong>节点实例、<br/> 1 个<strong class="kr jd">任务</strong>节点实例各 1-3 种不同类型，即<code class="fe nl nm nn no b">r4.2xlarge</code>、<code class="fe nl nm nn no b">r5.2xlarge</code>、<code class="fe nl nm nn no b">r5.4xlarge</code>等。</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nu"><img src="../Images/d59671ee3f482186735cdfe7a2d7b90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6sWaxTc-Q8qUKm3yGgXakg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><p id="3fb0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">对于任务节点，选择<strong class="kr jd">现货</strong>定价，选择<strong class="kr jd">按需作为最高价格</strong>。我们愿意为主节点和核心节点支付“按需”价格，因为主节点总是需要对我们连续可用，而任务节点可以基于市场定价(“现货”定价)来来去去。</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oi"><img src="../Images/9c6d1215d549855067122a4d6775b15d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6Hkm0DNIscFcfjS2k_53Q.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><p id="d35b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在我上面的截图中，我显示按需价格是每实例小时 0.192 美元；相同实例类型、地区和日期的现货价格显示在左侧:0.040 美元/实例小时。<strong class="kr jd">按需定价</strong>几乎贵了 5 倍！</p><blockquote class="ln lo lp"><p id="7b47" class="kp kq lq kr b ks kt ku kv kw kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">我推荐固定数量的实例的原因是因为我们正在构建一个<strong class="kr jd">自动伸缩的集群:</strong>实例的数量将根据您的工作的计算压力和您指定的自动伸缩规则而增加或减少。</p></blockquote><p id="2f28" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在实施自动扩展规则之前，为每个<strong class="kr jd"> EBS 卷实例</strong>将<strong class="kr jd">核心和任务</strong>节点的<strong class="kr jd"> EBS 存储</strong>类型调整到至少 500 GB 的<strong class="kr jd">吞吐量优化 HDD (ST1) </strong>。您还可以为每个“<strong class="kr jd"> EBS 卷实例</strong>”增加“<strong class="kr jd">实例</strong>的数量一般来说，我有两个卷实例，每个实例有 500 GB，核心总共有 1000 GB。如果您正在处理大数据，请添加更多实例/内存。<strong class="kr jd">主</strong>节点不需要 EBS 存储。</p><p id="9cf3" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="lq">当在 S3 使用 Spark 时，中间数据被写入磁盘临时本地存储，而不是在 HDFS，因此当处理大型数据集时，为实例提供更多存储是有用的。我们选择 500 GB 的硬盘驱动器(HDD)而不是固态驱动器(SSD)上的 32 GB 存储，因为写入速度的瓶颈将是互联网速度而不是 HDD 写入速度，并且 HDD 更便宜。</em></p><h1 id="15e1" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 2*:集群扩展(2020 年 7 月发布)</h1><p id="92da" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">这对我来说是最重要的一步，也是 AWS 在 2020 年 7 月 7 日发布了<a class="ae ko" href="https://aws.amazon.com/blogs/big-data/introducing-amazon-emr-managed-scaling-automatically-resize-clusters-to-lower-cost/" rel="noopener ugc nofollow" target="_blank"> EMR 管理的自动缩放功能后最简单的一步。这曾经是一个非常痛苦、耗时的过程，但现在变得非常容易。自动缩放是这样完成的:</a></p><p id="49a1" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">选中<code class="fe nl nm nn no b">Enable Cluster Scaling</code>并使用默认<code class="fe nl nm nn no b">Use EMR-managed scaling.</code>主节点不可伸缩，因此这只影响核心和任务节点。</p><blockquote class="ln lo lp"><p id="5137" class="kp kq lq kr b ks kt ku kv kw kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">根据我正在做的事情，我喜欢将核心和任务节点的最小数量保持在 1 到 3 之间。1 如果我正在试验一个新项目，3 如果我想安全行事，保证在关键任务的最后期限内不会出现任何问题。</p></blockquote><ul class=""><li id="3c4f" class="mx my it kr b ks kt kw kx la mz le na li nb lm oj nd ne nf bi translated"><strong class="kr jd">简单来说:核心节点是数据存储，任务节点是计算</strong>。处理更大的数据？允许更多的核心节点以避免内存问题(进一步阅读:<a class="ae ko" href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-master-core-task-nodes.html" rel="noopener ugc nofollow" target="_blank"> AWS 文档</a>)</li><li id="d725" class="mx my it kr b ks ng kw nh la ni le nj li nk lm oj nd ne nf bi translated"><strong class="kr jd">将最大节点数设置为一个较大但合理的数值。我根据自己的项目选择 250 到 1000 之间的一个数字。</strong>在理论和实践中，最大数量的节点只会在需要的时候被征用。但是，从理论上讲，用户错误和/或未知的未知因素也有可能导致您的集群占用大量接近无穷大的节点。一个合理的数字是一个防止预算超支的数字，并允许对你的最大燃烧速度进行一些控制。在三年多的时间里，我经常在 AWS 上处理数十 Pb 的数据，最大节点数不超过 1000 个，没有出现任何问题。</li><li id="31f2" class="mx my it kr b ks ng kw nh la ni le nj li nk lm oj nd ne nf bi translated">将<strong class="kr jd">按需限制</strong>设置为 0。我们不想为节点支付按需价格，因为它们比现货价格高 5 倍！我将随时以现货价格(每实例小时 0.040 美元)购买一个<strong class="kr jd"> m5.xlarge </strong>节点，而不是以按需价格(每实例小时 0.100 美元)购买一个<strong class="kr jd"> m4.large </strong>节点！(注意，这是指定多个实例类型允许您“套利”AWS 节点投标系统的地方，因为您可以以更低的采购成本获得更大的能力)。</li><li id="a323" class="mx my it kr b ks ng kw nh la ni le nj li nk lm oj nd ne nf bi translated">将最大核心节点设置为接近但不等于最大值的高值。在下面的例子中，我将其设置为 200，最多 250 个节点。我这样做是为了让我的集群可以自由地分配我的节点；如果我需要的核心节点比任务节点多，那就给我弄来。</li></ul><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ok"><img src="../Images/11bda696ca974f9c7e1ae3714372ab92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybWyGTJB61ImPgHVrXpNxA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><h1 id="c2c4" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 3:常规集群设置</h1><p id="c7ad" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">下面的要点后面提供了截图示例。</p><ul class=""><li id="31b6" class="mx my it kr b ks kt kw kx la mz le na li nb lm oj nd ne nf bi translated">描述性地命名集群。这使您能够记住它的用途以及您仅通过查看名称就能设置的一些参数。我喜欢使用如下所示的集群命名分类法，因为它具有足够的描述性和唯一性，便于我日后进行克隆:<br/> <code class="fe nl nm nn no b">project-name_myuseridANYOUNG_DDMM_spark.</code></li><li id="c817" class="mx my it kr b ks ng kw nh la ni le nj li nk lm oj nd ne nf bi translated">始终启用<strong class="kr jd">记录</strong>和<strong class="kr jd">调试</strong>。您需要同时启用这两个功能，以便对错误进行故障排除，或者在 AWS 技术支持下进行调试。</li><li id="6084" class="mx my it kr b ks ng kw nh la ni le nj li nk lm oj nd ne nf bi translated">填写标签中的标签，以帮助跟踪贵公司工程团队指定的使用情况、预算和自动化集群策略。下面是标签示例:</li></ul><p id="2fc0" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kr jd">创建者</strong>:输入你的名字或其他一些唯一的标识符。<br/> <strong class="kr jd">项目</strong>:一个详细描述你正在进行的项目的有用名称。<br/> <strong class="kr jd">部门</strong>:【数据科学 R &amp; D、数据科学分析、其他】<br/> <strong class="kr jd">环境</strong>:【开发、测试、生产】</p><p id="d623" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">克隆此群集时会复制这些设置，因此如果您要克隆其他人的群集，请根据需要进行更改。如果您正在克隆您自己的旧集群，您可能不需要做太多改变！</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ol"><img src="../Images/9c5d71798d9fcd13d890c48bda6eca0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*48M_qsEiXJG025MNEigYvw.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><h1 id="91c2" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 3*:引导安装脚本</h1><p id="fc56" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">您需要一个引导脚本来在 EMR 集群的所有节点上安装软件包。以下是实现这一点的步骤:</p><ol class=""><li id="868d" class="mx my it kr b ks kt kw kx la mz le na li nb lm nc nd ne nf bi translated">用以下内容创建一个<code class="fe nl nm nn no b">.sh</code>文件并保存在 S3:</li></ol><figure class="nq nr ns nt gt kd"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Author’s code</figcaption></figure><pre class="nq nr ns nt gt ny no nz oa aw ob bi"><span id="d922" class="oc lv it no b gy od oe l of og">#!/bin/bash -xe</span><span id="5db5" class="oc lv it no b gy oh oe l of og">sudo pip install \<br/> pandas \<br/> numpy \<br/> xgboost \<br/> scikit-learn \<br/> nbextensions</span></pre><p id="ac91" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.指定引导操作脚本 S3 位置:</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ol"><img src="../Images/32cdca2562191cf64096e2057e8ac992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWjKJSDtOr3iOexEi8L8vA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><h1 id="fdfb" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 4:安全设置</h1><p id="154a" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">如果您在大型企业环境中工作，您可能需要指定这些设置。选择您的 EC2 密钥对和 EC2 实例角色。我将撰写另一篇文章，介绍如何创建 EC2 密钥对，允许登录主节点进行故障排除/测试。下面的截图是一个虚拟的 AWS 帐户，所以我没有创建 EC2 密钥对，因此警告说不能 SSH 到它。</p><figure class="nq nr ns nt gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ol"><img src="../Images/5f046d9bab2c1d1007d7220ebd5b9dfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-lejrm-Fv4Mg25yUz36oLQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Image source: author, taken Nov. 2020.</figcaption></figure><h1 id="0b30" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">步骤 5:创建后监视集群</h1><p id="3a66" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">点击<strong class="kr jd">创建集群</strong>后，仪表盘页面显示状态为<strong class="kr jd">开始</strong>，设置完成后变为<strong class="kr jd">【等待】</strong>。</p><p id="a544" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">请注意，您可以对正在运行的 EMR 集群进行动态调整。例如，您可以通过克隆一个“step”脚本并在 S3 将输入文件更改为新上传或修改的<code class="fe nl nm nn no b">.sh</code>脚本来安装软件。</p><h1 id="b6fc" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">第六步:使用电子病历笔记本(2018 年 11 月发布)</h1><p id="59c1" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">命名并配置您的笔记本。将其附加到您创建的 EMR 集群。即使在 EMR 集群终止后，笔记本仍然存在。EMR 笔记本很好，因为您可以通过浏览器连接，每个包含 PySpark 代码的单元格在执行后都有其作业进度跟踪。</p><h1 id="0dd5" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">关于作者</h1><p id="2c21" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">安德鲁·杨是 Neustar 的 R&amp;D 数据科学家经理。例如，Neustar 是一家信息服务公司，从航空、银行、政府、营销、社交媒体和电信等领域的数百家公司获取结构化和非结构化的文本和图片数据。Neustar 将这些数据成分结合起来，然后向企业客户出售具有附加值的成品，用于咨询、网络安全、欺诈检测和营销等目的。在这种情况下，Young 先生是 R&amp;D 一个小型数据科学团队的实践型首席架构师，负责构建、优化和维护一个为所有产品和服务提供信息的系统，该系统为 Neustar 带来了超过 10 亿美元的年收入。(在 LinkedIn<a class="ae ko" href="https://bit.ly/2X4uJzX" rel="noopener ugc nofollow" target="_blank">上关注他，了解数据科学的最新趋势！)</a></p><h1 id="aa5a" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">更多热门文章:</h1><ul class=""><li id="bd2b" class="mx my it kr b ks ms kw mt la oo le op li oq lm oj nd ne nf bi translated"><a class="ae ko" rel="noopener" target="_blank" href="/isolation-forest-is-the-best-anomaly-detection-algorithm-for-big-data-right-now-e1a18ec0f94f">隔离森林是目前最好的大数据异常检测算法</a></li><li id="755f" class="mx my it kr b ks ng kw nh la ni le nj li nk lm oj nd ne nf bi translated"><a class="ae ko" rel="noopener" target="_blank" href="/must-know-presentation-tools-for-the-effective-data-scientist-93e618ffc8c2">高效数据科学家必备的演示工具</a></li></ul><h1 id="3119" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">过时的说明(备案)</h1><p id="82ad" class="pw-post-body-paragraph kp kq it kr b ks ms ku kv kw mt ky kz la mu lc ld le mv lg lh li mw lk ll lm im bi translated">由于 AWS Engineering 于 2020 年 7 月 7 日发布，以下说明已过时:<a class="ae ko" href="https://aws.amazon.com/blogs/big-data/introducing-amazon-emr-managed-scaling-automatically-resize-clusters-to-lower-cost/" rel="noopener ugc nofollow" target="_blank">引入 Amazon EMR 托管扩展—自动调整集群大小以降低成本</a></p><p id="8856" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">接下来，定义自动扩展策略。对于<strong class="kr jd">核心</strong>节点，将最大实例数设置为 100(或其他合理的值)，将最小实例数设置为 1。选中规则中默认的<strong class="kr jd">横向扩展</strong>和<strong class="kr jd">比例的复选框，因为它们性能良好。对于<strong class="kr jd">任务</strong>节点类型，将最大实例数设置为 50，最小实例数设置为 0。检查</strong>规则中默认<strong class="kr jd">横向扩展</strong>和<strong class="kr jd">比例的复选框，因为它们执行良好。如果由于某种原因默认规则不可见，请手动添加它们。有两个<strong class="kr jd">横向扩展</strong>规则:</strong></p><ol class=""><li id="5edf" class="mx my it kr b ks kt kw kx la mz le na li nb lm nc nd ne nf bi translated">“rule1”:如果<strong class="kr jd">YARNMemoryAvailablePercentage</strong>比 T22】15 小<strong class="kr jd"> 1 </strong>五分钟，冷却时间<strong class="kr jd"> 300 </strong>秒，则增加<strong class="kr jd"> 1 </strong>实例。</li><li id="c04d" class="mx my it kr b ks ng kw nh la ni le nj li nk lm nc nd ne nf bi translated">“规则 2”:如果<strong class="kr jd"> ContainerPendingRatio </strong>大于 0.75<strong class="kr jd">0.75</strong>持续<strong class="kr jd"> 1 </strong>五分钟，冷却时间为<strong class="kr jd"> 300 </strong>秒，则添加<strong class="kr jd"> 1 </strong>实例。</li></ol><p id="c857" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在标尺中增加一个<strong class="kr jd">标尺:</strong></p><ol class=""><li id="02a1" class="mx my it kr b ks kt kw kx la mz le na li nb lm nc nd ne nf bi translated">“rule1t”:如果<strong class="kr jd">YARNMemoryAvailablePercentage</strong>大于 <strong class="kr jd"> 75 </strong>持续<strong class="kr jd"> 1 </strong>五分钟，冷却时间为<strong class="kr jd"> 300 </strong>秒，则终止<strong class="kr jd"> 1 </strong>实例。</li></ol><p id="4c9b" class="pw-post-body-paragraph kp kq it kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="lq">任何横向扩展规则都不能与任何纵向扩展规则同名。注意，最大实例数在技术上是任意的，但是为了安全起见，不要给出一个荒谬的数字。大致来说，运行 10 小时的 10 节点集群的成本与运行 1 小时的 100 节点集群的成本相同，因此最好在需要时征用所需的节点。</em></p></div></div>    
</body>
</html>