<html>
<head>
<title>Gaussian Mixture Model clustering: how to select the number of components (clusters)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高斯混合模型聚类:如何选择分量(聚类)数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/gaussian-mixture-model-clusterization-how-to-select-the-number-of-components-clusters-553bef45f6e4?source=collection_archive---------2-----------------------#2018-11-21">https://towardsdatascience.com/gaussian-mixture-model-clusterization-how-to-select-the-number-of-components-clusters-553bef45f6e4?source=collection_archive---------2-----------------------#2018-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5b23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你看到了这篇文章，你可能已经知道什么是高斯混合模型，所以我将避免对这种技术的一般性描述。</p><p id="d738" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果你不知道细节，你可以把 GMM 看作是一个 k-means，它能够形成拉伸的簇，就像你在图 2 中看到的那样。</p><p id="3d8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个帖子使用的所有代码都是这个笔记本中的<a class="ae kl" href="https://github.com/vlavorini/ClusterCardinality/blob/master/Cluster%20Cardinality.ipynb" rel="noopener ugc nofollow" target="_blank">。在同一个</a><a class="ae kl" href="https://github.com/vlavorini/ClusterCardinality" rel="noopener ugc nofollow" target="_blank">仓库</a>中，你可以找到完全复制你所看到的绘制结果的数据。</p><p id="5852" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在:假设您处于图 1 中描述的情况，您想要辨别我们有多少个集群(或者，如果您喜欢，有多少高斯分量生成了数据)，并且您没有关于“基础事实”的信息。一个真实的例子，数据没有模拟数据表现的好。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/26e00d5b6615d664f5dbfaa505a229a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ow6_Gqqf9-6JIfmn43nv1A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk"><strong class="bd lc">Figure 1:</strong> The vecotrs we are going to cluster. The transparency on the points reflects the density.</figcaption></figure><p id="78b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">乍一看，人们可能会大叫“三个主星系团加上两个副星系团！”。也许这是正确的，但是这里我们想要检查一个自动的方法来找到“正确的”集群数。</p><p id="fee1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，这个“正确”的数字无论如何都是一个模糊的数字，因为每个问题的特殊性都可能导致人们决定克服自动算法的决定。</p><p id="1a50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是让我介绍一下我们刚刚宣布的配置(五个集群)的 GMM 结果。在下图(<strong class="jp ir">图 2 </strong>)中，我们为我们的数据拟合了一个包含五个组件的 GMM。我们有第一个问题:同样的数据，同样的模型，但是不同的结果。</p><div class="kn ko kp kq gt ab cb"><figure class="ld kr le lf lg lh li paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/596d32b3afa81df75921bcb416614bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UZRRyYnZ2naAg_2MdwdGkg.png"/></div></figure><figure class="ld kr le lf lg lh li paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/2c13ffbec7e14016ad4ceccd5164f6f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7EElitYX6YvJnc1cqQcWIA.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk lj di lk ll"><strong class="bd lc">Figure 2: </strong>Clusters shapes: since the algorithm we rely on is not deterministic, we can have very different results!</figcaption></figure></div><p id="fb10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种行为的罪魁祸首是拟合过程:期望值最大化(EM)算法。这种算法只能保证我们到达一个局部最优点，但不能保证这个局部最优点也是全局最优点。因此，如果算法从不同的初始化点开始，通常会进入不同的配置。</p><p id="98d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然有其他方法适合 GMM，但我们想坚持使用这一种:其他方法更复杂，需要设置更多的超参数；这超过了这篇文章的目标。</p><p id="2a38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我们必须考虑我们的家伙的不确定性。</p><p id="f97a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最简单的处理方法是多次运行拟合程序，并考虑每个配置的平均值和标准偏差。简而言之:我们考虑了每次拟合的误差。</p><h1 id="abce" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">集群性能评估</h1><p id="737a" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">因为我们不知道我们的聚类生成器的基本事实，即我们不知道生成数据的原始分布，所以我们关于聚类过程的性能评估的选择是有限的并且相当嘈杂。</p><p id="0566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管如此，我们将探索三种不同的技术。</p><h2 id="4cf2" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">剪影分数</h2><p id="0089" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">这个分数，正如 SKLearn 的开发者所说，考虑了两个标准:</p><ul class=""><li id="dd7c" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">样本与同一聚类中所有其他点之间的平均距离。</li><li id="af6b" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">样本与<em class="np">下一个最近簇</em>中所有其他点之间的平均距离。</li></ul><p id="bb3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也就是说，它检查簇的紧密程度和分离程度。分数越接近 1，聚类越好。</p><p id="8c0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们已经知道拟合过程是不确定的，所以我们对每个聚类数运行二十次拟合，然后我们考虑最佳五次运行的平均值和标准偏差。结果在<strong class="jp ir">图 3 </strong>中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nq"><img src="../Images/0ff1e6d9a175c83b807060491823b0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Q5kcr8XQJLir6DUG282ww.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk"><strong class="bd lc">Figure 3: </strong>Silhouette scores for our dataset</figcaption></figure><p id="1c1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明，我们用五个群集得到了最好的分数。如果我们考虑两种配置的标准偏差(“误差”)，我们还必须考虑四群集配置几乎同样好。所以，这个分数并没有给我们一个明确的结果。</p><h2 id="388c" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">GMM 之间的距离</h2><p id="520f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">这里我们形成两个数据集，每个数据集有一半随机选择的数据量。然后，我们将检查对于每个配置，在这两个集合上训练的 GMM 有多少是相似的。</p><p id="7a04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们在讨论分布，相似性的概念就嵌入了<a class="ae kl" href="https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence" rel="noopener ugc nofollow" target="_blank">詹森-香农(JS)指标</a>。两个 GMM 之间的 JS 距离越小，GMM 就越同意如何拟合数据。</p><p id="7e35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有的功劳都在(漂亮！)计算詹森-香农度规的方法转到<a class="ae kl" href="http://www.gatsby.ucl.ac.uk/~dougals/" rel="noopener ugc nofollow" target="_blank"> Dougal </a>，并转到它在<a class="ae kl" href="https://stackoverflow.com/questions/26079881/kl-divergence-of-two-gmms" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>上的帖子。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nr"><img src="../Images/7713a3083827850cab76f0205543efc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l8qfMomHiHmS2aawUfFcQA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Figure 4: Distance between half data GMMs</figcaption></figure><p id="690f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照这种技术，具有三个集群的配置是最保守的；这并不一定意味着它是好的配置，因为我们只是在谈论两组结果的可重复性。</p><p id="72e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该图有趣的部分是我们在通过六个集群配置后看到的距离的突然变化:平均距离及其相关误差都显示出巨大的增加。</p><p id="e701" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着从七个聚类开始，两个集合的 GMM 差异更大(因为距离更大)，并且也更不稳定(因为误差带更大)。</p><p id="cdbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以说，考虑到所包含的信息量(=最大可能的聚类数)和拟合过程的稳定性(=最低可能的 GMMs 距离)的良好配置是考虑了<strong class="jp ir">六个</strong>聚类的配置。</p><h2 id="c153" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated"><strong class="ak">贝叶斯信息准则</strong> (BIC)</h2><p id="c76d" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">这个标准给了我们一个估计，在预测我们实际拥有的数据方面，GMM 有多好。BIC 越低，模型就越能准确预测我们拥有的数据，进而预测真实的未知分布。为了避免过度拟合，该技术对具有大量聚类的模型进行惩罚。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ns"><img src="../Images/830fec43504edaa926ae7ba1f0b7d4d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*360DP4OfT2aIyGPDFQiWEg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk"><strong class="bd lc">Figure 5: </strong>Bayesian information criterion scores as function of the number of normal components (clusters) forming the GMMs.</figcaption></figure><p id="cf66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照这个标准，聚类的数量越大，模型就应该越好。这意味着 BIC 标准对复杂模型的惩罚并没有使我们免于过度拟合。或者，用更通俗的话来说，这个分数糟透了。至少以这种基本形式。</p><p id="75c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是在叫嚣和摒弃这项技术之前，我们可以注意到两件事。首先是曲线相当平滑和单调。第二，曲线的不同部分遵循不同的斜率。从这两个观察开始，检查 BIC 曲线变化斜率大的地方的诱惑就大了。所以我们来检查一下！</p><p id="11b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从技术上讲，我们必须计算 BIC 得分曲线的<em class="np">梯度</em>。直观上，梯度的概念很简单:如果两个连续的点有相同的值，那么它们的梯度为零。如果它们具有不同的值，如果第二个点具有较低的值，则它们的梯度可以是负八分之一，否则是正八分之一。梯度的大小告诉我们这两个值相差多少。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nt"><img src="../Images/6dcb16700fdcad2d76ce08cabff504f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4asd_CvbnUGroC73WBVOQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Figure 6: plot of the gradients of the curve in <strong class="bd lc">Figure 5</strong></figcaption></figure><p id="f444" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如所料，所有的梯度都有负值。但是我们更清楚地看到，从 7 个簇的大小开始，梯度变得几乎恒定，即原始函数具有更平缓的下降，即增加簇的数量没有太大的增益。简而言之，这项技术建议我们使用六个集群。</p><h1 id="cff5" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">最终决定:改变模式</h1><p id="8972" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们探索了三种不同的技术来选择可以在该数据集中辨别的正确的聚类数。结果如下表所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/833dd406f15c6eddc6f63ae5c52e9572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*qmT3TRRgzt8-10dyu-gIUQ.png"/></div></figure><p id="3e5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使决策是相似的，也没有一个所有策略都认同的明确的价值观。在这种特定情况下，这意味着 GMM 不是对我们的数据进行聚类的好模型。</p><p id="fba9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以捕捉到的另一个症状是，BIC 的轮廓和梯度都显示了第二个值，几乎与选择一个值一样好:4 几乎与 5 一样好的轮廓，5 几乎与 6 一样好的 BIC 分数的梯度。</p><p id="f868" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有人可能会说只取五个(<em class="np">在 medio stat virtus </em>中)作为集群的正确数量，但这可能不是最佳选择。事实证明，这并不是针对我的具体问题。</p><p id="3af8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是因为星团没有显示出清晰的对称(类似椭圆形)形状，因此它们不能用一个二维高斯模型来近似，就像你在<strong class="jp ir">图 7 </strong>中看到的那样，而是对称的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nv"><img src="../Images/f30beddd973e054019697856a2288ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGSRf2PEFXcHqScxCWIneA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Figure 7: a bi-variate normal distribution.</figcaption></figure><p id="8507" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢阅读！</p></div></div>    
</body>
</html>