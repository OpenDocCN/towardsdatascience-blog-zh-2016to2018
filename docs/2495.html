<html>
<head>
<title>Sharing Your SageMaker Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分享你的SageMaker模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sharing-your-sagemaker-model-eaa6c5d9ecb5?source=collection_archive---------8-----------------------#2018-02-01">https://towardsdatascience.com/sharing-your-sagemaker-model-eaa6c5d9ecb5?source=collection_archive---------8-----------------------#2018-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/66cbf2826079e9938587c9e31e85abb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JO0jkFVX-RN0jwTYu3yjsg.png"/></div></div></figure><p id="7443" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">本文原载于</em>【blog.zakjost.com】<em class="kw"/></p><p id="0359" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS最近发布了<a class="ae kx" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank"> SageMaker </a>，它可以帮助你从零开始构建模型，到部署和扩展这些模型以用于生产。本文将假设您已经在SageMaker中运行了一个模型，并希望授予对另一个AWS帐户的访问权限，以便使用您的模型进行预测。</p><h1 id="384a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">从父帐户向子帐户授予(有限)权限</h1><p id="754f" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在较高层次上，您需要创建一个有权调用端点的角色，然后授予子帐户对此角色的访问权限。为此，您需要孩子帐户的12位帐户id。然后，按照以下步骤操作:</p><ul class=""><li id="2ea6" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">登录父帐户控制台并导航到IAM服务</li><li id="c46f" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">创建名为“SageMakerExternalInvokeEndpoint”的新策略。粘贴以下策略。请注意括号中您需要输入的数据。</li></ul><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="2d30" class="my kz iq mu b gy mz na l nb nc">{</span><span id="724c" class="my kz iq mu b gy nd na l nb nc">    "Version": "2012-10-17",</span><span id="bdd8" class="my kz iq mu b gy nd na l nb nc">    "Statement": [</span><span id="c17a" class="my kz iq mu b gy nd na l nb nc">        {</span><span id="c2d9" class="my kz iq mu b gy nd na l nb nc">            "Action": ["sagemaker:InvokeEndpoint"],</span><span id="34e2" class="my kz iq mu b gy nd na l nb nc">            "Effect": "Allow",</span><span id="dc0e" class="my kz iq mu b gy nd na l nb nc">            "Resource": "arn:aws:sagemaker:*:&lt;parent   account_id&gt;:endpoint/&lt;endpoint name&gt;”</span><span id="6346" class="my kz iq mu b gy nd na l nb nc">        }</span><span id="7ea9" class="my kz iq mu b gy nd na l nb nc">    ]</span><span id="be2a" class="my kz iq mu b gy nd na l nb nc">}</span></pre><ul class=""><li id="9696" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">单击“角色”并创建“SageMakerExternal”角色</li><li id="26c5" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">选择“另一个AWS帐户”并粘贴子帐户id</li><li id="ffc9" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">附加新的“SageMakerExternalInvokeEndpoint”策略(单击“策略类型”箭头“客户管理”，然后选择“SageMakerExternalInvokeEndpoint”)</li><li id="9a2e" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">单击新角色并复制角色arn，这将在后面的步骤中使用。</li></ul><h1 id="0863" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">向子帐户授予“承担角色”策略</h1><p id="e137" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">本部分将授予承担刚刚由子帐户创建的角色的能力。您将需要上述最后一步中的角色arn。</p><ul class=""><li id="525a" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">使用子帐户登录到控制台-&gt; IAM</li><li id="5218" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">如果您没有群，请创建一个。我把我的叫做“SagemakerTester”。如果您有现有用户，您可以将他们添加到组中。</li><li id="6b07" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">单击“权限”选项卡，展开“内联策略”箭头，然后创建组策略。添加此策略:</li></ul><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="13af" class="my kz iq mu b gy mz na l nb nc">{</span><span id="ce7f" class="my kz iq mu b gy nd na l nb nc">“Version”: “2012–10–17”,</span><span id="57bb" class="my kz iq mu b gy nd na l nb nc">    “Statement”: {</span><span id="c6a7" class="my kz iq mu b gy nd na l nb nc">        “Effect”: “Allow”,</span><span id="4dd4" class="my kz iq mu b gy nd na l nb nc">        “Action”: “sts:AssumeRole”,</span><span id="6eff" class="my kz iq mu b gy nd na l nb nc">        “Resource”: “&lt;SageMakerExternal role arn copied above&gt;“</span><span id="6084" class="my kz iq mu b gy nd na l nb nc">    }</span><span id="3199" class="my kz iq mu b gy nd na l nb nc">}</span></pre><h1 id="eb4c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用Boto3中的假定角色</h1><p id="533e" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在权限已经配置好了，您需要能够在尝试访问端点时承担这个角色。如果您使用的是Boto3，代码将如下所示:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="a1f4" class="my kz iq mu b gy mz na l nb nc"># Get temporary assumed role credentials</span><span id="4045" class="my kz iq mu b gy nd na l nb nc">client = boto3.client('sts') #assumes you’ve configured boto with normal child account credentials</span><span id="bdac" class="my kz iq mu b gy nd na l nb nc">response = client.assume_role(</span><span id="fb40" class="my kz iq mu b gy nd na l nb nc">    RoleArn="&lt;SageMakerExternal role arn copied above&gt;",</span><span id="9111" class="my kz iq mu b gy nd na l nb nc">    RoleSessionName="testSessionName", # this is arbitrary</span><span id="757a" class="my kz iq mu b gy nd na l nb nc">    ExternalId=‘&lt;parent account_id&gt;’ </span><span id="f2e2" class="my kz iq mu b gy nd na l nb nc">)</span><span id="9608" class="my kz iq mu b gy nd na l nb nc"># Create boto client using temp credentials</span><span id="33d2" class="my kz iq mu b gy nd na l nb nc">client = boto3.client(</span><span id="1167" class="my kz iq mu b gy nd na l nb nc">    'sagemaker-runtime',</span><span id="fe1f" class="my kz iq mu b gy nd na l nb nc">    aws_access_key_id=response["Credentials"]["AccessKeyId"],</span><span id="9011" class="my kz iq mu b gy nd na l nb nc">    aws_secret_access_key=response["Credentials"]["SecretAccessKey"],</span><span id="fa6a" class="my kz iq mu b gy nd na l nb nc">    aws_session_token=response["Credentials"]["SessionToken"],</span><span id="83b8" class="my kz iq mu b gy nd na l nb nc">)</span><span id="497b" class="my kz iq mu b gy nd na l nb nc"># Invoke endpoint</span><span id="453d" class="my kz iq mu b gy nd na l nb nc">client.invoke_endpoint(</span><span id="e15f" class="my kz iq mu b gy nd na l nb nc">    EndpointName=&lt;endpoint_name&gt;,</span><span id="2470" class="my kz iq mu b gy nd na l nb nc">    Body=&lt;data&gt;</span><span id="874b" class="my kz iq mu b gy nd na l nb nc">)</span></pre></div></div>    
</body>
</html>