<html>
<head>
<title>Introduction to Interactive Time Series Visualizations with Plotly in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中使用 Plotly 的交互式时间序列可视化简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-interactive-time-series-visualizations-with-plotly-in-python-d3219eb7a7af?source=collection_archive---------3-----------------------#2018-12-15">https://towardsdatascience.com/introduction-to-interactive-time-series-visualizations-with-plotly-in-python-d3219eb7a7af?source=collection_archive---------3-----------------------#2018-12-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/039bd76a42182f74f7434a745c11b36a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfgpgiWVNuR6HAK_bPEURQ.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">(<a class="ae jd" href="https://www.pexels.com/photo/scenic-view-of-agricultural-field-against-sky-during-sunset-325944/" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><div class=""/><div class=""><h2 id="fc74" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">使用强大的 plotly 可视化库启动和运行</h2></div><p id="f3d9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总有一天，即使是最喜爱的工具，也有必要放弃。Matplotlib 实现了快速创建简单图表的目的，但我对定制图表或做一些看似简单的事情(如让 x 轴正确显示日期)所需的代码量感到沮丧。</p><p id="6312" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有一段时间，我一直在寻找一个替代方案——不是完全的替代方案，因为 Matplotlib 对探索仍然有用——理想情况下，一个具有交互元素的库，让我专注于我想展示的内容，而不是陷入如何展示它的细节中。进入<a class="ae jd" href="https://plot.ly/#/" rel="noopener ugc nofollow" target="_blank"> plotly </a>，一个声明式可视化工具，带有一个<a class="ae jd" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank">易于使用的 Python 库</a>用于交互式图形。</p><p id="d3a0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将通过创建基本的时间序列可视化来介绍 plotly 库。这些图表虽然很容易制作，但将是完全交互式的图表，随时可供展示。在这个过程中，我们将学习该库的基本思想，这将使我们能够快速构建令人惊叹的可视化效果。如果你一直在寻找 matplotlib 的替代品，那么正如我们将看到的，plotly 是一个有效的选择。</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ls"><img src="../Images/f0af419793f6c24afa05b7b92146b9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jqG98mxfYyivFuYMuxjzcA.gif"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Interactive Visualization made with a few lines of Plotly code</figcaption></figure><p id="3195" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文的完整代码在 GitHub 上有<a class="ae jd" href="https://github.com/WillKoehrsen/Data-Analysis/blob/master/plotly/plotly-time-series.ipynb" rel="noopener ugc nofollow" target="_blank">。您还可以在 nbviewer </a>上查看带有<a class="ae jd" href="http://nbviewer.jupyter.org/github/WillKoehrsen/Data-Analysis/blob/master/plotly/plotly-time-series.ipynb" rel="noopener ugc nofollow" target="_blank">交互元素的笔记本。本文中使用的数据是我在 Cortex Building Intelligence 工作时获得的匿名建筑能源时间序列数据。如果你想用你的网络开发技能来帮助建筑节能，那么</a><a class="ae jd" href="https://angel.co/cortex-2/jobs/383105-software-engineer" rel="noopener ugc nofollow" target="_blank">联系我们，因为我们正在招聘</a>！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="3258" class="me mf jg bd mg mh mi mj mk ml mm mn mo km mp kn mq kp mr kq ms ks mt kt mu mv bi translated">Plotly 简介</h1><p id="f86c" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated"><a class="ae jd" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>是一家制作可视化工具的公司，包括一个<a class="ae jd" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank"> Python API 库</a>。(Plotly 还制作了<a class="ae jd" href="https://plot.ly/products/dash/" rel="noopener ugc nofollow" target="_blank"> Dash </a>，一个用 Python 代码构建交互式网络应用的框架)。对于本文，我们将坚持在 Jupyter 笔记本中使用<code class="fe nb nc nd ne b">plotly</code> Python 库，并在<a class="ae jd" href="https://plot.ly/create/#/" rel="noopener ugc nofollow" target="_blank">在线 plotly 编辑器中润色图像。当我们制作一个 plotly 图形时，默认情况下会在网上发布，这使得分享可视化变得容易。</a></p><p id="1017" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你需要创建一个免费的 plotly 帐户，给你 25 个公共图表和 1 个私人图表。一旦达到配额，您必须删除一些旧图表来制作新图表(或者您可以在离线模式下运行，图像只出现在笔记本中)。安装 plotly ( <code class="fe nb nc nd ne b">pip install plotly</code>)并运行以下命令来验证库，替换用户名和 API 密钥:</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="c214" class="nj mf jg ne b gy nk nl l nm nn">import plotly</span><span id="6248" class="nj mf jg ne b gy no nl l nm nn"># Authenticate with your account<br/>plotly.tools.set_credentials_file(username='########',                                              <br/>                                  api_key='******')</span></pre><p id="7f2d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">标准 plotly 导入以及离线运行的设置如下:</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="f4f2" class="nj mf jg ne b gy nk nl l nm nn">import plotly.plotly as py<br/>import plotly.graph_objs as go</span><span id="a5b7" class="nj mf jg ne b gy no nl l nm nn"># Offline mode<br/>from plotly.offline import init_notebook_mode, iplot<br/>init_notebook_mode(connected=True)</span></pre><p id="38f6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当我们在离线模式下制作图时，我们会在图像的右下角获得一个链接，以导出到 plotly 在线编辑器进行润色和共享。</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/52ef014749572cd54d16d3394d83d660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLWn5SH8UZc_E80mcTPOkg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Example of image in the notebook with link to edit in plotly.</figcaption></figure><h2 id="3e99" class="nj mf jg bd mg nq nr dn mk ns nt dp mo le nu nv mq li nw nx ms lm ny nz mu oa bi translated">Plotly 的优势</h2><p id="bc15" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">plotly(Python 库)使用<a class="ae jd" href="https://en.wikipedia.org/wiki/Declarative_programming" rel="noopener ugc nofollow" target="_blank">声明式编程</a>，这意味着我们编写代码描述<em class="lr">我们想要做什么</em>而不是<em class="lr">如何做</em>。我们提供基本框架和最终目标，并让 plotly 指出实现细节。在实践中，这意味着构建一个形象花费的精力更少，使我们能够专注于呈现什么以及如何解释它。</p><p id="e85b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你不相信这种方法的好处，那么去看看<a class="ae jd" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank">几十个例子</a>，比如下面的<a class="ae jd" href="https://plot.ly/python/bubble-maps/" rel="noopener ugc nofollow" target="_blank">用 50 行代码做的。</a></p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/a2a7e3f6fbe259ace461cba8479e052d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UoJwzE8B3Vu25GHNzGYuQA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">US City Populations (<a class="ae jd" href="https://plot.ly/python/bubble-maps/" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><h2 id="3ab3" class="nj mf jg bd mg nq nr dn mk ns nt dp mo le nu nv mq li nw nx ms lm ny nz mu oa bi translated">时间序列数据</h2><p id="7dfd" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">对于这个项目，我们将使用来自我在<a class="ae jd" href="https://cortexintel.com" rel="noopener ugc nofollow" target="_blank">Cortex Building Intelligence</a>工作的<a class="ae jd" href="https://github.com/WillKoehrsen/Data-Analysis/blob/master/plotly/building_one.csv" rel="noopener ugc nofollow" target="_blank">真实世界建筑数据</a>(数据已经匿名)。由于季节性、每日和每周模式以及天气条件的剧烈影响，建筑能源数据对时间序列分析提出了有趣的挑战。有效地可视化这些数据可以帮助我们了解建筑的反应以及哪里有节能的机会。</p><p id="1945" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(注意，我交替使用术语“功率”和“能量”，尽管<a class="ae jd" href="https://cleantechnica.com/2015/02/02/power-vs-energy-explanation/" rel="noopener ugc nofollow" target="_blank">能量是做功的能力，而功率是能量消耗的<em class="lr">比率</em></a>。从技术上讲，功率以千瓦(KW)为单位，电能以千瓦时(KWh)为单位。你知道的越多！)</p><p id="d9dc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的数据在数据帧中，在列上有一个<em class="lr">多索引，用于跟踪传感器类型和传感器编号。该索引是一个日期时间:</em></p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/712bc85e2c48e2a444c957b7b0acd062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4f45kNGKLYD-haWh3sBb7w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Time Series Building Data</figcaption></figure><p id="d2a2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用多索引数据框架是完全不同的另一篇文章(这里有<a class="ae jd" href="https://pandas.pydata.org/pandas-docs/stable/advanced.html" rel="noopener ugc nofollow" target="_blank">文档</a>)，但是我们不会做任何太复杂的事情。要访问单个列并绘制它，我们可以执行以下操作。</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="c475" class="nj mf jg ne b gy nk nl l nm nn">import pandas as pd</span><span id="20d5" class="nj mf jg ne b gy no nl l nm nn"><br/># Read in data with two headers<br/>df = pd.read_csv('building_one.csv', header=[0,1], index_col=0)</span><span id="869c" class="nj mf jg ne b gy no nl l nm nn"># Extract energy series from multi-index<br/>energy_series = df.loc[:, ('Energy', '3')]</span><span id="2b69" class="nj mf jg ne b gy no nl l nm nn"># Plot<br/>energy_series.plot()</span></pre><p id="8582" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认绘图(由 matplotlib 提供)如下所示:</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/eaa206d0d0b058ba21b1c62310f6a957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bkj6ILpMVZtbS2C3nVlvCw.png"/></div></div></figure><p id="a03a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这并不可怕，尤其是对于一行代码来说。但是，没有交互性，视觉上也不够吸引人。是时候进入剧情了。</p><h2 id="27b7" class="nj mf jg bd mg nq nr dn mk ns nt dp mo le nu nv mq li nw nx ms lm ny nz mu oa bi translated">基本时间序列图</h2><p id="fdd3" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">就像散景一样，制作一个基本的情节需要在 plotly 中做更多的工作，但作为回报，我们得到了更多，比如内置的交互性。</p><p id="e12f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们从一个数据对象开始构建一个图。即使我们想要一个折线图，我们也使用<code class="fe nb nc nd ne b">go.Scatter()</code>。Plotly 足够聪明，如果我们超过 20 个点，它会自动给我们一个线图！对于最基本的图形，我们只需要 x 和 y 值:</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="924f" class="nj mf jg ne b gy nk nl l nm nn">energy_data = go.Scatter(x=energy_series.index,<br/>                         y=energy_series.values)</span></pre><p id="1c6e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们使用默认设置和一些标题创建一个布局:</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="75c6" class="nj mf jg ne b gy nk nl l nm nn">layout = go.Layout(title='Energy Plot', xaxis=dict(title='Date'),<br/>                   yaxis=dict(title='(kWh)'))</span></pre><p id="b234" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(我们使用与<code class="fe nb nc nd ne b">{'x': 'value'}</code>相同的<code class="fe nb nc nd ne b">dict(x = 'value')</code>语法)。</p><p id="55da" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们可以创建我们的图形，并在笔记本中交互显示它:</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="310f" class="nj mf jg ne b gy nk nl l nm nn">fig = go.Figure(data=[energy_data], layout=layout)<br/>py.iplot(fig, sharing='public')</span></pre><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ls"><img src="../Images/133bd072ccd3c809d4a67fb8b6d31a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0kCiJGyKc8Ui-mw-tMBZUQ.gif"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Basic time series plot in plotly</figcaption></figure><p id="5a25" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">马上，我们有了一个完全交互式的图表。我们可以探索模式，检查单个点，并将绘图下载为图像。请注意，我们甚至不需要指定轴的类型或范围，plotly 为我们做了完全正确的事情。我们甚至不需要额外的工作就可以得到格式良好的悬停消息。</p><p id="9980" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，该图会自动导出到 plotly，这意味着我们可以与任何人共享该图表。我们还可以单击“编辑图表”,在在线编辑器中打开它，在一个易于使用的界面中进行我们想要的任何更改:</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/c5e40984ddab89216966764724234017.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OngjAdaVqGC5UyW6DAPUOQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Online editor interface</figcaption></figure><p id="8c9d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在在线编辑器中编辑图表，那么您可以为您创建的精确图表和样式自动生成 Python 代码！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="6515" class="me mf jg bd mg mh mi mj mk ml mm mn mo km mp kn mq kp mr kq ms ks mt kt mu mv bi translated">改善情节</h1><p id="d824" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">即使是 Plotly 中一个基本的时间序列图也令人印象深刻，但我们可以用多几行代码来改进它。例如，假设我们想要比较建筑物的蒸汽使用量和能源。这两个量有非常不同的单位，所以如果我们把它们放在同样的尺度上，就不会有结果。在这种情况下，我们必须使用第二个 y 轴。在 matplotlib 中，这需要大量的格式化工作，但是在 Plotly 中我们可以很容易地做到。</p><p id="308d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一步是添加另一个数据源，但是这次指定<code class="fe nb nc nd ne b">yaxis='y2'</code>。</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="53b1" class="nj mf jg ne b gy nk nl l nm nn"># Get the steam data<br/>steam_series = df.loc[:, ("Steam", "4")]</span><span id="f5b7" class="nj mf jg ne b gy no nl l nm nn"># Create the steam data object<br/>steam_data = go.Scatter(x=steam_series.index,<br/>                        y=steam_series.values,<br/>                        # Specify axis<br/>                        yaxis='y2')</span></pre><p id="7648" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(我们还添加了一些其他参数来改进样式，这可以在笔记本<a class="ae jd" href="http://nbviewer.jupyter.org/github/WillKoehrsen/Data-Analysis/blob/master/plotly/plotly-time-series.ipynb" rel="noopener ugc nofollow" target="_blank">中看到)。</a></p><p id="6734" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，当我们创建布局时，我们需要添加第二个 y 轴。</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="c108" class="nj mf jg ne b gy nk nl l nm nn">layout = go.Layout(height=600, width=800,<br/>                   title='Energy and Steam Plot',<br/>                   # Same x and first y<br/>                   xaxis=dict(title='Date'),<br/>                   yaxis=dict(title='Energy', color='red'),<br/>                   # Add a second yaxis to the right of the plot<br/>                   yaxis2=dict(title='Steam', color='blue',<br/>                               overlaying='y', side='right')<br/>                   )</span><span id="d152" class="nj mf jg ne b gy no nl l nm nn">fig = go.Figure(data=[energy_data, steam_data], layout=layout)<br/>py.iplot(fig, sharing='public')</span></pre><p id="3d4c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当我们显示图表时，我们在同一张图表上得到蒸汽和能量，轴的比例适当。</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ls"><img src="../Images/057b1c544b53b9960f3979258ae41ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KGV0pGzjDv9EBwJQlN-x7g.gif"/></div></div></figure><p id="e9fe" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过一点在线编辑，我们得到了一个成品:</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/7636853f42c27de64551ed9aeca5e90a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2gnQYgi7Ux08-qxKyRYXw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Finished plot of energy and steam.</figcaption></figure><h1 id="0c12" class="me mf jg bd mg mh og mj mk ml oh mn mo km oi kn mq kp oj kq ms ks ok kt mu mv bi translated">绘图注释</h1><p id="d0ae" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">绘图注释用于调出可视化的各个方面以引起注意。例如，我们可以在查看一周的数据时，突出显示每天的高蒸汽消耗量。首先，我们将蒸汽传感器划分为一周(称为<code class="fe nb nc nd ne b">steam_series_four</code>)并创建一个格式化的数据对象:</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="76c5" class="nj mf jg ne b gy nk nl l nm nn"># Data object<br/>steam_data_four = go.Scatter(<br/>                     x=steam_series_four.index,<br/>                     y=steam_series_four.values,<br/>                     line=dict(color='blue', width=1.1),<br/>                     opacity=0.8,<br/>                     name='Steam: Sensor 4',<br/>                     hoverinfo = 'text',<br/>                     text = [f'Sensor 4: {x:.1f} Mlbs/hr' for x in<br/>                             steam_series_four.values])</span></pre><p id="48f6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们将找到该传感器的每日最大值(代码见笔记本):</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/fb19cf89b867d87b3685c257903cd23f.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*EWCjm_1BRcbket5JoGfGQg.png"/></div></figure><p id="cd2d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了构建注释，我们将使用 list comprehension 为每个日最大值添加一个注释(<code class="fe nb nc nd ne b">four_highs</code>就是上面的系列)。每个注释需要一个位置(<code class="fe nb nc nd ne b">x</code>、<code class="fe nb nc nd ne b">y</code>和<code class="fe nb nc nd ne b">text</code>):</p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="c2f6" class="nj mf jg ne b gy nk nl l nm nn"># Create a list of annotations<br/>four_annotations = [dict(x = date, y = value, <br/>           xref = 'x', yref = 'y', <br/>           font=dict(color = 'blue'),<br/>           text = f'{format_date(date)}&lt;br&gt; {value[0]:.1f} Mlbs/hr')<br/>                    for date, value in zip(four_highs.index, <br/>                                           four_highs.values)]</span><span id="76de" class="nj mf jg ne b gy no nl l nm nn">four_annotations[:1]</span><span id="facc" class="nj mf jg ne b gy no nl l nm nn"><strong class="ne jh">{'x': Timestamp('2018-02-05 06:30:00'),<br/>  'y': 17.98865890412107,<br/>  'xref': 'x',<br/>  'yref': 'y',<br/>  'font': {'color': 'blue'},<br/>  'text': 'Mon &lt;br&gt; 06:30 AM&lt;br&gt; 18.0 Mlbs/hr'}}</strong></span></pre><p id="5215" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(文本中的<code class="fe nb nc nd ne b">&lt;br&gt;</code>为 html，由 plotly 读取并显示)。</p><p id="ee3a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以修改注释的其他<a class="ae jd" href="https://plot.ly/python/text-and-annotations/" rel="noopener ugc nofollow" target="_blank">参数，但是我们会让 plotly 处理细节。向绘图添加注释就像将它们传递给<code class="fe nb nc nd ne b">layout</code>一样简单:</a></p><pre class="lt lu lv lw gt nf ne ng nh aw ni bi"><span id="3ecb" class="nj mf jg ne b gy nk nl l nm nn">layout = go.Layout(height=800, width=1000, <br/>                   title='Steam Sensor with Daily High Annotations',<br/>                   annotations=four_annotations)</span></pre><p id="33c8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在在线编辑器中稍作后期处理后，我们最终的剧情是:</p><figure class="lt lu lv lw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/a3e8c14846dfcc3bd64a58df73204b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vh9kzeeGX2viWRSZs_ycjQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Final plot with steam sensor annotations</figcaption></figure><p id="b43d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">额外的注释可以通过显示蒸汽使用的每日峰值出现的时间，让我们深入了解我们的数据。反过来，这将允许我们向建筑工程师提出蒸汽启动时间建议。</p><blockquote class="on oo op"><p id="c0f5" class="kv kw lr kx b ky kz kh la lb lc kk ld oq lf lg lh or lj lk ll os ln lo lp lq ij bi translated">关于 plotly 最好的部分是，我们可以快速获得一个基本的绘图，并通过多一点代码来扩展功能。当我们想要添加更多的功能时，对基本情节的前期投资是有回报的。</p></blockquote></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h2 id="863d" class="nj mf jg bd mg nq nr dn mk ns nt dp mo le nu nv mq li nw nx ms lm ny nz mu oa bi translated">结论</h2><p id="6de9" class="pw-post-body-paragraph kv kw jg kx b ky mw kh la lb mx kk ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">我们只是触及了我们<a class="ae jd" href="https://moderndata.plot.ly/15-python-and-r-charts-with-interactive-controls-buttons-dropdowns-and-sliders/" rel="noopener ugc nofollow" target="_blank">在《T4》中能做的事情的表面。我将在以后的文章中探索其中的一些功能，而</a><a class="ae jd" href="https://github.com/WillKoehrsen/Data-Analysis/blob/master/plotly/plotly-time-series.ipynb" rel="noopener ugc nofollow" target="_blank">参考笔记本</a>了解如何添加更多的交互性，比如选择菜单。最终，我们可以用 Python 代码在 Dash 中构建可部署的<a class="ae jd" href="https://dash.plot.ly/deployment" rel="noopener ugc nofollow" target="_blank"> web 应用程序。目前，我们知道如何在 plotly 中创建基本但有效的时间序列可视化。</a></p><blockquote class="on oo op"><p id="2399" class="kv kw lr kx b ky kz kh la lb lc kk ld oq lf lg lh or lj lk ll os ln lo lp lq ij bi translated">这些图表为我们的小代码投资提供了很多，通过修改和在线分享这些图表，我们可以构建一个完整的、像样的产品。</p></blockquote><p id="d4d5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尽管我并不是要放弃 matplotlib——单线条形图和折线图很难被击败——但很明显，将 matplotlib 用于自定义图表并不是一个好的时间投资。相反，我们可以使用其他库，包括 plotly，来有效地构建全功能的交互式可视化。在图表中查看数据是数据科学的乐趣之一，但编写代码通常是痛苦的。幸运的是，使用 plotly，Python 中的可视化非常直观，甚至可以愉快地创建和实现图形的目标:直观地理解我们的数据。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="9538" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一如既往，我欢迎反馈和建设性的批评。可以通过 Twitter <a class="ae jd" href="http://twitter.com/@koehrsen_will" rel="noopener ugc nofollow" target="_blank"> @koehrsen_will </a>或者通过我的个人网站<a class="ae jd" href="https://willk.online" rel="noopener ugc nofollow" target="_blank"> willk.online </a>找到我。</p></div></div>    
</body>
</html>