<html>
<head>
<title>How to play Star Wars and other tunes in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 R 中播放星球大战等曲子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-play-star-wars-and-other-tunes-in-r-5e837e8b71e4?source=collection_archive---------2-----------------------#2018-10-13">https://towardsdatascience.com/how-to-play-star-wars-and-other-tunes-in-r-5e837e8b71e4?source=collection_archive---------2-----------------------#2018-10-13</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><figure class="gl gn jt ju jv jw gh gi paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="gh gi js"><img src="../Images/35aab2d2c34ebee9fca02e8ae473bf4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPukLPd6d4l3YH8kCLDz5w.jpeg"/></div></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk">Photo by <a class="ae kh" href="https://unsplash.com/photos/cVMaxt672ss?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Liam Tucker</a> on <a class="ae kh" href="https://unsplash.com/search/photos/star-wars?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e90a" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">有时我的研发过程需要很长时间，我不能坐在电脑前看着它全部完成。我认为在我的脚本结尾选择一些胜利的曲调会很酷，这样当过程成功执行时，我可以听到一些告诉我一切顺利的东西。</p><p id="e4e8" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">所以我研究了 R 中的<code class="fe lg lh li lj b">audio</code>包，它允许你通过与机器上基于样本的音频设备接口来创建和播放声音，并将其保存为 wave 文件。文本和数字的字符串可以被处理成频率值，然后与音符长度的数据结合成正弦波。这将产生一个整洁小曲子，可以在你的休息时间或任何媒体设备上播放。</p><h2 id="963d" class="lk ll iv bd lm ln lo dn lp lq lr dp ls kt lt lu lv kx lw lx ly lb lz ma mb mc bi translated">写星球大战主题</h2><p id="e571" class="pw-post-body-paragraph ki kj iv kk b kl md kn ko kp me kr ks kt mf kv kw kx mg kz la lb mh ld le lf io bi translated">让我们从加载必要的包开始:</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="df02" class="lk ll iv lj b gy mq mr l ms mt">library(dplyr)<br/>library(audio)</span></pre><p id="aed7" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">让我们也定义一个八度音程中音符的值。为此，你需要用半音来思考，考虑到降半音和升半音，这将在后面定义:</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="d128" class="lk ll iv lj b gy mq mr l ms mt">notes &lt;- c(A = 0, B = 2, C = 3, D = 5, E = 7, F = 8, G = 10)</span></pre><p id="e35f" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在让我们为星球大战主题写笔记，忽略每个笔记的长度。如果你能读懂乐谱，你就能做到这一点。你可以用任何你想要的方式组织它，用一个字符向量的格式，因为我们稍后会清理它。我决定为每个小节写一个字符串，字符串中的音符用空格隔开。</p><p id="eaee" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">我们稍后将设置代码，将符号<code class="fe lg lh li lj b">#</code>理解为升半音，将<code class="fe lg lh li lj b">b</code>理解为降半音，以使音乐人更直观。</p><p id="a4e5" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">我们需要在音乐中分离八度音阶。稍后我将设置我的代码来解释一个普通的音符，例如<code class="fe lg lh li lj b">A</code>在第四个八度音阶中，任何其他的八度音阶都通过在音符后面加上八度音阶编号来表示(例如<code class="fe lg lh li lj b">A5</code>或<code class="fe lg lh li lj b">B3</code></p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="92f6" class="lk ll iv lj b gy mq mr l ms mt">pitch &lt;- paste("D D D",<br/>               "G D5",<br/>               "C5 B A G5 D5",<br/>               "C5 B A G5 D5",<br/>               "C5 B C5 A D D D",<br/>               "G D5",<br/>               "C5 B A G5 D5",<br/>               "C5 B A G5 D5",<br/>               "C5 B C5 A D D",<br/>               "E E C5 B A G",<br/>               "G A B A E F# D D",<br/>               "E E C5 B A G",<br/>               "D5 A D D",<br/>               "E E C5 B A G",<br/>               "G A B A E F# D5 D5",<br/>               "G5 F5 D#5 D5 C5 A# A G",<br/>               "D5 D D D",<br/>               "G D5",<br/>               "C5 B A G5 D5",<br/>               "C5 B A G5 D5",<br/>               "C5 B C5 A D D D",<br/>               "G D5",<br/>               "C5 B A G5 D5",<br/>               "G5 F5 D#5 Bb5 A5",<br/>               "G5 G G G G")</span></pre><p id="5ac8" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">然后你可以用音符的长度写一个数字向量，一拍用数字<code class="fe lg lh li lj b">1</code>表示。为了使我的符号清晰，我尽量保持每个小节一行。</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="c132" class="lk ll iv lj b gy mq mr l ms mt">duration &lt;- c(0.33, 0.33, 0.33, <br/>              2, 2, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 0.33, 0.33, 0.33, <br/>              2, 2, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 0.75, 0.25,<br/>              1.5, 0.5, 0.5, 0.5, 0.5, 0.5, <br/>              0.33, 0.33, 0.33, 0.75, 0.25, 1, 0.75, 0.25, <br/>              1.5, 0.5, 0.5, 0.5, 0.5, 0.5,<br/>              1, 2, 0.75, 0.25,<br/>              1.5, 0.5, 0.5, 0.5, 0.5, 0.5, <br/>              0.33, 0.33, 0.33, 0.75, 0.25, 1, 0.75, 0.25, <br/>              0.75, 0.25, 0.75, 0.25, 0.75, 0.25, 0.75, 0.25, <br/>              3, 0.33, 0.33, 0.33,   <br/>              2, 2, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 0.33, 0.33, 0.33, <br/>              2, 2, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              0.33, 0.33, 0.33, 2, 1, <br/>              1,  0.33, 0.33, 0.33, 1)</span></pre><p id="f134" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在我们有了所有需要的原材料。</p><h2 id="5bce" class="lk ll iv bd lm ln lo dn lp lq lr dp ls kt lt lu lv kx lw lx ly lb lz ma mb mc bi translated">将音符转换成正弦波的频率</h2><p id="04a1" class="pw-post-body-paragraph ki kj iv kk b kl md kn ko kp me kr ks kt mf kv kw kx mg kz la lb mh ld le lf io bi translated">首先，我们将音高和音长向量转换成一个数据帧，其中每个音符都是一个具有音高和音长的元素。在星球大战主题的情况下，总共有 126 个音符。</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="3b90" class="lk ll iv lj b gy mq mr l ms mt">starwars &lt;- data_frame(pitch = strsplit(pitch, " ")[[1]],<br/>                     duration = duration)</span></pre><p id="5623" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，我们将扩展该数据框架，以包括一些新列:</p><ul class=""><li id="18a0" class="mu mv iv kk b kl km kp kq kt mw kx mx lb my lf mz na nb nc bi translated"><code class="fe lg lh li lj b">octave</code>它从<code class="fe lg lh li lj b">pitch</code>符号中提取音符要在哪个八度音阶中演奏</li><li id="fafc" class="mu mv iv kk b kl nd kp ne kt nf kx ng lb nh lf mz na nb nc bi translated"><code class="fe lg lh li lj b">note</code>从我们的原始<code class="fe lg lh li lj b">notes</code>向量中提取原始音符值，然后针对升半音、降半音和八度音程变量进行调整</li><li id="9177" class="mu mv iv kk b kl nd kp ne kt nf kx ng lb nh lf mz na nb nc bi translated"><code class="fe lg lh li lj b">freq</code>将<code class="fe lg lh li lj b">note</code>转换成以 Mhz 为单位的频率</li></ul><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="a17f" class="lk ll iv lj b gy mq mr l ms mt">starwars &lt;-<br/>  starwars %&gt;%<br/>  mutate(octave = substring(pitch, nchar(pitch))  %&gt;%<br/>  {suppressWarnings(as.numeric(.))} %&gt;%<br/>    ifelse(is.na(.), 4, .),<br/>  note = notes[substr(pitch, 1, 1)],<br/>  note = note + grepl("#", pitch) -<br/>    grepl("b", pitch) + octave * 12 +<br/>    12 * (note &lt; 3),<br/>  freq = 2 ^ ((note - 60) / 12) * 440)</span></pre><p id="8a31" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">我们现在将定义一个将音符和音长转换成正弦波的函数。为此，我们将以每分钟的节拍数和采样率(通常为 44.1Khz)来设置速度:</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="6465" class="lk ll iv lj b gy mq mr l ms mt">tempo &lt;- 150<br/>sample_rate &lt;- 44100</span><span id="d4f1" class="lk ll iv lj b gy ni mr l ms mt">make_sine &lt;- function(freq, duration) {<br/>  wave &lt;- sin(seq(0, duration / tempo * 60, 1 / sample_rate) *<br/>                freq * 2 * pi)<br/>  fade &lt;- seq(0, 1, 50 / sample_rate)<br/>  wave * c(fade, rep(1, length(wave) - 2 * length(fade)), rev(fade))<br/>}</span></pre><p id="90e6" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">最后，我们只需将该函数应用于<code class="fe lg lh li lj b">starwars</code>数据帧中的<code class="fe lg lh li lj b">freq</code>和<code class="fe lg lh li lj b">duration</code>列，然后简单地弹奏曲子。</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="3c1f" class="lk ll iv lj b gy mq mr l ms mt">starwars_wave &lt;-<br/>  mapply(make_sine, starwars$freq, starwars$duration) %&gt;%<br/>  do.call("c", .)</span><span id="e191" class="lk ll iv lj b gy ni mr l ms mt">audio::play(starwars_wave)</span></pre><p id="41e8" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">您也可以将乐曲保存为一个.<code class="fe lg lh li lj b">wav</code>文件，以便随时使用</p><pre class="mi mj mk ml gt mm lj mn mo aw mp bi"><span id="4589" class="lk ll iv lj b gy mq mr l ms mt">audio::save.wave(starwars_wave, "starwars.wav")</span></pre><p id="89d1" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">你需要的所有代码都在这里供你尝试，但是<a class="ae kh" href="https://github.com/keithmcnulty/Rmusic" rel="noopener ugc nofollow" target="_blank">这里有 GitHub </a>中的代码链接，如果你想拿出来和其他曲子一起玩的话。您可以随意将自己的音乐放回单独的 R 文件中的同一个 GitHub repo 中，以便他人欣赏。</p><p id="20e5" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">最初我是一名纯粹的数学家，后来我成为了一名心理计量学家和数据科学家。我热衷于将所有这些学科的严谨性应用到复杂的人的问题上。我也是一个编码极客和日本 RPG 的超级粉丝。在<a class="ae kh" href="https://www.linkedin.com/in/keith-mcnulty/" rel="noopener ugc nofollow" target="_blank"><em class="nj">LinkedIn</em></a><em class="nj">或</em><a class="ae kh" href="https://twitter.com/dr_keithmcnulty" rel="noopener ugc nofollow" target="_blank"><em class="nj">Twitter</em></a><em class="nj">上找我。</em></p><figure class="mi mj mk ml gt jw gh gi paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="gh gi nk"><img src="../Images/f24034746d590773f7e91c74d3568c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ilR7o2A5iLFbuBCBUJY0EA.jpeg"/></div></div></figure></div></div>    
</body>
</html>