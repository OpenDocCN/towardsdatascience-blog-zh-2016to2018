<html>
<head>
<title>Weather Data, Plot, and Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">天气数据、绘图和代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pgh-weather-data-plot-and-code-19d8e8b670f?source=collection_archive---------3-----------------------#2017-10-02">https://towardsdatascience.com/pgh-weather-data-plot-and-code-19d8e8b670f?source=collection_archive---------3-----------------------#2017-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dd21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">改编自Austin Wehrwein的博客文章和Claus O. Wilke的<a class="ae kl" href="https://cran.r-project.org/web/packages/ggridges/vignettes/gallery.html" rel="noopener ugc nofollow" target="_blank"> Cran page </a>。地下气象站的数据。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/633b087e4d7082f9877a725bcc40c479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnIXFjOR8IbjWUdG0vY7hg.png"/></div></div></figure><p id="4364" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">生成如上图的R代码可以在Austin Wehrwein的<a class="ae kl" href="http://austinwehrwein.com/data-visualization/it-brings-me-ggjoy/" rel="noopener ugc nofollow" target="_blank">博客</a>和这个<a class="ae kl" href="https://cran.r-project.org/web/packages/ggridges/vignettes/gallery.html" rel="noopener ugc nofollow" target="_blank"> Cran page </a>上找到，但是我也把它包含在下面，做了一些小的修改和如何从Weather Underground检索你自己的数据的细节。</p><h2 id="1f58" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">数据:</h2><p id="dc3a" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在这个<a class="ae kl" href="https://www.wunderground.com/history/airport/KAGC/2017/1/1/CustomHistory.html?dayend=17&amp;monthend=9&amp;yearend=2017&amp;req_city=&amp;req_state=&amp;req_statename=&amp;reqdb.zip=&amp;reqdb.magic=&amp;reqdb.wmo=&amp;MR=1" rel="noopener ugc nofollow" target="_blank"> Weather Underground </a>页面上选择地区和自定义时间段。将表格数据复制/粘贴到Excel中(可能需要删除额外的列标题)。按照格式“%d-%b-%y”或“2016年1月1日”重新标记日期。重新标记列标题。另存为CSV。</p><p id="05c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注:你可以尝试用<a class="ae kl" href="https://topbullets.com/2017/04/12/how-to-download-data-from-weather-underground-topbullets-com/" rel="noopener ugc nofollow" target="_blank">这个教程</a>直接从R抓取，但是吴最近改了他们的URL方案，所以这个技术可能不行。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lw"><img src="../Images/572c5440eaf82faa5ac6a8b7333509e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0a30dY6Akf6PdQeB_1gNA.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Your data should look something like this. Mean Temp (Col C) is what I plotted, but pretty much any numeric variable can be used.</figcaption></figure><h2 id="417e" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">图书馆:</h2><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6934" class="ky kz iq mc b gy mg mh l mi mj">library(viridis)     ## color palette<br/>library(ggjoy)       ## ridges<br/>library(hrbrthemes)  ## plot theme</span></pre><h2 id="516c" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">导入和次要数据清理:</h2><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="7fe9" class="ky kz iq mc b gy mg mh l mi mj">pgh_weather &lt;- read.csv("weather_data.csv") ## setwd() to your own<br/>months &lt;- c("December","November","October","September","August","July","June","May","April","March","February","January") ## need this string vector for sorting later</span><span id="1690" class="ky kz iq mc b gy mk mh l mi mj">pgh_weather$months &lt;- as.Date(pgh_weather$CST, format = "%d-%b-%y") %&gt;%<br/>  months() %&gt;%<br/>  as.factor() %&gt;%<br/>  factor(., levels = months)</span><span id="c2a7" class="ky kz iq mc b gy mk mh l mi mj">#scales<br/>mins &lt;- min(pgh_weather$Min.TemperatureF)<br/>maxs &lt;- max(pgh_weather$Max.TemperatureF)</span></pre><h2 id="9fcc" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">情节:</h2><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="27ec" class="ky kz iq mc b gy mg mh l mi mj">## black and white<br/>ggplot(pgh_weather,aes(x = Mean.TemperatureF,y=months,height=..density..))+<br/>  geom_joy(scale=3) +<br/>  scale_x_continuous(limits = c(mins,maxs))+<br/>  theme_ipsum(grid=F)+<br/>  theme(axis.title.y=element_blank(),<br/>        axis.ticks.y=element_blank(),<br/>        strip.text.y = element_text(angle = 180, hjust = 1))+<br/>  labs(title='Temperatures in Pittsburgh',<br/>       subtitle='Median temperatures (Fahrenheit) by month for 2016\nData: Original CSV from the Weather Underground', x = "Mean Tempterature [ºF]")</span><span id="7f9d" class="ky kz iq mc b gy mk mh l mi mj">## in color<br/>ggplot(pgh_weather, aes(x = `Mean.TemperatureF`, y = `months`, fill = ..x..)) +<br/>  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01, gradient_lwd = 1.) +<br/>  scale_x_continuous(expand = c(0.01, 0)) +<br/>  scale_y_discrete(expand = c(0.01, 0)) +<br/>  scale_fill_viridis(name = "Temp. [ºF]", option = "C") +<br/>  labs(title = 'Temperatures in Pittsburgh',<br/>       subtitle = 'Mean temperatures (Fahrenheit) by month for 2016\nData: Original CSV from the Weather Underground', <br/>       x = "Mean Temperature") +<br/>  theme_ridges(font_size = 13, grid = TRUE) + theme(axis.title.y = element_blank())</span></pre><h2 id="7f53" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">后续步骤:</h2><p id="4ce0" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">下载年度数据，用GIF或褪色的脊线追踪上升的温度。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ml"><img src="../Images/d0be1fbee6eb6c2da6ed06ad4200c1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJ7niP49gZ1EBLY0K36rLg.png"/></div></div></figure></div></div>    
</body>
</html>