<html>
<head>
<title>Managing Experimentation in Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理深度学习中的实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/managing-experimentation-in-deep-learning-ca6db050b104?source=collection_archive---------8-----------------------#2018-05-18">https://towardsdatascience.com/managing-experimentation-in-deep-learning-ca6db050b104?source=collection_archive---------8-----------------------#2018-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6cfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用深度学习包括运行无数的实验来测试一个人可能有的各种假设，以解决特定的问题，或者通过尝试多个超参数来获得更好的结果。随着时间的推移，这些实验的数量越来越多，管理它们甚至试图反映几周前做了什么可能会有点困难。在这篇文章中，我计划分享一些我使用的技巧或窍门(作为一名全职从事深度学习的研究生),以保持事情有序，防止自己迷失在一堆懒洋洋定义的日志文件中，如 exp0、exp1、newexp。</p><h1 id="d108" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">保持同步</h1><p id="43d8" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我(我想也有很多其他人)在基于 GPU 的 linux 服务器上运行实验，然后将结果复制回主机进行分析。这种类型的数据可能包括 csv/txt 文件、tensorboard 日志或图像。</p><p id="5828" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现<strong class="jp ir"> rsync </strong>是一个完美的工具(我以前习惯于<strong class="jp ir"> scp </strong>)，它的主要优点是只同步源和目的地之间的差异。当培训正在进行中(预计需要很长时间)并且我们想要监控进度时，这是很有帮助的。我通常在生成模型上工作，所以我需要不时地通过浏览各个时期生成的东西来检查我的 GAN 是否变得疯狂了。</p><p id="0b3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最简单的方法是:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="f33a" class="lx km iq lt b gy ly lz l ma mb">rsync -av &lt;username&gt;@remote-host:&lt;path_to_results_folder&gt; .</span></pre><p id="450e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，<code class="fe mc md me lt b">-a</code>将递归地传输所有内容，<code class="fe mc md me lt b">-v</code>代表详细程度。这相当快。此外，如果你的服务器是通过网关，你需要事先登录。</p><p id="4303" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 rsync 可以做很多事情，例如，在生产环境中部署模型，或者设置一个 cronjob 以固定的时间间隔提取日志。参考<a class="ae mf" href="http://mediatemple.net/blog/tips/many-uses-rsync/" rel="noopener ugc nofollow" target="_blank">这篇文章来看看后者是如何实现的。</a></p><h1 id="6b60" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">张量板</h1><p id="92ba" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">许多人都不知道 Tensorflow 的惊人可视化工具<a class="ae mf" href="https://www.tensorflow.org/programmers_guide/summaries_and_tensorboard" rel="noopener ugc nofollow" target="_blank"> Tensorboard </a>可以作为一个独立的实用程序来绘制几乎任何东西的漂亮的交互式曲线。我通常坚持只绘制标量，以使事情变得更快更轻(传输和加载时间)。API<a class="ae mf" href="https://github.com/lanpa/tensorboard-pytorch" rel="noopener ugc nofollow" target="_blank">tensor board-py torch</a>在这方面真的很牛逼。我不知道为什么他们称它为“-Pytorch”，因为它很普通。通过<code class="fe mc md me lt b">pip install tesorboardX</code>安装。</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="bf8d" class="lx km iq lt b gy ly lz l ma mb">from tensorboardX import SummaryWriter<br/>writer = SummaryWriter(log_dir=&lt;path_to_log&gt;)<br/>for i in range(num_epochs):<br/>    loss = forward_pass()<br/>    writer.add_scalar('loss', loss)</span></pre><p id="a9cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们结束了。接下来，启动 tensorboard 并查看剧情:<code class="fe mc md me lt b">tensorboard --logdir &lt;path_to_log&gt;</code>。为了比较来自多个实验的损失(或任何其他度量)，<code class="fe mc md me lt b">&lt;path_to_log&gt;</code>可以是<code class="fe mc md me lt b">tb_log/&lt;exp_name&gt;</code>，其中<code class="fe mc md me lt b">tb_log</code>是包含每个实验的子目录的目录。接着，启动 tensorboard 时的<code class="fe mc md me lt b">logdir</code>标志的值会变成<code class="fe mc md me lt b">tb_log</code>。</p><p id="c190" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果在远程服务器上，我建议将日志文件拉回到本地，然后从那里启动 tensorboard。上一节中的<code class="fe mc md me lt b">rsync</code>命令可用于定期更新<code class="fe mc md me lt b">tb_log</code>中的文件，同时保持 tensorboard 在后台运行。</p><p id="0869" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，tensorboard 可以在远程服务器上启动，仪表板可以通过<code class="fe mc md me lt b">public IP:port(6006 is default)</code>导航。如果远程服务器没有公共 IP 地址，可以使用 SSH 隧道。例如，如果我在默认端口 6006 上的某个 IP 为 10.11.12.13 的服务器上启动 tensorboard，我可以通过以下方式将其传输到我的本地计算机:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="e6c3" class="lx km iq lt b gy ly lz l ma mb">ssh -N -f -L localhost:6006:<!-- -->10.11.12.13:6006 username@10.11.12.13</span></pre><p id="f9bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe mc md me lt b">localhost:6006:10.11.12.13:6006</code>为<code class="fe mc md me lt b">&lt;destination_address&gt;:&lt;destination_port&gt;:&lt;source_address&gt;:&lt;source_port&gt;</code>。</p><h1 id="02c7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">通过 gif 跟踪图像生成进度</h1><p id="cc1b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">为了容易地定性评估模型的进展，可以很容易地创建随时间生成的样本的 gif。</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="7dce" class="lx km iq lt b gy ly lz l ma mb">from torchvision import make_grid<br/>import imageio<br/>grid = []<br/>for i in range(num_epochs):<br/>    samples = forward_pass()<br/>    # the following functions are in context of pytorch<br/>    grid.append(make_grid(samples).permute(1, 2, 0).numpy())<br/>imageio.mimsave('generations.gif', grid)</span></pre><p id="2b32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要将生成的形状样本(batch_size，channels，height，width)转换为(height，width，channel ),因此首先将图像连接起来形成一个网格，然后转置维度并转换为 numpy 数组。</p><p id="3a52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得人们不必仔细检查和比较为每个时期分别生成和保存的图像。</p><figure class="lo lp lq lr gt mh gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/601c2f489ffd8335a57cb87f45028dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/1*5WV95vM6G7sK4DwhCcWW0Q.gif"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Source: <a class="ae mf" href="https://docs.floydhub.com/examples/dcgan/" rel="noopener ugc nofollow" target="_blank">https://docs.floydhub.com/examples/dcgan/</a></figcaption></figure><h1 id="9d11" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">测井实验</h1><p id="7f77" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">并不是我们运行的所有实验都在 excel 表中，即使这样，也很难在一个紧凑的二维表中捕获所有信息，即与每个实验相关的所有设置和更改。为了确保我过去运行的所有实验都被记录在某个地方，而不需要任何额外的努力(因为我不在乎在凌晨 3 点记录实验)，从 bash 文件运行所有实验(并不断注释掉以前运行的实验)。</p><p id="b8ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这也让你可以自由地输入关于这些实验的任何注释或评论。您可以对某些超参数的不同值进行循环，以便一次运行多个实验。如果你的组织使用像<a class="ae mf" href="https://slurm.schedmd.com/overview.html" rel="noopener ugc nofollow" target="_blank"> Slurm </a>(像<a class="ae mf" href="https://wikis.nyu.edu/display/NYUHPC/Slurm+Tutorial" rel="noopener ugc nofollow" target="_blank"> mine </a>)这样的工作量管理器，那么遵循这种技术也更有意义。</p><figure class="lo lp lq lr gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/3a5300024a8854909cf01f7da54967e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NePRzJiZeEqdHO1SmFj8HQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Experiment Logging</figcaption></figure><p id="87ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道有很多令人惊讶的工具专门用来管理这个，比如<a class="ae mf" href="https://sacred.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">神圣</a>，但是我更喜欢坚持老派的日志风格。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="3bc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些是我每天为了让生活变得更轻松而练习的一些事情。如果你认为这些是次优的，或者你有其他的锦囊妙计，让我知道，我很乐意学习:)</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="4b7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我很长一段时间以来的第一篇文章，也是机器学习领域的第一篇文章，我已经为此工作了一段时间。我计划分享我正在学习的和到目前为止学到的东西。反馈将有助于提高未来内容的质量。</p></div></div>    
</body>
</html>