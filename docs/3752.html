<html>
<head>
<title>Time Series Forecasting for Optimal Gas Refill</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最佳气体补充的时间序列预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-for-optimal-gas-refill-88650b1cf029?source=collection_archive---------4-----------------------#2018-06-14">https://towardsdatascience.com/time-series-forecasting-for-optimal-gas-refill-88650b1cf029?source=collection_archive---------4-----------------------#2018-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1ea69f545f8f476f46d0596ad958af97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AQZ7VwgJzLjVWJHi.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Aral petrol station in the mountainous region of Bamberg — <a class="ae kc" href="https://commons.wikimedia.org/wiki/File:Aral_Tankstelle_Bamberg_Berg_065709-PSD.jpg" rel="noopener ugc nofollow" target="_blank">Reinhold Möller</a></figcaption></figure><p id="4666" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你有没有遇到过这样的情况，当你开车经过一个加油站，当你昨天支付的价格比现在高很多时，你变得沮丧？别担心！我们可以用数据科学来克服这个问题！我们可以把这个问题变成一个预测问题。在这篇文章中，我们将建立一个模型来预测你应该今天还是明天补充。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/13c173ba9be68600bb92082a8cae839e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQKGN8Q0B9syboF2t7zE9A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">The idea of the data science solution. We want to forecast if the price increases by looking at the past.</figcaption></figure><h1 id="010e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">数据</h1><p id="42d8" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">2013 年，德国联邦政府决定建立一个中央组织，收集德国所有加油站的油价数据。所有加油站都被迫提供气价变化。数据是公开的，有很多应用程序可以让你看到这些数据。我们将使用这些数据来解决我们的预测问题。数据可以从<a class="ae kc" href="https://creativecommons.tankerkoenig.de/" rel="noopener ugc nofollow" target="_blank">https://creativecommons.tankerkoenig.de/</a>下载。数据存储为 PostgreSQL 转储。包含了 2015 年 5 月以来的所有气价。解压缩数据后，您可以使用以下命令将它们放入本地 PostgreSQL 数据库:</p><pre class="lc ld le lf gt mj mk ml mm aw mn bi"><span id="70fd" class="mo lh iq mk b gy mp mq l mr ms">C:\Program Files\PostgreSQL\10\bin&gt;psql.exe -U postgres -f “C:\…\history.dump”</span></pre><p id="6d8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="https://rapidminer.com/" rel="noopener ugc nofollow" target="_blank"> RapidMiner </a>中实现这一点很容易:你需要将 PostgreSQL 数据库连接到你的工作室，并使用<em class="mt"> Read Database </em>操作符。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/330bb41d566a921e3df25c30a12ecdc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*DfaHtSp1YSh1ZQOvNWPsfw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">RapidMiner process to get the data into it. The Read Database operator contains the SQL-script which is posted below.</figcaption></figure><p id="d110" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的特例中，我想为一个加油站这样做:位于多特蒙德 Westfalendamm 的 ARAL 加油站。这是德国 RapidMiner 办公室正前方的加油站。因此，我们使用一个快速 SQL 查询来获取这个加油站的所有数据:</p><pre class="lc ld le lf gt mj mk ml mm aw mn bi"><span id="9b83" class="mo lh iq mk b gy mp mq l mr ms">SELECT * FROM gas_station_information_history<br/>JOIN gas_station<br/>ON gas_station.id = gas_station_information_history.stid<br/>WHERE gas_station.street = ‘Westfalendamm’ AND brand = ‘ARAL’</span></pre><p id="d2cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">存储后，我们可以看看数据。</p><h1 id="ac53" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">数据准备</h1><p id="6718" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">两个基本属性是“日期”和“e10”，其中 e10 表示含 10%乙醇的标准气体。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/bc8f7ec0fd314213fe7fe815c988643b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*m_KymL1WffYhRox4eExyCA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">A view of the data. E10 is premium gasoline. The original data set also contains the prices for diesel as well as additional data on the station.</figcaption></figure><p id="fcac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的问题是数据没有等距的时间戳。它只记录数据的每次变化。我们想要生成什么样的数据集:</p><pre class="lc ld le lf gt mj mk ml mm aw mn bi"><span id="5fa6" class="mo lh iq mk b gy mp mq l mr ms">Aug 26, 2016, 4PM — 1269</span><span id="932a" class="mo lh iq mk b gy mw mq l mr ms">Aug 26, 2016, 5PM — 1269</span><span id="a5c3" class="mo lh iq mk b gy mw mq l mr ms">Aug 26, 2016, 6PM — 1269</span><span id="31fa" class="mo lh iq mk b gy mw mq l mr ms">….</span></pre><p id="d083" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将使我们的数据每小时均衡一次。为此，我们首先创建一个示例集，如下所示:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/861fcee87e33a613e33346042ebc7de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*_Jpb6EMdABqF8kBhJHJkyw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Data set after equalization</figcaption></figure><p id="ae86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将它附加到原始集合中，对其进行排序，得到下表:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/5ff40948b80135958643a5f1a7ccc18e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EIIDFA3DMkIanUAo-bDCdA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">The original data set and the equalized data set combined. We can fill the missing data using the previous values to get the price at a given time.</figcaption></figure><p id="ee05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用最后一个存在的前一个值来填充缺失的值，并通过过滤“isEqualized”来过滤掉原始数据。RapidMiner 流程如下所示:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/3bcfa4aed6b52f65aafee2db5a68e79e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lt3Ctbdi25TD51mcmg8O7g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">RapidMiner process for the preprocessing.</figcaption></figure><p id="0c23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据集现在是干净的，我们可以继续进行特征生成和建模。</p><h1 id="409c" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">特征生成</h1><p id="4b54" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">首先，我们生成一个标签。请记住，我们想要解决这个问题:<em class="mt">我是今天还是明天再加注？</em>因此，我们的标签是当前价格和 24 小时内价格之间的差异。由此我们可以生成一个表示价格上涨的二项式标签。</p><p id="2b08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一步是特征生成。首先，我们对数据进行窗口处理。窗口意味着我们在当前行中包含过去 48 小时的所有价格。结果数据集如下所示:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/c5ffd1cbae9884f2310819084b3764f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UF7gUfWiHE7w-DdKDCCL7Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Windowed data set in RapidMiner. e10–47 indicates the price 47 hours before, e10–46 the price 46h ago and so.</figcaption></figure><p id="8a10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我早上 8 点到达办公室，所以我想预测现在或明天早上 8 点补充是否有意义。因此，我只查看上午 8 点的数据，并过滤掉其余的数据。特征准备的完整 RapidMiner 过程如下所示:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/f34abfbabf8a11d8ee7f85c558191c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1soOO-oX5vBcPKRvZ6Xxw.png"/></div></div></figure><p id="42de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为每个数据点生成一个特征向量。这已经足够训练一个模特了。</p><h1 id="842f" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">系统模型化</h1><p id="763b" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">我们现在有了一个可以学习的完美数据集。我用一个广义线性模型来预测我们的标签。对于这样的第一次尝试，结果是好的:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/dec8ba07033733b3419947b86aa999e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WHe1CBwWLrsf6SusSkr1Gw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Confusion Matrix for the GLM. The confusion matrix is estimated using a 10-fold Cross Validation.</figcaption></figure><p id="7346" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该模型的 AUC 为 0.7。虽然这并不完美，但仍然比默认模型要好！</p></div></div>    
</body>
</html>