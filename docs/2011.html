<html>
<head>
<title>SQL in a Nutshell: Part 1 — Basic Real-World Scenarios</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简而言之的SQL:第1部分—基本的真实场景</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-in-a-nutshell-part-1-basic-real-world-scenarios-33a25ba8d220?source=collection_archive---------3-----------------------#2017-12-04">https://towardsdatascience.com/sql-in-a-nutshell-part-1-basic-real-world-scenarios-33a25ba8d220?source=collection_archive---------3-----------------------#2017-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="79a1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">本系列关注现实世界中最常见的数据科学和分析问题，旨在用SQL解决这些问题。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/7d180b039fafb4dedcd7bd0d24194927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3KHwFLXghuHeG-sX"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Carlos Muza</a> on <a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="60b0" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ir">更新(到原帖):</strong></p><ol class=""><li id="0fd4" class="ma mb iq lg b lh li lk ll ln mc lr md lv me lz mf mg mh mi bi translated">SQLFiddle上的查询链接已被移除。未来的更新包括嵌入SQL的Jupyter/IPython笔记本的链接。</li><li id="725f" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated">这里的大多数查询都是用ANSI SQL编写的。为了便于执行，PostgreSQL 9.6和MySQL 5.6包含在一起，以展示窗口函数等特性(MySQL不支持这些特性)。您可以在本地安装其中一个或两个来测试我们的查询。</li><li id="d2d0" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz mf mg mh mi bi translated">本文已经扩展为一个由3部分组成的系列，第三部分涵盖了SQL中典型的、重要的任务。</li></ol></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="d9f7" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果您熟悉SQL的语法和编写基本的选择查询，您可能会发现本系列有助于快速复习或学习更多的技巧和诀窍，以编写更清晰和优化的查询，如<em class="mo">如何计算六周的滚动平均销售额。</em></p><p id="36f2" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这是本系列的第一篇文章<em class="mo">,将回顾SQL概念以及一些基本问题，这些问题将通过基本的检索、连接、过滤、聚合和转换来回答。<br/>第二篇<em class="mo">文章</em>将涵盖更复杂的场景，以及如何使用窗口函数、子查询、移动平均、常用表表达式和排序来处理这些场景。<br/>第三篇<em class="mo">文章</em>将涵盖SQL中典型的、重要的任务——例如旋转、从每个组中检索顶级结果的不同方法、处理重复项以及性能查询调优。</em></p><h1 id="4b79" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">SQL简介</h1><p id="3adf" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">SQL(结构化查询语言)是为管理数据库中的数据而设计的通用编程语言。由于它的标准语法，它支持所有的关系数据库以及一些NoSQL(不仅仅是SQL)。SQL之所以受欢迎，是因为它的用法像英语一样易于理解，还因为它可以直接访问数据的存储位置，而不是将数据复制到其他应用程序，这使得分析相对方便。</p><p id="4b67" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">借助SQL，我们可以:</p><ul class=""><li id="dcd7" class="ma mb iq lg b lh li lk ll ln mc lr md lv me lz nm mg mh mi bi translated"><em class="mo">定义</em>数据(DDL)，例如，将缩写值标准化为完整的状态名</li><li id="87ba" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><em class="mo">处理</em>数据(DML ),例如用一个单词替换一个空白或空值</li><li id="dd23" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated">从数据库(DQL)中检索数据，例如获得本月的销售数字</li></ul><p id="6068" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在本系列的范围内，我们将只处理用于检索的查询(<em class="mo"> SELECT </em>)。对于我们的大多数查询，我们还将使用SQL:2011版本的ANSI SQL——一种在大多数数据库上兼容的标准。为了演示，我们将使用MySQL 5.6和/或PostgreSQL 9.6。</p><p id="4332" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ir">注意</strong>:针对SQL发布的最新标准(ISO/IEC或ANSI)是<a class="ae kw" href="https://en.wikipedia.org/wiki/SQL:2016" rel="noopener ugc nofollow" target="_blank"> SQL:2016 </a>，对JSON功能有额外的支持。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="b16e" class="nn mq iq bd mr no np dn mv nq nr dp mz ln ns nt nb lr nu nv nd lv nw nx nf ny bi translated">创建数据库并插入数据</h2><p id="ae8b" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">在开始查询数据之前，我们需要创建一个数据库并将数据加载到其中。</p><p id="7eb1" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><a class="ae kw" href="http://en.wikipedia.org/wiki/Database" rel="noopener ugc nofollow" target="_blank"> <em class="mo">数据库</em> </a> <em class="mo"> </em>是一个有组织的数据集合，由表格等结构和其他元素组成。一个<em class="mo">表</em>在行(元组)和列(属性)中存储数据。<em class="mo">模式</em>指的是如何构建数据库(或划分成数据库表)的蓝图。</p><p id="6b27" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">下面的命令集为我们的数据库构建了模式:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Build Schema (Create tables and Insert data)</figcaption></figure><p id="1eca" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这里，我们创建两个表，分别是由<em class="mo">PRODUCT _ ID</em>(<em class="mo">产品</em>的主键，销售<em class="mo">的外键</em>)关联的<em class="mo">产品</em>、<em class="mo">销售</em></p><h1 id="31c5" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">检索数据</h1><p id="1924" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated"><code class="fe ob oc od oe b"><strong class="lg ir">SELECT</strong></code>命令用于从数据库中检索数据。</p><p id="d315" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">以下是一些获得<em class="mo">销售</em>数据的不同方法的基本查询:</p><ul class=""><li id="03c1" class="ma mb iq lg b lh li lk ll ln mc lr md lv me lz nm mg mh mi bi translated"><strong class="lg ir">所有</strong>细节来自一张表</li><li id="6003" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><strong class="lg ir">将</strong>结果限制在前<em class="mo"> N </em>行(用于测试或取样)</li><li id="494b" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated">表中的特定列</li><li id="561f" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><strong class="lg ir">列名的别名</strong>(使信息可读)</li><li id="405d" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><strong class="lg ir">不同的</strong>列值(一列或多列中的唯一值)</li></ul><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Basic SELECT queries on Sales table</figcaption></figure><h1 id="3eb7" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">连接表格</h1><p id="2647" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">连接表允许我们组合多个数据集，以获得更完整的结果集和全面的分析。</p><p id="5c8c" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在<a class="ae kw" href="https://en.wikipedia.org/wiki/Relational_model" rel="noopener ugc nofollow" target="_blank">数据建模</a>(数据库设计)<em class="mo">规范化</em>是一个过程，用于将数据组织在单独的结构良好的表中，以最大限度地减少冗余，并避免插入、更新和删除异常。这种分离也有助于简化逻辑，提高精确装配特定用途所需物品的灵活性。这种装配是通过“连接”操作来完成的。</p><p id="5d6e" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">假设我们有一个单独的表<em class="mo"> ProductSales </em>存储我们所有的数据:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi of"><img src="../Images/5470e6265088c2f796d4f6b10c06a2dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*wbeqMTCq2DWim_CHcjMfdA.png"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Raw Data into ProductSales <em class="kf">table</em></figcaption></figure><p id="6ef8" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">比如说，企业希望通过产品名称来了解产品，而不仅仅是品牌名称。这意味着他们可以要求我们将“诺基亚”更新为“诺基亚Lumia”，将“三星”更新为“三星S5”。在这种情况下，如果有一百万行，改变每一行<em class="mo"> Product_Name </em>是“诺基亚”或“三星”的操作在计算上是相当昂贵的。</p><p id="61a7" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">相反，如果我们以这样一种方式构建我们的数据，即在一个单独的表中取出<em class="mo">产品</em>数据，每种产品有一行信息，那么<em class="mo">销售</em>表中的每笔销售都可以与一个<em class="mo">产品ID相关联。</em>这叫做<em class="mo">一对多关系。</em>现在对<em class="mo"> Product_Name </em>的任何更改都只是一行操作，所有与更新产品相关的<em class="mo">销售</em>数据都可以通过<em class="mo"> Product_ID </em>上的<code class="fe ob oc od oe b">join</code>轻松访问。</p><h2 id="0896" class="nn mq iq bd mr no np dn mv nq nr dp mz ln ns nt nb lr nu nv nd lv nw nx nf ny bi translated">连接的用例:</h2><ul class=""><li id="51ec" class="ma mb iq lg b lh nh lk ni ln og lr oh lv oi lz nm mg mh mi bi translated"><em class="mo">为了组合相关的数据集</em>，例如，为了找到已售出产品的名称，我们将把<em class="mo">销售</em>表和<em class="mo">产品</em>表连接起来</li><li id="57ff" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><em class="mo">例如，为了执行比较</em>——为了执行同比分析，我们可以将相似数据的分区按年份值进行组合</li><li id="4471" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><em class="mo">使用表格作为查找资源</em>，例如，为了获得运输交付类型的状态，存储状态代码的枚举器以映射到相应的文本会更有效。</li></ul><h2 id="2f77" class="nn mq iq bd mr no np dn mv nq nr dp mz ln ns nt nb lr nu nv nd lv nw nx nf ny bi translated">连接的类型</h2><ol class=""><li id="1a34" class="ma mb iq lg b lh nh lk ni ln og lr oh lv oi lz mf mg mh mi bi translated">内部连接:<em class="mo">内部连接</em>是一个连接，它只返回两个表中那些<em class="mo">连接条件</em>为真的结果。</li></ol><p id="3a36" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">例如— <em class="mo">获取已销售产品的详细信息:</em></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Inner Join</figcaption></figure><p id="dd4b" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在本例中，从结果集中可以观察到，没有产品“LG”的销售，因为在<em class="mo"> Sales </em>表中没有产品“LG”的列表(或者没有<em class="mo"> Product_ID </em> ) <em class="mo"> </em>)。</p><p id="e666" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><em class="mo">连接条件</em>通过一个<code class="fe ob oc od oe b"><strong class="lg ir">ON</strong></code>子句指定。我们还可以使用<code class="fe ob oc od oe b">AND</code>操作符向它添加多个条件。例如，<em class="mo">获取2017年销售的产品明细:</em></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Inner Join with condition</figcaption></figure><p id="0a15" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">2.外部联接:<em class="mo">外部联接</em>是返回一个或两个表的所有结果的联接(取决于<em class="mo">联接类型——左、右或全</em>),并且不满足<em class="mo">联接条件</em>的行返回空值。</p><p id="d8a0" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为了更好地解释这一点，我们以前面的例子为例，稍微修改了一下需求— <em class="mo">获取所有产品及其相应的销售信息，如果有的话:</em></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Left Join</figcaption></figure><p id="0994" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这里，我们有每一个产品清单以及每一笔销售。对于“LG”，结果集显示该产品存在于我们的数据库中，但是还没有销售。这是一个<code class="fe ob oc od oe b"><strong class="lg ir">LEFT JOIN</strong></code>的例子。</p><p id="2b5e" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一个<code class="fe ob oc od oe b">RIGHT JOIN</code>以类似的方式工作，但是相反，即返回右边表格的所有行，左边不匹配的行作为空值返回。尽可能使用左连接(右连接之上)是一种标准做法。</p><p id="b640" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ir">注意:</strong> <code class="fe ob oc od oe b">FULL JOIN</code> <strong class="lg ir"> </strong>在MySQL中不支持，但通过<code class="fe ob oc od oe b">UNION</code>可以完成类似的查询。这篇文章的下一次更新将包括关于在PostgreSQL等其他数据库中使用的<em class="mo">完全连接</em>和<em class="mo">自连接</em>的主题。<em class="mo">工会</em>和<em class="mo">工会所有</em>将在下一篇帖子中涉及。</p><h1 id="ddc3" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">过滤和排序数据</h1><p id="ae74" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">通过过滤数据集，我们可以根据搜索条件限制我们的结果。</p><ul class=""><li id="248f" class="ma mb iq lg b lh li lk ll ln mc lr md lv me lz nm mg mh mi bi translated"><em class="mo">集中分析</em>，例如，将销售趋势的结果缩小到特定区域</li><li id="63c1" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><em class="mo">要限制集合条件的数据集，例如，</em>获取平均评分为4或更高的产品，其总评论数至少为10</li><li id="99e8" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><em class="mo">减少用于计算的数据集大小</em>，例如——对一个假设进行采样</li></ul><p id="d011" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">以下是过滤中常用的一些运算符:</p><p id="f691" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">过滤数据的基本方法是使用<code class="fe ob oc od oe b">WHERE</code>子句以及一个或多个适合您的搜索条件的操作符。</p><p id="7783" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">以下是一些常用的运算符:</p><ul class=""><li id="d12c" class="ma mb iq lg b lh li lk ll ln mc lr md lv me lz nm mg mh mi bi translated"><em class="mo">比较运算符</em> : <code class="fe ob oc od oe b">=</code>(等于)、<code class="fe ob oc od oe b">&lt;&gt;</code>或<code class="fe ob oc od oe b">!=</code>(不等于)，以及其他一些不言自明的运算符— <code class="fe ob oc od oe b">&gt;</code>、<code class="fe ob oc od oe b">&lt;</code>、<code class="fe ob oc od oe b">&gt;=</code>、<code class="fe ob oc od oe b">&lt;=</code></li><li id="fd1e" class="ma mb iq lg b lh mj lk mk ln ml lr mm lv mn lz nm mg mh mi bi translated"><em class="mo">逻辑运算符:</em>、<code class="fe ob oc od oe b">AND</code>、<code class="fe ob oc od oe b">OR</code>、<code class="fe ob oc od oe b">NOT</code>、<code class="fe ob oc od oe b">IN</code>(在一组值中查找)、<code class="fe ob oc od oe b">BETWEEN</code>(具有开始和结束范围)、<code class="fe ob oc od oe b">LIKE</code>(匹配相似的值)</li></ul><h2 id="a6ed" class="nn mq iq bd mr no np dn mv nq nr dp mz ln ns nt nb lr nu nv nd lv nw nx nf ny bi translated">整理</h2><p id="1add" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">SQL查询中的排序是可选的。默认情况下，如果主键存在，则结果按主键的顺序返回，否则按随机顺序返回。如果我们希望以特定的方式对结果进行排序，我们必须显式地添加一个<code class="fe ob oc od oe b">ORDER BY</code>子句，后跟一个<em class="mo">列名列表</em>进行排序，最后是<em class="mo">订单类型(ASC — </em>升序<em class="mo">，DESC — </em>降序<em class="mo"> ) </em>。</p><p id="4238" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们从一个简单的例子开始— <em class="mo">获取一部“iPhone”的所有销售细节:</em></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Filter Data</figcaption></figure><p id="7229" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">请注意，在第一个查询中，我们已经按Product_ID(如果已知)进行了筛选。在第二个查询中，我们将<em class="mo"> Sales </em>与<em class="mo"> Products </em>表连接起来，并筛选出以“-Phone”结尾的产品。注意“%”是一个通配符，它可以搜索其位置上的任何文本。</p><p id="6901" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">再举一个例子— <em class="mo">获取2015年11月1日到2017年10月1日之间的销售明细，按日期排序:</em></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Filter and Sort</figcaption></figure><p id="8d91" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这里，在第一个查询中，我们使用了一组比较运算符。在第二个查询中，我们使用<code class="fe ob oc od oe b">BETWEEN</code>来搜索相同范围内的日期值。</p><p id="c6b4" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，如果我们需要<em class="mo">获得产品的销售细节——“诺基亚”、“三星”和“LG”，该怎么办？</em>或者说这是我们需要搜索的大约20种产品的列表。与其包含20个<code class="fe ob oc od oe b">AND</code>条件，不如使用<code class="fe ob oc od oe b">IN</code>操作符来编写这个查询:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Filter with IN</figcaption></figure><h1 id="b7bc" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">聚集</h1><p id="1e07" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">当我们沉浸在周围数以百万计的细节中时，我们经常会失去上下文，并希望从中寻找有意义的信息。通过汇总数据，我们可以观察到每月总计或按类别划分的销售订单平均值等洞察。这有助于我们更深入地了解我们的数据，并允许我们提出更深入的问题。在高层次上，我们还可以识别数据中的模式和趋势。</p><p id="6646" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为此，我们将使用SQL中内置函数的集合，这些函数汇总或汇总我们的值。一些基本的包括最小值、最大值、平均值、总和、计数，更具分析性的包括标准差、方差和等级。</p><p id="a09d" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们从使用一些基本功能开始，例如—</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Basic Aggregation</figcaption></figure><p id="ea4a" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这对初学者来说很好，但是除了告诉我们表包含多少行或者价格的最小/最大值是多少之外，它实际上没有多少业务洞察力。如果我们想知道每件产品的销售额是多少呢？<em class="mo">小组来了，由</em>来救援！</p><p id="a510" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><code class="fe ob oc od oe b"><strong class="lg ir">GROUP BY</strong></code>允许您将数据分成组，这些组可以彼此独立地进行聚合。</p><p id="c5a1" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">例如— <em class="mo">获取我们数据库中每种产品的总销售额、平均价格和总销售量:</em></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Aggregate by Product</figcaption></figure><p id="32cf" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在这给出了一个更全面的图片！</p><p id="59f4" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ir">注</strong>:使用<code class="fe ob oc od oe b">COALESCE</code>、<code class="fe ob oc od oe b">IFNULL</code>(或等效物)可以用指定值替换空值。</p><p id="c270" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们考虑另一个示例— <em class="mo">对于从2016年10月1日开始销售的每件产品，获取每年的总销售额、平均价格和总数量，并只返回那些至少销售了10件商品的产品，按产品名称和年份排序。</em></p><p id="8288" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在可能有很多要处理，但下面是对其解决方案的分解分析:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Aggregation with multiple conditions</figcaption></figure><p id="c9dd" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ir">注意</strong>:<code class="fe ob oc od oe b">HAVING</code>子句在执行聚合后应用过滤器。</p><p id="6fbc" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">聚合是SQL分析的核心部分，是任何优秀的数据科学家/工程师都必须掌握的。随着本系列的继续，我们将学习更多类似的复杂场景以及如何处理它们。</p><h1 id="3b6c" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">内置函数的数据转换</h1><p id="8664" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">在收集的数据质量差、需要清理的情况下，通常需要进行数据转换；这种过程被称为数据争论(或蒙骗)。还需要转换来以更易于阅读的格式呈现数据报告。</p><p id="b2f3" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">以下是使用内置函数的季度和月度销售报告的一些示例:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Quarterly and Monthly Sales</figcaption></figure><p id="0d19" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">第一个查询显示季度销售报告。这里，<code class="fe ob oc od oe b">MONTH</code>和<code class="fe ob oc od oe b">YEAR</code>函数将日期值转换成整数形式的相应月份和年份值，而<code class="fe ob oc od oe b">CAST</code>用于<em class="mo">价格</em>以从<em class="mo">整数</em>转换成<em class="mo">小数。</em><code class="fe ob oc od oe b">CASE</code>函数(一个<code class="fe ob oc od oe b">IF-ELSE</code>的变体)检查然后检查条件并将每个日期值映射到季度桶中，之后结果按季度分组。类似地，为了显示月度销售报告，我们需要对<em class="mo">年</em>和<em class="mo">月</em>进行分组，如第二个查询所示。</p><p id="5de3" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">SQL中有许多更方便的函数，您可以在您正在使用的SQL版本的文档中找到它们。更多的内容将在本系列的后续文章中讨论。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="1f8f" class="mp mq iq bd mr ms oj mu mv mw ok my mz jw ol jx nb jz om ka nd kc on kd nf ng bi translated">参考</h1><p id="b31c" class="pw-post-body-paragraph le lf iq lg b lh nh jr lj lk ni ju lm ln nj lp lq lr nk lt lu lv nl lx ly lz ij bi translated">在您等待下一篇文章的时候，请查看SQL上一些有趣的链接以获取更多知识:</p><div class="oo op gp gr oq or"><a href="https://en.wikibooks.org/wiki/Structured_Query_Language" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">结构化查询语言- Wikibooks，开放世界的开放书籍</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">这本Wikibook提供了对SQL、其起源、基本概念和组件的简短描述，以及大量示例…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">en.wikibooks.org</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf kq or"/></div></div></a></div><div class="oo op gp gr oq or"><a href="https://community.modeanalytics.com/sql/tutorial/introduction-to-sql/" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">数据分析的SQL教程</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">本教程是为想用数据回答问题的人设计的。对许多人来说，SQL是“肉和土豆…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">community.modeanalytics.com</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf kq or"/></div></div></a></div><div class="oo op gp gr oq or"><a href="https://bensullins.com/sql-tips-tricks-data-science/" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">数据科学的SQL提示和技巧</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">获取Ben Sullins为数据科学专业人士(工程师、开发人员、数据挖掘人员、程序员和其他人员)提供的12个必备SQL技巧</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">bensullins.com</p></div></div><div class="pa l"><div class="ph l pc pd pe pa pf kq or"/></div></div></a></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="13a1" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">希望这篇文章对你有帮助！如果你喜欢这篇文章，请为它鼓掌。有什么想法吗？把它们写在下面的评论里。</p></div></div>    
</body>
</html>