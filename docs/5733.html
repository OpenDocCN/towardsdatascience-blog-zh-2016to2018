<html>
<head>
<title>Transfer Learning using Mobilenet and Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Mobilenet 和 Keras 进行迁移学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transfer-learning-using-mobilenet-and-keras-c75daf7ff299?source=collection_archive---------1-----------------------#2018-11-06">https://towardsdatascience.com/transfer-learning-using-mobilenet-and-keras-c75daf7ff299?source=collection_archive---------1-----------------------#2018-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/ce0cb9343cff60c270a378e709ed8d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*jPqtGzVKrj3KNjICE-CwiA.png"/></div></figure><p id="beac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这本笔记本中，我将向你展示一个使用 Mobilenet 对狗的图像进行分类的例子。然后我会给你看一个例子，当它巧妙地错误分类一个蓝色山雀的图像。然后，我将重新训练 Mobilenet 并使用迁移学习，这样它就可以正确地分类相同的输入图像。只使用了两个分类器。但是这可以扩展到您想要的任何数量，受限于您可用的硬件数量和时间。</p><p id="f685" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Mobilenet 的源文件位于此处:<a class="ae ks" href="https://arxiv.org/pdf/1704.04861.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1704.04861.pdf</a></p><p id="9325" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt"> MobileNets:面向移动视觉应用的高效卷积神经网络</em>，Howard 等，<strong class="jw ir"> 2017 </strong>。</p><p id="83ce" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将使用 Mobilenet，因为它的架构是轻量级的。它使用深度方向可分离卷积，这基本上意味着它在每个颜色通道上执行单个卷积，而不是组合所有三个并将其展平。这具有过滤输入通道的效果。或者正如论文作者清楚解释的那样:“<em class="kt">对于 MobileNets，深度方向卷积对每个输入通道应用单个滤波器。逐点卷积然后应用 1×1 卷积来组合深度卷积的输出。标准卷积在一个步骤中将输入滤波并组合成一组新的输出。深度方向可分离卷积将其分为两层，一层用于滤波，另一层用于合并。这种因式分解具有显著减少计算和模型大小的效果</em>。</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/9d33e89187996507a3ab652042376281.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*L97mX8J7dBNPtRwb5VwqUw.png"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Difference between pointwise and depth wise convolutions</figcaption></figure><p id="4ed8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，Mobilenet 的总体架构如下，有 30 层</p><ol class=""><li id="69e5" class="ld le iq jw b jx jy kb kc kf lf kj lg kn lh kr li lj lk ll bi translated">步幅为 2 的卷积层</li><li id="f4dd" class="ld le iq jw b jx lm kb ln kf lo kj lp kn lq kr li lj lk ll bi translated">深度方向层</li><li id="e8f1" class="ld le iq jw b jx lm kb ln kf lo kj lp kn lq kr li lj lk ll bi translated">逐点层，通道数量加倍</li><li id="c4ed" class="ld le iq jw b jx lm kb ln kf lo kj lp kn lq kr li lj lk ll bi translated">跨距为 2 的深度方向层</li><li id="c385" class="ld le iq jw b jx lm kb ln kf lo kj lp kn lq kr li lj lk ll bi translated">逐点层，通道数量加倍</li></ol><p id="1c08" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">等等。</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/7c6a99cc7e9f64764443f8219a7bc542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*lrxsPkbVrrIPVmr7jy-noA.png"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Mobilenet full architecture</figcaption></figure><p id="d56c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这也是非常低的维护，因此表现相当好，高速。还有许多预训练模型，内存和磁盘中网络的大小与使用的参数数量成比例。网络的速度和功耗与 MAC(乘法累加)的数量成比例，MAC 是融合乘法和加法运算数量的度量。</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/51c5f5e9eebce77a9bce9109e07a8b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XeJGMg7siqgjI6kQ3gke9A.png"/></div></div></figure></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="b19a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们进入代码！</p><p id="fb3e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的代码位于这里:<a class="ae ks" href="https://github.com/ferhat00/Deep-Learning/tree/master/Transfer%20Learning%20CNN" rel="noopener ugc nofollow" target="_blank">https://github . com/fer hat 00/Deep-Learning/tree/master/Transfer % 20 Learning % 20 CNN</a></p><p id="533d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们加载必要的包和库。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2694" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们输入来自 Keras 的预训练模型。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="982b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们对不同品种的狗的图像进行一些测试。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mg"><img src="../Images/3845010681297193916c0be4d84b665b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MlM8CnEX2hqpziyI"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@jankao?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jana Ohajdova</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="8e84" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输出:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="17c7" class="mm mn iq mi b gy mo mp l mq mr">[[('n02106662', 'German_shepherd', 0.9796372),<br/>  ('n02105162', 'malinois', 0.020184083),<br/>  ('n02091467', 'Norwegian_elkhound', 0.00015799515),<br/>  ('n02116738', 'African_hunting_dog', 5.2901587e-06),<br/>  ('n02105251', 'briard', 3.9127376e-06)]]</span></pre><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ms"><img src="../Images/009d85fdd362e499444c20c00ddbebb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_VVT62R2uZsC4dUM"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@vincentvanzalinge?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vincent van Zalinge</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2216" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输出:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="a987" class="mm mn iq mi b gy mo mp l mq mr">[[(‘n02099712’, ‘Labrador_retriever’, 0.73073703),<br/> (‘n02087394’, ‘Rhodesian_ridgeback’, 0.03984367),<br/> (‘n02092339’, ‘Weimaraner’, 0.03359009),<br/> (‘n02109047’, ‘Great_Dane’, 0.028944707),<br/> (‘n02110341’, ‘dalmatian’, 0.022403581)]]</span></pre><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mt"><img src="../Images/4590857ad2857c5ef8ffb5c4effb03ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zKrpyaHilsURGPxD"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@hansob?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hans Ole Benonisen</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="e274" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输出:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="d89c" class="mm mn iq mi b gy mo mp l mq mr">[[('n02113799', 'standard_poodle', 0.5650911),<br/>  ('n02113712', 'miniature_poodle', 0.37279922),<br/>  ('n02102973', 'Irish_water_spaniel', 0.053150617),<br/>  ('n02113624', 'toy_poodle', 0.0072146286),<br/>  ('n02093859', 'Kerry_blue_terrier', 0.0013652634)]]</span></pre><p id="6d0e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">到目前为止一切顺利。它能很好地对每一种狗进行分类。但是让我们在一种鸟身上试试，蓝山雀。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mu"><img src="../Images/7f427e89a0c61e3bd3080a9e275ad0f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q1Si5Ge1R0wPf17Z"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@brewbottle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bob Brewer</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="a9a0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输出:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="1302" class="mm mn iq mi b gy mo mp l mq mr">[[('n01592084', 'chickadee', 0.95554715),<br/>  ('n01530575', 'brambling', 0.012973112),<br/>  ('n01828970', 'bee_eater', 0.012916375),<br/>  ('n01532829', 'house_finch', 0.010978725),<br/>  ('n01580077', 'jay', 0.0020677084)]]</span></pre><p id="4938" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以看到它认不出蓝山雀。它错误地将图像归类为山雀。这是一种原产于北美的鸟，与众不同:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mv"><img src="../Images/5db1243064ef26235a402ba5052c455e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ltl4WbJhNl1pm_8d"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@patriceb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Patrice Bouchard</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="53bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们来操作 Mobilenet 架构，重新培训最上面的几层，并采用迁移学习。为此，我们需要在一些图像上训练它。我将在蓝山雀和乌鸦上训练它。但是，与其手动下载它们的图片，不如使用谷歌图片搜索来获取图片。为此，我们可以导入一个很好的包。</p><p id="b332" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">看看 https://github.com/hardikvasa/google-images-download</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2662" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们重用 MobileNet，因为它是非常轻量级的(17Mb)，冻结基础层，让我们添加和训练顶部的几层。注意，我将只训练两个分类器，蓝山雀和乌鸦。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="f5cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们检查模型架构</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="b1a5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将使用预训练的权重，因为该模型已经在 Imagenet 数据集上进行了训练。我们确保所有的重量都是不可训练的。我们将只训练最后几个密集层。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3f48" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们将训练数据加载到 ImageDataGenerator 中。指定路径，它自动批量发送训练数据，简化代码。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="4935" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编译模型。现在让我们训练它。在 GTX1070 GPU 上应该不到两分钟。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="df22" class="mm mn iq mi b gy mo mp l mq mr">Epoch 1/10<br/>5/5 [==============================] - 5s 952ms/step - loss: 0.9098 - acc: 0.6562<br/>Epoch 2/10<br/>5/5 [==============================] - 3s 563ms/step - loss: 0.0503 - acc: 0.9686<br/>Epoch 3/10<br/>5/5 [==============================] - 3s 687ms/step - loss: 0.0236 - acc: 0.9930<br/>Epoch 4/10<br/>5/5 [==============================] - 4s 716ms/step - loss: 7.5358e-04 - acc: 1.0000<br/>Epoch 5/10<br/>5/5 [==============================] - 3s 522ms/step - loss: 0.0021 - acc: 1.0000<br/>Epoch 6/10<br/>5/5 [==============================] - 4s 780ms/step - loss: 0.0353 - acc: 0.9937<br/>Epoch 7/10<br/>5/5 [==============================] - 3s 654ms/step - loss: 0.0905 - acc: 0.9938<br/>Epoch 8/10<br/>5/5 [==============================] - 4s 890ms/step - loss: 0.0047 - acc: 1.0000<br/>Epoch 9/10<br/>5/5 [==============================] - 3s 649ms/step - loss: 0.0377 - acc: 0.9867<br/>Epoch 10/10<br/>5/5 [==============================] - 5s 929ms/step - loss: 0.0125 - acc: 1.0000</span></pre><p id="46fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">模型现在已经训练好了。现在让我们测试一些独立的输入图像来检查预测。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="839f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输出:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="761c" class="mm mn iq mi b gy mo mp l mq mr">array([[4.5191143e-15, 1.0000000e+00]], dtype=float32)</span></pre><p id="4efc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如你所看到的，它正确地预测了乌鸦，因为蓝色山雀图像被注释掉了。</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mw"><img src="../Images/340a75331d12514e24876e6da1324f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BupJSn_Toma6tZoS"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@jaimedantas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jaime Dantas</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6fe7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这可以进一步扩展到更多的图像，以使更多的分类器更好地概括，但这是实现 CNN 的迁移学习的最简单的方法和最快的方式。这当然取决于多快，多准确，你想在什么硬件上实现你的模型，以及你有多少时间。</p></div></div>    
</body>
</html>