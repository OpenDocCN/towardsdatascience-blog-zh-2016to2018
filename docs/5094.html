<html>
<head>
<title>How to Web Scrape with Python in 4 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 在 4 分钟内完成网页抓取</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-web-scrape-with-python-in-4-minutes-bc49186a8460?source=collection_archive---------0-----------------------#2018-09-27">https://towardsdatascience.com/how-to-web-scrape-with-python-in-4-minutes-bc49186a8460?source=collection_archive---------0-----------------------#2018-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2f18" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 网页抓取初学者指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1adf6a0128b563928ec63a7fbb32c3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HPyW3A4LIpM4QvP8"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chris Ried</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="df27" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">网页抓取</h1><p id="2d7d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Web 抓取是一种从网站中自动访问和提取大量信息的技术，可以节省大量的时间和精力。在本文中，我们将通过一个简单的例子来演示如何从纽约 MTA 自动下载数百个文件。这是一个伟大的练习网页抓取初学者谁正在寻找了解如何网页抓取。网络抓取可能有点吓人，所以本教程将分解如何进行这个过程。</p><h1 id="f33d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">纽约 MTA 数据</h1><p id="1e30" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将从以下网站下载十字转门数据:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="f7e6" class="ms la it mo b gy mt mu l mv mw"><a class="ae ky" href="http://web.mta.info/developers/turnstile.html" rel="noopener ugc nofollow" target="_blank">http://web.mta.info/developers/turnstile.html</a></span></pre><p id="d318" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">十字转门的数据从 2010 年 5 月到现在每周都有汇编，所以几百个。网站上有 txt 文件。下面是一些数据的片段。每个日期都是一个链接。txt 文件，您可以下载。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f21a0b2a75e3c9bc5749f5cdfbb60add.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*5Hwlx8IZxJ0m7AIx0TnddA.png"/></div></figure><p id="4fe5" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">手动右键点击每个链接并保存到你的桌面是很痛苦的。幸运的是，有网络抓取！</p><h1 id="16c2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">关于网页抓取的重要注意事项:</h1><ol class=""><li id="445e" class="nd ne it lt b lu lv lx ly ma nf me ng mi nh mm ni nj nk nl bi translated">通读网站的条款和条件，了解如何合法使用数据。大多数网站禁止你将这些数据用于商业目的。</li><li id="e572" class="nd ne it lt b lu nm lx nn ma no me np mi nq mm ni nj nk nl bi translated">确保下载数据的速度不要太快，因为这可能会破坏网站。您也可能被阻止访问该网站。</li></ol><h1 id="1f17" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">检查网站</h1><p id="cb02" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要做的第一件事是找出在多层 HTML 标签中我们可以在哪里找到我们想要下载的文件的链接。简而言之，网站页面上有大量代码，我们希望找到包含我们数据的相关代码。如果你不熟悉 HTML 标签，参考 W3Schools <a class="ae ky" href="http://www.w3schools.com/" rel="noopener ugc nofollow" target="_blank">教程</a>。理解 HTML 的基础知识对于成功抓取网页是很重要的。</p><p id="e3c9" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">在网站上，右键点击“检查”。这可以让你看到网站背后的原始代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/5487a096622231dd635c468d3f016b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*IYaJ73s529Dtb94xDemFcQ.png"/></div></figure><p id="8946" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">一旦你点击“检查”，你应该看到这个控制台弹出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/9e324ff771fd93b979bdae21866fa3a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcQ4KRlp1fhMFUydVv5lMg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><strong class="bd nt">Console</strong></figcaption></figure><p id="9935" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">请注意，在控制台的左上方，有一个箭头符号。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/1dd1a00f053d3e12aa0402bec121a2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:60/format:webp/1*OBTSehekWVX6rSXUaibd1A.png"/></div></figure><p id="97ef" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">如果您单击这个箭头，然后单击站点本身的一个区域，则该特定项目的代码将在控制台中突出显示。我点击了第一个数据文件，2018 年 9 月 22 日，星期六，控制台以蓝色突出显示了该特定文件的链接。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="a760" class="ms la it mo b gy mt mu l mv mw">&lt;a href=”data/nyct/turnstile/turnstile_180922.txt”&gt;Saturday, September 22, 2018&lt;/a&gt;</span></pre><p id="7a63" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">注意所有的。txt 文件在上面一行后面的<code class="fe nv nw nx mo b">&lt;a&gt;</code>标签中。当你做更多的网页抓取时，你会发现<code class="fe nv nw nx mo b">&lt;a&gt;</code>是用于超链接的。</p><p id="4106" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">现在我们已经确定了链接的位置，让我们开始编码吧！</p><h1 id="ddb4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python 代码</h1><p id="a261" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们从导入以下库开始。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="ef5c" class="ms la it mo b gy mt mu l mv mw">import requests<br/>import urllib.request<br/>import time<br/>from bs4 import BeautifulSoup</span></pre><p id="2493" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">接下来，我们设置网站的 url，并使用我们的请求库访问该站点。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="6198" class="ms la it mo b gy mt mu l mv mw">url = '<a class="ae ky" href="http://web.mta.info/developers/turnstile.html'" rel="noopener ugc nofollow" target="_blank">http://web.mta.info/developers/turnstile.html'</a><br/>response = requests.get(url)</span></pre><p id="6563" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">如果访问成功，您应该会看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/674af34ab2c60117785b6432e0a2b962.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*fyqRGzG8IbhhjxF2Q5MU_Q.png"/></div></figure><p id="18b5" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">接下来，我们用 BeautifulSoup 解析 html，这样我们就可以使用更好的嵌套式 BeautifulSoup 数据结构。如果你有兴趣了解这个库的更多信息，请查看<a class="ae ky" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"> BeatifulSoup 文档</a>。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="8fd0" class="ms la it mo b gy mt mu l mv mw">soup = BeautifulSoup(response.text, “html.parser”)</span></pre><p id="dc09" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">我们使用这种方法。findAll 找到我们所有的<code class="fe nv nw nx mo b">&lt;a&gt;</code>标签。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="9521" class="ms la it mo b gy mt mu l mv mw">soup.findAll('a')</span></pre><p id="ae17" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">这段代码给出了每一行带有<code class="fe nv nw nx mo b">&lt;a&gt;</code>标签的代码。我们感兴趣的信息从第 38 行开始，如下所示。也就是说，第一个文本文件位于第 38 行，所以我们想要获取位于下面的其余文本文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/a23ce2477b5b33e551ed6d918df943e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*G6YulYb5rczkVvmn7nbQ6g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><strong class="bd nt">subset of all &lt;a&gt; tags</strong></figcaption></figure><p id="3682" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">接下来，让我们提取我们想要的实际链接。让我们测试第一个链接。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="0f15" class="ms la it mo b gy mt mu l mv mw">one_a_tag = soup.findAll(‘a’)[38]<br/>link = one_a_tag[‘href’]</span></pre><p id="e71c" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">这段代码将第一个文本文件“data/nyct/turnstile/turnstile _ 180922 . txt”保存到我们的变量 link 中。下载数据的完整网址其实是‘http://web . MTA . info/developers<strong class="lt iu">/</strong>data/nyct/turnstile/turnstile _ 180922 . txt’，是我在网站上点击第一个数据文件作为测试发现的。我们可以使用我们的 urllib.request 库将这个文件路径下载到我们的计算机上。我们为 request.urlretrieve 提供两个参数:文件 url 和文件名。对于我的文件，我命名为“turnstile_180922.txt”、“turnstile_180901”等。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="93d2" class="ms la it mo b gy mt mu l mv mw">download_url = 'http://web.mta.info/developers/'+ link<br/>urllib.request.urlretrieve(download_url,'./'+link[link.find('/turnstile_')+1:])</span></pre><p id="3114" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">最后但同样重要的是，我们应该包含这一行代码，这样我们可以暂停我们的代码一秒钟，这样我们就不会向网站发送垃圾请求。这有助于我们避免被标记为垃圾邮件发送者。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="8d02" class="ms la it mo b gy mt mu l mv mw">time.sleep(1)</span></pre><p id="f32f" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">现在我们已经了解了如何下载一个文件，让我们试着用 for 循环下载整个数据文件集。下面的代码包含了网络抓取纽约 MTA 十字转门数据的整套代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><strong class="ak">Note that line 19 should be 38 and not 36 due to an updated on the website.</strong></figcaption></figure><p id="6791" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">你可以在我的 Github 上找到我的 Jupyter 笔记本。</p><p id="d2f8" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">感谢大家的阅读和快乐的网刮！</p></div></div>    
</body>
</html>