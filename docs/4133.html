<html>
<head>
<title>Tutorial: Selfie Filters Using Deep Learning And OpenCV (Facial Landmarks Detection)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:使用深度学习和 OpenCV(面部标志检测)的自拍滤镜</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/facial-keypoints-detection-deep-learning-737547f73515?source=collection_archive---------4-----------------------#2018-07-21">https://towardsdatascience.com/facial-keypoints-detection-deep-learning-737547f73515?source=collection_archive---------4-----------------------#2018-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cb80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个关于如何构建一个 python 应用程序的教程，该应用程序可以通过找到面部关键点(15 个独特的点)在检测到的脸上放置各种太阳镜(我称它们为“自拍过滤器”)。这些关键点标记了面部的重要区域——眼睛、嘴角、鼻子等。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1c95ac170f38f11dbb3e147abf92ed41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kd2LNYMhDrKJUjaUPm0Qrw.png"/></div></div></figure><h1 id="d09c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">项目描述</h1><p id="8664" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">OpenCV 经常在实践中与其他机器学习和深度学习库一起使用，以产生有趣的结果。在 Keras 中使用卷积神经网络(CNN)和 OpenCV——我建立了几个自拍过滤器(非常无聊的)。</p><p id="21b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">面部关键点可用于各种机器学习应用，从面部和情感识别到商业应用，如 Snapchat 推广的图像过滤器。</p><p id="a06f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在此访问完整的项目代码:</p><div class="mb mc gp gr md me"><a href="https://github.com/acl21/Selfie_Filters_OpenCV" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">acl21/Selfie_Filters_OpenCV</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">更新]:我将不再关注与回购相关的问题或邮件，因为我目前非常忙…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">github.com</p></div></div></div></a></div><h1 id="b4d4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">工作示例</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mn mo l"/></div></figure><h1 id="ce38" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">代码要求</h1><p id="b630" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">代码在 Python 版本中，使用 OpenCV 和 Keras 库。</p><p id="615d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">跟随<a class="ae ma" href="https://medium.com/@akshaychandra21/how-to-install-opencv-and-keras-in-python-3-6-f5f721f0d0b3" rel="noopener">这篇中帖</a>在 Python 3 中安装 OpenCV 和 Keras。</p><h1 id="e23e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据描述</h1><p id="4297" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Kaggle 上的这个<a class="ae ma" href="https://www.kaggle.com/c/facial-keypoints-detection" rel="noopener ugc nofollow" target="_blank">数据集允许我们训练一个模型，在给定一张有脸的图像的情况下检测面部关键点。</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mp"><img src="../Images/c4c24cace5e0ea2b934c81591b3566b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dHrt5-yK19Py1WT30ab99g.png"/></div></div></figure><p id="9724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是由蒙特利尔大学的 Yoshua Bengio 博士提供的。</p><p id="22ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据集中的每个数据点包含按顺序的图像的空间分隔的像素值，并且数据点的最后 30 个值表示面上关键点的 15 对坐标。</p><p id="94ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们只需要训练一个 CNN 模型来解决一个经典的深度学习回归问题。点击查看回归问题<a class="ae ma" href="https://keras.io/losses/" rel="noopener ugc nofollow" target="_blank">的损失函数列表。</a></p><h1 id="cb06" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">代码解释</h1><h2 id="2336" class="mq ky iq bd kz mr ms dn ld mt mu dp lh jy mv mw ll kc mx my lp kg mz na lt nb bi translated">步骤 1:训练卷积神经网络模型</h2><p id="b43a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><strong class="jp ir"> 1.1 定义模型</strong></p><p id="4f1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了方便起见，我们首先在一个单独的 python 文件中定义模型架构—<strong class="jp ir"><em class="nc">my _ CNN _ model . py</em></strong></p><p id="9119" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们编写一个创建网络架构的方法。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="342f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1.2 编译、保存、适配和加载</strong></p><p id="25c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在编写方法来编译、保存、拟合和加载模型</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="78d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1.3 模型构建器(包装器)</strong></p><p id="7d00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在编写一个模型构建器，它加载数据并调用上述方法。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><h2 id="98bb" class="mq ky iq bd kz mr ms dn ld mt mu dp lh jy mv mw ll kc mx my lp kg mz na lt nb bi translated">第二步:初始化东西</h2><p id="3748" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们现在创建一个新的 python 文件— <strong class="jp ir"> <em class="nc"> shades.py </em> </strong>，我们在其中编写代码来读取网络摄像头输入，检测人脸，使用我们构建的 CNN 模型，等等。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><h2 id="9ee4" class="mq ky iq bd kz mr ms dn ld mt mu dp lh jy mv mw ll kc mx my lp kg mz na lt nb bi translated">步骤 3:检测输入中的人脸</h2><p id="a659" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">一旦您开始从网络摄像头读取输入，使用我们之前初始化的级联分类器对象检测输入中的人脸。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><h2 id="2e9b" class="mq ky iq bd kz mr ms dn ld mt mu dp lh jy mv mw ll kc mx my lp kg mz na lt nb bi translated">步骤 4:创建过滤器开关触发器</h2><p id="b7d5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在这里，我使用了一个蓝色的瓶盖作为过滤器开关。为了检测蓝帽，我们编写代码来寻找图像中的蓝色轮廓。我们传递我们在步骤 2 中定义的<strong class="jp ir"> <em class="nc"> blueLower </em> </strong> <em class="nc">和</em><strong class="jp ir"><em class="nc">blue upper</em></strong>HSV 范围。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="5764" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们创建了<strong class="jp ir"> <em class="nc"> blueMask </em> </strong>，即应该在视频中找到蓝色的东西，我们使用 OpenCV 的<strong class="jp ir"><em class="nc">cv2 . find contours()</em></strong>方法来找到轮廓。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="f770" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的代码检查框架中是否有轮廓(蓝色瓶盖),一旦发现，它检查轮廓的中心是否接触到我们在这一步中创建的“下一个过滤器”按钮。如果被触摸，我们更改过滤器(将<strong class="jp ir"> <em class="nc">过滤器索引</em> </strong>增加 1)</p><h2 id="1980" class="mq ky iq bd kz mr ms dn ld mt mu dp lh jy mv mw ll kc mx my lp kg mz na lt nb bi translated">步骤 5:使用模型检测面部关键点</h2><p id="6844" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们使用之前初始化的面部层叠来定位帧中的面部。然后，我们对每一张脸进行循环，以预测面部关键点。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="129b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们将检测到的人脸传递给模型之前，我们有必要对输入进行归一化，因为归一化的图像是我们的模型所训练的图像，将其大小调整为 96 x 96 图像，因为这是我们的模型所期望的。上面的代码也是如此。</p><h2 id="8401" class="mq ky iq bd kz mr ms dn ld mt mu dp lh jy mv mw ll kc mx my lp kg mz na lt nb bi translated">第六步:使用面部关键点在脸上添加阴影</h2><p id="2952" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">一旦我们检测到面部关键点，我们就可以用它们来做各种很酷的事情。例如，您可以使用鼻子关键点来添加小胡子，嘴唇关键点来添加颜色，等等。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="342c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们使用了 4 个关键点来配置脸部阴影的宽度和高度。并且，<strong class="jp ir"><em class="nc">face _ resized _ color</em></strong>有阴影并贴图回<strong class="jp ir"> <em class="nc">帧</em> </strong>和<strong class="jp ir"><em class="nc">face _ resized _ color 2</em></strong>有关键点并贴图回<strong class="jp ir"> <em class="nc">帧 2 </em> </strong>。然后我们把它们都展示出来。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nd mo l"/></div></figure><p id="d4ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们只是清理东西。</p><p id="f6c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在此访问完整的项目代码:</p><div class="mb mc gp gr md me"><a href="https://github.com/acl21/Selfie_Filters_OpenCV" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">acl21/Selfie_Filters_OpenCV</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">更新]:我将不再关注与回购相关的问题或邮件，因为我目前非常忙…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">github.com</p></div></div></div></a></div><h1 id="caec" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">执行</h1><p id="8e0b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><strong class="jp ir"> 1。下载数据</strong></p><p id="5e07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从<a class="ae ma" href="https://www.kaggle.com/c/facial-keypoints-detection/data" rel="noopener ugc nofollow" target="_blank">这里</a>下载数据，并把它放在项目目录中名为‘data’的文件夹中。确保“数据”文件夹包含— <strong class="jp ir"> <em class="nc"> training.csv </em> </strong>和<strong class="jp ir"> <em class="nc"> test.csv </em> </strong></p><p id="981a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。建立 CNN 模型</strong></p><pre class="km kn ko kp gt ne nf ng nh aw ni bi"><span id="87ec" class="mq ky iq nf b gy nj nk l nl nm">&gt; python model_builder.py</span></pre><p id="4203" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将调用<strong class="jp ir"><em class="nc">my _ CNN _ model . py</em></strong>，因此请确保您的项目目录中有该文件。</p><p id="6568" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。运行引擎文件</strong></p><pre class="km kn ko kp gt ne nf ng nh aw ni bi"><span id="d634" class="mq ky iq nf b gy nj nk l nl nm">&gt; python shades.py</span></pre><p id="c0b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。抓起一个蓝色瓶盖</strong></p><p id="4cb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">玩得开心点。</p><h1 id="f7ac" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="d401" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在本教程中，我们建立了一个深度卷积神经网络模型，对面部关键点<a class="ae ma" href="https://www.kaggle.com/c/facial-keypoints-detection/data" rel="noopener ugc nofollow" target="_blank">数据</a>进行训练。然后，我们使用该模型来预测在输入网络摄像头数据中检测到的面部的面部关键点。我们还使用轮廓创建了一个开关，它允许我们通过手势迭代其他过滤器。我鼓励您调整模型架构，亲自看看它是如何影响关键点检测的。</p><p id="deff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个数据只有 15 个关键点，还有其他几个数据集在面部标注了超过 30 个关键点。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/0f9d6dc4cc494210893053b387b211f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6kXOpZQ4abIk0EfIkKOpw.jpeg"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk">Awesome right?</figcaption></figure><p id="e16a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ma" href="https://wiki.tum.de/display/lfdv/Facial+Landmark+Detection#FacialLandmarkDetection-ApplicationsofFacialKeypointDetection" rel="noopener ugc nofollow" target="_blank">面部关键点检测的应用</a>:</p><ul class=""><li id="3718" class="ns nt iq jp b jq jr ju jv jy nu kc nv kg nw kk nx ny nz oa bi translated">面部特征检测改善了面部识别</li><li id="ab5d" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">男性/女性区别</li><li id="dabc" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">面部表情区分</li><li id="b89a" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">头部姿态估计</li><li id="9274" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">面部变形</li><li id="7aa7" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">虚拟改造</li><li id="610d" class="ns nt iq jp b jq ob ju oc jy od kc oe kg of kk nx ny nz oa bi translated">面部置换</li></ul><p id="8b72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望这个教程是有趣的。谢谢你阅读它。</p><p id="3ffd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">活也让别人活！<br/>答</p></div></div>    
</body>
</html>