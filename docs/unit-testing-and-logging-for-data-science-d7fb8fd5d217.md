# 数据科学的单元测试和日志记录

> 原文：<https://towardsdatascience.com/unit-testing-and-logging-for-data-science-d7fb8fd5d217?source=collection_archive---------3----------------------->

![](img/3a5424d523aff1076584ac5e87024191.png)

Laufen Castle & Rhein Falls, Schaffhausen, Switzerland.

在我们的行业中，数据科学家的职责包括各种任务。通常，它从数据库查询开始，以完成的模型结束，事实上，这是许多公司的规范，它允许数据科学家专注于只存在于他们专业领域的任务；这是可以理解的，因为研究比其他任务更昂贵。然而，在许多资源匮乏的公司，数据科学家工作的端到端定义包括创建简单的 API、单元测试和日志记录。

在本教程中，我将创建输入输出单元测试、一个日志记录类和一个 API 合适的部署。为此，我们将创建一个使用 MNIST 数据集的监督分类器。请注意，单元测试和记录器的 python 代码是由科里·斯查费[在这里](https://github.com/CoreyMSchafer/code_snippets/tree/master/Python-Unit-Testing)和[在这里](https://github.com/CoreyMSchafer/code_snippets/tree/master/Decorators)提供的。

我们的 logger 是一个 decorator，它是一个具有日志功能的函数，使用“@my_function”语法包装其他函数。这个想法是使用一个通用的包装器，在我们的例子中:

1.  每次执行函数时，为每个函数创建一个文件日志，其中每行包含函数的参数。
2.  报告运行该函数所花费的时间。

我们将“@ my _ logger”&“@ my _ timer”添加到我们想要记录的每个函数中，并知道它们的运行时间。请记住，您可以脱机查看这些日志文件，如果出现错误，您可以相应地调试代码。

以下函数下载 MNIST 数据集，使用 MinMaxScaler 归一化数据，并将原始数据拆分为训练和测试数据集。

作为数据科学家，我们的任务之一是创建一个可以在以后的生产中使用的类。因此，我以一种非常熟悉的方式设计了‘the algorithm’类，你会注意到该类遵循 sklearn 的函数结构，即我们有众所周知的‘fit’和‘predict’函数(以及 **init** )。这些函数将在生产过程中使用，以使用训练集和测试集初始化类，使用训练集(即 fit())训练模型，以及使用测试集(即 predict())进行测试。为了简化，我特意使用了一个简单的训练测试分割。本教程的主要目的是解释单元测试和日志记录是如何工作的，而不是进行交叉验证、网格搜索或其他机器学习方法。最后用“@ my _ logger”&“@ my _ timer”修饰每个函数。

在我们创建单元测试之前，我们需要一些基于数据集的输入和输出示例。首先，我们下载 MNIST 数据集，我们将其分割为 60K & 10K，我们创建一个“算法”类变量并执行 fit()，我们观察训练精度和产生的混淆矩阵。就输入和输出而言，精确度数字和混淆矩阵是唯一的，并且如果我们的模型中有任何变化，包括输入、分割比、随机种子等，精确度数字和混淆矩阵也会变化。因此，在运行模型之后，我们保存单元测试的输出，我们的想法是，如果“算法”类或伴随的函数中有什么变化或中断，输出将会不匹配，测试将会失败。我们对类的 predict()函数做同样的事情，并保存最终的测试准确度和混淆矩阵。

以下是运行上述算法时的输出:

我们的单元测试类“TestInput”继承自“unittest”。' TestCase '，这允许我们使用几个已知的函数如' setUpClass，tearDownClass，setUp，tearDown '，前两个是先执行后执行，后两个是在每个测试函数之前执行。在“设置”功能中，我们下载数据，分割数据，并保存训练和测试精度以及混淆矩阵。这些变量将使我们能够创建两个使用 fit()和 predict()的测试，使用一个众所周知的输入，最后将结果输出与预期输出进行比较。

为此，我们创建了“test_fit()”和“test_predict()”。在每个函数中，我们使用“assertEqual”将使用 fit()或 predict()时的结果输出与预期的输出变量进行比较。预期输出是训练和测试阶段的准确度和混淆矩阵图。如果这些输入输出单元测试失败，这意味着我们的算法有一个关键的变化。最后，我们执行我们的单元测试，如下面的输出所示，你可以看到两个测试都通过了。

请注意，在这里有额外的断言可用于单元测试[。](https://docs.python.org/3/library/unittest.html#unittest.TestCase.debug)

Ori Cohen 拥有计算机科学博士学位，并在机器学习、脑机接口和神经生物学领域完成了博士学位。