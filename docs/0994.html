<html>
<head>
<title>Dealing with Data Disasters: Simple Fixes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理数据灾难:简单的修复</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dealing-with-data-disasters-simple-fixes-6f588f57f993?source=collection_archive---------7-----------------------#2017-07-18">https://towardsdatascience.com/dealing-with-data-disasters-simple-fixes-6f588f57f993?source=collection_archive---------7-----------------------#2017-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您多久收到一次已经准备好用于分析或数据可视化的数据集？不是来自viz示例或教程的？我不知道你是怎么想的，但是几乎所有到我手里的数据都需要至少一点点的清理。</p><p id="721d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数修复都相当简单，有些可以很容易地手动完成。然而，有时我会得到一大堆文件，手动修复每个文件会相当耗时。所以我一直在用python开发一个小的命令行工具，来加速一些数据清理的苦差事。该工具创建了一个新文件，因此原始数据文件仍然是完整的。</p><h1 id="db43" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">通过命令行使用工具</h1><h2 id="ce36" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">撇</h2><p id="bf5a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><code class="fe ma mb mc md b">python cleaner.py -skim</code></p><p id="b8f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将删除csv文件开头的任何空行或多余行。这个似乎很容易用手修复。只需打开文件并删除有问题的行。很简单。</p><p id="e871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果它是一组2000+的文件，并且在每个文件的前两行都有一个徽标，也许还有一个电子邮件地址呢？有些文件下面有一个空行，有些有三个空行。有些还有邮寄地址。</p><p id="6ec8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了处理标题行上面的这些额外的行，标记“-skim”告诉cleaner.py脚本将所有数据保存到一个新的csv文件中，不包含额外的行。空行很容易。该脚本只是检查这些行中是否有任何内容，然后跳到第一个有内容的行。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi me"><img src="../Images/4b44a06bbeffb5ef952e3783b5677f14.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*A4PeVkTyBd9M1DfLUuSZJg.jpeg"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">empty rows above header row</figcaption></figure><p id="4c1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果有额外的行，带有徽标或联系信息，事情会变得稍微复杂一些。大多数情况下，文件有几列数据，额外的行只是一列或两列。在这种情况下，脚本会检查第一行的长度是否小于数据行的一半(在此之前会检查数据行的长度)。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/c63eced2bd5b2a13e829f3ef8402f9c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*U5JZ8I8-bedoE22Hmr9tEw.jpeg"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">extra rows above header row</figcaption></figure><p id="735d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，这种方法在只有几列数据的情况下会失败。还有其他边缘情况，但这是最常见的。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/858581ab46c30bcee156ef6321315c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*aiVNtjKUcMZAr6PJePMqaw.jpeg"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">extra row, but too few columns of data → fail to</figcaption></figure><p id="2840" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，最好使用'-rows '标志来指示要保存哪些行。</p><h2 id="d228" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">选择特定行</h2><p id="d381" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果您知道您想要哪些行，您可以使用'-rows '标志来选择它们。</p><p id="5290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ma mb mc md b">python cleaner.py -rows 1-20</code></p><p id="95d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你只想跳过前10行，你可以只使用你想开始的行号。该脚本假设您需要这之后的所有内容。</p><p id="ad03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ma mb mc md b">python cleaner.py -rows 10</code></p><p id="9730" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这也可以与“-skim”和“-cols”结合使用</p><p id="9de6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ma mb mc md b">python cleaner.py -skim -rows 10 -cols 2-5</code></p><p id="d77c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将删除额外的标题，并保存原始文件中的特定行和列。当我创建测试或样本集时，我经常使用它。</p><h2 id="2762" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">选择特定列</h2><pre class="mf mg mh mi gt ms md mt mu aw mv bi"><span id="33e7" class="lj km iq md b gy mw mx l my mz">python cleaner.py -cols 2, 5-9, 12</span></pre><ul class=""><li id="ee58" class="na nb iq jp b jq jr ju jv jy nc kc nd kg ne kk nf ng nh ni bi translated">可以按索引在范围内单独选择特定的列</li><li id="b7cf" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">索引从0开始。</li></ul><p id="b4c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="no">功能与选择行时略有不同。</em> </strong></p><ul class=""><li id="4a68" class="na nb iq jp b jq jr ju jv jy nc kc nd kg ne kk nf ng nh ni bi translated">如果只给出一个索引-&gt;只选择该列。</li><li id="37b5" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">要选择一个列和后面的所有列，如8之后的所有列，请使用“+”</li></ul><pre class="mf mg mh mi gt ms md mt mu aw mv bi"><span id="383e" class="lj km iq md b gy mw mx l my mz"> -cols 8+ </span></pre><p id="19f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="no">为什么？</em>T3】</strong></p><p id="e5c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">列选择不同于行选择，因为我发现我通常对原始数据集中的特定列感兴趣。有时候，一个数据集有很多问题，我只想一次处理一列(或几列)。对于行，我通常只需要一个小的子集，哪一行并不重要。我可能只想要最后20行，但是我可能不需要指定第9行和第21行。</p><h1 id="287e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">默认情况下会发生什么？</h1><p id="83e5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">许多事情会自动完成。</p><h2 id="d1a0" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">“未命名”标题-移除</h2><p id="d0de" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">将excel表转换为csv可能会导致第一行的空单元格被填充“未命名:#”，因此这些单元格将从标题行中删除。</p><h2 id="258d" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">移除空列和空行</h2><p id="3eb8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">一些csv文件有空的列和行。这些会自动删除。如果一个文件有很多空的列和行，我可能会在做任何事情之前运行清除程序，不带任何标志。</p><h2 id="76d1" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">删除多余的表格和总和行:</h2><p id="ea21" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">有些文件在所有实际数据下方有汇总表，或者有一行是列总和。这些都被移除了。</p><h2 id="d27a" class="lj km iq bd kn lk ll dn kr lm ln dp kv jy lo lp kz kc lq lr ld kg ls lt lh lu bi translated">展平标题:</h2><p id="2a56" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果有多层标题，它们会被展平成一行。</p><p id="4165" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以像这样的桌子</p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="8b0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">会被转换成这样的东西</p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6c9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:如果设置了“另存为json”选项，这个展平功能将被忽略…我们将在另一篇文章中详细讨论json。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="36b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本系列的下一篇文章中，我们将讨论一些稍微复杂一点的修复…比如从一列的内容中提取一个丢失的标题名。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="de40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个项目的源代码可以在<a class="ae ny" href="https://github.com/kristin-henry-sf/dataPython" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p></div></div>    
</body>
</html>