<html>
<head>
<title>Analyze a Soccer game using Tensorflow Object Detection and OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Tensorflow 对象检测和 OpenCV 分析一场足球比赛</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyse-a-soccer-game-using-tensorflow-object-detection-and-opencv-e321c230e8f2?source=collection_archive---------2-----------------------#2018-06-29">https://towardsdatascience.com/analyse-a-soccer-game-using-tensorflow-object-detection-and-opencv-e321c230e8f2?source=collection_archive---------2-----------------------#2018-06-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f0de" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用数据做很酷的事情！</h2></div><h2 id="1398" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h2><p id="d892" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">世界杯赛季已经开始，并有了一个有趣的开端。谁曾想到卫冕冠军德国队会在小组赛中被淘汰</p><p id="5313" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">作为数据科学家，让我们利用这个机会对足球片段进行一些分析。通过使用深度学习和 opencv，我们可以从视频剪辑中提取有趣的见解。请看下面澳大利亚和秘鲁比赛的 gif 示例，我们可以识别所有球员+裁判，足球，还可以根据球员球衣的颜色预测球员属于哪个队。所有这些都可以实时完成。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/22faaab2562831c68e6e6e4ef553af77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*RNjFsMhwNBH5-FMVsxTTKg.gif"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Player detection and team prediction</figcaption></figure><p id="7610" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">你可以找到我在我的<a class="ae ml" href="https://github.com/priya-dwivedi/Deep-Learning/blob/master/soccer_team_prediction/soccer_realtime.ipynb" rel="noopener ugc nofollow" target="_blank"> Github repo </a>上使用的代码。</p><h2 id="a91d" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤概述</h2><p id="3328" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">Tensorflow 对象检测 API 是用于快速构建对象检测模型的非常强大的资源。如果你对这个 API 不熟悉，请看下面我写的介绍 API 的博客，教你如何使用 API 构建自定义模型。</p><p id="66ac" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><a class="ae ml" href="http://deeplearninganalytics.org/blog/introduction-to-tensorflow-object-detection-api" rel="noopener ugc nofollow" target="_blank">tensor flow 对象检测 API 介绍</a></p><p id="2c8e" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><a class="ae ml" href="http://deeplearninganalytics.org/blog/building-toy-detector-with-object-detection-api" rel="noopener ugc nofollow" target="_blank">使用 Tensorflow 对象检测 API 构建自定义模型</a></p><p id="d605" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">API 提供了预训练的对象检测模型，这些模型已经在 COCO 数据集上进行了训练。COCO 数据集是 90 个常见对象的集合。请参见下图中属于 COCO 数据集的对象。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/60164fe314ae2652e0e85da52c578c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orfkpx0NXRBSdl68xKTELQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">coco object categories</figcaption></figure><p id="d645" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">在这种情况下，我们关心类——人和足球，它们都是 COCO 数据集的一部分。</p><p id="c784" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">该 API 还支持大量的模型。请参见下表以供参考。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mr"><img src="../Images/d17ef252b3188220d12b558aab03bfba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cvv6-X0Gl0RXkz6vfTImPA.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Small subset of models supported by the API</figcaption></figure><p id="6958" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这些模型在速度和准确性之间进行了权衡。由于我对实时分析感兴趣，我选择了 SSDLite mobilenet v2。</p><p id="8eed" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">一旦我们使用对象检测 API 识别了球员，为了预测他们属于哪个队，我们可以使用 OpenCV，这是一个强大的图像处理库。如果您不熟悉 OpenCV，请参阅下面的教程:</p><p id="7964" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><a class="ae ml" href="http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_tutorials.html" rel="noopener ugc nofollow" target="_blank"> OpenCV 教程</a></p><p id="2e09" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">OpenCV 允许我们识别特定颜色的面具，我们可以用它来识别红色玩家和黄色玩家。请参见下面的示例，了解 OpenCV 蒙版如何检测图像中的红色。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ms"><img src="../Images/eb955d2e2b0d3a844f76ec6f4be35726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q7hXs-UCHVl9m6AGPPvB-w.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Prediction of red areas in an image</figcaption></figure><h2 id="0e84" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">深入探究主要步骤</h2><p id="7ceb" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">现在让我们详细研究代码。</p><p id="0dfc" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">如果你是第一次使用 Tensorflow 物体检测 API，请从这个<a class="ae ml" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank">链接</a>下载 GitHub。并使用这些<a class="ae ml" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/installation.md" rel="noopener ugc nofollow" target="_blank">指令</a>安装所有的依赖项。</p><p id="0b39" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">如果你没有 OpenCV 设置，请使用这个<a class="ae ml" href="https://docs.opencv.org/3.4.1/d2/de6/tutorial_py_setup_in_ubuntu.html" rel="noopener ugc nofollow" target="_blank">教程</a>从源代码构建它。</p><p id="fbe7" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">我遵循的主要步骤是(请跟随我的<a class="ae ml" href="https://github.com/priya-dwivedi/Deep-Learning/blob/master/soccer_team_prediction/soccer_realtime.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上的 jupyter 笔记本):</p><ul class=""><li id="35e5" class="mt mu iq ld b le lu lh lv ko mv ks mw kw mx lt my mz na nb bi translated">将 SSDLite mobilenet 模型加载到图中，并加载属于 COCO 数据集的类列表</li><li id="58d5" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt my mz na nb bi translated">使用 cv2 打开视频。视频捕获(文件名)并逐个读取每一帧</li><li id="e6b6" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt my mz na nb bi translated">对于每一帧，使用加载的图形执行对象检测</li><li id="908e" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt my mz na nb bi translated">从 SSDLite 返回的结果是每个已识别的类及其置信度得分和边界框预测。因此，现在识别所有置信度大于 0.6 的人，并将他们剔除。</li><li id="8ea5" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt my mz na nb bi translated">现在你有每个球员提取出来。我们需要阅读他们球衣的颜色来预测他们是澳大利亚球员还是秘鲁球员。这是由代码块检测团队完成的。我们首先定义红色和蓝色的颜色范围。然后我们使用 cv2.inRange 和 cv2.bitwise 来创建该颜色的遮罩。为了检测团队，我计算检测到多少红色像素和黄色像素，以及它们占裁剪图像中像素总数的百分比。</li><li id="d2d2" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt my mz na nb bi translated">最后，将所有代码片段组合起来，同时运行所有代码，并使用 cv2.imshow 显示结果</li></ul><h2 id="107a" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论和参考文献</h2><p id="4776" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">太棒了。所以现在你可以看到深度学习和 OpenCV 的简单结合可以产生有趣的结果。现在您有了这些数据，有许多方法可以从中获得更多的见解:</p><ol class=""><li id="7a26" class="mt mu iq ld b le lu lh lv ko mv ks mw kw mx lt nh mz na nb bi translated">通过澳大利亚球门区的摄像机角度，你可以计算出有多少秘鲁球员在澳大利亚球员的球门区</li><li id="1030" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt nh mz na nb bi translated">您可以绘制每个团队足迹的热图，例如秘鲁团队入住率较高的区域有哪些</li><li id="ee86" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt nh mz na nb bi translated">你可以画出守门员的路线</li></ol><p id="32fb" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">对象检测 API 还提供了其他更精确但更慢的模型。你也可以试试那些。</p><p id="8c4d" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">给我一个❤️，如果你喜欢这个职位:)希望你拉代码，并尝试自己。</p><p id="5012" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">我有自己的深度学习咨询公司，喜欢研究有趣的问题。我已经帮助许多初创公司部署了基于人工智能的创新解决方案。请到 http://deeplearninganalytics.org/来看看我们吧。</p><p id="1a49" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">你也可以在 https://medium.com/@priya.dwivedi 的<a class="ae ml" href="https://medium.com/@priya.dwivedi" rel="noopener">看到我的其他作品</a></p><p id="78a9" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">如果你有一个我们可以合作的项目，请通过我的网站或 info@deeplearninganalytics.org 联系我</p><p id="6ab0" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><strong class="ld ir">参考文献</strong></p><ul class=""><li id="be0a" class="mt mu iq ld b le lu lh lv ko mv ks mw kw mx lt my mz na nb bi translated"><a class="ae ml" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank"> Tensorflow 对象检测 API </a></li><li id="7f5a" class="mt mu iq ld b le nc lh nd ko ne ks nf kw ng lt my mz na nb bi translated">关于使用 OpenCV 检测颜色的好教程<a class="ae ml" href="https://www.pyimagesearch.com/2014/08/04/opencv-python-color-detection/" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>