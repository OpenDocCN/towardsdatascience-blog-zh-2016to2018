<html>
<head>
<title>Trading Strategy: Technical Analysis with Python TA-Lib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交易策略:用 Python TA-Lib 进行技术分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/trading-strategy-technical-analysis-with-python-ta-lib-3ce9d6ce5614?source=collection_archive---------3-----------------------#2018-05-14">https://towardsdatascience.com/trading-strategy-technical-analysis-with-python-ta-lib-3ce9d6ce5614?source=collection_archive---------3-----------------------#2018-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/8cfe13f956062c922713fe6fd226f7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n1MpxX4JN7ZbRluN."/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@till_indeman?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vladimir Solomyani</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3b1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(我的<a class="ae kf" href="https://kylelix7.github.io/Trading-Strategy-Technical-Analysis-with-Python-TA-Lib/" rel="noopener ugc nofollow" target="_blank">博客</a>里也有这个帖子)</p><blockquote class="le lf lg"><p id="4528" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">在金融领域，<strong class="ki iu">交易策略</strong>是一个固定的计划，旨在通过在市场上做多或做空来实现盈利回报。正确研究交易策略的主要原因是它的可验证性、可量化性、一致性和客观性。</p><p id="1c07" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">对于每一个交易策略，你都需要定义交易的资产、进场/出场点和资金管理规则。糟糕的资金管理会让潜在的盈利策略变得无利可图。</p><p id="b9f3" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">—来自<a class="ae kf" href="https://en.wikipedia.org/wiki/Technical_analysis" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><p id="10a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">策略分为基于基本面分析和基于技术分析。基本面分析关注公司的资产、收益、市场、股息等，而技术分析只关注股价和成交量。技术分析广泛使用技术指标，这些指标是根据价格和交易量计算出来的，用来洞察交易行为。技术指标进一步分类为波动性、动量、趋势、成交量等。有选择地组合一只股票的指标可能会产生很好的盈利策略。一旦建立了策略，人们应该<a class="ae kf" href="https://www.investopedia.com/terms/b/backtesting.asp" rel="noopener ugc nofollow" target="_blank">用模拟器回测</a>该策略，以在实时交易前测量性能(<a class="ae kf" href="https://medium.com/@kyle.jinhai.li/efficient-frontier-optimize-portfolio-with-scipy-57456428323e" rel="noopener">回报和风险</a>)。我有另一个<a class="ae kf" href="https://medium.com/@kyle.jinhai.li/trading-strategy-back-testing-with-backtrader-6c173f29e37f" rel="noopener">帖子</a>涉及反向交易者的反向测试。</p><p id="1fbd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于技术指标在构建策略中起着重要的作用，我将演示如何使用<a class="ae kf" href="https://www.ta-lib.org/" rel="noopener ugc nofollow" target="_blank"> TA-Lib </a>来计算技术指标并构建一个简单的策略。(请不要直接使用策略进行实时交易，因为需要进行回溯测试)。如果你想自己算指标，参考我<a class="ae kf" href="https://medium.com/@kyle.jinhai.li/trading-technical-analysis-with-pandas-43e737a17861" rel="noopener">上一篇</a>在<a class="ae kf" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>里怎么做。</p><p id="9a3f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将用<a class="ae kf" href="https://en.wikipedia.org/wiki/Relative_strength_index" rel="noopener ugc nofollow" target="_blank"> RSI </a>(一个动量指标)和<a class="ae kf" href="https://en.wikipedia.org/wiki/Bollinger_Bands" rel="noopener ugc nofollow" target="_blank">布林线</a> %b(一个波动指标)构建一个策略。高 RSI(通常高于 70)可能表明股票超买，因此这是卖出信号。低 RSI(通常低于 30)表明股票超卖，这意味着买入信号。布林线告诉我们两个波段之间的大部分价格行为。因此，如果%b 高于 1，价格可能会回落到区间内。因此，这是一个卖出信号。而如果低于 0，则认为是买入信号。这个策略是一个简单的投票机制。当两个指标认为是买入的时候了，它就发出买入指令进场。当两个指标都认为是时候卖出时，它就发出卖出指令退出。</p><h2 id="f0b2" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated">在 Mac 上安装 TA-Lib 和其他依赖项</h2><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="acf7" class="ls lt it mq b gy mu mv l mw mx">python3 -m venv tutorial-env<br/>source ~/tutorial-env/bin/activate<br/>pip install panda<br/>pip install pandas_datareader<br/>pip install matplotlib<br/>pip install scipy<br/>pip install cython<br/>brew install ta-lib<br/>pip install TA-lib</span></pre><h2 id="8b73" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated">计算布林线或 RSI</h2><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="bdc0" class="ls lt it mq b gy mu mv l mw mx"><strong class="mq iu">import </strong>pandas_datareader.data <strong class="mq iu">as </strong>web<br/><strong class="mq iu">import </strong>pandas <strong class="mq iu">as </strong>pd<br/><strong class="mq iu">import </strong>numpy <strong class="mq iu">as </strong>np<br/><strong class="mq iu">from </strong>talib <strong class="mq iu">import </strong>RSI, BBANDS<br/><strong class="mq iu">import </strong>matplotlib.pyplot <strong class="mq iu">as </strong>plt</span><span id="17b3" class="ls lt it mq b gy my mv l mw mx">start = <strong class="mq iu">'2015-04-22'<br/></strong>end = <strong class="mq iu">'2017-04-22'<br/><br/></strong>symbol = <strong class="mq iu">'MCD'<br/></strong>max_holding = 100<br/>price = web.DataReader(name=symbol, data_source=<strong class="mq iu">'quandl'</strong>, start=start, end=end)<br/>price = price.iloc[::-1]<br/>price = price.dropna()<br/>close = price[<strong class="mq iu">'AdjClose'</strong>].values<br/>up, mid, low = BBANDS(close, timeperiod=20, nbdevup=2, nbdevdn=2, matype=0)<br/>rsi = RSI(close, timeperiod=14)<br/>print(<strong class="mq iu">"RSI (first 10 elements)\n"</strong>, rsi[14:24])</span></pre><p id="2864" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="bb1d" class="ls lt it mq b gy mu mv l mw mx">RSI (first 10 elements)<br/> [50.45417011 47.89845022 49.54971141 51.0802541  50.97931103 61.79355957<br/> 58.80010324 54.64867736 53.23445848 50.65447261]</span></pre><p id="b8eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将布林线转换为%b</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="3741" class="ls lt it mq b gy mu mv l mw mx"><strong class="mq iu">def </strong>bbp(price):<br/>    up, mid, low = BBANDS(close, timeperiod=20, nbdevup=2, nbdevdn=2, matype=0)<br/>    bbp = (price[<strong class="mq iu">'AdjClose'</strong>] - low) / (up - low)<br/>    <strong class="mq iu">return </strong>bbp</span></pre><p id="d427" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据指标计算持仓量</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="f55c" class="ls lt it mq b gy mu mv l mw mx">holdings = pd.DataFrame(index=price.index, data={<strong class="mq iu">'Holdings'</strong>: np.array([np.nan] * index.shape[0])})<br/>holdings.loc[((price[<strong class="mq iu">'RSI'</strong>] &lt; 30) &amp; (price[<strong class="mq iu">'BBP'</strong>] &lt; 0)), <strong class="mq iu">'Holdings'</strong>] = max_holding<br/>holdings.loc[((price[<strong class="mq iu">'RSI'</strong>] &gt; 70) &amp; (price[<strong class="mq iu">'BBP'</strong>] &gt; 1)), <strong class="mq iu">'Holdings'</strong>] = 0</span><span id="8ed5" class="ls lt it mq b gy my mv l mw mx">holdings.ffill(inplace=<strong class="mq iu">True</strong>)<br/>holdings.fillna(0, inplace=<strong class="mq iu">True</strong>)</span></pre><p id="b653" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们应该得到基于持有量的交易行为</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="4124" class="ls lt it mq b gy mu mv l mw mx">holdings[<strong class="mq iu">'Order'</strong>] = holdings.diff()<br/>holdings.dropna(inplace=<strong class="mq iu">True</strong>)</span></pre><p id="2571" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们想象一下我们的行动和指标</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="be90" class="ls lt it mq b gy mu mv l mw mx">fig, (ax0, ax1, ax2) = plt.subplots(3, 1, sharex=<strong class="mq iu">True</strong>, figsize=(12, 8))<br/>ax0.plot(index, price[<strong class="mq iu">'AdjClose'</strong>], label=<strong class="mq iu">'AdjClose'</strong>)<br/>ax0.set_xlabel(<strong class="mq iu">'Date'</strong>)<br/>ax0.set_ylabel(<strong class="mq iu">'AdjClose'</strong>)<br/>ax0.grid()<br/><strong class="mq iu">for </strong>day, holding <strong class="mq iu">in </strong>holdings.iterrows():<br/>    order = holding[<strong class="mq iu">'Order'</strong>]<br/>    <strong class="mq iu">if </strong>order &gt; 0:<br/>        ax0.scatter(x=day, y=price.loc[day, <strong class="mq iu">'AdjClose'</strong>], color=<strong class="mq iu">'green'</strong>)<br/>    <strong class="mq iu">elif </strong>order &lt; 0:<br/>        ax0.scatter(x=day, y=price.loc[day, <strong class="mq iu">'AdjClose'</strong>], color=<strong class="mq iu">'red'</strong>)<br/><br/>ax1.plot(index, price[<strong class="mq iu">'RSI'</strong>], label=<strong class="mq iu">'RSI'</strong>)<br/>ax1.fill_between(index, y1=30, y2=70, color=<strong class="mq iu">'#adccff'</strong>, alpha=<strong class="mq iu">'0.3'</strong>)<br/>ax1.set_xlabel(<strong class="mq iu">'Date'</strong>)<br/>ax1.set_ylabel(<strong class="mq iu">'RSI'</strong>)<br/>ax1.grid()<br/><br/>ax2.plot(index, price[<strong class="mq iu">'BB_up'</strong>], label=<strong class="mq iu">'BB_up'</strong>)<br/>ax2.plot(index, price[<strong class="mq iu">'AdjClose'</strong>], label=<strong class="mq iu">'AdjClose'</strong>)<br/>ax2.plot(index, price[<strong class="mq iu">'BB_low'</strong>], label=<strong class="mq iu">'BB_low'</strong>)<br/>ax2.fill_between(index, y1=price[<strong class="mq iu">'BB_low'</strong>], y2=price[<strong class="mq iu">'BB_up'</strong>], color=<strong class="mq iu">'#adccff'</strong>, alpha=<strong class="mq iu">'0.3'</strong>)<br/>ax2.set_xlabel(<strong class="mq iu">'Date'</strong>)<br/>ax2.set_ylabel(<strong class="mq iu">'Bollinger Bands'</strong>)<br/>ax2.grid()<br/><br/>fig.tight_layout()<br/>plt.show()</span></pre><p id="237c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面，我用调整后的麦当劳收盘价(2015 年 4 月至 2017 年 4 月)用绿点(进场点)和红点(出场点)标出了行动。除此之外，RSI 指标和布林线也显示了这两个指标是如何影响交易的。从图中可以看出这个策略是好的。它捕捉了一对夫妇在此期间相对的一些低价和高价。应该进行回溯测试，以了解该策略与基准测试相比表现如何。</p><h2 id="cbee" class="ls lt it bd lu lv lw dn lx ly lz dp ma kr mb mc md kv me mf mg kz mh mi mj mk bi translated">结果在图表中</h2><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/e719c7b8b5a06d0108297350f17dbac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*raNylO8-cSatM6II0nXu3g.png"/></div></div></figure><p id="0c30" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个帖子到此为止。如果你想了解更多关于机器学习的知识，educative.io 网站上有一系列<a class="ae kf" href="https://www.educative.io/profile/view/6083138522447872?aff=VEzk" rel="noopener ugc nofollow" target="_blank">课程很有帮助。这些课程包括像基本的 ML，NLP，图像识别等主题。投资和编码快乐！</a></p></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><p id="ad5a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="lh">来自《走向数据科学》编辑的提示:</em> </strong> <em class="lh">虽然我们允许独立作者根据我们的</em> <a class="ae kf" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lh">规则和指南</em> </a> <em class="lh">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae kf" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lh">读者术语</em> </a> <em class="lh">。</em></p><p id="69b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">推荐阅读:</p><p id="0725" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://amzn.to/33KaKtN" rel="noopener ugc nofollow" target="_blank">动手机器学习</a></p><p id="b268" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://amzn.to/3w8Vzqe" rel="noopener ugc nofollow" target="_blank">用于数据分析的 Python:与 Pandas、NumPy 和 IPython 的数据角力</a></p><p id="cda5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://amzn.to/33O3jlo" rel="noopener ugc nofollow" target="_blank">对冲基金真正在做什么</a></p></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><p id="792e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的帖子:</p><p id="26e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/@fin.techology/my-posts-about-faang-interview-20e529c5f13f?source=your_stories_page---------------------------" rel="noopener">我关于 FAANG 访谈的帖子</a></p><p id="8fb5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://bit.ly/3bBOjtJ" rel="noopener ugc nofollow" target="_blank">我的 YouTube 频道</a></p><p id="77e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/@fin.techology/my-posts-about-finance-and-tech-7b7e6b2e57f4?source=your_stories_page---------------------------" rel="noopener">我关于金融和科技的帖子</a></p><p id="cc92" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/@fin.techology/from-crud-app-dev-to-sde-in-voice-assistant-my-ongoing-journey-to-ml-4ea11ec4966e?" rel="noopener">从 CRUD web 应用开发到语音助手中的 SDE——我正在进行的机器学习之旅</a></p><p id="07cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener" target="_blank" href="/full-stack-development-tutorial-integrate-aws-lambda-serverless-service-into-angular-spa-abb70bcf417f">全栈开发教程:将 AWS Lambda 无服务器服务集成到 Angular SPA 中</a></p><p id="a13c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener" target="_blank" href="/full-stack-development-tutorial-serverless-rest-api-running-on-aws-lambda-a9a501f54405">全栈开发教程:用运行在 AWS Lambda 上的无服务器 REST API 提供交易数据</a></p><p id="9153" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener" target="_blank" href="/full-stack-development-tutorial-visualize-trading-data-on-angular-spa-7ec2a5749a38">全栈开发教程:在 Angular SPA 上可视化交易数据(1) </a></p><p id="855b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/@kyle.jinhai.li/reinforcement-learning-introduction-to-q-learning-444c951e292c" rel="noopener">强化学习:Q 学习简介</a></p></div></div>    
</body>
</html>