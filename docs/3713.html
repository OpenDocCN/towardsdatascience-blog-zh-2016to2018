<html>
<head>
<title>Model Tracking Tools for Data Science (mlflow)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学的模型跟踪工具(mlflow)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/model-tracking-tools-for-data-science-mlflow-51b681f8452e?source=collection_archive---------7-----------------------#2018-06-10">https://towardsdatascience.com/model-tracking-tools-for-data-science-mlflow-51b681f8452e?source=collection_archive---------7-----------------------#2018-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a51e49dfd4c1c0c1730267e6670578ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gnQhBwU_d_xf0dmo.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: <a class="ae kc" href="https://www.recordedfuture.com/machine-learning-cybersecurity-applications/" rel="noopener ugc nofollow" target="_blank">https://www.recordedfuture.com/machine-learning-cybersecurity-applications/</a></figcaption></figure><p id="dece" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在数据科学工作中，Jupyter 笔记本是一个众所周知的工具。除此之外，我们可能会使用 databricks 的笔记本或 Colab(由谷歌)。产品化怎么样？</p><p id="fc95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如何将我们的模型部署到生产中？如果你使用 TensorFlow 库来建立模型，我们可以使用 tensorflow 服务。使用 Azure 平台的话可以用 Data Science Workbench。如果我们真的使用上面的解决方案呢？一些公司建立了内部系统，如米开朗基罗(优步)、<a class="ae kc" href="https://code.facebook.com/posts/1072626246134461/introducing-fblearner-flow-facebook-s-ai-backbone/" rel="noopener ugc nofollow" target="_blank"> FBLearner Flow(脸书)</a>。然而，那些平台是为它们的内部系统设计的。</p><p id="e0a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有开源吗？在此之前，我们有<a class="ae kc" href="https://github.com/mitdbg/modeldb" rel="noopener ugc nofollow" target="_blank"> modeldb </a>。我们有了新的选择，mlflow，它刚刚在上周(2018 年 6 月 5 日)发布了 alpha 版本。让我们参观一下这个产品。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/aec7df038e9629b9aef0ccd0bad3da22.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/0*ru8UfSHjDIQRu_C-.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: <a class="ae kc" href="https://sdtimes.com/ai/databricks-releases-mlflow-runtime-for-ml-and-databricks-delta-at-spark-ai-summit/" rel="noopener ugc nofollow" target="_blank">https://sdtimes.com/ai/databricks-releases-mlflow-runtime-for-ml-and-databricks-delta-at-spark-ai-summit/</a></figcaption></figure><p id="a696" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，您必须安装 mlflow，然后在命令行中执行以下命令来启动 UI 服务</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="156a" class="ll lm iq lh b gy ln lo l lp lq">mlflow ui</span></pre><p id="0029" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并执行以下命令将数据传递给服务器</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="c74e" class="ll lm iq lh b gy ln lo l lp lq">lr = LogisticRegression(max_iter=param['max_iter'], penalty=param['penalty'], solver=param['solver'])<br/>        lr.fit(x_train, y_train)<br/>        y_pred = lr.predict(x_test)</span><span id="3de3" class="ll lm iq lh b gy lr lo l lp lq">(rmse, mae, r2) = eval_metrics(y_test, y_pred)</span><span id="4816" class="ll lm iq lh b gy lr lo l lp lq">mlflow.log_metric("rmse", rmse)<br/>        mlflow.log_metric("r2", r2)<br/>        mlflow.log_metric("mae", mae)<br/>        mlflow.log_param("max_iter", param['max_iter'])<br/>        mlflow.log_param("penalty", param['penalty'])<br/>        mlflow.log_param("solver", param['solver'])</span><span id="6823" class="ll lm iq lh b gy lr lo l lp lq">mlflow.sklearn.log_model(lr, "model")</span></pre><p id="629d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">稍后，转到<a class="ae kc" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/83ae3f7ede0f227e742d70402244cd30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0QbgQoKCMg4_Q7uJ7Grkg.png"/></div></div></figure><p id="d6d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，它会显示“日期”、“用户”、“源”、“版本”、“参数”和“指标”。</p><p id="0a58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如需源代码，请访问<a class="ae kc" href="https://github.com/makcedward/data_science_tool/blob/master/sample/mlflow-tracking-evaluation.md" rel="noopener ugc nofollow" target="_blank"> github </a>获取完整版本</p><h1 id="dafe" class="lt lm iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">估价</h1><p id="be32" class="pw-post-body-paragraph kd ke iq kf b kg mq ki kj kk mr km kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated"><strong class="kf ir"> <em class="mv">用户</em> </strong></p><p id="282f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">系统将使用 pwd (linux 命令)来获取用户 ID。如果操作系统是 Window，它将使用“未知”的默认用户 ID。我相信他们对审计目的有所顾虑，这就是为什么他们不允许将用户 ID 作为参数传递。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="fbd6" class="ll lm iq lh b gy ln lo l lp lq"># Copy from mlflow source code</span><span id="2af1" class="ll lm iq lh b gy lr lo l lp lq">_DEFAULT_USER_ID = "unknown"</span><span id="254f" class="ll lm iq lh b gy lr lo l lp lq">def _get_user_id():<br/>    <em class="mv">""" Gets the ID of the user for the current run. """<br/>    </em>try:<br/>        import pwd<br/>        return <strong class="lh ir">pwd.getpwuid(os.getuid())[0]</strong><br/>    except ImportError:<br/>        return _DEFAULT_USER_ID</span></pre><p id="be8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们能在 Window 中做些什么来“劫持”它呢？:)我们可以覆盖全局值(在 alpha 版本中有效)。但是，不建议这样做，因为这会破坏审计/安全考虑。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="7991" class="ll lm iq lh b gy ln lo l lp lq">mlflow.tracking._DEFAULT_USER_ID = '<a class="ae kc" href="https://github.com/makcedward/" rel="noopener ugc nofollow" target="_blank">https://github.com/makcedward/</a>'</span></pre><p id="d08e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="mv">来源</em> </strong></p><p id="4b37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，带有路径的文件名将被用作源文件。强烈建议提供源代码，以便更好地使用 UI 搜索。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="09b5" class="ll lm iq lh b gy ln lo l lp lq"># Copy from mlflow source code</span><span id="547c" class="ll lm iq lh b gy lr lo l lp lq">def _get_main_file():<br/>    if len(sys.argv) &gt; 0:<br/>        return <strong class="lh ir">sys.argv[0]</strong><br/>    return None</span></pre><p id="c18e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="mv">版本</em> </strong></p><p id="5995" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般来说，版本号可能是“1.0.0”就可以了。但是，如果您定义的版本号是“123.456.789”或“测试”。你会有麻烦，因为用户界面显示多达 6 个字符。从源代码来看，它将版本简化为“shortVersion ”,允许最多 6 个字符。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="ffce" class="ll lm iq lh b gy ln lo l lp lq"># Copy from mlflow source code</span><span id="6b0f" class="ll lm iq lh b gy lr lo l lp lq">static renderVersion(run) {<br/>  if (run.source_version) {<br/>    <strong class="lh ir">const shortVersion = run.source_version.substring(0, 6);</strong><br/>    if (run.source_type === "PROJECT") {<br/>      const GITHUB_RE = /[:@]github.com[:/]([^/.]+)\/([^/.]+)/;<br/>      const match = run.source_name.match(GITHUB_RE);<br/>      if (match) {<br/>        const url = "https://github.com/" + match[1] + "/" + match[2] + "/tree/" + run.source_version;<br/>        return &lt;a href={url}&gt;{shortVersion}&lt;/a&gt;;<br/>      }<br/>    } else {<br/>      return shortVersion;<br/>    }<br/>  }<br/>  return null;<br/>}</span></pre><p id="fe60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="mv">储存</em> </strong></p><p id="59e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记录将保存在文件系统中。换句话说，它不将数据持久化到 DB 中，并且它可能在 UI 搜索和其他系统问题中具有潜在的查询性能。相信将记录保存到数据库应该在路线图中。</p><p id="23e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> API </strong></p><p id="f0e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">API 接口由单线程的 Flask 构建。因此，它不能同时处理大量的请求。似乎在投入生产之前，必须先解决这个问题。</p><h1 id="8b2b" class="lt lm iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">关于我</h1><p id="9f6c" class="pw-post-body-paragraph kd ke iq kf b kg mq ki kj kk mr km kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">我是湾区的数据科学家。专注于数据科学、人工智能，尤其是 NLP 和平台相关领域的最新发展。</p><p id="040f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">中:【http://medium.com/@makcedward/】T2</p><p id="5738" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">领英:【https://www.linkedin.com/in/edwardma1026 T4】</p><p id="f1a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">github:<a class="ae kc" href="https://github.com/makcedward" rel="noopener ugc nofollow" target="_blank">https://github.com/makcedward</a></p><p id="dce4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">https://www.kaggle.com/makcedward</p></div></div>    
</body>
</html>