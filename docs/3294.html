<html>
<head>
<title>Scrape Data and Build a Webapp in R Using Rvest and Shiny</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rvest和Shiny在R中抓取数据并构建一个Webapp</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scrape-data-and-build-a-webapp-in-r-using-rvest-and-shiny-f20d84dd1b74?source=collection_archive---------3-----------------------#2018-04-29">https://towardsdatascience.com/scrape-data-and-build-a-webapp-in-r-using-rvest-and-shiny-f20d84dd1b74?source=collection_archive---------3-----------------------#2018-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eed079891c6f206562e5b0c9082689e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nKuw3oqtBYH35IUL."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@patrickian4?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Patrick Fore</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d8a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">通过传统方法分享你的分析和数据科学发现很酷，但是如果你想和更多的人分享呢？如果您想要实时共享某个数据集的分析，该怎么办？通过几十行代码，您可以在一个下午创建这样一个工具。</p><p id="fed1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将分享我如何使用R计算语言和几个关键包构建了一个几乎实时的webapp。您将学习如何抓取网站、解析数据，以及创建任何拥有浏览器的人都可以访问的webapp。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h2 id="12a3" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">问题陈述</h2><blockquote class="mk ml mm"><p id="682a" class="kd ke mn kf b kg kh ki kj kk kl km kn mo kp kq kr mp kt ku kv mq kx ky kz la ij bi translated">我需要显示来自https://coinmarketcap.com/gainers-losers/<a class="ae kc" href="https://coinmarketcap.com/gainers-losers/" rel="noopener ugc nofollow" target="_blank">的数据，以便让我轻松地看到当天哪些硬币在真正的加热器上。</a></p></blockquote><h2 id="8ce5" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">工具</h2><p id="7e68" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我们将利用<a class="ae kc" href="https://github.com/hadley/rvest" rel="noopener ugc nofollow" target="_blank"> Rvest包</a>、<a class="ae kc" href="https://github.com/rstudio/shiny" rel="noopener ugc nofollow" target="_blank"> shiny </a>、<a class="ae kc" href="https://github.com/rstudio/shinydashboard" rel="noopener ugc nofollow" target="_blank"> shinydashboard </a>以及各种<a class="ae kc" href="https://github.com/tidyverse/tidyverse" rel="noopener ugc nofollow" target="_blank"> tidyverse </a>工具，都在<a class="ae kc" href="https://www.rstudio.com/" rel="noopener ugc nofollow" target="_blank"> Rstudio IDE </a>中。</p><p id="930f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然RSelenium是一个流行且可行的web抓取工具(通过解析HTML从网站收集数据)，但Rvest包无疑是一个更整洁、更干净的工具。</p><p id="b5a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该脚本的基本工作流程如下:</p><ol class=""><li id="1ca3" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">创建新的Rstudio项目</li><li id="bd31" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">创建一个“应用程序。r "闪亮的文件</li><li id="d394" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">调用库</li><li id="50ac" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">构建函数</li><li id="78b9" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">构建用户界面</li><li id="428e" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">构建服务器</li><li id="a5e2" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">部署</li></ol><p id="1733" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以让我们开始吧。</p><h2 id="95fe" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">调用库</h2><p id="dc26" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我们将调用上面“工具”一节中讨论的库:</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="4328" class="lr ls iq np b gy nt nu l nv nw">library(shiny)<br/>library(tidyverse)<br/>library(shinydashboard)<br/>library(rvest)</span></pre><h2 id="a3e6" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">构建函数</h2><p id="b8bf" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">始终认识到编码的枯燥(不要重复自己)准则，我们将构建简单的函数来收集和整理我们的数据，因此我们不必重复代码。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="df22" class="lr ls iq np b gy nt nu l nv nw">#####################<br/>####### F N S #######<br/>#####################</span><span id="1543" class="lr ls iq np b gy nx nu l nv nw">get.data &lt;- function(x){</span><span id="f7e9" class="lr ls iq np b gy nx nu l nv nw">myurl &lt;- read_html("<a class="ae kc" href="https://coinmarketcap.com/gainers-losers/" rel="noopener ugc nofollow" target="_blank">https://coinmarketcap.com/gainers-losers/</a>") # read our webpage as html</span><span id="4ff8" class="lr ls iq np b gy nx nu l nv nw">myurl &lt;- html_table(myurl)  # convert to an html table for ease of use<br/>  <br/>  <br/>  to.parse &lt;- myurl[[1]]  # pull the first item in the list<br/>  to.parse$`% 1h` &lt;- gsub("%","",to.parse$`% 1h`) # cleanup - remove non-characters<br/>  to.parse$`% 1h`&lt;- as.numeric(to.parse$`% 1h`) #cleanup - convert percentages column to numeric so we can sort<br/>  to.parse$Symbol &lt;- as.factor(to.parse$Symbol) # cleanup - convert coin symbol to factor<br/>  <br/>  to.parse$Symbol &lt;- factor(to.parse$Symbol,<br/>                            levels = to.parse$Symbol[order(to.parse$'% 1h')])  # sort by gain value<br/>  to.parse  # return the finished data.frame<br/>}</span></pre><p id="bd5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> get.data </strong>函数抓取我们的网站，返回一个对我们有用的数据框。</p><p id="0308" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<strong class="kf ir"> Rvest </strong>包中的<strong class="kf ir"> read_html </strong>和<strong class="kf ir"> html_table </strong>函数读入网页数据，并对其进行格式化，以便于处理。接下来，我们从该网页中取出许多表格中的第一个，并用基本的R函数清理它。最后，我们根据百分比增益值对新数据帧进行排序。</p><p id="8016" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您要在R控制台中用</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="98f1" class="lr ls iq np b gy nt nu l nv nw">get.data()</span></pre><p id="9bea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将返回如下所示的数据框:</p><figure class="nk nl nm nn gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/9d7134f5dc5094ad50007bf9ddf0b5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*ZlCdKuY9VfeCjkCBZ0ZsXw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">get.data() returns this data.frame</figcaption></figure><p id="1409" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如你所见，这显示了哪些硬币在过去的一个小时里收益最大，按收益百分比排序。这些数据是整个仪表板的基础。</p><p id="b867" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将构建的下一个函数叫做<strong class="kf ir"> get.infobox.val. </strong>它只是从上面的数据框中提取最高值。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="cb23" class="lr ls iq np b gy nt nu l nv nw">get.infobox.val &lt;- function(x){<br/>  <br/>  df1 &lt;- get.data() # run the scraping function above and assign that data.frame to a variable<br/>  df1 &lt;- df1$`% 1h`[1]  # assign the first value of the % gain column to same variable<br/>  df1   # return value<br/>  <br/>}</span></pre><p id="b021" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个函数叫做<strong class="kf ir"> get.infobox.coin </strong>，返回最高硬币的名称。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="f8ed" class="lr ls iq np b gy nt nu l nv nw">get.infobox.val &lt;- function(x){<br/>  <br/>  df1 &lt;- get.data() # run the scraping function above and assign that data.frame to a variable<br/>  df1 &lt;- df1$`% 1h`[1]  # assign the first value of the % gain column to same variable<br/>  df1   # return value<br/>  <br/>}</span></pre></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="9460" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们已经构建了我们的函数，是时候构建闪亮的仪表板，向全世界显示我们的数据了。</p><h2 id="290e" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">进入闪亮的Webapps</h2><p id="2d26" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">一个闪亮的webapp将允许我们建立一个交互式仪表板，我们将让Rstudio通过他们的服务器为我们托管。他们有一个免费的计划，所以任何人都可以很容易地开始使用它。来自<a class="ae kc" href="https://shiny.rstudio.com/articles/basics.html" rel="noopener ugc nofollow" target="_blank"> Rstudio文档</a>:</p><blockquote class="mk ml mm"><p id="1b46" class="kd ke mn kf b kg kh ki kj kk kl km kn mo kp kq kr mp kt ku kv mq kx ky kz la ij bi translated">闪亮的应用程序有两个组件，一个用户界面对象和一个服务器函数，它们作为参数传递给<code class="fe nz oa ob np b">shinyApp </code>函数，该函数从这个UI/服务器对创建一个闪亮的应用程序对象。</p></blockquote><p id="f863" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上，我强烈推荐浏览上面引用的官方文档，让自己熟悉基本的<strong class="kf ir">闪亮的</strong>概念。</p><p id="1b1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了避免过多赘述，让我们从构建<strong class="kf ir"> UI </strong>对象开始。</p><h1 id="ff22" class="oc ls iq bd lt od oe of lw og oh oi lz oj ok ol mc om on oo mf op oq or mi os bi translated">用户界面</h1><p id="06ec" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">在UI对象中，我们将展示我们的仪表板。当我做这个的时候，我用了一个铅笔线框草图。为了帮助您直观地看到最终结果，这里是成品的截图:</p><figure class="nk nl nm nn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ot"><img src="../Images/80aea8285d88a0a592e8960885dbc5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJONJIkGE_HceAzQrGYgEg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Our finished dashboard for reference</figcaption></figure><p id="b2b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">shinydashboard结构允许我们有一个侧边栏和一个仪表板区域，我们可以在那里添加行和列中的框。上面的黑色区域是侧边栏，右边的是主体。现在来看一下<strong class="kf ir"> UI </strong>代码。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="ab5b" class="lr ls iq np b gy nt nu l nv nw">ui &lt;- dashboardPage(<br/>  <br/>  <br/>  # H E A D E R<br/>  <br/>  dashboardHeader(title = "Alt Coin Gainers"),<br/>  <br/>  </span></pre><p id="f27d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将<strong class="kf ir"> dashboardPage </strong>函数分配给UI，然后添加我们需要的部分。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="d633" class="lr ls iq np b gy nt nu l nv nw"># S I D E B A R<br/>  <br/>  dashboardSidebar(<br/>    <br/>    h5("A slightly interactive dashboard that pulls the top gainers from the last hour from<br/>       coinmarketcap.com. Refreshes every 60 seconds."),<br/>    <br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    <br/>    h6("Built by Brad Lindblad in the R computing language <br/>      [  R Core Team (2018). R: A language and environment for statistical computing. R Foundation for Statistical Computing,<br/>  Vienna, Austria. URL <a class="ae kc" href="https://www.R-project.org/" rel="noopener ugc nofollow" target="_blank">https://www.R-project.org/</a>]"),<br/>    br(),<br/>    h6("R version 3.4.4 (2018-03-15) 'Someone to Lean On'"),<br/>    br(),<br/>    a("<a class="ae kc" href="mailto:bradley.lindblad@gmail.com" rel="noopener ugc nofollow" target="_blank">bradley.lindblad@gmail.com</a>", href="<a class="ae kc" href="mailto:bradley.lindblad@gmail.com" rel="noopener ugc nofollow" target="_blank">bradley.lindblad@gmail.com</a>")<br/>    <br/>  ),</span></pre><p id="98bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">侧边栏是放置文档或过滤器的好地方(这在本教程中没有涉及)。您会注意到，您可以将某些html标签和类传递给文本。<strong class="kf ir"> H5 </strong>只是一个标签，它将文本定义为文档中的第五层标题，通常是第五大文本。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="6d7a" class="lr ls iq np b gy nt nu l nv nw"># B O D Y<br/>  dashboardBody(<br/>    <br/>  fluidRow(<br/>    <br/>    # InfoBox<br/>    infoBoxOutput("top.coin",<br/>                  width = 3),<br/>    <br/>    # InfoBox<br/>    infoBoxOutput("top.name",<br/>                  width = 3)<br/>    <br/>  ),<br/>  <br/>  fluidRow(</span><span id="cd93" class="lr ls iq np b gy nx nu l nv nw">column(<br/>    # Datatable<br/>      box(<br/>        status = "primary",<br/>        headerPanel("Data Table"),<br/>        solidHeader = T,<br/>        br(),<br/>        DT::dataTableOutput("table", height = "350px"),<br/>        width = 6,<br/>        height = "560px"<br/>      ),<br/>      <br/>      # Chart<br/>      box(<br/>        status = "primary",<br/>        headerPanel("Chart"),<br/>        solidHeader = T,<br/>        br(),<br/>        plotOutput("plot", height = "400px"),<br/>        width = 6,<br/>        height = "500px"<br/>      ),<br/>      width = 12<br/>    )<br/>    <br/>  )<br/>  )<br/>  <br/>)</span></pre><p id="50e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<strong class="kf ir">主体</strong>部分，我们构建仪表板中的主要项目。<strong class="kf ir">主体</strong>部分有几个关键部分实际输出数据。</p><h2 id="4213" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">信息盒</h2><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="1f7b" class="lr ls iq np b gy nt nu l nv nw"># InfoBox<br/>    infoBoxOutput("top.coin",<br/>                  width = 3),<br/>    <br/>    # InfoBox<br/>    infoBoxOutput("top.name",<br/>                  width = 3)</span></pre><p id="8849" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两个代码块输出了仪表板顶部的两个紫色框。两个输出ID“top . coin”和“top.name”引用了在<strong class="kf ir">服务器</strong>函数中输出的数据，我们将在后面介绍。</p><h2 id="6c58" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">数据表和图</h2><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="0cea" class="lr ls iq np b gy nt nu l nv nw"># Datatable<br/>      box(<br/>        status = "primary",<br/>        headerPanel("Data Table"),<br/>        solidHeader = T,<br/>        br(),<br/>        DT::dataTableOutput("table", height = "350px"),<br/>        width = 6,<br/>        height = "560px"<br/>      ),</span><span id="d7d4" class="lr ls iq np b gy nx nu l nv nw"># Chart<br/>      box(<br/>        status = "primary",<br/>        headerPanel("Chart"),<br/>        solidHeader = T,<br/>        br(),<br/>        plotOutput("plot", height = "400px"),<br/>        width = 6,<br/>        height = "500px"<br/>      ),</span></pre><p id="0e77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据表和曲线图也是如此。<strong class="kf ir">表</strong>是将绑定到下面的<strong class="kf ir">服务器</strong>函数的输出ID，并且<strong class="kf ir">图</strong>也绑定到<strong class="kf ir">服务器</strong>。</p><h1 id="c06c" class="oc ls iq bd lt od oe of lw og oh oi lz oj ok ol mc om on oo mf op oq or mi os bi translated">计算机网络服务器</h1><p id="be5b" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">下一个议程是定义我们的<strong class="kf ir">服务器功能</strong>。服务器函数是通过<strong class="kf ir"> UI </strong> <strong class="kf ir">函数</strong>计算、读取、绘制或显示数值的地方。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="571e" class="lr ls iq np b gy nt nu l nv nw">#####################<br/>#### S E R V E R ####<br/>#####################</span><span id="3e83" class="lr ls iq np b gy nx nu l nv nw">server &lt;- function(input, output) {</span><span id="aad0" class="lr ls iq np b gy nx nu l nv nw"># R E A C T I V E <br/>  liveish_data &lt;- reactive({<br/>    invalidateLater(60000)    # refresh the report every 60k milliseconds (60 seconds)<br/>    get.data()                # call our function from above<br/>  })<br/>  <br/>  <br/>  live.infobox.val &lt;- reactive({<br/>    invalidateLater(60000)    # refresh the report every 60k milliseconds (60 seconds)<br/>    get.infobox.val()         # call our function from above<br/>  })<br/>  <br/>  <br/>  live.infobox.coin &lt;- reactive({<br/>    invalidateLater(60000)    # refresh the report every 60k milliseconds (60 seconds)<br/>    get.infobox.coin()        # call our function from above<br/>  })</span></pre><p id="b53c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还记得我们一开始定义的函数吗？我们现在就要使用它们。我们还将添加另一个概念:<strong class="kf ir">反应式表达</strong>。这些允许我们闪亮的仪表板定期更新或基于用户输入。对于这个仪表板，我们要求程序每60秒运行一次我们的函数，用我们抓取的网站的最新值更新仪表板。</p><h2 id="ff5c" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">数据表</h2><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="ed0c" class="lr ls iq np b gy nt nu l nv nw"># D A T A   T A B L E   O U T P U T<br/>  output$table &lt;- DT::renderDataTable(DT::datatable({<br/>    data &lt;- liveish_data()}))</span></pre><p id="bcb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还记得我们上面定义的输出ID <strong class="kf ir">表</strong>吗？我们将在上面的函数中引用它。注意，我们从一开始就使用了<strong class="kf ir"> liveish_data </strong>反应函数，而不是我们的原始函数。</p><h2 id="6190" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">情节</h2><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="3379" class="lr ls iq np b gy nt nu l nv nw"># P L O T   O U T P U T<br/>  output$plot &lt;- renderPlot({ (ggplot(data=liveish_data(),       aes(x=Symbol, y=`% 1h`)) +<br/>          geom_bar(stat="identity", fill = "springgreen3") +<br/>          theme(axis.text.x = element_text(angle = 90, hjust = 1)) +<br/>          ggtitle("Gainers from the Last Hour"))<br/>  })</span></pre><p id="7d36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们使用ggplot2绘制一个简单的柱状图。</p><h2 id="b218" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">信息盒</h2><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="43ba" class="lr ls iq np b gy nt nu l nv nw"># I N F O B O X   O U T P U T - V A L<br/>  output$top.coin &lt;- renderInfoBox({<br/>    infoBox(<br/>      "Gain in Last Hour",<br/>      paste0(live.infobox.val(), "%"),<br/>      icon = icon("signal"),<br/>      color = "purple",<br/>      fill = TRUE)<br/>  })<br/>   <br/>  <br/>  # I N F O B O X   O U T P U T - N A M E<br/>  output$top.name &lt;- renderInfoBox({<br/>    infoBox(<br/>      "Coin Name",<br/>      live.infobox.coin(),<br/>      icon = icon("bitcoin"),<br/>      color = "purple",<br/>      fill = TRUE)<br/>  })<br/>  <br/>}</span></pre><p id="1514" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们使用服务器函数开头定义的反应表达式绘制两个信息框。</p><h1 id="6f80" class="oc ls iq bd lt od oe of lw og oh oi lz oj ok ol mc om on oo mf op oq or mi os bi translated">部署</h1><p id="472f" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">脚本的最后一部分将我们的UI与服务器结合起来，并部署应用程序。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="c380" class="lr ls iq np b gy nt nu l nv nw">#####################<br/>#### D E P L O Y ####<br/>#####################</span><span id="3ad9" class="lr ls iq np b gy nx nu l nv nw"># Return a Shiny app objectshinyApp(ui = ui, server = server)<br/>shinyApp(ui = ui, server = server)</span></pre><p id="e9f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，您应该有一个正在运行的应用程序出现在Rstudio的一个窗口中。</p><figure class="nk nl nm nn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ou"><img src="../Images/9301fed47871accb1fa4b3cb8b58bab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2ntA62bkzQI3Hdv4NzT9w.png"/></div></div></figure><p id="bc33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击<strong class="kf ir">在浏览器中打开</strong>按钮，查看应用程序的非混乱版本；部署后您将看到的实际版本。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="af03" class="oc ls iq bd lt od ov of lw og ow oi lz oj ox ol mc om oy oo mf op oz or mi os bi translated">收尾工作</h1><p id="8ab7" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">至此，所有的重担都完成了；我们构建了一个从网站下载并解析html的刮刀，然后我们使用shinydashboard框架构建了一个闪亮的应用程序，向全世界展示我们的分析。</p><p id="2380" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上，所有剩下的是部署应用程序，这让我们非常容易。只需点击Rstudio预览中出现的<strong class="kf ir">部署</strong>按钮，然后按照说明进行操作。总的来说，从这一点开始部署应该不到10分钟。</p><p id="2745" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这篇小教程能在你的R之旅中帮助你，并给你一些关于用这种强大的开源语言可以构建什么样的东西的想法。</p><p id="e46e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有任何问题或者只是想聊聊R，请发邮件到<a class="ae kc" href="http://bradley.lindblad@gmail.com" rel="noopener ugc nofollow" target="_blank">bradley.lindblad@gmail.com给我。</a></p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><figure class="nk nl nm nn gt jr gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/47594ebe51b95f40c68de0cf2e3025e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/1*H2vHnDjL4yXqhfFtHuzjzg.gif"/></div></figure><h1 id="370a" class="oc ls iq bd lt od oe of lw og oh oi lz oj ok ol mc om on oo mf op oq or mi os bi translated">附录</h1><p id="0abd" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">这是完整的脚本，你也可以从我的Github页面上为这个项目克隆。</p><pre class="nk nl nm nn gt no np nq nr aw ns bi"><span id="4e62" class="lr ls iq np b gy nt nu l nv nw">library(shiny)<br/>library(tidyverse)<br/>library(shinydashboard)<br/>library(rvest)</span><span id="9619" class="lr ls iq np b gy nx nu l nv nw">#####################<br/>####### F N S #######<br/>#####################</span><span id="b2e4" class="lr ls iq np b gy nx nu l nv nw">get.data &lt;- function(x){</span><span id="9796" class="lr ls iq np b gy nx nu l nv nw">myurl &lt;- read_html("<a class="ae kc" href="https://coinmarketcap.com/gainers-losers/" rel="noopener ugc nofollow" target="_blank">https://coinmarketcap.com/gainers-losers/</a>") # read our webpage as html<br/>  myurl &lt;- html_table(myurl)  # convert to an html table for ease of use<br/>  <br/>  <br/>  to.parse &lt;- myurl[[1]]  # pull the first item in the list<br/>  to.parse$`% 1h` &lt;- gsub("%","",to.parse$`% 1h`) # cleanup - remove non-characters<br/>  to.parse$`% 1h`&lt;- as.numeric(to.parse$`% 1h`) #cleanup - convert percentages column to numeric<br/>  to.parse$Symbol &lt;- as.factor(to.parse$Symbol) # cleanup - convert coin symbol to factor<br/>  <br/>  to.parse$Symbol &lt;- factor(to.parse$Symbol,<br/>                            levels = to.parse$Symbol[order(to.parse$'% 1h')])  # sort by gain value<br/>  to.parse  # return the finished data.frame<br/>}</span><span id="df00" class="lr ls iq np b gy nx nu l nv nw">get.infobox.val &lt;- function(x){<br/>  <br/>  df1 &lt;- get.data() # run the scraping function above and assign that data.frame to a variable<br/>  df1 &lt;- df1$`% 1h`[1]  # assign the first value of the % gain column to same variable<br/>  df1   # return value<br/>  <br/>}</span><span id="f4f9" class="lr ls iq np b gy nx nu l nv nw">get.infobox.coin &lt;- function(x){<br/>  <br/>  df &lt;- get.data()  # run the scraping function above and assign that data.frame to a variable<br/>  df &lt;- df$Name[1]  # assign the first value of the name column to same variable<br/>  df   # return value<br/>  <br/>}</span><span id="3827" class="lr ls iq np b gy nx nu l nv nw">#####################<br/>####### U I #########<br/>#####################</span><span id="056c" class="lr ls iq np b gy nx nu l nv nw">ui &lt;- dashboardPage(<br/>  <br/>  <br/>  # H E A D E R<br/>  <br/>  dashboardHeader(title = "Alt Coin Gainers"),<br/>  <br/>  # S I D E B A R<br/>  <br/>  dashboardSidebar(<br/>    <br/>    h5("A slightly interactive dashboard that pulls the top gainers from the last hour from<br/>       coinmarketcap.com. Refreshes every 60 seconds."),<br/>    <br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    br(),<br/>    <br/>    h6("Built by Brad Lindblad in the R computing language <br/>      [  R Core Team (2018). R: A language and environment for statistical computing. R Foundation for Statistical Computing,<br/>  Vienna, Austria. URL <a class="ae kc" href="https://www.R-project.org/" rel="noopener ugc nofollow" target="_blank">https://www.R-project.org/</a>]"),<br/>    br(),<br/>    h6("R version 3.4.4 (2018-03-15) 'Someone to Lean On'"),<br/>    br(),<br/>    a("<a class="ae kc" href="mailto:bradley.lindblad@gmail.com" rel="noopener ugc nofollow" target="_blank">bradley.lindblad@gmail.com</a>", href="<a class="ae kc" href="mailto:bradley.lindblad@gmail.com" rel="noopener ugc nofollow" target="_blank">bradley.lindblad@gmail.com</a>")<br/>    <br/>  ),<br/>  <br/>  # B O D Y<br/>  dashboardBody(<br/>    <br/>  fluidRow(<br/>    <br/>    # InfoBox<br/>    infoBoxOutput("top.coin",<br/>                  width = 3),<br/>    <br/>    # InfoBox<br/>    infoBoxOutput("top.name",<br/>                  width = 3)<br/>    <br/>  ),<br/>  <br/>  fluidRow(</span><span id="ff76" class="lr ls iq np b gy nx nu l nv nw">column(<br/>    # Datatable<br/>      box(<br/>        status = "primary",<br/>        headerPanel("Data Table"),<br/>        solidHeader = T,<br/>        br(),<br/>        DT::dataTableOutput("table", height = "350px"),<br/>        width = 6,<br/>        height = "560px"<br/>      ),<br/>      <br/>      # Chart<br/>      box(<br/>        status = "primary",<br/>        headerPanel("Chart"),<br/>        solidHeader = T,<br/>        br(),<br/>        plotOutput("plot", height = "400px"),<br/>        width = 6,<br/>        height = "500px"<br/>      ),<br/>      width = 12<br/>    )<br/>    <br/>  )<br/>  )<br/>  <br/>)</span><span id="f9a1" class="lr ls iq np b gy nx nu l nv nw">#####################<br/>#### S E R V E R ####<br/>#####################</span><span id="eb27" class="lr ls iq np b gy nx nu l nv nw">server &lt;- function(input, output) {</span><span id="977b" class="lr ls iq np b gy nx nu l nv nw"># R E A C T I V E <br/>  liveish_data &lt;- reactive({<br/>    invalidateLater(60000)    # refresh the report every 60k milliseconds (60 seconds)<br/>    get.data()                # call our function from above<br/>  })<br/>  <br/>  <br/>  live.infobox.val &lt;- reactive({<br/>    invalidateLater(60000)    # refresh the report every 60k milliseconds (60 seconds)<br/>    get.infobox.val()         # call our function from above<br/>  })<br/>  <br/>  <br/>  live.infobox.coin &lt;- reactive({<br/>    invalidateLater(60000)    # refresh the report every 60k milliseconds (60 seconds)<br/>    get.infobox.coin()        # call our function from above<br/>  })<br/>  <br/>  # D A T A   T A B L E   O U T P U T<br/>  output$table &lt;- DT::renderDataTable(DT::datatable({<br/>    data &lt;- liveish_data()}))<br/>  <br/>  <br/>  # P L O T   O U T P U T<br/>  output$plot &lt;- renderPlot({ (ggplot(data=liveish_data(), aes(x=Symbol, y=`% 1h`)) +<br/>                                 geom_bar(stat="identity", fill = "springgreen3") +<br/>                                 theme(axis.text.x = element_text(angle = 90, hjust = 1)) +<br/>                                 ggtitle("Gainers from the Last Hour"))<br/>  })<br/> <br/>  <br/>  <br/>  # I N F O B O X   O U T P U T - V A L<br/>  output$top.coin &lt;- renderInfoBox({<br/>    infoBox(<br/>      "Gain in Last Hour",<br/>      paste0(live.infobox.val(), "%"),<br/>      icon = icon("signal"),<br/>      color = "purple",<br/>      fill = TRUE)<br/>  })<br/>   <br/>  <br/>  # I N F O B O X   O U T P U T - N A M E<br/>  output$top.name &lt;- renderInfoBox({<br/>    infoBox(<br/>      "Coin Name",<br/>      live.infobox.coin(),<br/>      icon = icon("bitcoin"),<br/>      color = "purple",<br/>      fill = TRUE)<br/>  })<br/>  <br/>}</span><span id="8f58" class="lr ls iq np b gy nx nu l nv nw">#####################<br/>#### D E P L O Y ####<br/>#####################</span><span id="1291" class="lr ls iq np b gy nx nu l nv nw"># Return a Shiny app objectshinyApp(ui = ui, server = server)<br/>shinyApp(ui = ui, server = server)</span></pre></div></div>    
</body>
</html>