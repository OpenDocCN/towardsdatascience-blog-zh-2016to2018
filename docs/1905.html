<html>
<head>
<title>PoetBot: a Telegram chat-bot for poem recommendation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PoetBot:一个推荐诗歌的电报聊天机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/poetbot-2-a-telegram-chat-bot-for-poem-recommendation-70d1b809761c?source=collection_archive---------2-----------------------#2017-11-14">https://towardsdatascience.com/poetbot-2-a-telegram-chat-bot-for-poem-recommendation-70d1b809761c?source=collection_archive---------2-----------------------#2017-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0ab5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从头开始构建你的第一个诗意聊天机器人</h2></div><p id="15d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">谁不需要生活中的一点诗意来度过呢？谁不想找一点代码让它发光呢？本教程的目的是为<a class="ae lb" href="https://telegram.org/" rel="noopener ugc nofollow" target="_blank"> Telegram </a>中的诗歌推荐建立一个全功能的聊天机器人，这是一个类似于WhatsApp的即时通讯平台，除了比<em class="lc">好得多</em>、<em class="lc">好得多</em>。我们将把工作流程分成三大块:</p><ol class=""><li id="5b10" class="ld le iq kh b ki kj kl km ko lf ks lg kw lh la li lj lk ll bi translated">在网上搜索浪漫，输入我们的数据库。</li><li id="719f" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">编写一个Python脚本来处理<strong class="kh ir">文本处理和标记</strong>。</li><li id="ee89" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">将聊天机器人嵌入电报。</li></ol><p id="a320" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你准备好了吗？现在，在我们开始之前，让我给你介绍一个人…</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lr"><img src="../Images/a954ce8f230228f8dc39c4509159b83f.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*IhqU6bjjbNX__xNwf6huzQ.jpeg"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk">Hey, please meet PoetBot.</figcaption></figure><h2 id="8b21" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ko mq mr ms ks mt mu mv kw mw mx my mz bi translated">第一步:爬行</h2><p id="f88e" class="pw-post-body-paragraph kf kg iq kh b ki na jr kk kl nb ju kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">首先:在我们开始构思诗歌推荐引擎之前，我们必须有一些很酷的诗歌要分发。由于找不到符合我们需要的诗歌数据库，我们决定从网上搜集资料，建立自己的数据库。人们的目光很快停留在Pomemhunter.com，这是一个提供来自世界各地酸甜苦辣的内容的门户网站。我们花了一些时间研究网站的架构，发现用户排名的前500首诗存储在20个相邻的网页上，其逻辑如下:</p><blockquote class="nf ng nh"><p id="9a4c" class="kf kg lc kh b ki kj jr kk kl km ju kn ni kp kq kr nj kt ku kv nk kx ky kz la ij bi translated"><a class="ae lb" href="https://www.poemhunter.com/p/m/l.asp?a=0&amp;l=top500&amp;order=title&amp;p=1" rel="noopener ugc nofollow" target="_blank">https://www.poemhunter.com/p/m/l.asp?a=0&amp;l = top 500&amp;order = title<strong class="kh ir">&amp;p = 1</strong></a><strong class="kh ir"><br/></strong>首诗1至25首<br/>https://www.poemhunter.com/p/m/l.asp?a=0&amp;l = top 500&amp;order = title<strong class="kh ir">&amp;p = 2</strong>首诗26至50首<strong class="kh ir"><br/></strong>T31】https://www.poemhunter.com/p/m/l.asp?a=0&amp;l = top 500&amp;order =首</p><p id="9145" class="kf kg lc kh b ki kj jr kk kl km ju kn ni kp kq kr nj kt ku kv nk kx ky kz la ij bi translated">随着<strong class="kh ir"> p </strong>从<strong class="kh ir"> 1 </strong>增加到<strong class="kh ir"> 20 </strong></p></blockquote><p id="a91b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，我们可以循环p属性来获得包含500首诗的20个页面的URL列表。这用Python来翻译(<em class="lc">警告:代码开始</em>):</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="7898" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在知道指向每首诗的超链接存储在哪里，我们需要做的就是检索它们。回到<a class="ae lb" href="https://www.poemhunter.com/p/m/l.asp?a=0&amp;l=top500&amp;order=title&amp;p=1" rel="noopener ugc nofollow" target="_blank">这里</a>并按下<em class="lc"> ctrl+U </em>，我们注意到各个诗歌的URL包含在一个标签为‘title’的&lt; td &gt;元素中。根据这些信息，我们使用requests和BeautifulSoup编写一个代码来创建一个收集500个URL的列表(代码中的“链接”)。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="c49d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，工作完成了一半。我们现在可以一首接一首地连接到诗歌，并保存每个作者、标题和全文。最后，我们将结果保存在一个csv表中供以后使用。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="c435" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了，我们把所有的数据都放在一个地方。<strong class="kh ir">辛苦工作之后，我们可以放松一下，享受一点诗歌，不是吗？</strong>浏览我们刚刚创建的表格(顺便说一句，你会在这里找到它<a class="ae lb" href="https://github.com/bugo99iot/poet_bot" rel="noopener ugc nofollow" target="_blank"/>和所有其他代码)，<a class="ae lb" href="https://www.poemhunter.com/poem/annabel-lee/" rel="noopener ugc nofollow" target="_blank">第13首最受欢迎的诗</a>是罗尔德·达尔著名的“电视”，在这首诗中，这位英国作家对现代技术并不轻松(我一直同意你的观点)。关于孩子看电视，它是这样的:</p><blockquote class="nf ng nh"><p id="4170" class="kf kg lc kh b ki kj jr kk kl km ju kn ni kp kq kr nj kt ku kv nk kx ky kz la ij bi translated">他们坐着，凝视着，凝视着，坐着<br/>直到他们被它催眠，<br/>直到他们被那些令人震惊的可怕的垃圾完全灌醉。<br/>哦，是的，我们知道它让他们保持安静，<br/>他们不会爬出窗台，<br/>他们从不打架或踢或打，<br/>他们让你自由地做午饭<br/>和在水槽里洗碗— <br/>但是你有没有停下来想一想，<br/>想知道这对你心爱的孩子到底有什么影响？</p></blockquote><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nn"><img src="../Images/c197e439b690eeaf48c31789210f116a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hlPv1GN2nrCUTxvO6hFXg.jpeg"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk">The culprit.</figcaption></figure><h2 id="d05d" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ko mq mr ms ks mt mu mv kw mw mx my mz bi translated">第二步:锁定目标</h2><p id="7725" class="pw-post-body-paragraph kf kg iq kh b ki na jr kk kl nb ju kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">在开始锁定目标之前，我们需要<strong class="kh ir">清理我们的数据</strong>。我们的策略如下:我们从刚刚创建的<a class="ae lb" href="https://github.com/bugo99iot/poet_bot/blob/master/poems_collection.csv" rel="noopener ugc nofollow" target="_blank">表</a>上传原始文本，对于每首诗，我们将标题和文本连接在一起，我们删除停用词、标点符号和数字，我们标记，我们计算平均标记长度，我们截断太长的诗，我们扩展太短的诗以获得等长的行。<em class="lc">‘Pfiu！，我试着尽可能快地说出来。如果你想详细了解这是如何做到的，请参考下面的笔记本。如果没有(谁怪你)，就在'<a class="ae lb" href="https://github.com/bugo99iot/poet_bot/blob/master/tokenized_poems.csv" rel="noopener ugc nofollow" target="_blank"> tokenized_poems.csv </a>'随便看看，继续下一段。</em></p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="5789" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，我们现在准备写我们的定位算法。当用户与机器人互动时，他们将被要求输入一个句子和/或一系列单词来描述他们想要的诗歌是什么样子的。依靠如此小的数据集，尝试将诗歌聚类成主题并使用它们作为目标是没有意义的。然后我们选择了一个简单得多的解决方案，老一套:“给我一袋单词，我会还给你包含最多单词的那首诗！“我们是有想象力的人，我们设计了一个<strong class="kh ir"> Python类</strong>，它将优雅地接受一个字符串并返回我们的目标诗歌的全文。把刚才说的重新组织成子句和循环，代码看起来很庞大，如果你感兴趣的话，看看这里的<a class="ae lb" href="https://github.com/bugo99iot/poet_bot/blob/master/poet_class.py" rel="noopener ugc nofollow" target="_blank"/>。否则就继续读吧，在教程的最后，我会解释如何在不知道里面有什么的情况下使用这个机器人。</p><p id="7079" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了利用我们的类(对不起，Karl不是那个意思)，我们写了一个‘main . py’程序，它为Poet_class创建了一个实例，并在其上调用‘get _ poem’方法。非常简单快捷:</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="338f" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ko mq mr ms ks mt mu mv kw mw mx my mz bi translated">第三步:将聊天机器人嵌入电报</h2><p id="d11b" class="pw-post-body-paragraph kf kg iq kh b ki na jr kk kl nb ju kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">最后，我们都在等待的时刻。我们有我们的数据，我们有如何选择诗歌的规则，我们知道如何从数据库中提取它们。我们所需要的是创建我们的机器人，并附上一套指令！为了做到这一点，我们首先导入相关的库并启动一个记录器，在错误发生时向终端显示错误。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0687" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们定义一组机器人能够处理的指令。下面，每个函数对应一个方法。告诉机器人类似“/poem about cactus and roses”的内容将激活“poem”方法，该方法将处理输入并调用Poet_class来选择目标诗歌及其文本。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="32c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，一堆台词就给不出思路了。让我们试试机器人直播吧！从终端启动脚本并连接到PoetBot，我们发出第一个请求:</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi no"><img src="../Images/ff37920368f435fc5acdf33e00d82ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*CmgXndkxaX0mD-V13r6D8A.jpeg"/></div></figure><p id="8748" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">工作正常！我们可以给机器人一个更简单的表达式，看看会有什么结果。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div class="gh gi no"><img src="../Images/749db021318a27ab7cec4be3e2c7b713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*afwUzoQId86MLOkIt2309g.jpeg"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk">Guess what the word is…</figcaption></figure><p id="a811" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">机器人似乎再次做出了很好的反应，搜索“爱”这个词出现最多的诗歌(在这种情况下，它出现了很多)。</p><p id="1d33" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，完成了。你可以用更复杂的查询来测试这个算法，并希望从中获得一些奇怪和有趣的东西！注意:PoetBot还没有部署，所以如果你想使用它，你必须自己获得它(说明如下)。万一有(烧瓶？)开发者正在看这个，想帮我们放到云上，请给我们喊一声，我们提供电子啤酒作为交换(互联网第0法则:如果你能想到，大概它已经存在了)。感谢大家的阅读。</p><h2 id="94be" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ko mq mr ms ks mt mu mv kw mw mx my mz bi translated">建立你自己的机器人</h2><p id="7e7b" class="pw-post-body-paragraph kf kg iq kh b ki na jr kk kl nb ju kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">安装你自己的机器人的步骤如下:</p><ol class=""><li id="3386" class="ld le iq kh b ki kj kl km ko lf ks lg kw lh la li lj lk ll bi translated">下载电报应用到你的手机。</li><li id="4444" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">问候BotFather(默认情况下他会在你的联系人列表中)，然后告诉他你想创建一个新的bot。命令:<strong class="kh ir"> /newbot </strong></li><li id="3edf" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">给你的机器人一个名字(将显示什么)和一个用户名(将用于识别)。在我的例子中，我选择了<em class="lc"> PoetBot </em>和<em class="lc"> VioletsAreBlueBot </em>。请不要问。</li><li id="16cd" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">爸爸会给你一个令牌。把它保存在某个地方。</li><li id="2393" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">从<a class="ae lb" href="https://github.com/bugo99iot/poet_bot" rel="noopener ugc nofollow" target="_blank">这个</a> github repo，克隆到你的本地机器' bot.py '，' poet_class.py '，' tokenized_poems.csv '，' poems_collection.csv '和' requirements.txt '。</li><li id="afd8" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">在bot.py中，插入BotFather给你的令牌。</li><li id="c946" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">通过访问您的本地文件夹，后跟命令“pip install -r requirements.txt”来安装要求</li><li id="0905" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">运行“python3 bot.py”</li><li id="a251" class="ld le iq kh b ki lm kl ln ko lo ks lp kw lq la li lj lk ll bi translated">通过使用用户名作为搜索标准在Telegram上找到您的机器人，并享受它:)</li></ol><p id="6f57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lc">【poet bot图片鸣谢:Ivan Kershner。】</em></p></div></div>    
</body>
</html>