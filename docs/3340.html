<html>
<head>
<title>Extended Kalman Filter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩展卡尔曼滤波器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extended-kalman-filter-ee9bd04ac5dc?source=collection_archive---------2-----------------------#2018-05-04">https://towardsdatascience.com/extended-kalman-filter-ee9bd04ac5dc?source=collection_archive---------2-----------------------#2018-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0c78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我以前的博客中，我已经介绍过卡尔曼滤波器。在这篇博客中，我将讨论扩展滤波，并看看它如何解决卡尔曼滤波的问题。</p><p id="de1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客是我之前关于卡尔曼滤波器的博客的延续，所以如果你还没有读过，请在这里阅读。</p><h1 id="e1e8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">为什么要使用扩展卡尔曼滤波器？</h1><p id="5927" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了解决卡尔曼滤波中的非线性问题，引入了扩展卡尔曼滤波。在现实生活中，可能有许多场景，系统可能会从一个方向观察，而从另一个方向进行测量。这涉及到解决这些问题的角度，导致非线性函数，当输入高斯函数时，导致非高斯分布。并且我们不能对非高斯分布应用卡尔曼滤波器，因为计算非高斯函数的均值和方差是没有意义的。</p><p id="8f76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是如何工作的？</p><p id="1fc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">扩展卡尔曼滤波器利用<strong class="jp ir">泰勒级数、</strong>将非线性函数转化为线性函数，有助于得到非线性函数的<strong class="jp ir">线性逼近</strong>。</p><h2 id="3412" class="lp kn iq bd ko lq lr dn ks ls lt dp kw jy lu lv la kc lw lx le kg ly lz li ma bi translated">泰勒级数:</h2><p id="800b" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在数学中，<strong class="jp ir">泰勒级数</strong>是一个函数的表示，它是由函数在一个点的导数的值计算出来的无穷多个项的总和。简单来说，我们可以说，在泰勒级数中，我们取一个点，对它进行一系列求导。</p><p id="1d6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们对一个多项式执行泰勒级数时，结果也是一个多项式，因此 EKF 所做的是首先在一个平均值处评估非线性函数，该平均值是分布的最佳近似值，然后估计一条斜率在该平均值附近的直线。该斜率由泰勒展开的一阶导数确定，因为一阶导数给出了线性值。因此，这种从泰勒级数的一阶导数获得斜率的方法被称为<strong class="jp ir">一阶泰勒展开。</strong></p><p id="1efa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何进行泰勒展开？</strong></p><p id="2fe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">泰勒级数由下式给出</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/fa1ff5f2169dee480e3c95686b39b9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*_wKf1LQ6fdy6ac-QJ6CBog.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Taylor Series</figcaption></figure><p id="7ee9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非线性函数 f(x)在均值(μ)处的泰勒级数方程的一般公式由下式给出:</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/60ef82967132e55d3dee26562ddc782d.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*4iFjUNHY0QrC9tg4nE1zLA.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">By appling first order taylor expansion method</figcaption></figure><p id="018d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">得到泰勒展开式需要遵循的步骤:</em></p><ul class=""><li id="57e5" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">用一个给定的等式代替 f(x)</li><li id="1f15" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">求偏导数</li><li id="4433" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">插入值μ，并进行评估，以获得μ值处的泰勒展开式。</li></ul><p id="2fd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过一个例子来理解这一点:</p><p id="d2a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设我们必须找到方程 sin(x)在μ = 0 时的泰勒展开式</p><p id="a92e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以按照上面讨论的步骤:</p><ul class=""><li id="0b85" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">h(x) = sin(x)</li><li id="0d41" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">∂h = cos(x)</li><li id="a17e" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">h(x)≈h(μ)+∂x∂h(μ)(xμ)</li></ul><p id="9db5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">h(x)≈sin(μ)+cos(μ)(xμ)= 0+1 *(x-0)= x</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/481831b9533559110bb2122019d779bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*cYgZUegWgIERGoA2RQ_MKQ.png"/></div></figure><h1 id="43f5" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">EKF 对 KF 预测和更新方程的影响</h1><p id="bfb5" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">当我们谈到 EKF 对 KF 方程的影响时，有必要知道数据的来源。也就是说，对于自主车辆，我们需要知道我们必须执行预测的数据是来自激光雷达还是雷达。</p><p id="efdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为激光雷达以笛卡尔坐标系统的形式为我们提供距离，而雷达以极坐标系统为我们提供距离和速度。两者的测量向量如下:</p><p id="3b4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">激光雷达:{px，py} </strong></p><p id="1bbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">雷达:{ <em class="mo"> ρ，φ，ρ_dot </em> } </strong></p><p id="553b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中 px:物体在笛卡尔坐标系中的 x 坐标</p><p id="4c89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> py: </strong>物体在笛卡尔坐标系中的 y 坐标</p><p id="ae1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="mo"/></strong><em class="mo">:</em>物体与车辆的距离</p><p id="8cc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="mo">φ</em></strong><em class="mo">:x 和ρ之间的逆时针角度</em></p><p id="ccf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="mo">ρ_ dot</em></strong><em class="mo">:ρ的变化率</em></p><p id="9f4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">x 轴决定汽车移动的位置。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/63b0e11657fd47d02b0d805b33306b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fj-Vlw62cKQ3uZtHf3knXw.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Polar coordinate System</figcaption></figure><p id="3033" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，你可能已经理解了激光雷达提供的数据本质上是线性的，而雷达提供的数据是非线性的。因此，激光雷达数据的等式将保持与卡尔曼滤波器的等式相同，但是对于雷达测量，等式将如下:</p><p id="c0b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">预测步骤:</strong></p><blockquote class="nj nk nl"><p id="3ade" class="jn jo mo jp b jq jr js jt ju jv jw jx nm jz ka kb nn kd ke kf no kh ki kj kk ij bi translated"><strong class="jp ir">x′= f . x+b .μ+ν</strong></p><p id="af9c" class="jn jo mo jp b jq jr js jt ju jv jw jx nm jz ka kb nn kd ke kf no kh ki kj kk ij bi translated"><strong class="jp ir">p′=fpfᵀ+q</strong></p></blockquote><p id="321d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论使用何种设备，它都将保持与 KF 相同的状态。</p><p id="9ea3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">雷达测量更新步骤:</strong></p><blockquote class="nj nk nl"><p id="8cce" class="jn jo mo jp b jq jr js jt ju jv jw jx nm jz ka kb nn kd ke kf no kh ki kj kk ij bi translated"><strong class="jp ir">y = z—h(x’)</strong></p></blockquote><p id="5172" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> z: </strong>极坐标下的实际测量</p><p id="68e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">h(x’):</strong>预测笛卡尔坐标系到极坐标的映射。这里的<strong class="jp ir">x′</strong>是笛卡尔坐标系中的预测值。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/40861411aa00f3b5e105ee5b09becfe8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jyOeBgS6JVHoA4PgA6JmOA.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Mapping of Cartesian to Polar Coordinate system [Taken from udacity Nano degree]</figcaption></figure><p id="4c1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> y: </strong>实测值与实际测量值之差。</p><blockquote class="nj nk nl"><p id="e9c9" class="jn jo mo jp b jq jr js jt ju jv jw jx nm jz ka kb nn kd ke kf no kh ki kj kk ij bi translated"><strong class="jp ir">s =hⱼp′hⱼᵀ+r<br/>k =p′hⱼᵀs⁻</strong></p></blockquote><p id="1813" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> R: </strong>测量噪音</p><p id="8a32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些噪声决定了器件的校正参数。它由设备制造商提供，并在整个周期中保持不变。</p><p id="0775" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Hⱼ: </strong>雅可比矩阵</p><p id="28f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们已经看到的，为了将非线性函数转换为线性函数，我们使用泰勒级数展开，并对其进行一阶导数。当我们在方程中处理矩阵时，这个一阶导数由雅可比矩阵给出。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/82c08f2031a50e13f87eeff9edd82180.png" data-original-src="https://miro.medium.com/v2/format:webp/1*cKT7SLvNfpULy_5xbyawFg.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Jacobian matrix</figcaption></figure><p id="7b80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为雷达的状态向量由 px、py、vx 和 vy 组成。</p><p id="f58e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过应用导数，我们将得到 Hj 的最终值，如下所示:</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/e71d1e6e9e6561e05fcc45aa9477ed80.png" data-original-src="https://miro.medium.com/v2/format:webp/1*06nC17VcAKp1xKm5ANjD0g.jpeg"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Jacobian matix after applying derivative</figcaption></figure><p id="eda7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> K: </strong>卡尔曼增益</p><p id="3cf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们通过简单的公式计算卡尔曼增益，这个公式我已经在我的关于卡尔曼滤波的博客中展示过了。唯一的事情是，在矩阵中我们不能分割，所以这里我们采取<strong class="jp ir"> S⁻。</strong></p><blockquote class="nj nk nl"><p id="4da1" class="jn jo mo jp b jq jr js jt ju jv jw jx nm jz ka kb nn kd ke kf no kh ki kj kk ij bi translated"><strong class="jp ir">x = x′+k . y<br/>p =(I-khⱼ)p′</strong></p></blockquote><p id="73f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们更新状态向量和协方差矩阵，并继续下一个预测步骤以获得其他值。</p><h1 id="9c46" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">扩展卡尔曼滤波器的问题</h1><p id="fc8d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在扩展卡尔曼滤波器中，近似是基于单点即均值来完成的。这种近似可能不是最佳的近似，并导致较差的性能。你可以通过下图来理解:</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/28e1deb594c5fb4abc0363c3b284595d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*h6od8QV67TMGOJzBsN2R1g.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">mean and variance [Left] approximation based on mean[center] best possible approximation vs EKF approximation.[right][<a class="ae kl" href="https://classroom.udacity.com/nanodegrees/nd013-connect/parts/7dc7c9b7-2884-4e43-bf15-2d1e1a121081" rel="noopener ugc nofollow" target="_blank">Image Source</a>]</figcaption></figure><p id="7804" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<a class="ae kl" href="https://en.wikipedia.org/wiki/UKF" rel="noopener ugc nofollow" target="_blank">无迹卡尔曼滤波器</a>解决了扩展卡尔曼滤波器的这个问题</p></div></div>    
</body>
</html>