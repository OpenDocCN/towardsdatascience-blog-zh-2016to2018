<html>
<head>
<title>Food Ingredient Reverse-Engineering Through Gradient Descent</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过梯度下降进行食品成分逆向工程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/food-ingredient-reverse-engineering-through-gradient-descent-2a8d3880dd81?source=collection_archive---------7-----------------------#2017-12-20">https://towardsdatascience.com/food-ingredient-reverse-engineering-through-gradient-descent-2a8d3880dd81?source=collection_archive---------7-----------------------#2017-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/c53db93b9f25c70eb784736ee1b61215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OLdYVQ_lqdqC8Wp3Eohqg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">DeepNutella — <a class="ae jd" href="http://arxiv.org/abs/1508.06576" rel="noopener ugc nofollow" target="_blank">Neural Style Transfer</a> (base image: <a class="ae jd" href="https://www.nutella.com" rel="noopener ugc nofollow" target="_blank">nutella.com</a>)</figcaption></figure><div class=""/><blockquote class="kd ke kf"><p id="a4dd" class="kg kh ki kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">带着另一个奇怪的想法回来，这总是另一个学习新东西的借口。这个故事是关于我做的一个快速实验，猜测包装食品中每种成分的不同含量。基于成分列表和营养事实标签，我将任务公式化为线性回归问题，其中成分百分比是参数。为了执行优化(梯度下降)，我使用了官方的hipster深度学习库，又名<a class="ae jd" href="http://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>。代码<a class="ae jd" href="https://github.com/jctestud/food-reverse-engineering" rel="noopener ugc nofollow" target="_blank">可以在这里找到</a>。</p></blockquote></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="f393" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">我喜欢烹饪。我并不总是有时间做饭，但当我有时间时，我会尝试使用非常科学的方法。例如，我喜欢简化和揭开老祖母食谱的神秘面纱。在这个过程中，我可能不得不处理食物数据，尤其是营养数据(也就是碳水化合物、蛋白质、脂肪、盐等的含量)。).</p><p id="d288" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">在这个实验中，我试图通过使用大多数包装食品上要求的<a class="ae jd" href="https://en.wikipedia.org/wiki/Nutrition_facts_label" rel="noopener ugc nofollow" target="_blank">营养成分标签</a>来找到食谱中(缺失的)成分百分比。我的直觉是，这些数据足以找到真正的配方。</p><p id="32df" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated"><em class="ki">注:显然还有一些其他的方法可以找到食材，但是在这个</em> <a class="ae jd" href="http://www.inference.vc/my-thoughts-on-alchemy/" rel="noopener ugc nofollow" target="_blank"> <em class="ki">炼金</em> </a> <em class="ki">的时代，为什么不针对问题扔点渐变下降呢？</em></p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="c4ef" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">就拿我们钟爱的棕榈油涂抹酱Nutella来说吧。<br/>以下是配料:</p><figure class="lq lr ls lt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lp"><img src="../Images/8febe40e830a9d37735481beb9385ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYWlSK5bwBakFjEcj2VinQ.jpeg"/></div></div></figure><h1 id="6661" class="lu lv jg bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">砝码</h1><p id="8190" class="pw-post-body-paragraph kg kh jg kj b kk ms km kn ko mt kq kr lm mu ku kv ln mv ky kz lo mw lc ld le ij bi translated">在我的线性回归模型中，参数(重量)是不同成分的克数:</p><ul class=""><li id="9bb9" class="mx my jg kj b kk kl ko kp lm mz ln na lo nb le nc nd ne nf bi translated">w1是100克果仁糖的含量，</li><li id="f517" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi translated">w2是100克果仁中棕榈油的含量，</li><li id="02d9" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi translated">诸如此类…</li></ul><p id="8a39" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">在某些情况下，某些百分比是已知的。欧洲Nutella就是这种情况，我们知道其健康成分(榛子、可可等)的含量。).在这种情况下，重量是固定的，不可训练。</p><h1 id="1bca" class="lu lv jg bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">输入和输出</h1><p id="5d64" class="pw-post-body-paragraph kg kh jg kj b kk ms km kn ko mt kq kr lm mu ku kv ln mv ky kz lo mw lc ld le ij bi translated">现在营养事实标签:</p><figure class="lq lr ls lt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lp"><img src="../Images/b78ac82754a491a216e333a56534359a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*diwt9ZXXWtas1VAheJNgTQ.jpeg"/></div></div></figure><p id="7113" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">每个营养成分成为一个训练观察/例子(x，y)。</p><p id="8c33" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">让我们以“总脂肪”组件为例，它给了我们一个(x，y)元组。</p><p id="2772" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">x是包含每种成分中脂肪百分比的行向量:</p><ul class=""><li id="0579" class="mx my jg kj b kk kl ko kp lm mz ln na lo nb le nc nd ne nf bi translated">x1是糖中脂肪的百分比(0%)</li><li id="4fe7" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi translated">x2棕榈油中脂肪的百分比(100%)</li><li id="1d8d" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi">…</li></ul><p id="c135" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">这些很简单。但对于某些成分，猜测其成分变得越来越难(卵磷脂有人知道吗？).在这个实验中，我使用了美国农业部国家营养数据库，其中包含了大多数基本成分的信息。</p><blockquote class="kd ke kf"><p id="396c" class="kg kh ki kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">注意:这个数据库并不是万能的，营养成分会有很大的不同(榛子有不同的种类，你可以选择是否烘焙它们，可可可以是生的或脱脂的……)</p></blockquote><p id="7bf5" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">在我的非常深的1层神经网络的另一边，y是一个标量，包含最终产品中的脂肪量。这些信息很容易在营养事实表中找到:<br/>每份Nutella含有12g脂肪，或者，在一个更文明的营养标签系统中:31%(谢谢法国)</p><p id="48a1" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">由于这种标记非常冗长，我们可以得到大约十个(x，y)样本。</p><h1 id="fbc8" class="lu lv jg bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">培养</h1><p id="ad09" class="pw-post-body-paragraph kg kh jg kj b kk ms km kn ko mt kq kr lm mu ku kv ln mv ky kz lo mw lc ld le ij bi translated">当然，在模型中，线性单位没有偏差。在食物成分中找不到暗物质，所有的东西都被计算在数量的加权和中。</p><p id="8208" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">在PyTorch中声明所有这些相对容易(这是我的第一次)，这个库非常自然和直接，我想我现在理解炒作了。现在，我们应该只是减少原始L2损失吗？不，我们必须在模型上设置很多约束，使它收敛到一个看似合理的局部最小值，而不是一个我必须放入负量可可的奇怪配方。</p><h2 id="8386" class="nl lv jg bd lw nm nn dn ma no np dp me lm nq nr mi ln ns nt mm lo nu nv mq nw bi translated">特定域约束</h2><ul class=""><li id="8509" class="mx my jg kj b kk ms ko mt lm nx ln ny lo nz le nc nd ne nf bi translated">质量不能是负的(不是开玩笑)</li><li id="b85c" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi translated">一些权重是固定的(当百分比已知时)</li><li id="41a3" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi translated">质量的总和必须等于100克</li><li id="3252" class="mx my jg kj b kk ng ko nh lm ni ln nj lo nk le nc nd ne nf bi translated">最重要的是，重量要按降序排列(与包装上食品成分按降序排列的方式相同)</li></ul><p id="4d0b" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">这些约束中的一些是在更新权重时强制实施的，一些是通过损失函数中的炼金术士技巧实施的。<a class="ae jd" href="https://github.com/jctestud/food-reverse-engineering/blob/master/food_ingredient_reverse-engineering_pytorch.ipynb" rel="noopener ugc nofollow" target="_blank">恐怕这些都不是什么好东西</a>。</p><p id="befc" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">我使用整个数据集(批量梯度下降)来计算每一步的损失函数。结果如下:</p><div class="lq lr ls lt gt ab cb"><figure class="oa is ob oc od oe of paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/e7242b6ad6d9474706209593ff6493bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*GeLMU5umL7d26BunzAF0tQ.png"/></div></figure><figure class="oa is og oc od oe of paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/c6c1b34d8c891f45246e7e896125d218.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*0RryCCtnig8BIUwS9XKvkg.png"/></div></figure></div><p id="26ce" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated"><strong class="kj jh">配料:</strong>糖(50.8%)、棕榈油(19.7%)、榛子(13.0%)、可可(7.4%)、脱脂奶粉(6.6%)、乳化剂(1%*)</p><p id="2757" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated"><em class="ki"> (*)充分披露:乳化剂保持在1%以下(它只是一种添加剂)</em></p><p id="9cd8" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">我承认结果并不令人印象深刻。但是我想把它看完，通常，旅程比目的地更重要:)希望你喜欢它！</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><figure class="lq lr ls lt gt is gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/e81dc722b432703dd78fff022a31360b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*OmQPG7lXV2fz0-2oCVQTLw.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">source: <a class="ae jd" href="https://www.hersheys.com" rel="noopener ugc nofollow" target="_blank">hersheys.com</a></figcaption></figure><h2 id="8af5" class="nl lv jg bd lw nm nn dn ma no np dp me lm nq nr mi ln ns nt mm lo nu nv mq nw bi translated">奖金:里斯的花生酱杯</h2><p id="3578" class="pw-post-body-paragraph kg kh jg kj b kk ms km kn ko mt kq kr lm mu ku kv ln mv ky kz lo mw lc ld le ij bi translated">我还试图找到里斯著名的花生酱杯子的原料。</p><p id="faad" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">这是一项更艰巨的任务:10种不同的成分，但没有一种是已知的。</p><p id="d445" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">此外，还有两种“复合”配料，每种都有自己的配料表:牛奶巧克力涂层和花生酱夹心。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><figure class="lq lr ls lt gt is gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/afb1070f9c6346ccb6642d38b9692cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*82uuM9XV6P_CI0l_Ymn89A.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Here, a clear example of ingredients getting stuck between their left and right neighbors</figcaption></figure><p id="0287" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated"><strong class="kj jh">配料:</strong>牛奶巧克力(62%)【糖(20.3克)、可可脂(16.0克)、可可液块(6.3克)、脱脂牛奶(6.3克)、乳脂(6.3克)、乳糖(6.3克)、乳化剂(0.3克)】花生馅(38%)【花生(18.7克)、葡萄糖(18.7克)、盐(0.7克)】</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="2365" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated"><em class="ki">这个故事到此结束。如果你喜欢，可以关注我的</em> <a class="ae jd" href="https://medium.com/@jctestud" rel="noopener"> <em class="ki">中</em> </a> <em class="ki">或</em> <a class="ae jd" href="https://twitter.com/jctestud" rel="noopener ugc nofollow" target="_blank"> <em class="ki">推特</em> </a> <em class="ki">获取最新消息。如果你喜欢唐纳德·特朗普，你可能会喜欢阅读</em> <a class="ae jd" href="https://medium.com/jctestud/yet-another-text-generation-project-5cfb59b26255" rel="noopener"> <em class="ki">这篇文章</em> </a> <em class="ki">。如果你更喜欢《权力的游戏》，</em> <a class="ae jd" href="https://medium.com/jctestud/game-of-thrones-word-embeddings-does-r-l-j-part-1-8ca70a8f1fad" rel="noopener"> <em class="ki">去那里</em> </a> <em class="ki">。</em></p><p id="c456" class="pw-post-body-paragraph kg kh jg kj b kk kl km kn ko kp kq kr lm kt ku kv ln kx ky kz lo lb lc ld le ij bi translated">另外，如果你觉得有什么不对，或者有什么问题，欢迎在下面评论。</p></div></div>    
</body>
</html>